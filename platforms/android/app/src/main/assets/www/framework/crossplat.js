Object.size=function(e){var t,a=0;for(t in e)e.hasOwnProperty(t)&&a++;return a};var crossplat={app:{},device:{},initialize:function(e){crossplat.loadJsCss("./framework/assets/css/normalize.css","text/css","head","base").then((()=>{crossplat.loadJsCss("./framework/assets/css/loader.css","text/css","head","base").then((()=>{crossplat.loadPackages((function(){e()}))})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))},loadPackages:function(e){jQuery.getJSON("./app/app.json",(function(t){crossplat.app=t,e()}))},loadFile:function(e,t){var a=new XMLHttpRequest;a.open("GET",e,!0),a.onload=function(){4===a.readyState&&(200===a.status||0==a.status)?t(a.responseText):t(!1)},a.onerror=function(e){t(!1)},a.send()},loadJsCss:function(e,t,a,n){return new Promise(((o,r)=>{var s,i={path:e,type:t,destination:a,reference:n};if("text/javascript"==t?((s=document.createElement("script")).setAttribute("type","text/javascript"),s.setAttribute("src",e),s.setAttribute("route",n)):"text/css"==t&&((s=document.createElement("link")).setAttribute("rel","stylesheet"),s.setAttribute("type","text/css"),s.setAttribute("href",e),s.setAttribute("route",n)),void 0!==s)document.getElementsByTagName(a)[0].appendChild(s),s.onload=function(){o(!0)};else{var c=new CustomEvent("loaderror",{detail:i});document.dispatchEvent(c),r("load Error")}}))},removeJsCss:function(e,t){var a="text/javascript"==t?"script":"text/css"==t?"link":"none",n="text/javascript"==t?"src":"text/css"==t?"href":"none",o=document.getElementsByTagName(a);for(let t=o.length;t>=0;t--)o[t]&&null!=o[t].getAttribute(n)&&-1!=o[t].getAttribute(n).indexOf(e)&&o[t].parentNode.removeChild(o[t])},generateDeviceID:function(){var e=window.navigator,t=new Date,a=window.screen,n=e.mimeTypes.length;return n+=e.userAgent.replace(/\D+/g,""),n+=e.plugins.length,n+=a.height||"",n+=a.width||"",n+=a.pixelDepth||"",n+=t.getTime()||"",n+=window.performance.now()||""},getBrowserName:function(){var e=navigator.userAgent;return e.indexOf("Firefox")>-1?"mozilla":e.indexOf("SamsungBrowser")>-1?"Samsung_Internet":e.indexOf("Opera")>-1||e.indexOf("OPR")>-1?"opera":e.indexOf("Trident")>-1?"internet_explorer":e.indexOf("Edge")>-1?"edge":e.indexOf("Chrome")>-1?"chrome":e.indexOf("Safari")>-1?"safari":"unknown"}},fetch={getHtml:function(e,t,a,n=null){crossplat.loadFile("./app/views/render/"+t+".html",(function(t){if(t){var o=$("<div>");$("body").append(o),$(o).append(t);var r=$(a).html(),s=Handlebars.compile(r)(n);$(o).remove(),e(null,s)}else e(t)}))},replaceHtml:function(e,t,a,n,o=null){fetch.getHtml((function(t,a){t?e(t):$(n).length?($("#loader").fadeIn("slow",(function(){$(this).addClass("loader")})),$(n).html(a).promise().done((function(){fetch.loadhref(),e()}))):console.error(n+"does not exist")}),t,a,o)},appendHtml:function(e,t,a,n,o=null){fetch.getHtml((function(t,a){t?e(t):$(n).length?$(n).append(a).promise().done((function(){fetch.loadhref(),e()})):console.error(n+"does not exist")}),t,a,o)},prependHtml:function(e,t,a,n,o=null){fetch.getHtml((function(t,a){t?e(t):$(n).length?$(n).prepend(a).promise().done((function(){fetch.loadhref(),e()})):console.error(n+"does not exist")}),t,a,o)},loadhref:function(){$("a").each((function(e,t){$(t)[0].hasAttribute("data-href")&&$(t).attr("href","#"+window.urls.get($(t).attr("data-href")))})),$("img").each((function(e,t){$(t)[0].hasAttribute("data-href")&&$(t).attr("src",window.urls.get($(t).attr("data-href")))}))},apiCall:function(e,t,a,n=null,o=null,r=null){$.ajax({type:a,data:o,url:t,dataType:n,success:function(t,a,n){e(t,a,n)},error:function(t,a,n){e(t,a,n)}})},addLoader:function(e){$(e).addClass("loader")},removeLoader:function(e){$(e).removeClass("loader")}},urls={get:function(e){return crossplat.app.urls[e]}},router={page:"",clearEvents:function(){$(document).off("click").off("dblclick").off("mouseenter").off("mouseleave").off("keypress").off("keydown").off("keyup").off("submit").off("change").off("focus").off("blur").off("load").off("resize").off("scroll").off("unload")},getRoutesByUri:function(e,t){let a,n;for(let o in crossplat.app.packages){a=crossplat.app.packages[o];for(let o in a.routes){if(n=a.routes[o],n.uri===e){t(n);break}router.checkDataUri(n.uri,e,(function(e){if(null!=e&&t(n,e),!1===e){var a=new CustomEvent("loaderror",{detail:details});document.dispatchEvent(a)}}))}}},checkDataUri:function(e,t,a){if(void 0!==e)if(e.split("/").length===t.split("/").length){if(real_route=e.split("{")[0],!t.indexOf(real_route)){var n=[],o=new RegExp("{(.*?)}","gm");real_var=e.match(o),real_data=t.split(real_route)[1].split("/");for(let e in real_var)if(variables=real_var[e],key=variables.slice(1,-1),n[key]=real_data[e],e==real_var.length-1){a(n);break}}}else a(null);else a(!1)},navigateUri:function(e){console.log("uri",e),router.getRoutesByUri(e,(function(e,t){if(e.middlewares&&e.middlewares.length>0){var a=!1,n=[];let o,r=0;for(let s in e.middlewares){o=e.middlewares[s];try{window[crossplat.app.middlewares[o]]((function(s,i){r++,i&&(n[o]=i),a=s,r==Object.keys(e.middlewares).length&&(a?router.page!=e.name?router.loadPage(e,t,n,!0):router.loadPage(e,t,n,!1):document.dispatchEvent(new CustomEvent("page_error")))}))}catch(e){document.dispatchEvent(new CustomEvent("page_error"))}}}else router.page!=e.name?router.loadPage(e,t,null,!0):router.loadPage(e,t,null,!1)}))},loadPage:function(e,t=null,a=null,n=!0){if(n)router.clearEvents(),resources.loadResources(e).then((()=>{setTimeout((()=>{window.eval(window.eval(e.package)[e.method]((function(){resources.removeResources((function(){router.page=e.name,document.getElementsByTagName("BODY")[0].setAttribute("app",e.name)}))}),t,a))}),100)})).catch((e=>{e instanceof TypeError&&document.dispatchEvent(new CustomEvent("filenotfound"))}));else try{window.eval(window.eval(e.package)[e.method]((function(){router.page=e.name,document.getElementsByTagName("BODY")[0].setAttribute("app",e.name)}),t))}catch(e){e instanceof TypeError&&document.dispatchEvent(new CustomEvent("filenotfound"))}}},resources={loadResources:function(e){return new Promise(((t,a)=>{try{crossplat.loadJsCss(`./app/packages/${e.package}/${e.name}/build.js`,"text/javascript","head",e.name).then((()=>{crossplat.loadJsCss(`./app/packages/${e.package}/${e.name}/build.css`,"text/css","head",e.name).then((()=>{t()})).catch((e=>{a(e)}))})).catch((e=>{a(e)}))}catch(e){a(e)}}))},removeResources:function(e){route=document.getElementsByTagName("BODY")[0].getAttribute("app"),null!=route&&($("script[route="+route+"]").remove(),$("link[route="+route+"]").remove()),e()}};document.addEventListener("deviceready",(function(){try{const e=require("node-machine-id");crossplat.device.platform="desktop",crossplat.device.uuid=e.machineIdSync(),crossplat.device.model=crossplat.getBrowserName(),crossplat.device.agent=navigator.userAgent}catch(e){crossplat.device=device,crossplat.device.agent=navigator.userAgent,crossplat.device.model=crossplat.getBrowserName(),device.uuid||(console.log("generating device id from generatedeviceID"),crossplat.device.uuid=crossplat.generateDeviceID())}crossplat.loadJsCss("./app/assets/js/build.js","text/javascript","head","base").then((()=>{crossplat.loadJsCss("./app/assets/css/build.css","text/css","head","base").then((()=>{crossplat.initialize((function(){app.init((function(){app.start()}))}))})).catch((e=>{console.log(e)}))})).catch((e=>{console.log(e)}))}),!1),window.addEventListener("hashchange",app.change,!1);