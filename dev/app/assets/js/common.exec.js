var commonExecutables = function () {
    console.log("inside common executables")
    //scroll  test
    if ($('.main').length > 0) {
        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
            //console.log("scroll initiated for main class")
            // appScroll.scrollBar('.main');
        }
    }

    // if ($('.modal-popup-content').length > 0) {
    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //         //console.log("scroll initiated for modal pop-up class")
    //         if ($('.modal-popup-content').parents('.custom-modal-popup').attr('id') == "alert-customer-identifier-reassign-confirm-cancel") {
    //             //console.log("no in")
    //         } else {
    //             appScroll.scrollBar('.modal-popup-content');
    //         }
    //     }
    // }

    /***********************************************************
     * Theme Chooser
     */
    const toggleSwitch = $('.theme-switch input[type="checkbox"]');
    const currentTheme = localStorage.getItem('theme');
    if (currentTheme && toggleSwitch) {
        if (currentTheme === 'on') {
            $(toggleSwitch).prop('checked', true);
        }
    }

    // if (toggleSwitch) {
    //     function switchTheme(e) {
    //         if (e.target.checked) {
    //             document.documentElement.setAttribute('data-darkmode', 'on');
    //             document.documentElement.classList.add('translate');
    //             localStorage.setItem('theme', 'on');
    //         }
    //         else {
    //             document.documentElement.setAttribute('data-darkmode', 'off');
    //             document.documentElement.classList.remove('translate');
    //             localStorage.setItem('theme', 'off');
    //         }
    //     }

    //     $(toggleSwitch).on('change', switchTheme);
    // }
    // if (window.location.href) {
    //     var hashlocation = window.location.href.substring(5).split('/')[3];
    //     if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    //         //   img.style.filter="invert(100%)";
    //         $('.theme-switch-wrapper').addClass('disable');
    //     } else {
    //         $('.theme-switch-wrapper').removeClass('disable');
    //     }
    // }
    // window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
    //     if (event.matches) {
    //         $('.theme-switch-wrapper').addClass('disable');
    //         $('#darkmode-checkbox').prop('checked', false);
    //         $('html').attr('data-darkmode', "off")
    //     } else {
    //         //light mode
    //         $('.theme-switch-wrapper').removeClass('disable');
    //     }
    // });

    //NEW CODE THEME//
    $(document).on('change', '.theme-switch input[type="checkbox"]', function (e) {
        e.stopPropagation();
        addLoader();
        var $this = $(this);
        if ($($this).is(':checked')) {//on-->dark mode
            var reqParams = {
                device_id: crossplat.device.uuid,
                account_id: sessionStorage.getItem('account_id'),
                theme: "on",
                platform: crossplat.device.platform,
                app: "digibiz",
                role: "bizadmin",
                business_id: sessionStorage.getItem('business_id'),
                owner: {
                    id: sessionStorage.getItem('account_id'),
                    type: "individual"
                }
            }
            addTheme(reqParams)
                .then((response) => {
                    //console.log("add theme response", response);
                    localStorage.setItem('theme', "on");
                    document.documentElement.setAttribute('data-darkmode', "on");
                    document.documentElement.classList.add('translate');
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("err in add theme", err)
                })
        } else {//off-->light mode
            var reqParams = {
                device_id: crossplat.device.uuid,
                delete_by: "digibiz",
                platform: crossplat.device.platform,
                owner: {
                    id: sessionStorage.getItem('account_id'),
                    type: "individual"
                },
                business_id: sessionStorage.getItem('business_id')
            }
            deleteTheme(reqParams)
                .then((response) => {
                    //console.log("delete theme response", response);
                    localStorage.setItem('theme', "off");
                    document.documentElement.setAttribute('data-darkmode', "off");
                    document.documentElement.classList.add('translate');
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("err in delete theme", err)
                })
        }
    });

    // custom dropdown
    $(document).on('click', '.wrapper-dropdown', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        //console.log("12", $($this))
        $($this).toggleClass('active').parent('div').siblings().find('.wrapper-dropdown').removeClass('active');
        // $($this).parents('.filter-log-row').siblings().find('.wrapper-dropdown').removeClass('active') && $($this).parents('.logs-filter-wrapper').siblings().find('.wrapper-dropdown').removeClass('active');
    });

    //category dropdown option
    // $(document).on('click', '.wrapper-dropdown .custom-dropdown li', function () {
    //     if ($('body').attr('app') != "digibiz_logs") {
    //     if ($(this).attr('data-value')) {
    //         $(this).parents(".custom-dropdown").siblings(".selected-dropdown").text($(this).text()).removeClass('disabled');
    //         $(this).parents(".custom-dropdown").siblings(".selected-dropdown").attr('data-value', $(this).attr('data-value'));
    //         $(this).hasClass('disabled') ? $(this).parents(".custom-dropdown").siblings(".selected-dropdown").addClass('disabled') : $(this).parents(".custom-dropdown").siblings(".selected-dropdown").removeClass('disabled');
    //     }
    //     if ($(this).attr('data-id')) {
    //         $(this).parents(".custom-dropdown").siblings(".selected-dropdown").attr('data-id', $(this).attr('data-id'));
    //     }
    //     if ($(this).parents(".custom-dropdown").siblings('.selected-dropdown').attr('data-value')) {
    //         removeError('.selected-dropdown');
    //     }
    // }
    // });

    $(document).on('click', '.menu-toggle', function (e) {
        //console.log("111");
        addLoader();
        e.stopImmediatePropagation();
        let menu_id = $(this).attr('data-id');
        if (menu_id == "profile-menu-toggle") {
            //check role
            // if (sessionStorage.getItem('digibiz_role') == "employee") {
            //     if (sessionStorage.getItem('employee_id') && sessionStorage.getItem('business_id')) {
            //         var requestParam = {
            //             device_id: crossplat.device.uuid,
            //             id: sessionStorage.getItem('business_id')
            //         }
            //         businessGet(requestParam)
            //             .then((response) => {
            //                 // //console.log("businessGet response", response);
            //                 $(`.business-metadata`).find('.header-name span').text(response.name);
            //                 if (response.hasOwnProperty('display_picture') && response.display_picture) {
            //                     if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
            //                         var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
            //                         $(`.business-metadata`).find('img').attr('src', avtarUrl);
            //                     } else {
            //                         var ImageLetter = result.name.charAt(0);
            //                         $(`.business-metadata`).find('.table-profile-text').find('span').text(ImageLetter);

            //                     }
            //                 }
            //                 var reqParam = {
            //                     device_id: crossplat.device.uuid,
            //                     get_by: "id",
            //                     id: sessionStorage.getItem('employee_id'),
            //                 }
            //                 employeeGet(reqParam)
            //                     .then((result) => {
            //                         // //console.log("employeeGet", result);
            //                         $(`.profile-metadata.employee-customer`).find('.header-name span').text(`${result.name.first} ${result.name.last}`);
            //                         $(`.profile-metadata.employee-customer`).find('.mobile_number').text(result.mobile_number);
            //                         $(`.profile-metadata.employee-customer`).find('.unique_name').text(result.dj_unique_employee_name);
            //                         if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
            //                             if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
            //                                 // //console.log("gotttttt employee identity picture")
            //                                 var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
            //                                 $(`.profile-metadata.employee-customer`).find('img').attr('src', avtarUrl);
            //                             } else {
            //                                 var ImageLetter = result.name.charAt(0);
            //                                 $(`.profile-metadata.employee-customer`).find('.table-profile-text').find('span').text(ImageLetter);

            //                             }
            //                         }
            //                         if (result.hasOwnProperty('display_name') && result.display_name) {
            //                             $('.profile-metadata.employee-customer').find('.header-name span').text(result.display_name)
            //                         }
            //                         $(`.profile-metadata.employee-customer`).find('.table-profile-text').find('span').removeClass('hide');
            //                         $(`.business-metadata`).find('.table-profile-text').find('span').removeClass('hide');
            //                         $('.business-metadata').removeClass('hide');
            //                         $('.profile-metadata.employee-customer').removeClass('hide');
            //                         $('.profile-metadata.employee-customer').siblings('.qr_code_wrap').removeClass('hide');
            //                         $('.profile-metadata.individual').addClass('hide');
            //                         $('.business_profile_slider_btn').parent().removeClass('hide');
            //                         $('.employee_profile_slider_btn').parent().removeClass('hide');
            //                         $('.bizadmin-business-list-page').parent().addClass('hide');
            //                         if ($('#' + menu_id).hasClass('active')) {
            //                             $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
            //                             $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
            //                             removeLoader();
            //                             return false
            //                         } else {
            //                             $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
            //                             $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
            //                             removeLoader();
            //                             return false;
            //                         }
            //                     })
            //                     .catch((err) => {
            //                         // //console.log("Error in getting employee");
            //                         Materialize.toast(`Error in getting employee.`, 3000, "round error-alert");
            //                         removeLoader();
            //                     })
            //             })
            //             .catch((err) => {
            //                 // //console.log("Error in getting business");
            //                 Materialize.toast(`Error in getting business.`, 3000, "round error-alert");
            //                 removeLoader();
            //             })
            //     } else {
            //         $('.business-metadata').addClass('hide');
            //         $('.profile-metadata.employee-customer').addClass('hide');
            //         $('.profile-metadata.individual').removeClass('hide');
            //         $('.profile-metadata.individual').siblings('.qr_code_wrap').addClass('hide');
            //         $('.business_profile_slider_btn').parent().addClass('hide');
            //         $('.employee_profile_slider_btn').parent().addClass('hide');
            //         $('.bizadmin-business-list-page').parent().addClass('hide');
            //         if ($('#' + menu_id).hasClass('active')) {
            //             $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
            //             $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
            //             removeLoader();
            //             return false
            //         } else {
            //             $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
            //             $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
            //             removeLoader();
            //             return false;
            //         }
            //     }
            // } else
            //     if (sessionStorage.getItem('digibiz_role') == "customer") {
            //         if (sessionStorage.getItem('customer_id') && sessionStorage.getItem('business_id')) {
            //             $('.business-metadata').addClass('hide');
            //             $('.profile-metadata.employee-customer').addClass('hide');
            //             $('.profile-metadata.individual').removeClass('hide');
            //             $('.business_profile_slider_btn').parent().removeClass('hide');
            //             $('.customer_profile_slider_btn').parent().removeClass('hide');
            //             $('.bizadmin-business-list-page').parent().addClass('hide');
            //             if ($('#' + menu_id).hasClass('active')) {
            //                 $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
            //                 $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
            //                 removeLoader();
            //                 return false
            //             } else {
            //                 $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
            //                 $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
            //                 removeLoader();
            //                 return false;
            //             }
            //         } else {
            //             $('.business-metadata').addClass('hide');
            //             $('.profile-metadata.employee-customer').addClass('hide');
            //             $('.profile-metadata.individual').removeClass('hide');
            //             $('.business_profile_slider_btn').parent().addClass('hide');
            //             $('.employee_profile_slider_btn').parent().addClass('hide');
            //             $('.bizadmin-business-list-page').parent().addClass('hide');
            //             if ($('#' + menu_id).hasClass('active')) {
            //                 $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
            //                 $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
            //                 removeLoader();
            //                 return false
            //             } else {
            //                 $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
            //                 $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
            //                 removeLoader();
            //                 return false;
            //             }
            //         }
            //     } else
            //         if (sessionStorage.getItem('digibiz_role') == "prospect") {
            //             $('.business-metadata').addClass('hide');
            //             $('.profile-metadata.employee-customer').addClass('hide');
            //             $('.profile-metadata.individual').removeClass('hide');
            //             $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').removeClass('hide');
            //             $('.profile-metadata.individual').siblings('.qr_code_wrap').removeClass('hide');
            //             $('.business_profile_slider_btn').parent().addClass('hide');
            //             $('.employee_profile_slider_btn').parent().addClass('hide');
            //             $('.bizadmin-business-list-page').parent().addClass('hide');
            //             if ($('#' + menu_id).hasClass('active')) {
            //                 $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
            //                 $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
            //                 removeLoader();
            //                 return false
            //             } else {
            //                 $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
            //                 $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
            //                 removeLoader();
            //                 return false;
            //             }
            //         } else {
            $('.business-metadata').addClass('hide');
            $('.profile-metadata.employee-customer').addClass('hide');
            $('.profile-metadata.individual').removeClass('hide');
            $('.business_profile_slider_btn').parent().addClass('hide');
            $('.employee_profile_slider_btn').parent().addClass('hide');
            $('.bizadmin-business-list-page').parent().removeClass('hide');
            $('.theme-switch-wrapper').removeClass('hide');
            // //console.log("check role", $('body').attr('app'))
            if ($('body').attr('app') == "landing_page") {
                // //console.log("it is landing page")
                $('.profile-metadata.individual').siblings('.qr_code_wrap').removeClass('hide');
                $('.digibiz_account_storage_btn').parents('.top-notify-icon').removeClass('hide');
                // $('.digibiz_account_settings_btn').parents('.top-notify-icon').removeClass('hide');
                $('.digibiz-account-delete').parents('.top-notify-icon').removeClass('hide');
                $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').addClass('hide');
                $('.digibiz_business_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-notification-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-notification-logs').parents('.top-notify-icon').addClass('hide');
                $('.business_profile_slider_btn').parents('.top-notify-icon').addClass('hide');
                $('.employee_profile_slider_btn').parents('.top-notify-icon').addClass('hide');
                $('.customer_profile_slider_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-owner-role-logs').parents('.top-notify-icon').addClass('hide');
            } else if ($('body').attr('app') == "business_management") {
                //hide qr code
                $('.profile-metadata.individual').siblings('.qr_code_wrap').addClass('hide');
                $('.digibiz_account_storage_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-delete').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').addClass('hide');
                // $('.digibiz_account_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-notification-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-notification-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-owner-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-app-hub-logs').parents('.top-notify-icon').removeClass('hide');
                //show business settings button if super-admin
                var getType = $('.view-business-land-page-icons-container').attr('data-type');
                //console.log("getType", getType);
                if (getType == "super_admin") {
                    $('.digibiz_business_settings_btn').parents('.top-notify-icon').removeClass('hide');
                }
            } else if ($('body').attr('app') == "digibiz_notifications") {
                $('.profile-metadata.individual').siblings('.qr_code_wrap').addClass('hide');
                $('.digibiz_account_storage_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-delete').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').addClass('hide');
                // $('.digibiz_account_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz_business_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-notification-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-notification-role-logs').parents('.top-notify-icon').removeClass('hide');
                $('.digibiz-business-owner-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-app-hub-logs').parents('.top-notify-icon').addClass('hide');
            } else if ($('body').attr('app') == "business_notifications") {
                $('.profile-metadata.individual').siblings('.qr_code_wrap').addClass('hide');
                $('.digibiz_account_storage_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-delete').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').addClass('hide');
                // $('.digibiz_account_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz_business_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-notification-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-owner-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-app-hub-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-notification-logs').parents('.top-notify-icon').removeClass('hide');
            } else if ($('body').attr('app') == "business_admin_business_list") {
                $('.profile-metadata.individual').siblings('.qr_code_wrap').addClass('hide');
                $('.digibiz_account_storage_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-delete').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').addClass('hide');
                // $('.digibiz_account_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz_business_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-notification-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-owner-role-logs').parents('.top-notify-icon').removeClass('hide');
                $('.digibiz-business-notification-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-app-hub-logs').parents('.top-notify-icon').addClass('hide');
            } else if ($('body').attr('app') == "business_add" || $('body').attr('app') == "business_edit") {
                $('.theme-switch-wrapper').addClass('hide');
            } else {
                //console.log("1234567")
                $('.profile-metadata.individual').siblings('.qr_code_wrap').addClass('hide');
                $('.digibiz_account_storage_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-delete').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-account-active-inactive-settings').parents('.top-notify-icon').addClass('hide');
                // $('.digibiz_account_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz_business_settings_btn').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-notification-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-owner-role-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-app-hub-logs').parents('.top-notify-icon').addClass('hide');
                $('.digibiz-business-notification-logs').parents('.top-notify-icon').addClass('hide');
            }
            if ($('#' + menu_id).hasClass('active')) {
                $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
                $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
                removeLoader();
                return false
            } else {
                $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
                $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
                removeLoader();
                return false;
            }
            // }
        } else {
            if ($('#' + menu_id).hasClass('active')) {
                $('#' + menu_id).removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
                $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
                removeLoader();
                return false
            } else {
                $('#' + menu_id).addClass('active').css({ 'transform': 'translate3d(0,0,0)' });
                $('div.menu-overlay').animate({ 'opacity': '1' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'visible', 'z-index': '997' }) });
                removeLoader();
                return false;
            }
        }
    });

    $(document).on("click", function (event) {
        var $trigger = $('.menu-toggle, .slide-bar, .sidebar_left');
        var $customMenu = $('.wrapper-dropdown');
        var $titleBg = $('.popup-background-container, .background-image');
        var $starrating = $('.survey-comment-reply-star');
        var $actionsheetClose = $(".action-sheet-container");
        if ($(".action-sheet-container").hasClass('slide-top')) {
            if ($actionsheetClose !== event.target && !$actionsheetClose.has(event.target).length) { }
            $(".action-sheet-container").removeClass('slide-top').addClass('slide-bottom').remove();
        }
        if ($('.slide-bar, .sidebar_left').hasClass('active')) {
            if ($trigger !== event.target && !$trigger.has(event.target).length) {
                // //console.log("222");
                $('.menu-section').removeClass('active').css({ 'transform': 'translate3d(100%,0,0)' });
                $('div.menu-overlay').animate({ 'opacity': '0' }, 200, function () { $('div.menu-overlay').css({ 'visibility': 'hidden', 'z-index': '' }) });
            }
        }
        if ($($customMenu).hasClass('active')) {
            if ($customMenu !== event.target && !$customMenu.has(event.target).length) {
                $($customMenu).removeClass('active');
            }
        }
        if ($('.popup-background-container').hasClass('active')) {
            if ($titleBg !== event.target && !$titleBg.has(event.target).length) {
                $('.popup-background-container').removeClass('active');
                $('.background-selection').children().remove();
            }
        }
        if ($('.rating').hasClass('active')) {
            if ($starrating !== event.target && !$starrating.has(event.target).length) {
                $('.rating').removeClass('active');
            }
        }
    });

    /**
     * file viewer back event
     */
    $(document).on('click', '.file-viewer-back-btn', function () {
        $('.asset-viewer-container').removeClass('modal-slide-top').addClass('modal-slide-bottom');
        setTimeout(function () {
            $('.asset-viewer-container').remove();
        }, 100);
    });

    $(document).on('click', '.accordion-title', function (e) {
        var accordionitem = $(this).attr("data-tab");
        $("#" + accordionitem).slideToggle().parent().siblings().find(".accordion-content").slideUp();

        $(this).toggleClass("active-title");
        $("#" + accordionitem).parent().siblings().find(".accordion-title").removeClass("active-title");

        //check uncheck
        //console.log("accordionitem", accordionitem)
        $.each(digibiz.customerSelectedContactList, function (index, elem) {
            if (elem.contact_item_id == accordionitem) {
                $(`.accordion-content[id="${elem.contact_item_id}"]`).find(`.customer-group-contact-select-btn[data-id="${elem.id}"]`).attr("checked", "checked");
            }
        })
        $.each(digibiz.employeeSelectedContactList, function (index, elem) {
            //console.log("elem", elem);
            // if (elem.contact_item_id == accordionitem) {
            $(`.accordion-content[data-group-id="${elem.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${elem.id}"]`).attr("checked", "checked");
            // }
        })
        // $("span.material-icons").text("expand_more");
        // $("#"+accordionitem).parent().siblings().find(".accordion-title span.material-icons").text("expand_less");
    });

    $(document).on('click', '.accordion-titleee', function (e) {
        addLoader();
        var accordionitem = $(this).attr("data-tab");
        sessionStorage.removeItem('accordion_item');
        sessionStorage.setItem('accordion_item', accordionitem);
        var getType = $(this).attr('data-type');
        if (getType == "identifier") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "customer",
                list_by: "primary_customer_identifier",
                primary_customer_identifier_id: accordionitem
            }
            listContactsList(reqParam)
                .then((response) => {
                    //console.log("listContactsList response", response);
                    processCommunicationGroupContactListCustomerContactItemsList(response, accordionitem, function () {
                        setTimeout(function () {
                            // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                            removeLoader();
                            $("#" + accordionitem).slideToggle().parent().siblings().find(".accordion-contenttt").slideUp();
                            // if(!$(this).siblings('.accordion-contenttt').is('os-host')) {
                            //     console.log()
                            //     appScroll.scrollBar(".accordion-contenttt");
                            // } else {
                            //     appScroll.scrollBar(".accordion-contenttt").destroy();
                            // }

                            $(this).toggleClass("active-title");
                            $("#" + accordionitem).parent().siblings().find(".accordion-titleee").removeClass("active-title");
                        }, 0);
                    });
                })
                .catch((err) => {
                    removeLoader();
                    $("#" + accordionitem).slideToggle().parent().siblings().find(".accordion-contenttt").slideUp();

                    $(this).toggleClass("active-title");
                    $("#" + accordionitem).parent().siblings().find(".accordion-titleee").removeClass("active-title");
                })
        } else if (getType == "contact_item") {
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: accordionitem,
                count: 5,
                offset: 0
            }
            getContactList(reqParams)
                .then((response) => {
                    //console.log("getContactList response", response);
                    digibiz.communication_group_contact_list_customer_list_level_three_data = response;
                    processCommunicationGroupContactListCustomerContactsList(response, accordionitem, function () {
                        appScroll.scrollBar(".accordion-contenttt");
                        setTimeout(function () {
                            listenForCommunicationGroupContactListCustomerContactsListScrollEvent($(".accordion-contenttt"));
                            removeLoader();
                            $("#" + accordionitem).slideToggle().parent().siblings().find(".accordion-contenttt").slideUp();

                            $(this).toggleClass("active-title");
                            $("#" + accordionitem).parent().siblings().find(".accordion-titleee").removeClass("active-title");
                        }, 0);
                    });
                })
                .catch((err) => {
                    removeLoader();
                    $("#" + accordionitem).slideToggle().parent().siblings().find(".accordion-contenttt").slideUp();

                    $(this).toggleClass("active-title");
                    $("#" + accordionitem).parent().siblings().find(".accordion-titleee").removeClass("active-title");
                })
        }
    });

    //digibiz-back-button
    $(document).on('click', '.view-digibiz-back-button', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.removeItem('group_id');
        var current_url = location.href.split('#').pop();
        console.log('current_url', current_url);
        if (current_url && current_url.includes('employee_filter')) {
            location.hash = `employee_creation/list`;
        } else if (current_url && current_url.includes('business_display_control')) {
            location.hash = `business/profile/management`;
        } else if (current_url && current_url.includes('employee/configurations')) {
            location.hash = `employee/management/hub`;
        } else if (current_url && current_url.includes('business/profile/management')) {
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('customer/profile')) {
            if (sessionStorage.getItem('digibiz_role') == "employee") {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('employee_id');
                location.hash = `employee/business/list`;
            } else if (sessionStorage.getItem('digibiz_role') == "customer" || sessionStorage.getItem('digibiz_role') == "associate_customer") {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('customer_id');
                sessionStorage.removeItem('customer_type');
                location.hash = `customer/business/list`;
            }
        } else if (current_url && current_url.includes('employee/profile')) {
            if (sessionStorage.getItem('digibiz_role') == "employee") {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('employee_id');
                location.hash = `employee/business/list`;
            } else if (sessionStorage.getItem('digibiz_role') == "customer" || sessionStorage.getItem('digibiz_role') == "associate_customer") {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('customer_id');
                sessionStorage.removeItem('customer_type');
                location.hash = `customer/business/list`;
            }
        } else if (current_url && current_url.includes('business/profile')) {
            if (sessionStorage.getItem('digibiz_role') == "employee") {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('employee_id');
                location.hash = `employee/business/list`;
            } else if (sessionStorage.getItem('digibiz_role') == "customer" || sessionStorage.getItem('digibiz_role') == "associate_customer") {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('customer_id');
                sessionStorage.removeItem('customer_type');
                location.hash = `customer/business/list`;
            }
        } else if (current_url && current_url.includes('prospect/settings')) {
            // location.hash = `prospect/app/hub`;
            location.hash = `jeevi/app/hub`;
            console.log('fwefwef');
        } else if (current_url && current_url.includes('digibiz/business/settings')) {
            sessionStorage.removeItem('selected-business-settings-tab');
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('module_admin/list')) {
            sessionStorage.removeItem('module_type');
            location.hash = `module_admin/management`;
        } else if (current_url && current_url.includes('business_owner/business/list') || current_url && current_url.includes('employee/business/list') || current_url && current_url.includes('customer/business/list')) {
            //oldddddd code
            // $(this).addClass('hide');
            // sessionStorage.removeItem('digibiz_role');
            // location.hash = `land/page`;

            //newwww code
            $(this).addClass('hide');
            sessionStorage.removeItem('digibiz_role');
            sessionStorage.clear();
            setTimeout(function () {
                deviceHelper.navigateToAccounts('core');
            }, 1000);
        } else if (current_url && current_url.includes('business_owner/business/list')) {
            sessionStorage.removeItem('business_id');
            location.hash = `business_owner/business/list`;
        } else if (current_url && current_url.includes('business/management')) {
            sessionStorage.removeItem('business_id');
            sessionStorage.removeItem('business_status');
            sessionStorage.removeItem('business_role');
            sessionStorage.removeItem('business_name');
            sessionStorage.removeItem('business_profile_socket_status');
            $(this).addClass('hide');
            $('.header-heading-name').text('');
            location.hash = `business_owner/business/list`;
        } else if (current_url && current_url.includes('employee/management/hub')) {
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('customer/management/hub')) {
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('digibiz/logs')) {
            if (sessionStorage.getItem('log_type') == "employee") {
                $('.header-heading-name').text('');
                //$('.header-logo').removeClass('hide');
                sessionStorage.removeItem('log_type');
                location.hash = `employee/management/hub`;
            } else if (sessionStorage.getItem('log_type') == "notification_role_page") {
                sessionStorage.removeItem('log_type');
                // location.hash = `digibiz/notifications`;
                location.hash = `digibiz/activity`;
            } else if (sessionStorage.getItem('log_type') == "digibiz_hub_page") {
                sessionStorage.removeItem('log_type');
                // location.hash = `digibiz/notifications`;
                location.hash = `digibiz/activity`;
            } else if (sessionStorage.getItem('log_type') == "digibiz_roles_logs") {
                sessionStorage.removeItem('log_type');
                location.hash = `digibiz/activity`;
            } else if (sessionStorage.getItem('log_type') == "business_notification_page") {
                sessionStorage.removeItem('log_type');
                location.hash = `business/notifications`;
            } else if (sessionStorage.getItem('log_type') == "business_owner_business_list_page") {
                sessionStorage.removeItem('log_type');
                // location.hash = `business_owner/business/list`;
                location.hash = `business_owner/business/list`;
            } else if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
                sessionStorage.removeItem('log_type');
                location.hash = `business/management`;
            } else if (sessionStorage.getItem('log_type') == "jeevi_hub_page") {
                sessionStorage.removeItem('log_type');
                // location.hash = `prospect/settings`;
                location.hash = `digibiz/activity`;
            } else if (sessionStorage.getItem('log_type') == "digibiz_login_logs") {
                sessionStorage.removeItem('log_type');
                // location.hash = `prospect/settings`;
                location.hash = `digibiz/activity`;
            } else if (sessionStorage.getItem('log_type') == "digibiz_business_logs") {
                sessionStorage.removeItem('log_type');
                // location.hash = `prospect/settings`;
                location.hash = `digibiz/activity`;
            } else if (sessionStorage.getItem('log_type') == "app_permission_logs") {
                sessionStorage.removeItem('log_type');
                location.hash = `business/app_permission/settings`;
            } else if (sessionStorage.getItem('log_type') == "contact_control_logs") {
                sessionStorage.removeItem('log_type');
                location.hash = `employee/controls`;
            } else if (sessionStorage.getItem('log_type') == "customer_control_logs") {
                sessionStorage.removeItem('log_type');
                location.hash = `employee/controls`;
            } else if (sessionStorage.getItem('log_type') == "trusted_control_logs") {
                sessionStorage.removeItem('log_type');
                location.hash = `employee/controls`;
            } else if (sessionStorage.getItem('log_type') == "communication_group_logs") {
                sessionStorage.removeItem('log_type');
                // location.hash = `prospect/settings`;
                location.hash = `communication/groups`;
            } else if (sessionStorage.getItem('log_type') == "collaborator_group_logs") {
                sessionStorage.removeItem('log_type');
                // location.hash = `prospect/settings`;
                location.hash = `collaborator/hub`;
            } else if (sessionStorage.getItem('log_type') == "member_collaborator_group_logs") {
                sessionStorage.removeItem('log_type');
                // location.hash = `prospect/settings`;
                location.hash = `collaborator/hub`;
            } else {
                sessionStorage.removeItem('log_type');
                location.hash = `business/management`;
            }
        } else if (current_url && current_url.includes('employee/types')) {
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            // location.hash = `employee/management/hub`;
            location.hash = `employee/configurations`;
        } else if (current_url && current_url.includes('employee/category')) {
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            // location.hash = `employee/management/hub`;
            location.hash = `employee/configurations`;
        } else if (current_url && current_url.includes('employee/designation')) {
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            // location.hash = `employee/management/hub`;
            location.hash = `employee/configurations`;
        } else if (current_url && current_url.includes('employee/access/list')) {
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `employee/management/hub`;
        } else if (current_url && current_url.includes('employee_creation/list')) {
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            sessionStorage.removeItem('selected-employee-tab');
            location.hash = `employee/management/hub`;
        } else if (current_url && current_url.includes('employee/business/apps/hub')) {
            sessionStorage.removeItem('business_id');
            sessionStorage.removeItem('business_name');
            sessionStorage.removeItem('employee_id');
            // location.hash = `employee/business/list`;
            location.hash = `employee/business/list`;
        } else if (current_url && current_url.includes('digibiz/notifications')) {
            // $(this).addClass('hide');
            // sessionStorage.clear();
            // setTimeout(function () {
            //     deviceHelper.navigateToAccounts('core');
            // }, 1000);

            //new code
            $(this).addClass('hide');
            if (sessionStorage.getItem('get_role_btn') == "business-role-btn") {
                location.hash = `business_owner/business/list`;
            } else if (sessionStorage.getItem('get_role_btn') == "employee-role-btn") {
                location.hash = `employee/business/list`;
            } else if (sessionStorage.getItem('get_role_btn') == "customer-role-btn") {
                location.hash = `customer/business/list`;
            } else if (sessionStorage.getItem('get_role_btn') == "jeevi-role-btn") {
                location.hash = `jeevi/app/hub`;
                console.log('fwefwef');
            }
        } else if (current_url && current_url.includes('employee/notification/details')) {
            sessionStorage.removeItem('contact_uuid')
            location.hash = `employee_creation/list`;
        } else if (current_url && current_url.includes('super_admin/notification/details')) {
            sessionStorage.removeItem('contact_uuid')
            location.hash = `super_admin/management/hub`;
        } else if (current_url && current_url.includes('employee_group_creation/list')) {
            sessionStorage.removeItem('selected-employee-group-list-type-tab');
            digibiz.standard_employees_groups_list_page = [];
            digibiz.custom_employees_groups_list_page = [];
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `employee/management/hub`;
        } else if (current_url && current_url.includes('employee_group_creation/list')) {
            // location.hash = `land/page`;
        } else if (current_url && (current_url.includes('customers/identifiers/list') || current_url.includes('customer/access/identifiers'))) {
            sessionStorage.removeItem('selected-customer-identifier-tab');
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `customer/management/hub`;
        } else if (current_url && current_url.includes('customer_creation') && $('body').attr('app') == "customer_creation") {
            sessionStorage.removeItem('selected-tab');
            $('.header-heading-name').text('');
            // location.hash = `customer/management/hub`;
            location.hash = `identifiers_list_customer_creation`;
        } else if (current_url && current_url.includes('identifiers_list_customer_creation') && $('body').attr('app') == "identifiers_list_customer_creation") {
            sessionStorage.removeItem('selected-tab');
            sessionStorage.removeItem('identifier_id')
            $('.header-heading-name').text('');
            location.hash = `customer/management/hub`;
        } else if (current_url && current_url.includes('customer_creation/identifiers/list')) {
            sessionStorage.removeItem('selected-customer-tab');
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `customer/management/hub`;
        } else if (current_url && current_url.includes('customer_creation/active/list')) {
            sessionStorage.removeItem('identifier_id');
            location.hash = `customer_creation`;
            // location.hash = `customer_creation/identifiers/list`;
        } else if (current_url && current_url.includes('customer_creation/pending/list')) {
            sessionStorage.removeItem('identifier_id');
            location.hash = `customer_creation`;
            // location.hash = `customer_creation/identifiers/list`;
        } else if (current_url && current_url.includes('customer/notification/details')) {
            sessionStorage.removeItem('contact_user_id');
            var getActiveTab = sessionStorage.getItem('selected-tab');
            // if (getActiveTab == "customer_active") {
            //     location.hash = `customer_creation/active/list`;
            // } else if (getActiveTab == "customer_pending") {
            //     location.hash = `customer_creation/pending/list`;
            // }
            location.hash = `customer_creation`;
        } else if (current_url && current_url.includes('customer/contacts/groups/identifiers/list')) {
            if (sessionStorage.getItem('customer_module') == "customer_group_list") {
                sessionStorage.removeItem('selected-customer-group-type-tab');
                sessionStorage.removeItem('customer_module');
                $('.header-heading-name').text('');
                //$('.header-logo').removeClass('hide');
                location.hash = `customer/management/hub`;
            } else if (sessionStorage.getItem('customer_module') == "customer_contact_list") {
                sessionStorage.removeItem('selected-customer-group-type-tab');
                sessionStorage.removeItem('customer_module');
                $('.header-heading-name').text('');
                //$('.header-logo').removeClass('hide');
                location.hash = `customer/management/hub`;
            }
        } else if (current_url && current_url.includes('customer/contacts/identifiers/list')) {
            // sessionStorage.removeItem('customer_module');
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `customer/management/hub`;
        } else if (current_url && current_url.includes('customer/groups/identifiers/list')) {
            sessionStorage.removeItem('selected-customer-group-type-tab');
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `customer/management/hub`;
        } else if (current_url && current_url.includes('customer/contacts_items/list')) {
            digibiz.contacts_items_list = [];
            sessionStorage.removeItem('identifier_id');
            location.hash = `customer/contacts/identifiers/list`;
        } else if (current_url && current_url.includes('customer/contact/list')) {
            sessionStorage.removeItem('item_id');
            location.hash = `customer/contacts_items/list`;
        } else if (current_url && current_url.includes('customer/groups/list')) {
            digibiz.groups_list = [];
            digibiz.standard_customer_groups_identifiers_list = [];
            sessionStorage.removeItem('identifier_id');
            location.hash = `customer/groups/identifiers/list`;
        } else if (current_url && current_url.includes('department_management')) {
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            // location.hash = `employee/management/hub`;
            location.hash = `employee/configurations`;
        } else if (current_url && current_url.includes('department/create')) {
            sessionStorage.removeItem('department_id');
            location.hash = `department_management`;
        } else if (current_url && current_url.includes('employee/contact/list')) {
            sessionStorage.removeItem('selected-employee-contact-list-type-tab');
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `employee/management/hub`;
        } else if (current_url && current_url.includes('collaborator/hub')) {
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('business/notifications')) {
            sessionStorage.removeItem('selected-business-notification-tab');
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('collaborator/contact/list')) {
            sessionStorage.removeItem('selected-collaborator-tab');
            $('.header-heading-name').text('');
            //$('.header-logo').removeClass('hide');
            location.hash = `collaborator/hub`;
        } else if (current_url && current_url.includes('collaborator/contact_list/notification/details')) {
            sessionStorage.removeItem('collaborator_business_id');
            location.hash = `collaborator/contact/list`;
        } else if (current_url && current_url.includes('collaborator/customer/list')) {
            $('.header-heading-name').text('');
            location.hash = `collaborator/hub`;
        } else if (current_url && current_url.includes('collaborator/groups/list')) {
            sessionStorage.removeItem('selected-collaborator-tab');
            $('.header-heading-name').text('');
            location.hash = `collaborator/hub`;
        } else if (current_url && current_url.includes('collaborator/group/create')) {
            sessionStorage.removeItem('group_id');
            location.hash = `collaborator/groups/list`;
        } else if (current_url && current_url.includes('communication/groups')) {
            sessionStorage.removeItem('group_id');
            // if (sessionStorage.getItem('group_creation_running')) {
            //     Materialize.toast(`Group creation is running in the backgroup.please wait..`, 2000, "round error-alert");
            // } else {
            sessionStorage.removeItem('group_creation_running');
            location.hash = `business/management`;
            // }

        } else if (current_url && current_url.includes('customer/access/identifier/items')) {
            digibiz.customer_access_identifier_items_list = [];
            sessionStorage.removeItem('identifier_id');
            location.hash = `customer/access/identifiers`;
        } else if (current_url && current_url.includes('customer/access/identifier/item/page')) {
            sessionStorage.removeItem('identifier_item_id');
            location.hash = `customer/access/identifier/items`;
        } else if (current_url && current_url.includes('customer/business/apps/hub')) {
            sessionStorage.removeItem('customer_id');
            sessionStorage.removeItem('business_name');
            sessionStorage.removeItem('customer_identifier_id');
            sessionStorage.removeItem('customer_type');
            // location.hash = `customer/business/list`;
            location.hash = `customer/business/list`;
        } else if (current_url && current_url.includes('customer/collaborators')) {
            location.hash = `customer/management/hub`;
        } else if (current_url && current_url.includes('super_admin/management/hub')) {
            sessionStorage.removeItem('selected-super-admin-management-tab');
            location.hash = `digibiz/business/settings`;
        } else if (current_url && current_url.includes('business/settings')) {
            sessionStorage.removeItem('selected-business-settings-tab');
            location.hash = `digibiz/business/settings`;
        } else if (current_url && current_url.includes('module_admin/management')) {
            sessionStorage.removeItem('selected-business-settings-tab');
            location.hash = `digibiz/business/settings`;
            appScroll.scrollBar('#main-content-wrapper').destroy();
        } else if (current_url && current_url.includes('business/storage')) {
            // location.hash = `digibiz/business/settings`;
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                selected: true,
                id: sessionStorage.getItem('business_id'),
                type: "business"
            }
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    sessionStorage.removeItem('successCode');
                    sessionStorage.removeItem('authErrorCode');
                    sessionStorage.removeItem('business_storage_token');
                    location.hash = `business/management`;
                } else {
                    // sessionStorage.removeItem('successCode');
                    // sessionStorage.removeItem('authErrorCode');
                    // sessionStorage.removeItem('business_id');
                    // sessionStorage.removeItem('business_name');
                    // sessionStorage.removeItem('business_storage_token');
                    // location.hash = `business_owner/business/list`;
                    getBusinessStoragePage()
                }
            }, api.check_token, "POST", "JSON", requestParams);
            // if (sessionStorage.getItem('business_storage_token') && JSON.parse(sessionStorage.getItem('business_storage_token')).tokenStatus == 'inactive') {
            //     sessionStorage.removeItem('business_id');
            //     sessionStorage.removeItem('business_name');
            //     sessionStorage.removeItem('business_storage_token');
            //     location.hash = `business_owner/business/list`;
            // } else {
            //     location.hash = `business/management`;
            // }
        } else if (current_url && current_url.includes('collaborator/add')) {
            location.hash = `collaborator/contact/list`;
        } else if (current_url && current_url.includes('business/app_permission/settings')) {
            // location.hash = `digibiz/business/settings`;
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('teams/management/hub')) {
            // location.hash = `digibiz/business/settings`;
            location.hash = `business/management`;
        } else if (current_url && current_url.includes('team_group_creation/list')) {
            // location.hash = `digibiz/business/settings`;
            location.hash = `teams/management/hub`;
        } else if (current_url && current_url.includes('employee/controls')) {
            // location.hash = `digibiz/business/settings`;
            location.hash = `employee/management/hub`;
        }
    });

    $(document).on('click', '.digibiz-cancel-button', function () {
        addLoader();
        var current_url = location.href.split('#').pop();
        $(this).addClass('hide');
        if (current_url && current_url.includes('super_admin/management/hub')) {
            sessionStorage.removeItem('selected-super-admin-management-tab');
            // location.hash = `business/management`;
            location.hash = `digibiz/business/settings`;
        } else if (current_url && current_url.includes('business/settings')) {
            sessionStorage.removeItem('selected-business-settings-tab');
            // location.hash = `business/management`;
            location.hash = `digibiz/business/settings`;
        } else if (current_url && current_url.includes('module_admin/management')) {
            sessionStorage.removeItem('selected-business-settings-tab');
            location.hash = `digibiz/business/settings`;
        } else if (current_url && current_url.includes('business/storage')) {
            // location.hash = `business/management`;
            location.hash = `digibiz/business/settings`;
        } else if (current_url && current_url.includes('collaborator/add')) {
            location.hash = `collaborator/contact/list`;
        } else if (current_url && current_url.includes('business/app_permission/settings')) {
            location.hash = `digibiz/business/settings`;
        }
    })


    //account page confirm button
    $(document).on('click', '#digibiz_account_confirm_button', function () {
        addLoader();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "digibiz-term-and-conditions-modal",
            modal_header: "Terms & Conditions",
            modal_body: `<div class="terms-conditions-data">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</div>`,
            modal_action_buttons: [{
                "name": "Register",
                "id": "digibiz_account_register",
            }]
        }
        showModal(modal_data, function () {
            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                if ($('.modal-popup-content').length > 0) {
                    //console.log("scroll initiated for modal pop-up class")
                    appScroll.scrollBar('.modal-popup-content');
                }
            } else {
                $('.custom-modal-popup').show().addClass('modal-slide-top');
                if ($('.modal-popup-content').length > 0) {
                    //console.log("scroll initiated for modal pop-up class")
                    appScroll.scrollBar('.modal-popup-content');
                }
            }
            removeLoader();
        });
    });

    //account cancel button
    $(document).on('click', '#digibiz_account_cancel_button, #digibiz_account_role_update_cancel_button', function () {
        addLoader();
        sessionStorage.clear();
        setTimeout(function () {
            deviceHelper.navigateToAccounts('core');
        }, 1000);
    });


    //account register button
    $(document).on('click', '#digibiz_account_register', function () {
        //console.log("clicked register");
        addLoader();
        sessionStorage.setItem('role', 'prospect');
        var reqParam = {
            device_id: crossplat.device.uuid,
            role: sessionStorage.getItem('role')
        }
        addDigibizAccount(reqParam)
            .then((response) => {
                //olddddd code
                //console.log("addDigibizAccount response", response);
                // $('#digibiz-term-and-conditions-modal').remove();
                // sessionStorage.setItem('account_id', response.id);
                // // location.hash = `land/page`;
                // location.hash = `digibiz/account/storage`;

                //Newwwww code
                //console.log("addDigibizAccount response", response);
                $('#digibiz-term-and-conditions-modal').remove();
                sessionStorage.setItem('account_id', response.id);
                if (sessionStorage.getItem('notify_id')) {
                    acceptNotification();
                } else {
                    if (sessionStorage.getItem('role') == "administrator") {
                        sessionStorage.removeItem('role');
                        // location.hash = `business_owner/business/list`;
                        location.hash = `business_owner/business/list`;
                    } else if (sessionStorage.getItem('role') == "employee") {
                        sessionStorage.removeItem('role');
                        // location.hash = `employee/business/list`;
                        location.hash = `employee/business/list`;
                    } else if (sessionStorage.getItem('role') == "customer") {
                        sessionStorage.removeItem('role');
                        // location.hash = `customer/business/list`;
                        location.hash = `customer/business/list`;
                    } else if (sessionStorage.getItem('role') == "prospect") {
                        sessionStorage.removeItem('role');
                        var requestParameter = {
                            device_id: crossplat.device.uuid,
                            account_id: response.id
                        }
                        addJeeviAccount(requestParameter)
                            .then((result) => {
                                //console.log("setting_digibiz_storage_selection")
                                //console.log("result", result)
                                sessionStorage.setItem('digibiz_storage_selection', 'first');
                                location.hash = `digibiz/account/storage`;
                            })
                            .catch((err) => {
                                //console.log("error in adding jeevi_id")
                            })
                    }
                }
            })
            .catch((err) => {
                //console.log("err");
                removeLoader();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            });
    });

    //account role update
    // //role activate update button    
    $(document).on('click', '#digibiz_account_role_update_confirm_button', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('account_id'),
            role: sessionStorage.getItem('role'),
            status: "active"
        }
        updateDigibizAccount(reqParam)
            .then((response) => {
                console.log("update response", response);
                if (sessionStorage.getItem('notify_id')) {
                    acceptNotification();
                } else {
                    if (sessionStorage.getItem('role') == "administrator") {
                        sessionStorage.removeItem('role');
                        // location.hash = `business_owner/business/list`;
                        location.hash = `business_owner/business/list`;
                    } else if (sessionStorage.getItem('role') == "employee") {
                        sessionStorage.removeItem('role');
                        // location.hash = `employee/business/list`;
                        location.hash = `employee/business/list`;
                    } else if (sessionStorage.getItem('role') == "customer") {
                        sessionStorage.removeItem('role');
                        // location.hash = `customer/business/list`;
                        location.hash = `customer/business/list`;
                    } else if (sessionStorage.getItem('role') == "prospect") {
                        sessionStorage.removeItem('role');
                        var requestParameter = {
                            device_id: crossplat.device.uuid,
                            account_id: response.id
                        }
                        addJeeviAccount(requestParameter)
                            .then((result) => {
                                //console.log("result", result)
                                //console.log("setting_digibiz_storage_selection")
                                if (response.hasOwnProperty('storage') && response.storage) {
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        selected: true,
                                        id: sessionStorage.getItem('account_id'),
                                        type: "individual"
                                    }
                                    fetch.apiCall(function (checkTokenResponse, status, xhr) {
                                        if (status === "success") {
                                            window.sessionStorage.setItem('storage_token', JSON.stringify(checkTokenResponse.Data));
                                            location.reload();
                                            // callback(true);
                                        } else {
                                            if (checkTokenResponse.status == 400) {
                                                window.sessionStorage.setItem('storage_token', JSON.stringify(checkTokenResponse.responseJSON.Data));
                                                location.hash = `digibiz/account/storage`;

                                            } else {
                                                console.log("ERROR CHECK HERE")
                                            }
                                        }
                                    }, api.check_token, "POST", "JSON", requestParams);
                                } else {//no storage
                                    sessionStorage.setItem('digibiz_storage_selection', 'first');
                                    location.hash = `digibiz/account/storage`;
                                }
                                // sessionStorage.setItem('digibiz_storage_selection', 'first');
                                // location.hash = `digibiz/account/storage`;
                            })
                            .catch((err) => {
                                //console.log("error in adding jeevi_id")
                            })
                    }
                }
            })
            .catch((err) => {
                //console.log("err");
                removeLoader();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            });
    });


    //business administrator(landing page)
    $(document).on('click', '.digibiz-app-btn.business_owner', function (e) {
        e.stopPropagation();
        addLoader();
        sessionStorage.setItem('digibiz_role', 'business_owner');
        // location.hash = `business_owner/business/list`;
        location.hash = `business_owner/business/list`;
    });

    //employee(landing page)
    $(document).on('click', '.digibiz-app-btn.employee', function (e) {
        e.stopPropagation();
        addLoader();
        sessionStorage.setItem('digibiz_role', 'employee');
        // location.hash = `employee/business/list`;
        location.hash = `employee/business/list`;
    });

    //customer(landing page)
    $(document).on('click', '.digibiz-app-btn.customer', function (e) {
        e.stopPropagation();
        addLoader();
        sessionStorage.setItem('digibiz_role', 'customer');
        // location.hash = `customer/business/list`;
        location.hash = `customer/business/list`;
    });

    //notification(landing page)
    $(document).on('click', '.digibiz_notifications', function (e) {
        e.stopPropagation();
        addLoader();
        location.hash = `digibiz/notifications`;
    });

    //prospect(landing page)
    $(document).on('click', '.digibiz-app-btn.prospect', function (e) {
        e.stopPropagation();
        addLoader();
        var requestParms = {
            device_id: crossplat.device.uuid,
            uuid: sessionStorage.getItem("uuid"),
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                //console.log("account is present", response.Data);
                if (response.Data.status.status == "active" || response.Data.status.status == "inactive_pending") {
                    sessionStorage.setItem('digibiz_role', 'prospect');
                    // location.hash = `prospect/app/hub`;
                    location.hash = `jeevi/app/hub`;
                    console.log('fwefwef');
                } else {
                    removeLoader();
                    sessionStorage.setItem('account_id', response.Data.id);
                    sessionStorage.setItem('account_status', response.Data.status.status);
                    var alert_parms = {
                        alert_id: "digibiz-account-inactive",
                        alert_platform: crossplat.device.platform,
                        alert_title: "",
                        alert_body: `Your account is inactive.`,
                        alert_btn: [{
                            name: "Activate",
                            attr: [{ name: "id", value: "activate-digibiz-account" }]
                        },
                        {
                            name: "Close",
                            attr: [{ name: "id", value: "close-digibiz-account-inactive" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#digibiz-account-inactive').attr('account_id', response.Data.id)
                        document.querySelector("#activate-digibiz-account").addEventListener("click", function () {
                            var getData = {
                                account_status: response.Data.status.status,
                                account_settings: response.Data.settings
                            }
                            //console.log("getData", getData);
                            fetch.getHtml(function (fetcherror, html) {
                                var modal_data = {
                                    modal_id: "account-inactive-active-settings",
                                    modal_header: "Active/Inactive",
                                    modal_platform: crossplat.device.platform,
                                    modal_body: html,
                                    modal_action_buttons: [{
                                        "name": "Save",
                                        "id": "add-account-inactive-data",
                                    }]
                                }
                                showModal(modal_data, function () {
                                    $('#digibiz-account-inactive').remove();
                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        if ($('.modal-popup-content').length > 0) {
                                            //console.log("scroll initiated for modal pop-up class")
                                            appScroll.scrollBar('.modal-popup-content');
                                        }
                                    } else {
                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                        if ($('.modal-popup-content').length > 0) {
                                            //console.log("scroll initiated for modal pop-up class")
                                            appScroll.scrollBar('.modal-popup-content');
                                        }
                                    }
                                    if (getData.account_status == "inactive" || getData.account_status == "inactive_pending") {
                                        $('.account-inactive-start-end-date-time').removeClass('hide');
                                    }
                                    commonExecutables();
                                    removeLoader();
                                });
                            }, 'page/common/active_inactive_account', '#active_inactive_account-template', getData);
                        });
                        document.querySelector("#close-digibiz-account-inactive").addEventListener("click", function () {
                            $('#digibiz-account-inactive').remove();
                            logoutDigibiz();
                            // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            //     window.location = config.web.digibiz;
                            // } else {
                            setTimeout(function () {
                                deviceHelper.navigateToAccounts('core');
                            }, 1000);
                            // }
                        });
                    });
                }
            } else {
                removeLoader();
                Materialize.toast(`Account not found.`, 3000, "round error-alert");
            }
        }, api.get_account, "POST", "JSON", requestParms);
    });

    //prospect role bizchat
    $(document).on('click', '.prospect-bizchat', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizchat",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizchat");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    //prospect role prospect-bizasset
    $(document).on('click', '.prospect-bizasset', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            // app: "digibiz_assets",
            app: "bizassets",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    // deviceHelper.navigateApp("digibiz_assets");
                    deviceHelper.navigateApp("bizassets");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    //prospect-bizpal sco
    $(document).on('click', '.prospect-bizdigipal', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizpal",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizpal");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    //prospect-bizcards sco
    $(document).on('click', '.prospect-bizcards', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizcards",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizcards");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-bizpdfkit', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizpdfkit",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizpdfkit");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-bizvoiceit', function (e) {
        //console.log("qqq")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizvoiceit",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizvoiceit");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });
    $(document).on('click', '.prospect-bizvoiceit-local', function (e) {
        //console.log("qqq")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizvoiceit",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizvoiceit_local");
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-bizcelfe', function (e) {
        //console.log("qqq")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizcelfe",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("bizcelfe");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });


    $(document).on('click', '.prospect-wittily', function (e) {
        //console.log("qqq")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "wittily",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("wittily");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-product360', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log

        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "product360",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("product360");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-trusted', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "trusted",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("trusted");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-channels', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "channel",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("channel");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-bizcontacts', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizcontacts",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                setTimeout(function () {
                    deviceHelper.navigateApp("bizcontacts");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-bizgroups', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "bizgroups",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                setTimeout(function () {
                    deviceHelper.navigateApp("bizgroups");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.prospect-multi', function (e) {
        //console.log("qqq")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //add the navigate log
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            platform: crossplat.device.platform,
            app: "multi",
            role: "individual",
            account_id: sessionStorage.getItem('account_id'),
            // business_id: sessionStorage.getItem('business_id'),
        }
        navigateLogsAdd(reqParam)
            .then((response) => {
                //redirect to ask us app
                // localStorage.setItem("navigate_role", "individual");
                //console.log("check", localStorage.getItem('navigate_role'));
                setTimeout(function () {
                    deviceHelper.navigateApp("multi");
                    if (cordova.platformId == 'android' || cordova.platformId === 'ios') {
                        StatusBar.backgroundColorByHexString("#b5f9e4");
                    }
                }, 500)
            })
            .catch((err) => {
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });


    $(document).on('click', '#activate-role-hub-page-alert-cancel', function () {
        sessionStorage.removeItem('role');
        sessionStorage.removeItem('notify_business_id');
        sessionStorage.removeItem('notify_owner_id');
        sessionStorage.removeItem('notify_id');
        sessionStorage.removeItem('notify_type');
        sessionStorage.removeItem('notify_identifier_id');
        sessionStorage.removeItem('notify_customer_id');
        $('#activate-role-hub-page').remove();
    });

    $(document).on('click', '#activate-role-hub-page-alert-ok', function () {
        $('#activate-role-hub-page').remove();
        if (sessionStorage.getItem('account_id')) {
            location.hash = `digibiz/account/role_update`;
        } else {
            location.hash = `digibiz/account`;
        }
    });


    $(document).on('click', '#digibiz-notification-accept-btn', function () {
        addLoader();
        var $this = $(this);
        var getNotificationsId = $($this).parent('.accept_reject_wrap').attr('data-notification-id');
        var getOwnerId = $($this).parent('.accept_reject_wrap').attr('data-owner-id');
        var getBusinessId = $($this).parent('.accept_reject_wrap').attr('data-business-id');
        var getType = $($this).parent('.accept_reject_wrap').attr('data-type');
        //check whether the role is active in the accounts collection
        var requestParameter = {
            device_id: crossplat.device.uuid,
            // uuid: sessionStorage.getItem('uuid')
            user_id: sessionStorage.getItem("user_id"),
        }
        accountGet(requestParameter)
            .then((accountResponse) => {
                //console.log("accountResponse", accountResponse);
                sessionStorage.setItem('account_id', accountResponse.id);
                if (getType == "employee") {
                    if (accountResponse.roles.employee == "active") {
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            notification_id: getNotificationsId,
                            action: 'accepted',
                            type: getType
                        }
                        notificationChangeStatus(reqParam)
                            .then((response) => {
                                //console.log("notificationChangeStatus response", response);
                                if (response.contact.status.status == "accepted") {
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        adder_user_id: getOwnerId,
                                        business_id: getBusinessId,
                                        notification_id: getNotificationsId
                                    }
                                    employeeAdd(requestParams)
                                        .then((response) => {
                                            sockets.digibizSocket.emit('joinroom', sessionStorage.getItem('socketID'));
                                            Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                        .catch((err) => {
                                            Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                } else {
                                    removeLoader();
                                }
                            })
                            .catch((err) => {
                                removeLoader();
                            })
                    } else {
                        removeLoader();
                        //console.log("activate employee role");
                        // Materialize.toast(`Activate Employee Role`, 3000, 'round success-alert');
                        // var alert_parms = {
                        //     alert_id: "activate-role-hub-page",
                        //     alert_platform: crossplat.device.platform,
                        //     alert_title: `Alert`,
                        //     alert_body: `Please activate your employee role to accept this request.`,
                        //     alert_btn: [{
                        //         name: "Ok",
                        //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                        //     },
                        //     {
                        //         name: "Cancel",
                        //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                        //     }]
                        // }
                        // showAlert(alert_parms, function () {
                        sessionStorage.setItem('role', 'employee');
                        sessionStorage.setItem('notify_business_id', getBusinessId);
                        sessionStorage.setItem('notify_owner_id', getOwnerId);
                        sessionStorage.setItem('notify_id', getNotificationsId);
                        sessionStorage.setItem('notify_type', getType);
                        //     removeLoader();
                        // });
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('account_id'),
                            role: sessionStorage.getItem('role'),
                            status: "active"
                        }
                        updateDigibizAccount(reqParam)
                            .then((response) => {
                                //console.log("update response", response);
                                if (sessionStorage.getItem('notify_id')) {
                                    acceptNotification();
                                } else {
                                    if (sessionStorage.getItem('role') == "administrator") {
                                        sessionStorage.removeItem('role');
                                        // location.hash = `business_owner/business/list`;
                                        location.hash = `business_owner/business/list`;
                                    } else if (sessionStorage.getItem('role') == "employee") {
                                        sessionStorage.removeItem('role');
                                        // location.hash = `employee/business/list`;
                                        location.hash = `employee/business/list`;
                                    } else if (sessionStorage.getItem('role') == "customer") {
                                        sessionStorage.removeItem('role');
                                        // location.hash = `customer/business/list`;
                                        location.hash = `customer/business/list`;
                                    } else if (sessionStorage.getItem('role') == "prospect") {
                                        sessionStorage.removeItem('role');
                                        var requestParameter = {
                                            device_id: crossplat.device.uuid,
                                            account_id: response.id
                                        }
                                        addJeeviAccount(requestParameter)
                                            .then((result) => {
                                                //console.log("result", result)
                                                //console.log("setting_digibiz_storage_selection")
                                                sessionStorage.setItem('digibiz_storage_selection', 'first');
                                                location.hash = `digibiz/account/storage`;
                                            })
                                            .catch((err) => {
                                                //console.log("error in adding jeevi_id")
                                            })
                                    }
                                }
                            })
                            .catch((err) => {
                                //console.log("err");
                                removeLoader();
                                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                            });
                    }
                } else if (getType == "customer" || getType == "associate_customer") {
                    //console.log("getType", getType);
                    //console.log("checkStatus", accountResponse.roles.customer)
                    if (accountResponse.roles.customer == "active") {
                        //console.log("entering active")
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            notification_id: getNotificationsId,
                            action: 'accepted',
                            type: getType
                        }
                        notificationChangeStatus(reqParam)
                            .then((response) => {
                                if (response.contact.status.status == "accepted") {
                                    if (getType == "customer") {
                                        var getIdentifierId = $($this).parent('.accept_reject_wrap').attr('data-identifier-id');
                                        var requestParams = {
                                            device_id: crossplat.device.uuid,
                                            identifier_id: getIdentifierId,
                                            adder_user_id: getOwnerId,
                                            business_id: getBusinessId,
                                            notification_id: getNotificationsId
                                        }
                                        customerAdd(requestParams)
                                            .then((response) => {
                                                var reqParam = {
                                                    device_id: crossplat.device.uuid,
                                                    list_by: "customer"
                                                }
                                                businessList(reqParam)
                                                    .then((lists) => {
                                                        digibiz.customer_business_list = removeDuplicatesFromMultipleProperties(digibiz.customer_business_list.concat(lists), 'customer_id', 'type');
                                                    }).catch((err) => {
                                                        console.log('err');
                                                    })
                                                $('.customer-role-btn').removeClass('hide');
                                                Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                                removeLoader();
                                            })
                                            .catch((err) => {
                                                Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                                removeLoader();
                                            })
                                    } else if (getType == "associate_customer") {
                                        var getCustomerId = $($this).parent('.accept_reject_wrap').attr('data-customer-id');
                                        var requestParams = {
                                            device_id: crossplat.device.uuid,
                                            adder_user_id: getOwnerId,
                                            customer_id: getCustomerId,
                                            business_id: getBusinessId,
                                            notification_id: getNotificationsId
                                        }
                                        associateCustomerAdd(requestParams)
                                            .then((response) => {
                                                Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                                removeLoader();
                                            })
                                            .catch((err) => {
                                                Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                                removeLoader();
                                            })
                                    }
                                } else {
                                    removeLoader();
                                }
                            })
                            .catch((err) => {
                                removeLoader();
                            })
                    } else {
                        removeLoader();
                        //console.log("activate customer role");
                        // Materialize.toast(`Activate Customer Role`, 3000, 'round success-alert');
                        // var alert_parms = {
                        //     alert_id: "activate-role-hub-page",
                        //     alert_platform: crossplat.device.platform,
                        //     alert_title: `Alert`,
                        //     alert_body: `Please activate your customer role to accept this request.`,
                        //     alert_btn: [{
                        //         name: "Ok",
                        //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                        //     },
                        //     {
                        //         name: "Cancel",
                        //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                        //     }]
                        // }
                        // showAlert(alert_parms, function () {
                        if (getType == "customer") {
                            var getIdentifierId = $($this).parent('.accept_reject_wrap').attr('data-identifier-id');
                            sessionStorage.setItem('notify_identifier_id', getIdentifierId);
                        } else if (getType == "associate_customer") {
                            var getCustomerId = $($this).parent('.accept_reject_wrap').attr('data-customer-id');
                            sessionStorage.setItem('notify_customer_id', getCustomerId);
                        }
                        sessionStorage.setItem('role', 'customer');
                        sessionStorage.setItem('notify_business_id', getBusinessId);
                        sessionStorage.setItem('notify_owner_id', getOwnerId);
                        sessionStorage.setItem('notify_id', getNotificationsId);
                        sessionStorage.setItem('notify_type', getType);
                        //     removeLoader();
                        // });
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('account_id'),
                            role: sessionStorage.getItem('role'),
                            status: "active"
                        }
                        updateDigibizAccount(reqParam)
                            .then((response) => {
                                //console.log("update response", response);
                                if (sessionStorage.getItem('notify_id')) {
                                    acceptNotification();
                                } else {
                                    if (sessionStorage.getItem('role') == "administrator") {
                                        sessionStorage.removeItem('role');
                                        // location.hash = `business_owner/business/list`;
                                        location.hash = `business_owner/business/list`;
                                    } else if (sessionStorage.getItem('role') == "employee") {
                                        sessionStorage.removeItem('role');
                                        // location.hash = `employee/business/list`;
                                        location.hash = `employee/business/list`;
                                    } else if (sessionStorage.getItem('role') == "customer") {
                                        sessionStorage.removeItem('role');
                                        // location.hash = `customer/business/list`;
                                        location.hash = `customer/business/list`;
                                    } else if (sessionStorage.getItem('role') == "prospect") {
                                        sessionStorage.removeItem('role');
                                        var requestParameter = {
                                            device_id: crossplat.device.uuid,
                                            account_id: response.id
                                        }
                                        addJeeviAccount(requestParameter)
                                            .then((result) => {
                                                //console.log("result", result)
                                                //console.log("setting_digibiz_storage_selection")
                                                sessionStorage.setItem('digibiz_storage_selection', 'first');
                                                location.hash = `digibiz/account/storage`;
                                            })
                                            .catch((err) => {
                                                //console.log("error in adding jeevi_id")
                                            })
                                    }
                                }
                            })
                            .catch((err) => {
                                //console.log("err");
                                removeLoader();
                                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                            });
                    }
                } else if (getType == "super_admin") {
                    if (accountResponse.roles.employee == "active" && accountResponse.roles.administrator == "active") {
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            notification_id: getNotificationsId,
                            action: 'accepted',
                            type: getType
                        }
                        notificationChangeStatus(reqParam)
                            .then((response) => {
                                //console.log("notificationChangeStatus response", response);
                                if (response.contact.status.status == "accepted") {
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        notification_id: getNotificationsId,
                                        business_id: getBusinessId,
                                    }
                                    businessSuperAdminAdd(requestParams)
                                        .then((response) => {
                                            Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                        .catch((err) => {
                                            Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                } else {
                                    removeLoader();
                                }
                            })
                            .catch((err) => {
                                removeLoader();
                            })
                    } else {
                        if (accountResponse.roles.employee == "active") {
                            if (accountResponse.roles.administrator == "active") {
                                var reqParam = {
                                    device_id: crossplat.device.uuid,
                                    notification_id: getNotificationsId,
                                    action: 'accepted',
                                    type: getType
                                }
                                notificationChangeStatus(reqParam)
                                    .then((response) => {
                                        //console.log("notificationChangeStatus response", response);
                                        if (response.contact.status.status == "accepted") {
                                            var requestParams = {
                                                device_id: crossplat.device.uuid,
                                                notification_id: getNotificationsId,
                                                business_id: getBusinessId,
                                            }
                                            businessSuperAdminAdd(requestParams)
                                                .then((response) => {
                                                    Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                                    removeLoader();
                                                })
                                                .catch((err) => {
                                                    Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                                    removeLoader();
                                                })
                                        } else {
                                            removeLoader();
                                        }
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                    })
                            } else {
                                removeLoader();
                                //console.log("activate administrator role");
                                // Materialize.toast(`Activate Administrator Role`, 3000, 'round success-alert');
                                // var alert_parms = {
                                //     alert_id: "activate-role-hub-page",
                                //     alert_platform: crossplat.device.platform,
                                //     alert_title: `Alert`,
                                //     alert_body: `Please activate your administrator role to accept this request.`,
                                //     alert_btn: [{
                                //         name: "Ok",
                                //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                                //     },
                                //     {
                                //         name: "Cancel",
                                //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                                //     }]
                                // }
                                // showAlert(alert_parms, function () {
                                sessionStorage.setItem('role', 'administrator');
                                sessionStorage.setItem('notify_business_id', getBusinessId);
                                sessionStorage.setItem('notify_id', getNotificationsId);
                                sessionStorage.setItem('notify_type', getType);
                                //     removeLoader();
                                // });
                                var reqParam = {
                                    device_id: crossplat.device.uuid,
                                    id: sessionStorage.getItem('account_id'),
                                    role: sessionStorage.getItem('role'),
                                    status: "active"
                                }
                                updateDigibizAccount(reqParam)
                                    .then((response) => {
                                        //console.log("update response", response);
                                        if (sessionStorage.getItem('notify_id')) {
                                            acceptNotification();
                                        } else {
                                            if (sessionStorage.getItem('role') == "administrator") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `business_owner/business/list`;
                                                location.hash = `business_owner/business/list`;
                                            } else if (sessionStorage.getItem('role') == "employee") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `employee/business/list`;
                                                location.hash = `employee/business/list`;
                                            } else if (sessionStorage.getItem('role') == "customer") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `customer/business/list`;
                                                location.hash = `customer/business/list`;
                                            } else if (sessionStorage.getItem('role') == "prospect") {
                                                sessionStorage.removeItem('role');
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    account_id: response.id
                                                }
                                                addJeeviAccount(requestParameter)
                                                    .then((result) => {
                                                        //console.log("result", result)
                                                        //console.log("setting_digibiz_storage_selection")
                                                        sessionStorage.setItem('digibiz_storage_selection', 'first');
                                                        location.hash = `digibiz/account/storage`;
                                                    })
                                                    .catch((err) => {
                                                        //console.log("error in adding jeevi_id")
                                                    })
                                            }
                                        }
                                    })
                                    .catch((err) => {
                                        //console.log("err");
                                        removeLoader();
                                        Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                                    });

                            }
                        } else {
                            removeLoader();
                            //console.log("activate employee role");
                            // Materialize.toast(`Activate Employee Role`, 3000, 'round success-alert');
                            // var alert_parms = {
                            //     alert_id: "activate-role-hub-page",
                            //     alert_platform: crossplat.device.platform,
                            //     alert_title: `Alert`,
                            //     alert_body: `Please activate your employee role to accept this request.`,
                            //     alert_btn: [{
                            //         name: "Ok",
                            //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                            //     },
                            //     {
                            //         name: "Cancel",
                            //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                            //     }]
                            // }
                            // showAlert(alert_parms, function () {
                            sessionStorage.setItem('role', 'employee');
                            sessionStorage.setItem('notify_business_id', getBusinessId);
                            sessionStorage.setItem('notify_owner_id', getOwnerId);
                            sessionStorage.setItem('notify_id', getNotificationsId);
                            sessionStorage.setItem('notify_type', getType);
                            //     removeLoader();
                            // });
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('account_id'),
                                role: sessionStorage.getItem('role'),
                                status: "active"
                            }
                            updateDigibizAccount(reqParam)
                                .then((response) => {
                                    //console.log("update response", response);
                                    if (sessionStorage.getItem('notify_id')) {
                                        acceptNotification();
                                    } else {
                                        if (sessionStorage.getItem('role') == "administrator") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `business_owner/business/list`;
                                            location.hash = `business_owner/business/list`;
                                        } else if (sessionStorage.getItem('role') == "employee") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `employee/business/list`;
                                            location.hash = `employee/business/list`;
                                        } else if (sessionStorage.getItem('role') == "customer") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `customer/business/list`;
                                            location.hash = `customer/business/list`;
                                        } else if (sessionStorage.getItem('role') == "prospect") {
                                            sessionStorage.removeItem('role');
                                            var requestParameter = {
                                                device_id: crossplat.device.uuid,
                                                account_id: response.id
                                            }
                                            addJeeviAccount(requestParameter)
                                                .then((result) => {
                                                    //console.log("result", result)
                                                    //console.log("setting_digibiz_storage_selection")
                                                    sessionStorage.setItem('digibiz_storage_selection', 'first');
                                                    location.hash = `digibiz/account/storage`;
                                                })
                                                .catch((err) => {
                                                    //console.log("error in adding jeevi_id")
                                                })
                                        }
                                    }
                                })
                                .catch((err) => {
                                    //console.log("err");
                                    removeLoader();
                                    Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                                });
                        }
                    }
                }
            })
            .catch((err) => {
                removeLoader();
                //console.log("no account")
                if (getType == "employee") {
                    //console.log("activate employee role");
                    // Materialize.toast(`Activate Employee Role`, 3000, 'round success-alert');
                    // var alert_parms = {
                    //     alert_id: "activate-role-hub-page",
                    //     alert_platform: crossplat.device.platform,
                    //     alert_title: `Alert`,
                    //     alert_body: `Please activate your employee role to accept this request.`,
                    //     alert_btn: [{
                    //         name: "Ok",
                    //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                    //     },
                    //     {
                    //         name: "Cancel",
                    //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                    //     }]
                    // }
                    // showAlert(alert_parms, function () {
                    sessionStorage.setItem('role', 'employee');
                    sessionStorage.setItem('notify_business_id', getBusinessId);
                    sessionStorage.setItem('notify_owner_id', getOwnerId);
                    sessionStorage.setItem('notify_id', getNotificationsId);
                    sessionStorage.setItem('notify_type', getType);
                    //     removeLoader();
                    // });
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('account_id'),
                        role: sessionStorage.getItem('role'),
                        status: "active"
                    }
                    updateDigibizAccount(reqParam)
                        .then((response) => {
                            //console.log("update response", response);
                            if (sessionStorage.getItem('notify_id')) {
                                acceptNotification();
                            } else {
                                if (sessionStorage.getItem('role') == "administrator") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `business_owner/business/list`;
                                    location.hash = `business_owner/business/list`;
                                } else if (sessionStorage.getItem('role') == "employee") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `employee/business/list`;
                                    location.hash = `employee/business/list`;
                                } else if (sessionStorage.getItem('role') == "customer") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `customer/business/list`;
                                    location.hash = `customer/business/list`;
                                } else if (sessionStorage.getItem('role') == "prospect") {
                                    sessionStorage.removeItem('role');
                                    var requestParameter = {
                                        device_id: crossplat.device.uuid,
                                        account_id: response.id
                                    }
                                    addJeeviAccount(requestParameter)
                                        .then((result) => {
                                            //console.log("result", result)
                                            //console.log("setting_digibiz_storage_selection")
                                            sessionStorage.setItem('digibiz_storage_selection', 'first');
                                            location.hash = `digibiz/account/storage`;
                                        })
                                        .catch((err) => {
                                            //console.log("error in adding jeevi_id")
                                        })
                                }
                            }
                        })
                        .catch((err) => {
                            //console.log("err");
                            removeLoader();
                            Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                        });
                } else if (getType == "customer" || getType == "associate_customer") {
                    //console.log("activate customer role");
                    // Materialize.toast(`Activate Customer Role`, 3000, 'round success-alert');
                    // var alert_parms = {
                    //     alert_id: "activate-role-hub-page",
                    //     alert_platform: crossplat.device.platform,
                    //     alert_title: `Alert`,
                    //     alert_body: `Please activate your customer role to accept this request.`,
                    //     alert_btn: [{
                    //         name: "Ok",
                    //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                    //     },
                    //     {
                    //         name: "Cancel",
                    //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                    //     }]
                    // }
                    // showAlert(alert_parms, function () {
                    //     if (getType == "customer") {
                    //         var getIdentifierId = $($this).parent('.accept_reject_wrap').attr('data-identifier-id');
                    //         sessionStorage.setItem('notify_identifier_id', getIdentifierId);
                    //     } else if (getType == "associate_customer") {
                    //         var getCustomerId = $($this).parent('.accept_reject_wrap').attr('data-customer-id');
                    //         sessionStorage.setItem('notify_customer_id', getCustomerId);
                    //     }
                    sessionStorage.setItem('role', 'customer');
                    sessionStorage.setItem('notify_business_id', getBusinessId);
                    sessionStorage.setItem('notify_owner_id', getOwnerId);
                    sessionStorage.setItem('notify_id', getNotificationsId);
                    sessionStorage.setItem('notify_type', getType);
                    //     removeLoader();
                    // });
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('account_id'),
                        role: sessionStorage.getItem('role'),
                        status: "active"
                    }
                    updateDigibizAccount(reqParam)
                        .then((response) => {
                            //console.log("update response", response);
                            if (sessionStorage.getItem('notify_id')) {
                                acceptNotification();
                            } else {
                                if (sessionStorage.getItem('role') == "administrator") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `business_owner/business/list`;
                                    location.hash = `business_owner/business/list`;
                                } else if (sessionStorage.getItem('role') == "employee") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `employee/business/list`;
                                    location.hash = `employee/business/list`;
                                } else if (sessionStorage.getItem('role') == "customer") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `customer/business/list`;
                                    location.hash = `customer/business/list`;
                                } else if (sessionStorage.getItem('role') == "prospect") {
                                    sessionStorage.removeItem('role');
                                    var requestParameter = {
                                        device_id: crossplat.device.uuid,
                                        account_id: response.id
                                    }
                                    addJeeviAccount(requestParameter)
                                        .then((result) => {
                                            //console.log("result", result)
                                            //console.log("setting_digibiz_storage_selection")
                                            sessionStorage.setItem('digibiz_storage_selection', 'first');
                                            location.hash = `digibiz/account/storage`;
                                        })
                                        .catch((err) => {
                                            //console.log("error in adding jeevi_id")
                                        })
                                }
                            }
                        })
                        .catch((err) => {
                            //console.log("err");
                            removeLoader();
                            Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                        });
                } else if (getType == "super_admin") {
                    //console.log("activate administrator role");
                    // Materialize.toast(`Activate Administrator Role`, 3000, 'round success-alert');
                    // var alert_parms = {
                    //     alert_id: "activate-role-hub-page",
                    //     alert_platform: crossplat.device.platform,
                    //     alert_title: `Alert`,
                    //     alert_body: `Please activate your administrator role to accept this request.`,
                    //     alert_btn: [{
                    //         name: "Ok",
                    //         attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                    //     },
                    //     {
                    //         name: "Cancel",
                    //         attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                    //     }]
                    // }
                    // showAlert(alert_parms, function () {
                    sessionStorage.setItem('role', 'administrator');
                    sessionStorage.setItem('notify_business_id', getBusinessId);
                    sessionStorage.setItem('notify_id', getNotificationsId);
                    sessionStorage.setItem('notify_type', getType);
                    //     removeLoader();
                    // });
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('account_id'),
                        role: sessionStorage.getItem('role'),
                        status: "active"
                    }
                    updateDigibizAccount(reqParam)
                        .then((response) => {
                            //console.log("update response", response);
                            if (sessionStorage.getItem('notify_id')) {
                                acceptNotification();
                            } else {
                                if (sessionStorage.getItem('role') == "administrator") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `business_owner/business/list`;
                                    location.hash = `business_owner/business/list`;
                                } else if (sessionStorage.getItem('role') == "employee") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `employee/business/list`;
                                    location.hash = `employee/business/list`;
                                } else if (sessionStorage.getItem('role') == "customer") {
                                    sessionStorage.removeItem('role');
                                    // location.hash = `customer/business/list`;
                                    location.hash = `customer/business/list`;
                                } else if (sessionStorage.getItem('role') == "prospect") {
                                    sessionStorage.removeItem('role');
                                    var requestParameter = {
                                        device_id: crossplat.device.uuid,
                                        account_id: response.id
                                    }
                                    addJeeviAccount(requestParameter)
                                        .then((result) => {
                                            //console.log("result", result)
                                            //console.log("setting_digibiz_storage_selection")
                                            sessionStorage.setItem('digibiz_storage_selection', 'first');
                                            location.hash = `digibiz/account/storage`;
                                        })
                                        .catch((err) => {
                                            //console.log("error in adding jeevi_id")
                                        })
                                }
                            }
                        })
                        .catch((err) => {
                            //console.log("err");
                            removeLoader();
                            Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                        });
                }
            })
    });

    $(document).on('click', '#digibiz-notification-reject-btn', function () {
        addLoader();
        var getNotificationsId = $(this).parent('.accept_reject_wrap').attr('data-notification-id');
        var getOwnerId = $(this).parent('.accept_reject_wrap').attr('data-owner-id');
        var getBusinessId = $(this).parent('.accept_reject_wrap').attr('data-business-id');
        var user = JSON.parse(sessionStorage.getItem('profile_details'));
        var reqParam = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationsId,
            action: 'rejected'
        }
        notificationChangeStatus(reqParam)
            .then((response) => {
                //console.log("notificationChangeStatus response", response);
                if (response.contact.status.status == "rejected") {
                    // $(this).parents('.digibiz-notification-list-wrapper').remove();
                    Materialize.toast(`Successfully rejected`, 3000, 'round success-alert');
                    removeLoader();
                }
            })
            .catch((err) => {
                removeLoader();
                //console.log("notificationChangeStatus error", err);
            })
    });

    $(document).on('click', '.pending-employee-wrapper', function () {
        addLoader();
        var getUUid = $(this).attr('data-uuid');
        sessionStorage.setItem('contact_uuid', getUUid);
        location.hash = `employee/notification/details`;
    });

    $(document).on('click', '.pending-super-admin-wrapper', function () {
        addLoader();
        var getUUid = $(this).attr('data-uuid');
        sessionStorage.setItem('contact_uuid', getUUid);
        location.hash = `super_admin/notification/details`;
    });

    $(document).on('click', '#delete-employee-notification', function () {
        addLoader();
        var getNotificationId = $(this).parents('.employee-notification-details-wrapper').attr('data-notification-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationId
        }
        notificationDelete(reqParam)
            .then((response) => {
                //console.log("notificationDelete success", response);
                removeLoader();
                $(this).parents('.employee-notification-details-wrapper').remove();
                if ($('.employee-notification-details-wrapper').length == 0) {
                    $('.employee-notification-details-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
                Materialize.toast(`Successfully deleted the notification.`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                //console.log("notificationDelete err", err);
                Materialize.toast(`Error in deleting the notification.`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#delete-super-admin-notification', function () {
        addLoader();
        var getNotificationId = $(this).parents('.super-admin-notification-details-wrapper').attr('data-notification-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationId
        }
        notificationDelete(reqParam)
            .then((response) => {
                //console.log("notificationDelete success", response);
                removeLoader();
                $(this).parents('.super-admin-notification-details-wrapper').remove();
                if ($('.super-admin-notification-details-wrapper').length == 0) {
                    $('.super-admin-notification-details-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
                Materialize.toast(`Successfully deleted the notification.`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                //console.log("notificationDelete err", err);
                Materialize.toast(`Error in deleting the notification.`, 3000, 'round success-alert');
            })
    });






    $(document).on('click', '#add-business-btn', function (e) {
        e.stopPropagation();
        addLoader();
        digibiz.storages = [];
        location.hash = `business/add`;
    });

    $(document).on('click', '#create-business-btn', function (e) {
        e.stopPropagation();
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('account_id'),
            role: "administrator",
            status: "active"
        }
        updateDigibizAccount(reqParam)
            .then((response) => {
                //console.log("success in updating administrator role");
                location.hash = `business/add`;
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in updating administrator role")
            })
    });



    $(document).on('click', '.bussines-forward-btn', function () {
        addLoader();
        var $this = $(this);
        var getPresentStep = $(this).attr('data-present-step');
        if (sessionStorage.getItem('digibiz_role') == "employee") {
            if (getPresentStep == "1" || getPresentStep == 1) {
                removeLoader();
                //next the data-present-step to both back and forward button
                $(this).attr('data-present-step', '2');
                $(this).siblings('.bussines-back-btn').attr('data-present-step', '2');
                //activate the next stepper
                $(`.business-create-stepper`).removeClass('is-active');
                $(`.business-create-stepper[data-stepper="2"]`).addClass('is-active');
                //show next content data 
                $(`.business-creation-parts-container[data-step="1"]`).addClass('hide');
                $(`.business-creation-parts-container[data-step="2"]`).removeClass('hide');
                // //show the save button of step-2
                // $('.save-bussines-step-two-btn').removeClass('hide');
                //show the back button 
                $('.bussines-back-btn').removeClass('hide');
            } else if (getPresentStep == "2" || getPresentStep == 2) {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        //console.log("business get response", response);
                        //next the data-present-step to both back and forward button
                        $($this).attr('data-present-step', '3');
                        $($this).siblings('.bussines-back-btn').attr('data-present-step', '3');
                        //activate the next stepper
                        $(`.business-create-stepper`).removeClass('is-active');
                        $(`.business-create-stepper[data-stepper="3"]`).addClass('is-active');
                        //show next content data 
                        $(`.business-creation-parts-container[data-step="2"]`).addClass('hide');
                        $(`.business-creation-parts-container[data-step="3"]`).removeClass('hide');
                        //remove all uploaded files if any
                        $('.grid.uploaded-multimedia-files').remove();
                        //remove id proof container
                        if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                            //console.log("&&&&")
                            $('.business-add-identity-proof-wrapper').remove();
                        }
                        //based on the type of the business show and display the required fields
                        var businessType = $('#business-type-choose-select-dropdown').val();
                        //console.log("businessType", businessType);
                        if (businessType == "sole_proprietorship") {
                            //console.log("sole");
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-shop-established-license-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "partnership") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-partnership-deed-container').removeClass('hide');
                            $('.business-add-partnership-registration-certificate-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "limited_liability_partnership") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-llp-registration-certificate-container').removeClass('hide');
                            $('.business-add-transaction-person-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "private_limited_company") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-transaction-person-container').removeClass('hide');
                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                            $('.business-add-articles-of-association-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "public_limited_company") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                            $('.business-add-articles-of-association-container').removeClass('hide');
                            $('.business-add-transaction-person-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "government_department") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                            $('.business-add-articles-of-association-container').removeClass('hide');
                            $('.business-add-transaction-person-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "trusts_foundations") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-transaction-person-container').removeClass('hide');
                            $('.business-add-trust-establishment-license-container').removeClass('hide');
                            removeLoader();
                        } else if (businessType == "co_operative_society_associations") {
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-email-container').removeClass('hide');
                            $('.business-add-address-container').removeClass('hide');
                            $('.business-add-identity-proof-container').removeClass('hide');
                            $('.business-add-pancard-container').removeClass('hide');
                            $('.business-add-gst-container').removeClass('hide');
                            $('.business-add-llp-registration-certificate-container').removeClass('hide');
                            $('.business-add-transaction-person-container').removeClass('hide');
                            removeLoader();
                        } else {
                            //console.log("none is found");
                        }
                        //add all multimedia
                        const IDProofstart = async () => {
                            if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                                await asyncEach(response['id_proofs'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "identity-proof-load-btn");
                                });
                            } else {
                                $('.business-add-identity-proof-wrapper').removeClass('hide');
                            }
                        }
                        IDProofstart();
                        const PanCardstart = async () => {
                            if (response.pan_card_details !== undefined && response['pan_card_details']['pan_card_multimedia'].length > 0) {
                                $(`.multimedia-append-container[data-id="pancard-load-btn"]`).find(`.grid`).remove();
                                await asyncEach(response['pan_card_details']['pan_card_multimedia'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "pancard-load-btn");
                                });
                            }
                        }
                        PanCardstart();
                        const ShopEstablishedLicencestart = async () => {
                            if (response.hasOwnProperty('shop_established_license') && response['shop_established_license'].length > 0) {
                                await asyncEach(response['shop_established_license'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "shop-established-license-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        ShopEstablishedLicencestart();
                        const GSTstart = async () => {
                            if (response.gst_details !== undefined && response['gst_details']['gst_multimedia'].length > 0) {
                                $(`.multimedia-append-container[data-id="gst-license-load-btn"]`).find(`.grid`).remove();
                                await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "gst-license-load-btn");
                                });
                            }
                        }
                        GSTstart();
                        const PartnershipDeedstart = async () => {
                            if (response.hasOwnProperty('partnership_deed') && response['partnership_deed'].length > 0) {
                                await asyncEach(response['partnership_deed'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "partnership-deed-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        PartnershipDeedstart();
                        const PartnershipRegistrationCertificatestart = async () => {
                            if (response.hasOwnProperty('partnership_registration_certificate') && response['partnership_registration_certificate'].length > 0) {
                                await asyncEach(response['partnership_registration_certificate'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "partnership-registration-certificate-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        PartnershipRegistrationCertificatestart();
                        const LLPRegistrationCertificatestart = async () => {
                            if (response.hasOwnProperty('llp_registration_certificate') && response['llp_registration_certificate'].length > 0) {
                                await asyncEach(response['llp_registration_certificate'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "llp-registration-certificate-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        LLPRegistrationCertificatestart();
                        const TransactionPersonstart = async () => {
                            if (response.hasOwnProperty('transaction_person') && response['transaction_person'].length > 0) {
                                await asyncEach(response['transaction_person'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "transaction-person-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        TransactionPersonstart();
                        const Memorandumstart = async () => {
                            if (response.hasOwnProperty('memorandum_of_association') && response['memorandum_of_association'].length > 0) {
                                await asyncEach(response['memorandum_of_association'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "memorandum-of-association-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        Memorandumstart();
                        const articlesstart = async () => {
                            if (response.hasOwnProperty('article_of_association') && response['article_of_association'].length > 0) {
                                await asyncEach(response['article_of_association'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "articles-of-association-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        articlesstart();
                        const TrustLicencestart = async () => {
                            if (response.hasOwnProperty('trust_foundation_established_licence') && response['trust_foundation_established_licence'].length > 0) {
                                await asyncEach(response['trust_foundation_established_licence'], async (e, index) => {
                                    await getUploadedBusinessMultimedia(e, "trust-establishment-license-load-btn");
                                });
                            } else {
                                //console.log("no length")
                            }
                        }
                        TrustLicencestart();
                    })
                    .catch((err) => {

                    })
            } else if (getPresentStep == "3" || getPresentStep == 3) {
                //console.log("Success in step3");
                //next the data-present-step to both back and forward button
                $(this).attr('data-present-step', '4');
                $(this).siblings('.bussines-back-btn').attr('data-present-step', '4');
                //hide next button and show register button
                // $(this).addClass('hide');
                // $('.register-bussines-btn').removeClass('hide');
                //activate the next stepper
                $(`.business-create-stepper`).removeClass('is-active');
                $(`.business-create-stepper[data-stepper="4"]`).addClass('is-active');
                //show next content data 
                $(`.business-creation-parts-container[data-step="3"]`).addClass('hide');
                $(`.business-creation-parts-container[data-step="4"]`).removeClass('hide');
                removeLoader();
            } else if (getPresentStep == "4" || getPresentStep == 4) {
                //next the data-present-step to both back and forward button
                $(this).attr('data-present-step', '5');
                $(this).siblings('.bussines-back-btn').attr('data-present-step', '5');
                //hide next button and show register button
                // $(this).addClass('hide');
                // $('.register-bussines-btn').removeClass('hide');
                //activate the next stepper
                $(`.business-create-stepper`).removeClass('is-active');
                $(`.business-create-stepper[data-stepper="5"]`).addClass('is-active');
                //show next content data 
                $(`.business-creation-parts-container[data-step="4"]`).addClass('hide');
                $(`.business-creation-parts-container[data-step="5"]`).removeClass('hide');
                removeLoader();
            } else if (getPresentStep == "5" || getPresentStep == 5) {
                //next the data-present-step to both back and forward button
                $(this).attr('data-present-step', '6');
                $(this).siblings('.bussines-back-btn').attr('data-present-step', '6');
                //hide next button and show register button
                $(this).addClass('hide');
                // $('.register-bussines-btn').removeClass('hide');
                //activate the next stepper
                $(`.business-create-stepper`).removeClass('is-active');
                $(`.business-create-stepper[data-stepper="6"]`).addClass('is-active');
                //show next content data 
                $(`.business-creation-parts-container[data-step="5"]`).addClass('hide');
                $(`.business-creation-parts-container[data-step="6"]`).removeClass('hide');
                removeLoader();
            }
        } else {
            if (getPresentStep == "1" || getPresentStep == 1) {
                if (validateBusinessStepOne()) {
                    // var businessType = $('#business-type-choose-select-dropdown').val();
                    // var businessTypeId = $('#business-type-choose-select-dropdown').find(`option[value="${businessType}"]`).attr('data-id');
                    var businessType = $('.selected-value-business-type').attr('data-value');
                    var businessTypeId = $('.selected-value-business-type').attr('data-id');
                    var businessName = $('#business_name').text().trim();
                    var businessDisplayName = $('#business_display_name').text().trim();
                    var businessTagLine = $('#business_tag_line').text().trim();
                    var businessStatusLine = $('#business_status_line').text().trim();
                    //console.log("businessStatusLine", businessStatusLine)
                    if (sessionStorage.getItem('business_id') && sessionStorage.getItem('business_id') != undefined && sessionStorage.getItem('business_id') != null) {
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('business_id'),
                            data: {
                                name: firstLetterUpperCase(businessName),
                                display_name: businessDisplayName,
                                tag_line: firstLetterUpperCase(businessTagLine),
                                status_line: firstLetterUpperCase(businessStatusLine)
                            }
                        }
                        businessUpdate(reqParam)
                            .then((response) => {
                                removeLoader();
                                //next the data-present-step to both back and forward button
                                $(this).attr('data-present-step', '2');
                                $(this).siblings('.bussines-back-btn').attr('data-present-step', '2');
                                //activate the next stepper
                                $(`.business-create-stepper`).removeClass('is-active');
                                $(`.business-create-stepper[data-stepper="2"]`).addClass('is-active');
                                //show next content data 
                                $(`.business-creation-parts-container[data-step="1"]`).addClass('hide');
                                $(`.business-creation-parts-container[data-step="2"]`).removeClass('hide');
                                // //show the save button of step-2
                                // $('.save-bussines-step-two-btn').removeClass('hide');
                                //show the back button 
                                $('.bussines-back-btn').removeClass('hide');
                            })
                            .catch((err) => {
                                if (err.msg == "no updated data found") {
                                    removeLoader();
                                    //next the data-present-step to both back and forward button
                                    $(this).attr('data-present-step', '2');
                                    $(this).siblings('.bussines-back-btn').attr('data-present-step', '2');
                                    //activate the next stepper
                                    $(`.business-create-stepper`).removeClass('is-active');
                                    $(`.business-create-stepper[data-stepper="2"]`).addClass('is-active');
                                    //show next content data 
                                    $(`.business-creation-parts-container[data-step="1"]`).addClass('hide');
                                    $(`.business-creation-parts-container[data-step="2"]`).removeClass('hide');
                                    // //show the save button of step-2
                                    // $('.save-bussines-step-two-btn').removeClass('hide');
                                    //show the back button 
                                    $('.bussines-back-btn').removeClass('hide');
                                } else {
                                    removeLoader();
                                    Materialize.toast(err.msg, 3000, 'round error-alert');
                                }
                            })
                    } else {
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            name: firstLetterUpperCase(businessName),
                            display_name: businessDisplayName,
                            business_type_id: businessTypeId,
                            tag_line: firstLetterUpperCase(businessTagLine),
                            status_line: firstLetterUpperCase(businessStatusLine),
                            status: "pending"
                        }
                        businessAdd(reqParam)
                            .then((response) => {
                                removeLoader();
                                //set business_id session
                                sessionStorage.setItem('business_id', response.id);
                                //next the data-present-step to both back and forward button
                                $(this).attr('data-present-step', '2');
                                $(this).siblings('.bussines-back-btn').attr('data-present-step', '2');
                                //activate the next stepper
                                $(`.business-create-stepper`).removeClass('is-active');
                                $(`.business-create-stepper[data-stepper="2"]`).addClass('is-active');
                                //show next content data 
                                $(`.business-creation-parts-container[data-step="1"]`).addClass('hide');
                                $(`.business-creation-parts-container[data-step="2"]`).removeClass('hide');
                                // //show the save button of step-2
                                // $('.save-bussines-step-two-btn').removeClass('hide');
                                //show the back button 
                                $('.bussines-back-btn').removeClass('hide');
                                //disable type dropdown
                                $('#business-type-choose-select-dropdown').prop('disabled', true);
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(err.msg, 3000, 'round error-alert');
                                // Materialize.toast(`Error in registering business`, 3000, 'round success-alert');
                            })
                    }
                } else {
                    removeLoader();
                    Materialize.toast(`Please check the data in step-1`, 3000, 'round success-alert');
                }
            } else if (getPresentStep == "2" || getPresentStep == 2) {
                if (validateBusinessStepTwo()) {
                    var reqParam;
                    var getContactName = $('#business_contact_name').text();
                    var getConatctNumber = $('#business_contact_number').intlTelInput("getNumber");
                    var getAlternateConatctNumber = $('#business_alternate_contact_number').intlTelInput("getNumber");
                    var getEmail = $('#business_email').text();//optional
                    var getAlternateEmail = $('#business_alternate_email').text();//optional
                    var addressArray = [];//min 1 address
                    var getAddressBoxes = $('.address_text_box');
                    var getDateOfCommencement = $('#business_date_of_commencement').val().trim();
                    var getDateOfIncorporation = $('#business_date_of_incorporation').val().trim();
                    $.each(getAddressBoxes, function (index, address) {
                        if ($(address).parents('.business-add-address-wrapper').find('.selected-value-business-address').attr('data-value') != "" && $(address).text() != "") {//both are present
                            addressArray.push({
                                // address_type: $(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown').val(),
                                address_type: $(address).parents('.business-add-address-wrapper').find('.selected-value-business-address').attr('data-value'),
                                address_data: firstLetterUpperCase($(address).text())
                            })
                        }
                    })
                    reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('business_id'),
                        data: {
                            contact_name: firstLetterUpperCase(getContactName),
                            contact_number: getConatctNumber,
                            alternate_contact_number: getAlternateConatctNumber,
                            e_mail: getEmail,
                            alternate_e_mail: getAlternateEmail,
                            address: addressArray,
                            date_of_commencement: getDateOfCommencement,
                            date_of_incorporation: getDateOfIncorporation
                            // display_picture: businessDisplayPictureData
                        }
                    }
                    businessUpdate(reqParam)
                        .then((response) => {
                            sessionStorage.removeItem('business_upload_for');
                            //next the data-present-step to both back and forward button
                            $($this).attr('data-present-step', '3');
                            $($this).siblings('.bussines-back-btn').attr('data-present-step', '3');
                            //activate the next stepper
                            $(`.business-create-stepper`).removeClass('is-active');
                            $(`.business-create-stepper[data-stepper="3"]`).addClass('is-active');
                            //show next content data 
                            $(`.business-creation-parts-container[data-step="2"]`).addClass('hide');
                            $(`.business-creation-parts-container[data-step="3"]`).removeClass('hide');
                            //remove all uploaded files if any
                            $('.grid.uploaded-multimedia-files').remove();
                            //remove id proof container
                            if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                                $('.business-add-identity-proof-wrapper').remove();
                            }
                            //based on the type of the business show and display the required fields
                            // var businessType = $('#business-type-choose-select-dropdown').val();
                            var businessType = $('.selected-value-business-type').attr('data-value');
                            //console.log("businessType", businessType)
                            if (businessType == "sole_proprietorship") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-shop-established-license-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "partnership") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-partnership-deed-container').removeClass('hide');
                                $('.business-add-partnership-registration-certificate-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "limited_liability_partnership") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-llp-registration-certificate-container').removeClass('hide');
                                $('.business-add-transaction-person-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "private_limited_company") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-transaction-person-container').removeClass('hide');
                                $('.business-add-memorandum-of-association-container').removeClass('hide');
                                $('.business-add-articles-of-association-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "public_limited_company") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-memorandum-of-association-container').removeClass('hide');
                                $('.business-add-articles-of-association-container').removeClass('hide');
                                $('.business-add-transaction-person-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "government_department") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-memorandum-of-association-container').removeClass('hide');
                                $('.business-add-articles-of-association-container').removeClass('hide');
                                $('.business-add-transaction-person-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "trusts_foundations") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-transaction-person-container').removeClass('hide');
                                $('.business-add-trust-establishment-license-container').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "co_operative_society_associations") {
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-email-container').removeClass('hide');
                                $('.business-add-address-container').removeClass('hide');
                                $('.business-add-identity-proof-container').removeClass('hide');
                                $('.business-add-pancard-container').removeClass('hide');
                                $('.business-add-gst-container').removeClass('hide');
                                $('.business-add-llp-registration-certificate-container').removeClass('hide');
                                $('.business-add-transaction-person-container').removeClass('hide');
                                removeLoader();
                            }
                            //add all multimedia
                            const IDProofstart = async () => {
                                if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                                    await asyncEach(response['id_proofs'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "identity-proof-load-btn");
                                    });
                                } else {
                                    $('.business-add-identity-proof-wrapper').removeClass('hide');
                                }
                            }
                            IDProofstart();
                            const PanCardstart = async () => {
                                if (response.pan_card_details !== undefined && response['pan_card_details']['pan_card_multimedia'].length > 0) {
                                    $(`.multimedia-append-container[data-id="pancard-load-btn"]`).find(`.grid`).remove();
                                    await asyncEach(response['pan_card_details']['pan_card_multimedia'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "pancard-load-btn");
                                    });
                                }
                            }
                            PanCardstart();
                            const ShopEstablishedLicencestart = async () => {
                                if (response.hasOwnProperty('shop_established_license') && response['shop_established_license'].length > 0) {
                                    await asyncEach(response['shop_established_license'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "shop-established-license-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            ShopEstablishedLicencestart();
                            const GSTstart = async () => {
                                if (response.gst_details !== undefined && response['gst_details']['gst_multimedia'].length > 0) {
                                    $(`.multimedia-append-container[data-id="gst-license-load-btn"]`).find(`.grid`).remove();
                                    await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "gst-license-load-btn");
                                    });
                                }
                            }
                            GSTstart();
                            const PartnershipDeedstart = async () => {
                                if (response.hasOwnProperty('partnership_deed') && response['partnership_deed'].length > 0) {
                                    await asyncEach(response['partnership_deed'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "partnership-deed-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            PartnershipDeedstart();
                            const PartnershipRegistrationCertificatestart = async () => {
                                if (response.hasOwnProperty('partnership_registration_certificate') && response['partnership_registration_certificate'].length > 0) {
                                    await asyncEach(response['partnership_registration_certificate'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "partnership-registration-certificate-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            PartnershipRegistrationCertificatestart();
                            const LLPRegistrationCertificatestart = async () => {
                                if (response.hasOwnProperty('llp_registration_certificate') && response['llp_registration_certificate'].length > 0) {
                                    await asyncEach(response['llp_registration_certificate'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "llp-registration-certificate-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            LLPRegistrationCertificatestart();
                            const TransactionPersonstart = async () => {
                                if (response.hasOwnProperty('transaction_person') && response['transaction_person'].length > 0) {
                                    await asyncEach(response['transaction_person'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "transaction-person-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            TransactionPersonstart();
                            const Memorandumstart = async () => {
                                if (response.hasOwnProperty('memorandum_of_association') && response['memorandum_of_association'].length > 0) {
                                    await asyncEach(response['memorandum_of_association'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "memorandum-of-association-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            Memorandumstart();
                            const articlesstart = async () => {
                                if (response.hasOwnProperty('article_of_association') && response['article_of_association'].length > 0) {
                                    await asyncEach(response['article_of_association'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "articles-of-association-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            articlesstart();
                            const TrustLicencestart = async () => {
                                if (response.hasOwnProperty('trust_foundation_established_licence') && response['trust_foundation_established_licence'].length > 0) {
                                    await asyncEach(response['trust_foundation_established_licence'], async (e, index) => {
                                        await getUploadedBusinessMultimedia(e, "trust-establishment-license-load-btn");
                                    });
                                } else {
                                    //console.log("no length")
                                }
                            }
                            TrustLicencestart();
                        })
                        .catch((err) => {
                            sessionStorage.removeItem('business_upload_for');
                            //console.log("error in update business api", err);
                            if (err.msg == "no updated data found") {
                                removeLoader();
                            }
                        })
                    // }
                    // })
                } else {
                    removeLoader();
                    //console.log("Error in validateBusinessData")
                }
            } else if (getPresentStep == "3" || getPresentStep == 3) {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        if (validateBusinessStepThree(response)) {//removethisline
                            //console.log("0987")
                            //next the data-present-step to both back and forward button
                            $(this).attr('data-present-step', '4');
                            $(this).siblings('.bussines-back-btn').attr('data-present-step', '4');
                            //hide next button and show register button
                            // $(this).addClass('hide');
                            // $('.register-bussines-btn').removeClass('hide');
                            //activate the next stepper
                            $(`.business-create-stepper`).removeClass('is-active');
                            $(`.business-create-stepper[data-stepper="4"]`).addClass('is-active');
                            //show next content data 
                            $(`.business-creation-parts-container[data-step="3"]`).addClass('hide');
                            $(`.business-creation-parts-container[data-step="4"]`).removeClass('hide');
                            removeLoader();
                        } else {
                            //console.log("error")
                            removeLoader();
                        }
                    })
                    .catch((err) => {
                        removeLoader();
                    })
            } else if (getPresentStep == "4" || getPresentStep == 4) {
                var getValue;
                if ($('#filled-in-box-business-cloud-folder-customer').is(':disabled')) {
                    //console.log("disabled");
                    //next the data-present-step to both back and forward button
                    $(this).attr('data-present-step', '5');
                    $(this).siblings('.bussines-back-btn').attr('data-present-step', '5');
                    //hide next button and show register button
                    // $(this).addClass('hide');
                    // $('.register-bussines-btn').removeClass('hide');
                    //activate the next stepper
                    $(`.business-create-stepper`).removeClass('is-active');
                    $(`.business-create-stepper[data-stepper="5"]`).addClass('is-active');
                    //show next content data 
                    $(`.business-creation-parts-container[data-step="4"]`).addClass('hide');
                    $(`.business-creation-parts-container[data-step="5"]`).removeClass('hide');
                    removeLoader();
                } else {
                    if ($('#filled-in-box-business-cloud-folder-customer').is(':checked')) {
                        getValue = true;
                    } else {
                        getValue = false;
                    }
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('business_id'),
                        data: {
                            customer_cloud_folder: getValue,
                        }
                    }
                    businessUpdate(reqParam)
                        .then((response) => {
                            //next the data-present-step to both back and forward button
                            $(this).attr('data-present-step', '5');
                            $(this).siblings('.bussines-back-btn').attr('data-present-step', '5');
                            //hide next button and show register button
                            // $(this).addClass('hide');
                            // $('.register-bussines-btn').removeClass('hide');
                            //activate the next stepper
                            $(`.business-create-stepper`).removeClass('is-active');
                            $(`.business-create-stepper[data-stepper="5"]`).addClass('is-active');
                            //show next content data 
                            $(`.business-creation-parts-container[data-step="4"]`).addClass('hide');
                            $(`.business-creation-parts-container[data-step="5"]`).removeClass('hide');
                            removeLoader();
                        })
                        .catch((err) => {
                            //next the data-present-step to both back and forward button
                            $(this).attr('data-present-step', '5');
                            $(this).siblings('.bussines-back-btn').attr('data-present-step', '5');
                            //hide next button and show register button
                            // $(this).addClass('hide');
                            // $('.register-bussines-btn').removeClass('hide');
                            //activate the next stepper
                            $(`.business-create-stepper`).removeClass('is-active');
                            $(`.business-create-stepper[data-stepper="5"]`).addClass('is-active');
                            //show next content data 
                            $(`.business-creation-parts-container[data-step="4"]`).addClass('hide');
                            $(`.business-creation-parts-container[data-step="5"]`).removeClass('hide');
                            removeLoader();
                        })
                }
            } else if (getPresentStep == "5" || getPresentStep == 5) {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        //console.log("business get response", response);
                        if (validateBusinessStepFour(response)) {//remove this line                            
                            checkBusinessActiveStorage(function () {
                                //next the data-present-step to both back and forward button
                                $(this).attr('data-present-step', '6');
                                $(this).siblings('.bussines-back-btn').attr('data-present-step', '6');
                                //hide next button and show register button
                                $(this).addClass('hide');
                                $('.register-bussines-btn').removeClass('hide');
                                //activate the next stepper
                                $(`.business-create-stepper`).removeClass('is-active');
                                $(`.business-create-stepper[data-stepper="6"]`).addClass('is-active');
                                //show next content data 
                                $(`.business-creation-parts-container[data-step="5"]`).addClass('hide');
                                $(`.business-creation-parts-container[data-step="6"]`).removeClass('hide');
                                removeLoader();
                            })
                        } else {
                            removeLoader();
                        }
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in catch");
                    })
            }
        }
    });

    $(document).on('click', '.bussines-back-btn', function () {
        addLoader();
        var getPresentStep = $(this).attr('data-present-step');
        if (getPresentStep == "6" || getPresentStep == 6) {
            //minus the data-present-step to both back and forward button
            $(this).attr('data-present-step', '5');
            $(this).siblings('.bussines-forward-btn').attr('data-present-step', '5');
            //activate the next stepper
            $(`.business-create-stepper`).removeClass('is-active');
            $(`.business-create-stepper[data-stepper="5"]`).addClass('is-active');
            //show next content data 
            $(`.business-creation-parts-container[data-step="6"]`).addClass('hide');
            $(`.business-creation-parts-container[data-step="5"]`).removeClass('hide');
            //show forward button and hide register button
            $(this).siblings('.bussines-forward-btn').removeClass('hide');
            $('.register-bussines-btn').addClass('hide');
            removeLoader();
        } else if (getPresentStep == "5" || getPresentStep == 5) {
            //minus the data-present-step to both back and forward button
            $(this).attr('data-present-step', '4');
            $(this).siblings('.bussines-forward-btn').attr('data-present-step', '4');
            //activate the next stepper
            $(`.business-create-stepper`).removeClass('is-active');
            $(`.business-create-stepper[data-stepper="4"]`).addClass('is-active');
            //show next content data 
            $(`.business-creation-parts-container[data-step="5"]`).addClass('hide');
            $(`.business-creation-parts-container[data-step="4"]`).removeClass('hide');
            //show forward button and hide register button
            $(this).siblings('.bussines-forward-btn').removeClass('hide');
            $('.register-bussines-btn').addClass('hide');
            removeLoader();
        } else if (getPresentStep == "4" || getPresentStep == 4) {
            // var reqParam = {
            //     device_id: crossplat.device.uuid,
            //     id: sessionStorage.getItem('business_id')
            // }
            // businessGet(reqParam)
            //     .then((response) => {
            //minus the data-present-step to both back and forward button
            $(this).attr('data-present-step', '3');
            $(this).siblings('.bussines-forward-btn').attr('data-present-step', '3');
            //activate the next stepper
            $(`.business-create-stepper`).removeClass('is-active');
            $(`.business-create-stepper[data-stepper="3"]`).addClass('is-active');
            //show next content data 
            $(`.business-creation-parts-container[data-step="4"]`).addClass('hide');
            $(`.business-creation-parts-container[data-step="3"]`).removeClass('hide');
            //show forward button and hide register button
            $('.register-bussines-btn').addClass('hide');
            $(this).siblings('.bussines-forward-btn').removeClass('hide');
            //based on the type of the business show and display the required fields
            // var businessType = $('#business-type-choose-select-dropdown').val();
            var businessType = $('.selected-value-business-type').attr('data-value');
            if (businessType == "sole_proprietorship") {
                //console.log("sole");
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-shop-established-license-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "partnership") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-partnership-deed-container').removeClass('hide');
                $('.business-add-partnership-registration-certificate-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "limited_liability_partnership") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-llp-registration-certificate-container').removeClass('hide');
                $('.business-add-transaction-person-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "private_limited_company") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-transaction-person-container').removeClass('hide');
                $('.business-add-memorandum-of-association-container').removeClass('hide');
                $('.business-add-articles-of-association-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "public_limited_company") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-memorandum-of-association-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "government_department") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-memorandum-of-association-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "trusts_foundations") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-transaction-person-container').removeClass('hide');
                $('.business-add-trust-establishment-license-container').removeClass('hide');
                removeLoader();
            } else if (businessType == "co_operative_society_associations") {
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-email-container').removeClass('hide');
                $('.business-add-address-container').removeClass('hide');
                $('.business-add-identity-proof-container').removeClass('hide');
                $('.business-add-pancard-container').removeClass('hide');
                $('.business-add-gst-container').removeClass('hide');
                $('.business-add-llp-registration-certificate-container').removeClass('hide');
                $('.business-add-transaction-person-container').removeClass('hide');
                removeLoader();
            }
            //add all multimedia
            // const IDProofstart = async () => {
            //     if (response.hasOwnProperty('id_proofs') && Object.keys(response['id_proofs']['id_proof_multimedia']).length > 0) {
            //         await asyncEach(response['id_proofs']['id_proof_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, "identity-proof-load-btn");
            //         });
            //     }
            // }
            // IDProofstart();
            // const PanCardstart = async () => {
            //     if (response.hasOwnProperty('pan_card_details') && Object.keys(response['pan_card_details']['pan_card_multimedia']).length > 0) {
            //         await asyncEach(response['pan_card_details']['pan_card_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, "pancard-load-btn");
            //         });
            //     }
            // }
            // PanCardstart();
            // const ShopEstablishedLicencestart = async () => {
            //     if (response.hasOwnProperty('shop_established_license') && Object.keys(response['shop_established_license']['shop_established_license_multimedia']).length > 0) {
            //         await asyncEach(response['shop_established_license']['shop_established_license_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, "shop-established-license-load-btn");
            //         });
            //     }
            // }
            // ShopEstablishedLicencestart();
            // const GSTstart = async () => {
            //     if (response.hasOwnProperty('gst_details') && Object.keys(response['gst_details']['gst_multimedia']).length > 0) {
            //         await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, "gst-license-load-btn");
            //         });
            //     }
            // }
            // GSTstart();
            // const PartnershipDeedstart = async () => {
            //     if (response.hasOwnProperty('partnership_deed') && Object.keys(response['partnership_deed']['partnership_deed_multimedia']).length > 0) {
            //         await asyncEach(response['partnership_deed']['partnership_deed_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // PartnershipDeedstart();
            // const PartnershipRegistrationCertificatestart = async () => {
            //     if (response.hasOwnProperty('partnership_registration_certificate') && Object.keys(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia']).length > 0) {
            //         await asyncEach(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // PartnershipRegistrationCertificatestart();
            // const LLPRegistrationCertificatestart = async () => {
            //     if (response.hasOwnProperty('llp_registration_certificate') && Object.keys(response['llp_registration_certificate']['llp_registration_certificate_multimedia']).length > 0) {
            //         await asyncEach(response['llp_registration_certificate']['llp_registration_certificate_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // LLPRegistrationCertificatestart();
            // const TransactionPersonstart = async () => {
            //     if (response.hasOwnProperty('transaction_person') && Object.keys(response['transaction_person']['transaction_person_multimedia']).length > 0) {
            //         await asyncEach(response['transaction_person']['transaction_person_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // TransactionPersonstart();
            // const Memorandumstart = async () => {
            //     if (response.hasOwnProperty('memorandum_of_association') && Object.keys(response['memorandum_of_association']['memorandum_of_association_multimedia']).length > 0) {
            //         await asyncEach(response['memorandum_of_association']['memorandum_of_association_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // Memorandumstart();
            // const articlesstart = async () => {
            //     if (response.hasOwnProperty('article_of_association') && Object.keys(response['article_of_association']['article_of_association_multimedia']).length > 0) {
            //         await asyncEach(response['article_of_association']['article_of_association_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // articlesstart();
            // const TrustLicencestart = async () => {
            //     if (response.hasOwnProperty('trust_foundation_established_licence') && Object.keys(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia']).length > 0) {
            //         await asyncEach(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia'], async (e, index) => {
            //             await getUploadedMultimedia(e.asset_id, getDataId);
            //         });
            //     }
            // }
            // TrustLicencestart();
        } else if (getPresentStep == "3" || getPresentStep == 3) {
            //minus the data-present-step to both back and forward button
            $(this).attr('data-present-step', '2');
            $(this).siblings('.bussines-forward-btn').attr('data-present-step', '2');
            //activate the next stepper
            $(`.business-create-stepper`).removeClass('is-active');
            $(`.business-create-stepper[data-stepper="2"]`).addClass('is-active');
            //show next content data 
            $(`.business-creation-parts-container[data-step="3"]`).addClass('hide');
            $(`.business-creation-parts-container[data-step="2"]`).removeClass('hide');
            removeLoader();
        } else if (getPresentStep == "2" || getPresentStep == 2) {
            //minus the data-present-step to both back and forward button
            $(this).attr('data-present-step', '1');
            $(this).siblings('.bussines-forward-btn').attr('data-present-step', '1');
            //activate the next stepper
            $(`.business-create-stepper`).removeClass('is-active');
            $(`.business-create-stepper[data-stepper="1"]`).addClass('is-active');
            //show next content data 
            $(`.business-creation-parts-container[data-step="2"]`).addClass('hide');
            $(`.business-creation-parts-container[data-step="1"]`).removeClass('hide');
            //hide back button
            $(this).addClass('hide');
            removeLoader();
        }
    });


    $(document).on('click', '.view-business', function () {
        addLoader();
        sessionStorage.removeItem('business_status');
        var getStatus = $(this).parents('.business-wrapper').attr('data-status');
        var getSocketStatus = $(this).parents('.business-wrapper').attr('data-socket-status');
        var getBusinessId = $(this).parents('.business-wrapper').attr('data-business-id');
        var getBusinessName = $(this).parents('.business-wrapper').find('.business-name span').text();
        // //check role, super-admin, digibiz-admin, module-admin
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     business_id: getBusinessId
        // }
        // viewBusinessCheckRole(reqParam)
        //     .then((response) => {
        if (getStatus == "self-verified" || getStatus == "inactive_pending") {
            // sessionStorage.setItem('business_id', getBusinessId);
            // sessionStorage.setItem('business_profile_socket_status', getSocketStatus)
            // location.hash = `business/management`;
            var requestParams = {
                device_id: crossplat.device.uuid,
                selected: true,
                id: getBusinessId,
                type: "business"
            }
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    sessionStorage.setItem('business_id', getBusinessId);
                    sessionStorage.setItem('business_name', getBusinessName);
                    sessionStorage.setItem('business_profile_socket_status', getSocketStatus)
                    location.hash = `business/management`;
                } else {
                    sessionStorage.setItem('business_id', getBusinessId);
                    sessionStorage.setItem('business_name', getBusinessName);
                    window.sessionStorage.setItem('business_storage_token', JSON.stringify(response.responseJSON.Data));
                    location.hash = `business/storage`;
                }
            }, api.check_token, "POST", "JSON", requestParams);
        } else if (getStatus == "pending") {
            sessionStorage.setItem('business_id', getBusinessId);
            location.hash = `business/add`;
        }
        // else if (getStatus == "pending") {
        //     if (getSocketStatus == "true") {
        //         sessionStorage.setItem('business_id', getBusinessId);
        //         reqParam = {
        //             device_id: crossplat.device.uuid,
        //             id: sessionStorage.getItem('business_id'),
        //             data: {
        //                 socket_enable_status: "false",
        //             }
        //         }
        //         //console.log("reqParam", reqParam);
        //         businessUpdate(reqParam)
        //             .then((response) => {
        //                 //console.log("businessUpdate", response);
        //                 removeLoader();
        //                 location.hash = `business/add`;
        //             })
        //             .catch((err) => {
        //                 //console.log("error in update business api", err);
        //                 if (err.msg == "no updated data found") {
        //                     removeLoader();
        //                     location.hash = `business/add`;
        //                 }
        //             })
        //     } else {//getSocketStatus is false
        //         Materialize.toast(`Access Denied! You or other administrator is creating this business at other place.`, 3000, "round error-alert");
        //         var alert_parms = {
        //             alert_id: "alert-business-device-change-confirm-cancel",
        //             alert_platform: crossplat.device.platform,
        //             alert_title: `Business Alert`,
        //             alert_body: `Access Denied! You or other administrator is creating this business at other place. Would to like to cancel there and continue here?`,
        //             alert_btn: [{
        //                 name: "Yes",
        //                 attr: [{ name: "id", value: "btn-business-device-change-confirm-yes" }]
        //             },
        //             {
        //                 name: "No",
        //                 attr: [{ name: "id", value: "btn-business-device-change-cancel-no" }]
        //             }]
        //         }
        //         showAlert(alert_parms, function () {
        //             removeLoader();
        //             $('#alert-business-device-change-confirm-cancel').attr('data-business-id', getBusinessId); //set getBusinessId
        //         });
        //     }
        // } 
        else if (getStatus == "inactive") {//if u are super-admin, then u are allowed to use the business
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: getBusinessId,
                list_by: "super_admin_active_tab"
            }
            employeeList(reqParam)
                .then((response) => {
                    //console.log("employeeList response", response);
                    var getSuperAdmin = response.find(e => e.account_id == sessionStorage.getItem('account_id'));
                    if (getSuperAdmin != undefined) {
                        sessionStorage.setItem('business_status', 'inactive')
                        sessionStorage.setItem('business_id', getBusinessId);
                        sessionStorage.setItem('business_name', getBusinessName);
                        sessionStorage.setItem('business_profile_socket_status', getSocketStatus)
                        location.hash = `business/management`;
                    } else {
                        removeLoader();
                        Materialize.toast(`Business is inactive.`, 3000, "round error-alert");
                    }
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("employeeList err", err);
                })
        }
        // })
        // .catch((err) => {
        //     removeLoader();
        //     Materialize.toast(`No access to business.`, 3000, 'round success-alert');
        // })

    });

    $(document).on('click', '#btn-business-device-change-cancel-no', function () {
        $('#alert-business-device-change-confirm-cancel').remove();
        var getNavigationPath;
        if (digibiz.business_owner_business_list.length > 0) {
            getNavigationPath = `business_owner/business/list`;
        } else {
            getNavigationPath = `jeevi/app/hub`;
        }
        if ($('body').attr('app') == "business_edit") {
            location.hash = `business/profile/management`;
        } else {
            sessionStorage.removeItem('business_id');
            location.hash = getNavigationPath;
        }
    });

    $(document).on('click', '#btn-business-device-change-confirm-yes', function () {
        addLoader();
        var getBusinessId = $('#alert-business-device-change-confirm-cancel').attr('data-business-id');
        $('#alert-business-device-change-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: getBusinessId
        }
        businessDeviceChange(requestParams)
            .then((response) => {
                //console.log("businessDeviceChange", response);
                if (sessionStorage.getItem('business_id')) {
                    $('#alert-business-device-change-confirm-cancel').remove();
                    // location.hash = `business/edit`;
                    businessAddEditReload();
                } else {
                    sessionStorage.setItem("business_id", getBusinessId);
                    $('#alert-business-device-change-confirm-cancel').remove();
                    // location.hash = `business/add`;
                    businessAddEditReload();
                }
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in changing device");
            })
    });

    $(document).on('click', '#btn-business-changed-device-ok', function () {
        addLoader();
        $('#alert-business-changed-device-confirm').remove();
        $('.filemanger_container_toggle').removeClass('active');
        $('.alert-box-modal').remove();
        if ($('body').attr('app') == "business_edit") {
            location.hash = `business/management`;
        } else {
            // location.hash = `business_owner/business/list`;
            location.hash = `business_owner/business/list`;
        }
    });

    $(document).on('click', '.business_profile_management', function () {
        location.hash = `business/profile/management`;
    });

    $(document).on('click', '.business_profile', function () {
        addLoader();
        var getSocketStatus = sessionStorage.getItem('business_profile_socket_status');
        var getBusinessId = sessionStorage.getItem('business_id');
        if (getSocketStatus == "true") {
            // reqParam = {
            //     device_id: crossplat.device.uuid,
            //     id: sessionStorage.getItem('business_id'),
            //     data: {
            //         socket_enable_status: "false",
            //     }
            // }
            // //console.log("reqParam", reqParam);
            // businessUpdate(reqParam)
            //     .then((response) => {
            //         //console.log("businessUpdate", response);
            //         removeLoader();
            //         location.hash = `business/edit`;
            //     })
            //     .catch((err) => {
            //         //console.log("error in update business api", err);
            //         if (err.msg == "no updated data found") {
            //             removeLoader();
            //             location.hash = `business/edit`;
            //         }
            //     })
            var requestParams = {
                device_id: crossplat.device.uuid,
                selected: true,
                id: sessionStorage.getItem('business_id'),
                type: "business"
            }
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('business_id'),
                        data: {
                            socket_enable_status: "false",
                        }
                    }
                    //console.log("reqParam", reqParam);
                    businessUpdate(reqParam)
                        .then((response) => {
                            //console.log("businessUpdate", response);
                            removeLoader();
                            location.hash = `business/edit`;
                        })
                        .catch((err) => {
                            //console.log("error in update business api", err);
                            if (err.msg == "no updated data found") {
                                removeLoader();
                                location.hash = `business/edit`;
                            }
                        })
                } else {
                    window.sessionStorage.setItem('business_storage_token', JSON.stringify(response.responseJSON.Data));
                    location.hash = `business/storage`;
                }
            }, api.check_token, "POST", "JSON", requestParams);
        } else {
            Materialize.toast(`Access Denied! You or other administrator is creating this business at other place.`, 3000, "round error-alert");
            var alert_parms = {
                alert_id: "alert-business-device-change-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Business Alert`,
                alert_body: `Access Denied! You or other administrator is creating this business at other place. Would to like to cancel there and continue here?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-business-device-change-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-business-device-change-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-business-device-change-confirm-cancel').attr('data-business-id', getBusinessId); //set getBusinessId
            });
        }
    });

    $(document).on('click', '.business_profile_display_control', function () {
        addLoader();
        location.hash = `business_display_control`;
    });

    $(document).on('click', '.employee-management', function () {
        addLoader();
        location.hash = `employee/management/hub`;
    });

    $(document).on('click', '.super-admin-management', function () {
        addLoader();
        var getBusinessRole = sessionStorage.getItem('business_role');
        if (getBusinessRole == "super_admin") {
            location.hash = `super_admin/management/hub`;
        } else {
            var alert_parms = {
                alert_id: "access-denied-business-settings-module-alert",
                alert_platform: crossplat.device.platform,
                alert_title: `Access Denied`,
                alert_body: `Only super-admins can access the module.`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "access-denied-business-settings-module-alert-ok" }]
                }
                ]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });

    $(document).on('click', '#access-denied-business-settings-module-alert-ok', function () {
        $('#access-denied-business-settings-module-alert').remove();
    });


    $(document).on('click', '.customer-management', function () {
        addLoader();
        location.hash = `customer/management/hub`;
    });


    $(document).on('click', '.employee-configurations', function () {
        addLoader();
        location.hash = `employee/configurations`;
    });

    $(document).on('click', '.employee-types', function () {
        addLoader();
        digibiz.employee_types_list = [];
        location.hash = `employee/types`;
    });

    $(document).on('click', '.employee-category', function () {
        addLoader();
        location.hash = `employee/category`;
    });

    $(document).on('click', '.employee-designation', function () {
        addLoader();
        location.hash = `employee/designation`;
    });

    /*******************************EMPLOYEE CREATION MANAGEMENT(starts)****************************/
    $(document).on('click', '.employee-creation', function () {
        addLoader();
        location.hash = `employee_creation/list`;
    });

    $(document).on('click', '.employee-active-tab', function () {
        // addLoader();
        sessionStorage.setItem('selected-employee-tab', "employee_active");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-tab')}"]`).addClass('active');
        activeEmployeeListPage();
    });

    $(document).on('click', '.employee-pending-tab', function () {
        // addLoader();
        sessionStorage.setItem('selected-employee-tab', "employee_pending");
        digibiz.pending_employee_creation_employee_list = [];
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-tab')}"]`).addClass('active');
        pendingEmployeeListPage();
    });

    $(document).on('click', '.employee-alumini-tab', function () {
        // addLoader();
        sessionStorage.setItem('selected-employee-tab', "employee_alumini");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-tab')}"]`).addClass('active');
        aluminiEmployeeListPage();
    });

    $(document).on('click', '#employee_creation_add_button', function () {
        addLoader();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            var RequestTypeParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id')
            }
            employeeTypeList(RequestTypeParams)
                .then((typeResponse) => {
                    var RequestCategoryParams = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id')
                    }
                    employeeCategoryList(RequestCategoryParams)
                        .then((categoryResponse) => {
                            var RequestDesignationParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id')
                            }
                            employeeDesignationList(RequestDesignationParams)
                                .then((designationResponse) => {
                                    location.hash = `employee/create`;
                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast(`Please add Employee Designation Data`, 3000, 'round success-alert');
                                })
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(`Please add Employee Category Data`, 3000, 'round success-alert');
                        })
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`Please add Employee Types Data`, 3000, 'round success-alert');
                })
        } else {//android/ios
            var action_sheet_parms = {
                action_id: "employee_creation_by_selection_modal",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "By Notification",
                    attr: [{ name: "id", value: "employee_by_notification" }]
                },
                {
                    name: "By QR-code",
                    attr: [{ name: "id", value: "employee_by_qr_code" }]
                }
                ]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            });
        }
    });

    //if employee by notification
    $(document).on('click', '#employee_by_notification', function () {
        addLoader();
        $('#employee_creation_by_selection_modal').remove();
        var RequestTypeParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id')
        }
        employeeTypeList(RequestTypeParams)
            .then((typeResponse) => {
                var RequestCategoryParams = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id')
                }
                employeeCategoryList(RequestCategoryParams)
                    .then((categoryResponse) => {
                        var RequestDesignationParams = {
                            device_id: crossplat.device.uuid,
                            business_id: sessionStorage.getItem('business_id')
                        }
                        employeeDesignationList(RequestDesignationParams)
                            .then((designationResponse) => {
                                location.hash = `employee/create`;
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(`Please add Employee Designation Data`, 3000, 'round success-alert');
                            })
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`Please add Employee Category Data`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Please add Employee Types Data`, 3000, 'round success-alert');
            })
    });

    //if employee by QR code
    $(document).on('click', '#employee_by_qr_code', function () {
        addLoader();
        $('#employee_creation_by_selection_modal').remove();
        location.hash = '#employee/scan_qr';
    });

    $(document).on('keydown', '#jeevi_member_field', function () {
        $('#add-employee-mobile-number').val("");
    });

    $(document).on('keydown', '#add-employee-mobile-number', function () {
        $('#jeevi_member_field').val("");
    });

    $(document).on('click', '.employee-forward-btn', function () {
        addLoader();
        var getPresentStep = $(this).attr('data-present-step');
        if (getPresentStep == "1" || getPresentStep == 1) {
            if (validateAddNewEmployee()) {
                // var getFirstName = getInputText($('#employee_first_name')).trim();
                // var getMiddleName = getInputText($('#employee_middle_name')).trim();
                // var getLastName = getInputText($('#employee_last_name')).trim();
                var type;
                if ($('#jeevi_member_field').val().length > 0) {
                    var unique_name = $('#jeevi_member_field').val();
                    //console.log("unique name", unique_name);
                    type = "unique_name";
                } else if ($('#add-employee-mobile-number').val().length > 0) {
                    var mobileNumber = $('#add-employee-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
                    //console.log("mobileNumber", mobileNumber);
                    type = "mobile_number";
                }
                if (sessionStorage.getItem('employee_id') && sessionStorage.getItem('employee_id') !== null && sessionStorage.getItem('employee_id') !== undefined) {
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('employee_id'),
                        data: {
                            // name: {
                            //     first: getFirstName,
                            //     middle: getMiddleName,
                            //     last: getLastName
                            // },
                            mobile_number: mobileNumber
                        }
                    }
                    employeeUpdate(requestParams)
                        .then((response) => {
                            removeLoader();
                            sessionStorage.setItem('employee_id', response.dj_unique_employee_id);
                            //update the next and back button with step 2
                            $('.employee-back-btn').attr('data-present-step', '2');
                            $(this).attr('data-present-step', '2');
                            //update the stepper
                            $('.employee-create-stepper').removeClass('is-active');
                            $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                            //show the next content
                            $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                            $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                            //show back button
                            // $('.employee-back-btn').removeClass('hide');
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast("Error in uploading the employee", 3000, 'round success-alert');
                        })
                } else {
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id'),
                        unique_name: unique_name,
                        type: type,
                        mobile_number: mobileNumber
                    }
                    employeeAdd(requestParams)
                        .then((response) => {
                            removeLoader();
                            sessionStorage.setItem('employee_id', response.dj_unique_employee_id);
                            //update the next and back button with step 2
                            $('.employee-back-btn').attr('data-present-step', '2');
                            $(this).attr('data-present-step', '2');
                            //update the stepper
                            $('.employee-create-stepper').removeClass('is-active');
                            $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                            //show the next content
                            $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                            $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                        })
                        .catch((err) => {
                            removeLoader();
                            if (err.msg == "Already Present") {
                                Materialize.toast("This employee is already present", 3000, 'round success-alert');
                            } else if (err.msg == "Not in DJ platform") {
                                Materialize.toast("Not in DJ platform", 3000, 'round success-alert');
                            } else {
                                Materialize.toast("Error in adding the employee", 3000, 'round success-alert');
                            }
                        })
                }
            } else {
                removeLoader();
                Materialize.toast("Error in validating employee", 3000, 'round success-alert');
            }
        } else if (getPresentStep == "2" || getPresentStep == 2) {
            if (validateEmployeeStepTwo()) {
                var getEmail = $('#employee_email').text().trim();
                var getAlternateEmail = $('#employee_alternate_email').text().trim();
                var getCompanyEmployeeId = $('#employee_company_employee_id').text().trim();
                var getDisplayName = $('#employee_display_name').text().trim();
                if ($('#add-employee-display-phone-number').val().trim().length > 0) {
                    var getDisplayphoneNumber = $('#add-employee-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
                } else {
                    var getDisplayphoneNumber;
                }
                var getDateOfJoining = $('#employee_date_of_joining').val().trim();
                var getDateOfBirth = $('#employee_date_of_birth').val().trim();
                var weddingAnniversary = $('#employee_wedding_anniversary').val().trim();
                // var getEmployeeType = $('#employee-type-choose-select-dropdown').val();                
                // var getEmployeeCategory = $('#employee-category-choose-select-dropdown').val();
                // var getEmployeeDesignation = $('#employee-designation-choose-select-dropdown').val();
                var getEmployeeType = $('.selected-value-employee-type').attr('data-id');
                var getEmployeeCategory = $('.selected-value-employee-category').attr('data-id');
                var getEmployeeDesignation = $('.selected-value-employee-designation').attr('data-id');
                var requestParams;
                //save identity-pic
                // saveIdentityPicture(function (err, identityResponse) {
                //     if (err) {
                //         removeLoader();
                //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                //     } else {
                //         var resultData = identityResponse;
                //         //console.log("resultData", resultData);
                //         var employeeIdentityPictureData = {};
                //         if (resultData != undefined) {
                //             employeeIdentityPictureData = {
                //                 asset_id: resultData.Data.asset_id,
                //                 storage_id: resultData.Data.filename
                //             }
                //         }
                // if ($('#employee_email').text().length > 0) {
                requestParams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('employee_id'),
                    data: {
                        type: getEmployeeType,
                        category: getEmployeeCategory,
                        designation: getEmployeeDesignation,
                        email: getEmail,
                        alternate_email: getAlternateEmail,
                        date_of_joining: getDateOfJoining,
                        date_of_birth: getDateOfBirth,
                        wedding_anniversary: weddingAnniversary,
                        company_employee_id: getCompanyEmployeeId,
                        display_name: firstLetterUpperCase(getDisplayName),
                        display_phone_number: getDisplayphoneNumber,
                        // identity_picture: employeeIdentityPictureData
                    }
                }
                // } else {
                //     requestParams = {
                //         device_id: crossplat.device.uuid,
                //         id: sessionStorage.getItem('employee_id'),
                //         data: {
                //             type: getEmployeeType,
                //             category: getEmployeeCategory,
                //             designation: getEmployeeDesignation,
                //             date_of_joining: getDateOfJoining,
                //             company_employee_id: getCompanyEmployeeId,
                //             display_name: getDisplayName,
                //             display_phone_number: getDisplayphoneNumber,
                //             // identity_picture: employeeIdentityPictureData
                //         }
                //     }
                // }
                employeeUpdate(requestParams)
                    .then((response) => {
                        //console.log("response", response);
                        removeLoader();
                        //update the next and back button with step 3
                        $('.employee-back-btn').attr('data-present-step', '3');
                        $('.employee-forward-btn').attr('data-present-step', '3');
                        //update the stepper
                        $('.employee-create-stepper').removeClass('is-active');
                        $(`.employee-create-stepper[data-stepper="3"]`).addClass('is-active');
                        //show the next content
                        $(`.employee-creation-parts-container[data-step="2"]`).addClass('hide');
                        $(`.employee-creation-parts-container[data-step="3"]`).removeClass('hide');
                        // //hide forward button
                        // $('.employee-forward-btn').addClass('hide');
                        //show back button
                        $('.employee-back-btn').removeClass('hide');
                        // //show register button
                        // $('.register-employee-btn').removeClass('hide');
                    })
                    .catch((err) => {
                        if (err.msg == "no updated data found") {
                            removeLoader();
                            //update the next and back button with step 3
                            $('.employee-back-btn').attr('data-present-step', '3');
                            $('.employee-forward-btn').attr('data-present-step', '3');
                            //update the stepper
                            $('.employee-create-stepper').removeClass('is-active');
                            $(`.employee-create-stepper[data-stepper="3"]`).addClass('is-active');
                            //show the next content
                            $(`.employee-creation-parts-container[data-step="2"]`).addClass('hide');
                            $(`.employee-creation-parts-container[data-step="3"]`).removeClass('hide');
                            //hide forward button
                            // $('.employee-forward-btn').addClass('hide');
                            //show back button
                            $('.employee-back-btn').removeClass('hide');
                            //show register button
                            // $('.register-employee-btn').removeClass('hide');
                        }
                        //console.log("error in employeeUpdate");
                    })
                //     }
                // })
            } else {
                removeLoader();
                //console.log("error in validateEmployeeStepTwo");
            }
        } else if (getPresentStep == "3" || getPresentStep == 3) {
            if ($('.employee-department-assignment-box').length > 0) {
                var getEmail = $('#employee_email').text().trim();
                var getAlternateEmail = $('#employee_alternate_email').text().trim();
                var getCompanyEmployeeId = $('#employee_company_employee_id').text().trim();
                var getDisplayName = $('#employee_display_name').text().trim();
                if ($('#add-employee-display-phone-number').val().trim().length > 0) {
                    var getDisplayphoneNumber = $('#add-employee-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
                } else {
                    var getDisplayphoneNumber;
                }
                var getDateOfJoining = $('#employee_date_of_joining').val().trim();
                // var getEmployeeType = $('#employee-type-choose-select-dropdown').val();                
                // var getEmployeeCategory = $('#employee-category-choose-select-dropdown').val();
                // var getEmployeeDesignation = $('#employee-designation-choose-select-dropdown').val();
                var getEmployeeType = $('.selected-value-employee-type').attr('data-id');
                var getEmployeeCategory = $('.selected-value-employee-category').attr('data-id');
                var getEmployeeDesignation = $('.selected-value-employee-designation').attr('data-id');
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('employee_id'),
                    data: {
                        type: getEmployeeType,
                        category: getEmployeeCategory,
                        designation: getEmployeeDesignation,
                        email: getEmail,
                        alternate_email: getAlternateEmail,
                        date_of_joining: getDateOfJoining,
                        company_employee_id: getCompanyEmployeeId,
                        display_name: firstLetterUpperCase(getDisplayName),
                        display_phone_number: getDisplayphoneNumber,
                        status: "active"//imp
                    }
                }
                employeeUpdate(requestParams)
                    .then((response) => {
                        //update the next and back button with step 4
                        $('.employee-back-btn').attr('data-present-step', '4');
                        $('.employee-forward-btn').attr('data-present-step', '4');
                        //update the stepper
                        $('.employee-create-stepper').removeClass('is-active');
                        $(`.employee-create-stepper[data-stepper="4"]`).addClass('is-active');
                        //show the next content
                        $(`.employee-creation-parts-container[data-step="3"]`).addClass('hide');
                        $(`.employee-creation-parts-container[data-step="4"]`).removeClass('hide');
                        //hide forward button
                        $('.employee-forward-btn').addClass('hide');
                        //show back button
                        $('.employee-back-btn').removeClass('hide');
                        // //show register button
                        // $('.register-employee-btn').removeClass('hide');
                        removeLoader();
                    })
                    .catch((err) => {
                        if (err.msg == "no updated data found") {
                            //update the next and back button with step 4
                            $('.employee-back-btn').attr('data-present-step', '4');
                            $('.employee-forward-btn').attr('data-present-step', '4');
                            //update the stepper
                            $('.employee-create-stepper').removeClass('is-active');
                            $(`.employee-create-stepper[data-stepper="4"]`).addClass('is-active');
                            //show the next content
                            $(`.employee-creation-parts-container[data-step="3"]`).addClass('hide');
                            $(`.employee-creation-parts-container[data-step="4"]`).removeClass('hide');
                            //hide forward button
                            $('.employee-forward-btn').addClass('hide');
                            //show back button
                            $('.employee-back-btn').removeClass('hide');
                            // //show register button
                            // $('.register-employee-btn').removeClass('hide');
                            removeLoader();
                        } else {
                            removeLoader();
                            //console.log("error in employeeUpdate");
                        }
                    });
            } else {
                removeLoader();
                Materialize.toast("Please assign department to the employee", 3000, 'round success-alert');
            }
        }

    });

    $(document).on('click', '.employee-back-btn', function () {
        addLoader();
        var getPresentStep = $(this).attr('data-present-step');
        if (getPresentStep == "4" || getPresentStep == 4) {
            //update the next and back button with step 3
            $('.employee-forward-btn').attr('data-present-step', '3');
            $(this).attr('data-present-step', '3');
            //update the stepper
            $('.employee-create-stepper').removeClass('is-active');
            $(`.employee-create-stepper[data-stepper="3"]`).addClass('is-active');
            //show the back content
            $(`.employee-creation-parts-container[data-step="4"]`).addClass('hide');
            $(`.employee-creation-parts-container[data-step="3"]`).removeClass('hide');
            //show forward button
            $('.employee-forward-btn').removeClass('hide');
            //  //hide back button
            //  $('.employee-back-btn').addClass('hide');
            // //hide register button
            // $('.register-employee-btn').addClass('hide');
            removeLoader();
        } else if (getPresentStep == "3" || getPresentStep == 3) {
            //update the next and back button with step 2
            $('.employee-forward-btn').attr('data-present-step', '2');
            $(this).attr('data-present-step', '2');
            //update the stepper
            $('.employee-create-stepper').removeClass('is-active');
            $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
            //show the back content
            $(`.employee-creation-parts-container[data-step="3"]`).addClass('hide');
            $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
            //show forward button
            $('.employee-forward-btn').removeClass('hide');
            //hide back button
            $('.employee-back-btn').addClass('hide');
            // //hide register button
            // $('.register-employee-btn').addClass('hide');
            removeLoader();
        } else if (getPresentStep == "2" || getPresentStep == 2) {
            //update the next and back button with step 2
            $('.employee-forward-btn').attr('data-present-step', '1');
            $(this).attr('data-present-step', '1');
            //update the stepper
            $('.employee-create-stepper').removeClass('is-active');
            $(`.employee-create-stepper[data-stepper="1"]`).addClass('is-active');
            //show the back content
            $(`.employee-creation-parts-container[data-step="2"]`).addClass('hide');
            $(`.employee-creation-parts-container[data-step="1"]`).removeClass('hide');
            //hide back button
            $('.employee-back-btn').addClass('hide');
            removeLoader();
        }

    });

    $(document).on('click', '.cancel-employee-btn', function () {
        // sessionStorage.removeItem('employee_id');
        // location.hash = `employee_creation/list`;
        addLoader();
        appScroll.scrollBar('#main-container').destroy();
        if (sessionStorage.getItem('employee_id')) {
            if (sessionStorage.getItem('digibiz_role') == "employee") {
                // sessionStorage.removeItem('business_id');
                // sessionStorage.removeItem('employee_id');
                // location.hash = `employee/business/list`;
                sessionStorage.removeItem('edit_from');
                location.hash = `employee/profile`;
            } else {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('employee_id'),
                    data: {
                        socket_enable_status: "true",
                        update_for: "socket_enable_status"
                    }
                }
                //console.log("reqParam", reqParam);
                employeeUpdate(reqParam)
                    .then((response) => {
                        //console.log("employeeUpdate", response);
                        sessionStorage.removeItem('employee_id');
                        sessionStorage.removeItem('employee_name');
                        location.hash = `employee_creation/list`;
                    })
                    .catch((err) => {
                        //console.log("error in update business api", err);
                        if (err.msg == "no updated data found") {
                            sessionStorage.removeItem('employee_id');
                            sessionStorage.removeItem('employee_name');
                            location.hash = `employee_creation/list`;
                        }
                    })
            }
        } else {
            location.hash = `employee_creation/list`;
        }
    });

    // $(document).on('click', '.register-employee-btn', function () {
    //     addLoader();
    //     if ($('.employee-department-assignment-box').length > 0) {
    //         var requestParams = {
    //             device_id: crossplat.device.uuid,
    //             id: sessionStorage.getItem('employee_id'),
    //             data: {
    //                 status: "active",
    //                 socket_enable_status: "true",
    //             }
    //         }
    //         employeeUpdate(requestParams)
    //             .then((response) => {
    //                 sessionStorage.removeItem('employee_id');
    //                 location.hash = `employee_creation/list`;
    //                 removeLoader();
    //                 Materialize.toast("SuccessFully Registered", 3000, 'round success-alert');
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 //console.log("err in registering", err);
    //             });
    //     } else {
    //         removeLoader();
    //         Materialize.toast("Please assign department to the employee", 3000, 'round success-alert');
    //     }
    // });

    $(document).on('click', '.notify-employee-btn', function () {
        addLoader();
        var data_type;
        if ($('#jeevi_member_field').val().trim().length > 0) {
            var unique_name = $('#jeevi_member_field').val().trim();
            data_type = "unique_name";
        } else if ($('#add-employee-mobile-number').val().trim().length > 0) {
            var mobileNumber = $('#add-employee-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
            data_type = "mobile_number";
        }
        //console.log("data_type", data_type);
        if (data_type == null || data_type == undefined || data_type == "") {
            removeLoader();
            Materialize.toast(`Please enter data`, 3000, 'round success-alert');
        } else {
            var reqParam = {
                device_id: crossplat.device.uuid,
                data_type: data_type,
                add_type: "add",
                type: "employee",
                business_id: sessionStorage.getItem('business_id'),
                unique_name: unique_name,
                mobile_number: mobileNumber
            }
            notificationAdd(reqParam)
                .then((response) => {
                    //console.log("notificationAdd response", response);
                    Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                    location.hash = `employee_creation/list`;
                })
                .catch((err) => {
                    //console.log("notificationAdd error", err);
                    Materialize.toast(err.msg, 3000, 'round success-alert');
                    removeLoader();
                });
        }
    });

    //resent notification
    $(document).on('click', '#resent-notification', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            add_type: "resend",
            contact_user_id: sessionStorage.getItem('contact_user_id'),
        }
        notificationAdd(reqParam)
            .then((response) => {
                //console.log("notificationAdd response", response);
                Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                location.hash = `employee_creation/list`;
            })
            .catch((err) => {
                //console.log("notificationAdd error", err);
                Materialize.toast(err.msg, 3000, 'round success-alert');
                removeLoader();
            });
    });

    //employee groups(from employee management hub)
    $(document).on('click', '.employee-group-creation', function () {
        addLoader();
        location.hash = `employee_group_creation/list`;
    });

    //on click of view-employee-group
    $(document).on('click', '.view-employee-group', function () {
        addLoader();
        var getGroupId = $(this).parents('.employee-group-wrapper').attr('data-group-id');
        var getGroupType = $(this).parents('.employee-group-wrapper').attr('data-type');
        var getGroupCreatedStatus = $(this).parents('.employee-group-wrapper').attr('data-created_status');
        var socket_enable_status = $(this).parents('.employee-group-wrapper').attr('data-socket_enable_status');
        if (getGroupType == "custom") {
            var getCustomGroupFrom = $(this).parents('.employee-group-wrapper').attr('data-group-from');
            sessionStorage.setItem('group_from', getCustomGroupFrom);
        }
        if (getGroupCreatedStatus && getGroupCreatedStatus == "progress") {
            removeLoader();
            Materialize.toast(`Group creation/updation in progress, please wait......might take few moments`, 3000, 'round error-alert');
        } else {
            if (socket_enable_status == "true") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: getGroupId,
                    data: {
                        socket_enable_status: "false",
                        update_for: "socket_enable_status"
                    }
                }
                //console.log("reqParam", reqParam);
                employeeGroupUpdate(reqParam)
                    .then((response) => {
                        console.log('response', response);
                    }).catch((err) => {
                        console.log('err', err);
                    })

                sessionStorage.setItem('group_type', getGroupType);
                sessionStorage.removeItem('group_id');
                sessionStorage.setItem('group_id', getGroupId);
                location.hash = `employee/group/create`;
            } else {
                Materialize.toast(`Access Denied! You or other administrator is updating this group at other place.`, 3000, "round error-alert");
                var alert_parms = {
                    alert_id: "alert-group-device-change-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Access Denied! You or other administrator is updating this group at other place. Would to like to cancel there and continue here?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-group-device-change-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-group-device-change-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                    $('#alert-group-device-change-confirm-cancel').attr('data-group-id', getGroupId); //set getEmployeeId
                    $('#alert-group-device-change-confirm-cancel').attr('data-group-type', getGroupType); //set getEmployeeId
                });
            }
        }
    });

    $(document).on('click', '#btn-group-device-change-cancel-no', function () {
        $('#alert-group-device-change-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-group-device-change-confirm-yes', function () {
        addLoader();
        var getGroupId = $('#alert-group-device-change-confirm-cancel').attr('data-group-id');
        var getGroupType = $('#alert-group-device-change-confirm-cancel').attr('data-group-type');
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: getGroupId,
            group_type: getGroupType,
            business_id: sessionStorage.getItem('business_id')
        }
        groupDeviceChange(requestParams)
            .then((response) => {
                //console.log("employeeDeviceChange", response);
                sessionStorage.setItem('group_type', getGroupType);
                sessionStorage.removeItem('group_id');
                sessionStorage.setItem('group_id', getGroupId);
                //console.log("success in changing device");
                $('#alert-group-device-change-confirm-cancel').remove();
                if ($('body').attr("app") == "customer_groups_identifiers_list") {
                    location.hash = `customer/group_details`;
                } else if ($('body').attr("app") == "communication_groups") {
                    location.hash = `communication/group_details`;
                } else if ($('body').attr("app") == "collaborator_groups_list") {
                    location.hash = `collaborator/group_details`;
                } else if ($('body').attr("app") == "team_group_creation_list") {
                    location.hash = `teams/group/create`;
                } else if ($('body').attr("app") == "customer_groups_list") {
                    location.hash = `customer/group_details`;
                } else {
                    location.hash = `employee/group/create`;
                }

            })
            .catch((err) => {
                removeLoader();
                //console.log("error in changing device");
            })
    });

    $(document).on('click', '#btn-group-changed-device-ok', function () {
        console.log('comming group change');
        addLoader();
        $('#alert-group-changed-device-confirm').remove();
        sessionStorage.removeItem('group_id');
        sessionStorage.removeItem('group_type');
        sessionStorage.removeItem('group_from');
        if ($('body').attr("app") == "employee_group_create") {
            location.hash = `employee_group_creation/list`;
        } else if ($('body').attr("app") == "customer_groups_details") {
            location.hash = `customer/groups/identifiers/list`;
        } else if ($('body').attr("app") == "communication_group_details") {
            location.hash = `communication/groups`;
        } else if ($('body').attr("app") == "collaborator_group_details") {
            location.hash = `collaborator/groups/list`;
        }
    });

    //delete employee from custom-employee_list group
    $(document).on('click', '#delete_custom_employee_group_member', function () {
        addLoader();
        var getMemberId = $(this).attr('data-member-id');
        var alert_parms = {
            alert_id: "alert-delete-custom-employee-list-group-employee-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Member`,
            alert_body: `Are you sure you want to delete the member?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-custom-employee-list-group-employee-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-custom-employee-list-group-employee-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-custom-employee-list-group-employee-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
        });
    });



    $(document).on('click', '#btn-employee-changed-device-ok', function () {
        console.log('comming');
        addLoader();
        $('#alert-employee-changed-device-confirm').remove();
        sessionStorage.removeItem('employee_id');
        location.hash = `employee_creation/list`;
    });

    //Delete no employee member
    $(document).on('click', '#btn-delete-custom-employee-list-group-employee-cancel-no', function () {
        $('#alert-delete-custom-employee-list-group-employee-confirm-cancel').remove();
    });

    //Delete yes employee member
    $(document).on('click', '#btn-delete-custom-employee-list-group-employee-confirm-yes', function () {
        addLoader();
        var getMemberId = $('#alert-delete-custom-employee-list-group-employee-confirm-cancel').attr('data-member-id');
        $('#alert-delete-custom-employee-list-group-employee-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            id: getMemberId
        }
        checkGroupMemberDelete(requestParams)
            .then((result) => {
                groupMemberDelete(requestParams)
                    .then((response) => {
                        $(`.custom-employee-group-member-wrapper[data-member-id="${getMemberId}"]`).remove();
                        removeLoader();
                        Materialize.toast(`Successfully removed employee`, 3000, 'round success-alert');
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("Error in member removing");
                        Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                // Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                if (err.msg == "Minimum 2 members are required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 2 members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 1 moderator is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-moderator-ok",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 moderator is required. Please add moderator to delete the selected member.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-moderator-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    removeLoader();
                }
            })
    });


    //delete department from custom-department_list group
    $(document).on('click', '#delete_custom_department_list_group_department', function () {
        addLoader();
        var getDepartmentId = $(this).attr('data-department-id');
        var alert_parms = {
            alert_id: "alert-delete-custom-department-list-group-department-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Department`,
            alert_body: `Are you sure you want to delete the department?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-custom-department-list-group-department-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-custom-department-list-group-department-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-custom-department-list-group-department-confirm-cancel').attr('data-department-id', getDepartmentId); //set getDepartmentId
        });
    });

    //Delete no department member
    $(document).on('click', '#btn-delete-custom-department-list-group-department-cancel-no', function () {
        $('#alert-delete-custom-department-list-group-department-confirm-cancel').remove();
    });

    //Delete yes department member
    $(document).on('click', '#btn-delete-custom-department-list-group-department-confirm-yes', function () {
        addLoader();
        var getDepartmentId = $('#alert-delete-custom-department-list-group-department-confirm-cancel').attr('data-department-id');
        $('#alert-delete-custom-department-list-group-department-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id'),
            department_id: getDepartmentId
        }
        employeeGroupDepartmentDelete(requestParams)
            .then((response) => {
                //console.log("employeeGroupDepartmentDelete response", response);
                $(`.custom-employee-group-member-wrapper[data-department-id="${getDepartmentId}"]`).remove();
                removeLoader();
                Materialize.toast(`Successfully removed department`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                //console.log("Error in department removing");
                Materialize.toast(`Error in department removing`, 3000, 'round success-alert');
            })
    });

    //add employee group button
    $(document).on('click', '#add-custom-employee-group-btn', function () {
        addLoader();
        sessionStorage.setItem('group_type', "custom");
        location.hash = `employee/group/create`;
    });


    //add employee group members button
    $(document).on('click', '#add_employee_group_employee_btn', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            var action_sheet_parms = {
                action_id: "employee_group_creation_add_members_type",
                action_platform: crossplat.device.platform,
                action_title: "Add by",
                action_btn: [{
                    name: "Employee List",
                    attr: [{ name: "id", value: "employee_group_creation_add_members_by_employee_list" }]
                },
                // {
                //     name: "Department List",
                //     attr: [{ name: "id", value: "employee_group_creation_add_members_by_department_list" }]
                // },
                {
                    name: "Standard Groups",
                    attr: [{ name: "id", value: "employee_group_creation_add_members_by_standard_group" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $('#employee_group_creation_add_members_type').addClass('hide');
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    $('#employee_group_creation_add_members_by_employee_list').trigger('click');
                } else if (sessionStorage.getItem('group_from') == "department_list") {
                    $('#employee_group_creation_add_members_by_department_list').trigger('click');
                } else if (sessionStorage.getItem('group_from') == "standard_group") {
                    $('#employee_group_creation_add_members_by_standard_group').trigger('click');
                } else {
                    $('#employee_group_creation_add_members_type').removeClass('hide');
                }
                removeLoader();
            });
        } else {
            var action_sheet_parms = {
                action_id: "employee_group_creation_add_members_type",
                action_platform: crossplat.device.platform,
                action_title: "Add by",
                action_btn: [{
                    name: "Employee List",
                    attr: [{ name: "id", value: "employee_group_creation_add_members_by_employee_list" }]
                },
                // {
                //     name: "Department List",
                //     attr: [{ name: "id", value: "employee_group_creation_add_members_by_department_list" }]
                // },
                {
                    name: "Standard Groups",
                    attr: [{ name: "id", value: "employee_group_creation_add_members_by_standard_group" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $('#employee_group_creation_add_members_type').addClass('hide');
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    $('#employee_group_creation_add_members_by_employee_list').trigger('click');
                } else if (sessionStorage.getItem('group_from') == "department_list") {
                    $('#employee_group_creation_add_members_by_department_list').trigger('click');
                } else if (sessionStorage.getItem('group_from') == "standard_group") {
                    $('#employee_group_creation_add_members_by_standard_group').trigger('click');
                } else {
                    $('#employee_group_creation_add_members_type').removeClass('hide');
                }
                removeLoader();
            });
        }
    });

    $(document).on('click', '.filemanager-file-wrapper', function () {
        $(this).siblings('.file-select').find('input').trigger('click');
    });

    //add members by employee list
    $(document).on('click', '#employee_group_creation_add_members_by_employee_list', function () {
        addLoader();
        sessionStorage.setItem('group_from', 'employee_list');
        $('#employee_group_creation_add_members_type').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        employeeList(reqParam)
            .then((response) => {
                let unique_member = [];
                $.each(response, function (index, value) {
                    unique_member.push(value);
                });
                digibiz.employee_group_employee_members = response;
                //get latest added contact/ get already present employees in the group
                if (sessionStorage.getItem('group_id')) {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: sessionStorage.getItem('group_id')
                    }
                    // getGroupMembers(reqParam)
                    //     .then((result) => {
                    // $.each(result, function (index, element) {
                    //     unique_member = unique_member.filter(function (e) {
                    //         return e.dj_unique_employee_id != element.member.dj_unique_employee_id;
                    //     });
                    // });
                    var EmployeeList = {
                        EmployeeList: unique_member.map(e => {
                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.name.first.charAt(0);
                                // } else {
                                //     e['imageLetter'] = e.name.first.charAt(0);
                                // }
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                            return e;
                        })
                    }
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-employee-selection",
                            modal_header: "Employee List",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-selected-employees-group",
                            }]
                        }
                        showModal(modal_data, function () {
                            //add search element
                            $('.employee-selection-member-list').prepend(`<div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                    </div>
                                </div>`);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            }

                            listenForEmployeeSelectionListScrollEvent($(".modal-popup-content"));
                            removeLoader();
                            setTimeout(function () {
                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                var element = $('#employee-list-selection-search-btn').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        digibiz.searched_employee_list = [];
                                                        if ($('#modal-employee-selection').length > 0) {
                                                            if (sessionStorage.getItem('group_from') == "employee_list") {
                                                                data['index'] = 'getEmployeeContactListAllEmployees';
                                                                data['business_id'] = sessionStorage.getItem('business_id'),
                                                                    data['count'] = 10,
                                                                    data['offset'] = 0
                                                            }
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-employee-selection').length > 0) {
                                                            //console.log("ERROR", unique_member)
                                                            processSearchedEmployeeGroupEmployeeSelectionList(unique_member, function () { })
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                            if ($('#modal-employee-selection').length > 0) {
                                                //console.log("CLOSED", unique_member)
                                                processSearchedEmployeeGroupEmployeeSelectionList(unique_member, function () { })
                                            }
                                        }
                                    })
                                }
                            }, 0);
                        });
                    }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);
                    // })
                    // .catch((err) => {
                    //     //console.log("no earlier members found in the group")
                    // })
                } else {
                    $.each($("input[name='selectedmembers[]']"), function (index, element) {
                        // unique_member = unique_member.filter(function (e) {
                        //     return e.dj_unique_employee_id != $(element).val();
                        // });
                    });
                    var EmployeeList = {
                        EmployeeList: unique_member.map(e => {
                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.name.first.charAt(0);
                                // } else {
                                //     e['imageLetter'] = e.name.first.charAt(0);
                                // }
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                            return e;
                        })
                    }
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-employee-selection",
                            modal_header: "Employee List",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-selected-employees-group",
                            }]
                        }
                        showModal(modal_data, function () {
                            //add search element
                            $('.employee-selection-member-list').prepend(`<div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                    </div>
                                </div>`);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            }
                            listenForEmployeeSelectionListScrollEvent($(".modal-popup-content"));
                            removeLoader();
                            setTimeout(function () {
                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                var element = $('#employee-list-selection-search-btn').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'employee_group_create':
                                                    digibiz.searched_employee_list = [];
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-employee-selection').length > 0) {
                                                            if (sessionStorage.getItem('group_from') == "employee_list") {
                                                                data['index'] = 'getEmployeeContactListAllEmployees';
                                                                data['business_id'] = sessionStorage.getItem('business_id')
                                                            }
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-employee-selection').length > 0) {
                                                            //console.log("ERROR", unique_member)
                                                            processSearchedEmployeeGroupEmployeeSelectionList(unique_member, function () { })
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                            if ($('#modal-employee-selection').length > 0) {
                                                //console.log("CLOSED", unique_member)
                                                processSearchedEmployeeGroupEmployeeSelectionList(unique_member, function () { })
                                            }
                                        }
                                    })
                                }
                            }, 0);
                        });
                    }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);
                }

            })
            .catch((err) => {
                removeLoader();
                sessionStorage.removeItem('group_from'); //if no employees found, they should get the action sheet to choose between employee list and department list
                Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
            })
    });

    //add members by department list
    // $(document).on('click', '#employee_group_creation_add_members_by_department_list', function () {
    //     addLoader();
    //     sessionStorage.setItem('group_from', 'department_list');
    //     $('#employee_group_creation_add_members_type').remove();
    //     // //remove already present customers in the group
    //     // var getMembers = [];
    //     // if ($('.employee-group-member-wrapper').length > 0) {
    //     //     $.each($('.employee-group-member-wrapper'), function (index, element) {
    //     //         getMembers.push({
    //     //             id: $(element).attr('data-department-id'),
    //     //             type: "new_member"
    //     //         });
    //     //     });
    //     // }
    //     // if ($('#employee-group-members-list').find('.custom-employee-group-member-wrapper').length > 0) {
    //     //     $.each($('#employee-group-members-list .custom-employee-group-member-wrapper'), function (index, element) {
    //     //         getMembers.push({
    //     //             id: $(element).attr('data-department-id'),
    //     //             type: "old_member"
    //     //         });
    //     //     });
    //     // }
    //     var reqParams = {
    //         device_id: crossplat.device.uuid,
    //         list_by: "department",
    //         business_id: sessionStorage.getItem('business_id')
    //     }
    //     departmentList(reqParams)
    //         .then((departmentResponse) => {
    //             //console.log("departmentResponse", departmentResponse);
    //             var departmentListResponse = {
    //                 departmentList: departmentResponse
    //             }
    //             fetch.getHtml(function (fetcherror, html) {
    //                 var modal_data = {
    //                     modal_id: "custom-employee-group-department-list-modal",
    //                     modal_header: "Department List",
    //                     modal_platform: crossplat.device.platform,
    //                     modal_body: html,
    //                     modal_action_buttons: [{
    //                         "name": "Confirm",
    //                         "id": "custom_employee_group_department_list_confirm",
    //                     }]
    //                 }
    //                 showModal(modal_data, function () {
    //                     // if (getMembers.length > 0) {
    //                     //     $.each(getMembers, function (index, element) {
    //                     //         if (element.type == "new_member") {
    //                     //             $(`.employee-group-member-wrapper[data-department-id="${element.id}"]`).remove();
    //                     //         } else if (element.type == "old_member") {
    //                     //             $('#employee-group-members-list').find(`.custom-employee-group-member-wrapper[data-department-id="${element.id}"]`).remove();
    //                     //         }
    //                     //     })
    //                     // }
    //                     removeLoader();
    //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                     } else {
    //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                     }
    //                 });
    //             }, 'layouts/popup/employee_department_assignment_list', '#employee-department-assignment-template', departmentListResponse);
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             sessionStorage.removeItem('group_from'); //if no department found, they should get the action sheet to choose between employee list and department list
    //             //console.log("error in department list");
    //         })
    // });

    //add members by standard employee groups(only draft/active)
    $(document).on('click', '#employee_group_creation_add_members_by_standard_group', function () {
        addLoader();
        sessionStorage.setItem('group_from', 'standard_group');
        $('#employee_group_creation_add_members_type').remove();//close action sheet
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "employee",
            list_by: "draft_active_standard_employee_groups",
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        groupsList(reqParam)
            .then((response) => {
                //should show only unique groups
                let unique_member = [];
                $.each(response, function (index, value) {
                    unique_member.push(value);
                });
                digibiz.employee_group_standard_group_members = response;
                //get latest added standrad group/ get already present standard groups in the group
                if (sessionStorage.getItem('group_id')) {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: sessionStorage.getItem('group_id'),
                        count: 20,
                        offset: 0
                    }
                    getGroupMembers(reqParam)
                        .then((memresponse) => {
                            var result = memresponse.membersList;
                            // $.each(result, function (index, element) {
                            //     unique_member = unique_member.filter(function (e) {
                            //         return e.id != element.member.id;
                            //     });
                            // });
                            var standardGroupList = {
                                standardGroupList: unique_member.map(e => {
                                    // if (e.hasOwnProperty('display_picture') && e.display_picture) {
                                    //     if (e.display_picture.hasOwnProperty('asset_id') && e.display_picture.asset_id) {
                                    //         var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                    //         e.display_picture['avtarUrl'] = avtarUrl;
                                    //     } else {
                                    //         e['imageLetter'] = e.name.charAt(0);
                                    //     }
                                    // } else {
                                    //     e['imageLetter'] = e.name.charAt(0);
                                    // }
                                    if (e.hasOwnProperty('group_image') && e.group_image) {
                                        if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                            var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&asset_id=${e.group_image.asset_id}&business_id=${e.business_id}`;
                                            e.group_image['avtarUrl'] = avtarUrl;
                                            e['imageLetter'] = e.name.charAt(0);
                                        } else {
                                            e['imageLetter'] = e.name.charAt(0);
                                        }
                                    } else {
                                        e['imageLetter'] = e.name.charAt(0);
                                    }
                                    return e;
                                })
                            }
                            fetch.getHtml(function (fetcherror, html) {
                                var modal_data = {
                                    modal_id: "modal-standard-employee-group-selection",
                                    modal_header: "Standard Employee Groups",
                                    modal_platform: crossplat.device.platform,
                                    modal_body: html,
                                    modal_action_buttons: [{
                                        "name": "Add",
                                        "id": "add-selected-standard-employee-group",
                                    }]
                                }
                                showModal(modal_data, function () {
                                    //add search element
                                    $('.standard-employee-selection-list').prepend(`<div class="search">
                                            <div class="expand-search-wrap search-wrapper" id="standard-employee-group-selection-search-btn">
                                                <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                <span class="searchclosebtn"><i class="material-icons standard-employee-group-selection-close-btn hide">close</i></span>
                                            </div>
                                        </div>`);
                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        if ($('.modal-popup-content').length > 0) {
                                            //console.log("scroll initiated for modal pop-up class")
                                            appScroll.scrollBar('.modal-popup-content');
                                        }
                                    } else {
                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                        if ($('.modal-popup-content').length > 0) {
                                            //console.log("scroll initiated for modal pop-up class")
                                            appScroll.scrollBar('.modal-popup-content');
                                        }
                                    }
                                    removeLoader();
                                    setTimeout(function () {
                                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                        var element = $('#standard-employee-group-selection-search-btn').find('.expand-search-input');
                                        if (element) {
                                            //console.log('element22', element);
                                            //if element is there
                                            $(document).on('input', element, function () {
                                                //on input set attribute socketid 
                                                timestamp = (new Date()).getTime();
                                                element.attr("socketid", timestamp);
                                            });
                                            // element.addEventListener("keyup", function (e) {
                                            $(document).on('keyup', element, function () {
                                                // if (!hasClass(e.target, 'filemanager-search')) {
                                                //console.log("not has class")
                                                // on keyup get attribute 
                                                socketid = element.attr("socketid");
                                                keyword = element.val();
                                                if (socketid && keyword) {
                                                    //if socketid attribute and keyword is there
                                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                    currentroute = $("body").attr('app');
                                                    data = {
                                                        room: crossplat.device.uuid,
                                                        socketid,
                                                        app: 'digibiz',
                                                        keyword
                                                    };
                                                    switch (currentroute) {
                                                        case 'employee_group_create':
                                                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                                if ($('#modal-standard-employee-group-selection').length > 0) {
                                                                    if (sessionStorage.getItem('group_from') == "standard_group") {
                                                                        data['index'] = 'getEmployeeGroupStandardGroupSelectionList';
                                                                        data['business_id'] = sessionStorage.getItem('business_id')
                                                                    }
                                                                }
                                                            }
                                                            break;
                                                        default:
                                                            break;
                                                    }
                                                    addLoader();
                                                    //console.log("search emit", data);
                                                    sockets.searchSocket.emit('search', data);
                                                    setTimeout(() => {
                                                        removeLoader();
                                                    }, 300);
                                                } else {
                                                    //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                                    //else show default list
                                                    removeLoader();
                                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                    currentroute = $("body").attr('app');
                                                    // element.removeAttribute("socketid");
                                                    element.attr("socketid", "");
                                                    switch (currentroute) {
                                                        case 'employee_group_create':
                                                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                                if ($('#modal-standard-employee-group-selection').length > 0) {
                                                                    //console.log("ERROR", unique_member)
                                                                    processSearchedEmployeeGroupStandardGroupSelectionList(unique_member, function () { })
                                                                }
                                                            }
                                                            break;
                                                        default:
                                                            break;
                                                    }

                                                }
                                            });
                                            $(document).on('click', '.searchclosebtn', function () {
                                                if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                    if ($('#modal-standard-employee-group-selection').length > 0) {
                                                        //console.log("CLOSED", unique_member)
                                                        processSearchedEmployeeGroupStandardGroupSelectionList(unique_member, function () { })
                                                    }
                                                }
                                            })
                                        }
                                    }, 0);
                                });
                            }, 'page/common/standard_employee_group_selection', '#standard-employee-selection-list-template', standardGroupList);
                        })
                        .catch((err) => {
                            //console.log("no earlier members found in the group")
                        })
                } else {//new creation
                    $.each($("input[name='selectedmembers[]']"), function (index, element) {
                        // unique_member = unique_member.filter(function (e) {
                        //     return e.id != $(element).val();
                        // });
                    });
                    var standardGroupList = {
                        standardGroupList: unique_member.map(e => {
                            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                                // if (e.display_picture.hasOwnProperty('asset_id') && e.display_picture.asset_id) {
                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                e.display_picture['avtarUrl'] = avtarUrl;
                                //     e['imageLetter'] = e.name.charAt(0);
                                // } else {
                                //     e['imageLetter'] = e.name.charAt(0);
                                // }
                            } else {
                                e['imageLetter'] = e.name.charAt(0);
                            }
                            return e;
                        })
                    }
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-standard-employee-group-selection",
                            modal_header: "Standard Employee Groups",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-selected-standard-employee-group",
                            }]
                        }
                        showModal(modal_data, function () {
                            //add search element
                            $('.standard-employee-selection-list').prepend(`<div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="standard-employee-group-selection-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons standard-employee-group-selection-close-btn hide">close</i></span>
                                    </div>
                                </div>`);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            }
                            removeLoader();
                            setTimeout(function () {

                                listenForEmployeeStandardGroupListScrollEvent($(".modal-popup-content"));
                                var element = $('#standard-employee-group-selection-search-btn').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-standard-employee-group-selection').length > 0) {
                                                            if (sessionStorage.getItem('group_from') == "standard_group") {
                                                                data['index'] = 'getEmployeeGroupStandardGroupSelectionList';
                                                                data['business_id'] = sessionStorage.getItem('business_id')
                                                            }
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-standard-employee-group-selection').length > 0) {
                                                            //console.log("ERROR", unique_member)
                                                            processSearchedEmployeeGroupStandardGroupSelectionList(unique_member, function () { })
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                            if ($('#modal-standard-employee-group-selection').length > 0) {
                                                //console.log("CLOSED", unique_member)
                                                processSearchedEmployeeGroupStandardGroupSelectionList(unique_member, function () { })
                                            }
                                        }
                                    })
                                }
                            }, 0);
                        });
                    }, 'page/common/standard_employee_group_selection', '#standard-employee-selection-list-template', standardGroupList);
                }

            })
            .catch((err) => {
                removeLoader();
                sessionStorage.removeItem('group_from'); //if no standard groups found, they should get the action sheet to choose between employee list and standard group list
                Materialize.toast(`No Groups Found`, 3000, 'round success-alert');
            })
    });

    //add selected standard groups to the employee custom group
    $(document).on('click', '#add-selected-standard-employee-group', function () {
        addLoader();
        // if ($('.standard-employee-group-select:checked').length > 0) {
        if ($('.standard-employee-group-select-checkbox-click-wrapper.selected-row').length > 0) {
            if (sessionStorage.getItem('group_id')) {
                var alert_parms = {
                    alert_id: "alert-employee-group-member-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-employee-standard-group-member-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-employee-group-member-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

            } else {//first time adding 
                //console.log("new")
                $.each($('.standard-employee-group-select-checkbox-click-wrapper.selected-row'), function (index, element) {
                    //console.log("element", $(element));
                    // var getGroupId = $(element).parents('.standard-employee-group-select-checkbox-click-wrapper').attr('data-id');
                    var getGroupId = $(element).find('.standard-employee-group-select').attr('data-id');
                    //console.log("getGroupId", getGroupId);
                    var getGroupName = $(element).find('.standard-group-name').text();
                    //console.log("getGroupName", getGroupName);
                    var getGroupNameImageLetter = $(element).find('.standard-group-name').text().charAt(0);
                    //console.log("getGroupNameImageLetter", getGroupNameImageLetter);
                    if (getGroupId != undefined) {
                        var members = {
                            id: getGroupId,
                            name: getGroupName,
                            imageLetter: getGroupNameImageLetter,
                            type: "groups",
                            seleted: true
                        }
                        var index1 = digibiz.selectedMembers.findIndex(e => e.id == getGroupId);
                        if (index1 == -1) {
                            digibiz.selectedMembers.push(members);
                        }
                        //console.log("inside")
                        var template = `<div class="tooltipped employee-group-member-wrapper" data-id="${getGroupId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getGroupId}" id="selected-${getGroupId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getGroupNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getGroupId}">${getGroupName}</span></div>
            </div>`;
                        if ($(`.employee-group-member-wrapper[data-id="${getGroupId}"]`).length == 0) {
                            $('#employee-group-members-list').append(template);
                        }
                        // $('#employee-group-members-list').append(template);
                        //console.log("check", (index + 1), $('.standard-employee-group-select-checkbox-click-wrapper.selected-row').length);
                        if ((index + 1) == $('.standard-employee-group-select-checkbox-click-wrapper.selected-row').length) {
                            //console.log("@@@")
                            $('#modal-standard-employee-group-selection').remove();
                        }
                    } else {
                        //console.log("check", (index + 1), $('.standard-employee-group-select-checkbox-click-wrapper.selected-row').length);
                        if ((index + 1) == $('.standard-employee-group-select-checkbox-click-wrapper.selected-row').length) {
                            //console.log("@@@@@")
                            $('#modal-standard-employee-group-selection').remove();
                        }
                        // $('#modal-standard-employee-group-selection').remove();
                        removeLoader();
                        //console.log("group id is undefined")
                    }
                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 group.`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-employee-standard-group-member-add-confirm-yes', function () {
        addLoader();
        //console.log("111")
        $('#alert-employee-group-member-add-confirm-cancel').remove();
        let selectedmembers = [];
        $.each($('.standard-employee-group-select-checkbox-click-wrapper.selected-row'), function () {
            selectedmembers.push($(this).find('.standard-employee-group-select').attr('data-id'));
        });
        //console.log("222")
        var contactlist = uniqueArray(selectedmembers);
        //console.log("333", contactlist)
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                $('#modal-standard-employee-group-selection').remove();
                Materialize.toast("Groups Added Successfully", 3000, 'round success-alert');
                employeeGroupCreationPage();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })

    //add selected department to the group
    $(document).on('click', '#custom_employee_group_department_list_confirm', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            if ($('.department-selected:checked').length > 0) {
                // var departmentNames = [];
                $.each($('.department-selected:checked'), function (index, element) {
                    var getDepartmentId = $(element).parents('.sub-department-box').attr('data-id')
                    digibiz.employee_group_department_members.push({
                        "id": getDepartmentId
                    })
                    // departmentNames.push({
                    //     "id": getDepartmentId,
                    //     "name": $(element).siblings('#added_sub_department').text()
                    // })
                });
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('group_id'),
                    department_data: digibiz.employee_group_department_members
                }
                employeeGroupDepartmentUpdate(requestParams)
                    .then((result) => {
                        digibiz.employee_group_department_members = [];
                        removeLoader();
                        $('#custom-employee-group-department-list-modal').remove();
                        // //console.log("departmentNames", departmentNames);
                        // employeeGroupCreationPage();
                        // if (result.department_data.length > 0) {
                        //     $.each(result.department_data, function (index, department) {
                        //         if ($('#employee-group-members-list').find(`.custom-employee-group-member-wrapper[data-department-id="${department.id}"]`).length > 0) {
                        //         } else {
                        //             var getName = departmentNames.find((e => e.id == department.id));
                        //             if (getName != undefined) {
                        //                 var getImageLetter = getName.name.charAt(0);
                        //                 var template = `<div class="custom-employee-group-member-wrapper" data-department-id="${department.id}">
                        //                         <div class="file-select">                                                    
                        //                             <div class="contact-profile-container" data-department-id="${department.id}">
                        //                                 <span class="persona">${getImageLetter}</span>
                        //                             </div>
                        //                         </div>
                        //                         <div class="filemanager-file-wrapper">
                        //                             <span class="custom-employee-group-member-name">${getName.name}</span>
                        //                         </div>
                        //                         <div class="btn-wrap">              
                        //                             <div class="more-menu-wrapper" id="delete_custom_department_list_group_department" data-department-id="${department.id}"><i class="material-icons">delete</i></div>
                        //                         </div>
                        //                     </div>`;
                        //                 $('#employee-group-members-list').append(template);
                        //             }
                        //         }
                        //     })
                        // }
                        // Materialize.toast("Departments Added Successfully", 3000, 'round success-alert');
                        // $('#modal-employee-selection').remove();
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast("Error in group departments adding", 3000, 'round success-alert');
                    })
            } else {
                removeLoader();
                Materialize.toast("Please select atleast 1 department.", 3000, 'round success-alert');
            }
        } else {//first time adding  
            if ($('.department-selected:checked').length > 0) {
                $.each($('.department-selected:checked'), function (index, element) {
                    //check if this department is already present in the members heading
                    if ($('#employee-group-members-list').find(`.employee-group-member-wrapper[data-department-id="${$(element).parents('.sub-department-box').attr('data-id')}"]`).length > 0) {
                        $('#custom-employee-group-department-list-modal').remove();
                        removeLoader();
                    } else {
                        var getDepartmentId = $(element).parents('.sub-department-box').attr('data-id')
                        var getDepartmentName = $(element).siblings('#added_sub_department').text();
                        var getDepartmentNameImageLetter = $(element).siblings('#added_sub_department').text().charAt(0);
                        if (getDepartmentId != undefined) {
                            digibiz.employee_group_department_members.push({
                                "id": getDepartmentId
                            })
                            var template = `<div class="tooltipped employee-group-member-wrapper" data-department-id="${getDepartmentId}"">
                <div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getDepartmentId}" id="selected-${getDepartmentId}" checked="">
                    <i class="material-icons">done</i>
                    <div class="profile-text group-profile-text text-small-size">
                        <span>${getDepartmentNameImageLetter}</span> 
                    </div>
                </div>
                <div class="filemanager-file-wrapper">
                    <span class="truncate" for="selected-${getDepartmentId}">${getDepartmentName}</span>
                </div>
            </div>`;
                            $('#employee-group-members-list').append(template);
                            $('#custom-employee-group-department-list-modal').remove();
                            removeLoader();
                        } else {
                            removeLoader();
                            //console.log("Department id is undefined")
                        }
                    }
                })
            } else {
                Materialize.toast("Please select 1 department", 3000, 'round success-alert');
                removeLoader();
            }
        }
    });


    //add selected employees to the members list/group
    $(document).on('click', '#add-selected-employees-group', function () {
        addLoader();
        // if ($('.employee-select-btn:checked').length > 0) {
        if ($('#modal-employee-selection').find('.employee-select-btn-wrapper.selected-row').length > 0) {
            if (sessionStorage.getItem('group_id')) {
                var alert_parms = {
                    alert_id: "alert-employee-group-member-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-employee-group-member-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-employee-group-member-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });
                // let selectedmembers = [];
                // $.each($('.employee-select-btn:checked'), function () {
                //     selectedmembers.push($(this).attr('data-dj-unique-employee-id'));
                // });
                // var contactlist = uniqueArray(selectedmembers);
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Employees Added Successfully", 3000, 'round success-alert');
                //         employeeGroupCreationPage();
                //         $('#modal-employee-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    $('.search-member-button').removeClass('hide');
                } else {
                    $('.search-member-button').addClass('hide');
                }
                // $.each($('.employee-select-btn:checked'), function (index, element) {
                $.each($('.employee-select-btn-wrapper.selected-row'), function (index, element) {
                    // digibiz.employee_group_selected_employee_members.push($(element).attr('data-dj-unique-employee-id'));
                    var getDJUniqueEmployeeId = $(element).find('.employee-select-btn').attr('data-dj-unique-employee-id');
                    var getEmployeeName = $(element).find('.contact-name-wrapper').text();
                    var getDisignationName = $(element).find('.employee-information').text();
                    var getEmployeeNameImageLetter = $(element).find('.contact-name-wrapper').text().charAt(0);
                    //console.log("getEmployeeName", getEmployeeName);
                    if (getDJUniqueEmployeeId != undefined) {
                        var members = {
                            id: getDJUniqueEmployeeId,
                            name: getEmployeeName,
                            disignationName: getDisignationName,
                            imageLetter: getEmployeeNameImageLetter,
                            dj_unique_employee_id: getDJUniqueEmployeeId,
                            selected: true,
                            type: "employee_list"
                        }
                        var index = digibiz.selectedMembers.findIndex(e => e.id == getDJUniqueEmployeeId);
                        if (index == -1) {
                            digibiz.selectedMembers.push(members);


                            var template = `<div class="tooltipped employee-group-member-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getEmployeeNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span>
                 <span class="">${getDisignationName}</span></div>
            </div>`;
                            $('#employee-group-members-list').append(template);
                            setTimeout(() => {
                                appScroll.scrollBar("#employee-group-members-list");
                            }, 500);

                        }
                        $('#modal-employee-selection').remove();
                    } else {
                        removeLoader();
                        //console.log("Dj unique employee id is undefined")
                    }
                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 employee.`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-employee-group-member-add-confirm-yes', function () {
        addLoader();
        $('#alert-employee-group-member-add-confirm-cancel').remove();
        let selectedmembers = [];
        $.each($('.employee-select-btn:checked'), function () {
            selectedmembers.push($(this).attr('data-dj-unique-employee-id'));
        });
        var contactlist = uniqueArray(selectedmembers);
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                Materialize.toast("Employees Added Successfully", 3000, 'round success-alert');
                // employeeGroupCreationPage();
                $('#modal-employee-selection').remove();
                sessionStorage.removeItem('group_id');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
        $('#modal-employee-selection').remove();
        location.hash = `employee_group_creation/list`;
    })

    $(document).on('click', '#btn-employee-group-member-add-confirm-no', function () {
        $('#alert-employee-group-member-add-confirm-cancel').remove();
    })

    //cancel group creation
    $(document).on('click', '#employee_group_cancel_button', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                data: {
                    socket_enable_status: "true",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeGroupUpdate(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('group_id');
                    sessionStorage.removeItem('group_from');
                    sessionStorage.removeItem('group_type');
                    digibiz.standard_employees_groups_list_page = [];
                    digibiz.custom_employees_groups_list_page = [];
                    digibiz.selectedMembers = [];
                    location.hash = `employee_group_creation/list`;
                    appScroll.scrollBar("#main-container").destroy();
                }).catch((err) => {
                    console.log('err', err);
                })
        } else {
            sessionStorage.removeItem('group_id');
            sessionStorage.removeItem('group_from');
            sessionStorage.removeItem('group_type');
            digibiz.standard_employees_groups_list_page = [];
            digibiz.custom_employees_groups_list_page = [];
            digibiz.selectedMembers = [];
            location.hash = `employee_group_creation/list`;
            appScroll.scrollBar("#main-container").destroy();
        }


    });

    //standard employee group tab click
    $(document).on('click', '.standard-employee-groups-list-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-employee-group-list-type-tab', 'standard');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-group-list-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-group-list-type-tab')}"]`).addClass('active');
        standardEmployeesGroupsListPage();
    });

    //custom employee group tab click
    $(document).on('click', '.custom-employee-groups-list-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-employee-group-list-type-tab', 'custom');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-group-list-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-group-list-type-tab')}"]`).addClass('active');
        customEmployeesGroupsListPage();
    });

    //save group data
    $(document).on('click', '#employee_group_add_button', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $(this).prop('disabled', true);
        addLoader();
        if (validateGroupData()) {
            if (sessionStorage.getItem('group_id')) {
                if (sessionStorage.getItem('group_type') == "standard") {
                    //save identity-pic
                    // saveGroupPicture(function (err, identityResponse) {
                    //     if (err) {
                    //         removeLoader();
                    //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    //     } else {
                    //         var resultData = identityResponse;
                    //         //console.log("resultData", resultData);
                    //         var groupImageData = {};
                    //         if (resultData != undefined) {
                    //             groupImageData = {
                    //                 asset_id: resultData.Data.asset_id,
                    //                 storage_id: resultData.Data.filename
                    //             }
                    //         }
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id'),
                        data: {
                            name: firstLetterUpperCase($('#employeeGroupName').val()),
                            description: firstLetterUpperCase($('#employee_group_desc').val()),
                            // visibility: $('#select-visibility-type').val(),
                            visibility: $('.selected-value-group-visbility').attr('data-value'),
                        }
                    }
                    employeeGroupUpdate(reqparams)
                        .then((response) => {
                            $(this).prop('disabled', false);
                            //console.log("employee group updated", response);
                            sessionStorage.removeItem('group_id');
                            sessionStorage.removeItem('group_type');
                            location.hash = `employee_group_creation/list`;
                        })
                        .catch((err) => {
                            $(this).prop('disabled', false);
                            if (err.msg == 'no updated data found') {
                                sessionStorage.removeItem('group_id');
                                sessionStorage.removeItem('group_type');
                                location.hash = `employee_group_creation/list`;
                            } else {
                                removeLoader();
                                //console.log("err in group update", err);
                            }
                        })
                    //     }
                    // })
                } else if (sessionStorage.getItem('group_type') == "custom") {
                    //save identity-pic
                    // saveGroupPicture(function (err, identityResponse) {
                    //     if (err) {
                    //         removeLoader();
                    //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    //     } else {
                    //         var resultData = identityResponse;
                    //         //console.log("resultData", resultData);
                    //         var groupImageData = {};
                    //         if (resultData != undefined) {
                    //             groupImageData = {
                    //                 asset_id: resultData.Data.asset_id,
                    //                 storage_id: resultData.Data.filename
                    //             }
                    //         }
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id'),
                        data: {
                            name: firstLetterUpperCase($('#employeeGroupName').val()),
                            description: firstLetterUpperCase($('#employee_group_desc').val()),
                            // visibility: $('#select-visibility-type').val(),
                            visibility: $('.selected-value-group-visbility').attr('data-value'),
                        }
                    }
                    employeeGroupUpdate(reqparams)
                        .then((response) => {
                            $(this).prop('disabled', false);
                            //console.log("employee group updated", response);
                            digibiz.employee_group_employee_members = [];
                            sessionStorage.removeItem('group_from');
                            sessionStorage.removeItem('group_id');
                            sessionStorage.removeItem('group_type');
                            location.hash = `employee_group_creation/list`;
                        })
                        .catch((err) => {
                            $(this).prop('disabled', false);
                            if (err.msg == 'no updated data found') {
                                digibiz.employee_group_employee_members = [];
                                sessionStorage.removeItem('group_from');
                                sessionStorage.removeItem('group_id');
                                sessionStorage.removeItem('group_type');
                                location.hash = `employee_group_creation/list`;
                                removeLoader();
                            } else {
                                removeLoader();
                                //console.log("err in group update", err);
                            }
                        })
                }
                //     })
                // }
            } else {//first time adding
                //check if the custom group is from employee_list or department list
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    let selectedmembers = [];
                    $.each($("input[name='selectedmembers[]']:checked"), function () {
                        selectedmembers.push($(this).val());
                    });
                    var contactlist = uniqueArray(selectedmembers);
                    console.log("contactlist", contactlist);
                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            $(this).prop('disabled', false);
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                group_for: "employee",
                                custom_group_from: sessionStorage.getItem('group_from'),
                                group_type: sessionStorage.getItem('group_type'),
                                // visibility: $('#select-visibility-type').val(),
                                visibility: $('.selected-value-group-visbility').attr('data-value'),
                                name: firstLetterUpperCase($('#employeeGroupName').val()),
                                description: firstLetterUpperCase($('#employee_group_desc').val()),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size,
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    //console.log("success in group creation", response);
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: response.id,
                                        members: contactlist
                                    }
                                    groupMemberAdd(requestParams)
                                        .then((result) => {
                                            $(this).prop('disabled', false);
                                            digibiz.employee_group_employee_members = [];
                                            digibiz.groupPictureblob = {};
                                            digibiz.selectedMembers = [];
                                            sessionStorage.removeItem('group_from');
                                            sessionStorage.removeItem('group_id');
                                            sessionStorage.removeItem('group_type');

                                        })
                                        .catch((err) => {
                                            $(this).prop('disabled', false);
                                            removeLoader();
                                            Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                                        })
                                    location.hash = `employee_group_creation/list`;
                                })
                                .catch((err) => {
                                    $(this).prop('disabled', false);
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                        }
                    })
                } else if (sessionStorage.getItem('group_from') == "department_list") {//department list                                         
                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            $(this).prop('disabled', false);
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                group_for: "employee",
                                custom_group_from: sessionStorage.getItem('group_from'),
                                group_type: sessionStorage.getItem('group_type'),
                                // visibility: $('#select-visibility-type').val(),
                                visibility: $('.selected-value-group-visbility').attr('data-value'),
                                name: firstLetterUpperCase($('#employeeGroupName').val()),
                                description: firstLetterUpperCase($('#employee_group_desc').val()),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size,
                                department_data: digibiz.employee_group_department_members
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    $(this).prop('disabled', false);
                                    //console.log("success in group creation", response);
                                    digibiz.employee_group_department_members = [];
                                    digibiz.groupPictureblob = {};
                                    sessionStorage.removeItem('group_from');
                                    sessionStorage.removeItem('group_id');
                                    sessionStorage.removeItem('group_type');
                                    digibiz.selectedMembers = [];

                                })
                                .catch((err) => {
                                    $(this).prop('disabled', false);
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                            location.hash = `employee_group_creation/list`;
                        }
                    })
                } else {//standard_group
                    let selectedmembers = [];
                    $.each($("input[name='selectedmembers[]']:checked"), function () {
                        selectedmembers.push($(this).val());
                    });
                    var contactlist = uniqueArray(selectedmembers);
                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            removeLoader();
                            $(this).prop('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                group_for: "employee",
                                custom_group_from: sessionStorage.getItem('group_from'),
                                group_type: sessionStorage.getItem('group_type'),
                                // visibility: $('#select-visibility-type').val(),
                                visibility: $('.selected-value-group-visbility').attr('data-value'),
                                name: firstLetterUpperCase($('#employeeGroupName').val()),
                                description: firstLetterUpperCase($('#employee_group_desc').val()),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size,
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    //console.log("success in group creation", response);
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: response.id,
                                        members: contactlist
                                    }
                                    groupMemberAdd(requestParams)
                                        .then((result) => {
                                            $(this).prop('disabled', false);
                                            digibiz.employee_group_employee_members = [];
                                            digibiz.groupPictureblob = {};
                                            sessionStorage.removeItem('group_from');
                                            sessionStorage.removeItem('group_id');
                                            sessionStorage.removeItem('group_type');
                                            digibiz.selectedMembers = [];

                                        })
                                        .catch((err) => {
                                            $(this).prop('disabled', false);
                                            removeLoader();
                                            Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                                        })
                                    location.hash = `employee_group_creation/list`;
                                })
                                .catch((err) => {
                                    $(this).prop('disabled', false);
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                        }
                    })
                }
            }
        } else {
            $(this).prop('disabled', false);
            //console.log("fail")
            removeLoader();
        }
    });

    //delete employee group
    $(document).on('click', '#delete_employee_group', function () {
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        employeeGroupDelete(reqparams)
            .then((response) => {
                sessionStorage.removeItem('group_from');
                sessionStorage.removeItem('group_id');
                sessionStorage.removeItem('group_type');
                location.hash = `employee_group_creation/list`;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the group.`, 3000, "round error-alert");
            })
    })

    //delete customer group
    $(document).on('click', '#delete_customer_group', function () {
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        employeeGroupDelete(reqparams)
            .then((response) => {
                sessionStorage.removeItem('group_from');
                sessionStorage.removeItem('group_id');
                sessionStorage.removeItem('group_type');
                location.hash = `customer/groups/identifiers/list`;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the group.`, 3000, "round error-alert");
            })
    })





    $(document).on('click', '.employee_edit', function () {
        addLoader();
        var getEmployeeId = $('.action-sheet-container').attr('employee_id');
        var getSocketStatus = $(".action-sheet-container").attr('employee_socket_status');
        if (getSocketStatus == "true") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: getEmployeeId,
                data: {
                    socket_enable_status: "false",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeUpdate(reqParam)
                .then((response) => {
                    //console.log("employeeUpdate", response);
                    if (response.employee_role == "super_admin") {
                        var getReqParams = {
                            device_id: crossplat.device.uuid,
                            business_id: sessionStorage.getItem('business_id'),
                            list_by: "type",
                            type: "super_admin"
                        }
                        departmentGet(getReqParams)
                            .then((result) => {
                                removeLoader();
                                sessionStorage.setItem('department_id', result.id)
                                sessionStorage.setItem('employee_id', getEmployeeId);
                                sessionStorage.setItem('employee_name', `${response.name.first} ${response.name.last}`);
                                $('#employee_alert_actions').remove();
                                location.hash = `employee/create`;
                            })
                            .catch((err) => {
                                removeLoader();
                            })
                    } else {
                        removeLoader();
                        sessionStorage.setItem('employee_id', getEmployeeId);
                        sessionStorage.setItem('employee_name', `${response.name.first} ${response.name.last}`);
                        $('#employee_alert_actions').remove();
                        location.hash = `employee/create`;
                    }
                })
                .catch((err) => {
                    //console.log("error in update employee update api", err);
                    if (err.msg == "no updated data found") {
                        removeLoader();
                        sessionStorage.setItem('employee_id', getEmployeeId);
                        $('#employee_alert_actions').remove();
                        location.hash = `employee/create`;
                    }
                })
        } else {//getSocketStatus is false
            $('#employee_alert_actions').remove();
            Materialize.toast(`Access Denied! You or other administrator is creating this employee at other place.`, 3000, "round error-alert");
            var alert_parms = {
                alert_id: "alert-employee-device-change-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Access Denied! You or other administrator is creating this employee at other place. Would to like to cancel there and continue here?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-employee-device-change-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-employee-device-change-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-employee-device-change-confirm-cancel').attr('data-employee-id', getEmployeeId); //set getEmployeeId
            });
        }
    });

    $(document).on('click', '#btn-employee-device-change-cancel-no', function () {
        $('#alert-employee-device-change-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-employee-device-change-confirm-yes', function () {
        addLoader();
        var getEMployeeId = $('#alert-employee-device-change-confirm-cancel').attr('data-employee-id');
        var requestParams = {
            device_id: crossplat.device.uuid,
            employee_id: getEMployeeId,
            business_id: sessionStorage.getItem('business_id')
        }
        employeeDeviceChange(requestParams)
            .then((response) => {
                //console.log("employeeDeviceChange", response);
                sessionStorage.setItem("employee_id", getEMployeeId);
                //console.log("success in changing device");
                $('#alert-employee-device-change-confirm-cancel').remove();

                location.hash = `employee/create`;
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in changing device");
            })
    });

    $(document).on('click', '#btn-employee-changed-device-ok', function () {
        console.log('comming');
        addLoader();
        $('#alert-employee-changed-device-confirm').remove();
        sessionStorage.removeItem('employee_id');
        location.hash = `employee_creation/list`;
    });


    //employee delete
    $(document).on('click', '.employee_delete', function () {
        addLoader();
        var getEmployeeId = $('.action-sheet-container').attr('employee_id');
        $('#employee_alert_actions').remove();
        fetch.getHtml(function (fetcherror, html) {
            var alert_parms = {
                alert_id: "alert-employee-delete-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: html,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-employee-delete-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-employee-delete-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-employee-delete-confirm-cancel').attr('data-employee-id', getEmployeeId); //set getEmployeeId
            });
        }, 'layouts/alert_templates/delete_employee', '#delete-employee-template', null);
    });

    $(document).on('click', '#btn-employee-delete-cancel-no', function () {
        $('#alert-employee-delete-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-employee-delete-confirm-yes', function () {
        addLoader();
        var getEmployeeId = $('#alert-employee-delete-confirm-cancel').attr('data-employee-id');
        var getDeleteFolderValue = $('.delete-employee-folder-delete-yes-radio-button').is(':checked');
        $('#alert-employee-delete-confirm-cancel').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getEmployeeId,
            folder_delete: getDeleteFolderValue
        };
        //console.log("reqParam", reqParam)
        employeeDelete(reqParam)
            .then((response) => {
                removeLoader();
                Materialize.toast(`Successfully deleted the employee.`, 3000, "round error-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, "round error-alert");
            })
    });

    //customer delete
    $(document).on('click', '.customer_delete', function () {
        addLoader();
        var getCustomerId = $('.action-sheet-container').attr('customer_id');
        $('#customer_alert_actions').remove();
        fetch.getHtml(function (fetcherror, html) {
            var alert_parms = {
                alert_id: "alert-customer-delete-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: html,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-customer-delete-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-customer-delete-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-customer-delete-confirm-cancel').attr('data-customer-id', getCustomerId); //set getCustomerId
            });
        }, 'layouts/alert_templates/delete_customer', '#delete-customer-template', null);
    });

    $(document).on('click', '#btn-customer-delete-cancel-no', function () {
        $('#alert-customer-delete-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-customer-delete-confirm-yes', function () {
        addLoader();
        var getCustomerId = $('#alert-customer-delete-confirm-cancel').attr('data-customer-id');
        var getDeleteFolderValue = $('.delete-customer-folder-delete-yes-radio-button').is(':checked');
        $('#alert-customer-delete-confirm-cancel').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getCustomerId,
            folder_delete: getDeleteFolderValue,
            status: "deleted"
        };
        customerDelete(reqParam)
            .then((response) => {
                removeLoader();
                Materialize.toast(`Successfully deleted the customer.`, 3000, "round error-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the customer.`, 3000, "round error-alert");
            })
    });

    // $(document).on('click', '#save-new-employee', function () {
    //     addLoader();
    //     $(this).prop('disabled', true);
    //     if (validateAddNewEmployee()) {
    //         var getFirstName = getInputText($('#employee_first_name')).trim();
    //         var getMiddleName = getInputText($('#employee_middle_name')).trim();
    //         var getLastName = getInputText($('#employee_last_name')).trim();
    //         var mobileNumber = $('#add-employee-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
    //         //console.log("mobileNumber", mobileNumber);
    //         var requestParams = {
    //             device_id: crossplat.device.uuid,
    //             business_id: sessionStorage.getItem('business_id'),
    //             name: {
    //                 first: getFirstName,
    //                 middle: getMiddleName,
    //                 last: getLastName
    //             },
    //             mobile_number: mobileNumber
    //         }
    //         employeeAdd(requestParams)
    //             .then((response) => {
    //                 removeLoader();
    //                 $(this).prop('disabled', false);
    //                 var ReqParams = {
    //                     device_id: crossplat.device.uuid,
    //                     id: response.dj_unique_employee_id,
    //                 }
    //                 employeeGet(ReqParams)
    //                     .then((result) => {
    //                         //console.log("result", result);
    //                         var template = `<div class="employee_individual_box_wrapper">
    //                                 <div class="employee-individual-wrapper" data-employee-id="${result.dj_unique_employee_id}">                    
    //                                 <div class="identity-pic-info-wrapper">
    //                                   <div class="identity-pic-info-content-box">

    //                                   </div>
    //                                   <div class="employee-details-box">
    //                                   <div class="employee-name-wrapper">                      
    //                                         <div class="employee-name">${result.name.first}${result.name.last}</div>                      
    //                                   </div>
    //                                   <div class="employee-mobile-number-wrapper">                      
    //                                         <div class="employee-mobile-number">${result.mobile_number}</div>                      
    //                                   </div> 
    //                                   </div>                          
    //                                 </div>                   
    //                                 <div class="btn-wrap">              
    //                                  <div class="more-menu-wrapper show-action-employee-data" id="show-action-employee-data"><i class="material-icons">more_vert</i></div>
    //                                 </div>                
    //                               </div>                                  
    //                                 </div>`;
    //                         $('#add-new-employee-modal').remove();;//pop-up remove
    //                         $('.employee-creation-page-list-box').append(template);
    //                     })
    //                     .catch((err) => {
    //                         removeLoader();
    //                         Materialize.toast("Error in getting the employee", 3000, 'round success-alert');
    //                     })
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 $(this).prop('disabled', false);
    //                 Materialize.toast("Error in adding the employee", 3000, 'round success-alert');
    //             })
    //     } else {
    //         removeLoader();
    //         $(this).prop('disabled', false);
    //         Materialize.toast("Error", 3000, 'round success-alert');
    //     }
    // });

    $(document).on('keydown', '#employee_first_name, #add-employee-mobile-number, #employee_middle_name, #employee_last_name', function () {
        removeError($(this));
    });

    $(document).on('click', '#show-action-employee-data', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var getEmployeeId = $(this).parents('.employee-wrapper').attr('data-employee-id');
        var getEmployeeStatus = $(this).parents('.employee-wrapper').attr('data-status');
        var getEmployeeSocketStatus = $(this).parents('.employee-wrapper').attr('data-socket-status');
        var getEmployeeDataType = $(this).parents('.employee-wrapper').find('.employee-data-type').length;
        //console.log("getEmployeeDataType", getEmployeeDataType);
        if (getEmployeeStatus == "active" || getEmployeeStatus == "unassigned") {
            if (getEmployeeDataType == 0) {
                var action_sheet_parms = {
                    action_id: "employee_alert_actions",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Edit",
                        attr: [{ name: "class", value: "employee_edit" }]
                    },
                    {
                        name: "Inactivate",
                        attr: [{ name: "class", value: "employee_inactivate" }]
                    },
                    {
                        name: "Delete",
                        attr: [{ name: "class", value: "employee_delete" }]
                    }]
                }
                showAction(action_sheet_parms, function () {
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('employee_id', getEmployeeId);
                    $(".action-sheet-container").attr('employee_socket_status', getEmployeeSocketStatus);
                });
            } else {
                var action_sheet_parms = {
                    action_id: "employee_alert_actions",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Edit",
                        attr: [{ name: "class", value: "employee_edit" }]
                    },
                    {
                        name: "Inactivate",
                        attr: [{ name: "class", value: "employee_inactivate" }]
                    }]
                }
                showAction(action_sheet_parms, function () {
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('employee_id', getEmployeeId);
                    $(".action-sheet-container").attr('employee_socket_status', getEmployeeSocketStatus);
                });
            }
        } else if (getEmployeeStatus == "accepted") {
            var action_sheet_parms = {
                action_id: "employee_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Complete Profile",
                    attr: [{ name: "class", value: "employee_edit" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('employee_id', getEmployeeId);
                $(".action-sheet-container").attr('employee_socket_status', getEmployeeSocketStatus);
            });
        } else if (getEmployeeStatus == "inactive") {
            if (getEmployeeDataType == 0) {
                var action_sheet_parms = {
                    action_id: "employee_alert_actions",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Edit",
                        attr: [{ name: "class", value: "employee_edit" }]
                    },
                    {
                        name: "Activate",
                        attr: [{ name: "class", value: "employee_activate" }]
                    },
                    {
                        name: "Delete",
                        attr: [{ name: "class", value: "employee_delete" }]
                    }]
                }
                showAction(action_sheet_parms, function () {
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('employee_id', getEmployeeId);
                    $(".action-sheet-container").attr('employee_socket_status', getEmployeeSocketStatus);
                });
            } else {
                var action_sheet_parms = {
                    action_id: "employee_alert_actions",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Edit",
                        attr: [{ name: "class", value: "employee_edit" }]
                    },
                    {
                        name: "Activate",
                        attr: [{ name: "class", value: "employee_activate" }]
                    }]
                }
                showAction(action_sheet_parms, function () {
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('employee_id', getEmployeeId);
                    $(".action-sheet-container").attr('employee_socket_status', getEmployeeSocketStatus);
                });
            }
        } else if (getEmployeeStatus == "exited") {
            var action_sheet_parms = {
                action_id: "employee_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Delete",
                        attr: [{ name: "class", value: "employee_delete" }]
                    }]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('employee_id', getEmployeeId);
                $(".action-sheet-container").attr('employee_socket_status', getEmployeeSocketStatus);
            });
        }

    });

    $(document).on('click', '.employee_inactivate', function () {
        addLoader();
        var getId = $("#employee_alert_actions").attr('employee_id');
        $("#employee_alert_actions").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId,
            data: {
                status: 'inactive',
                update_for: "socket_enable_status"
            }
        }
        employeeUpdate(requestParams)
            .then((response) => {
                removeLoader();
                sockets.employeeUpdate(response.Data);
                Materialize.toast(`Successfully inactivated.`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in inactivating.`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.employee_activate', function () {
        addLoader();
        var getId = $("#employee_alert_actions").attr('employee_id');
        $("#employee_alert_actions").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId,
            data: {
                status: 'active',
                update_for: "socket_enable_status"
            }
        }
        employeeUpdate(requestParams)
            .then((response) => {
                removeLoader();
                sockets.employeeUpdate(response.Data);
                Materialize.toast(`Successfully activated.`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in activating.`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.customer_inactivate', function () {
        addLoader();
        var getId = $("#customer_alert_actions").attr('customer_id');
        $("#customer_alert_actions").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId,
            data: {
                status: 'inactive',
                update_for: "socket_enable_status"
            }
        }
        customerUpdate(requestParams)
            .then((response) => {
                removeLoader();
                Materialize.toast(`Successfully inactivated.`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in inactivating.`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.customer_activate', function () {
        addLoader();
        var getId = $("#customer_alert_actions").attr('customer_id');
        $("#customer_alert_actions").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId,
            data: {
                status: 'active',
                update_for: "socket_enable_status"
            }
        }
        customerUpdate(requestParams)
            .then((response) => {
                removeLoader();
                Materialize.toast(`Successfully activated.`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in activating.`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.associate_customer_inactivate', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getId = $("#associate_customer_alert_actions").attr('associate_customer_id');
        $("#associate_customer_alert_actions").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId,
            data: {
                status: 'inactive',
                update_for: "socket_enable_status"
            }
        }
        associateCustomerUpdate(requestParams)
            .then((response) => {
                removeLoader();
                Materialize.toast(`Successfully inactivated.`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in inactivating.`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.associate_customer_activate', function () {
        addLoader();
        var getId = $("#associate_customer_alert_actions").attr('associate_customer_id');
        $("#associate_customer_alert_actions").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId,
            data: {
                status: 'active',
                update_for: "socket_enable_status"
            }
        }
        associateCustomerUpdate(requestParams)
            .then((response) => {
                removeLoader();
                Materialize.toast(`Successfully activated.`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in activating.`, 3000, "round error-alert");
            })
    });
    /*******************************EMPLOYEE CREATION MANAGEMENT(ends)****************************/



























    // $(document).on('click', '#add-department', function () {
    //     location.hash = `department/create`;
    // });

    $(document).on('click', '#add-department', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-department-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Add Department",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-add-department-cancel" }]
                    },
                    {
                        name: "Save",
                        attr: [{ name: "id", value: "alert-add-department-confirm" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        }, 'layouts/popup/new_department', '#new-department-template', null);
    });

    $(document).on('click', '#alert-add-department-cancel', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#modal-department-add-cancel').remove();
    });

    $(document).on('click', '#alert-add-department-confirm', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getDepartmentNameElement = $('#new_department_name');
        if (validateEmployeeData(getDepartmentNameElement)) {
            var reqParams = {
                device_id: crossplat.device.uuid,
                name: firstLetterUpperCase($(getDepartmentNameElement).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            departmentAdd(reqParams)
                .then((result) => {
                    removeLoader();
                    //console.log("departmentAdd result", result);
                    $('#modal-department-add-cancel').remove();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                })
        } else {
            //console.log("else part")
            removeLoader();
        }
    });

    $(document).on('click', '#show-action-department', function () {
        var getDepartmentId = $(this).parents('.department-wrapper').attr('data-id');
        var action_sheet_parms = {
            action_id: "department_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "edit_department" }]
            },
            {
                name: "Delete",
                attr: [{ name: "class", value: "delete_department" }]
            }
            ]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('department-id', getDepartmentId);
        });
    });


    $(document).on('click', '.edit_department', function () {
        addLoader();
        var getDepartmentId = $("#department_action_sheet").attr('department-id');
        $("#department_action_sheet").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "id",
            id: getDepartmentId
        }
        departmentGet(requestParams)
            .then((response) => {
                //console.log("response", response);
                var getData = {
                    department: response.name
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        removeLoader();
                        var alert_parms = {
                            alert_id: "modal-edit-department-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Edit Department",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-department-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-department-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-edit-department-add-cancel').attr('data-department-id', response.id);
                        });
                    }
                }, 'layouts/popup/edit_department', '#edit-department-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting department.", 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#alert-edit-department-cancel', function () {
        $('#modal-edit-department-add-cancel').remove();
    });

    $(document).on('click', '#alert-edit-department-add', function () {
        addLoader();
        var getDepartmentId = $('#modal-edit-department-add-cancel').attr('data-department-id');
        var getDepartmentNameElement = $('#edit_department_name');
        if (validateEmployeeData(getDepartmentNameElement)) {
            $('#modal-edit-department-add-cancel').remove();
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: getDepartmentId,
                name: firstLetterUpperCase($(getDepartmentNameElement).text().trim())
            }
            departmentUpdate(reqParams)
                .then((response) => {
                    removeLoader();
                    // $(`.department-wrapper[data-id="${response.id}"]`).find('.department-name').find('span').text(response.name);
                })
                .catch((err) => {
                    removeLoader();
                    if (err.msg == "no updated data found") {
                        Materialize.toast("Successfully updated.", 3000, 'round success-alert');
                    } else {
                        Materialize.toast("Error in updating department.", 3000, 'round success-alert');
                    }
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.delete_department', function () {
        addLoader();
        var getDepartmentId = $("#department_action_sheet").attr('department-id');
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getDepartmentId
        }
        departmentDelete(requestParams)
            .then((response) => {
                //console.log("response", response);
                $("#department_action_sheet").remove();
                Materialize.toast("Successfully deleted.", 3000, 'round success-alert');
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`${err.msg}`, 3000, 'round error-alert');
            })
    });



    // $(document).on('click', '.department-wrapper', function () {
    //     addLoader();
    //     var getDepartmentId = $(this).attr('data-id');
    //     sessionStorage.setItem('department_id', getDepartmentId);
    //     location.hash = `department/create`;
    // });

    $(document).on('click', '#save-department', function () {
        addLoader();
        // $(this).prop('disabled', true);
        var getDepartmentName = $(this).parents('.create-department-name-container').find('#department_name');
        if (validateEmployeeData(getDepartmentName)) {
            var reqParams = {
                device_id: crossplat.device.uuid,
                name: firstLetterUpperCase($(getDepartmentName).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            departmentAdd(reqParams)
                .then((result) => {
                    removeLoader();
                    //console.log("result", result);
                    // $(this).prop('disabled', false);
                    $('.department-btn-wrapper').removeClass('hide');
                    sessionStorage.setItem('department_id', result.id);
                    // sessionStorage.setItem('parent_id', result.id);
                    $('#add_department_level').attr('data-parent-id', result.id);
                    $('.create-sub-departments-main-container').attr('data-parent-id', result.id);
                    $(this).parent().addClass('hide');
                    $('#edit-department').parent().removeClass('hide');
                })
                .catch((err) => {
                    removeLoader();
                    // $(this).prop('disabled', false);
                    Materialize.toast("Error in adding department", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '#edit-department', function () {
        addLoader();
        // $(this).prop('disabled', true);
        var getDepartmentName = $(this).parents('.create-department-name-container').find('#department_name');
        var getDepartmentId = sessionStorage.getItem('department_id');
        if (validateEmployeeData(getDepartmentName)) {
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: getDepartmentId,
                name: firstLetterUpperCase($(getDepartmentName).text().trim()),
            }
            departmentUpdate(reqParams)
                .then((result) => {
                    removeLoader();
                    //console.log("result", result);
                    Materialize.toast("Successfully updated", 3000, 'round success-alert');
                })
                .catch((err) => {
                    removeLoader();
                    // $(this).prop('disabled', false);
                    Materialize.toast("Error in updating department", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '#add_department_level', function () {
        var getParentId = sessionStorage.getItem('department_id');
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-new-department-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Name",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-new-department-cancel" }]
                    },
                    {
                        name: "Add",
                        attr: [{ name: "id", value: "alert-new-department-add" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    $('#modal-new-department-add-cancel').attr('data-parent-id', getParentId);
                });
            }
        }, 'layouts/popup/new_department', '#new-department-template', null);
    });

    $(document).on('click', '#alert-new-department-cancel', function () {
        $('#modal-new-department-add-cancel').remove();
    });

    $(document).on('click', '#alert-new-department-add', function () {
        addLoader();
        var getNewDepartmentName = $('#new_department_name');
        var getParent = $('#modal-new-department-add-cancel').attr('data-parent-id');
        if (validateEmployeeData(getNewDepartmentName)) {
            $('#modal-new-department-add-cancel').remove();
            if (getParent != "" || getParent != null || getParent != undefined) {
                //console.log("parent is present");
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    parent_id: getParent,
                    name: firstLetterUpperCase($(getNewDepartmentName).text().trim()),
                    business_id: sessionStorage.getItem('business_id')
                }
                departmentAdd(reqParams)
                    .then((result) => {
                        removeLoader();
                        //console.log("result", result);
                        // //get the parentid from the above result and get the record of that parent if present
                        // var requestParams = {
                        //     device_id: crossplat.device.uuid,
                        //     id: result.parent_id
                        // }
                        // departmentGet(requestParams)
                        //     .then((response) => {
                        //         //console.log("response", response);
                        //         if (response.hasOwnProperty('parent_id') && response.parent_id != null) {
                        //             //console.log("not-level-2");
                        //             //display below the heading
                        //             var template = `<div class="sub-departments-content-box sub-department-box" data-id="${result.id}" data-parent-id="${result.parent_id}">
                        //                             <div class="sub-department-box-name-symbol-content-box">
                        //                             <i class="material-icons arrow-right" id="arrow_button">keyboard_arrow_right</i>                                
                        //                             <div id="added_sub_department" type="text" data-length="60" contenteditable="true" class="validate" autocomplete="off" disabled>${result.name}</div>
                        //                             </div>
                        //                             <div class="sub_sub_department_conatiner_box" data-id="${result.id}"></div>
                        //                             </div>`;
                        //             $(`.sub_sub_department_conatiner_box[data-id="${result.parent_id}"]`).append(template);
                        //             $(`.sub_sub_department_conatiner_box[data-id="${result.parent_id}"]`).siblings('.sub-department-box-name-symbol-content-box').find('.material-icons').remove();
                        //             $(`.sub_sub_department_conatiner_box[data-id="${result.parent_id}"]`).siblings('.sub-department-box-name-symbol-content-box').prepend(`<i class="material-icons arrow-down" id="arrow_button">keyboard_arrow_down</i>`)
                        //         } else {
                        //             //console.log("level-2 addition");
                        //             //display below the heading
                        //             var template = `<div class="sub-departments-content-box sub-department-box" data-id="${result.id}" data-parent-id="${result.parent_id}">
                        //                             <div class="sub-department-box-name-symbol-content-box">
                        //                             <i class="material-icons arrow-right" id="arrow_button">keyboard_arrow_right</i>                                
                        //                             <div id="added_sub_department" type="text" data-length="60" contenteditable="true" class="validate" autocomplete="off" disabled>${result.name}</div>
                        //                             </div>
                        //                             <div class="sub_sub_department_conatiner_box" data-id="${result.id}"></div>
                        //                             </div>`;
                        //             $(`.create-sub-departments-main-container[data-parent-id="${result.parent_id}"]`).append(template);
                        //         }
                        //     })
                        //     .catch((err) => {
                        //         removeLoader();
                        //         $(this).prop('disabled', false);
                        //         Materialize.toast("Error in getting the parent department record", 3000, 'round success-alert');
                        //     })
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast("Error in adding department", 3000, 'round success-alert');
                    })
            } else {
                //console.log("parent is not-present");
                removeLoader();
            }
        } else {
            removeLoader();
        }
    });

    // $(document).on('click', '#arrow_button', function () {
    //     var $this = $(this);
    //     // //console.log("1", $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box'));
    //     if ($this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box:first').find('.sub-department-box').length > 0) {
    //         if ($this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box:first').hasClass('hide')) {
    //             // //console.log("22", $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box:first'))
    //             $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box:first').removeClass('hide');
    //         } else {
    //             $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box:first').addClass('hide');
    //             $this.parent('.sub-department-box-name-symbol-content-box').prepend(`<i class="material-icons arrow-right" id="arrow_button">keyboard_arrow_right</i>`);
    //             $this.remove();
    //         }
    //     } else {
    //         // //console.log("!@!@")
    //         var reqParams = {
    //             device_id: crossplat.device.uuid,
    //             list_by: "sub-department",
    //             id: $this.parent().parent('.sub-department-box').attr('data-id'),
    //             business_id: sessionStorage.getItem('business_id')
    //         }
    //         departmentList(reqParams)
    //             .then((response) => {
    //                 //console.log("departmentList", response);
    //                 $.each(response, function (index, element) {
    //                     //console.log("element", element);
    //                     var template = `<div class="sub-departments-content-box sub-department-box" data-id="${element.id}" data-parent-id="${element.parent_id}">
    //                     <div class="sub-department-box-name-symbol-content-box">
    //                         <i class="material-icons arrow-right" id="arrow_button">keyboard_arrow_right</i>                                
    //                         <div id="added_sub_department" type="text" contenteditable="false" class="validate" autocomplete="off" disabled>${element.name}</div>
    //                     </div>
    //                     <div class="sub_sub_department_conatiner_box" data-id="${element.id}"></div>
    //                 </div>`;
    //                     $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box:first').append(template);
    //                 });
    //                 // //console.log("check", $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box'));
    //                 // if ($this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box').hasClass('hide')) {
    //                 //     //console.log("remove class hide", $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box'));
    //                 //     $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box').removeClass('hide');
    //                 // } else {
    //                 //     //console.log("add class hide")
    //                 //     $this.parent().parent('.sub-department-box').find('.sub_sub_department_conatiner_box').addClass('hide');
    //                 //     $this.parent('.sub-department-box-name-symbol-content-box').prepend(`<i class="material-icons arrow-right" id="arrow_button">keyboard_arrow_right</i>`);
    //                 //     $this.remove();
    //                 // }
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 Materialize.toast("No sub-department found", 3000, 'rounded error-alert');
    //             })
    //     }

    // });


    // $(document).on('click', '#employee_department_assignment_arrow_button', function () {
    //     addLoader();
    //     var $this = $(this);
    //     //check already sub departments are present
    //     if ($this.parent().siblings('.sub_sub_department_conatiner_box').find('.sub-department-box').length > 0) {
    //         if ($this.parent().siblings('.sub_sub_department_conatiner_box').hasClass('hide')) {
    //             //console.log("yes hide, so show it");
    //             $this.parent().siblings('.sub_sub_department_conatiner_box').removeClass('hide');
    //             removeLoader();
    //         } else {
    //             //console.log("no hide, so hide it");
    //             $this.parent().siblings('.sub_sub_department_conatiner_box').addClass('hide');
    //             $this.parent('.sub-department-box-name-symbol-content-box').prepend(`<i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>`);
    //             $this.remove();
    //             removeLoader();
    //         }
    //     } else {
    //         //if yes, just hide and show
    //         //if no call api to show it
    //         var reqParams = {
    //             device_id: crossplat.device.uuid,
    //             list_by: "sub-department",
    //             id: $this.parent().parent('.sub-department-box').attr('data-id'),
    //             business_id: sessionStorage.getItem('business_id')
    //         }
    //         departmentList(reqParams)
    //             .then((response) => {
    //                 //console.log("departmentList", response);
    //                 $.each(response, function (index, element) {
    //                     // var template = `<div class="sub-departments-content-box sub-department-box" data-id="${element.id}" data-parent-id="${element.parent_id}">
    //                     //     <div class="sub-department-box-name-symbol-content-box">
    //                     //         <i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>                                
    //                     //         <div id="added_sub_department" type="text" data-length="60" contenteditable="false" class="validate" autocomplete="off" disabled>${element.name}</div>
    //                     //         <input type="checkbox" class="filled-in department-selected" id="filled-in-box-${element.id}" />
    //                     //         <label for="filled-in-box-${element.id}"></label>
    //                     //     </div>
    //                     //     <div class="sub_sub_department_conatiner_box hide" data-id="${element.id}"></div>
    //                     // </div>`;
    //                     // $this.parent().siblings('.sub_sub_department_conatiner_box').append(template);
    //                     if ($('#employee-contact-add-access-for-employee-contact-department-wise-selection-modal').length > 0) {
    //                         var template = `<div class="sub-departments-content-box sub-department-box" data-id="${element.id}" data-parent-id="${element.parent_id}">
    //                         <div class="sub-department-box-name-symbol-content-box">
    //                             <i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>                                
    //                             <div id="added_sub_department" type="text" data-length="60" contenteditable="false" class="validate" autocomplete="off" disabled>${element.name}</div>
    //                             <input type="checkbox" class="filled-in department-selected" data-id="${element.id}" id="filled-in-box-${element.id}" />
    //                             <label for="filled-in-box-${element.id}"></label>
    //                         </div>
    //                         <div class="sub_sub_department_conatiner_box hide" data-id="${element.id}"></div>
    //                     </div>`;
    //                         $this.parent().siblings('.sub_sub_department_conatiner_box').append(template);
    //                         if (digibiz.access_list.length > 0) {
    //                             $.each(digibiz.access_list, function (index, value) {
    //                                 // value.access_data.id
    //                                 //console.log("present access", value.access_data.id);
    //                                 $(`.department-selected[data-id="${value.access_data.id}"]`).prop('checked', true);
    //                             });
    //                         }
    //                     } else {
    //                         var template = `<div class="sub-departments-content-box sub-department-box" data-id="${element.id}" data-parent-id="${element.parent_id}">
    //                         <div class="sub-department-box-name-symbol-content-box">
    //                             <i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>                                
    //                             <div id="added_sub_department" type="text" data-length="60" contenteditable="false" class="validate" autocomplete="off" disabled>${element.name}</div>
    //                             <input type="checkbox" class="filled-in department-selected" id="filled-in-box-${element.id}" />
    //                             <label for="filled-in-box-${element.id}"></label>
    //                         </div>
    //                         <div class="sub_sub_department_conatiner_box hide" data-id="${element.id}"></div>
    //                     </div>`;
    //                         $this.parent().siblings('.sub_sub_department_conatiner_box').append(template);
    //                     }
    //                 });
    //                 if ($this.parent().siblings('.sub_sub_department_conatiner_box').hasClass('hide')) {
    //                     //console.log("yes hide, so show it");
    //                     $this.parent().siblings('.sub_sub_department_conatiner_box').removeClass('hide');
    //                     removeLoader();
    //                 } else {
    //                     //console.log("no hide, so hide it");
    //                     $this.parent().siblings('.sub_sub_department_conatiner_box').addClass('hide');
    //                     $this.parent('.sub-department-box-name-symbol-content-box').prepend(`<i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>`);
    //                     $this.remove();
    //                     removeLoader();
    //                 }

    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 //console.log("error in depart list");
    //             })
    //     }

    // });

    //not-used
    // $(document).on('click', '#employee_department_assignment_btn', function () {
    //     addLoader();
    //     var reqParams = {
    //         device_id: crossplat.device.uuid,
    //         list_by: "department",
    //         business_id: sessionStorage.getItem('business_id')
    //     }
    //     departmentList(reqParams)
    //         .then((departmentResponse) => {
    //             //console.log("departmentResponse", departmentResponse);
    //             var departmentListResponse = {
    //                 departmentList: departmentResponse
    //             }
    //             fetch.getHtml(function (fetcherror, html) {
    //                 var modal_data = {
    //                     modal_id: "assign-employee-department-modal",
    //                     modal_header: "Assign Employee Department",
    //                     modal_platform: crossplat.device.platform,
    //                     modal_body: html,
    //                     modal_action_buttons: [{
    //                         "name": "Confirm",
    //                         "id": "confirm_employee_department_assignment",
    //                     }]
    //                 }
    //                 showModal(modal_data, function () {
    //                     removeLoader();
    //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                     } else {
    //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                     }
    //                 });
    //             }, 'layouts/popup/employee_department_assignment_list', '#employee-department-assignment-template', departmentListResponse);
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("error in department list");
    //         })
    // });

    $(document).on('click', '#employee_department_assignment_btn', function () {
        addLoader();
        digibiz.department_list_selection = [];
        var reqParams = {
            device_id: crossplat.device.uuid,
            list_by: "department",
            business_id: sessionStorage.getItem('business_id')
        }
        //console.log("reqParams", reqParams);
        departmentList(reqParams)
            .then((departmentResponse) => {
                //console.log("departmentResponse", departmentResponse);
                // var departmentListResponse = {
                //     departmentList: departmentResponse
                // }
                var getAlreadyAssignedDepartments = [];
                $.each($('.employee-department-assignment-box'), function (index, element) {
                    getAlreadyAssignedDepartments.push({
                        "id": $(element).attr('data-id'),
                        "name": $(element).find('.employee-department-assignment-name').text()
                    })
                })
                digibiz.alreadySelectedDepartment = getAlreadyAssignedDepartments;
                var modal_data = {
                    modal_id: "assign-employee-department-modal",
                    modal_header: "Assign Employee Department",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="department-list-main-container">
                                            <span class="searchbtn waves-effect"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="department-list-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons department-list-close-btn hide">close</i></span>
                                        </div>
                                        <div id="department-list-selection-wrapper"></div>
                                        </div>`,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "confirm_employee_department_assignment",
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    processDepartmentListSelection(departmentResponse, function () {
                        setTimeout(function () {
                            // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                            let element = document.querySelector(".expand-search-input");
                            //console.log('element11click', element);
                            if (element) {
                                //console.log('element', element);
                                //if element is there
                                element.addEventListener("input", function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element.setAttribute("socketid", timestamp);
                                });
                                element.addEventListener("keyup", function (e) {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element.getAttribute("socketid");
                                    keyword = element.value;
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword
                                        };
                                        switch (currentroute) {
                                            case 'employee_create':
                                                if ($('#assign-employee-department-modal').length > 0) {
                                                    data['index'] = 'getEmployeeCreatDepartmentSelection';
                                                    data['business_id'] = sessionStorage.getItem('business_id');
                                                }
                                                break;
                                            default:
                                                break;
                                        }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part")
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        element.removeAttribute("socketid");
                                        switch (currentroute) {
                                            case 'employee_create':
                                                if ($('#assign-employee-department-modal').length > 0) {
                                                    processDepartmentListSelection(digibiz.department_list_selection, function () {
                                                    });
                                                }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                            }
                        }, 100);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in department list");
            })
    });

    $(document).on('change', '.selected-department', function () {
        //console.log("selected dept")
        addLoader();
        var $this = $(this);
        var getid = $(this).attr('data-id');
        if ($('#assign-employee-department-modal').length > 0 || $('#department-wise-employees-list-modal').length > 0) {
            var index = digibiz.department_list_selection.findIndex(e => e.id == getid);
            if (index != -1) {
                if ($($this).is(':checked')) {
                    digibiz.department_list_selection[index]['selected'] = true;
                } else {
                    digibiz.department_list_selection[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    // $(document).on('change', '.communication-group-employee-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     var getid = $(this).attr('data-dj-unique-employee-id');
    //     if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
    //         var getGroupFrom = $(this).parents('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type');
    //         if (getGroupFrom == "employee_list") {
    //             var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.member.dj_unique_employee_id == getid);
    //             if (index != -1) {
    //                 if ($($this).is(':checked')) {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
    //                 } else {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
    //                     //filter from already selected
    //                     // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
    //                 }
    //             }
    //         } else if (getGroupFrom == "standard_group") {//standard group
    //             var getGroupId = $($this).parents('.accordion-content').attr('data-group-id');
    //             //console.log("getGroupId", getGroupId)
    //             // //check in the global array
    //             // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == getGroupId);
    //             // if (getIndex > -1) {
    //             //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == getGroupId);
    //             //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == getid);
    //             //     //console.log("getEmployeeIndex", getEmployeeIndex)
    //             //     if (getEmployeeIndex > -1) {
    //             //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
    //             //     }
    //             // }
    //             if ($($this).is(':checked')) {
    //                 var getRecord = digibiz.employeeSelectedContactList.find((e) => e.id == getid && e.group_id == getGroupId);
    //                 if (getRecord == undefined) {
    //                     digibiz.employeeSelectedContactList.push({
    //                         id: getid,
    //                         group_id: getGroupId,
    //                         selected: true
    //                     })
    //                 }
    //             } else {
    //                 digibiz.employeeSelectedContactList = digibiz.employeeSelectedContactList.filter((o) => {
    //                     return o.id != getid
    //                 })

    //             }
    //         } else {
    //             var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
    //             if (index != -1) {
    //                 if ($($this).is(':checked')) {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
    //                 } else {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
    //                     //filter from already selected
    //                     // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
    //                 }
    //             }
    //         }
    //         removeLoader();
    //     } else if ($('#modal-communication-group-employees-selection').length > 0) {
    //         var index = digibiz.communicationGroupEmployeeSelectionList.findIndex(e => e.dj_unique_employee_id == getid);
    //         if (index != -1) {
    //             if ($($this).is(':checked')) {
    //                 digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = true;
    //             } else {
    //                 digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = false;
    //             }
    //         }
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    $(document).on('change', '.communication-group-employee-select-btn', function () {
        addLoader();
        var $this = $(this);
        var getid = $(this).attr('data-dj-unique-employee-id');
        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
            var getGroupFrom = $(this).parents('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type');
            if (getGroupFrom == "employee_list") {
                var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.member.dj_unique_employee_id == getid);
                if (index != -1) {
                    if ($($this).is(':checked')) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
                    } else {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
                        //filter from already selected
                        // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
                    }
                }
            } else if (getGroupFrom == "standard_group") {//standard group
                var getGroupId = $($this).parents('.accordion-content').attr('data-group-id');
                //console.log("getGroupId", getGroupId)
                // //check in the global array
                // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == getGroupId);
                // if (getIndex > -1) {
                //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == getGroupId);
                //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == getid);
                //     //console.log("getEmployeeIndex", getEmployeeIndex)
                //     if (getEmployeeIndex > -1) {
                //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
                //     }
                // }
                if ($($this).is(':checked')) {
                    var getRecord = digibiz.employeeSelectedContactList.find((e) => e.id == getid && e.group_id == getGroupId);
                    if (getRecord == undefined) {
                        digibiz.employeeSelectedContactList.push({
                            id: getid,
                            group_id: getGroupId,
                            selected: true
                        })
                    }
                } else {
                    digibiz.employeeSelectedContactList = digibiz.employeeSelectedContactList.filter((o) => {
                        return o.id != getid
                    })

                }
            } else {
                var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
                if (index != -1) {
                    if ($($this).is(':checked')) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
                    } else {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
                        //filter from already selected
                        // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
                    }
                }
            }
            removeLoader();
        } else if ($('#modal-communication-group-employees-selection').length > 0) {
            var index = digibiz.communicationGroupEmployeeSelectionList.findIndex(e => e.dj_unique_employee_id == getid);
            if (index != -1) {
                if ($($this).is(':checked')) {
                    digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = true;
                } else {
                    digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('change', '.communication-group-create-employee-group-selected', function () {
        addLoader();
        var $this = $(this);
        var getid = $(this).parents('.group-selection-wrapper').attr('data-group-id');
        if ($('#modal-communication-group-employee-group-selection').length > 0) {
            var index = digibiz.communicationCreateEmployeeGroupsList.findIndex(e => e.id == getid);
            if (index != -1) {
                if ($($this).is(':checked')) {
                    digibiz.communicationCreateEmployeeGroupsList[index]['selected'] = true;
                } else {
                    digibiz.communicationCreateEmployeeGroupsList[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('change', '.communication-group-moderator-select-btn', function () {
        addLoader();
        var $this = $(this);
        var getid = $(this).attr('data-id');
        //console.log("getid", getid)
        if ($('#modal-communication-group-moderator-selection').length > 0) {
            var index = digibiz.communicationGroupActivate.findIndex(e => e.member.id == getid);
            if (index != -1) {
                if ($($this).is(':checked')) {
                    digibiz.communicationGroupActivate[index]['selected'] = true;
                } else {
                    digibiz.communicationGroupActivate[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('change', '.communication-group-create-collaborator-group-selected', function () {
        addLoader();
        var $this = $(this);
        var getid = $(this).parents('.group-selection-wrapper').attr('data-group-id');
        if ($('#modal-communication-group-collaborator-group-selection').length > 0) {
            var index = digibiz.communicationCreateCollaboratorGroupsList.findIndex(e => e.id == getid);
            if (index != -1) {
                if ($($this).is(':checked')) {
                    digibiz.communicationCreateCollaboratorGroupsList[index]['selected'] = true;
                } else {
                    digibiz.communicationCreateCollaboratorGroupsList[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('change', '.communication-group-create-customer-group-selected', function () {
        addLoader();
        var $this = $(this);
        var getid = $(this).parents('.group-selection-wrapper').attr('data-group-id');
        if ($('#modal-communication-group-customer-group-selection').length > 0) {
            var index = digibiz.communicationCreateCustomersGroupsList.findIndex(e => e.id == getid);
            if (index != -1) {
                if ($($this).is(':checked')) {
                    digibiz.communicationCreateCustomersGroupsList[index]['selected'] = true;
                } else {
                    digibiz.communicationCreateCustomersGroupsList[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.colloborator-add-search-business-btn', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        var $this = $(this);
        var getid = $(this).parent('.collaborator-contact-wrapper').attr('data-id');
        //console.log("getid", getid);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.colloborator-add-search-business-btn').toggleClass('selected-row');
        }
        // if ($($this).find('input:checkbox').is(':checked')) {
        if ($($this).hasClass('selected-row')) {
            //console.log("checkeddd")
            if (digibiz.collboratorContactAdd.hasOwnProperty('selected') && digibiz.collboratorContactAdd.selected == true) {
                //console.log("!!!!")
                //show tick if checked
                if (!$(e.target).is('input:checkbox')) {
                    $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.colloborator-add-search-business-btn').toggleClass('selected-row');
                }
                Materialize.toast(`Can select only one business.`, 3000, "round error-alert");
            } else {
                //console.log("@@@")
                digibiz.collboratorContactAdd = {
                    selected: true,
                    business_id: getid
                };
            }
        } else {
            if (digibiz.collboratorContactAdd.hasOwnProperty('selected') && digibiz.collboratorContactAdd.selected == true && digibiz.collboratorContactAdd.business_id == getid) {
                digibiz.collboratorContactAdd = {};
            } else {
                //console.log("**1**")
            }
        }
        removeLoader();
    });












    // $(document).on('click', '#confirm_employee_department_assignment', function () {
    //     addLoader();
    //     var department_assignment_data = [];
    //     var getEmployeeId = sessionStorage.getItem('employee_id');
    //     //get all checkbox
    //     var getCheckboxes = $('.selected-department');
    //     $.each(getCheckboxes, function (index, element) {
    //         if ($(element).is(':checked')) {
    //             department_assignment_data.push({
    //                 "id": $(element).parents('.department-wrapper').attr('data-id'),
    //                 "name": $(element).parents('.department-wrapper').find('.department-name').find('span').text()
    //             })
    //         }
    //     })
    //     if (department_assignment_data.length > 0) {
    //         var requestParams = {
    //             device_id: crossplat.device.uuid,
    //             id: getEmployeeId,
    //             data: {
    //                 department_assignment: department_assignment_data
    //             }
    //         }
    //         employeeUpdate(requestParams)
    //             .then((response) => {
    //                 removeLoader();
    //                 digibiz.alreadySelectedDepartment = [];
    //                 //console.log("employeeUpdate", response);
    //                 $('#assign-employee-department-modal').remove();
    //                 $('.employee-department-assignment-list-main-container').find('.employee-department-assignment-box').remove();
    //                 if (response.hasOwnProperty('department_assignment') && response.department_assignment) {
    //                     $.each(response.department_assignment, function (index, department) {
    //                         var template = `<div class="employee-department-assignment-box" data-id="${this.id}">
    //                     <div class="employee-department-assignment-wrapper">
    //                     <div class="employee-department-assignment-name-container">                      
    //                         <div class="employee-department-assignment-name-wrapper">                      
    //                             <div class="employee-department-assignment-name">${this.name}</div>                      
    //                         </div>                      
    //                     </div>                   
    //                     <div class="btn-wrap">              
    //                         <div class="more-menu-wrapper" id="employee_department_assignment_remove"><i class="material-icons">delete</i></div>
    //                     </div>  
    //                     </div>              
    //                 </div>`;
    //                         $('.employee-department-assignment-list-main-container').append(template);
    //                     });
    //                 }
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 $('#assign-employee-department-modal').remove();
    //                 //console.log("error in employee update");
    //             })
    //     } else {
    //         removeLoader();
    //         Materialize.toast("Please select atleast 1 department.", 3000, 'rounded error-alert');
    //     }
    // });

    $(document).on('click', '#confirm_employee_department_assignment', function () {
        addLoader();
        var department_assignment_data = [];
        var getEmployeeId = sessionStorage.getItem('employee_id');
        //get all checkbox
        // var getCheckboxes = $('.selected-department');
        // $.each(getCheckboxes, function (index, element) {
        //     if ($(element).is(':checked')) {
        //         department_assignment_data.push({
        //             "id": $(element).parents('.department-wrapper').attr('data-id'),
        //             "name": $(element).parents('.department-wrapper').find('.department-name').find('span').text()
        //         })
        //     }
        // })
        var getCheckboxes = $('.department-list-data-wrapper');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).hasClass('selected-row')) {
                department_assignment_data.push({
                    "id": $(element).attr('data-id'),
                    "name": firstLetterUpperCase($(element).find('.department-name').find('span').text())
                })
            }
        })
        if (department_assignment_data.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                dj_unique_employee_id: getEmployeeId,
                department_assignment: department_assignment_data
            }
            employeeDepartmentAssignmentAdd(requestParams)
                .then((response) => {
                    //console.log("employeeDepartmentAssignmentAdd", response);
                    removeLoader();
                    digibiz.alreadySelectedDepartment = [];
                    //console.log("employeeUpdate", response);
                    $('#assign-employee-department-modal').remove();
                    $('.employee-department-assignment-list-main-container').find('.employee-department-assignment-box').remove();
                    if (response.length > 0) {
                        $.each(response, function (index, department) {
                            var template = `<div class="employee-department-assignment-box" data-id="${department.department_id}" data-record-id="${department.id}">
                        <div class="employee-department-assignment-wrapper">
                        <div class="employee-department-assignment-name-container">                      
                            <div class="employee-department-assignment-name-wrapper">                      
                                <div class="employee-department-assignment-name">${department.department_name}</div>                      
                            </div>                      
                        </div>                   
                        <div class="btn-wrap">              
                            <div class="more-menu-wrapper" id="employee_department_assignment_remove"><i class="material-icons">delete</i></div>
                        </div>  
                        </div>              
                    </div>`;
                            $('.employee-department-assignment-list-main-container').append(template);
                        });
                    }
                })
                .catch((err) => {
                    removeLoader();
                    $('#assign-employee-department-modal').remove();
                    //console.log("error in employee update");
                })
        } else {
            removeLoader();
            Materialize.toast("Please select atleast 1 department.", 3000, 'rounded error-alert');
        }
    });

    $(document).on('click', '#employee_department_assignment_remove', function () {
        addLoader();

        var getDepartmentId = $(this).parents('.employee-department-assignment-box').attr('data-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('employee_id'),
            department_id: getDepartmentId
        }
        employeeDepartmentAssignmentDelete(reqParam)
            .then((response) => {
                $(`.employee-department-assignment-box[data-id="${getDepartmentId}"]`).remove();
                Materialize.toast("Successfully deleted.", 3000, 'rounded error-alert');
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`${err.msg}`, 3000, 'rounded error-alert');
            })

        // var getDepartmentId = $(this).parents('.employee-department-assignment-box').attr('data-id');
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     id: sessionStorage.getItem('employee_id'),
        //     department_id: getDepartmentId
        // }
        // employeeDepartmentDelete(reqParam)
        //     .then((response) => {
        //         $(`.employee-department-assignment-box[data-id="${getDepartmentId}"]`).remove();
        //         Materialize.toast("Successfully deleted.", 3000, 'rounded error-alert');
        //         removeLoader();
        //     })
        //     .catch((err) => {
        //         removeLoader();
        //         Materialize.toast(`${err.msg}`, 3000, 'rounded error-alert');
        //     })
    });

    $(document).on('click', '#added_sub_department', function () {
        if ($('body').attr('app') == "department_create") {
            addLoader();
            var getDepartmentId = $(this).parents('.sub-department-box').attr('data-id');
            //console.log("getDepartmentId", getDepartmentId);
            var action_sheet_parms = {
                action_id: "sub_department_actions_sheet",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Edit",
                    attr: [{ name: "class", value: "edit_sub_dept" }]
                },
                // {
                //     name: "Delete",
                //     attr: [{ name: "class", value: "delete_sub_dept" }]
                // },
                {
                    name: "Add-Sub-Department",
                    attr: [{ name: "class", value: "add_sub_dept" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('action_dept_id', getDepartmentId);
            });
        }
    });


    $(document).on('click', '.add_sub_dept', function () {
        var getId = $(".action-sheet-container").attr('action_dept_id');
        $('#sub_department_actions_sheet').remove();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-new-department-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Name",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-new-department-cancel" }]
                    },
                    {
                        name: "Add",
                        attr: [{ name: "id", value: "alert-new-department-add" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    $('#modal-new-department-add-cancel').attr('data-parent-id', getId);
                });
            }
        }, 'layouts/popup/new_department', '#new-department-template', null);
    });

    $(document).on('click', '.edit_sub_dept', function () {
        var getId = $(".action-sheet-container").attr('action_dept_id');
        $('#sub_department_actions_sheet').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId
        }
        departmentGet(requestParams)
            .then((response) => {
                //console.log("response", response);
                var getData = {
                    name: response.name
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        var alert_parms = {
                            alert_id: "modal-edit-department-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Name",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-department-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-department-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-edit-department-add-cancel').attr('data-parent-id', response.parent_id);
                            $('#modal-edit-department-add-cancel').attr('data-id', response.id);
                        });
                    }
                }, 'layouts/popup/new_department', '#new-department-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting department", 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#alert-edit-department-cancel', function () {
        $('#modal-edit-department-add-cancel').remove();
    });

    $(document).on('click', '#alert-edit-department-add', function () {
        addLoader();
        var departmentId = $('#modal-edit-department-add-cancel').attr('data-id');
        var parentId = $('#modal-edit-department-add-cancel').attr('data-parent-id');
        var getNewDepartmentName = $('#new_department_name');
        if (validateEmployeeData(getNewDepartmentName)) {
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: departmentId,
                name: firstLetterUpperCase($(getNewDepartmentName).text().trim())
            }
            departmentUpdate(reqParams)
                .then((result) => {
                    removeLoader();
                    //console.log("result", result);
                    $('#modal-edit-department-add-cancel').remove();
                    //display the new edited name in the list
                    // $(`.sub-department-box[data-id="${departmentId}"]`).find('#added_sub_department').text(result.name);
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast("Error in getting department", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.action-sheet-cancel-btn', function () {
        window.pauseInterval = null;
        $(".action-sheet-container").remove();
    });

    $(document).on('click', '.filemanger_container_toggle', function () {
        //console.log("opened");
        $('.filemanger_container_toggle').addClass('active');
    });

    $(document).on('click', '.group-creation', function () {
        addLoader();
        location.hash = `group_create`;
    });

    $(document).on('click', '.department-management', function () {
        addLoader();
        location.hash = `department_management`;
    });

    // $(document).on('click', '.employee-types', function () {
    //     addLoader();
    //     location.hash = `employee/types`;
    // });

    // $(document).on('click', '.employee-category', function () {
    //     addLoader();
    //     location.hash = `employee/category`;
    // });

    // $(document).on('click', '.employee-designation', function () {
    //     addLoader();
    //     location.hash = `employee/designation`;
    // });

    // $(document).on('click', '#employee_type_add_button', function () {
    //     $('#employee_type').text("");
    //     $('.employee-types-create-container').removeClass('hide');
    // });
    $(document).on('click', '#add-employee-type', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-employee-type-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Add Employee Type",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-add-employee-type-cancel" }]
                    },
                    {
                        name: "Save",
                        attr: [{ name: "id", value: "alert-add-employee-type-confirm" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        }, 'layouts/popup/add_new_employee_type', '#add-new-employee-type-template', null);
    });

    $(document).on('click', '#alert-add-employee-type-cancel', function () {
        $('#modal-employee-type-add-cancel').remove();
    });

    $(document).on('click', '#alert-add-employee-type-confirm', function () {
        addLoader();
        $(this).prop('disabled', false);
        var getEmployeeType = $('#employee_type');
        if (validateEmployeeData(getEmployeeType)) {
            var reqParms = {
                device_id: crossplat.device.uuid,
                type: firstLetterUpperCase($(getEmployeeType).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            employeeTypeAdd(reqParms)
                .then((response) => {
                    //console.log("response", response);
                    // var template = `<div class="employee-type-wrapper" data-employee-type-id="${response.id}">
                    // <div class="employee-type-container">
                    //     <div class="employee_type_name">${response.type}</div>                    
                    // </div>   
                    // <div class="more-menu-wrapper show-action-employee-type-data"><i class="material-icons">more_vert</i></div>                
                    // </div>`;
                    // $('.employee-types-content-box').append(template);
                    // $('.employee-types-create-container').addClass('hide');
                    Materialize.toast("Successfully Saved.", 3000, 'round success-alert');
                    $('#modal-employee-type-add-cancel').remove();
                    removeLoader();
                    $(this).prop('disabled', false);
                })
                .catch((err) => {
                    removeLoader();
                    $(this).prop('disabled', false);
                    Materialize.toast("Error in adding department", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    // $(document).on('click', '#employee_category_add_button', function () {
    //     $('#employee_category').text("");
    //     $('.employee-category-create-container').removeClass('hide');
    // });
    $(document).on('click', '#add-employee-category', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-employee-category-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Add Employee Category",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-add-employee-category-cancel" }]
                    },
                    {
                        name: "Save",
                        attr: [{ name: "id", value: "alert-add-employee-category-confirm" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        }, 'layouts/popup/add_new_employee_category', '#add-new-employee-category-template', null);
    });

    $(document).on('click', '#alert-add-employee-category-cancel', function () {
        $('#modal-employee-category-add-cancel').remove();
    });

    $(document).on('click', '#alert-add-employee-category-confirm', function () {
        addLoader();
        $(this).prop('disabled', false);
        var getEmployeeCategory = $('#employee_category');
        if (validateEmployeeData(getEmployeeCategory)) {
            // var getEmployeeCategory = $(this).parents('.employee-category-create-container').find('#employee_category').text();
            var reqParms = {
                device_id: crossplat.device.uuid,
                category: firstLetterUpperCase($(getEmployeeCategory).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            employeeCategoryAdd(reqParms)
                .then((response) => {
                    //console.log("response", response);
                    // var template = `<div class="employee-category-wrapper" data-employee-category-id="${response.id}">
                    // <div class="employee-category-container">
                    //     <div class="employee_category_name">${response.category}</div>                    
                    // </div>   
                    // <div class="more-menu-wrapper show-action-employee-category-data"><i class="material-icons">more_vert</i></div>                
                    // </div>`;
                    // $('.employee-category-content-box').append(template);
                    // $('.employee-category-create-container').addClass('hide');
                    Materialize.toast("Successfully Saved.", 3000, 'round success-alert');
                    $('#modal-employee-category-add-cancel').remove();
                    removeLoader();
                    $(this).prop('disabled', false);
                })
                .catch((err) => {
                    removeLoader();
                    $(this).prop('disabled', false);
                    Materialize.toast("Error in adding employee category", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    // $(document).on('click', '#employee_designation_add_button', function () {
    //     $('#employee_designation').text("");
    //     $('.employee-designation-create-container').removeClass('hide');
    // });
    $(document).on('click', '#add-employee-designation', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-employee-designation-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Add Employee Designation",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-add-employee-designation-cancel" }]
                    },
                    {
                        name: "Save",
                        attr: [{ name: "id", value: "alert-add-employee-designation-confirm" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        }, 'layouts/popup/add_new_employee_designation', '#add-new-employee-designation-template', null);
    });

    $(document).on('click', '#alert-add-employee-designation-cancel', function () {
        $('#modal-employee-designation-add-cancel').remove();
    });

    $(document).on('click', '#alert-add-employee-designation-confirm', function () {
        addLoader();
        $(this).prop('disabled', false);
        var getEmployeeDesignation = $('#employee_designation');
        if (validateEmployeeData(getEmployeeDesignation)) {
            // var getEmployeeDesignation = $(this).parents('.employee-designation-create-container').find('#employee_designation').text();
            var reqParms = {
                device_id: crossplat.device.uuid,
                designation: firstLetterUpperCase($(getEmployeeDesignation).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            employeeDesignationAdd(reqParms)
                .then((response) => {
                    //console.log("response", response);
                    // var template = `<div class="employee-designation-wrapper" data-employee-designation-id="${response.id}">
                    // <div class="employee-designation-container">
                    //     <div class="employee_designation_name">${response.designation}</div>                    
                    // </div>   
                    // <div class="more-menu-wrapper show-action-employee-designation-data"><i class="material-icons">more_vert</i></div>                
                    // </div>`;
                    // $('.employee-designation-content-box').append(template);
                    // $('.employee-designation-create-container').addClass('hide');
                    Materialize.toast("Successfully Saved.", 3000, 'round success-alert');
                    $('#modal-employee-designation-add-cancel').remove();
                    removeLoader();
                    $(this).prop('disabled', false);
                })
                .catch((err) => {
                    removeLoader();
                    $(this).prop('disabled', false);
                    Materialize.toast("Error in adding employee designation", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '#save-employee-type', function () {
        addLoader();
        $(this).prop('disabled', false);
        var getEmployeeType = $(this).parents('.employee-types-create-container').find('#employee_type');
        if (validateEmployeeData(getEmployeeType)) {
            var reqParms = {
                device_id: crossplat.device.uuid,
                type: firstLetterUpperCase($(getEmployeeType).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            employeeTypeAdd(reqParms)
                .then((response) => {
                    //console.log("response", response);
                    // var template = `<div class="employee-type-wrapper" data-employee-type-id="${response.id}">
                    // <div class="employee-type-container">
                    //     <div class="employee_type_name">${response.type}</div>                    
                    // </div>   
                    // <div class="more-menu-wrapper show-action-employee-type-data"><i class="material-icons">more_vert</i></div>                
                    // </div>`;
                    // $('.employee-types-content-box').append(template);
                    // $('.employee-types-create-container').addClass('hide');
                    Materialize.toast("Successfully Saved.", 3000, 'round success-alert');
                    //console.log("12345")
                    $('#modal-employee-type-add-cancel').remove();
                    removeLoader();
                    $(this).prop('disabled', false);
                })
                .catch((err) => {
                    removeLoader();
                    $(this).prop('disabled', false);
                    Materialize.toast("Error", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '#save-employee-category', function () {
        addLoader();
        $(this).prop('disabled', false);
        var getEmployeeCategory = $(this).parents('.employee-category-create-container').find('#employee_category');
        if (validateEmployeeData(getEmployeeCategory)) {
            // var getEmployeeCategory = $(this).parents('.employee-category-create-container').find('#employee_category').text();
            var reqParms = {
                device_id: crossplat.device.uuid,
                category: firstLetterUpperCase($(getEmployeeCategory).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            employeeCategoryAdd(reqParms)
                .then((response) => {
                    //console.log("response", response);
                    // var template = `<div class="employee-category-wrapper" data-employee-category-id="${response.id}">
                    // <div class="employee-category-container">
                    //     <div class="employee_category_name">${response.category}</div>                    
                    // </div>   
                    // <div class="more-menu-wrapper show-action-employee-category-data"><i class="material-icons">more_vert</i></div>                
                    // </div>`;
                    // $('.employee-category-content-box').append(template);
                    // $('.employee-category-create-container').addClass('hide');
                    Materialize.toast("Successfully Saved.", 3000, 'round success-alert');
                    removeLoader();
                    $(this).prop('disabled', false);
                })
                .catch((err) => {
                    removeLoader();
                    $(this).prop('disabled', false);
                    Materialize.toast("Error in adding employee category", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '#save-employee-designation', function () {
        addLoader();
        $(this).prop('disabled', false);
        var getEmployeeDesignation = $(this).parents('.employee-designation-create-container').find('#employee_designation');
        if (validateEmployeeData(getEmployeeDesignation)) {
            // var getEmployeeDesignation = $(this).parents('.employee-designation-create-container').find('#employee_designation').text();
            var reqParms = {
                device_id: crossplat.device.uuid,
                designation: firstLetterUpperCase($(getEmployeeDesignation).text().trim()),
                business_id: sessionStorage.getItem('business_id')
            }
            employeeDesignationAdd(reqParms)
                .then((response) => {
                    //console.log("response", response);
                    // var template = `<div class="employee-designation-wrapper" data-employee-designation-id="${response.id}">
                    // <div class="employee-designation-container">
                    //     <div class="employee_designation_name">${response.designation}</div>                    
                    // </div>   
                    // <div class="more-menu-wrapper show-action-employee-designation-data"><i class="material-icons">more_vert</i></div>                
                    // </div>`;
                    // $('.employee-designation-content-box').append(template);
                    // $('.employee-designation-create-container').addClass('hide');
                    Materialize.toast("Successfully Saved.", 3000, 'round success-alert');
                    removeLoader();
                    $(this).prop('disabled', false);
                })
                .catch((err) => {
                    removeLoader();
                    $(this).prop('disabled', false);
                    Materialize.toast("Error in adding employee designation", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    //for employee type
    $(document).on('click', '.show-action-employee-type-data', function () {
        var getEmployeeTypeId = $(this).parent('.employee-type-wrapper').attr('data-employee-type-id');
        var action_sheet_parms = {
            action_id: "employee_type_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "edit_employee_type" }]
            },
                // {
                //     name: "Delete",
                //     attr: [{ name: "class", value: "delete_employee_type" }]
                // }
            ]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('employee-type-id', getEmployeeTypeId);
        });
    });

    $(document).on('click', '.edit_employee_type', function () {
        addLoader();
        var getEmployeeTypeId = $(".action-sheet-container").attr('employee-type-id');
        $(".action-sheet-container").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeTypeId
        }
        employeeTypeGet(requestParams)
            .then((response) => {
                //console.log("response", response);
                var getData = {
                    type: response.type
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        removeLoader();
                        var alert_parms = {
                            alert_id: "modal-edit-employee-type-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Employee Type",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-employee-type-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-employee-type-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-edit-employee-type-add-cancel').attr('data-employee-type-id', response.id);
                        });
                    }
                }, 'layouts/popup/edit_employee_type', '#edit-employee-type-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting employee type", 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#alert-edit-employee-type-cancel', function () {
        $('#modal-edit-employee-type-add-cancel').remove();
    });

    $(document).on('click', '#alert-edit-employee-type-add', function () {
        addLoader();
        var getEmployeeTypeId = $('#modal-edit-employee-type-add-cancel').attr('data-employee-type-id');
        var getEmployeeType = $('#edited_employee_type');
        if (validateEmployeeData(getEmployeeType)) {
            $('#modal-edit-employee-type-add-cancel').remove();
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: getEmployeeTypeId,
                type: firstLetterUpperCase($(getEmployeeType).text().trim())
            }
            employeeTypeUpdate(reqParams)
                .then((response) => {
                    //console.log("response", response);
                    removeLoader();
                    // Materialize.toast("Successfully updated.", 3000, 'round success-alert');
                    // $(this).prop('disabled', false);
                    // $(`.employee-type-wrapper[data-employee-type-id="${response.id}"]`).find('.employee_type_name').text(response.type);
                })
                .catch((err) => {
                    removeLoader();
                    if (err.msg == "no updated data found") {
                        Materialize.toast("Successfully updated.", 3000, 'round success-alert');
                    } else {
                        Materialize.toast("Error in updating employee type", 3000, 'round success-alert');
                    }
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.delete_employee_type', function () {
        addLoader();
        var getEmployeeTypeId = $(".action-sheet-container").attr('employee-type-id');
        $(".action-sheet-container").remove();
        var alert_parms = {
            alert_id: "alert-delete-employee-type-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Employee Type`,
            alert_body: `Are you sure you want to delete the employee type?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-employee-type-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-employee-type-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-employee-type-confirm-cancel').attr('data-employee-type-id', getEmployeeTypeId); //set getEmployeeTypeId
        });

    });

    $(document).on('click', '#btn-delete-employee-type-cancel-no', function () {
        $('#alert-delete-employee-type-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-delete-employee-type-confirm-yes', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getEmployeeTypeId = $('#alert-delete-employee-type-confirm-cancel').attr('data-employee-type-id');
        $('#alert-delete-employee-type-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeTypeId
        }
        employeeTypeDelete(requestParams)
            .then((response) => {
                removeLoader();
                $(this).prop('disabled', false);
                //console.log("response", response);
                // $(`.employee-type-wrapper[data-employee-type-id="${getEmployeeTypeId}"]`).remove();
            })
            .catch((err) => {
                removeLoader();
                $(this).prop('disabled', false);
                Materialize.toast("Error in deleting employee type", 3000, 'round success-alert');
            })
    });

    //for employee category
    $(document).on('click', '.show-action-employee-category-data', function () {
        var getEmployeeCategoryId = $(this).parent('.employee-category-wrapper').attr('data-employee-category-id');
        var action_sheet_parms = {
            action_id: "employee_category_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "edit_employee_category" }]
            },
                // {
                //     name: "Delete",
                //     attr: [{ name: "class", value: "delete_employee_category" }]
                // }
            ]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('employee-category-id', getEmployeeCategoryId);
        });
    });

    $(document).on('click', '.edit_employee_category', function () {
        addLoader();
        var getEmployeeCategoryId = $(".action-sheet-container").attr('employee-category-id');
        $(".action-sheet-container").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeCategoryId
        }
        employeeCategoryGet(requestParams)
            .then((response) => {
                //console.log("response", response);
                var getData = {
                    category: response.category
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        removeLoader();
                        var alert_parms = {
                            alert_id: "modal-edit-employee-category-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Employee Category",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-employee-category-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-employee-category-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-edit-employee-category-add-cancel').attr('data-employee-category-id', response.id);
                        });
                    }
                }, 'layouts/popup/edit_employee_category', '#edit-employee-category-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting employee category", 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#alert-edit-employee-category-cancel', function () {
        $('#modal-edit-employee-category-add-cancel').remove();
    });

    $(document).on('click', '#alert-edit-employee-category-add', function () {
        addLoader();
        var getEmployeeCategoryId = $('#modal-edit-employee-category-add-cancel').attr('data-employee-category-id');
        var getEmployeeCategory = $('#edited_employee_category');
        if (validateEmployeeData(getEmployeeCategory)) {
            $('#modal-edit-employee-category-add-cancel').remove();
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: getEmployeeCategoryId,
                category: firstLetterUpperCase($(getEmployeeCategory).text().trim())
            }
            employeeCategoryUpdate(reqParams)
                .then((response) => {
                    //console.log("response", response);
                    removeLoader();
                    // $(`.employee-category-wrapper[data-employee-category-id="${response.id}"]`).find('.employee_category_name').text(response.category);
                })
                .catch((err) => {
                    removeLoader();
                    if (err.msg == "no updated data found") {
                        Materialize.toast("Successfully updated.", 3000, 'round success-alert');
                    } else {
                        Materialize.toast("Error in updating employee category", 3000, 'round success-alert');
                    }
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.delete_employee_category', function () {
        addLoader();
        var getEmployeeCategoryId = $(".action-sheet-container").attr('employee-category-id');
        $(".action-sheet-container").remove();
        var alert_parms = {
            alert_id: "alert-delete-employee-category-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Employee Category`,
            alert_body: `Are you sure you want to delete the employee category?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-employee-category-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-employee-category-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-employee-category-confirm-cancel').attr('data-employee-category-id', getEmployeeCategoryId); //set getEmployeeCategoryId
        });

    });

    $(document).on('click', '#btn-delete-employee-category-cancel-no', function () {
        $('#alert-delete-employee-category-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-delete-employee-category-confirm-yes', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getEmployeeCategoryId = $('#alert-delete-employee-category-confirm-cancel').attr('data-employee-category-id');
        $('#alert-delete-employee-category-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeCategoryId
        }
        employeeCategoryDelete(requestParams)
            .then((response) => {
                removeLoader();
                $(this).prop('disabled', false);
                //console.log("response", response);
                // $(`.employee-category-wrapper[data-employee-category-id="${getEmployeeCategoryId}"]`).remove();
            })
            .catch((err) => {
                removeLoader();
                $(this).prop('disabled', false);
                Materialize.toast("Error in deleting employee category", 3000, 'round success-alert');
            })
    });


    //for employee designation
    $(document).on('click', '.show-action-employee-designation-data', function () {
        var getEmployeeDesignationId = $(this).parent('.employee-designation-wrapper').attr('data-employee-designation-id');
        var action_sheet_parms = {
            action_id: "employee_designation_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "edit_employee_designation" }]
            },
                // {
                //     name: "Delete",
                //     attr: [{ name: "class", value: "delete_employee_designation" }]
                // }
            ]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('employee-designation-id', getEmployeeDesignationId);
        });
    });

    $(document).on('click', '.edit_employee_designation', function () {
        addLoader();
        var getEmployeeDesignationId = $(".action-sheet-container").attr('employee-designation-id');
        $(".action-sheet-container").remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeDesignationId
        }
        employeeDesignationGet(requestParams)
            .then((response) => {
                //console.log("response", response);
                var getData = {
                    designation: response.designation
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        removeLoader();
                        var alert_parms = {
                            alert_id: "modal-edit-employee-designation-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Employee Designation",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-employee-designation-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-employee-designation-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-edit-employee-designation-add-cancel').attr('data-employee-designation-id', response.id);
                        });
                    }
                }, 'layouts/popup/edit_employee_designation', '#edit-employee-designation-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting employee designation", 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#alert-edit-employee-designation-cancel', function () {
        $('#modal-edit-employee-designation-add-cancel').remove();
    });

    $(document).on('click', '#alert-edit-employee-designation-add', function () {
        addLoader();
        var getEmployeeDesignationId = $('#modal-edit-employee-designation-add-cancel').attr('data-employee-designation-id');
        var getEmployeeDesignation = $('#edited_employee_designation');
        if (validateEmployeeData(getEmployeeDesignation)) {
            $('#modal-edit-employee-designation-add-cancel').remove();
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: getEmployeeDesignationId,
                designation: firstLetterUpperCase($(getEmployeeDesignation).text().trim())
            }
            employeeDesignationUpdate(reqParams)
                .then((response) => {
                    removeLoader();
                    $(`.employee-designation-wrapper[data-employee-designation-id="${response.id}"]`).find('.employee_designation_name').text(response.designation);
                })
                .catch((err) => {
                    removeLoader();
                    if (err.msg == "no updated data found") {
                        Materialize.toast("Successfully updated.", 3000, 'round success-alert');
                    } else {
                        Materialize.toast("Error in updating employee designation", 3000, 'round success-alert');
                    }
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.delete_employee_designation', function () {
        addLoader();
        var getEmployeeDesignationId = $(".action-sheet-container").attr('employee-designation-id');
        $(".action-sheet-container").remove();
        var alert_parms = {
            alert_id: "alert-delete-employee-designation-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Employee Designation`,
            alert_body: `Are you sure you want to delete the employee designation?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-employee-designation-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-employee-designation-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-employee-designation-confirm-cancel').attr('data-employee-designation-id', getEmployeeDesignationId); //set getEmployeeCategoryId
        });

    });

    $(document).on('click', '#btn-delete-employee-designation-cancel-no', function () {
        $('#alert-delete-employee-designation-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-delete-employee-designation-confirm-yes', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getEmployeeDesignationId = $('#alert-delete-employee-designation-confirm-cancel').attr('data-employee-designation-id');
        $('#alert-delete-employee-designation-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeDesignationId
        }
        employeeDesignationDelete(requestParams)
            .then((response) => {
                removeLoader();
                $(this).prop('disabled', false);
                //console.log("response", response);
                $(`.employee-designation-wrapper[data-employee-designation-id="${getEmployeeDesignationId}"]`).remove();
            })
            .catch((err) => {
                removeLoader();
                $(this).prop('disabled', false);
                Materialize.toast("Error in deleting employee designation", 3000, 'round success-alert');
            })
    });

    /*******************************BUSINESS MANAGEMENT(starts)****************************/
    //create business tags
    $(document).on('click', '.business-tags', function () {
        addLoader();
        location.hash = `business/tags`;
    });

    //create business types
    $(document).on('click', '.business-types', function () {
        addLoader();
        location.hash = `business/types`;
    });

    //create business
    $(document).on('click', '.business-create', function () {
        addLoader();
        location.hash = `business/create`;
    });

    //add tags button
    $(document).on('click', '.add-business-tags-btn', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                removeLoader();
                var alert_parms = {
                    alert_id: "alert-business-tag-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Business Tag",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-business-tag-cancel" }]
                    },
                    {
                        name: "Save",
                        attr: [{ name: "id", value: "alert-business-tag-add" }]
                    }]
                }
                showAlert(alert_parms, function () {
                });
            }
        }, 'layouts/business_popup/business_tags', '#business-tag-template', null);
    });

    //cancel on add business type pop-up
    $(document).on('click', '#alert-business-tag-cancel', function () {
        $('#alert-business-tag-add-cancel').remove();
    });

    //add/save on add business type pop-up
    $(document).on('click', '#alert-business-tag-add', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getTagName = $('#business_tag').text();
        if (validateBusinessTagName(getTagName)) {
            //add business tag api call
            var reqparams = {
                device_id: crossplat.device.uuid,
                name: getTagName
            }
            businessTagAdd(reqparams)
                .then((response) => {
                    //console.log("businessTagAdd response", response);
                    var template = `<div class="business-tags-content-box" data-id="${response.id}" data-parent-id="${response.parent_id}">
                    <div class="business-tags-box-name-symbol-content-box">
                        <i class="material-icons business-tag-arrow-right" id="business_tag_arrow_button">keyboard_arrow_right</i>                                
                        <div id="added_business_tag_department" type="text" contenteditable="false" class="validate" autocomplete="off" disabled>${response.name}</div>
                    </div>
                    <div class="sub_business_tag_container_box" data-id="${response.id}"></div>
                    </div>`;
                    $('.business_tags_list_content_box').append(template);
                    $(this).prop('disabled', false);
                    removeLoader();
                    $('#alert-business-tag-add-cancel').remove();
                })
                .catch((err) => {
                    $(this).prop('disabled', false);
                    removeLoader();
                    // $('#alert-business-tag-add-cancel').remove();
                    Materialize.toast("Error in adding the business tag ", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
            $(this).prop('disabled', false);
        }
    });

    //actions on the added business tag
    $(document).on('click', '#added_business_tag_department', function () {
        //console.log("clicked");
        // $(this).prop('disabled', true);
        addLoader();
        var getBusinessTagID = $(this).parents('.business-tags-content-box').attr('data-id');
        //console.log("getBusinessTagID", getBusinessTagID);
        var action_sheet_parms = {
            action_id: "business_tag_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "edit_business_tag" }]
            },
            {
                name: "Delete",
                attr: [{ name: "class", value: "delete_business_tag" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            // $(this).prop('disabled', true);
            removeLoader();
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('business_tag_id', getBusinessTagID);
        });
    });

    //edit business tag
    $(document).on('click', '.edit_business_tag', function () {
        addLoader();
        var getBusinessTagID = $(".action-sheet-container").attr('business_tag_id');
        //console.log("getBusinessTagID", getBusinessTagID);
        $(".action-sheet-container").remove();
        //get api for business call
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getBusinessTagID
        };
        businessTagGet(reqparams)
            .then((response) => {
                //console.log("businessTagGet response", response);
                var getData = {
                    name: response.name
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        var alert_parms = {
                            alert_id: "alert-edit-business-tag-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Edit Business Tag",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-business-tag-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-business-tag-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            // $('#alert-edit-business-tag-add-cancel').attr('data-parent-id', response.parent_id);
                            $('#alert-edit-business-tag-add-cancel').attr('data-id', response.id);
                        });
                    }
                }, 'layouts/business_popup/business_tags', '#business-tag-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting the business tag ", 3000, 'round success-alert');
            })
    });

    //edit business tag cancel
    $(document).on('click', '#alert-edit-business-tag-cancel', function () {
        $('#alert-edit-business-tag-add-cancel').remove();
    });

    //edit business tag add/save
    $(document).on('click', '#alert-edit-business-tag-add', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getBusinessTagID = $('#alert-edit-business-tag-add-cancel').attr('data-id');
        //console.log("getBusinessTagID", getBusinessTagID);
        var getTagName = $('#business_tag').text();
        if (validateBusinessTagName(getTagName)) {
            //update business tag api call
            var reqparams = {
                device_id: crossplat.device.uuid,
                id: getBusinessTagID,
                name: getTagName
            }
            businessTagUpdate(reqparams)
                .then((response) => {
                    //console.log("businessTagUpdate response", response);
                    $(`.business-tags-content-box[data-id="${response.id}"]`).find('#added_business_tag_department').text(response.name);
                    $(this).prop('disabled', false);
                    removeLoader();
                    $('#alert-edit-business-tag-add-cancel').remove();
                })
                .catch((err) => {
                    $(this).prop('disabled', false);
                    removeLoader();
                    // $('#alert-edit-business-tag-add-cancel').remove();
                    Materialize.toast("Error in updating the business tag ", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
            $(this).prop('disabled', false);
        }
    });

    //delete business tag
    $(document).on('click', '.delete_business_tag', function () {
        addLoader();
        var getBusinessTagID = $(".action-sheet-container").attr('business_tag_id');
        //console.log("getBusinessTagID", getBusinessTagID);
        $(".action-sheet-container").remove();
        var alert_parms = {
            alert_id: "alert-delete-business-tag-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Business tag`,
            alert_body: `Are you sure you want to delete the business tag?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-business-tag-confirm" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-business-tag-cancel" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-business-tag-confirm-cancel').attr('data-business-tag-id', getBusinessTagID); //set getEmployeeTypeId
        });
    });

    //confirm delete business tag
    $(document).on('click', '#btn-delete-business-tag-confirm', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getBusinessTagID = $('#alert-delete-business-tag-confirm-cancel').attr('data-business-tag-id');
        //delete api for business tag
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getBusinessTagID
        };
        businessTagDelete(reqparams)
            .then((response) => {
                //console.log("businessTagDelete response", response);
                $(this).prop('disabled', false);
                removeLoader();
                $('#alert-delete-business-tag-confirm-cancel').remove();
                $(`.business-tags-content-box[data-id="${getBusinessTagID}"]`).remove();
            })
            .catch((err) => {
                removeLoader();
                $(this).prop('disabled', false);
                Materialize.toast("Error in deleting the business tag ", 3000, 'round success-alert');
            })
    });

    //confirm delete business tag
    $(document).on('click', '#btn-delete-business-tag-confirm', function () {
        $('#alert-delete-business-tag-confirm-cancel').remove();
    });

    //add business type button
    $(document).on('click', '.add-business-types-btn', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                removeLoader();
                var alert_parms = {
                    alert_id: "alert-business-type-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Business Type",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-business-type-cancel" }]
                    },
                    {
                        name: "Save",
                        attr: [{ name: "id", value: "alert-business-type-add" }]
                    }]
                }
                showAlert(alert_parms, function () {
                });
            }
        }, 'layouts/business_popup/business_types', '#business-type-template', null);
    });

    //cancel on add business type pop-up
    $(document).on('click', '#alert-business-type-cancel', function () {
        $('#alert-business-type-add-cancel').remove();
    });

    //add/save on add business type pop-up
    $(document).on('click', '#alert-business-type-add', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getTypeName = $('#business_type').text();
        if (validateBusinessTypeName(getTypeName)) {
            //add business type api call
            var reqparams = {
                device_id: crossplat.device.uuid,
                type: getTypeName
            }
            businessTypeAdd(reqparams)
                .then((response) => {
                    //console.log("businessTypeAdd response", response);
                    var template = `<div class="business-type-content-box" data-id="${response.id}">
                    <div class="business-type-wrapper">
                    <div class="business-type-name-container">                      
                        <div class="business-type-name-wrapper">                      
                            <div class="business-type-name">${response.type}</div>                      
                        </div>                      
                    </div>                   
                    <div class="btn-wrap">              
                        <div class="more-menu-wrapper" id="show_action_business_types"><i class="material-icons">more_vert</i></div>
                    </div>  
                    </div>              
                    </div>`;
                    $('.business_types_list_content_box').append(template);
                    $(this).prop('disabled', false);
                    removeLoader();
                    $('#alert-business-type-add-cancel').remove();
                })
                .catch((err) => {
                    $(this).prop('disabled', false);
                    removeLoader();
                    // $('#alert-business-type-add-cancel').remove();
                    Materialize.toast("Error in adding the business type", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
            $(this).prop('disabled', false);
        }
    });

    //action sheet on business type
    $(document).on('click', '#show_action_business_types', function () {
        //get business type id
        var getBusinessTypeId = $(this).parents('.business-type-content-box').attr('data-id');
        var action_sheet_parms = {
            action_id: "business_type_actions",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "business_type_edit" }]
            },
            {
                name: "Delete",
                attr: [{ name: "class", value: "business_type_delete" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('business_type_id', getBusinessTypeId);
        });
    });

    //on click of edit of business type
    $(document).on('click', '.business_type_edit', function () {
        addLoader();
        var getBusinessTypeID = $(".action-sheet-container").attr('business_type_id');
        //console.log("getBusinessTypeID", getBusinessTypeID);
        $(".action-sheet-container").remove();
        //get api for business type
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getBusinessTypeID
        };
        businessTypeGet(reqparams)
            .then((response) => {
                //console.log("businessTypeGet response", response);
                var getData = {
                    type: response.type
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        var alert_parms = {
                            alert_id: "alert-edit-business-type-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Edit Business Type",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-business-type-cancel" }]
                            },
                            {
                                name: "Save",
                                attr: [{ name: "id", value: "alert-edit-business-type-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                            // $('#alert-edit-business-tag-add-cancel').attr('data-parent-id', response.parent_id);
                            $('#alert-edit-business-type-add-cancel').attr('data-id', response.id);
                        });
                    }
                }, 'layouts/business_popup/business_types', '#business-type-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting the business type", 3000, 'round success-alert');
            })
    });

    //edit business type cancel
    $(document).on('click', '#alert-edit-business-type-cancel', function () {
        $('#alert-edit-business-type-add-cancel').remove();
    });

    //edit business type add/save
    $(document).on('click', '#alert-edit-business-type-add', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getBusinessTypeID = $('#alert-edit-business-type-add-cancel').attr('data-id');
        //console.log("getBusinessTypeID", getBusinessTypeID);
        var getTypeName = $('#business_type').text();
        if (validateBusinessTypeName(getTypeName)) {
            //update business tag api call
            var reqparams = {
                device_id: crossplat.device.uuid,
                id: getBusinessTypeID,
                type: getTypeName
            }
            businessTypeUpdate(reqparams)
                .then((response) => {
                    //console.log("businessTypeUpdate response", response);
                    $(`.business-type-content-box[data-id="${response.id}"]`).find('.business-type-name').text(response.type);
                    $(this).prop('disabled', false);
                    removeLoader();
                    $('#alert-edit-business-type-add-cancel').remove();
                })
                .catch((err) => {
                    $(this).prop('disabled', false);
                    removeLoader();
                    // $('#alert-edit-business-type-add-cancel').remove();
                    Materialize.toast("Error in updating the business type", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
            $(this).prop('disabled', false);
        }
    });

    //delete business tag
    $(document).on('click', '.business_type_delete', function () {
        addLoader();
        var getBusinessTypeID = $(".action-sheet-container").attr('business_type_id');
        //console.log("getBusinessTypeID", getBusinessTypeID);
        $(".action-sheet-container").remove();
        var alert_parms = {
            alert_id: "alert-delete-business-type-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Business type`,
            alert_body: `Are you sure you want to delete the business type?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-business-type-confirm" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-business-type-cancel" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-business-type-confirm-cancel').attr('data-business-type-id', getBusinessTypeID);
        });
    });

    //confirm delete business type
    $(document).on('click', '#btn-delete-business-type-confirm', function () {
        $(this).prop('disabled', true);
        addLoader();
        var getBusinessTypeID = $('#alert-delete-business-type-confirm-cancel').attr('data-business-type-id');
        //delete api for business type
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getBusinessTypeID
        };
        businessTypeDelete(reqparams)
            .then((response) => {
                //console.log("businessTypeDelete response", response);
                $(this).prop('disabled', false);
                removeLoader();
                $('#alert-delete-business-type-confirm-cancel').remove();
                $(`.business-type-content-box[data-id="${getBusinessTypeID}"]`).remove();
            })
            .catch((err) => {
                removeLoader();
                $(this).prop('disabled', false);
                Materialize.toast("Error in deleting the business type", 3000, 'round success-alert');
            })
    });

    //confirm delete business type
    $(document).on('click', '#btn-delete-business-type-confirm', function () {
        $('#alert-delete-business-type-confirm-cancel').remove();
    });




    //cancel of business choose type
    $(document).on('click', '#alert-business-type-choose-cancel', function () {
        $('#alert-business-type-choose-save-cancel').remove();
    });

    //save of business choose type
    $(document).on('click', '#alert-business-type-choose-save', function () {
        addLoader();
        var getSelectedBusinessType = $('#business-type-choose-select-dropdown').val();
        //console.log("getSelectedBusinessType", getSelectedBusinessType);
        var getSelectedBusinessTypeId = $('#business-type-choose-select-dropdown').find(`option[value="${getSelectedBusinessType}"]`).attr('data-id');
        //console.log("getSelectedBusinessTypeId", getSelectedBusinessTypeId);
        sessionStorage.setItem('business_type', getSelectedBusinessType);
        sessionStorage.setItem('business_type_id', getSelectedBusinessTypeId);
        $('#alert-business-type-choose-save-cancel').remove();
        location.hash = `business/add`;
    });

    $(document).on('click', '.business-add-address-btn', function () {

        if ($('.business-address-content-box').length < config.businessAddressMax) {
            //check for maximum address allowed
            var template = `<div class="business-address-content-box">
        <div class="business-add-address-wrapper">
            <div class="business-add-address-type-container">
            <label for="business-add-address-type-select-dropdown">Select Address Type</label>
            <select id="business-add-address-type-select-dropdown" class="browser-default">
                <option value="">--Select Type--</option>
                <option value="registered-address">Registered Address</option>
                <option value="business-address">Business Address</option>
                <option value="branch-address">Branch Address</option>
            </select>
            </div>
            <div class="business-add-address-text-container">
                <label for="address_text_box">Address</label>                                
                <div id="address_text_box" type="text" contenteditable="true" class="validate address_text_box" autocomplete="off"></div>
            </div>
        </div>
        <a class="waves-effect waves-light cancel-businesss-address-btn cursor-pointer"><i class="material-icons">remove</i></a>
    </div>`;
            var template = `
    <div class="business-address-content-box">
        <div class="business-add-address-wrapper">
            <div class="business-add-address-type-container">
    <span class="custom-dropdown-heading">Select Address Type</span>
    <div id="business-add-address-type-select-dropdown" class="wrapper-dropdown" tabindex="1">        
            <span class="disabled selected-dropdown selected-value-business-address" name="business_address" data-value="">--Select Type--</span>
        <ul class="custom-dropdown">             
            <li class="business_address" data-value="registered-address">Registered Address</li>
            <li class="business_address" data-value="business-address">Business Address</li>
            <li class="business_address" data-value="branch-address">Branch Address</li>
        </ul>
    </div>
    </div>
    <div class="business-add-address-text-container">
                <label for="address_text_box">Address</label>                                
                <div id="address_text_box" type="text" contenteditable="true" class="validate address_text_box" autocomplete="off"></div>
            </div>
        </div>
        <a class="waves-effect waves-light cancel-businesss-address-btn cursor-pointer"><i class="material-icons">remove</i></a>
    </div>`;
            $('.business-add-address-list-container').append(template);
        } else {
            Materialize.toast(`Maximum of ${config.businessAddressMax} addressess can be added`, 3000, 'round success-alert');
        }
    });

    //declaration part(transaction/signature)
    $(document).on('click', '#transaction-picture-mutimedia-add, #signature-picture-mutimedia-add', function () {
        var businessDeclarationFor;
        if ($(this).parents('.add-picture-main-wrapper').attr('data-for') == "transaction_picture") {
            businessDeclarationFor = "transaction";
        } else if ($(this).parents('.add-picture-main-wrapper').attr('data-for') == "signature_picture") {
            businessDeclarationFor = "signature";
        }
        addLoader();
        var action_parms = {
            action_id: "business-declaration-transaction-signature-type-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Credentials",
                    attr: [{ name: "id", value: "business-declaration-transaction-signature-credentials-upload-type-btn" }]
                },
                {
                    name: "Device",
                    attr: [{ name: "id", value: "business-declaration-transaction-signature-device-upload-type-btn" }]
                },
                {
                    name: "Cloud",
                    // attr: [{ name: "id", value: "business-declaration-transaction-signature-cloud-upload-type-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera",
                    attr: [{ name: "id", value: "business-declaration-transaction-signature-camera-upload-type-btn" }]
                }
            ]
        };
        showAction(action_parms, function () {
            $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for', businessDeclarationFor);
            removeLoader();
        });
    });

    //device upload
    $(document).on('click', '#business-declaration-transaction-signature-device-upload-type-btn', function () {
        addLoader();
        var getDeclarationFor = $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for');
        $('#business_declaration_device_upload').val("");
        $('#business_declaration_device_upload').trigger('click');
        $('#business-declaration-transaction-signature-type-action-sheet').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "transaction-signature-picture-modal",
            modal_header: "",
            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: getDeclarationFor
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                    // //console.log("scroll initiated for modal pop-up class")
                    // appScroll.scrollBar('.modal-popup-content');
                }
            }
            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
        });
    });

    //device upload change event(select pic)
    $(document).on("change", `#business_declaration_device_upload`, function () {
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            if (!(config.identityPictureFileFormat.includes(fileType.toLowerCase()))) {
                Materialize.toast(`Invalid file type`, 3000, 'round success-alert');
                $('#business_declaration_device_upload').val('');
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowMultiMediaFiles) {
                Materialize.toast(`File size exceeding.Max allowed is 20MB`, 3000, 'round success-alert');
                $('#business_declaration_device_upload').val('');
            }
            else {
                if (files[0])
                    var photo = files[0];
                var reader = new FileReader();
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //crop button-save's picture
    $(document).on('click', '#crop-button', function () {
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                if ($('#transaction-signature-picture-modal').attr('data-id') == 'transaction') {
                    // $('#transaction_picture').attr("src", reader.result);
                    // $('#transaction-picture-mutimedia-add').replaceWith(`<i class="material-icons" id="transaction-picture-delete">delete</i>`)
                    // $('#transaction-picture-delete').parent().removeClass('transaction-picture-multimedia-load-btn');
                    // $('#modal-close-btn').trigger('click');
                    // $(`.add-picture-main-wrapper[data-for="transaction_picture"]`).find('.declaration-multimedia-save-btn-container').removeClass('hide');
                    // sessionStorage.removeItem('cloud_upload_for');
                    // sessionStorage.removeItem('camera_for');
                    // digibiz.isDeclarationTransactionPictureSelected = true;   
                    savebusinessMultimedia(reader.result, "transaction", function (err, multimediaResponse) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("savebusinessMultimedia transaction", multimediaResponse);
                            $('#transaction_picture').attr("src", reader.result);
                            //remove +
                            $('#transaction-picture-mutimedia-add').remove();
                            //remove delete
                            $('#transaction-picture-delete').remove();
                            //append photo_camera first and then delete   
                            $(`.add-picture-main-wrapper[data-for="transaction_picture"]`).find('.mask').addClass('hide');
                            // $('#modal-close-btn').trigger('click');
                            $('#transaction-signature-picture-modal').remove();
                            $('#camera-modal').remove();
                            removeLoader();
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    declaration_transaction_pictures: {
                                        thumbnail: multimediaResponse.Data.file
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    console.log("businessUpdate", response);
                                    // var requestParameter = {
                                    //     device_id: crossplat.device.uuid,
                                    //     id: multimediaResponse.Data.file,
                                    //     data: {
                                    //         picture_used: "yes",
                                    //         picture_used_details: {
                                    //             app: "Digibiz",
                                    //             message: `This image was used to sign the declaration of the business ${$('#business_name').text()}|${$('#business_display_name').text()} by you.`,
                                    //             used_time: moment().unix()
                                    //         },
                                    //     }
                                    // }
                                    // console.log("requestParameter", requestParameter);
                                    // updateRecordTransactionSignaturePicture(requestParameter)
                                    //     .then((resultResponse) => {
                                    //         console.log("resultResponse", resultResponse);
                                    Materialize.toast("Successfully uploaded File", 4000, 'round success-alert');
                                    removeLoader();
                                    // })
                                    // .catch((err) => {
                                    //     console.log("err", err);
                                    //     Materialize.toast("Failed to update in Logs", 4000, 'round error-alert');
                                    //     removeLoader();
                                    // })
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                    }
                                })
                        }
                    })
                } else if ($('#transaction-signature-picture-modal').attr('data-id') == 'signature') {
                    // $('#signature_picture').attr("src", reader.result);
                    // $('#signature-picture-mutimedia-add').replaceWith(`<i class="material-icons" id="signature-picture-delete">delete</i>`)
                    // $('#signature-picture-delete').parent().removeClass('signature-picture-multimedia-load-btn');
                    // $('#modal-close-btn').trigger('click');
                    // $(`.add-picture-main-wrapper[data-for="signature_picture"]`).find('.declaration-multimedia-save-btn-container').removeClass('hide');
                    // sessionStorage.removeItem('cloud_upload_for');
                    // sessionStorage.removeItem('camera_for');
                    // digibiz.isDeclarationSignaturePictureSelected = true;

                    savebusinessMultimedia(reader.result, "signature", function (err, multimediaResponse) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("savebusinessMultimedia transaction", multimediaResponse);
                            $('#signature_picture').attr("src", reader.result);
                            //remove +
                            $('#signature-picture-mutimedia-add').remove();
                            //remove delete
                            $('#signature-picture-delete').remove();
                            //append photo_camera first and then delete   
                            $(`.add-picture-main-wrapper[data-for="signature_picture"]`).find('.mask').addClass('hide');
                            // $('#modal-close-btn').trigger('click');
                            $('#transaction-signature-picture-modal').remove();
                            $('#camera-modal').remove();
                            removeLoader();
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    declaration_signature_pictures: {
                                        thumbnail: multimediaResponse.Data.file
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    // var requestParameter = {
                                    //     device_id: crossplat.device.uuid,
                                    //     id: digibiz.signature_picture.record_id,
                                    //     data: {
                                    //         picture_used: "yes",
                                    //         picture_used_details: {
                                    //             app: "Digibiz",
                                    //             message: `This image was used to sign the declaration of the business ${$('#business_name').text()}|${$('#business_display_name').text()} by you.`,
                                    //             used_time: moment().unix()
                                    //         },
                                    //     }
                                    // }
                                    // console.log("requestParameter", requestParameter);
                                    // updateRecordTransactionSignaturePicture(requestParameter)
                                    //     .then((resultResponse) => {
                                    //         console.log("resultResponse", resultResponse);
                                    //console.log("businessUpdate", response);
                                    Materialize.toast("Successfully uploaded File", 4000, 'round success-alert');
                                    removeLoader();
                                    // })
                                    // .catch((err) => {
                                    //     console.log("err", err)
                                    //     Materialize.toast("Failed to update in Logs", 4000, 'round error-alert');
                                    //     removeLoader();
                                    // })
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                    }
                                })
                        }
                    })
                }
                digibiz.cropper.destroy();
            }
            reader.readAsDataURL(blob);
        });
    });

    //cropper close button
    $(document).on('click', '#modal-close-btn', function () {
        //console.log("close")
        var $this = $(this);
        $($this).parents('.custom-modal-popup').removeClass('modal-slide-top').addClass('modal-slide-bottom');
        setTimeout(function () {
            sessionStorage.removeItem('role_assignment');
            sessionStorage.removeItem('edit_role');
            sessionStorage.removeItem('edit_from');
            digibiz.role_assignment = {};
            if ($($this).parents('.custom-modal-popup').attr('id') == "business-inactive-active-settings") {
                //console.log("1")
                if ($('body').attr('app') == "business_management") {
                    //console.log("2")
                    sessionStorage.removeItem('business_status');
                    sessionStorage.removeItem('business_id');
                    sessionStorage.removeItem('business_name');
                    sessionStorage.removeItem('business_role');
                    sessionStorage.removeItem('business_profile_socket_status');
                    location.hash = `business_owner/business/list`;
                }
            }
            if ($(`.custom-modal-popup[id="declaration-select-transaction"]`).length > 0) {
                digibiz.transactional_picture = {}
            }
            if ($(`.custom-modal-popup[id="declaration-select-signature"]`).length > 0) {
                digibiz.signature_picture = {}
            }
            if ($(`.custom-modal-popup[id="identity-video-modal"]`).length > 0) {
                digibiz.fileObject = {}
            }
            if ($(`.custom-modal-popup[id="business-display-picture-modal"]`).length > 0) {
                $('.business-display-picture-wrapper').find('.mask').removeClass('hide');
            }
            if ($(`.custom-modal-popup[id="custom-employee-group-department-list-modal"]`).length > 0 || $(`.custom-modal-popup[id="modal-employee-selection"]`).length > 0 || $(`.custom-modal-popup[id="modal-standard-employee-group-selection"]`).length > 0) {
                if ($('#employee-group-members-list').find('.custom-employee-group-member-wrapper').length > 0 || $('#employee-group-members-list').find('.employee-group-member-wrapper').length > 0) {
                    //console.log("members already selected")
                } else {
                    sessionStorage.removeItem('group_from');
                }
            }
            if ($(`.custom-modal-popup[id="modal-customer-group-contact-list-selection"]`).length > 0 || $(`.custom-modal-popup[id="modal-customer-group-groups-list-selection"]`).length > 0) {
                if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0 || $('#customer-group-members-list').find('.customer-group-member-wrapper').length > 0) {
                    //console.log("members already selected")
                } else {
                    sessionStorage.removeItem('group_from');
                }
            }
            if ($(`#account-inactive-active-settings`).length > 0 && sessionStorage.getItem('account_status') == "inactive") {
                sessionStorage.clear();
                //console.log("NAVIGATING TO CORE");
                setTimeout(function () {
                    deviceHelper.navigateToAccounts('core');
                }, 1000);
            }
            if ($(`#jeevi-account-inactive-active-settings`).length > 0 && sessionStorage.getItem('account_status') == "inactive" && sessionStorage.getItem('jeevi_status') == "inactive") {
                sessionStorage.clear();
                //console.log("NAVIGATING TO CORE");
                setTimeout(function () {
                    deviceHelper.navigateToAccounts('core');
                }, 1000);
            }
            // if ($(`.custom-modal-popup[id="associate-customers-pending-notification-details-modal"]`).length > 0) {
            //     digibiz.associate_customer_notification_details_list = [];
            // }
            if ($(`#choose-customer-identifier-modal`).length > 0) {
                sessionStorage.removeItem('identifier_id')
            }

            if ($($this).parents('.custom-modal-popup').attr('id') == "camera-video-modal") {
                $('#upload-preview-close-btn').trigger('click');
            }
            digibiz.alreadySelected = [];
            digibiz.communicationActivateEmployeeGroupEmployeeList = [];
            digibiz.communicationActivateEmployeeGroupsList = [];
            digibiz.communicationActivateCustomersGroupsList = [];
            digibiz.communicationActivateCustomerGroupCustomersList = [];
            $($this).parents('.custom-modal-popup').remove();
        }, 100);
    });

    //delete multimedia
    $(document).on('click', '#transaction-picture-delete', function (e) {
        addLoader();
        var asset_id = $(this).attr('data-asset_id');
        var image_id = $(this).attr('data-image_id');
        //console.log("delete group display image asset id", asset_id);
        e.stopPropagation();
        if (asset_id) {
            var alert_parms = {
                alert_id: "alert-delete-transaction-pic-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: "Delete Transaction picture",
                alert_body: `Do you want to delete the transaction picture?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-transaction-pic-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-transaction-pic-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-delete-transaction-pic-confirm-cancel').attr('delete-asset-id', asset_id);
            });
        } else if (image_id) {
            var alert_parms = {
                alert_id: "alert-delete-transaction-pic-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: "Delete Transaction picture",
                alert_body: `Do you want to delete the transaction picture?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-transaction-pic-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-transaction-pic-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-delete-transaction-pic-confirm-cancel').attr('delete-image-id', image_id);
            });
        } else {
            $('#business_declaration_device_upload').val('');
            $('#transaction_picture').attr("src", "");//empty
            $('#transaction-picture-delete').replaceWith(`<i class="material-icons" id="transaction-picture-mutimedia-add">add</i>`)
            $('#transaction-picture-mutimedia-add').parent().addClass('transaction-picture-multimedia-load-btn');
            $('.transaction_pic_preview').remove();
            $(`.add-picture-main-wrapper[data-for="transaction_picture"]`).find('.declaration-multimedia-save-btn-container').addClass('hide');
            digibiz.isDeclarationTransactionPictureSelected = false;
            removeLoader();
        }
    });

    // Step-5 delete NO clicked
    $(document).on('click', '#btn-delete-transaction-pic-confirm-no', function () {
        $('#alert-delete-transaction-pic-confirm-cancel').remove();
    })
    // Step-6 delete YES clicked
    $(document).on('click', '#btn-delete-transaction-pic-confirm-yes', function () {
        var assetId = $('#alert-delete-transaction-pic-confirm-cancel').attr('delete-asset-id');
        var imageId = $('#alert-delete-transaction-pic-confirm-cancel').attr('delete-image-id');
        $('#alert-delete-transaction-pic-confirm-cancel').remove();
        //api call to delete asset
        var BusinessId = sessionStorage.getItem('business_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            asset_id: assetId,
            image_id: imageId,
            business_id: BusinessId,
            type: "transaction"
        }
        addLoader();
        businessDeleteAsset(requesParam)
            .then((response) => {
                removeLoader();
                $('#business_declaration_device_upload').val('');
                $('#transaction_picture').attr("src", "");//empty
                $('#transaction-picture-delete').replaceWith(`<i class="material-icons" id="transaction-picture-mutimedia-add">add</i>`)
                $('#transaction-picture-mutimedia-add').parent().addClass('transaction-picture-multimedia-load-btn');
                $('.transaction_pic_preview').remove();
                digibiz.isDeclarationTransactionPictureSelected = false;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    })

    //signature delete
    $(document).on('click', '#signature-picture-delete', function (e) {
        addLoader();
        var asset_id = $(this).attr('data-asset_id');
        var image_id = $(this).attr('data-image_id');
        //console.log("delete group display image asset id", asset_id);
        e.stopPropagation();
        if (asset_id) {
            var alert_parms = {
                alert_id: "alert-delete-signature-pic-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: "Delete Signature picture",
                alert_body: `Do you want to delete the signature picture?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-signature-pic-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-signature-pic-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-delete-signature-pic-confirm-cancel').attr('delete-asset-id', asset_id);
            });
        } else if (image_id) {
            var alert_parms = {
                alert_id: "alert-delete-signature-pic-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: "Delete Signature picture",
                alert_body: `Do you want to delete the signature picture?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-signature-pic-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-signature-pic-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-delete-signature-pic-confirm-cancel').attr('delete-image-id', image_id);
            });
        } else {
            $('#business_declaration_device_upload').val('');
            $('#signature_picture').attr("src", "");//empty
            $('#signature-picture-delete').replaceWith(`<i class="material-icons" id="signature-picture-mutimedia-add">add</i>`)
            $('#signature-picture-mutimedia-add').parent().addClass('signature-picture-multimedia-load-btn');
            $('.signature_pic_preview').remove();
            $(`.add-picture-main-wrapper[data-for="signature_picture"]`).find('.declaration-multimedia-save-btn-container').addClass('hide');
            digibiz.isDeclarationSignaturePictureSelected = false;
            removeLoader();
        }
    });

    // Step-5 delete NO clicked
    $(document).on('click', '#btn-delete-signature-pic-confirm-no', function () {
        $('#alert-delete-signature-pic-confirm-cancel').remove();
    })
    // Step-6 delete YES clicked
    $(document).on('click', '#btn-delete-signature-pic-confirm-yes', function () {
        var assetId = $('#alert-delete-signature-pic-confirm-cancel').attr('delete-asset-id');
        var imageId = $('#alert-delete-signature-pic-confirm-cancel').attr('delete-image-id');
        $('#alert-delete-signature-pic-confirm-cancel').remove();
        //api call to delete asset
        var BusinessId = sessionStorage.getItem('business_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            asset_id: assetId,
            image_id: imageId,
            business_id: BusinessId,
            type: "signature"
        }
        addLoader();
        businessDeleteAsset(requesParam)
            .then((response) => {
                removeLoader();
                $('#business_declaration_device_upload').val('');
                $('#signature_picture').attr("src", "");//empty
                $('#signature-picture-delete').replaceWith(`<i class="material-icons" id="signature-picture-mutimedia-add">add</i>`)
                $('#signature-picture-mutimedia-add').parent().addClass('signature-picture-multimedia-load-btn');
                $('.signature_pic_preview').remove();
                digibiz.isDeclarationSignaturePictureSelected = false;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });


    //cloud upload
    // $(document).on('click', '#business-declaration-transaction-signature-cloud-upload-type-btn', function () {
    //     addLoader();
    //     $('#business_declaration_device_upload').val("");
    //     var getDeclarationFor = $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for');
    //     sessionStorage.setItem('cloud_upload_for', getDeclarationFor);
    //     $('#business-declaration-transaction-signature-type-action-sheet').remove();

    //     $('.grid-view-container').removeClass('edit-mode');
    //     $('input[name="fileselection[]"]').prop('checked', false);
    //     $(".expand-search-input").removeAttr("socketid");
    //     $(".expand-search-input").val('');
    //     getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
    //         //console.log("assetsDetails", assetsDetails);
    //         digibiz.cloudAssets = assetsDetails.Data.assets;
    //         showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
    //             //console.log("1234");
    //             removeLoader();
    //             $('.filemanger_container_toggle').trigger('click');
    //             $('.file-manager-footer').removeClass('hide');
    //             $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
    //         })
    //     }).catch((err) => {
    //         Materialize.toast("No assets found", 3000, 'rounded error-alert');
    //         showFilemanagerAssetsFilesList(null, function () {
    //             //console.log("kjhgfd");
    //             removeLoader();
    //         })
    //     });
    // });

    //camera upload
    $(document).on('click', '#business-declaration-transaction-signature-camera-upload-type-btn', function () {
        addLoader();
        $('#business_declaration_device_upload').val("");
        var getDeclarationFor = $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for');
        sessionStorage.setItem('camera_for', getDeclarationFor);
        $('#business-declaration-transaction-signature-type-action-sheet').remove();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    $('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                    removeLoader();
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    window.cameraMediaFile = path;
                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "transaction-signature-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: getDeclarationFor
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        //console.log("123 check", window.cameraMediaFile);
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500)
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
        }
    });

    // $(document).on('click', '#business-declaration-transaction-signature-camera-upload-type-btn', function () {
    //     addLoader();
    //     $('#business_declaration_device_upload').val("");
    //     var getDeclarationFor = $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for');
    //     sessionStorage.setItem('camera_for', getDeclarationFor);
    //     $('#business-declaration-transaction-signature-type-action-sheet').remove();
    //     //hide the mask 
    //     // $(`.business-creation-parts-container[data-step="4"]`).find('.mask').addClass('hide');
    //     fetch.getHtml(function (fetcherror, html) {
    //         var modal_data = {
    //             modal_id: "camera-modal",
    //             modal_header: "Camera",
    //             modal_platform: crossplat.device.platform,
    //             modal_body: html,
    //             // modal_action_buttons: [{
    //             //     "name": "Add",
    //             //     "id": "add-selected-employees-group",
    //             // }]
    //         }
    //         showModal(modal_data, function () {
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 // if ($('.modal-popup-content').length > 0) {
    //                 //     //console.log("scroll initiated for modal pop-up class")
    //                 //     appScroll.scrollBar('.modal-popup-content');
    //                 // }
    //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //             } else {
    //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //             }
    //             $('#modal-close-btn').addClass('hide');
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 const vgaConstraints = { video: true };
    //                 navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //                     //global stream
    //                     window.camerastream = stream;
    //                     //remove Hide class from upload preview
    //                     //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     // $("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     // $(".file-manager-footer").addClass('hide');
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
    //                     //show preview
    //                     var videoElement = document.querySelector('#capture-video');
    //                     // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
    //                     //console.log("videoElement", videoElement);
    //                     videoElement.srcObject = stream;
    //                     videoElement.play();
    //                 });
    //             } else {
    //                 //andriod
    //                 // capture callback
    //                 var captureSuccess = function (mediaFiles) {
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('disabled');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('.upload-preview-footer').removeClass('hide');
    //                     //show preview
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".file-manager-footer").addClass('hide');
    //                     //remove Hide class from upload preview
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-attatched-new-file").addClass('hide');
    //                     //change send button attribute
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //                     var i, path, viewPath, len;
    //                     for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //                         path = mediaFiles[i].localURL;
    //                         // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
    //                         viewPath = mediaFiles[i].fullPath;
    //                         window.cameraMediaFile = path;
    //                         //append captured photo

    //                         var img = new Image;
    //                         //console.log("img", img);
    //                         //console.log("path", path);
    //                         img.src = viewPath;
    //                         //console.log("img11", img);
    //                         img.classList.add('preview-file');
    //                         var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //                         //console.log("getElement", getElement);
    //                         // document.querySelector('#upload-file-preview').appendChild(img);
    //                         $(getElement).append(img);
    //                         //revoke stream(stop device)
    //                         if (window.camerastream) {
    //                             window.camerastream.getTracks()[0].stop();
    //                         }

    //                         $('#camera-modal').addClass('hide');
    //                         // $('#camera-modal').remove();
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).addClass('hide');

    //                         //CROPPER MODAL
    //                         var modal_data = {
    //                             modal_platform: crossplat.device.platform,
    //                             modal_id: "transaction-signature-picture-modal",
    //                             modal_header: "",
    //                             modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                             modal_action_buttons: [{
    //                                 id: "crop-button",
    //                                 name: `crop`,
    //                                 attr: [{
    //                                     name: "data-id",
    //                                     value: getDeclarationFor
    //                                 }]
    //                             }]
    //                         }
    //                         showModal(modal_data, function () {
    //                             removeLoader();
    //                             if ($('.modal-popup-content').length > 0) {
    //                                 if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                     //console.log("scroll initiated for modal pop-up class")
    //                                     appScroll.scrollBar('.modal-popup-content');
    //                                 }
    //                             }
    //                             $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                             $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
    //                         });

    //                         setTimeout(function () {
    //                             var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
    //                             //console.log("123 check", window.cameraMediaFile);
    //                             window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
    //                                 entry.file(function (file) {
    //                                     var readerdataurl = new FileReader;
    //                                     readerdataurl.onloadend = function (readerEvent) {
    //                                         var readerArrayBuffer = new FileReader;
    //                                         readerArrayBuffer.onloadend = function (evt) {
    //                                             var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
    //                                             // callapi(readerEvent, blob);
    //                                             var types = blob.type.split('/');
    //                                             var extension = types[1];
    //                                             if (supported_types.includes(extension.toLowerCase())) {
    //                                                 $('.image_container').remove();
    //                                                 var url = URL.createObjectURL(blob);

    //                                                 var image = document.getElementById('image_cropper');
    //                                                 image.src = readerEvent.target.result;
    //                                                 image.onload = function (element) {
    //                                                     $('.group_image_delete').hide();
    //                                                 };
    //                                                 $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                                 removeLoader();
    //                                             }
    //                                         }
    //                                         readerArrayBuffer.readAsArrayBuffer(file);
    //                                     };
    //                                     readerdataurl.readAsDataURL(file);
    //                                 });
    //                             }, function (err) {
    //                                 //console.log('error getting the camera media file', err);
    //                             });
    //                         }, 500)

    //                         // var image = $('#image_cropper')[0];
    //                         // image.src = path;
    //                         // $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         // digibiz.cropper = new Cropper(image, {
    //                         //     viewMode: 0,
    //                         //     aspectRatio: 1 / 1,
    //                         //     minContainerWidth: 72,
    //                         //     minContainerHeight: 72,
    //                         //     minCropBoxWidth: 72,
    //                         //     minCropBoxHeight: 72,
    //                         //     maxWidth: 100,
    //                         //     maxHeight: 400,
    //                         //     zoomable: true,
    //                         //     rotatable: true,
    //                         //     responsive: true,
    //                         //     movable: true,
    //                         //     ready: function () {
    //                         //     }
    //                         // });
    //                     };
    //                 };
    //                 // capture error callback
    //                 var captureError = function (error) {
    //                     navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //                 };
    //                 // start image capture            
    //                 navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //             }
    //             removeLoader();
    //         });
    //     }, 'page/common/camera', '#camera-template', null);
    // });


    $(document).on('click', '#camera-capture', function () {
        console.log("camera cpature")
        addLoader();
        sessionStorage.removeItem('capturebase64');

        //hiding the second step here
        $('#camera-modal').addClass('hide');
        $(`.upload-preview-wrapper[data-for="camera_modal"]`).addClass('hide');

        // var getDeclarationFor = sessionStorage.getItem('camera_for');
        var identifier;
        var canvas = document.createElement('canvas');
        var videoElement = document.querySelector('#capture-video');

        canvas.setAttribute('width', videoElement.videoWidth);
        canvas.setAttribute('height', videoElement.videoHeight);

        canvas.getContext('2d').drawImage(videoElement, 0, 0, videoElement.videoWidth, videoElement.videoHeight);

        //capture photo
        window.captureCanvas = canvas;
        var base64Content = canvas.toDataURL();
        sessionStorage.setItem('capturebase64', base64Content);
        canvas.toBlob(function (blob) {
            if (sessionStorage.getItem('business_id') || $('body').attr('app') == "digibiz_credentials") {
                //change send button attribute
                $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
                // $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").removeClass('hide');
                //empty video tag
                $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
                $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
                // $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").removeClass('hide');

                //append captured photo
                var img = new Image;
                img.src = URL.createObjectURL(blob);
                img.classList.add('preview-file');
                var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
                //console.log("getElement", getElement);
                // document.querySelector($(getElement)).appendChild(img);
                $(getElement).append(img);
                $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-close-btn').attr('identifier', img.src);
                identifier = img.src;
                //revoke stream(stop device)
                if (window.camerastream) {
                    window.camerastream.getTracks()[0].stop();
                }
            }
        }, 'image/png');

        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            window.captureCanvas.toBlob(function (blob) {
                var reader = new FileReader;
                reader.onloadend = function (readerEvent) {
                    digibiz.cameraUploadingFiles.push({
                        files: blob,
                        identifier: identifier
                    });
                    cameraCaptureClick('camera')
                };
                reader.readAsDataURL(blob);
            });
        } else {
            console.log("mobile 1")
            window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                entry.file(function (file) {
                    var readerdataurl = new FileReader;
                    readerdataurl.onloadend = function (readerEvent) {
                        var readerArrayBuffer = new FileReader;
                        readerArrayBuffer.onloadend = function (evt) {
                            var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                            digibiz.cameraUploadingFiles.push({
                                files: blob,
                                identifier: identifier
                            });
                            cameraCaptureClick('camera')
                        }
                        readerArrayBuffer.readAsArrayBuffer(file);
                    };
                    readerdataurl.readAsDataURL(file);
                });
            }, function (err) {
                //console.log('error getting the camera media file', err);
            });
        }

    });

    // $(document).on('click', '#camera-capture', function () {
    //     //changed everwhere ${getDeclarationFor} to camera_modal
    //     sessionStorage.removeItem('capturebase64');
    //     var getDeclarationFor = sessionStorage.getItem('camera_for');
    //     var identifier;
    //     var canvas = document.createElement('canvas');
    //     var videoElement = document.querySelector('#capture-video');

    //     canvas.setAttribute('width', videoElement.videoWidth);
    //     canvas.setAttribute('height', videoElement.videoHeight);

    //     canvas.getContext('2d').drawImage(videoElement, 0, 0, videoElement.videoWidth, videoElement.videoHeight);

    //     //capture photo
    //     window.captureCanvas = canvas;
    //     var base64Content = canvas.toDataURL();
    //     sessionStorage.setItem('capturebase64', base64Content);
    //     canvas.toBlob(function (blob) {           
    //         if (sessionStorage.getItem('business_id') || $('body').attr('app') == "digibiz_credentials") {
    //             //change send button attribute
    //             $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //             $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").removeClass('hide');
    //             //empty video tag
    //             $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
    //             $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //             $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").removeClass('hide');

    //             //append captured photo
    //             var img = new Image;
    //             img.src = URL.createObjectURL(blob);
    //             img.classList.add('preview-file');
    //             var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //             //console.log("getElement", getElement);
    //             // document.querySelector($(getElement)).appendChild(img);
    //             $(getElement).append(img);
    //             $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-close-btn').attr('identifier', img.src);
    //             identifier = img.src;
    //             //revoke stream(stop device)
    //             if (window.camerastream) {
    //                 window.camerastream.getTracks()[0].stop();
    //             }
    //         }

    //     }, 'image/png');

    //     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //         window.captureCanvas.toBlob(function (blob) {
    //             var reader = new FileReader;
    //             reader.onloadend = function (readerEvent) {
    //                 digibiz.cameraUploadingFiles.push({
    //                     files: blob,
    //                     identifier: identifier
    //                 });
    //             };
    //             reader.readAsDataURL(blob);
    //         });
    //     } else {
    //         window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
    //             entry.file(function (file) {
    //                 var readerdataurl = new FileReader;
    //                 readerdataurl.onloadend = function (readerEvent) {
    //                     var readerArrayBuffer = new FileReader;
    //                     readerArrayBuffer.onloadend = function (evt) {
    //                         var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
    //                         digibiz.cameraUploadingFiles.push({
    //                             files: blob,
    //                             identifier: identifier
    //                         });
    //                     }
    //                     readerArrayBuffer.readAsArrayBuffer(file);
    //                 };
    //                 readerdataurl.readAsDataURL(file);
    //             });
    //         }, function (err) {
    //             //console.log('error getting the camera media file', err);
    //         });
    //     }

    // });


    //camera send button
    $(document).on('click', '#upload-footer-send-btn', function () {
        console.log("mobile 2")
        var upload_type = $(this).attr('data-uploadtype');
        var profileDetails = JSON.parse(sessionStorage.getItem('profile_details'));
        var name = profileDetails.individual.name.first + ' ' + profileDetails.individual.name.last;
        // $("#upload-preview-wrapper").addClass('slide-bottom');
        if (upload_type && upload_type == 'videocamera') {
            //console.log("inside video declartion");
            // addLoader();
            digibiz.declarationVideo = {};
            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                var blob = new Blob(videoCapturedChunks, { 'type': 'video/webm' });
                console.log("blob", blob);
                // var url = URL.createObjectURL(blob);
                // console.log("url", url);
                var reader = new FileReader;
                reader.onloadend = function (readerEvent) {
                    callApi(readerEvent, blob);
                    $('#camera-video-modal').remove();
                };
                reader.readAsDataURL(blob);
            } else {
                //console.log("inside mobilt");
                // window.resolveLocalFileSystemURL(window.videoMediaFile, function (entry) {
                //     entry.file(function (file) {
                //         var readerdataurl = new FileReader;
                //         readerdataurl.onloadend = function (readerEvent) {
                //             var readerArrayBuffer = new FileReader;
                //             readerArrayBuffer.onloadend = function (evt) {
                //                 var blob = new Blob([evt.target.result], { type: file.type });
                //                 callApi(readerEvent, blob);
                //                 $('#camera-video-modal').remove();
                //             }
                //             readerArrayBuffer.readAsArrayBuffer(file);
                //         };
                //         readerdataurl.readAsDataURL(file);
                //     });
                // }, function (err) {
                //     //console.log('error getting the camera media file', err);
                // });
                //console.log("111", window.videoMediaFile)
                window.resolveLocalFileSystemURL(window.videoMediaFile, function (entry) {
                    //console.log("222", entry)
                    entry.file(function (file) {
                        //console.log("333", file)
                        var readerdataurl = new FileReader;
                        //console.log("444", readerdataurl)
                        readerdataurl.onloadend = function (readerEvent) {
                            //console.log("555", readerEvent)
                            var readerArrayBuffer = new FileReader;
                            //console.log("666", readerArrayBuffer)
                            readerArrayBuffer.onloadend = function (evt) {
                                //console.log("777", evt)
                                var blob = new Blob([evt.target.result], { type: file.type });
                                //console.log("888", blob)
                                callApi(readerEvent, blob);
                            }
                            readerArrayBuffer.readAsArrayBuffer(file);
                        };
                        readerdataurl.readAsDataURL(file);
                    });
                }, function (err) {
                    //console.log('error getting the camera media file', err);
                });
            }
        } else if (upload_type && upload_type == 'camera') {
            if ($('body').attr('app') == "digibiz_credentials") {
                var getUploadFor = $('#camera-modal').attr('camera-for');
                $('#camera-modal').remove();
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "business-credential-picture-modal",
                    modal_header: "Crop Image",
                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "business-credential-picture-crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            // //console.log("scroll initiated for modal pop-up class")
                            // appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#business-credential-picture-modal').attr('picture-type', getUploadFor);
                });
                setTimeout(function () {
                    var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        window.captureCanvas.toBlob(function (blob) {
                            var reader = new FileReader;
                            reader.onloadend = function (readerEvent) {
                                var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                var types = blob.type.split('/');
                                var extension = types[1];
                                if (supported_types.includes(extension.toLowerCase())) {
                                    $('.image_container').remove();

                                    var image = document.getElementById('image_cropper');
                                    console.log("image", image);
                                    image.src = readerEvent.target.result;
                                    image.onload = function (element) {
                                        $('.group_image_delete').hide();
                                    };
                                    $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    digibiz.cropper = new Cropper(image, {
                                        viewMode: 2,
                                        aspectRatio: 1 / 1,
                                        minContainerWidth: 72,
                                        minContainerHeight: 72,
                                        minCropBoxWidth: 72,
                                        minCropBoxHeight: 72,
                                        maxWidth: 100,
                                        maxHeight: 400,
                                        zoomable: true,
                                        rotatable: true,
                                        responsive: true,
                                        movable: true,
                                        ready: function () {
                                            //cropper.zoom(-0.6);
                                        }
                                    });
                                    removeLoader();
                                }
                            };
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }
                }, 500);
            } else if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details") {
                //console.log("groups")
                $('.upload-preview-wrapper').addClass('hide');
                $('#camera-modal').remove();
                //CROPPER MODAL
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "group-image-modal",
                    modal_header: "",
                    modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "group-image-crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            // //console.log("scroll initiated for modal pop-up class")
                            // appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#group-image-modal').attr('picture-type', 'group_image');
                });
                setTimeout(function () {
                    var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        //console.log("browser")
                        window.captureCanvas.toBlob(function (blob) {
                            var reader = new FileReader;
                            reader.onloadend = function (readerEvent) {
                                var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                var types = blob.type.split('/');
                                var extension = types[1];
                                if (supported_types.includes(extension.toLowerCase())) {
                                    //console.log("passed")
                                    $('.image_container').remove();

                                    var image = document.getElementById('image_cropper');
                                    image.src = readerEvent.target.result;
                                    image.onload = function (element) {
                                        $('.group-image-delete').hide();
                                    };
                                    //console.log("kj")
                                    $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    digibiz.cropper = new Cropper(image, {
                                        viewMode: 2,
                                        aspectRatio: 1 / 1,
                                        minContainerWidth: 72,
                                        minContainerHeight: 72,
                                        minCropBoxWidth: 72,
                                        minCropBoxHeight: 72,
                                        maxWidth: 100,
                                        maxHeight: 400,
                                        zoomable: true,
                                        rotatable: true,
                                        responsive: true,
                                        movable: true,
                                        ready: function () {
                                            //cropper.zoom(-0.6);
                                        }
                                    });
                                    removeLoader();
                                }
                            };
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group-image-delete').hide();
                                            };
                                            $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }
                }, 500)
            } else if (sessionStorage.getItem('customer_id')) {
                if ($('#edit-associate-customer-modal').length > 0) {
                    //console.log("associate customer")
                    $('#edit-associate-customer-modal').find('.upload-preview-wrapper').addClass('hide');
                    $('#camera-modal').remove();
                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "associate-customer-identity-picture-modal",
                        modal_header: "",
                        modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "associate-customer-identity-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        removeLoader();
                        if ($('.modal-popup-content').length > 0) {
                            if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                        }
                        //console.log("added")
                        $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            //console.log("browser")
                            window.captureCanvas.toBlob(function (blob) {
                                var reader = new FileReader;
                                reader.onloadend = function (readerEvent) {
                                    var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                    var types = blob.type.split('/');
                                    var extension = types[1];
                                    if (supported_types.includes(extension.toLowerCase())) {
                                        //console.log("passed")
                                        $('.image_container').remove();

                                        var image = document.getElementById('image_cropper');
                                        image.src = readerEvent.target.result;
                                        image.onload = function (element) {
                                            $('.group_image_delete').hide();
                                        };
                                        //console.log("kj")
                                        $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        digibiz.cropper = new Cropper(image, {
                                            viewMode: 2,
                                            aspectRatio: 1 / 1,
                                            minContainerWidth: 72,
                                            minContainerHeight: 72,
                                            minCropBoxWidth: 72,
                                            minCropBoxHeight: 72,
                                            maxWidth: 100,
                                            maxHeight: 400,
                                            zoomable: true,
                                            rotatable: true,
                                            responsive: true,
                                            movable: true,
                                            ready: function () {
                                                //cropper.zoom(-0.6);
                                            }
                                        });
                                        removeLoader();
                                    }
                                };
                                reader.readAsDataURL(blob);
                            });
                        } else {
                            window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                                entry.file(function (file) {
                                    var readerdataurl = new FileReader;
                                    readerdataurl.onloadend = function (readerEvent) {
                                        var readerArrayBuffer = new FileReader;
                                        readerArrayBuffer.onloadend = function (evt) {
                                            var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                            // callapi(readerEvent, blob);
                                            var types = blob.type.split('/');
                                            var extension = types[1];
                                            if (supported_types.includes(extension.toLowerCase())) {
                                                $('.image_container').remove();
                                                var url = URL.createObjectURL(blob);

                                                var image = document.getElementById('image_cropper');
                                                image.src = readerEvent.target.result;
                                                image.onload = function (element) {
                                                    $('.group_image_delete').hide();
                                                };
                                                $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                digibiz.cropper = new Cropper(image, {
                                                    viewMode: 2,
                                                    aspectRatio: 1 / 1,
                                                    minContainerWidth: 72,
                                                    minContainerHeight: 72,
                                                    minCropBoxWidth: 72,
                                                    minCropBoxHeight: 72,
                                                    maxWidth: 100,
                                                    maxHeight: 400,
                                                    zoomable: true,
                                                    rotatable: true,
                                                    responsive: true,
                                                    movable: true,
                                                    ready: function () {
                                                        //cropper.zoom(-0.6);
                                                    }
                                                });
                                                removeLoader();
                                            }
                                        }
                                        readerArrayBuffer.readAsArrayBuffer(file);
                                    };
                                    readerdataurl.readAsDataURL(file);
                                });
                            }, function (err) {
                                //console.log('error getting the camera media file', err);
                            });
                        }
                    }, 500)
                } else {
                    //console.log("customer")
                    $('.upload-preview-wrapper').addClass('hide');
                    $('#camera-modal').remove();
                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "customer-identity-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "customer-identity-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        removeLoader();
                        if ($('.modal-popup-content').length > 0) {
                            if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                // //console.log("scroll initiated for modal pop-up class")
                                // appScroll.scrollBar('.modal-popup-content');
                            }
                        }
                        //console.log("added")
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            //console.log("browser")
                            window.captureCanvas.toBlob(function (blob) {
                                var reader = new FileReader;
                                reader.onloadend = function (readerEvent) {
                                    var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                    var types = blob.type.split('/');
                                    var extension = types[1];
                                    if (supported_types.includes(extension.toLowerCase())) {
                                        //console.log("passed")
                                        $('.image_container').remove();

                                        var image = document.getElementById('image_cropper');
                                        image.src = readerEvent.target.result;
                                        image.onload = function (element) {
                                            $('.group_image_delete').hide();
                                        };
                                        //console.log("kj")
                                        $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        digibiz.cropper = new Cropper(image, {
                                            viewMode: 2,
                                            aspectRatio: 1 / 1,
                                            minContainerWidth: 72,
                                            minContainerHeight: 72,
                                            minCropBoxWidth: 72,
                                            minCropBoxHeight: 72,
                                            maxWidth: 100,
                                            maxHeight: 400,
                                            zoomable: true,
                                            rotatable: true,
                                            responsive: true,
                                            movable: true,
                                            ready: function () {
                                                //cropper.zoom(-0.6);
                                            }
                                        });
                                        removeLoader();
                                    }
                                };
                                reader.readAsDataURL(blob);
                            });
                        } else {
                            window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                                entry.file(function (file) {
                                    var readerdataurl = new FileReader;
                                    readerdataurl.onloadend = function (readerEvent) {
                                        var readerArrayBuffer = new FileReader;
                                        readerArrayBuffer.onloadend = function (evt) {
                                            var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                            // callapi(readerEvent, blob);
                                            var types = blob.type.split('/');
                                            var extension = types[1];
                                            if (supported_types.includes(extension.toLowerCase())) {
                                                $('.image_container').remove();
                                                var url = URL.createObjectURL(blob);

                                                var image = document.getElementById('image_cropper');
                                                image.src = readerEvent.target.result;
                                                image.onload = function (element) {
                                                    $('.group_image_delete').hide();
                                                };
                                                $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                digibiz.cropper = new Cropper(image, {
                                                    viewMode: 0,
                                                    aspectRatio: 1 / 1,
                                                    minContainerWidth: 72,
                                                    minContainerHeight: 72,
                                                    minCropBoxWidth: 72,
                                                    minCropBoxHeight: 72,
                                                    maxWidth: 100,
                                                    maxHeight: 400,
                                                    zoomable: true,
                                                    rotatable: true,
                                                    responsive: true,
                                                    movable: true,
                                                    ready: function () {
                                                    }
                                                });
                                                removeLoader();
                                            }
                                        }
                                        readerArrayBuffer.readAsArrayBuffer(file);
                                    };
                                    readerdataurl.readAsDataURL(file);
                                });
                            }, function (err) {
                                //console.log('error getting the camera media file', err);
                            });
                        }
                    }, 500)
                }
            } else if (sessionStorage.getItem('employee_id')) {
                //console.log("employee")
                $('.upload-preview-wrapper').addClass('hide');
                $('#camera-modal').remove();
                //CROPPER MODAL
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "employee-identity-picture-modal",
                    modal_header: "",
                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "employee-identity-crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    //console.log("added")
                    $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
                });
                setTimeout(function () {
                    var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        //console.log("browser")
                        window.captureCanvas.toBlob(function (blob) {
                            var reader = new FileReader;
                            reader.onloadend = function (readerEvent) {
                                var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                var types = blob.type.split('/');
                                var extension = types[1];
                                if (supported_types.includes(extension.toLowerCase())) {
                                    //console.log("passed")
                                    $('.image_container').remove();

                                    var image = document.getElementById('image_cropper');
                                    image.src = readerEvent.target.result;
                                    image.onload = function (element) {
                                        $('.group_image_delete').hide();
                                    };
                                    //console.log("kj")
                                    $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    digibiz.cropper = new Cropper(image, {
                                        viewMode: 2,
                                        aspectRatio: 1 / 1,
                                        minContainerWidth: 72,
                                        minContainerHeight: 72,
                                        minCropBoxWidth: 72,
                                        minCropBoxHeight: 72,
                                        maxWidth: 100,
                                        maxHeight: 400,
                                        zoomable: true,
                                        rotatable: true,
                                        responsive: true,
                                        movable: true,
                                        ready: function () {
                                            //cropper.zoom(-0.6);
                                        }
                                    });
                                    removeLoader();
                                }
                            };
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        //console.log("123 check");
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }
                }, 500)
            } else if (sessionStorage.getItem('business_id')) {
                var getDeclarationFor = sessionStorage.getItem('camera_for');
                $('#camera-modal').remove();
                $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).addClass('hide');
                if (getDeclarationFor == "business_display_picture") {
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "business-display-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "business-display-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        removeLoader();
                        if ($('.modal-popup-content').length > 0) {
                            if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                // //console.log("scroll initiated for modal pop-up class")
                                // appScroll.scrollBar('.modal-popup-content');
                            }
                        }
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
                    });
                } else {//for transaction/signature declaration
                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "transaction-signature-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: getDeclarationFor
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        removeLoader();
                        if ($('.modal-popup-content').length > 0) {
                            if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                // //console.log("scroll initiated for modal pop-up class")
                                // appScroll.scrollBar('.modal-popup-content');
                            }
                        }
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
                    });
                }
                setTimeout(function () {
                    var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        window.captureCanvas.toBlob(function (blob) {
                            var reader = new FileReader;
                            reader.onloadend = function (readerEvent) {
                                var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                var types = blob.type.split('/');
                                var extension = types[1];
                                if (supported_types.includes(extension.toLowerCase())) {
                                    $('.image_container').remove();

                                    var image = document.getElementById('image_cropper');
                                    image.src = readerEvent.target.result;
                                    image.onload = function (element) {
                                        $('.group_image_delete').hide();
                                    };
                                    $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    digibiz.cropper = new Cropper(image, {
                                        viewMode: 2,
                                        aspectRatio: 1 / 1,
                                        minContainerWidth: 72,
                                        minContainerHeight: 72,
                                        minCropBoxWidth: 72,
                                        minCropBoxHeight: 72,
                                        maxWidth: 100,
                                        maxHeight: 400,
                                        zoomable: true,
                                        rotatable: true,
                                        responsive: true,
                                        movable: true,
                                        ready: function () {
                                            //cropper.zoom(-0.6);
                                        }
                                    });
                                    removeLoader();
                                }
                            };
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }
                }, 500);
            }
        }
    });

    //camera cancel
    $(document).on('click', '#upload-preview-close-btn', function () {
        // if (sessionStorage.getItem('employee_id')) {
        //     $("#upload-preview-wrapper").addClass('slide-bottom');
        //     var identifier = $(this).attr('identifier');
        //     digibiz.cameraUploadingFiles = digibiz.cameraUploadingFiles.filter(e => e.identifier != identifier);
        //     setTimeout(function () {
        //         $("#upload-preview-wrapper").addClass('hide');
        //         $("#upload-preview-wrapper").removeClass('slide-bottom');
        //     }, 200);
        //     // uploader._files = {};
        //     // digibiz.cameraUploadingFiles = [];  

        //     Object.keys(sessionStorage).forEach(function (val) {
        //         if (val.includes('ObjectURL_')) {
        //             URL.revokeObjectURL(sessionStorage.getItem(val));
        //             sessionStorage.removeItem(val);
        //         }
        //     });

        //     //revoke stream(stop device)
        //     if (window.camerastream) {
        //         window.camerastream.getTracks()[0].stop();
        //     }
        //     //stop recorder
        //     if (window.recorder && recorder.state != 'inactive') {
        //         //console.log("not inactive")
        //         recorder.stop();
        //         clearInterval(interval);
        //         clearInterval(indicator_interval);
        //         if (window.videocamerastream) {
        //             window.videocamerastream.getTracks()[0].stop();
        //             window.videocamerastream.getTracks()[1].stop();
        //         }
        //     } else if (window.recorder && recorder.state == 'inactive') {
        //         if (window.videocamerastream) {
        //             window.videocamerastream.getTracks()[0].stop();
        //             window.videocamerastream.getTracks()[1].stop();
        //         }
        //     }
        // } else {
        var getDeclarationFor = sessionStorage.getItem('camera_for');
        $('#camera-modal').remove();
        $('#camera-video-modal').remove();
        $(`.upload-preview-wrapper[data-for="camera_modal"]`).addClass('slide-bottom');
        var identifier = $(this).attr('identifier');
        digibiz.cameraUploadingFiles = digibiz.cameraUploadingFiles.filter(e => e.identifier != identifier);
        setTimeout(function () {
            $(`.upload-preview-wrapper[data-for="video"]`).addClass('hide');
            $(`.upload-preview-wrapper[data-for="video"]`).removeClass('slide-bottom');
            $(`.upload-preview-wrapper[data-for="camera_modal"]`).addClass('hide');
            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('slide-bottom');
            sessionStorage.removeItem('camera_for');
        }, 200);
        // uploader._files = {};
        // digibiz.cameraUploadingFiles = [];  

        Object.keys(sessionStorage).forEach(function (val) {
            if (val.includes('ObjectURL_')) {
                URL.revokeObjectURL(sessionStorage.getItem(val));
                sessionStorage.removeItem(val);
            }
        });

        //revoke stream(stop device)
        if (window.camerastream) {
            window.camerastream.getTracks()[0].stop();
        }
        //stop recorder
        if (window.recorder && recorder.state != 'inactive') {
            //console.log("not inactive")
            recorder.stop();
            clearInterval(interval);
            clearInterval(indicator_interval);
            if (window.videocamerastream) {
                window.videocamerastream.getTracks()[0].stop();
                window.videocamerastream.getTracks()[1].stop();
            }
        } else if (window.recorder && recorder.state == 'inactive') {
            if (window.videocamerastream) {
                window.videocamerastream.getTracks()[0].stop();
                window.videocamerastream.getTracks()[1].stop();
            }
        }
        sessionStorage.removeItem('camera-for');
        $(`.add-picture-main-wrapper[data-for="video"]`).find('.mask').removeClass('hide');
        $(`.add-picture-main-wrapper[data-for="video"]`).find('.upload-preview-footer').addClass('hide');
        // var video = document.getElementById("video.preview-file");
        // function stopVideo() {
        $("video.preview-file")[0].pause();
        // video.currentTime = 0;
        // }
        // sessionStorage.removeItem('camera-for');
        // $(`.add-picture-main-wrapper[data-for="video"]`).find('.mask').removeClass('hide');
        // $(`.add-picture-main-wrapper[data-for="video"]`).find('.upload-preview-footer').addClass('hide');
        //remove the mask, so that delete and add will be shown
        // if (getDeclarationFor == "business_display_picture") {
        //     $('.business-display-picture-wrapper').find('.mask').removeClass('hide');
        // } else if (getDeclarationFor == "transaction" || getDeclarationFor == "signature") {
        //     $(`.business-creation-parts-container[data-step="4"]`).find('.mask').removeClass('hide');
        // }
        // }
    });


    //core
    $(document).on('click', '#business-declaration-transaction-signature-credentials-upload-type-btn', function () {
        addLoader();
        var getDeclarationFor = $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for');
        $('#business-declaration-transaction-signature-type-action-sheet').remove();
        if (getDeclarationFor == "transaction") {
            var transactionRequestParams = {
                device_id: crossplat.device.uuid,
                list_by: "account_active_transaction_pictures",
                account_id: sessionStorage.getItem('account_id')
            }
            listTransactionSignaturePicture(transactionRequestParams)
                .then((response) => {
                    console.log("response", response);
                    var transaction_data = [];
                    //for transaction pictures
                    if (response.length > 0) {
                        $.each(response, function (key, value) {
                            value.image_url = `${api.get_transaction_signature_picture}?id=${value.id}&device_id=${crossplat.device.uuid}&image_id=${value.picture_details.thumbnail}`
                            transaction_data[key] = value;
                            // transaction_data[key].imageLetter = response.Data.individual.name.first.charAt(0);
                        });
                    }
                    console.log("transaction_data", transaction_data);
                    if (transaction_data.length > 0) {
                        var getData = {
                            transaction_pictures: transaction_data,
                        };
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "declaration-select-transaction",
                                modal_header: "Select Transaction Picture",
                                modal_body: html,
                                modal_action_buttons: [{
                                    name: "Confirm",
                                    attr: [{ name: "id", value: "btn-confirm-add-transaction-picture" }]
                                }]
                            }
                            showModal(modal_data, function () {
                                removeLoader();
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/business/select_transaction_signature', '#select-transaction-signature-list-template', getData);
                    } else {
                        var alert_parms = {
                            alert_id: "alert-no-transaction-signature-pictures-available",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Not Available",
                            alert_body: `<div>There is no presence of transactional picture in your credentials...Please upload the picture in the credentials to add it here</div>`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-no-transaction-signature-pictures-available-ok" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                        });
                    }
                }).catch((err) => {
                    console.log('err', err);
                    Materialize.toast("No credential found.", 3000, 'rounded error-alert');
                    removeLoader();
                })
        } else if (getDeclarationFor == "signature") {
            var signatureRequestParams = {
                device_id: crossplat.device.uuid,
                list_by: "account_active_signature_pictures",
                account_id: sessionStorage.getItem('account_id')
            }
            listTransactionSignaturePicture(signatureRequestParams)
                .then((response) => {
                    //console.log("response", response);
                    var signature_data = [];
                    //for signature pictures
                    if (response.length > 0) {
                        $.each(response, function (key, value) {
                            value.image_url = `${api.get_transaction_signature_picture}?id=${value.id}&device_id=${crossplat.device.uuid}&image_id=${value.picture_details.thumbnail}`
                            signature_data[key] = value;
                            // transaction_data[key].imageLetter = response.Data.individual.name.first.charAt(0);
                        });
                    }
                    console.log("signature_data", signature_data);
                    if (signature_data.length > 0) {
                        var getData = {
                            signature_pictures: signature_data
                        };
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "declaration-select-signature",
                                modal_header: "Select Signature Picture",
                                modal_body: html,
                                modal_action_buttons: [{
                                    name: "Confirm",
                                    attr: [{ name: "id", value: "btn-confirm-add-signature-picture" }]
                                }]
                            }
                            showModal(modal_data, function () {
                                removeLoader();
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/business/select_transaction_signature', '#select-transaction-signature-list-template', getData);
                    } else {
                        var alert_parms = {
                            alert_id: "alert-no-transaction-signature-pictures-available",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Not Available",
                            alert_body: `<div>There is no presence of signature pictures in your credentials...Please upload the picture in the credentials to add it here</div>`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-no-transaction-signature-pictures-available-ok" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                        });
                    }
                }).catch((err) => {
                    removeLoader();
                    Materialize.toast("No credential found.", 3000, 'rounded error-alert');
                })
        }
    });

    $(document).on('click', '#btn-no-transaction-signature-pictures-available-ok', function () {
        //console.log("clicked ok")
        removeLoader();
        $('#alert-no-transaction-signature-pictures-available').remove();
    });

    //selecting transaction/signature picture in the modal
    $(document).on('click', '.transaction_signature_select', function (e) {
        var $this = $(this);
        let $checkbox = $(this).find('input:checkbox');
        let list_type = $(this).find('.picture_wrapper').attr('data-type');
        let list_id = $(this).find('.picture_wrapper').attr('data-id');
        let list_record_id = $(this).find('.picture_wrapper').attr('data-record-id');
        digibiz[`${list_type}`] = {
            image_id: list_id,
            image_url: `${api.get_transaction_signature_picture}?id=${list_record_id}&device_id=${crossplat.device.uuid}&image_id=${list_id}`,
            // image_url: config.api.core + "/api/individual/get_image?image_id=" + list_id + "&device_id=" + crossplat.device.uuid,
            upload_from: "digibiz",
            record_id: list_record_id
        };
        console.log("digibiz[`${list_type}`]", digibiz[`${list_type}`]);
        //check if any other pic is selected and remove the tick on it
        // setTimeout(function() {        
        var getSelectedItem = $($this).parents('.transactional-signature-pictures-content-box').find('.transaction_signature_select.selected-row');
        console.log("getSelectedItem", getSelectedItem);
        if (getSelectedItem.length > 0) {
            $.each(getSelectedItem, function (index, value) {
                console.log("gbhjdcvbgn", value);
                $(value).removeClass('selected-row');
                $(value).find('input:checkbox').prop('checked', false);
            })
        }
        var validate_flag = false;
        //validation check only on 1 is present
        if (list_type == 'transactional_picture') {
            var checkPresence = digibiz.transactional_picture.hasOwnProperty('image_id');
            if (checkPresence == true) {
                validate_flag = false;
            } else {
                validate_flag = true;
            }
        }

        if (list_type == 'signature_picture') {
            var checkPresence = digibiz.signature_picture.hasOwnProperty('image_id');
            if (checkPresence == true) {
                validate_flag = false;
            } else {
                validate_flag = true;
            }
        }
        if (!validate_flag) {
            //show tick if checked
            if (!$(e.target).is('input:checkbox')) {
                $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.transaction_signature_select').toggleClass('selected-row');
            } else {
                //console.log("noooo");
            }
        }
    });

    //confirm selcted transaction picture
    $(document).on('click', '#btn-confirm-add-transaction-picture', function () {
        addLoader();
        if (validateTransactionPictures()) {
            $('#declaration-select-transaction').remove();
            if (digibiz.transactional_picture.hasOwnProperty('image_id') && digibiz.transactional_picture.image_id) {
                // var transaction_picture = config.api.core + "/api/individual/get_image?image_id=" + digibiz.transactional_picture.image_id + "&device_id=" + crossplat.device.uuid;
                // //console.log("transaction 11", transaction_picture);
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: digibiz.transactional_picture.record_id,
                    image_id: digibiz.transactional_picture.image_id
                }
                base64GetDigibiz(reqparams)
                    .then((response) => {
                        //console.log("base64GetDigibiz", response);
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "transaction-signature-picture-modal",
                            modal_header: "",
                            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                            modal_action_buttons: [{
                                id: "crop-button",
                                name: `crop`,
                                attr: [{
                                    name: "data-id",
                                    value: "transaction"
                                }]
                            }]
                        }
                        showModal(modal_data, function () {
                            removeLoader();
                            if ($('.modal-popup-content').length > 0) {
                                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                    // //console.log("scroll initiated for modal pop-up class")
                                    // appScroll.scrollBar('.modal-popup-content');
                                }
                            }
                            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                            $('#transaction-signature-picture-modal').attr('data-id', "transaction");
                            $('#declaration-select-transaction').remove();
                            var image = $('#image_cropper')[0];
                            image.src = response;
                            $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            digibiz.cropper = new Cropper(image, {
                                viewMode: 2,
                                aspectRatio: 1 / 1,
                                minContainerWidth: 72,
                                minContainerHeight: 72,
                                minCropBoxWidth: 72,
                                minCropBoxHeight: 72,
                                maxWidth: 100,
                                maxHeight: 400,
                                zoomable: true,
                                rotatable: true,
                                responsive: true,
                                movable: true,
                                ready: function () {
                                    //cropper.zoom(-0.6);
                                }
                            });
                        });
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in base64 get")
                    })
                // var get_coreew = `${api.get_core_file}?image_id=${digibiz.transactional_picture.image_id}&device_id=${crossplat.device.uuid}`;
                // //console.log("get_coreew", get_coreew);
                // var contentType = response.headers.get("content-type");
                // $('#transaction_picture').attr("src", get_coreew);
                // $('#transaction-picture-mutimedia-add').replaceWith(`<i class="material-icons" id="transaction-picture-delete">delete</i>`)
                // $('#transaction-picture-delete').parent().removeClass('transaction-picture-multimedia-load-btn');
                // $('#modal-close-btn').trigger('click');
                // $(`.add-picture-main-wrapper[data-for="transaction_picture"]`).find('.declaration-multimedia-save-btn-container').removeClass('hide');
                // digibiz.isDeclarationTransactionPictureSelected = true;

                // var modal_data = {
                //     modal_platform: crossplat.device.platform,
                //     modal_id: "transaction-signature-picture-modal",
                //     modal_header: "",
                //     modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                //     modal_action_buttons: [{
                //         id: "crop-button",
                //         name: `crop`,
                //         attr: [{
                //             name: "data-id",
                //             value: "transaction"
                //         }]
                //     }]
                // }
                // showModal(modal_data, function () {
                //     removeLoader();
                //     $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                //     $('#transaction-signature-picture-modal').attr('data-id', "transaction");
                // });
                // removeLoader();
            }
        } else {
            Materialize.toast('Please select 1 picture', 3000, 'round error-alert');
            removeLoader();
        }
    });

    //confirm selcted signature picture
    $(document).on('click', '#btn-confirm-add-signature-picture', function () {
        addLoader();
        if (validateSignaturePictures()) {
            $('#declaration-select-signature').remove();
            if (digibiz.signature_picture.hasOwnProperty('image_id') && digibiz.signature_picture.image_id) {
                // var transaction_picture = config.api.core + "/api/individual/get_image?image_id=" + digibiz.signature_picture.image_id + "&device_id=" + crossplat.device.uuid;
                // $('#signature_picture').attr("src", transaction_picture);
                // $('#signature-picture-mutimedia-add').replaceWith(`<i class="material-icons" id="signature-picture-delete">delete</i>`)
                // $('#signature-picture-delete').parent().removeClass('signature-picture-multimedia-load-btn');
                // $('#modal-close-btn').trigger('click');
                // $(`.add-picture-main-wrapper[data-for="signature_picture"]`).find('.declaration-multimedia-save-btn-container').removeClass('hide');
                // digibiz.isDeclarationSignaturePictureSelected = true;
                // removeLoader();

                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: digibiz.signature_picture.record_id,
                    image_id: digibiz.signature_picture.image_id
                }
                base64GetDigibiz(reqparams)
                    .then((response) => {
                        //console.log("base64GetDigibiz", response);
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "transaction-signature-picture-modal",
                            modal_header: "",
                            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                            modal_action_buttons: [{
                                id: "crop-button",
                                name: `crop`,
                                attr: [{
                                    name: "data-id",
                                    value: "signature"
                                }]
                            }]
                        }
                        showModal(modal_data, function () {
                            removeLoader();
                            if ($('.modal-popup-content').length > 0) {
                                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                    // //console.log("scroll initiated for modal pop-up class")
                                    // appScroll.scrollBar('.modal-popup-content');
                                }
                            }
                            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                            $('#transaction-signature-picture-modal').attr('data-id', "signature");
                            $('#declaration-select-signature').remove();
                            var image = $('#image_cropper')[0];
                            image.src = response;
                            $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            digibiz.cropper = new Cropper(image, {
                                viewMode: 2,
                                aspectRatio: 1 / 1,
                                minContainerWidth: 72,
                                minContainerHeight: 72,
                                minCropBoxWidth: 72,
                                minCropBoxHeight: 72,
                                maxWidth: 100,
                                maxHeight: 400,
                                zoomable: true,
                                rotatable: true,
                                responsive: true,
                                movable: true,
                                ready: function () {
                                    //cropper.zoom(-0.6);
                                }
                            });
                        });
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in base64 get")
                    })
            }
        } else {
            Materialize.toast('Please select 1 picture', 3000, 'round error-alert');
            removeLoader();
        }
    });

    //saving transaction picture
    $(document).on('click', '.declaration-transaction-multimedia-save-btn', function () {
        addLoader();
        if (digibiz.isDeclarationTransactionPictureSelected) {
            if (digibiz.transactional_picture.hasOwnProperty('image_id') && digibiz.transactional_picture.image_id) {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id'),
                    data: {
                        declaration_transaction_pictures: digibiz.transactional_picture,
                    }
                }
                businessUpdate(reqParam)
                    .then((result) => {
                        // $(this).parents('.add-picture-main-wrapper').find('#transaction-picture-delete').attr('data-image_id', digibiz.transactional_picture.image_id);
                        $(this).parent().addClass('hide');
                        digibiz.transactional_picture = {};
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in transaction update");
                    })
            } else {
                // $("#loader-message").text(`Uploading identity picture`);                
                var transactionPictureContent = $("#transaction_picture").attr("src");
                var type = "transaction";
                if (transactionPictureContent) {
                    storeIdentityPic(transactionPictureContent, type)
                        .then((response) => {
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    declaration_transaction_pictures: {
                                        asset_id: response.Data.asset_id,
                                        storage_id: response.Data.filename,
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((result) => {
                                    // $(this).parents('.add-picture-main-wrapper').find('#transaction-picture-delete').attr('data-asset_id', response.Data.asset_id);
                                    $(this).parent().addClass('hide');
                                    removeLoader();
                                })
                                .catch((err) => {
                                    removeLoader();
                                    //console.log("error in transaction update");
                                })
                        });
                } else {
                    removeLoader();
                    Materialize.toast("Failed to upload transaction-picture", 3000, 'round success-alert');
                }
            }
        } else {
            removeLoader();
            Materialize.toast("Please add transaction picture", 3000, 'round success-alert');
        }
    });

    //saving signature picture
    $(document).on('click', '.declaration-signature-multimedia-save-btn', function () {
        if (digibiz.isDeclarationSignaturePictureSelected) {
            if (digibiz.signature_picture.hasOwnProperty('image_id') && digibiz.signature_picture.image_id) {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id'),
                    data: {
                        declaration_signature_pictures: digibiz.signature_picture,
                    }
                }
                businessUpdate(reqParam)
                    .then((result) => {
                        // $(this).parents('.add-picture-main-wrapper').find('#transaction-picture-delete').attr('data-image_id', digibiz.signature_picture.image_id);
                        $(this).parent().addClass('hide');
                        digibiz.signature_picture = {};
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in transaction update");
                    })
            } else {
                // $("#loader-message").text(`Uploading identity picture`);
                addLoader();
                var signaturePictureContent = $("#signature_picture").attr("src");
                var type = "signature";
                if (signaturePictureContent) {
                    savebusinessMultimedia(signaturePictureContent, type)
                        .then((response) => {
                            // $("#file-loader").addClass("hide");                        
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    declaration_signature_pictures: {
                                        asset_id: response.Data.asset_id,
                                        storage_id: response.Data.filename,
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((result) => {
                                    // $(this).parents('.add-picture-main-wrapper').find('#signature-picture-delete').attr('data-asset_id', response.Data.asset_id);
                                    $(this).parent().addClass('hide');
                                    removeLoader();
                                })
                                .catch((err) => {
                                    removeLoader();
                                    //console.log("error in transaction update");
                                })
                        })
                        .catch(err => {
                            // $("#file-loader").addClass("hide");
                            // $("#loader-message").empty();
                            removeLoader();
                        });
                } else {
                    removeLoader();
                    Materialize.toast("Failed to upload signature-picture", 3000, 'round success-alert');
                }
            }
        } else {
            removeLoader();
            Materialize.toast("Please add Signature picture", 3000, 'round success-alert');
        }
    });


    //showing identity pic pop up  /  brand asset pop up
    $(document).on('click', '.transaction_pic_preview', function (e) {
        //console.log("preview clicked");
        var assetId = $(this).attr('data-asset_id');
        //console.log("assetId", assetId);
        var image_id = $(this).attr('data-image_id');
        //console.log("image_id", image_id);
        addLoader();
        if (assetId) {
            getIdentityPicInfo(assetId)
                .then((info) => {
                    var assetParam = {
                        device_id: crossplat.device.uuid,
                        location: info.location,
                        parent: info.parent,
                        owner: info.owner,
                        real_name: info.file_attributes.name.real
                    }
                    getViewMultimediaUrl(assetParam)
                        .then((response) => {
                            viewFile(info.file_attributes.name.relative, response.Data, function () {
                            })
                        })
                        .catch((err) => {
                            removeLoader();
                            // if drive is inactive 
                            if (err.hasOwnProperty("message") && err.message.hasOwnProperty("error_description")) {
                                Materialize.toast(`${err.message.error_description} ! Please try again later`, 3000, "round error-alert");
                            }
                            else if (err.hasOwnProperty("error") && err.error.hasOwnProperty("msg")) {
                                //if file is deleted
                                Materialize.toast(`${err.error.msg} ! Please try again later`, 3000, 'round error-alert');
                            }
                            else {
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            }
                        });
                    resolve();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, 'rounderror-alert');
                });
        } else if (image_id) {
            var getUrl = $(this).parent('.mask').siblings('img').attr('src');
            //console.log("getUrl", getUrl);
            var viewer_data = {
                viewer_id: "file-preview-popup",
                viewer_file_id: null,
                viewer_mime_type: "image",
                asset_content: '<img src= "' + getUrl + '">'
            };
            showFileViewer(viewer_data, function () {
                removeLoader();
            });
        } else {
            removeLoader();
            //console.log("!@!@!@!CHECK ERROR!@!@!@!@!")
        }
    })

    //showing identity pic pop up  /  brand asset pop up
    $(document).on('click', '.signature_pic_preview', function (e) {
        //console.log("preview clicked");
        var assetId = $(this).attr('data-asset_id');
        //console.log("assetId", assetId);
        var image_id = $(this).attr('data-image_id');
        //console.log("image_id", image_id);
        addLoader();
        if (assetId) {
            getIdentityPicInfo(assetId)
                .then((info) => {
                    var assetParam = {
                        device_id: crossplat.device.uuid,
                        location: info.location,
                        parent: info.parent,
                        owner: info.owner,
                        real_name: info.file_attributes.name.real
                    }
                    getViewMultimediaUrl(assetParam)
                        .then((response) => {
                            viewFile(info.file_attributes.name.relative, response.Data, function () {
                            })
                        })
                        .catch((err) => {
                            removeLoader();
                            // if drive is inactive 
                            if (err.hasOwnProperty("message") && err.message.hasOwnProperty("error_description")) {
                                Materialize.toast(`${err.message.error_description} ! Please try again later`, 3000, "round error-alert");
                            }
                            else if (err.hasOwnProperty("error") && err.error.hasOwnProperty("msg")) {
                                //if file is deleted
                                Materialize.toast(`${err.error.msg} ! Please try again later`, 3000, 'round error-alert');
                            }
                            else {
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            }
                        });
                    resolve();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, 'rounderror-alert');
                });
        } else if (image_id) {
            var getUrl = $(this).parent('.mask').siblings('img').attr('src');
            //console.log("getUrl", getUrl);
            var viewer_data = {
                viewer_id: "file-preview-popup",
                viewer_file_id: null,
                viewer_mime_type: "image",
                asset_content: '<img src= "' + getUrl + '">'
            };
            showFileViewer(viewer_data, function () {
                removeLoader();
            });
        } else {
            removeLoader();
            //console.log("!@!@!@!CHECK ERROR!@!@!@!@!")
        }
    });

    /**
    *  Web Capture video(trigger-videocam)
    */
    $(document).on('click', '.trigger-videocam', function () {
        digibiz.fileObject = {};
        $(`.add-picture-main-wrapper[data-for="video"]`).find('.mask').addClass('hide');
        $('#business-display-video-from-action-sheet').remove();
        $('#employee-display-video-from-action-sheet').remove();
        $('#customer-display-video-from-action-sheet').remove();
        $('#associate-customer-display-video-from-action-sheet').remove();
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_id: "camera-video-modal",
                modal_header: "Capture Video",
                modal_platform: crossplat.device.platform,
                modal_body: html,
                // modal_action_buttons: [{
                //     "name": "Add",
                //     "id": "add-selected-employees-group",
                // }]
            }
            showModal(modal_data, function () {
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                    // $('#modal-close-btn').addClass('hide');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                    // $('#modal-close-btn').addClass('hide');
                }
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    const vgaConstraints = { video: true, audio: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.videocamerastream = stream;
                        //media recorder
                        window.recorder = new MediaRecorder(stream, { mimeType: "video/webm;codecs=vp8,opus" });
                        window.videoCapturedChunks = [];
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-header").addClass('hide');
                        //remove Hide class from upload preview
                        if ($(`.upload-preview-wrapper[data-for="video"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="video"]`).removeClass('hide').addClass('slide-top');
                            $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-header").addClass('hide');
                        }
                        //Change Title                        
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-header span").text("Capture Video");
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-container").removeClass('hide');
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".file-manager-footer").addClass('hide');


                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><div class="record-timer"><span id="indicator"></span> <span id="timer">00:00:00</span></div><button id="video-camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">videocam</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                } else {
                    // capture callback
                    var captureSuccess = function (mediaFiles) {
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-header").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="video"]`).find('#upload-footer-send-btn').removeClass('disabled');
                        $(`.upload-preview-wrapper[data-for="video"]`).find('.upload-preview-footer').removeClass('hide');
                        //show preview
                        $(`.upload-preview-wrapper[data-for="video"]`).find("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-container").removeClass('hide');
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".file-manager-footer").addClass('hide');
                        //remove Hide class from upload preview
                        if ($(`.upload-preview-wrapper[data-for="video"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="video"]`).removeClass('hide').addClass('slide-top');
                            $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-header").addClass('hide');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-header span").text("Capture Video");

                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-file-preview").empty();
                        //change send button attribute
                        $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'videocamera');

                        // var i, path, localPath, len;
                        // for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                        //     path = Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);;
                        //     localPath = mediaFiles[i].localURL;
                        //     window.videoMediaFile = path;
                        //     //append captured photo
                        //     var vid = document.createElement('video');
                        //     vid.src = path;
                        //     vid.controls = true;
                        //     vid.classList.add('preview-file');
                        //     var getElem = $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-file-preview");
                        //     $(getElem).append(vid);
                        //     // document.querySelector('#upload-file-preview').appendChild(vid);
                        // }


                        var file = mediaFiles[0];
                        //console.log("file", file);
                        var videoFileName = file.name;
                        //console.log("videoFileName", videoFileName);
                        VideoEditor.transcodeVideo(
                            function (result) {
                                //console.log('transcode video', result);
                                localpath = result;
                                //console.log("localpath", localpath);
                                // path = Ionic.WebView.convertFileSrc(result);
                                path = result;
                                //console.log("path", path);
                                // window.videoMediaFile = localpath;
                                window.videoMediaFile = `file://${localpath}`;
                                //console.log("window.videoMediaFile", window.videoMediaFile)
                                //append captured photo
                                var vid = document.createElement('video');
                                vid.src = path;
                                vid.controls = true;
                                vid.classList.add('preview-file');
                                // document.querySelector('#upload-file-preview').appendChild(vid);
                                var getElem = $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-file-preview");
                                //console.log("getElem", getElem);
                                $(getElem).append(vid);
                            },
                            function (err) {
                                //console.log('transcode video error', err);
                            },
                            {
                                fileUri: file.fullPath,
                                outputFileName: videoFileName,
                                outputFileType: VideoEditorOptions.OutputFileType.MPEG4,
                                optimizeForNetworkUse: VideoEditorOptions.OptimizeForNetworkUse.YES,
                                saveToLibrary: false,
                                maintainAspectRatio: true,
                                width: 640,
                                height: 640,
                                videoBitrate: 1000000, // 1 megabit
                                progress: function (info) {
                                    //console.log('transcodeVideo progress callback, info: ' + info);
                                }
                            }
                        );
                    };
                    // capture error callback
                    var captureError = function (error) {
                        navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                    };
                    // start Video capture
                    var options = { limit: 1, duration: 60, quality: 0 };
                    navigator.device.capture.captureVideo(captureSuccess, captureError, options);
                }
                removeLoader();
            });
        }, 'page/common/camera_video', '#camera-video-template', null);
    });

    $(document).on('click', '#video-camera-capture', function () {
        //console.log('mobile video capture');
        //toggle record button
        $("#video-camera-capture").replaceWith(`<button id="stop-video-camera-capture" class="btn-floating btn-large waves-effect waves-light red cursor-pointer"><i class="material-icons">stop</i></button>`);
        //show indicator
        window.indicator_interval = setInterval(function () {
            if ($(".record-timer").find("#indicator").css('background-color') != "rgb(255, 0, 0)") {
                $(".record-timer").find("#indicator").css('background-color', "rgb(255, 0, 0)");
            } else {
                $(".record-timer").find("#indicator").css('background-color', 'transparent');
            }
        }, 600);
        //show timer
        startTimer();
        // function startTimer() {
        //     var current_minute = 00;
        //     var current_seconds = 00;
        //     var current_hours = 00;
        //     window.interval = setInterval(function () {
        //         if (current_minute == 60) {
        //             current_minute = 00;
        //             current_hours++;
        //         }
        //         if (current_seconds == 60) {
        //             current_seconds = 00;
        //             current_minute++;
        //         }
        //         current_seconds++;
        //         showTime(`${pad(current_hours)}:${pad(current_minute)}:${pad(current_seconds)}`);
        //     }, 1000);
        // }
        function startTimer() {
            //console.log('wfre');
            var current_hours = 0;
            var current_minute = 0;
            var current_seconds = 60;
            window.interval = setInterval(function () {
                if (current_seconds == 0) {
                    // $(`.upload-preview-wrapper[data-for="video"]`).find('#upload-preview-close-btn').click();
                    $('#stop-video-camera-capture').trigger('click');
                    Materialize.toast(`Video can't be more than 60 seconds`, 3000, 'rounded error-alert');
                }
                current_seconds--;
                showTime(`${pad(current_hours)}:${pad(current_minute)}:${pad(current_seconds)}`);
            }, 1000);
        }
        function pad(num) {
            if (num < 10) {
                return "0" + num;
            } else {
                return num;
            }
        }
        function showTime(time) {
            $(".record-timer").find("#timer").text(time);
        }
        //start video recording
        recorder.start();
    });

    $(document).on('click', '#stop-video-camera-capture', function () {
        addLoader();
        //stop recorder
        recorder.stop();
        clearInterval(interval);
        clearInterval(indicator_interval);
        //on stop recorder
        recorder.onstop = function () {
            //change send button attribute
            $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'videocamera');
            var blob = new Blob(videoCapturedChunks, { 'type': 'video/webm' });
            //prepare video element
            var videoContainer = document.querySelector('#upload-file-preview');
            var videoElement = document.createElement('video');
            videoElement.controls = true;
            videoElement.classList.add('preview-file');
            videoElement.src = URL.createObjectURL(blob);
            //replace video element
            $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-file-preview").empty();
            var getElem = $(`.upload-preview-wrapper[data-for="video"]`).find("#upload-file-preview");
            $(getElem).append(videoElement);
            // videoContainer.appendChild(videoElement);
            $(`.upload-preview-wrapper[data-for="video"]`).find('#upload-footer-send-btn').removeClass('disabled');
            //remove hide classes
            $(`.upload-preview-wrapper[data-for="video"]`).find(".upload-preview-footer").removeClass('hide');
            removeLoader();
            //stop device
            if (window.videocamerastream) {
                window.videocamerastream.getTracks()[0].stop();
                window.videocamerastream.getTracks()[1].stop();
            }
        }
        //data avaliable
        recorder.ondataavailable = function (e) {
            videoCapturedChunks.push(e.data);
        }
    });


    $(document).on('click', '#business-add-declaration', function () {
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_id: "business-declaration-modal",
                modal_header: "Business Declarations",
                modal_platform: crossplat.device.platform,
                modal_body: html,
                modal_action_buttons: [{
                    "name": "Confirm",
                    "id": "confirm_business_declaration",
                }]
            }
            showModal(modal_data, function () {
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                }
            });
        }, 'page/business/business_declaration', '#declaration-settings-template', null);
    });

    $(document).on('click', '#confirm_business_declaration', function () {
        sessionStorage.setItem('declaration_status', "confirm");
        $('#business-declaration-modal').remove();
    });

    $(document).on('click', '#modal-close-btn', function () {
        $('#business-declaration-modal').remove();
    });

    $(document).on('click', '.register-bussines-btn', function () {
        addLoader();
        if (digibiz.storages.length <= 0) {
            removeLoader();
            Materialize.toast(`Please choose the business storage`, 3000, 'round success-alert');
        } else {
            $(this).prop('disabled', true);
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('business_id'),
                data: {
                    status: "self-verified",
                    socket_enable_status: "true"
                }
            }
            businessUpdate(reqParam)
                .then((response) => {
                    //console.log("businessUpdate response", response);
                    $(this).attr('disabled', false);
                    // location.hash = `business_owner/business/list`;
                    location.hash = `business_owner/business/list`;
                })
                .catch((err) => {
                    $(this).attr('disabled', false);
                    removeLoader();
                    Materialize.toast(`Error in registering business`, 3000, 'round success-alert');
                })
        }
    });


    $(document).on('click', '.multimedia-upload', function () {
        addLoader();
        if ($('.selected-multimedia-files').length > 0) {
            removeLoader();
            Materialize.toast(`Please save the last file uploaded.`, 3000, 'round error-alert');
        } else {
            //remove all selcted multimedia files 
            $('.selected-multimedia-files').remove();
            //clear all camera, device and cloud global array
            digibiz.cloud_multimedia_selected_files = [];
            digibiz.device_multimedia_selected_files = [];
            digibiz.cloud_uploading_files = [];
            digibiz.cloud_multimedia_selected_files = [];
            digibiz.camera_multimedia_selected_files = [];
            digibiz.device_multimedia_uploaded_files = [];
            digibiz.cloud_multimedia_uploaded_files = [];
            digibiz.camera_multimedia_uploaded_files = [];
            $('.multimedia-upload').removeClass('active');
            $(this).addClass('active');
            var getDataAttr = $(this).attr('data-id');
            sessionStorage.setItem('multimedia_upload_data_id', getDataAttr);
            if (validateBeforeAttachement()) {
                var action_parms = {
                    action_id: "action-multimedia-upload-attachments-options",
                    action_platform: crossplat.device.platform,
                    action_title: "Attachment Types",
                    action_btn: [
                        // {
                        //     name: "Camera",
                        //     attr: [{ name: "class", value: "action-multimedia-upload-attachment-camera-btn" }]
                        // },
                        {
                            name: "Device Upload",
                            attr: [{ name: "class", value: "action-multimedia-upload-attachment-device-upload-btn" }]
                        },
                        {
                            name: "Cloud Upload",
                            // attr: [{ name: "class", value: "action-multimedia-upload-attachment-cloud-upload-btn" }]
                            attr: [{ name: "class", value: "digibiz-filemanager" }]
                        }]
                };
                showAction(action_parms, function () {
                    removeError($('#upload-preview-container-text-box'))
                    removeLoader();
                });
            } else {
                removeLoader();
                //console.log("error in validateBeforeAttachement");
            }
        }
    });

    //device upload
    $(document).on('click', '.action-multimedia-upload-attachment-device-upload-btn', function () {
        $('#business_add_device_upload').val("");
        $('#business_add_device_upload').trigger('click');
        $('#action-multimedia-upload-attachments-options').remove();
    });

    //on change business device upload button multimedia
    $(document).on('change', '#business_add_device_upload', function () {
        var files = this.files;
        //console.log("files", files);
        if (files[0]) {
            //console.log("files[0]", files[0]);
            var fileExtension = files[0].name.split(".").pop();
            //console.log("fileExtension", fileExtension)
            var fileType = files[0].type.split("/")[0];
            //console.log("fileType", fileType);
            var fileExtension2 = files[0].type.split("/")[1];
            //console.log("fileExtension2", fileExtension2)
            //validation file format
            if (!(config.attachmentFileFormat.includes(fileExtension.toLowerCase()))) {
                var alert_body_template = `<div class="alert-invalid-attachment-container">This files is an invalid file type..try uploading other file</div>`;
                var alert_parms = {
                    alert_id: "alert-invalid-attachment",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Invalid Attachment",
                    alert_body: alert_body_template,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "btn-invalid-attachment-ok" }]
                    },
                    ]
                }
                showAlert(alert_parms, function () {
                })
            }
            //validation total size            
            else if (files[0].size > config.maxSizeAllowMultiMediaFiles) {
                var alert_body_template = `<div class="alert-exceeded-size-attachment-container">This file is exceeding max size allowed..Try uploading file less than 20MB </div>`;
                var alert_parms = {
                    alert_id: "alert-exceeded-size-attachment",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Invalid Attachment",
                    alert_body: alert_body_template,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "btn-exceeded-size-attachment-ok" }]
                    },
                    ]
                }
                showAlert(alert_parms, function () {
                })
                //validate total mm(TODO)            
            } else {
                //console.log("files[0]", files[0])
                var source;
                var file_name = files[0].name;
                //console.log("file_name", file_name)
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onloadend = async function (event) {
                    source = reader.result;
                    //console.log("source", source);
                    //common global array for device upload
                    digibiz.device_multimedia_selected_files.push(files[0]);
                    //console.log("digibiz.device_multimedia_selected_files", digibiz.device_multimedia_selected_files);
                    //create Object URL
                    digibiz.objectURLS[1] = URL.createObjectURL(files[0]);
                    //console.log("digibiz.objectURLS", digibiz.objectURLS)
                    $(".upload-preview-common-layout#upload-preview-wrapper").find('#upload-footer-send-btn-common').attr('data-uploadtype', "device");
                    if (fileType == "text") {
                        fileType = "application";
                    }
                    var content = await viewFile(fileType, fileExtension, digibiz.objectURLS[1]);
                    //console.log("content", content)
                    //add preview thumbnails
                    $(".upload-footer-attatched-file").removeClass('active');

                    // if (['image', 'video'].includes(fileType)) {
                    //     // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${thubnail}"/><span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                    //     // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${blob}"/>`);
                    //     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(content);
                    //     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass('active');
                    // } else {
                    //     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass(`active file-type-${sessionData.file_type} icomoon-`);
                    //     // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                    //     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(``);
                    // }
                    // //add extension and file type
                    // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileType', sessionData.file_type);
                    // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileExtension', sessionData.extension);

                    //remove Hide class from upload preview
                    //console.log("check", $(".upload-preview-common-layout#upload-preview-wrapper"))
                    //console.log("append", $(".upload-preview-common-layout#upload-file-preview"))
                    // $(".upload-preview-common-layout #upload-file-preview").append(sessionData.url)
                    // $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide');
                    if ($(".upload-preview-common-layout#upload-preview-wrapper").hasClass('hide')) {
                        //console.log("123")
                        $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
                        $('div[data-filemanager="filemanager"]').addClass('hide');
                    }

                    digibiz.uploadingFiles.push({
                        // identifier: asset_ids[0],
                        file: files[0],
                        fileURI: digibiz.objectURLS[1],
                        // thumbnail: thubnail,
                        // room: room,
                        // group_id: group_id,
                        // contact_id: contact_id
                    });
                    //console.log("digibiz.uploadingFiles", digibiz.uploadingFiles)
                    $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide');
                    $(".upload-preview-common-layout #upload-file-preview").html(content);
                    $('#upload-footer-send-btn-common').attr('data-id', sessionStorage.getItem('multimedia_upload_data_id'));
                    $('#upload-footer-send-btn-common').attr('data-name', file_name);
                    $('#upload-preview-container-text-box').text("");
                    $('#upload-footer-send-btn-common').removeAttr('data-download');
                    //console.log("CHECKING DEVICE", fileType);
                    if (fileType == 'image' || fileType == "video" || fileType == "audio") {
                        //console.log("CHECKING DEVICE-add hide");
                        $('.pdf-view').addClass('hide');
                    } else {
                        //console.log("CHECKING DEVICE-remove hide");
                        $('.pdf-view').removeClass('hide');
                    }
                    if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
                        $('.header-band').addClass('hide');
                    }

                    //needed to be commented start
                    var loadedfile = `<div class="grid selected-multimedia-files" data-type="file" data-upload-type="device">
                                <img class="hide" src="${source}"/>
                                <div class="thumbnail-wrapper">
                                   <a class="">
                                      <div class="thumbnail"></div>
                                   </a>                     
                                </div>
                                <div class="file-details ellipsify">
                                   <div class="file-name">
                                      <a class="thumb-title">${file_name}</a>
                                   </div>  
                                   <div class="file-size">
                                   <div class="thumb-meta">
                                      <span class="thumb-info">${files[0].size}</span>
                                   </div>
                                </div>                    
                                </div>
                                <div class="file-selected-remove-btn">
                                <i class="material-icons">cancel</i>
                            </div>
                             </div>`;
                    //console.log("loadedfile", loadedfile);
                    var getDeviceUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
                    //console.log("getDeviceUploadTo", getDeviceUploadTo);
                    if (getDeviceUploadTo == "identity-proof-load-btn") {
                        // digibiz.id_proof_selected_files.push(files[0]);
                        $('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                        // $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "pancard-load-btn") {
                        // digibiz.pan_card_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "shop-established-license-load-btn") {
                        // digibiz.shop_established_licence_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "gst-license-load-btn") {
                        // digibiz.gst_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "partnership-deed-load-btn") {
                        // digibiz.partnership_deed_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "partnership-registration-certificate-load-btn") {
                        // digibiz.partnership_registration_certificate_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "llp-registration-certificate-load-btn") {
                        // digibiz.llp_registration_certificate_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "transaction-person-load-btn") {
                        // digibiz.transaction_person_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "memorandum-of-association-load-btn") {
                        // digibiz.memorandum_of_association_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "articles-of-association-load-btn") {
                        // digibiz.articles_of_association_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    } else if (getDeviceUploadTo == "trust-establishment-license-load-btn") {
                        // digibiz.trust_established_licence_selected_files.push(files[0]);
                        $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                    }
                    //needed to be commented end
                }
                reader.readAsDataURL(files[0]);
            }
        }
    });

    // $(document).on('change', '#business_add_device_upload', function () {
    //     var files = this.files;
    //     //console.log("files", files);
    //     if (files[0]) {
    //         //console.log("files[0]", files[0]);
    //         var fileType = files[0].name.split(".").pop();
    //         //validation file format
    //         if (!(config.attachmentFileFormat.includes(fileType.toLowerCase()))) {
    //             var alert_body_template = `<div class="alert-invalid-attachment-container">This files is an invalid file type..try uploading other file</div>`;
    //             var alert_parms = {
    //                 alert_id: "alert-invalid-attachment",
    //                 alert_platform: crossplat.device.platform,
    //                 alert_title: "Invalid Attachment",
    //                 alert_body: alert_body_template,
    //                 alert_btn: [{
    //                     name: "Ok",
    //                     attr: [{ name: "id", value: "btn-invalid-attachment-ok" }]
    //                 },
    //                 ]
    //             }
    //             showAlert(alert_parms, function () {
    //             })
    //         }
    //         //validation total size            
    //         else if (files[0].size > config.maxSizeAllowMultiMediaFiles) {
    //             var alert_body_template = `<div class="alert-exceeded-size-attachment-container">This file is exceeding max size allowed..Try uploading file less than 20MB </div>`;
    //             var alert_parms = {
    //                 alert_id: "alert-exceeded-size-attachment",
    //                 alert_platform: crossplat.device.platform,
    //                 alert_title: "Invalid Attachment",
    //                 alert_body: alert_body_template,
    //                 alert_btn: [{
    //                     name: "Ok",
    //                     attr: [{ name: "id", value: "btn-exceeded-size-attachment-ok" }]
    //                 },
    //                 ]
    //             }
    //             showAlert(alert_parms, function () {
    //             })
    //             //validate total mm(TODO)            
    //         } else {
    //             //console.log("123", files[0])
    //             var source;
    //             var file_name = files[0].name;
    //             var reader = new FileReader();
    //             //console.log("reader", reader);
    //             reader.onloadend = function (event) {
    //                 source = reader.result;
    //                 //console.log("source", source);
    //                 //common global array for device upload
    //                 digibiz.device_multimedia_selected_files.push(files[0]);
    //                 var loadedfile = `<div class="grid selected-multimedia-files" data-type="file" data-upload-type="device">
    //                             <img class="hide" src="${source}"/>
    //                             <div class="thumbnail-wrapper">
    //                                <a class="">
    //                                   <div class="thumbnail"></div>
    //                                </a>                     
    //                             </div>
    //                             <div class="file-details ellipsify">
    //                                <div class="file-name">
    //                                   <a class="thumb-title">${file_name}</a>
    //                                </div>  
    //                                <div class="file-size">
    //                                <div class="thumb-meta">
    //                                   <span class="thumb-info">${files[0].size}</span>
    //                                </div>
    //                             </div>                    
    //                             </div>
    //                             <div class="file-selected-remove-btn">
    //                             <i class="material-icons">cancel</i>
    //                         </div>
    //                          </div>`;
    //                 //console.log("loadedfile", loadedfile);
    //                 var getDeviceUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
    //                 //console.log("getDeviceUploadTo", getDeviceUploadTo);
    //                 if (getDeviceUploadTo == "identity-proof-load-btn") {
    //                     // digibiz.id_proof_selected_files.push(files[0]);
    //                     $('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                     // $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "pancard-load-btn") {
    //                     // digibiz.pan_card_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "shop-established-license-load-btn") {
    //                     // digibiz.shop_established_licence_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "gst-license-load-btn") {
    //                     // digibiz.gst_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "partnership-deed-load-btn") {
    //                     // digibiz.partnership_deed_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "partnership-registration-certificate-load-btn") {
    //                     // digibiz.partnership_registration_certificate_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "llp-registration-certificate-load-btn") {
    //                     // digibiz.llp_registration_certificate_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "transaction-person-load-btn") {
    //                     // digibiz.transaction_person_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "memorandum-of-association-load-btn") {
    //                     // digibiz.memorandum_of_association_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "articles-of-association-load-btn") {
    //                     // digibiz.articles_of_association_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 } else if (getDeviceUploadTo == "trust-establishment-license-load-btn") {
    //                     // digibiz.trust_established_licence_selected_files.push(files[0]);
    //                     $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                 }
    //             }
    //             reader.readAsDataURL(files[0]);
    //         }
    //     }
    // });

    $(document).on('click', '#btn-invalid-attachment-ok', function () {
        $('#alert-invalid-attachment').remove();
    });

    $(document).on('click', '#btn-exceeded-size-attachment-ok', function () {
        $('#alert-exceeded-size-attachment').remove();
    });

    $(document).on('click', '.file-selected-remove-btn', function () {
        var getAssetId = $(this).siblings('.file-details').attr('data-asset-id');
        if (getAssetId) {
            var getElement = $(this).siblings('.multimedia-append-container').attr('data-id');
            //console.log("TODO TODO")
        } else {
            $(this).parents('.selected-multimedia-files').remove();
        }
    });

    //cloud upload
    // $(document).on('click', '.digibiz-filemanager', function () {
    //     $('#action-multimedia-upload-attachments-options').remove();
    //     digibiz.cloudAssets = [];
    //     $('.grid-view-container').removeClass('edit-mode');
    //     $('input[name="fileselection[]"]').prop('checked', false);
    //     $(".expand-search-input").removeAttr("socketid");
    //     $(".expand-search-input").val('');
    //     // sessionStorage.removeItem('filemanager_individual_id');
    //     // sessionStorage.setItem('filemanager_individual_id', sessionStorage.getItem('user_id'))
    //     getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
    //         //console.log("assetsDetails", assetsDetails);
    //         digibiz.cloudAssets = assetsDetails.Data.assets;
    //         showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
    //             //console.log("1234");
    //             $('.filemanger_container_toggle').trigger('click');
    //             $('.file-manager-footer').removeClass('hide');
    //             $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
    //         })
    //     }).catch((err) => {
    //         Materialize.toast("No assets found", 3000, 'rounded error-alert');
    //         showFilemanagerAssetsFilesList(null, function () {
    //             //console.log("kjhgfd");
    //         })
    //     });
    // });

    $(document).on('click', '.close-btn-cloud', function () {
        addLoader();
        //console.log("clicked close");
        setTimeout(function () {
            $('.filemanger_container_toggle').removeClass('active');
            removeLoader();
        }, 300)
    });

    /**
    * Double click on the folder
    */
    $(document).on('dblclick', '.filemanager-folder-doubletap', function (e) {
        addLoader();
        let parent = $(this).attr('data-parent');
        let relative = $(this).attr('data-relative')
        sessionStorage.removeItem('filemanager_current_folder');
        sessionStorage.setItem('filemanager_current_folder', parent);
        filemanagerNavigateToLocation(parent, "personal_workspace", function () {
            removeLoader();
            //console.log(relative.trim(), parent);
            setFilemanagerBreadcrumb({
                relative_name: relative.trim(),
                real_name: parent,
            });
            $('.arrow-back-btn').removeClass('hide');
            $('.close-btn-cloud').addClass('hide');
        });
    });

    // $(document).on('click', '.arrow-back-btn', function () {
    //     addLoader();
    //     //pull entry from breadcrumb_path
    //     $(".expand-search-input").removeAttr("socketid");
    //     $(".expand-search-input").val('');
    //     var breadcrumb_path = JSON.parse(sessionStorage.getItem('filemanager_breadcrumb_path'));
    //     var current_folder = sessionStorage.getItem('filemanager_current_folder');
    //     if (breadcrumb_path && breadcrumb_path.length > 0) {
    //         //remove current path
    //         breadcrumb_path = breadcrumb_path.filter(e => e.real_name != current_folder);
    //         sessionStorage.setItem('filemanager_breadcrumb_path', JSON.stringify(breadcrumb_path));

    //         //get current path
    //         if (breadcrumb_path.length > 0) {
    //             current_folder = breadcrumb_path[breadcrumb_path.length - 1].real_name;
    //             sessionStorage.setItem('filemanager_current_folder', current_folder);
    //         } else {
    //             $('.arrow-back-btn').addClass('hide');
    //             $('.close-btn-cloud').removeClass('hide');
    //             sessionStorage.setItem('filemanager_current_folder', "");
    //         }
    //     }
    //     filemanagerNavigateToLocation(sessionStorage.getItem('filemanager_current_folder'), "personal_workspace", function () {
    //         removeLoader();
    //     });
    // });

    //back button

    $(document).on('click', '.arrow-back-btn', function () {
        addLoader();
        //pull entry from breadcrumb_path
        $(".expand-search-input").removeAttr("socketid");
        $(".expand-search-input").val('');
        var breadcrumb_path = JSON.parse(sessionStorage.getItem('filemanager_breadcrumb_path'));
        var current_folder = sessionStorage.getItem('filemanager_current_folder');
        if (breadcrumb_path && breadcrumb_path.length > 0) {
            //remove current path
            breadcrumb_path = breadcrumb_path.filter(e => e.real_name != current_folder);
            sessionStorage.setItem('filemanager_breadcrumb_path', JSON.stringify(breadcrumb_path));

            //get current path
            if (breadcrumb_path.length > 0) {
                current_folder = breadcrumb_path[breadcrumb_path.length - 1].real_name;
                sessionStorage.setItem('filemanager_current_folder', current_folder);
            } else {
                // $('.cloud-storage-heading').removeClass('hide').siblings('.arrow-back-btn').addClass('hide');
                sessionStorage.setItem('filemanager_current_folder', "");
                filemanagerNavigateToLocation(sessionStorage.getItem('filemanager_current_folder'), "personal_workspace", function () {
                    removeLoader();
                });
            }
        } else {
            $('.cloud-storage-heading').removeClass('hide').siblings('.arrow-back-btn').addClass('hide');
            sessionStorage.setItem('filemanager_current_folder', "");
            showCloudSelcetionList(function () {
                removeLoader();
                $('.filemanger_container_toggle').addClass('active');
                $('.file-manager-footer').removeClass('hide');
                $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
            });
        }
        // filemanagerNavigateToLocation(sessionStorage.getItem('filemanager_current_folder'), "personal_workspace", function () {
        //     removeLoader();
        // });
    });

    /**
 * Double click on the folder
 */
    $(document).on('dblclick', '.individual-filemanager-folder-doubletap', function (e) {
        addLoader();
        digibiz.uploadingFiles = [];
        let parent = $(this).attr('data-parent');
        let relative = $(this).attr('data-relative')
        sessionStorage.removeItem('filemanager_current_folder');
        sessionStorage.setItem('filemanager_current_folder', parent);
        filemanagerNavigateToLocation(parent, "personal_workspace", function () {
            removeLoader();
            setFilemanagerBreadcrumb({
                relative_name: relative.trim(),
                real_name: parent,
            });

            $('.cloud-storage-heading').addClass('hide').siblings('.arrow-back-btn').removeClass('hide');
        });
    })

    $(document).on('dblclick', '.digibiz-filemanager-folder-doubletap', function (e) {
        addLoader();
        digibiz.uploadingFiles = [];
        let parent = $(this).attr('data-parent');
        let relative = $(this).attr('data-relative')
        sessionStorage.removeItem('filemanager_current_folder');
        sessionStorage.setItem('filemanager_current_folder', parent);
        digibizFilemanagerNavigateToLocation(parent, "personal_workspace", function () {
            removeLoader();
            setFilemanagerBreadcrumb({
                relative_name: relative.trim(),
                real_name: parent,
            });

            $('.cloud-storage-heading').addClass('hide').siblings('.arrow-back-btn').removeClass('hide');
        });
    })


    //cloud select
    $(document).on('click', "input[name='individualFilemanagerFileSelection[]']", function (event) {
        event.stopPropagation();
        if ($('body').attr('app') == "digibiz_credentials") {
            //can upload only 1    
            if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                    $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                    var asset_id = $(this).attr('data-asset_id');
                    getAssetDetailsCloud(asset_id).then((file) => {
                        if (file.is_trashed == false) {
                            supported_types = config.identityPictureFileFormat;
                            // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                            if (file.file_attributes.extension != undefined) {
                                if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                    //console.log("file is supported");
                                    $(document).find('.file-info').addClass('disabled');
                                    //check the total size
                                    let totalSize = 0;
                                    if ($(this).prop("checked")) {
                                        let $current = $(this);
                                        $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                            // totalSize = parseInt($(this).attr("data-file_size"));
                                            totalSize = file.file_attributes.size.filesize;
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                //console.log("size", totalSize)
                                                if (totalSize / Math.pow(1024, 2) > 20) {
                                                    //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                    $($current).prop('checked', false);
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                    Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                    // digibiz.cloud_uploading_files.filter((e) => {
                                                    //     return e != $(this).attr('data-asset_id');
                                                    // })
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                } else {
                                                    //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                    if (file.type == "file") {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            'file_type': file.file_attributes.extension,
                                                            'asset_id': asset_id
                                                        };
                                                    } else {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            // 'asset_id': asset_id
                                                        };
                                                    }

                                                    // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                    // digibiz.cloud_uploading_files.push(data);
                                                    // }
                                                }
                                            }
                                        });
                                    } else {
                                        //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                        // //console.log("12345", digibiz.cloud_uploading_files)
                                        if (totalSize > 0) {
                                            totalSize -= parseInt($(this).attr("data-file_size"));
                                        }
                                    }

                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                        $(this).prop('checked', false);
                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                            $(document).find('.file-info').removeClass('disabled');
                                        }
                                        Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                    }
                                } else {
                                    //console.log("not supported file");
                                    $(this).prop('checked', false);
                                    Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                }
                            } else {
                                //console.log("file extension is undefined");
                            }
                        } else {
                            //console.log("file is thrashed");
                        }
                    })
                } else {
                    var relative_name = $(this).attr('data-relative');
                    // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                    $(document).find('.file-info').removeClass('disabled');
                    $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                }
            } else {
                $(this).prop('checked', false);
                Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
            }
        } else if ($('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_create" || $('body').attr('app') == "collaborator_group_details") {
            //can upload only 1    
            if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                    $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                    var asset_id = $(this).attr('data-asset_id');
                    getAssetDetailsCloud(asset_id).then((file) => {
                        if (file.is_trashed == false) {
                            supported_types = config.identityPictureFileFormat;
                            // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                            if (file.file_attributes.extension != undefined) {
                                if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                    //console.log("file is supported");
                                    $(document).find('.file-info').addClass('disabled');
                                    //check the total size
                                    let totalSize = 0;
                                    if ($(this).prop("checked")) {
                                        let $current = $(this);
                                        $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                            // totalSize = parseInt($(this).attr("data-file_size"));
                                            totalSize = file.file_attributes.size.filesize;
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                //console.log("size", totalSize)
                                                if (totalSize / Math.pow(1024, 2) > 20) {
                                                    //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                    $($current).prop('checked', false);
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                    Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                } else {
                                                    //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                    if (file.type == "file") {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            'file_type': file.file_attributes.extension,
                                                            'asset_id': asset_id
                                                        };
                                                    } else {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            // 'asset_id': asset_id
                                                        };
                                                    }

                                                    // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                    // askUs.cloud_uploading_files.push(data);
                                                    // }
                                                }
                                            }
                                        });
                                    } else {
                                        //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                        // //console.log("12345", askUs.cloud_uploading_files)
                                        if (totalSize > 0) {
                                            totalSize -= parseInt($(this).attr("data-file_size"));
                                        }
                                    }

                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                        $(this).prop('checked', false);
                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                            $(document).find('.file-info').removeClass('disabled');
                                        }
                                        Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                    }
                                } else {
                                    //console.log("not supported file");
                                    $(this).prop('checked', false);
                                    Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                }
                            } else {
                                //console.log("file extension is undefined");
                            }
                        } else {
                            //console.log("file is thrashed");
                        }
                    })
                } else {
                    var relative_name = $(this).attr('data-relative');
                    // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                    $(document).find('.file-info').removeClass('disabled');
                    $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                }
            } else {
                $(this).prop('checked', false);
                Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
            }
        } else if ($('body').attr('app') == "customer_groups_details") {
            //can upload only 1    
            if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                    $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                    var asset_id = $(this).attr('data-asset_id');
                    getAssetDetailsCloud(asset_id).then((file) => {
                        if (file.is_trashed == false) {
                            supported_types = config.identityPictureFileFormat;
                            // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                            if (file.file_attributes.extension != undefined) {
                                if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                    //console.log("file is supported");
                                    $(document).find('.file-info').addClass('disabled');
                                    //check the total size
                                    let totalSize = 0;
                                    if ($(this).prop("checked")) {
                                        let $current = $(this);
                                        $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                            // totalSize = parseInt($(this).attr("data-file_size"));
                                            totalSize = file.file_attributes.size.filesize;
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                //console.log("size", totalSize)
                                                if (totalSize / Math.pow(1024, 2) > 20) {
                                                    //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                    $($current).prop('checked', false);
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                    Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                    // askUs.cloud_uploading_files.filter((e) => {
                                                    //     return e != $(this).attr('data-asset_id');
                                                    // })
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                } else {
                                                    //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                    if (file.type == "file") {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            'file_type': file.file_attributes.extension,
                                                            'asset_id': asset_id
                                                        };
                                                    } else {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            // 'asset_id': asset_id
                                                        };
                                                    }

                                                    // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                    // askUs.cloud_uploading_files.push(data);
                                                    // }
                                                }
                                            }
                                        });
                                    } else {
                                        //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                        // //console.log("12345", askUs.cloud_uploading_files)
                                        if (totalSize > 0) {
                                            totalSize -= parseInt($(this).attr("data-file_size"));
                                        }
                                    }

                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                        $(this).prop('checked', false);
                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                            $(document).find('.file-info').removeClass('disabled');
                                        }
                                        Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                    }
                                } else {
                                    //console.log("not supported file");
                                    $(this).prop('checked', false);
                                    Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                }
                            } else {
                                //console.log("file extension is undefined");
                            }
                        } else {
                            //console.log("file is thrashed");
                        }
                    })
                } else {
                    var relative_name = $(this).attr('data-relative');
                    // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                    $(document).find('.file-info').removeClass('disabled');
                    $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                }
            } else {
                $(this).prop('checked', false);
                Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
            }
        } else if (sessionStorage.getItem('customer_id')) {
            if ($('#edit-associate-customer-modal').length > 0) {//for associate-customer
                //can upload only 1   
                if (sessionStorage.getItem('associate_customer_upload_for') == "associate_customer_identity_video") {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getAssetDetailsCloud(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.multimediaVideoFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                } else {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getAssetDetailsCloud(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.identityPictureFileFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                }
            } else {//for customer
                //can upload only 1    
                if (sessionStorage.getItem('customer_upload_for') == "customer_identity_video") {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getAssetDetailsCloud(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.multimediaVideoFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                } else {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getAssetDetailsCloud(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.identityPictureFileFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                }
            }
        } else if (sessionStorage.getItem('employee_id')) {
            //can upload only 1   
            if (sessionStorage.getItem('employee_upload_for') == "employee_identity_video") {//employee identity video
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getAssetDetailsCloud(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.multimediaVideoFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // askUs.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // askUs.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", askUs.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else {//employee identity picture
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getAssetDetailsCloud(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.identityPictureFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // askUs.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // askUs.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", askUs.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            }
        } else if (sessionStorage.getItem('business_id')) {
            if (sessionStorage.getItem('cloud_upload_for')) {//is used in declaration(transaction/signature)
                //can upload only 1    
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getAssetDetailsCloud(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.identityPictureFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // digibiz.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // digibiz.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else if (sessionStorage.getItem('business_upload_for') == "business_display_picture") { //business display picture
                //can upload only 1    
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getAssetDetailsCloud(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.identityPictureFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // digibiz.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // digibiz.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else if (sessionStorage.getItem('business_upload_for') == "business_identity_video") {//business identity video
                //can upload only 1    
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getAssetDetailsCloud(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.multimediaVideoFormat;
                                console.log("supported_types", supported_types);
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // digibiz.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // digibiz.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else {
                var getCloudUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
                //console.log("getCloudUploadTo", getCloudUploadTo);
                if ($(this).is(':checked')) {
                    //console.log("checked");
                } else {
                    //console.log("not-checked");
                }
                if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="individualFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getAssetDetailsCloud(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.attachmentFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="individualFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');

                                                        // if (getCloudUploadTo == "identity-proof-load-btn") {
                                                        //     digibiz.id_proof_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "pancard-load-btn") {
                                                        //     digibiz.pan_card_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                                                        //     digibiz.shop_established_licence_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "gst-license-load-btn") {
                                                        //     digibiz.gst_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                                                        //     digibiz.partnership_deed_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                                                        //     digibiz.partnership_registration_certificate_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                                                        //     digibiz.llp_registration_certificate_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                                                        //     digibiz.transaction_person_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                                                        //     digibiz.memorandum_of_association_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                                                        //     digibiz.articles_of_association_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                                                        //     digibiz.trust_established_licence_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // }
                                                        digibiz.cloud_uploading_files.filter((e) => {
                                                            return e != $(this).attr('data-asset_id');
                                                        })
                                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        if (!(sessionStorage.getItem('share_owner_id'))) {
                                                            // if (getCloudUploadTo == "identity-proof-load-btn") {
                                                            //     digibiz.id_proof_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "pancard-load-btn") {
                                                            //     digibiz.pan_card_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                                                            //     digibiz.shop_established_licence_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "gst-license-load-btn") {
                                                            //     digibiz.gst_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                                                            //     digibiz.partnership_deed_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                                                            //     digibiz.partnership_registration_certificate_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                                                            //     digibiz.llp_registration_certificate_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                                                            //     digibiz.transaction_person_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                                                            //     digibiz.memorandum_of_association_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                                                            //     digibiz.articles_of_association_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                                                            //     digibiz.trust_established_licence_selected_files.push(data)
                                                            // }
                                                            // localStorage.setItem('selected_files', JSON.stringify(digibiz.uploadingFiles));
                                                            digibiz.cloud_uploading_files.push(data);
                                                        }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // if (getCloudUploadTo == "identity-proof-load-btn") {
                                            //     //console.log("11");
                                            //     digibiz.id_proof_selected_files.filter((e) => { //console.log("e", e.real_name, file.file_attributes.name.real); return e.real_name !== file.file_attributes.name.real });
                                            //     //console.log("after filter", digibiz.id_proof_selected_files);
                                            // } else if (getCloudUploadTo == "pancard-load-btn") {
                                            //     digibiz.pan_card_selected_files.filter((e) => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                                            //     digibiz.shop_established_licence_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "gst-license-load-btn") {
                                            //     digibiz.gst_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                                            //     digibiz.partnership_deed_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                                            //     digibiz.partnership_registration_certificate_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                                            //     digibiz.llp_registration_certificate_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                                            //     digibiz.transaction_person_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                                            //     digibiz.memorandum_of_association_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                                            //     digibiz.articles_of_association_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                                            //     digibiz.trust_established_licence_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // }
                                            // digibiz.uploadingFiles = digibiz.uploadingFiles.filter(e => e.real_name != file.file_attributes.name.real);
                                            // localStorage.removeItem('selected_files');
                                            // localStorage.setItem('selected_files', JSON.stringify(digibiz.uploadingFiles));
                                            // digibiz.cloud_multimedia_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // digibiz.cloud_multimedia_selected_files.filter((e) => {
                                            //     //console.log("ee", e, e.real_name, typeof e.real_name, file.file_attributes.name.real, typeof file.file_attributes.name.real);
                                            //     return e.real_name != file.file_attributes.name.real;
                                            // })
                                            digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="individualFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file at a time', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // if (getCloudUploadTo == "identity-proof-load-btn") {
                        //     digibiz.id_proof_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "pancard-load-btn") {
                        //     digibiz.pan_card_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                        //     digibiz.shop_established_licence_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "gst-license-load-btn") {
                        //     digibiz.gst_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                        //     digibiz.partnership_deed_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                        //     digibiz.partnership_registration_certificate_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                        //     digibiz.llp_registration_certificate_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                        //     digibiz.transaction_person_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                        //     digibiz.memorandum_of_association_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                        //     digibiz.articles_of_association_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                        //     digibiz.trust_established_licence_selected_files.filter(e => e.relative_name != relative_name);
                        // }
                        digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can not select more than 1 file", 3000, 'rounded error-alert');
                }
            }
        }
    });

    $(document).on('click', "input[name='digibizFilemanagerFileSelection[]']", function (event) {
        event.stopPropagation();
        if ($('body').attr('app') == "digibiz_credentials") {
            //can upload only 1    
            if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                    $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                    var asset_id = $(this).attr('data-asset_id');
                    getDigibizAssetDetails(asset_id).then((file) => {
                        if (file.is_trashed == false) {
                            supported_types = config.identityPictureFileFormat;
                            // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                            if (file.file_attributes.extension != undefined) {
                                if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                    //console.log("file is supported");
                                    $(document).find('.file-info').addClass('disabled');
                                    //check the total size
                                    let totalSize = 0;
                                    if ($(this).prop("checked")) {
                                        let $current = $(this);
                                        $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                            // totalSize = parseInt($(this).attr("data-file_size"));
                                            totalSize = file.file_attributes.size.filesize;
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                //console.log("size", totalSize)
                                                if (totalSize / Math.pow(1024, 2) > 20) {
                                                    //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                    $($current).prop('checked', false);
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                    Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                    // digibiz.cloud_uploading_files.filter((e) => {
                                                    //     return e != $(this).attr('data-asset_id');
                                                    // })
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                } else {
                                                    //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                    if (file.type == "file") {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            'file_type': file.file_attributes.extension,
                                                            'asset_id': asset_id
                                                        };
                                                    } else {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            // 'asset_id': asset_id
                                                        };
                                                    }

                                                    // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                    // digibiz.cloud_uploading_files.push(data);
                                                    // }
                                                }
                                            }
                                        });
                                    } else {
                                        //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                        // //console.log("12345", digibiz.cloud_uploading_files)
                                        if (totalSize > 0) {
                                            totalSize -= parseInt($(this).attr("data-file_size"));
                                        }
                                    }

                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                        $(this).prop('checked', false);
                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                            $(document).find('.file-info').removeClass('disabled');
                                        }
                                        Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                    }
                                } else {
                                    //console.log("not supported file");
                                    $(this).prop('checked', false);
                                    Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                }
                            } else {
                                //console.log("file extension is undefined");
                            }
                        } else {
                            //console.log("file is thrashed");
                        }
                    })
                } else {
                    var relative_name = $(this).attr('data-relative');
                    // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                    $(document).find('.file-info').removeClass('disabled');
                    $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                }
            } else {
                $(this).prop('checked', false);
                Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
            }
        } else if ($('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_create" || $('body').attr('app') == "collaborator_group_details") {
            //can upload only 1    
            if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                    $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                    var asset_id = $(this).attr('data-asset_id');
                    getDigibizAssetDetails(asset_id).then((file) => {
                        if (file.is_trashed == false) {
                            supported_types = config.identityPictureFileFormat;
                            // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                            if (file.file_attributes.extension != undefined) {
                                if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                    //console.log("file is supported");
                                    $(document).find('.file-info').addClass('disabled');
                                    //check the total size
                                    let totalSize = 0;
                                    if ($(this).prop("checked")) {
                                        let $current = $(this);
                                        $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                            // totalSize = parseInt($(this).attr("data-file_size"));
                                            totalSize = file.file_attributes.size.filesize;
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                //console.log("size", totalSize)
                                                if (totalSize / Math.pow(1024, 2) > 20) {
                                                    //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                    $($current).prop('checked', false);
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                    Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                } else {
                                                    //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                    if (file.type == "file") {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            'file_type': file.file_attributes.extension,
                                                            'asset_id': asset_id
                                                        };
                                                    } else {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            // 'asset_id': asset_id
                                                        };
                                                    }

                                                    // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                    // askUs.cloud_uploading_files.push(data);
                                                    // }
                                                }
                                            }
                                        });
                                    } else {
                                        //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                        // //console.log("12345", askUs.cloud_uploading_files)
                                        if (totalSize > 0) {
                                            totalSize -= parseInt($(this).attr("data-file_size"));
                                        }
                                    }

                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                        $(this).prop('checked', false);
                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                            $(document).find('.file-info').removeClass('disabled');
                                        }
                                        Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                    }
                                } else {
                                    //console.log("not supported file");
                                    $(this).prop('checked', false);
                                    Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                }
                            } else {
                                //console.log("file extension is undefined");
                            }
                        } else {
                            //console.log("file is thrashed");
                        }
                    })
                } else {
                    var relative_name = $(this).attr('data-relative');
                    // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                    $(document).find('.file-info').removeClass('disabled');
                    $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                }
            } else {
                $(this).prop('checked', false);
                Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
            }
        } else if ($('body').attr('app') == "customer_groups_details") {
            //can upload only 1    
            if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                    $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                    var asset_id = $(this).attr('data-asset_id');
                    getDigibizAssetDetails(asset_id).then((file) => {
                        if (file.is_trashed == false) {
                            supported_types = config.identityPictureFileFormat;
                            // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                            if (file.file_attributes.extension != undefined) {
                                if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                    //console.log("file is supported");
                                    $(document).find('.file-info').addClass('disabled');
                                    //check the total size
                                    let totalSize = 0;
                                    if ($(this).prop("checked")) {
                                        let $current = $(this);
                                        $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                            // totalSize = parseInt($(this).attr("data-file_size"));
                                            totalSize = file.file_attributes.size.filesize;
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                //console.log("size", totalSize)
                                                if (totalSize / Math.pow(1024, 2) > 20) {
                                                    //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                    $($current).prop('checked', false);
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                    Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                    // askUs.cloud_uploading_files.filter((e) => {
                                                    //     return e != $(this).attr('data-asset_id');
                                                    // })
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                        $(document).find('.file-info').removeClass('disabled');
                                                    }
                                                } else {
                                                    //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                    if (file.type == "file") {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            'file_type': file.file_attributes.extension,
                                                            'asset_id': asset_id
                                                        };
                                                    } else {
                                                        data = {
                                                            'real_name': file.file_attributes.name.real,
                                                            'type': file.type,
                                                            'relative_name': file.file_attributes.name.relative,
                                                            // 'asset_id': asset_id
                                                        };
                                                    }

                                                    // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                    // askUs.cloud_uploading_files.push(data);
                                                    // }
                                                }
                                            }
                                        });
                                    } else {
                                        //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                        // //console.log("12345", askUs.cloud_uploading_files)
                                        if (totalSize > 0) {
                                            totalSize -= parseInt($(this).attr("data-file_size"));
                                        }
                                    }

                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                        $(this).prop('checked', false);
                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                            $(document).find('.file-info').removeClass('disabled');
                                        }
                                        Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                    }
                                } else {
                                    //console.log("not supported file");
                                    $(this).prop('checked', false);
                                    Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                }
                            } else {
                                //console.log("file extension is undefined");
                            }
                        } else {
                            //console.log("file is thrashed");
                        }
                    })
                } else {
                    var relative_name = $(this).attr('data-relative');
                    // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                    $(document).find('.file-info').removeClass('disabled');
                    $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                }
            } else {
                $(this).prop('checked', false);
                Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
            }
        } else if (sessionStorage.getItem('customer_id')) {
            if ($('#edit-associate-customer-modal').length > 0) {//associate-customer
                //can upload only 1    
                if (sessionStorage.getItem('associate_customer_upload_for') == "associate_customer_identity_video") {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getDigibizAssetDetails(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.multimediaVideoFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                } else {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getDigibizAssetDetails(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.identityPictureFileFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                }
            } else {//customer
                //can upload only 1    
                if (sessionStorage.getItem('customer_upload_for') == "customer_identity_video") {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getDigibizAssetDetails(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.multimediaVideoFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                } else {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                        if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                            $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                            var asset_id = $(this).attr('data-asset_id');
                            getDigibizAssetDetails(asset_id).then((file) => {
                                if (file.is_trashed == false) {
                                    supported_types = config.identityPictureFileFormat;
                                    // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                    if (file.file_attributes.extension != undefined) {
                                        if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                            //console.log("file is supported");
                                            $(document).find('.file-info').addClass('disabled');
                                            //check the total size
                                            let totalSize = 0;
                                            if ($(this).prop("checked")) {
                                                let $current = $(this);
                                                $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                    // totalSize = parseInt($(this).attr("data-file_size"));
                                                    totalSize = file.file_attributes.size.filesize;
                                                    if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                        //console.log("size", totalSize)
                                                        if (totalSize / Math.pow(1024, 2) > 20) {
                                                            //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                            $($current).prop('checked', false);
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                            Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                            // askUs.cloud_uploading_files.filter((e) => {
                                                            //     return e != $(this).attr('data-asset_id');
                                                            // })
                                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                                $(document).find('.file-info').removeClass('disabled');
                                                            }
                                                        } else {
                                                            //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                            if (file.type == "file") {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    'file_type': file.file_attributes.extension,
                                                                    'asset_id': asset_id
                                                                };
                                                            } else {
                                                                data = {
                                                                    'real_name': file.file_attributes.name.real,
                                                                    'type': file.type,
                                                                    'relative_name': file.file_attributes.name.relative,
                                                                    // 'asset_id': asset_id
                                                                };
                                                            }

                                                            // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                            // askUs.cloud_uploading_files.push(data);
                                                            // }
                                                        }
                                                    }
                                                });
                                            } else {
                                                //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                                // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                                // //console.log("12345", askUs.cloud_uploading_files)
                                                if (totalSize > 0) {
                                                    totalSize -= parseInt($(this).attr("data-file_size"));
                                                }
                                            }

                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                                $(this).prop('checked', false);
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                    $(document).find('.file-info').removeClass('disabled');
                                                }
                                                Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                            }
                                        } else {
                                            //console.log("not supported file");
                                            $(this).prop('checked', false);
                                            Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                        }
                                    } else {
                                        //console.log("file extension is undefined");
                                    }
                                } else {
                                    //console.log("file is thrashed");
                                }
                            })
                        } else {
                            var relative_name = $(this).attr('data-relative');
                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                            $(document).find('.file-info').removeClass('disabled');
                            $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                        }
                    } else {
                        $(this).prop('checked', false);
                        Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                    }
                }
            }
        } else if (sessionStorage.getItem('employee_id')) {
            //can upload only 1    
            if (sessionStorage.getItem('employee_upload_for') == "employee_identity_video") {//employee identity Video
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getDigibizAssetDetails(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.multimediaVideoFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // askUs.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // askUs.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", askUs.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else {//employee identity picture
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getDigibizAssetDetails(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.identityPictureFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // askUs.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // askUs.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", askUs.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // askUs.cloud_uploading_files = askUs.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            }
        } else if (sessionStorage.getItem('business_id')) {
            if (sessionStorage.getItem('cloud_upload_for')) {//is used in declaration(transaction/signature)
                //can upload only 1    
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getDigibizAssetDetails(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.identityPictureFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // digibiz.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // digibiz.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else if (sessionStorage.getItem('business_upload_for') == "business_display_picture") { //business display picture
                //can upload only 1    
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getDigibizAssetDetails(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.identityPictureFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // digibiz.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // digibiz.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else if (sessionStorage.getItem('business_upload_for') == "business_identity_video") {
                //can upload only 1    
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getDigibizAssetDetails(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.multimediaVideoFormat;
                                console.log("supported_types", supported_types);
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');
                                                        // digibiz.cloud_uploading_files.filter((e) => {
                                                        //     return e != $(this).attr('data-asset_id');
                                                        // })
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        // if (!(sessionStorage.getItem('share_owner_id'))) {                                                   
                                                        // digibiz.cloud_uploading_files.push(data);
                                                        // }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            // //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
                                        }
                                    } else {
                                        console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can select only 1 file", 3000, 'rounded error-alert');
                }
            } else {
                var getCloudUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
                //console.log("getCloudUploadTo", getCloudUploadTo);
                if ($(this).is(':checked')) {
                    //console.log("checked");
                } else {
                    //console.log("not-checked");
                }
                if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length <= 1) {
                    if ($(document).find('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 0) {
                        $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                        var asset_id = $(this).attr('data-asset_id');
                        getDigibizAssetDetails(asset_id).then((file) => {
                            if (file.is_trashed == false) {
                                supported_types = config.attachmentFileFormat;
                                // supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
                                if (file.file_attributes.extension != undefined) {
                                    if (supported_types.includes(file.file_attributes.extension.toLowerCase())) {
                                        //console.log("file is supported");
                                        $(document).find('.file-info').addClass('disabled');
                                        //check the total size
                                        let totalSize = 0;
                                        if ($(this).prop("checked")) {
                                            let $current = $(this);
                                            $.each($('input[name="digibizFilemanagerFileSelection[]"]:checked'), function (index, value) {
                                                // totalSize = parseInt($(this).attr("data-file_size"));
                                                totalSize = file.file_attributes.size.filesize;
                                                if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == index + 1) {
                                                    //console.log("size", totalSize)
                                                    if (totalSize / Math.pow(1024, 2) > 20) {
                                                        //console.log("size check error", totalSize / Math.pow(1024, 2))
                                                        $($current).prop('checked', false);
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                        Materialize.toast('You can select maximum 20 MB at a time', 4000, 'round error-alert');

                                                        // if (getCloudUploadTo == "identity-proof-load-btn") {
                                                        //     digibiz.id_proof_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "pancard-load-btn") {
                                                        //     digibiz.pan_card_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                                                        //     digibiz.shop_established_licence_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "gst-license-load-btn") {
                                                        //     digibiz.gst_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                                                        //     digibiz.partnership_deed_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                                                        //     digibiz.partnership_registration_certificate_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                                                        //     digibiz.llp_registration_certificate_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                                                        //     digibiz.transaction_person_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                                                        //     digibiz.memorandum_of_association_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                                                        //     digibiz.articles_of_association_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                                                        //     digibiz.trust_established_licence_selected_files.filter((e) => {
                                                        //         return e != $(this).attr('data-asset_id');
                                                        //     })
                                                        // }
                                                        digibiz.cloud_uploading_files.filter((e) => {
                                                            return e != $(this).attr('data-asset_id');
                                                        })
                                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                            $(document).find('.file-info').removeClass('disabled');
                                                        }
                                                    } else {
                                                        //console.log("size check coorect", totalSize / Math.pow(1024, 2))
                                                        if (file.type == "file") {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                'file_type': file.file_attributes.extension,
                                                                'asset_id': asset_id
                                                            };
                                                        } else {
                                                            data = {
                                                                'real_name': file.file_attributes.name.real,
                                                                'type': file.type,
                                                                'relative_name': file.file_attributes.name.relative,
                                                                // 'asset_id': asset_id
                                                            };
                                                        }

                                                        if (!(sessionStorage.getItem('share_owner_id'))) {
                                                            // if (getCloudUploadTo == "identity-proof-load-btn") {
                                                            //     digibiz.id_proof_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "pancard-load-btn") {
                                                            //     digibiz.pan_card_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                                                            //     digibiz.shop_established_licence_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "gst-license-load-btn") {
                                                            //     digibiz.gst_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                                                            //     digibiz.partnership_deed_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                                                            //     digibiz.partnership_registration_certificate_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                                                            //     digibiz.llp_registration_certificate_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                                                            //     digibiz.transaction_person_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                                                            //     digibiz.memorandum_of_association_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                                                            //     digibiz.articles_of_association_selected_files.push(data)
                                                            // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                                                            //     digibiz.trust_established_licence_selected_files.push(data)
                                                            // }
                                                            // localStorage.setItem('selected_files', JSON.stringify(digibiz.uploadingFiles));
                                                            digibiz.cloud_uploading_files.push(data);
                                                        }
                                                    }
                                                }
                                            });
                                        } else {
                                            //console.log("inside not checked remove from global", file.file_attributes.name.real, typeof (file.file_attributes.name.real));
                                            // if (getCloudUploadTo == "identity-proof-load-btn") {
                                            //     //console.log("11");
                                            //     digibiz.id_proof_selected_files.filter((e) => { //console.log("e", e.real_name, file.file_attributes.name.real); return e.real_name !== file.file_attributes.name.real });
                                            //     //console.log("after filter", digibiz.id_proof_selected_files);
                                            // } else if (getCloudUploadTo == "pancard-load-btn") {
                                            //     digibiz.pan_card_selected_files.filter((e) => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                                            //     digibiz.shop_established_licence_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "gst-license-load-btn") {
                                            //     digibiz.gst_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                                            //     digibiz.partnership_deed_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                                            //     digibiz.partnership_registration_certificate_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                                            //     digibiz.llp_registration_certificate_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                                            //     digibiz.transaction_person_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                                            //     digibiz.memorandum_of_association_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                                            //     digibiz.articles_of_association_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                                            //     digibiz.trust_established_licence_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // }
                                            // digibiz.uploadingFiles = digibiz.uploadingFiles.filter(e => e.real_name != file.file_attributes.name.real);
                                            // localStorage.removeItem('selected_files');
                                            // localStorage.setItem('selected_files', JSON.stringify(digibiz.uploadingFiles));
                                            // digibiz.cloud_multimedia_selected_files.filter(e => e.real_name != file.file_attributes.name.real);
                                            // digibiz.cloud_multimedia_selected_files.filter((e) => {
                                            //     //console.log("ee", e, e.real_name, typeof e.real_name, file.file_attributes.name.real, typeof file.file_attributes.name.real);
                                            //     return e.real_name != file.file_attributes.name.real;
                                            // })
                                            digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.real_name !== file.file_attributes.name.real)
                                            //console.log("12345", digibiz.cloud_uploading_files)
                                            if (totalSize > 0) {
                                                totalSize -= parseInt($(this).attr("data-file_size"));
                                            }
                                        }

                                        if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length > 5) {
                                            $(this).prop('checked', false);
                                            if ($('input[name="digibizFilemanagerFileSelection[]"]:checked').length == 0) {
                                                $(document).find('.file-info').removeClass('disabled');
                                            }
                                            Materialize.toast('You can select only 1 file at a time', 4000, 'round error-alert');
                                        }
                                    } else {
                                        //console.log("not supported file");
                                        $(this).prop('checked', false);
                                        Materialize.toast("Unsupported File " + file.file_attributes.name.relative, 3000, 'rounded error-alert');
                                    }
                                } else {
                                    //console.log("file extension is undefined");
                                }
                            } else {
                                //console.log("file is thrashed");
                            }
                        })
                    } else {
                        var relative_name = $(this).attr('data-relative');
                        // if (getCloudUploadTo == "identity-proof-load-btn") {
                        //     digibiz.id_proof_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "pancard-load-btn") {
                        //     digibiz.pan_card_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "shop-established-license-load-btn") {
                        //     digibiz.shop_established_licence_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "gst-license-load-btn") {
                        //     digibiz.gst_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "partnership-deed-load-btn") {
                        //     digibiz.partnership_deed_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "partnership-registration-certificate-load-btn") {
                        //     digibiz.partnership_registration_certificate_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "llp-registration-certificate-load-btn") {
                        //     digibiz.llp_registration_certificate_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "transaction-person-load-btn") {
                        //     digibiz.transaction_person_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "memorandum-of-association-load-btn") {
                        //     digibiz.memorandum_of_association_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "articles-of-association-load-btn") {
                        //     digibiz.articles_of_association_selected_files.filter(e => e.relative_name != relative_name);
                        // } else if (getCloudUploadTo == "trust-establishment-license-load-btn") {
                        //     digibiz.trust_established_licence_selected_files.filter(e => e.relative_name != relative_name);
                        // }
                        digibiz.cloud_uploading_files = digibiz.cloud_uploading_files.filter(item => item.relative_name !== relative_name)
                        $(document).find('.file-info').removeClass('disabled');
                        $('.filemanger_container_toggle').find('.grid-view-container').removeClass('edit-mode');
                    }
                } else {
                    $(this).prop('checked', false);
                    Materialize.toast("You can not select more than 1 file", 3000, 'rounded error-alert');
                }
            }
        }
    });


    $(document).on('click', '#attach_file_btn', function (e) {
        e.stopPropagation();
        //close side bar
        if ($('#filemanger_container_toggle').hasClass('active')) {
            $('#filemanger_container_toggle').removeClass('active');
        }
        if (sessionStorage.getItem('individual_assets')) {
            if ($('body').attr('app') == "digibiz_credentials") {
                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                    //get selected files
                    var asset_ids = [];
                    $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                        asset_ids.push($(element).attr('data-asset_id'));

                        //show loader in thubnail area
                        $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                        //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                        if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                            getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                if (file.is_trashed == false) {
                                    individualStartFileSession(file, 'view').then(async (sessionData) => {
                                        if (sessionData) {
                                            $('.filemanger_container_toggle').removeClass('active');
                                            window.sessionStorage.removeItem('breadcrumb_path');
                                            //NOTEE===> cropper modal is in the 'digibiz-filemanager' click event
                                            setTimeout(function () {
                                                var image = document.getElementById('image_cropper');
                                                image.src = sessionData.url;
                                                //console.log("image.src", image.src);
                                                $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                digibiz.cropper = new Cropper(image, {
                                                    viewMode: 2,
                                                    aspectRatio: 1 / 1,
                                                    minContainerWidth: 72,
                                                    minContainerHeight: 72,
                                                    minCropBoxWidth: 72,
                                                    minCropBoxHeight: 72,
                                                    maxWidth: 100,
                                                    maxHeight: 400,
                                                    zoomable: true,
                                                    rotatable: true,
                                                    responsive: true,
                                                    movable: true,
                                                    ready: function () {
                                                        //cropper.zoom(-0.6);
                                                    }
                                                });
                                            }, 300);
                                        }
                                    }).catch((err) => {
                                        if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                            $('#upload-preview-close-btn').click();
                                        }
                                        //console.log(err);
                                    });
                                } else {
                                    $("#upload-file-preview").html('Selected asset is deleted');
                                    $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                }

                            }).catch((err) => {
                                //console.log(err);
                            });
                        }
                    });
                } else {
                    Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                    $('.filemanger_container_toggle').addClass('active');
                }
            } else if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details" || $('body').attr('app') == "collaborator_group_create") {
                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                    //get selected files
                    var asset_ids = [];
                    $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                        asset_ids.push($(element).attr('data-asset_id'));

                        //show loader in thubnail area
                        $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                        //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                        if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                            getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                if (file.is_trashed == false) {
                                    individualStartFileSession(file, 'view').then(async (sessionData) => {
                                        if (sessionData) {
                                            //console.log("sessionData", sessionData);
                                            $('.filemanger_container_toggle').removeClass('active');
                                            window.sessionStorage.removeItem('breadcrumb_path');
                                            var modal_data = {
                                                modal_platform: crossplat.device.platform,
                                                modal_id: "group-image-modal",
                                                modal_header: "",
                                                modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                modal_action_buttons: [{
                                                    id: "group-image-crop-button",
                                                    name: `crop`,
                                                    attr: [{
                                                        name: "data-id",
                                                        value: ''
                                                    }]
                                                }]
                                            }
                                            showModal(modal_data, function () {
                                                removeLoader();
                                                // if ($('.modal-popup-content').length > 0) {
                                                //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                //         //console.log("scroll initiated for modal pop-up class")
                                                //         appScroll.scrollBar('.modal-popup-content');
                                                //     }
                                                // }
                                                $('#group-image-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                $('#group-image-modal').attr('picture-type', 'group_image');
                                            });
                                            setTimeout(function () {
                                                var image = document.getElementById('image_cropper');
                                                image.src = sessionData.url;
                                                //console.log("image.src", image.src);
                                                $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                digibiz.cropper = new Cropper(image, {
                                                    viewMode: 2,
                                                    aspectRatio: 1 / 1,
                                                    minContainerWidth: 72,
                                                    minContainerHeight: 72,
                                                    minCropBoxWidth: 72,
                                                    minCropBoxHeight: 72,
                                                    maxWidth: 100,
                                                    maxHeight: 400,
                                                    zoomable: true,
                                                    rotatable: true,
                                                    responsive: true,
                                                    movable: true,
                                                    ready: function () {
                                                        //cropper.zoom(-0.6);
                                                    }
                                                });
                                            }, 300);
                                        }
                                    }).catch((err) => {
                                        if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                            $('#upload-preview-close-btn').click();
                                        }
                                        //console.log(err);
                                    });
                                } else {
                                    $("#upload-file-preview").html('Selected asset is deleted');
                                    $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                }

                            }).catch((err) => {
                                //console.log(err);
                            });
                        }
                    });
                } else {
                    Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                    $('.filemanger_container_toggle').addClass('active');
                }
            } else if (sessionStorage.getItem('customer_id')) {
                if ($('#edit-associate-customer-modal').length > 0) {//for associate-customer
                    if (sessionStorage.getItem('associate_customer_upload_for') == "associate_customer_identity_video") {
                        //console.log("inside edit modal");
                        if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                                if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                    getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            individualStartFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    getBlobFromURL(sessionData.url).then((blob) => {
                                                        console.log("blob", blob);
                                                        //create object urls
                                                        // digibiz.objectURLS = [];
                                                        // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                        var reader = new FileReader;
                                                        reader.onloadend = function () {
                                                            generateThubnail(this.result, 'base64').then((thubnail) => {
                                                                digibiz.fileObject = {};
                                                                var fileObj = {
                                                                    // file: files[0],
                                                                    identifier: (new Date()).getTime(),
                                                                    fileURI: URL.createObjectURL(blob),
                                                                    file_type: sessionData.file_type,
                                                                    // file_name: files[0].name,
                                                                    file_content_base64: this.result,
                                                                    thubnail: thubnail
                                                                }
                                                                digibiz.fileObject = fileObj;
                                                                console.log("digibiz.fileObject", digibiz.fileObject);
                                                                fetch.getHtml(function (fetcherror, html) {
                                                                    //console.log("got html")
                                                                    var modal_data = {
                                                                        modal_platform: crossplat.device.platform,
                                                                        modal_id: "identity-video-modal",
                                                                        modal_header: "",
                                                                        modal_body: html,
                                                                        modal_action_buttons: [{
                                                                            id: "identity-video-confirm",
                                                                            name: `Confirm`,
                                                                            attr: [{
                                                                                name: "data-id",
                                                                                value: "associate-customer"
                                                                            }]
                                                                        }]
                                                                    }
                                                                    showModal(modal_data, function () {
                                                                        //console.log("modal added");
                                                                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                            if ($('.modal-popup-content').length > 0) {
                                                                                //console.log("scroll initiated for modal pop-up class")
                                                                                appScroll.scrollBar('.modal-popup-content');
                                                                            }
                                                                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                        } else {
                                                                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                        }
                                                                        var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                        console.log("previewContent", previewContent);
                                                                        //append multimedia
                                                                        $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                    });
                                                                    removeLoader();

                                                                }, 'page/common/identity_video', '#identity-video-template', null);
                                                            });
                                                        }
                                                        reader.readAsDataURL(blob);
                                                    })
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    } else {
                        //console.log("inside edit modal");
                        if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                                if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                    getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            individualStartFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    var modal_data = {
                                                        modal_platform: crossplat.device.platform,
                                                        modal_id: "associate-customer-identity-picture-modal",
                                                        modal_header: "",
                                                        modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                        modal_action_buttons: [{
                                                            id: "associate-customer-identity-crop-button",
                                                            name: `crop`,
                                                            attr: [{
                                                                name: "data-id",
                                                                value: ''
                                                            }]
                                                        }]
                                                    }
                                                    showModal(modal_data, function () {
                                                        removeLoader();
                                                        // if ($('.modal-popup-content').length > 0) {
                                                        //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                        //         //console.log("scroll initiated for modal pop-up class")
                                                        //         appScroll.scrollBar('.modal-popup-content');
                                                        //     }
                                                        // }
                                                        $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                        $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
                                                    });
                                                    setTimeout(function () {
                                                        var image = document.getElementById('image_cropper');
                                                        image.src = sessionData.url;
                                                        //console.log("image.src", image.src);
                                                        $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                        digibiz.cropper = new Cropper(image, {
                                                            viewMode: 2,
                                                            aspectRatio: 1 / 1,
                                                            minContainerWidth: 72,
                                                            minContainerHeight: 72,
                                                            minCropBoxWidth: 72,
                                                            minCropBoxHeight: 72,
                                                            maxWidth: 100,
                                                            maxHeight: 400,
                                                            zoomable: true,
                                                            rotatable: true,
                                                            responsive: true,
                                                            movable: true,
                                                            ready: function () {
                                                                //cropper.zoom(-0.6);
                                                            }
                                                        });
                                                    }, 300);
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    }
                } else {//for customer
                    if (sessionStorage.getItem('customer_upload_for') == "customer_identity_video") {
                        if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                                if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                    getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            individualStartFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    getBlobFromURL(sessionData.url).then((blob) => {
                                                        console.log("blob", blob);
                                                        //create object urls
                                                        // digibiz.objectURLS = [];
                                                        // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                        var reader = new FileReader;
                                                        reader.onloadend = function () {
                                                            generateThubnail(this.result, 'base64').then((thubnail) => {
                                                                digibiz.fileObject = {};
                                                                var fileObj = {
                                                                    // file: files[0],
                                                                    identifier: (new Date()).getTime(),
                                                                    fileURI: URL.createObjectURL(blob),
                                                                    file_type: sessionData.file_type,
                                                                    // file_name: files[0].name,
                                                                    file_content_base64: this.result,
                                                                    thubnail: thubnail
                                                                }
                                                                digibiz.fileObject = fileObj;
                                                                console.log("digibiz.fileObject", digibiz.fileObject);
                                                                fetch.getHtml(function (fetcherror, html) {
                                                                    //console.log("got html")
                                                                    var modal_data = {
                                                                        modal_platform: crossplat.device.platform,
                                                                        modal_id: "identity-video-modal",
                                                                        modal_header: "",
                                                                        modal_body: html,
                                                                        modal_action_buttons: [{
                                                                            id: "identity-video-confirm",
                                                                            name: `Confirm`,
                                                                            attr: [{
                                                                                name: "data-id",
                                                                                value: "customer"
                                                                            }]
                                                                        }]
                                                                    }
                                                                    showModal(modal_data, function () {
                                                                        //console.log("modal added");
                                                                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                            if ($('.modal-popup-content').length > 0) {
                                                                                //console.log("scroll initiated for modal pop-up class")
                                                                                appScroll.scrollBar('.modal-popup-content');
                                                                            }
                                                                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                        } else {
                                                                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                        }
                                                                        var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                        console.log("previewContent", previewContent);
                                                                        //append multimedia
                                                                        $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                    });
                                                                    removeLoader();

                                                                }, 'page/common/identity_video', '#identity-video-template', null);
                                                            });
                                                        }
                                                        reader.readAsDataURL(blob);
                                                    })
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    } else {
                        if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                                if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                    getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            individualStartFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    var modal_data = {
                                                        modal_platform: crossplat.device.platform,
                                                        modal_id: "customer-identity-picture-modal",
                                                        modal_header: "",
                                                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                        modal_action_buttons: [{
                                                            id: "customer-identity-crop-button",
                                                            name: `crop`,
                                                            attr: [{
                                                                name: "data-id",
                                                                value: ''
                                                            }]
                                                        }]
                                                    }
                                                    showModal(modal_data, function () {
                                                        removeLoader();
                                                        // if ($('.modal-popup-content').length > 0) {
                                                        //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                        //         //console.log("scroll initiated for modal pop-up class")
                                                        //         appScroll.scrollBar('.modal-popup-content');
                                                        //     }
                                                        // }
                                                        $('#customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                        $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
                                                    });
                                                    setTimeout(function () {
                                                        var image = document.getElementById('image_cropper');
                                                        image.src = sessionData.url;
                                                        //console.log("image.src", image.src);
                                                        $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                        digibiz.cropper = new Cropper(image, {
                                                            viewMode: 2,
                                                            aspectRatio: 1 / 1,
                                                            minContainerWidth: 72,
                                                            minContainerHeight: 72,
                                                            minCropBoxWidth: 72,
                                                            minCropBoxHeight: 72,
                                                            maxWidth: 100,
                                                            maxHeight: 400,
                                                            zoomable: true,
                                                            rotatable: true,
                                                            responsive: true,
                                                            movable: true,
                                                            ready: function () {
                                                                //cropper.zoom(-0.6);
                                                            }
                                                        });
                                                    }, 300);
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    }

                }
            } else if (sessionStorage.getItem('employee_id')) {
                if (sessionStorage.getItem('employee_upload_for') == "employee_identity_video") {//employee identity video
                    if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        individualStartFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                getBlobFromURL(sessionData.url).then((blob) => {
                                                    console.log("blob", blob);
                                                    //create object urls
                                                    // digibiz.objectURLS = [];
                                                    // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                    var reader = new FileReader;
                                                    reader.onloadend = function () {
                                                        generateThubnail(this.result, 'base64').then((thubnail) => {
                                                            digibiz.fileObject = {};
                                                            var fileObj = {
                                                                // file: files[0],
                                                                identifier: (new Date()).getTime(),
                                                                fileURI: URL.createObjectURL(blob),
                                                                file_type: sessionData.file_type,
                                                                // file_name: files[0].name,
                                                                file_content_base64: this.result,
                                                                thubnail: thubnail
                                                            }
                                                            digibiz.fileObject = fileObj;
                                                            console.log("digibiz.fileObject", digibiz.fileObject);
                                                            fetch.getHtml(function (fetcherror, html) {
                                                                //console.log("got html")
                                                                var modal_data = {
                                                                    modal_platform: crossplat.device.platform,
                                                                    modal_id: "identity-video-modal",
                                                                    modal_header: "",
                                                                    modal_body: html,
                                                                    modal_action_buttons: [{
                                                                        id: "identity-video-confirm",
                                                                        name: `Confirm`,
                                                                        attr: [{
                                                                            name: "data-id",
                                                                            value: "employee"
                                                                        }]
                                                                    }]
                                                                }
                                                                showModal(modal_data, function () {
                                                                    //console.log("modal added");
                                                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                        if ($('.modal-popup-content').length > 0) {
                                                                            //console.log("scroll initiated for modal pop-up class")
                                                                            appScroll.scrollBar('.modal-popup-content');
                                                                        }
                                                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                    } else {
                                                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                    }
                                                                    var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                    console.log("previewContent", previewContent);
                                                                    //append multimedia
                                                                    $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                });
                                                                removeLoader();

                                                            }, 'page/common/identity_video', '#identity-video-template', null);
                                                        });
                                                    }
                                                    reader.readAsDataURL(blob);
                                                })
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else {//employee identity picture
                    if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        individualStartFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                var modal_data = {
                                                    modal_platform: crossplat.device.platform,
                                                    modal_id: "employee-identity-picture-modal",
                                                    modal_header: "",
                                                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                    modal_action_buttons: [{
                                                        id: "employee-identity-crop-button",
                                                        name: `crop`,
                                                        attr: [{
                                                            name: "data-id",
                                                            value: ''
                                                        }]
                                                    }]
                                                }
                                                showModal(modal_data, function () {
                                                    removeLoader();
                                                    // if ($('.modal-popup-content').length > 0) {
                                                    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                    //         //console.log("scroll initiated for modal pop-up class")
                                                    //         appScroll.scrollBar('.modal-popup-content');
                                                    //     }
                                                    // }
                                                    $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                    $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
                                                });
                                                setTimeout(function () {
                                                    var image = document.getElementById('image_cropper');
                                                    image.src = sessionData.url;
                                                    //console.log("image.src", image.src);
                                                    $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                    digibiz.cropper = new Cropper(image, {
                                                        viewMode: 2,
                                                        aspectRatio: 1 / 1,
                                                        minContainerWidth: 72,
                                                        minContainerHeight: 72,
                                                        minCropBoxWidth: 72,
                                                        minCropBoxHeight: 72,
                                                        maxWidth: 100,
                                                        maxHeight: 400,
                                                        zoomable: true,
                                                        rotatable: true,
                                                        responsive: true,
                                                        movable: true,
                                                        ready: function () {
                                                            //cropper.zoom(-0.6);
                                                        }
                                                    });
                                                }, 300);
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                }
            } else if (sessionStorage.getItem('business_id')) {
                if (sessionStorage.getItem('cloud_upload_for')) {
                    var getDeclarationFor = sessionStorage.getItem('cloud_upload_for');
                    if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        individualStartFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                var modal_data = {
                                                    modal_platform: crossplat.device.platform,
                                                    modal_id: "transaction-signature-picture-modal",
                                                    modal_header: "",
                                                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                    modal_action_buttons: [{
                                                        id: "crop-button",
                                                        name: `crop`,
                                                        attr: [{
                                                            name: "data-id",
                                                            value: getDeclarationFor
                                                        }]
                                                    }]
                                                }
                                                showModal(modal_data, function () {
                                                    removeLoader();
                                                    // if ($('.modal-popup-content').length > 0) {
                                                    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                    //         //console.log("scroll initiated for modal pop-up class")
                                                    //         appScroll.scrollBar('.modal-popup-content');
                                                    //     }
                                                    // }
                                                    $('#transaction-signature-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                    $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
                                                });
                                                setTimeout(function () {
                                                    var image = document.getElementById('image_cropper');
                                                    image.src = sessionData.url;
                                                    //console.log("image.src", image.src);
                                                    $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                    digibiz.cropper = new Cropper(image, {
                                                        viewMode: 2,
                                                        aspectRatio: 1 / 1,
                                                        minContainerWidth: 72,
                                                        minContainerHeight: 72,
                                                        minCropBoxWidth: 72,
                                                        minCropBoxHeight: 72,
                                                        maxWidth: 100,
                                                        maxHeight: 400,
                                                        zoomable: true,
                                                        rotatable: true,
                                                        responsive: true,
                                                        movable: true,
                                                        ready: function () {
                                                            //cropper.zoom(-0.6);
                                                        }
                                                    });
                                                }, 300);
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else if (sessionStorage.getItem('business_upload_for') == "business_display_picture") {//business display picture
                    if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        individualStartFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                var modal_data = {
                                                    modal_platform: crossplat.device.platform,
                                                    modal_id: "business-display-picture-modal",
                                                    modal_header: "",
                                                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                    modal_action_buttons: [{
                                                        id: "business-display-crop-button",
                                                        name: `crop`,
                                                        attr: [{
                                                            name: "data-id",
                                                            value: ''
                                                        }]
                                                    }]
                                                }
                                                showModal(modal_data, function () {
                                                    removeLoader();
                                                    // if ($('.modal-popup-content').length > 0) {
                                                    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                    //         //console.log("scroll initiated for modal pop-up class")
                                                    //         appScroll.scrollBar('.modal-popup-content');
                                                    //     }
                                                    // }
                                                    $('#business-display-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                    $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
                                                });
                                                setTimeout(function () {
                                                    var image = document.getElementById('image_cropper');
                                                    image.src = sessionData.url;
                                                    //console.log("image.src", image.src);
                                                    $('#business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                    digibiz.cropper = new Cropper(image, {
                                                        viewMode: 2,
                                                        aspectRatio: 1 / 1,
                                                        minContainerWidth: 72,
                                                        minContainerHeight: 72,
                                                        minCropBoxWidth: 72,
                                                        minCropBoxHeight: 72,
                                                        maxWidth: 100,
                                                        maxHeight: 400,
                                                        zoomable: true,
                                                        rotatable: true,
                                                        responsive: true,
                                                        movable: true,
                                                        ready: function () {
                                                            //cropper.zoom(-0.6);
                                                        }
                                                    });
                                                }, 300);
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else if (sessionStorage.getItem('business_upload_for') == "business_identity_video") {//business identity video
                    if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        individualStartFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                console.log("sessionData", sessionData);
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                // var content = await viewFile(sessionData.file_type, sessionData.extension, sessionData.url);
                                                // console.log("content", content);
                                                getBlobFromURL(sessionData.url).then((blob) => {
                                                    console.log("blob", blob);
                                                    //create object urls
                                                    // digibiz.objectURLS = [];
                                                    // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                    var reader = new FileReader;
                                                    reader.onloadend = function () {
                                                        generateThubnail(this.result, 'base64').then((thubnail) => {
                                                            digibiz.fileObject = {};
                                                            var fileObj = {
                                                                // file: files[0],
                                                                identifier: (new Date()).getTime(),
                                                                fileURI: URL.createObjectURL(blob),
                                                                file_type: sessionData.file_type,
                                                                // file_name: files[0].name,
                                                                file_content_base64: this.result,
                                                                thubnail: thubnail
                                                            }
                                                            digibiz.fileObject = fileObj;
                                                            console.log("digibiz.fileObject", digibiz.fileObject);
                                                            fetch.getHtml(function (fetcherror, html) {
                                                                //console.log("got html")
                                                                var modal_data = {
                                                                    modal_platform: crossplat.device.platform,
                                                                    modal_id: "identity-video-modal",
                                                                    modal_header: "",
                                                                    modal_body: html,
                                                                    modal_action_buttons: [{
                                                                        id: "identity-video-confirm",
                                                                        name: `Confirm`,
                                                                        attr: [{
                                                                            name: "data-id",
                                                                            value: "business"
                                                                        }]
                                                                    }]
                                                                }
                                                                showModal(modal_data, function () {
                                                                    //console.log("modal added");
                                                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                        if ($('.modal-popup-content').length > 0) {
                                                                            //console.log("scroll initiated for modal pop-up class")
                                                                            appScroll.scrollBar('.modal-popup-content');
                                                                        }
                                                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                    } else {
                                                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                    }
                                                                    var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                    console.log("previewContent", previewContent);
                                                                    //append multimedia
                                                                    $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                });
                                                                removeLoader();

                                                            }, 'page/common/identity_video', '#identity-video-template', null);
                                                        });
                                                    }
                                                    reader.readAsDataURL(blob);
                                                })
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else {
                    if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));
                            digibiz.cloud_multimedia_selected_files.push($(element).attr('data-asset_id'));
                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
                                getIndividualAssetDetails(asset_ids[0]).then((file) => {
                                    //console.log("file", file);
                                    if (file.is_trashed == false) {
                                        // var sessionData = startFileSession(file, 'view');
                                        // if (sessionData) {
                                        //     //console.log("sessionData", sessionData);
                                        //     var blob = getBlobFromURL(sessionData.url);
                                        //     //console.log("blob", blob);
                                        //     var base64Content = blob2Base64(blob);
                                        //     //console.log("base64Content", base64Content);
                                        // }

                                        // var reqParams = {
                                        //     device_id: crossplat.device.uuid,
                                        //     business_id: sessionStorage.getItem('business_id'),
                                        //     storage_id: file.file_attributes.id
                                        // }
                                        // individualCloudFileRead(reqParams)
                                        //     .then((response) => {
                                        individualStartFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                //console.log("sessionData", sessionData);
                                                $(".upload-preview-common-layout#upload-preview-wrapper").find('#upload-footer-send-btn-common').attr('data-uploadtype', "cloud");
                                                if (sessionData.file_type == "text") {
                                                    sessionData.file_type = "application";
                                                }
                                                var content = await viewFile(sessionData.file_type, sessionData.extension, sessionData.url);
                                                //console.log("content", content)
                                                getBlobFromURL(sessionData.url).then((blob) => {
                                                    //console.log("blob", blob)
                                                    //create object urls
                                                    digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);

                                                    var reader = new FileReader;
                                                    reader.onloadend = function () {
                                                        // generateThubnail(this.result, 'base64').then((thubnail) => {
                                                        //add preview thumbnails
                                                        $(".upload-footer-attatched-file").removeClass('active');
                                                        if (['image', 'video'].includes(sessionData.file_type)) {
                                                            //console.log("87654")
                                                            // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${thubnail}"/><span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                                            // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${blob}"/>`);
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(content);
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass('active');
                                                        } else {
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass(`active file-type-${sessionData.file_type} icomoon-`);
                                                            // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(``);
                                                        }

                                                        //add extension and file type
                                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileType', sessionData.file_type);
                                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileExtension', sessionData.extension);

                                                        //remove Hide class from upload preview
                                                        //console.log("check", $(".upload-preview-common-layout#upload-preview-wrapper"))
                                                        //console.log("append", $(".upload-preview-common-layout#upload-file-preview"))
                                                        // $(".upload-preview-common-layout #upload-file-preview").append(sessionData.url)
                                                        // $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide');
                                                        if ($(".upload-preview-common-layout#upload-preview-wrapper").hasClass('hide')) {
                                                            //console.log("123")
                                                            $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
                                                            $('div[data-filemanager="filemanager"]').addClass('hide');
                                                        }

                                                        digibiz.uploadingFiles.push({
                                                            identifier: asset_ids[0],
                                                            file: file,
                                                            fileURI: digibiz.objectURLS[asset_ids[0]],
                                                            // thumbnail: thubnail,
                                                            // room: room,
                                                            // group_id: group_id,
                                                            // contact_id: contact_id
                                                        });
                                                        //console.log("digibiz.uploadingFiles", digibiz.uploadingFiles)
                                                        // });
                                                    }
                                                    reader.readAsDataURL(blob);
                                                })
                                                $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide');
                                                $(".upload-preview-common-layout #upload-file-preview").html(content);
                                                $('#upload-footer-send-btn-common').attr('data-id', sessionStorage.getItem('multimedia_upload_data_id'));
                                                $('#upload-footer-send-btn-common').attr('data-name', file.file_attributes.name.relative);
                                                $('#upload-preview-container-text-box').text("");
                                                $('#upload-footer-send-btn-common').removeAttr('data-download');
                                                // $('.pdf-view').addClass('hide');
                                                //console.log("CHECKING CLOUD");
                                                if (sessionData.file_type == 'image' || sessionData.file_type == "video" || sessionData.file_type == "audio") {
                                                    //console.log("CHECKING CLOUD-add hide");
                                                    $('.pdf-view').addClass('hide');
                                                } else {
                                                    //console.log("CHECKING CLOUD-remove hide");
                                                    $('.pdf-view').addClass('hide');
                                                }
                                                // $('.remove-attached-uploading-file').attr('data-identifier', asset_ids[0]);
                                                if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
                                                    $('.header-band').addClass('hide');
                                                }
                                                //need to be commented start
                                                var loadedfile = `<div class="grid selected-multimedia-files" data-type="file" data-upload-type="cloud">
                                                <img class="hide" src="${sessionData.url}"/>
                                                        <div class="thumbnail-wrapper">
                                                           <a class="">
                                                              <div class="thumbnail"></div>
                                                           </a>                     
                                                        </div>
                                                        <div class="file-details ellipsify">
                                                           <div class="file-name">
                                                              <a class="thumb-title">${file.file_attributes.name.relative}</a>
                                                           </div>  
                                                           <div class="file-size">
                                                           <div class="thumb-meta">
                                                              <span class="thumb-info">${file.file_attributes.size.filesize}</span>
                                                           </div>
                                                        </div>                    
                                                        </div>
                                                        <div class="file-selected-remove-btn">
                                                        <i class="material-icons">cancel</i>
                                                    </div>
                                                     </div>`;
                                                //console.log("loadedfile", loadedfile);
                                                var getDeviceUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
                                                //console.log("getDeviceUploadTo", getDeviceUploadTo);
                                                if (getDeviceUploadTo == "identity-proof-load-btn") {
                                                    $('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "pancard-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "shop-established-license-load-btn") {
                                                    //console.log("111");
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "gst-license-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "partnership-deed-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "partnership-registration-certificate-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "llp-registration-certificate-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "transaction-person-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "memorandum-of-association-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "articles-of-association-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "trust-establishment-license-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                }
                                                // })
                                                // .catch((err) => {
                                                //     //console.log("234567", err);
                                                // })
                                                //need to commented end
                                            }
                                        })
                                            .catch((err) => {
                                                if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                }
            }
        } else if (sessionStorage.getItem('digibiz_assets')) {//digibiz assets
            if ($('body').attr('app') == "digibiz_credentials") {
                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                    //get selected files
                    var asset_ids = [];
                    $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                        asset_ids.push($(element).attr('data-asset_id'));

                        //show loader in thubnail area
                        $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                        //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                        if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                            getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                if (file.is_trashed == false) {
                                    startFileSession(file, 'view').then(async (sessionData) => {
                                        if (sessionData) {
                                            $('.filemanger_container_toggle').removeClass('active');
                                            window.sessionStorage.removeItem('breadcrumb_path');
                                            setTimeout(function () {
                                                var image = document.getElementById('image_cropper');
                                                image.src = sessionData.url;
                                                //console.log("image.src", image.src);
                                                $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                digibiz.cropper = new Cropper(image, {
                                                    viewMode: 2,
                                                    aspectRatio: 1 / 1,
                                                    minContainerWidth: 72,
                                                    minContainerHeight: 72,
                                                    minCropBoxWidth: 72,
                                                    minCropBoxHeight: 72,
                                                    maxWidth: 100,
                                                    maxHeight: 400,
                                                    zoomable: true,
                                                    rotatable: true,
                                                    responsive: true,
                                                    movable: true,
                                                    ready: function () {
                                                        //cropper.zoom(-0.6);
                                                    }
                                                });
                                            }, 300);
                                        }
                                    }).catch((err) => {
                                        if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                            $('#upload-preview-close-btn').click();
                                        }
                                        //console.log(err);
                                    });
                                } else {
                                    $("#upload-file-preview").html('Selected asset is deleted');
                                    $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                }

                            }).catch((err) => {
                                //console.log(err);
                            });
                        }
                    });
                } else {
                    Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                    $('.filemanger_container_toggle').addClass('active');
                }
            } else if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details" || $('body').attr('app') == "collaborator_group_create") {
                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                    //get selected files
                    var asset_ids = [];
                    $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                        asset_ids.push($(element).attr('data-asset_id'));

                        //show loader in thubnail area
                        $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                        if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                            getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                if (file.is_trashed == false) {
                                    startFileSession(file, 'view').then(async (sessionData) => {
                                        if (sessionData) {
                                            $('.filemanger_container_toggle').removeClass('active');
                                            window.sessionStorage.removeItem('breadcrumb_path');
                                            var modal_data = {
                                                modal_platform: crossplat.device.platform,
                                                modal_id: "group-image-modal",
                                                modal_header: "",
                                                modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                modal_action_buttons: [{
                                                    id: "group-image-crop-button",
                                                    name: `crop`,
                                                    attr: [{
                                                        name: "data-id",
                                                        value: ''
                                                    }]
                                                }]
                                            }
                                            showModal(modal_data, function () {
                                                removeLoader();
                                                // if ($('.modal-popup-content').length > 0) {
                                                //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                //         //console.log("scroll initiated for modal pop-up class")
                                                //         appScroll.scrollBar('.modal-popup-content');
                                                //     }
                                                // }
                                                $('#group-image-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                $('#group-image-modal').attr('picture-type', 'group_image');
                                                setTimeout(function () {
                                                    var image = document.getElementById('image_cropper');
                                                    //console.log("image", image);
                                                    image.src = sessionData.url;
                                                    //console.log("image.src", image.src);
                                                    $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                    digibiz.cropper = new Cropper(image, {
                                                        viewMode: 2,
                                                        aspectRatio: 1 / 1,
                                                        minContainerWidth: 72,
                                                        minContainerHeight: 72,
                                                        minCropBoxWidth: 72,
                                                        minCropBoxHeight: 72,
                                                        maxWidth: 100,
                                                        maxHeight: 400,
                                                        zoomable: true,
                                                        rotatable: true,
                                                        responsive: true,
                                                        movable: true,
                                                        ready: function () {
                                                            //cropper.zoom(-0.6);
                                                        }
                                                    });
                                                }, 300);
                                            });
                                        }
                                    }).catch((err) => {
                                        if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                            $('#upload-preview-close-btn').click();
                                        }
                                        //console.log(err);
                                    });
                                } else {
                                    $("#upload-file-preview").html('Selected asset is deleted');
                                    $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                }

                            }).catch((err) => {
                                //console.log(err);
                            });
                        }
                    });
                } else {
                    Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                    $('.filemanger_container_toggle').addClass('active');
                }
            } else if (sessionStorage.getItem('customer_id')) {
                if ($('#edit-associate-customer-modal').length > 0) {//for associate-customer
                    if (sessionStorage.getItem('associate_customer_upload_for') == "associate_customer_identity_video") {
                        //console.log("inside edit modal");
                        if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                    getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            startFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    getBlobFromURL(sessionData.url).then((blob) => {
                                                        console.log("blob", blob);
                                                        //create object urls
                                                        // digibiz.objectURLS = [];
                                                        // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                        var reader = new FileReader;
                                                        reader.onloadend = function () {
                                                            generateThubnail(this.result, 'base64').then((thubnail) => {
                                                                digibiz.fileObject = {};
                                                                var fileObj = {
                                                                    // file: files[0],
                                                                    identifier: (new Date()).getTime(),
                                                                    fileURI: URL.createObjectURL(blob),
                                                                    file_type: sessionData.file_type,
                                                                    // file_name: files[0].name,
                                                                    file_content_base64: this.result,
                                                                    thubnail: thubnail
                                                                }
                                                                digibiz.fileObject = fileObj;
                                                                console.log("digibiz.fileObject", digibiz.fileObject);
                                                                fetch.getHtml(function (fetcherror, html) {
                                                                    //console.log("got html")
                                                                    var modal_data = {
                                                                        modal_platform: crossplat.device.platform,
                                                                        modal_id: "identity-video-modal",
                                                                        modal_header: "",
                                                                        modal_body: html,
                                                                        modal_action_buttons: [{
                                                                            id: "identity-video-confirm",
                                                                            name: `Confirm`,
                                                                            attr: [{
                                                                                name: "data-id",
                                                                                value: "associate-customer"
                                                                            }]
                                                                        }]
                                                                    }
                                                                    showModal(modal_data, function () {
                                                                        //console.log("modal added");
                                                                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                            if ($('.modal-popup-content').length > 0) {
                                                                                //console.log("scroll initiated for modal pop-up class")
                                                                                appScroll.scrollBar('.modal-popup-content');
                                                                            }
                                                                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                        } else {
                                                                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                        }
                                                                        var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                        console.log("previewContent", previewContent);
                                                                        //append multimedia
                                                                        $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                    });
                                                                    removeLoader();

                                                                }, 'page/common/identity_video', '#identity-video-template', null);
                                                            });
                                                        }
                                                        reader.readAsDataURL(blob);
                                                    })
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    } else {
                        //console.log("inside edit modal");
                        if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                    getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            startFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    var modal_data = {
                                                        modal_platform: crossplat.device.platform,
                                                        modal_id: "associate-customer-identity-picture-modal",
                                                        modal_header: "",
                                                        modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                        modal_action_buttons: [{
                                                            id: "associate-customer-identity-crop-button",
                                                            name: `crop`,
                                                            attr: [{
                                                                name: "data-id",
                                                                value: ''
                                                            }]
                                                        }]
                                                    }
                                                    showModal(modal_data, function () {
                                                        removeLoader();
                                                        // if ($('.modal-popup-content').length > 0) {
                                                        //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                        //         //console.log("scroll initiated for modal pop-up class")
                                                        //         appScroll.scrollBar('.modal-popup-content');
                                                        //     }
                                                        // }
                                                        $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                        $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
                                                        setTimeout(function () {
                                                            var image = document.getElementById('image_cropper');
                                                            //console.log("image", image);
                                                            image.src = sessionData.url;
                                                            //console.log("image.src", image.src);
                                                            $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                            digibiz.cropper = new Cropper(image, {
                                                                viewMode: 2,
                                                                aspectRatio: 1 / 1,
                                                                minContainerWidth: 72,
                                                                minContainerHeight: 72,
                                                                minCropBoxWidth: 72,
                                                                minCropBoxHeight: 72,
                                                                maxWidth: 100,
                                                                maxHeight: 400,
                                                                zoomable: true,
                                                                rotatable: true,
                                                                responsive: true,
                                                                movable: true,
                                                                ready: function () {
                                                                    //cropper.zoom(-0.6);
                                                                }
                                                            });
                                                        }, 300);
                                                    });
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    }


                } else {//for customer
                    if (sessionStorage.getItem('customer_upload_for') == "customer_identity_video") {
                        if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                                if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                    getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            startFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    getBlobFromURL(sessionData.url).then((blob) => {
                                                        console.log("blob", blob);
                                                        //create object urls
                                                        // digibiz.objectURLS = [];
                                                        // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                        var reader = new FileReader;
                                                        reader.onloadend = function () {
                                                            generateThubnail(this.result, 'base64').then((thubnail) => {
                                                                digibiz.fileObject = {};
                                                                var fileObj = {
                                                                    // file: files[0],
                                                                    identifier: (new Date()).getTime(),
                                                                    fileURI: URL.createObjectURL(blob),
                                                                    file_type: sessionData.file_type,
                                                                    // file_name: files[0].name,
                                                                    file_content_base64: this.result,
                                                                    thubnail: thubnail
                                                                }
                                                                digibiz.fileObject = fileObj;
                                                                console.log("digibiz.fileObject", digibiz.fileObject);
                                                                fetch.getHtml(function (fetcherror, html) {
                                                                    //console.log("got html")
                                                                    var modal_data = {
                                                                        modal_platform: crossplat.device.platform,
                                                                        modal_id: "identity-video-modal",
                                                                        modal_header: "",
                                                                        modal_body: html,
                                                                        modal_action_buttons: [{
                                                                            id: "identity-video-confirm",
                                                                            name: `Confirm`,
                                                                            attr: [{
                                                                                name: "data-id",
                                                                                value: "customer"
                                                                            }]
                                                                        }]
                                                                    }
                                                                    showModal(modal_data, function () {
                                                                        //console.log("modal added");
                                                                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                            if ($('.modal-popup-content').length > 0) {
                                                                                //console.log("scroll initiated for modal pop-up class")
                                                                                appScroll.scrollBar('.modal-popup-content');
                                                                            }
                                                                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                        } else {
                                                                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                        }
                                                                        var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                        console.log("previewContent", previewContent);
                                                                        //append multimedia
                                                                        $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                    });
                                                                    removeLoader();

                                                                }, 'page/common/identity_video', '#identity-video-template', null);
                                                            });
                                                        }
                                                        reader.readAsDataURL(blob);
                                                    })
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    } else {
                        if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                            //get selected files
                            var asset_ids = [];
                            $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                                asset_ids.push($(element).attr('data-asset_id'));

                                //show loader in thubnail area
                                $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                                //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                                if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                    getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                        if (file.is_trashed == false) {
                                            startFileSession(file, 'view').then(async (sessionData) => {
                                                if (sessionData) {
                                                    $('.filemanger_container_toggle').removeClass('active');
                                                    window.sessionStorage.removeItem('breadcrumb_path');
                                                    var modal_data = {
                                                        modal_platform: crossplat.device.platform,
                                                        modal_id: "customer-identity-picture-modal",
                                                        modal_header: "",
                                                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                        modal_action_buttons: [{
                                                            id: "customer-identity-crop-button",
                                                            name: `crop`,
                                                            attr: [{
                                                                name: "data-id",
                                                                value: ''
                                                            }]
                                                        }]
                                                    }
                                                    showModal(modal_data, function () {
                                                        removeLoader();
                                                        // if ($('.modal-popup-content').length > 0) {
                                                        //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                        //         //console.log("scroll initiated for modal pop-up class")
                                                        //         appScroll.scrollBar('.modal-popup-content');
                                                        //     }
                                                        // }
                                                        $('#customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                        $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
                                                        setTimeout(function () {
                                                            var image = document.getElementById('image_cropper');
                                                            image.src = sessionData.url;
                                                            //console.log("image.src", image.src);
                                                            $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                            digibiz.cropper = new Cropper(image, {
                                                                viewMode: 2,
                                                                aspectRatio: 1 / 1,
                                                                minContainerWidth: 72,
                                                                minContainerHeight: 72,
                                                                minCropBoxWidth: 72,
                                                                minCropBoxHeight: 72,
                                                                maxWidth: 100,
                                                                maxHeight: 400,
                                                                zoomable: true,
                                                                rotatable: true,
                                                                responsive: true,
                                                                movable: true,
                                                                ready: function () {
                                                                    //cropper.zoom(-0.6);
                                                                }
                                                            });
                                                        }, 300);
                                                    });
                                                }
                                            }).catch((err) => {
                                                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                        } else {
                                            $("#upload-file-preview").html('Selected asset is deleted');
                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                        }

                                    }).catch((err) => {
                                        //console.log(err);
                                    });
                                }
                            });
                        } else {
                            Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                            $('.filemanger_container_toggle').addClass('active');
                        }
                    }
                }
            } else if (sessionStorage.getItem('employee_id')) {
                if (sessionStorage.getItem('employee_upload_for') == "employee_identity_video") {//employee identity video
                    if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        startFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                getBlobFromURL(sessionData.url).then((blob) => {
                                                    console.log("blob", blob);
                                                    //create object urls
                                                    // digibiz.objectURLS = [];
                                                    // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                    var reader = new FileReader;
                                                    reader.onloadend = function () {
                                                        generateThubnail(this.result, 'base64').then((thubnail) => {
                                                            digibiz.fileObject = {};
                                                            var fileObj = {
                                                                // file: files[0],
                                                                identifier: (new Date()).getTime(),
                                                                fileURI: URL.createObjectURL(blob),
                                                                file_type: sessionData.file_type,
                                                                // file_name: files[0].name,
                                                                file_content_base64: this.result,
                                                                thubnail: thubnail
                                                            }
                                                            digibiz.fileObject = fileObj;
                                                            console.log("digibiz.fileObject", digibiz.fileObject);
                                                            fetch.getHtml(function (fetcherror, html) {
                                                                //console.log("got html")
                                                                var modal_data = {
                                                                    modal_platform: crossplat.device.platform,
                                                                    modal_id: "identity-video-modal",
                                                                    modal_header: "",
                                                                    modal_body: html,
                                                                    modal_action_buttons: [{
                                                                        id: "identity-video-confirm",
                                                                        name: `Confirm`,
                                                                        attr: [{
                                                                            name: "data-id",
                                                                            value: "employee"
                                                                        }]
                                                                    }]
                                                                }
                                                                showModal(modal_data, function () {
                                                                    //console.log("modal added");
                                                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                        if ($('.modal-popup-content').length > 0) {
                                                                            //console.log("scroll initiated for modal pop-up class")
                                                                            appScroll.scrollBar('.modal-popup-content');
                                                                        }
                                                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                    } else {
                                                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                    }
                                                                    var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                    console.log("previewContent", previewContent);
                                                                    //append multimedia
                                                                    $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                });
                                                                removeLoader();

                                                            }, 'page/common/identity_video', '#identity-video-template', null);
                                                        });
                                                    }
                                                    reader.readAsDataURL(blob);
                                                })
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else {//employee identity picture
                    if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        startFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                var modal_data = {
                                                    modal_platform: crossplat.device.platform,
                                                    modal_id: "employee-identity-picture-modal",
                                                    modal_header: "",
                                                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                    modal_action_buttons: [{
                                                        id: "employee-identity-crop-button",
                                                        name: `crop`,
                                                        attr: [{
                                                            name: "data-id",
                                                            value: ''
                                                        }]
                                                    }]
                                                }
                                                showModal(modal_data, function () {
                                                    removeLoader();
                                                    // if ($('.modal-popup-content').length > 0) {
                                                    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                    //         //console.log("scroll initiated for modal pop-up class")
                                                    //         appScroll.scrollBar('.modal-popup-content');
                                                    //     }
                                                    // }
                                                    $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                    $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
                                                    setTimeout(function () {
                                                        var image = document.getElementById('image_cropper');
                                                        image.src = sessionData.url;
                                                        //console.log("image.src", image.src);
                                                        $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                        digibiz.cropper = new Cropper(image, {
                                                            viewMode: 0,
                                                            aspectRatio: 1 / 1,
                                                            minContainerWidth: 72,
                                                            minContainerHeight: 72,
                                                            minCropBoxWidth: 72,
                                                            minCropBoxHeight: 72,
                                                            maxWidth: 100,
                                                            maxHeight: 400,
                                                            zoomable: true,
                                                            rotatable: true,
                                                            responsive: true,
                                                            movable: true,
                                                            ready: function () {
                                                            }
                                                        });
                                                    }, 300);
                                                });
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                }
            } else if (sessionStorage.getItem('business_id')) {
                if (sessionStorage.getItem('cloud_upload_for')) {
                    //console.log("11")
                    var getDeclarationFor = sessionStorage.getItem('cloud_upload_for');
                    if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        startFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                var modal_data = {
                                                    modal_platform: crossplat.device.platform,
                                                    modal_id: "transaction-signature-picture-modal",
                                                    modal_header: "",
                                                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                    modal_action_buttons: [{
                                                        id: "crop-button",
                                                        name: `crop`,
                                                        attr: [{
                                                            name: "data-id",
                                                            value: getDeclarationFor
                                                        }]
                                                    }]
                                                }
                                                showModal(modal_data, function () {
                                                    removeLoader();
                                                    // if ($('.modal-popup-content').length > 0) {
                                                    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                    //         //console.log("scroll initiated for modal pop-up class")
                                                    //         appScroll.scrollBar('.modal-popup-content');
                                                    //     }
                                                    // }
                                                    $('#transaction-signature-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                    $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
                                                    setTimeout(function () {
                                                        var image = document.getElementById('image_cropper');
                                                        image.src = sessionData.url;
                                                        //console.log("image.src", image.src);
                                                        $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                        digibiz.cropper = new Cropper(image, {
                                                            viewMode: 2,
                                                            aspectRatio: 1 / 1,
                                                            minContainerWidth: 72,
                                                            minContainerHeight: 72,
                                                            minCropBoxWidth: 72,
                                                            minCropBoxHeight: 72,
                                                            maxWidth: 100,
                                                            maxHeight: 400,
                                                            zoomable: true,
                                                            rotatable: true,
                                                            responsive: true,
                                                            movable: true,
                                                            ready: function () {
                                                                //cropper.zoom(-0.6);
                                                            }
                                                        });
                                                    }, 300);
                                                });
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else if (sessionStorage.getItem('business_upload_for') == "business_display_picture") {//business display picture
                    if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        startFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                var modal_data = {
                                                    modal_platform: crossplat.device.platform,
                                                    modal_id: "business-display-picture-modal",
                                                    modal_header: "",
                                                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                                                    modal_action_buttons: [{
                                                        id: "business-display-crop-button",
                                                        name: `crop`,
                                                        attr: [{
                                                            name: "data-id",
                                                            value: ''
                                                        }]
                                                    }]
                                                }
                                                showModal(modal_data, function () {
                                                    removeLoader();
                                                    // if ($('.modal-popup-content').length > 0) {
                                                    //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                                    //         //console.log("scroll initiated for modal pop-up class")
                                                    //         appScroll.scrollBar('.modal-popup-content');
                                                    //     }
                                                    // }
                                                    $('#business-display-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                                                    $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
                                                    setTimeout(function () {
                                                        var image = document.getElementById('image_cropper');
                                                        image.src = sessionData.url;
                                                        //console.log("image.src", image.src);
                                                        $('#business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                        digibiz.cropper = new Cropper(image, {
                                                            viewMode: 2,
                                                            aspectRatio: 1 / 1,
                                                            minContainerWidth: 72,
                                                            minContainerHeight: 72,
                                                            minCropBoxWidth: 72,
                                                            minCropBoxHeight: 72,
                                                            maxWidth: 100,
                                                            maxHeight: 400,
                                                            zoomable: true,
                                                            rotatable: true,
                                                            responsive: true,
                                                            movable: true,
                                                            ready: function () {
                                                                //cropper.zoom(-0.6);
                                                            }
                                                        });
                                                    }, 300);
                                                });
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else if (sessionStorage.getItem('business_upload_for') == "business_identity_video") {//business identity video
                    if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));

                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                    if (file.is_trashed == false) {
                                        startFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                $('.filemanger_container_toggle').removeClass('active');
                                                window.sessionStorage.removeItem('breadcrumb_path');
                                                getBlobFromURL(sessionData.url).then((blob) => {
                                                    console.log("blob", blob);
                                                    //create object urls
                                                    // digibiz.objectURLS = [];
                                                    // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
                                                    var reader = new FileReader;
                                                    reader.onloadend = function () {
                                                        generateThubnail(this.result, 'base64').then((thubnail) => {
                                                            digibiz.fileObject = {};
                                                            var fileObj = {
                                                                // file: files[0],
                                                                identifier: (new Date()).getTime(),
                                                                fileURI: URL.createObjectURL(blob),
                                                                file_type: sessionData.file_type,
                                                                // file_name: files[0].name,
                                                                file_content_base64: this.result,
                                                                thubnail: thubnail
                                                            }
                                                            digibiz.fileObject = fileObj;
                                                            console.log("digibiz.fileObject", digibiz.fileObject);
                                                            fetch.getHtml(function (fetcherror, html) {
                                                                //console.log("got html")
                                                                var modal_data = {
                                                                    modal_platform: crossplat.device.platform,
                                                                    modal_id: "identity-video-modal",
                                                                    modal_header: "",
                                                                    modal_body: html,
                                                                    modal_action_buttons: [{
                                                                        id: "identity-video-confirm",
                                                                        name: `Confirm`,
                                                                        attr: [{
                                                                            name: "data-id",
                                                                            value: "business"
                                                                        }]
                                                                    }]
                                                                }
                                                                showModal(modal_data, function () {
                                                                    //console.log("modal added");
                                                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                                        if ($('.modal-popup-content').length > 0) {
                                                                            //console.log("scroll initiated for modal pop-up class")
                                                                            appScroll.scrollBar('.modal-popup-content');
                                                                        }
                                                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                                    } else {
                                                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                                    }
                                                                    var previewContent = showVideoPreviewHtml(sessionData.file_type, digibiz.fileObject.fileURI);
                                                                    console.log("previewContent", previewContent);
                                                                    //append multimedia
                                                                    $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                                                                <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                                                                });
                                                                removeLoader();

                                                            }, 'page/common/identity_video', '#identity-video-template', null);
                                                        });
                                                    }
                                                    reader.readAsDataURL(blob);
                                                })
                                            }
                                        }).catch((err) => {
                                            if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                $('#upload-preview-close-btn').click();
                                            }
                                            //console.log(err);
                                        });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                } else {
                    if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
                        //get selected files
                        var asset_ids = [];
                        $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
                            asset_ids.push($(element).attr('data-asset_id'));
                            digibiz.cloud_multimedia_selected_files.push($(element).attr('data-asset_id'));
                            //show loader in thubnail area
                            $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

                            //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
                            if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
                                getDigibizAssetDetails(asset_ids[0]).then((file) => {
                                    //console.log("file", file);
                                    if (file.is_trashed == false) {
                                        // var sessionData = startFileSession(file, 'view');
                                        // if (sessionData) {
                                        //     //console.log("sessionData", sessionData);
                                        //     var blob = getBlobFromURL(sessionData.url);
                                        //     //console.log("blob", blob);
                                        //     var base64Content = blob2Base64(blob);
                                        //     //console.log("base64Content", base64Content);
                                        // }

                                        // var reqParams = {
                                        //     device_id: crossplat.device.uuid,
                                        //     business_id: sessionStorage.getItem('business_id'),
                                        //     storage_id: file.file_attributes.id
                                        // }
                                        // individualCloudFileRead(reqParams)
                                        //     .then((response) => {
                                        startFileSession(file, 'view').then(async (sessionData) => {
                                            if (sessionData) {
                                                //console.log("sessionData", sessionData);
                                                $(".upload-preview-common-layout#upload-preview-wrapper").find('#upload-footer-send-btn-common').attr('data-uploadtype', "cloud");
                                                if (sessionData.file_type == "text") {
                                                    sessionData.file_type = "application";
                                                }
                                                var content = await viewFile(sessionData.file_type, sessionData.extension, sessionData.url);
                                                //console.log("content", content)
                                                getBlobFromURL(sessionData.url).then((blob) => {
                                                    //console.log("blob", blob)
                                                    //create object urls
                                                    digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);

                                                    var reader = new FileReader;
                                                    reader.onloadend = function () {
                                                        // generateThubnail(this.result, 'base64').then((thubnail) => {
                                                        //add preview thumbnails
                                                        $(".upload-footer-attatched-file").removeClass('active');
                                                        if (['image', 'video'].includes(sessionData.file_type)) {
                                                            //console.log("87654")
                                                            // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${thubnail}"/><span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                                            // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${blob}"/>`);
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(content);
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass('active');
                                                        } else {
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass(`active file-type-${sessionData.file_type} icomoon-`);
                                                            // $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                                            $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(``);
                                                        }

                                                        //add extension and file type
                                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileType', sessionData.file_type);
                                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileExtension', sessionData.extension);

                                                        //remove Hide class from upload preview
                                                        //console.log("check", $(".upload-preview-common-layout#upload-preview-wrapper"))
                                                        //console.log("append", $(".upload-preview-common-layout#upload-file-preview"))
                                                        // $(".upload-preview-common-layout #upload-file-preview").append(sessionData.url)
                                                        // $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide');
                                                        if ($(".upload-preview-common-layout#upload-preview-wrapper").hasClass('hide')) {
                                                            //console.log("123")
                                                            $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
                                                            $('div[data-filemanager="filemanager"]').addClass('hide');
                                                        }

                                                        digibiz.uploadingFiles.push({
                                                            identifier: asset_ids[0],
                                                            file: file,
                                                            fileURI: digibiz.objectURLS[asset_ids[0]],
                                                            // thumbnail: thubnail,
                                                            // room: room,
                                                            // group_id: group_id,
                                                            // contact_id: contact_id
                                                        });
                                                        //console.log("digibiz.uploadingFiles", digibiz.uploadingFiles)
                                                        // });
                                                    }
                                                    reader.readAsDataURL(blob);
                                                })
                                                $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('hide');
                                                $(".upload-preview-common-layout #upload-file-preview").html(content);
                                                $('#upload-footer-send-btn-common').attr('data-id', sessionStorage.getItem('multimedia_upload_data_id'));
                                                $('#upload-footer-send-btn-common').attr('data-name', file.file_attributes.name.relative);
                                                $('#upload-preview-container-text-box').text("");
                                                $('#upload-footer-send-btn-common').removeAttr('data-download');
                                                // $('.pdf-view').addClass('hide');
                                                //console.log("CHECKING CLOUD");
                                                if (sessionData.file_type == 'image' || sessionData.file_type == "video" || sessionData.file_type == "audio") {
                                                    //console.log("CHECKING CLOUD-add hide");
                                                    $('.pdf-view').addClass('hide');
                                                } else {
                                                    //console.log("CHECKING CLOUD-remove hide");
                                                    $('.pdf-view').addClass('hide');
                                                }
                                                // $('.remove-attached-uploading-file').attr('data-identifier', asset_ids[0]);
                                                if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
                                                    $('.header-band').addClass('hide');
                                                }
                                                //need to be commented start
                                                var loadedfile = `<div class="grid selected-multimedia-files" data-type="file" data-upload-type="cloud">
                                                <img class="hide" src="${sessionData.url}"/>
                                                        <div class="thumbnail-wrapper">
                                                           <a class="">
                                                              <div class="thumbnail"></div>
                                                           </a>                     
                                                        </div>
                                                        <div class="file-details ellipsify">
                                                           <div class="file-name">
                                                              <a class="thumb-title">${file.file_attributes.name.relative}</a>
                                                           </div>  
                                                           <div class="file-size">
                                                           <div class="thumb-meta">
                                                              <span class="thumb-info">${file.file_attributes.size.filesize}</span>
                                                           </div>
                                                        </div>                    
                                                        </div>
                                                        <div class="file-selected-remove-btn">
                                                        <i class="material-icons">cancel</i>
                                                    </div>
                                                     </div>`;
                                                //console.log("loadedfile", loadedfile);
                                                var getDeviceUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
                                                //console.log("getDeviceUploadTo", getDeviceUploadTo);
                                                if (getDeviceUploadTo == "identity-proof-load-btn") {
                                                    $('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "pancard-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "shop-established-license-load-btn") {
                                                    //console.log("111");
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "gst-license-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "partnership-deed-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "partnership-registration-certificate-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "llp-registration-certificate-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "transaction-person-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "memorandum-of-association-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "articles-of-association-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                } else if (getDeviceUploadTo == "trust-establishment-license-load-btn") {
                                                    $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
                                                }
                                                // })
                                                // .catch((err) => {
                                                //     //console.log("234567", err);
                                                // })
                                                //need to commented end
                                            }
                                        })
                                            .catch((err) => {
                                                if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
                                                    $('#upload-preview-close-btn').click();
                                                }
                                                //console.log(err);
                                            });
                                    } else {
                                        $("#upload-file-preview").html('Selected asset is deleted');
                                        $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
                                    }

                                }).catch((err) => {
                                    //console.log(err);
                                });
                            }
                        });
                    } else {
                        Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
                        $('.filemanger_container_toggle').addClass('active');
                    }
                }
            }
        }
    });

    // $(document).on('click', '#attach_file_btn', function (e) {
    //     e.stopPropagation();
    //     //close side bar
    //     if ($('#filemanger_container_toggle').hasClass('active')) {
    //         $('#filemanger_container_toggle').removeClass('active');
    //     }
    //     if (sessionStorage.getItem('individual_assets')) {
    //         if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details") {
    //             if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                 //get selected files
    //                 var asset_ids = [];
    //                 $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                     asset_ids.push($(element).attr('data-asset_id'));

    //                     //show loader in thubnail area
    //                     $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                     //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
    //                     if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                         getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                             if (file.is_trashed == false) {
    //                                 individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                     if (sessionData) {
    //                                         $('.filemanger_container_toggle').removeClass('active');
    //                                         window.sessionStorage.removeItem('breadcrumb_path');
    //                                         var modal_data = {
    //                                             modal_platform: crossplat.device.platform,
    //                                             modal_id: "group-image-modal",
    //                                             modal_header: "",
    //                                             modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                             modal_action_buttons: [{
    //                                                 id: "group-image-crop-button",
    //                                                 name: `crop`,
    //                                                 attr: [{
    //                                                     name: "data-id",
    //                                                     value: ''
    //                                                 }]
    //                                             }]
    //                                         }
    //                                         showModal(modal_data, function () {
    //                                             removeLoader();
    //                                             // if ($('.modal-popup-content').length > 0) {
    //                                             //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                             //         //console.log("scroll initiated for modal pop-up class")
    //                                             //         appScroll.scrollBar('.modal-popup-content');
    //                                             //     }
    //                                             // }
    //                                             $('#group-image-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                             $('#group-image-modal').attr('picture-type', 'group_image');
    //                                         });
    //                                         setTimeout(function () {
    //                                             var image = document.getElementById('image_cropper');
    //                                             image.src = sessionData.url;
    //                                             //console.log("image.src", image.src);
    //                                             $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                             digibiz.cropper = new Cropper(image, {
    //                                                 viewMode: 2,
    //                                                 aspectRatio: 1 / 1,
    //                                                 minContainerWidth: 72,
    //                                                 minContainerHeight: 72,
    //                                                 minCropBoxWidth: 72,
    //                                                 minCropBoxHeight: 72,
    //                                                 maxWidth: 100,
    //                                                 maxHeight: 400,
    //                                                 zoomable: true,
    //                                                 rotatable: true,
    //                                                 responsive: true,
    //                                                 movable: true,
    //                                                 ready: function () {
    //                                                     //cropper.zoom(-0.6);
    //                                                 }
    //                                             });
    //                                         }, 300);
    //                                     }
    //                                 }).catch((err) => {
    //                                     if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
    //                                         $('#upload-preview-close-btn').click();
    //                                     }
    //                                     //console.log(err);
    //                                 });
    //                             } else {
    //                                 $("#upload-file-preview").html('Selected asset is deleted');
    //                                 $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                             }

    //                         }).catch((err) => {
    //                             //console.log(err);
    //                         });
    //                     }
    //                 });
    //             } else {
    //                 Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                 $('.filemanger_container_toggle').addClass('active');
    //             }
    //         } else if (sessionStorage.getItem('customer_id')) {
    //             if ($('#edit-associate-customer-modal').length > 0) {
    //                 //console.log("inside edit modal");
    //                 if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                             getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "associate-customer-identity-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "associate-customer-identity-crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: ''
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
    //                                             });
    //                                             setTimeout(function () {
    //                                                 var image = document.getElementById('image_cropper');
    //                                                 image.src = sessionData.url;
    //                                                 //console.log("image.src", image.src);
    //                                                 $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                             }, 300);
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             } else {//for customer
    //                 if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                             getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "customer-identity-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "customer-identity-crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: ''
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
    //                                             });
    //                                             setTimeout(function () {
    //                                                 var image = document.getElementById('image_cropper');
    //                                                 image.src = sessionData.url;
    //                                                 //console.log("image.src", image.src);
    //                                                 $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                             }, 300);
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             }
    //         } else if (sessionStorage.getItem('employee_id')) {//employee identity picture
    //             if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                 //get selected files
    //                 var asset_ids = [];
    //                 $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                     asset_ids.push($(element).attr('data-asset_id'));

    //                     //show loader in thubnail area
    //                     $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                     //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
    //                     if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                         getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                             if (file.is_trashed == false) {
    //                                 individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                     if (sessionData) {
    //                                         $('.filemanger_container_toggle').removeClass('active');
    //                                         window.sessionStorage.removeItem('breadcrumb_path');
    //                                         var modal_data = {
    //                                             modal_platform: crossplat.device.platform,
    //                                             modal_id: "employee-identity-picture-modal",
    //                                             modal_header: "",
    //                                             modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                             modal_action_buttons: [{
    //                                                 id: "employee-identity-crop-button",
    //                                                 name: `crop`,
    //                                                 attr: [{
    //                                                     name: "data-id",
    //                                                     value: ''
    //                                                 }]
    //                                             }]
    //                                         }
    //                                         showModal(modal_data, function () {
    //                                             removeLoader();
    //                                             // if ($('.modal-popup-content').length > 0) {
    //                                             //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                             //         //console.log("scroll initiated for modal pop-up class")
    //                                             //         appScroll.scrollBar('.modal-popup-content');
    //                                             //     }
    //                                             // }
    //                                             $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                             $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
    //                                         });
    //                                         setTimeout(function () {
    //                                             var image = document.getElementById('image_cropper');
    //                                             image.src = sessionData.url;
    //                                             //console.log("image.src", image.src);
    //                                             $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                             digibiz.cropper = new Cropper(image, {
    //                                                 viewMode: 2,
    //                                                 aspectRatio: 1 / 1,
    //                                                 minContainerWidth: 72,
    //                                                 minContainerHeight: 72,
    //                                                 minCropBoxWidth: 72,
    //                                                 minCropBoxHeight: 72,
    //                                                 maxWidth: 100,
    //                                                 maxHeight: 400,
    //                                                 zoomable: true,
    //                                                 rotatable: true,
    //                                                 responsive: true,
    //                                                 movable: true,
    //                                                 ready: function () {
    //                                                     //cropper.zoom(-0.6);
    //                                                 }
    //                                             });
    //                                         }, 300);
    //                                     }
    //                                 }).catch((err) => {
    //                                     if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
    //                                         $('#upload-preview-close-btn').click();
    //                                     }
    //                                     //console.log(err);
    //                                 });
    //                             } else {
    //                                 $("#upload-file-preview").html('Selected asset is deleted');
    //                                 $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                             }

    //                         }).catch((err) => {
    //                             //console.log(err);
    //                         });
    //                     }
    //                 });
    //             } else {
    //                 Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                 $('.filemanger_container_toggle').addClass('active');
    //             }
    //         } else if (sessionStorage.getItem('business_id')) {
    //             if (sessionStorage.getItem('cloud_upload_for')) {
    //                 var getDeclarationFor = sessionStorage.getItem('cloud_upload_for');
    //                 if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                             getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "transaction-signature-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: getDeclarationFor
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#transaction-signature-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
    //                                             });
    //                                             setTimeout(function () {
    //                                                 var image = document.getElementById('image_cropper');
    //                                                 image.src = sessionData.url;
    //                                                 //console.log("image.src", image.src);
    //                                                 $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                             }, 300);
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             } else if (sessionStorage.getItem('business_upload_for')) {//business display picture
    //                 if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='individualFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                             getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "business-display-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "business-display-crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: ''
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#business-display-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
    //                                             });
    //                                             setTimeout(function () {
    //                                                 var image = document.getElementById('image_cropper');
    //                                                 image.src = sessionData.url;
    //                                                 //console.log("image.src", image.src);
    //                                                 $('#business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                             }, 300);
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='individualFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             } else {
    //                 if ($("input[name='individualFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='individualFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));
    //                         digibiz.cloud_multimedia_selected_files.push($(element).attr('data-asset_id'));
    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         if (index + 1 == $("input[name='individualFilemanagerFileSelection[]']:checked").length) {
    //                             getIndividualAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {

    //                                     individualStartFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             var content = await viewFile(sessionData.file_type, sessionData.extension, sessionData.url);
    //                                             getBlobFromURL(sessionData.url).then((blob) => {
    //                                                 //create object urls
    //                                                 digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);

    //                                                 var reader = new FileReader;
    //                                                 reader.onloadend = function () {
    //                                                     // generateThubnail(this.result, 'base64').then((thubnail) => {
    //                                                         //add preview thumbnails
    //                                                         $(".upload-footer-attatched-file").removeClass('active');
    //                                                         if (['image', 'video'].includes(sessionData.file_type)) {
    //                                                             $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<img src="${thubnail}"/><span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                                             $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass('active');
    //                                                         } else {
    //                                                             $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).addClass(`active file-type-${sessionData.file_type} icomoon-`);
    //                                                             $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                                         }

    //                                                         //add extension and file type
    //                                                         $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileType', sessionData.file_type);
    //                                                         $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).attr('data-fileExtension', sessionData.extension);

    //                                                         digibiz.uploadingFiles.push({
    //                                                             identifier: asset_ids[0],
    //                                                             file: file,
    //                                                             fileURI: digibiz.objectURLS[asset_ids[0]],
    //                                                             thumbnail: thubnail,
    //                                                             room: room,
    //                                                             group_id: group_id,
    //                                                             group_of: group_of,
    //                                                             channel_id: channel_id,
    //                                                             receiver_type: receiver_type,
    //                                                             contact_id: contact_id,
    //                                                             "individual_storage": true
    //                                                         });
    //                                                     // });
    //                                                 }
    //                                                 reader.readAsDataURL(blob);
    //                                             })
    //                                         }
    //                                     })
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             }
    //         }
    //     } else if (sessionStorage.getItem('digibiz_assets')) {
    //         if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details") {
    //             if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                 //get selected files
    //                 var asset_ids = [];
    //                 $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                     asset_ids.push($(element).attr('data-asset_id'));

    //                     //show loader in thubnail area
    //                     $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                     if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                         getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                             if (file.is_trashed == false) {
    //                                 startFileSession(file, 'view').then(async (sessionData) => {
    //                                     if (sessionData) {
    //                                         $('.filemanger_container_toggle').removeClass('active');
    //                                         window.sessionStorage.removeItem('breadcrumb_path');
    //                                         var modal_data = {
    //                                             modal_platform: crossplat.device.platform,
    //                                             modal_id: "group-image-modal",
    //                                             modal_header: "",
    //                                             modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                             modal_action_buttons: [{
    //                                                 id: "group-image-crop-button",
    //                                                 name: `crop`,
    //                                                 attr: [{
    //                                                     name: "data-id",
    //                                                     value: ''
    //                                                 }]
    //                                             }]
    //                                         }
    //                                         showModal(modal_data, function () {
    //                                             removeLoader();
    //                                             // if ($('.modal-popup-content').length > 0) {
    //                                             //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                             //         //console.log("scroll initiated for modal pop-up class")
    //                                             //         appScroll.scrollBar('.modal-popup-content');
    //                                             //     }
    //                                             // }
    //                                             $('#group-image-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                             $('#group-image-modal').attr('picture-type', 'group_image');
    //                                             setTimeout(function () {
    //                                                 var image = document.getElementById('image_cropper');
    //                                                 //console.log("image", image);
    //                                                 image.src = sessionData.url;
    //                                                 //console.log("image.src", image.src);
    //                                                 $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                             }, 300);
    //                                         });
    //                                     }
    //                                 }).catch((err) => {
    //                                     if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
    //                                         $('#upload-preview-close-btn').click();
    //                                     }
    //                                     //console.log(err);
    //                                 });
    //                             } else {
    //                                 $("#upload-file-preview").html('Selected asset is deleted');
    //                                 $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                             }

    //                         }).catch((err) => {
    //                             //console.log(err);
    //                         });
    //                     }
    //                 });
    //             } else {
    //                 Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                 $('.filemanger_container_toggle').addClass('active');
    //             }
    //         } else if (sessionStorage.getItem('customer_id')) {
    //             if ($('#edit-associate-customer-modal').length > 0) {
    //                 //console.log("inside edit modal");
    //                 if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                             getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     startFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "associate-customer-identity-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "associate-customer-identity-crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: ''
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
    //                                                 setTimeout(function () {
    //                                                     var image = document.getElementById('image_cropper');
    //                                                     //console.log("image", image);
    //                                                     image.src = sessionData.url;
    //                                                     //console.log("image.src", image.src);
    //                                                     $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                     digibiz.cropper = new Cropper(image, {
    //                                                         viewMode: 2,
    //                                                         aspectRatio: 1 / 1,
    //                                                         minContainerWidth: 72,
    //                                                         minContainerHeight: 72,
    //                                                         minCropBoxWidth: 72,
    //                                                         minCropBoxHeight: 72,
    //                                                         maxWidth: 100,
    //                                                         maxHeight: 400,
    //                                                         zoomable: true,
    //                                                         rotatable: true,
    //                                                         responsive: true,
    //                                                         movable: true,
    //                                                         ready: function () {
    //                                                             //cropper.zoom(-0.6);
    //                                                         }
    //                                                     });
    //                                                 }, 300);
    //                                             });
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }

    //             } else {//for customer
    //                 if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                             getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     startFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "customer-identity-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "customer-identity-crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: ''
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
    //                                                 setTimeout(function () {
    //                                                     var image = document.getElementById('image_cropper');
    //                                                     image.src = sessionData.url;
    //                                                     //console.log("image.src", image.src);
    //                                                     $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                     digibiz.cropper = new Cropper(image, {
    //                                                         viewMode: 2,
    //                                                         aspectRatio: 1 / 1,
    //                                                         minContainerWidth: 72,
    //                                                         minContainerHeight: 72,
    //                                                         minCropBoxWidth: 72,
    //                                                         minCropBoxHeight: 72,
    //                                                         maxWidth: 100,
    //                                                         maxHeight: 400,
    //                                                         zoomable: true,
    //                                                         rotatable: true,
    //                                                         responsive: true,
    //                                                         movable: true,
    //                                                         ready: function () {
    //                                                             //cropper.zoom(-0.6);
    //                                                         }
    //                                                     });
    //                                                 }, 300);
    //                                             });
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             }
    //         } else if (sessionStorage.getItem('employee_id')) {//employee identity picture
    //             if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                 //get selected files
    //                 var asset_ids = [];
    //                 $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                     asset_ids.push($(element).attr('data-asset_id'));

    //                     //show loader in thubnail area
    //                     $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                     //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
    //                     if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                         getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                             if (file.is_trashed == false) {
    //                                 startFileSession(file, 'view').then(async (sessionData) => {
    //                                     if (sessionData) {
    //                                         $('.filemanger_container_toggle').removeClass('active');
    //                                         window.sessionStorage.removeItem('breadcrumb_path');
    //                                         var modal_data = {
    //                                             modal_platform: crossplat.device.platform,
    //                                             modal_id: "employee-identity-picture-modal",
    //                                             modal_header: "",
    //                                             modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                             modal_action_buttons: [{
    //                                                 id: "employee-identity-crop-button",
    //                                                 name: `crop`,
    //                                                 attr: [{
    //                                                     name: "data-id",
    //                                                     value: ''
    //                                                 }]
    //                                             }]
    //                                         }
    //                                         showModal(modal_data, function () {
    //                                             removeLoader();
    //                                             // if ($('.modal-popup-content').length > 0) {
    //                                             //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                             //         //console.log("scroll initiated for modal pop-up class")
    //                                             //         appScroll.scrollBar('.modal-popup-content');
    //                                             //     }
    //                                             // }
    //                                             $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                             $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
    //                                             setTimeout(function () {
    //                                                 var image = document.getElementById('image_cropper');
    //                                                 image.src = sessionData.url;
    //                                                 //console.log("image.src", image.src);
    //                                                 $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 0,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                     }
    //                                                 });
    //                                             }, 300);
    //                                         });
    //                                     }
    //                                 }).catch((err) => {
    //                                     if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
    //                                         $('#upload-preview-close-btn').click();
    //                                     }
    //                                     //console.log(err);
    //                                 });
    //                             } else {
    //                                 $("#upload-file-preview").html('Selected asset is deleted');
    //                                 $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                             }

    //                         }).catch((err) => {
    //                             //console.log(err);
    //                         });
    //                     }
    //                 });
    //             } else {
    //                 Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                 $('.filemanger_container_toggle').addClass('active');
    //             }
    //         } else if (sessionStorage.getItem('business_id')) {
    //             if (sessionStorage.getItem('cloud_upload_for')) {
    //                 //console.log("11")
    //                 var getDeclarationFor = sessionStorage.getItem('cloud_upload_for');
    //                 if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                             getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     startFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "transaction-signature-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: getDeclarationFor
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#transaction-signature-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
    //                                                 setTimeout(function () {
    //                                                     var image = document.getElementById('image_cropper');
    //                                                     image.src = sessionData.url;
    //                                                     //console.log("image.src", image.src);
    //                                                     $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                     digibiz.cropper = new Cropper(image, {
    //                                                         viewMode: 2,
    //                                                         aspectRatio: 1 / 1,
    //                                                         minContainerWidth: 72,
    //                                                         minContainerHeight: 72,
    //                                                         minCropBoxWidth: 72,
    //                                                         minCropBoxHeight: 72,
    //                                                         maxWidth: 100,
    //                                                         maxHeight: 400,
    //                                                         zoomable: true,
    //                                                         rotatable: true,
    //                                                         responsive: true,
    //                                                         movable: true,
    //                                                         ready: function () {
    //                                                             //cropper.zoom(-0.6);
    //                                                         }
    //                                                     });
    //                                                 }, 300);
    //                                             });
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             } else if (sessionStorage.getItem('business_upload_for')) {//business display picture
    //                 if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));

    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                             getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                                 if (file.is_trashed == false) {
    //                                     startFileSession(file, 'view').then(async (sessionData) => {
    //                                         if (sessionData) {
    //                                             $('.filemanger_container_toggle').removeClass('active');
    //                                             window.sessionStorage.removeItem('breadcrumb_path');
    //                                             var modal_data = {
    //                                                 modal_platform: crossplat.device.platform,
    //                                                 modal_id: "business-display-picture-modal",
    //                                                 modal_header: "",
    //                                                 modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                                                 modal_action_buttons: [{
    //                                                     id: "business-display-crop-button",
    //                                                     name: `crop`,
    //                                                     attr: [{
    //                                                         name: "data-id",
    //                                                         value: ''
    //                                                     }]
    //                                                 }]
    //                                             }
    //                                             showModal(modal_data, function () {
    //                                                 removeLoader();
    //                                                 // if ($('.modal-popup-content').length > 0) {
    //                                                 //     if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                                 //         //console.log("scroll initiated for modal pop-up class")
    //                                                 //         appScroll.scrollBar('.modal-popup-content');
    //                                                 //     }
    //                                                 // }
    //                                                 $('#business-display-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                                                 $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
    //                                                 setTimeout(function () {
    //                                                     var image = document.getElementById('image_cropper');
    //                                                     image.src = sessionData.url;
    //                                                     //console.log("image.src", image.src);
    //                                                     $('#business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                     digibiz.cropper = new Cropper(image, {
    //                                                         viewMode: 2,
    //                                                         aspectRatio: 1 / 1,
    //                                                         minContainerWidth: 72,
    //                                                         minContainerHeight: 72,
    //                                                         minCropBoxWidth: 72,
    //                                                         minCropBoxHeight: 72,
    //                                                         maxWidth: 100,
    //                                                         maxHeight: 400,
    //                                                         zoomable: true,
    //                                                         rotatable: true,
    //                                                         responsive: true,
    //                                                         movable: true,
    //                                                         ready: function () {
    //                                                             //cropper.zoom(-0.6);
    //                                                         }
    //                                                     });
    //                                                 }, 300);
    //                                             });
    //                                         }
    //                                     }).catch((err) => {
    //                                         if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length == 1) {
    //                                             $('#upload-preview-close-btn').click();
    //                                         }
    //                                         //console.log(err);
    //                                     });
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             } else {
    //                 //console.log("33")
    //                 if ($("input[name='digibizFilemanagerFileSelection[]']:checked").length > 0) {
    //                     //get selected files
    //                     var asset_ids = [];
    //                     $.each($("input[name='digibizFilemanagerFileSelection[]']:checked"), function (index, element) {
    //                         asset_ids.push($(element).attr('data-asset_id'));
    //                         digibiz.cloud_multimedia_selected_files.push($(element).attr('data-asset_id'));
    //                         //show loader in thubnail area
    //                         $("#upload-footer-attached-files-list").append(`<div class="upload-footer-attatched-file" data-identifier="${$(element).attr('data-asset_id')}"><svg width="50px" height="50px" class="material-loader"><circle cx="25" cy="25" r="20" class="material-loader__circle" /></svg></div>`);

    //                         //console.log("check", index + 1, $("input[name='digibizFilemanagerFileSelection[]']:checked").length);
    //                         if (index + 1 == $("input[name='digibizFilemanagerFileSelection[]']:checked").length) {
    //                             getDigibizAssetDetails(asset_ids[0]).then((file) => {
    //                                 //console.log("file", file);
    //                                 if (file.is_trashed == false) {
    //                                     // var sessionData = startFileSession(file, 'view');
    //                                     // if (sessionData) {
    //                                     //     //console.log("sessionData", sessionData);
    //                                     //     var blob = getBlobFromURL(sessionData.url);
    //                                     //     //console.log("blob", blob);
    //                                     //     var base64Content = blob2Base64(blob);
    //                                     //     //console.log("base64Content", base64Content);
    //                                     // }
    //                                     var reqParams = {
    //                                         device_id: crossplat.device.uuid,
    //                                         business_id: sessionStorage.getItem('business_id'),
    //                                         image_id: file.file_attributes.id
    //                                     }
    //                                     digibizCloudFileRead(reqParams)
    //                                         .then((response) => {
    //                                             var loadedfile = `<div class="grid selected-multimedia-files" data-type="file" data-upload-type="cloud">
    //                                     <img class="hide" src="${response}"/>
    //                                             <div class="thumbnail-wrapper">
    //                                                <a class="">
    //                                                   <div class="thumbnail"></div>
    //                                                </a>                     
    //                                             </div>
    //                                             <div class="file-details ellipsify">
    //                                                <div class="file-name">
    //                                                   <a class="thumb-title">${file.file_attributes.name.relative}</a>
    //                                                </div>  
    //                                                <div class="file-size">
    //                                                <div class="thumb-meta">
    //                                                   <span class="thumb-info">${file.file_attributes.size.filesize}</span>
    //                                                </div>
    //                                             </div>                    
    //                                             </div>
    //                                             <div class="file-selected-remove-btn">
    //                                             <i class="material-icons">cancel</i>
    //                                         </div>
    //                                          </div>`;
    //                                             //console.log("loadedfile", loadedfile);
    //                                             var getDeviceUploadTo = sessionStorage.getItem('multimedia_upload_data_id');
    //                                             //console.log("getDeviceUploadTo", getDeviceUploadTo);
    //                                             if (getDeviceUploadTo == "identity-proof-load-btn") {
    //                                                 $('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "pancard-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "shop-established-license-load-btn") {
    //                                                 //console.log("111");
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "gst-license-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "partnership-deed-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "partnership-registration-certificate-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "llp-registration-certificate-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "transaction-person-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "memorandum-of-association-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "articles-of-association-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             } else if (getDeviceUploadTo == "trust-establishment-license-load-btn") {
    //                                                 $(`.multimedia-append-container[data-id="${getDeviceUploadTo}"]`).append(loadedfile);
    //                                             }
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("234567", err);
    //                                         })
    //                                 } else {
    //                                     $("#upload-file-preview").html('Selected asset is deleted');
    //                                     $("#upload-footer-attached-files-list").find(`div[data-identifier="${asset_ids[0]}"]`).html(`<span class="mask"><i class="material-icons remove-attached-uploading-file">close</i></span>`);
    //                                 }

    //                             }).catch((err) => {
    //                                 //console.log(err);
    //                             });
    //                         }
    //                     });
    //                 } else {
    //                     Materialize.toast("Please select atlest one file", 4000, 'round error-alert');
    //                     $('.filemanger_container_toggle').addClass('active');
    //                 }
    //             }
    //         }
    //     }
    // });


    //camera upload
    $(document).on('click', '.action-multimedia-upload-attachment-camera-btn', function () {

    });


    //action sheet on business
    $(document).on('click', '#show_action_business', function () {
        //get business id
        var getBusinessId = $(this).parents('.business-content-box').attr('data-id');
        var action_sheet_parms = {
            action_id: "business_actions",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "class", value: "business_edit" }]
            },
            {
                name: "Delete",
                attr: [{ name: "class", value: "business_delete" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('business_id', getBusinessId);
        });
    });

    //edit business
    $(document).on('click', '.business_edit', function () {
        //get business id
        addLoader();
        var getBusinessId = $(".action-sheet-container").attr('business_id');
        sessionStorage.setItem('business_id', getBusinessId);
        location.hash = `business/edit`;
    });

    $(document).on('click', '.land-page', function () {
        addLoader();
        location.hash = `land/page`;
    });

    $(document).on('click', '.profile_manager', function () {
        addLoader();
        location.hash = `profile/manager`;
    });


    $(document).on('click', '.cancel-bussines-btn', function () {
        addLoader();
        if (sessionStorage.getItem('business_id')) {
            if (sessionStorage.getItem('digibiz_role') == "employee") {
                // location.hash = `employee/business/apps/hub`;
                sessionStorage.removeItem('business_id');
                // location.hash = `employee/business/list`;
                location.hash = `employee/business/list`;
            } else if (sessionStorage.getItem('digibiz_role') == "customer") {
                sessionStorage.removeItem('business_id');
                // location.hash = `customer/business/list`;
                location.hash = `customer/business/list`;
                // location.hash = `customer/business/apps/hub`;
            } else {
                var getNavigationPath;
                if (digibiz.business_owner_business_list.length > 0) {
                    getNavigationPath = `business_owner/business/list`;
                } else {
                    getNavigationPath = `jeevi/app/hub`;
                }
                reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id'),
                    data: {
                        socket_enable_status: "true",
                    }
                }
                //console.log("reqParam", reqParam);
                businessUpdate(reqParam)
                    .then((response) => {
                        //console.log("businessUpdate", response);
                        if ($('body').attr('app') == "business_edit") {
                            location.hash = `business/profile/management`;
                        } else {
                            sessionStorage.removeItem('business_id');
                            location.hash = getNavigationPath;
                        }
                    })
                    .catch((err) => {
                        //console.log("error in update business api", err);
                        if (err.msg == "no updated data found") {
                            if ($('body').attr('app') == "business_edit") {
                                location.hash = `business/profile/management`;
                            } else {
                                sessionStorage.removeItem('business_id');
                                location.hash = getNavigationPath;
                            }
                        }
                    })
            }
        } else {
            if (digibiz.business_owner_business_list.length > 0) {
                //console.log("33333")
                location.hash = `business_owner/business/list`;
            } else {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('account_id'),
                    role: "administrator",
                    status: "pending"
                }
                updateDigibizAccount(reqParam)
                    .then((response) => {
                        //console.log("44444")
                        if (sessionStorage.getItem('get_role_btn') == "profile-btn") {
                            location.hash = `digibiz/profile`;
                        } else {
                            location.hash = `jeevi/app/hub`;
                            console.log('fwefwef');
                        }
                    })
                    .catch((err) => {
                        //console.log("err could not update administrator role", err);
                    })
            }
        }
    });
    $(document).on('click', '.add-identity-proof-btn', function () {
        addLoader();
        var $this = $(this);
        if ($('.business-add-identity-proof-wrapper').length >= config.businessIdProofNumber) {
            Materialize.toast("Can add only 3 ID proofs", 4000, 'round error-alert');
            removeLoader();
        } else {
            //         var template = `<div class="business-add-identity-proof-wrapper">
            //     <div class="business-add-identity-proof-type-container">
            //         <div class="business-add-identity-proof-type-sub-container">
            //             <label for="business-add-identity-proof-type-select-dropdown">Select ID Type</label>
            //             <select id="business-add-identity-proof-type-select-dropdown" class="browser-default">
            //                 <option value="">--Select Type--</option>                                                    
            //                 <option value="aadhar-card">Aadhar Card</option>
            //                 <option value="driving-license">Driving License</option>
            //                 <option value="election-card">Election Card</option>
            //             </select>
            //         </div>
            //         <a class="waves-effect waves-light btn multimedia-upload cursor-pointer identity-proof-load-btn" data-id="identity-proof-load-btn"><i class="material-icons">attach_file</i></a>
            //         <a class="waves-effect waves-light btn multimedia-save cursor-pointer " data-id="identity-proof-load-btn"><i class="material-icons">save</i></a>
            //     </div>        
            //     <div class="business-add-identity-proof-multimedia-wrapper multimedia-append-container" data-id="identity-proof-load-btn"></div>
            // </div>`;
            //         $('.business-identity-proof-content-box').append(template);
            fetch.appendHtml(function (err) {
                //console.log("completed***")
            }, 'layouts/popup/add_identity_proof', '#add-identity-proof-template', '.business-identity-proof-content-box', null);
            $('.add-identity-proof-btn').remove();
            removeLoader();
        }
    });

    // $(document).on('click', '.multimedia-save', function (e) {
    //     e.stopImmediatePropagation();
    //     if (isDoubleClicked($(this))) return;
    //     addLoader();
    //     // var reqParam;
    //     var $this = $(this);
    //     $($this).attr('disabled', true);
    //     var getDataId = $(this).attr('data-id');
    //     if (validateBeforeSave(getDataId)) {
    //         //console.log("success part");
    //         if (getDataId == "identity-proof-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 id_proofs: {
    //                                     id_proof_type: $($this).siblings('.business-add-identity-proof-type-sub-container').find('.selected-value-business-identity-proof-type').attr('data-value'),
    //                                     // id_proof_number: $('#identity_proof_text_box').text(),
    //                                     id_proof_multimedia: {
    //                                         name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                         size: multimediaResponse.msg.Data.filedata.filesize,
    //                                         thumbnail: multimediaResponse.Data.file
    //                                     }
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 $('.business-identity-proof-content-box').empty();
    //                                 // if (response.hasOwnProperty('id_proofs') && Object.keys(response['id_proofs']['id_proof_multimedia']).length > 0) {
    //                                 //     await asyncEach(response['id_proofs']['id_proof_multimedia'], async (e, index) => {
    //                                 //         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                 //     });
    //                                 // }
    //                                 if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
    //                                     $.each(response.id_proofs, function (index, id_proof) {
    //                                         //console.log("check", id_proof.id_proof_type);
    //                                         //                 var loadedfile = `<div class="business-add-identity-proof-wrapper">
    //                                         //                 <div class="business-add-identity-proof-type-container">
    //                                         //                     <div class="business-add-identity-proof-type-sub-container">
    //                                         //                         <label for="business-add-identity-proof-type-select-dropdown">Select ID Type</label>
    //                                         //                         <select id="business-add-identity-proof-type-select-dropdown" class="browser-default" disabled>
    //                                         //                             <option value="">--Select Type--</option>                                                    
    //                                         //                             <option value="aadhar-card">Aadhar Card</option>
    //                                         //                             <option value="driving-license">Driving License</option>
    //                                         //                             <option value="election-card">Election Card</option>
    //                                         //                         </select>
    //                                         //                     </div>
    //                                         //                     <a class="waves-effect waves-light btn add-identity-proof-btn"><i class="material-icons">add</i></a>
    //                                         //                 </div>                                            
    //                                         //                 <div class="business-add-identity-proof-multimedia-wrapper multimedia-append-container" data-id="identity-proof-load-btn">
    //                                         //                 <div class="grid uploaded-multimedia-files" data-type="file">
    //                                         //     <div class="thumbnail-wrapper">
    //                                         //        <a class="">
    //                                         //           <div class="thumbnail"></div>
    //                                         //        </a>                     
    //                                         //     </div>
    //                                         //     <div class="file-details ellipsify" data-image-id="${id_proof.id_proof_multimedia.thumbnail}">
    //                                         //        <div class="file-name">
    //                                         //           <a class="thumb-title">${id_proof.id_proof_multimedia.name}</a>
    //                                         //        </div>  
    //                                         //        <div class="file-size">
    //                                         //        <div class="thumb-meta">
    //                                         //           <span class="thumb-info">${id_proof.id_proof_multimedia.size}</span>
    //                                         //        </div>
    //                                         //     </div>                    
    //                                         //     </div>
    //                                         //     <div class="file-selected-remove-btn hide">
    //                                         //     <i class="material-icons">cancel</i>
    //                                         // </div>
    //                                         //  </div>`;
    //                                         var getData = {
    //                                             id_proof: id_proof
    //                                         };
    //                                         fetch.appendHtml(function (err) {
    //                                             //console.log("completed***")
    //                                         }, 'layouts/popup/added_identity_proof', '#added-identity-proof-template', '.business-identity-proof-content-box', getData);

    //                                         // $('.business-identity-proof-content-box').append(loadedfile);
    //                                         $(`.file-details[data-image-id="${id_proof.id_proof_multimedia.thumbnail}"]`).parents('.business-add-identity-proof-wrapper').find('#business-add-identity-proof-type-select-dropdown').find(`option[value="${id_proof.id_proof_type}"]`).prop("selected", "selected");
    //                                     })
    //                                 }
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "pancard-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 pan_card_details: {
    //                                     pan_card_number: $('#business_pancard').text(),
    //                                     pan_card_multimedia: {
    //                                         name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                         size: multimediaResponse.msg.Data.filedata.filesize,
    //                                         thumbnail: multimediaResponse.Data.file
    //                                     }
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     // if (response.hasOwnProperty('pan_card_details') && response['pan_card_details']['pan_card_multimedia'].length > 0) {
    //                                     if (response.pan_card_details !== undefined && response.pan_card_details.pan_card_multimedia.length > 0) {
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response.pan_card_details.pan_card_multimedia, async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no")
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "shop-established-license-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 shop_established_license: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('shop_established_license') && response['shop_established_license'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['shop_established_license'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "gst-license-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 gst_details: {
    //                                     gst_number: $('#business_gst_license').text(),
    //                                     gst_multimedia: {
    //                                         name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                         size: multimediaResponse.msg.Data.filedata.filesize,
    //                                         thumbnail: multimediaResponse.Data.file
    //                                     }
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     // if (response.hasOwnProperty('pan_card_details') && response['pan_card_details']['pan_card_multimedia'].length > 0) {
    //                                     if (response.gst_details !== undefined && response.gst_details.gst_multimedia.length > 0) {
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response.gst_details.gst_multimedia, async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no")
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "partnership-deed-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 partnership_deed: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('partnership_deed') && response['partnership_deed'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['partnership_deed'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "partnership-registration-certificate-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 partnership_registration_certificate: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('partnership_registration_certificate') && response['partnership_registration_certificate'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['partnership_registration_certificate'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "llp-registration-certificate-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 llp_registration_certificate: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('llp_registration_certificate') && response['llp_registration_certificate'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['llp_registration_certificate'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "transaction-person-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 transaction_person: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('transaction_person') && response['transaction_person'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['transaction_person'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "memorandum-of-association-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 memorandum_of_association: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('memorandum_of_association') && response['memorandum_of_association'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['memorandum_of_association'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "articles-of-association-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 article_of_association: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('article_of_association') && response['article_of_association'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['article_of_association'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         } else if (getDataId == "trust-establishment-license-load-btn") {
    //             var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
    //             //console.log("getImageSource", getImageSource);
    //             if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
    //                 removeLoader();
    //                 $($this).attr('disabled', false);
    //                 Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
    //             } else {
    //                 savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
    //                     if (err) {
    //                         $($this).attr('disabled', false);
    //                         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
    //                     } else {
    //                         //console.log("multimediaResponse", multimediaResponse);
    //                         var reqParam = {
    //                             device_id: crossplat.device.uuid,
    //                             id: sessionStorage.getItem('business_id'),
    //                             data: {
    //                                 trust_foundation_established_licence: {
    //                                     name: $('.selected-multimedia-files').find('.thumb-title').text(),
    //                                     size: multimediaResponse.msg.Data.filedata.filesize,
    //                                     thumbnail: multimediaResponse.Data.file
    //                                 },
    //                             }
    //                         }
    //                         businessUpdate(reqParam)
    //                             .then((response) => {
    //                                 //console.log("businessUpdate", response);
    //                                 digibiz.device_multimedia_uploaded_files = [];
    //                                 digibiz.device_multimedia_selected_files = [];
    //                                 const start = async () => {
    //                                     if (response.hasOwnProperty('trust_foundation_established_licence') && response['trust_foundation_established_licence'].length > 0) {
    //                                         //console.log("length is present");
    //                                         $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
    //                                         await asyncEach(response['trust_foundation_established_licence'], async (e, index) => {
    //                                             //console.log("e", e);
    //                                             await getUploadedBusinessMultimedia(e, getDataId);
    //                                         });
    //                                     } else {
    //                                         //console.log("no length");
    //                                     }
    //                                 }
    //                                 start();
    //                                 Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
    //                                 removeLoader();
    //                                 $($this).attr('disabled', false);
    //                             })
    //                             .catch((err) => {
    //                                 //console.log("error in update business api", err);
    //                                 if (err.msg == "no updated data found") {
    //                                     removeLoader();
    //                                     $($this).attr('disabled', false);
    //                                 }
    //                             })
    //                     }
    //                 })
    //             }
    //         }
    //     } else {
    //         //console.log("else part");
    //         removeLoader();
    //         $($this).attr('disabled', false);
    //         //console.log("error in validateBeforeSave");
    //     }
    // });

    $(document).on('click', '#upload-footer-send-btn-common', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        // var reqParam;
        var $this = $(this);
        $($this).attr('disabled', true);
        var getDataId = $(this).attr('data-id');
        var getDataName = $(this).attr('data-name');
        var getDataDownloadPermission = $(this).attr('data-download');
        var getCaption = $('#upload-preview-container-text-box').text().trim();
        if (validateBeforeSave(getDataId)) {
            //console.log("success part");
            if (getDataId == "identity-proof-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    id_proofs: {
                                        // id_proof_type: $($this).siblings('.business-add-identity-proof-type-sub-container').find('.selected-value-business-identity-proof-type').attr('data-value'),
                                        id_proof_type: $('.business-add-identity-proof-type-sub-container').find('.selected-value-business-identity-proof-type').attr('data-value'),
                                        // id_proof_number: $('#identity_proof_text_box').text(),
                                        id_proof_multimedia: {
                                            name: getDataName,
                                            size: multimediaResponse.msg.Data.filedata.filesize,
                                            thumbnail: multimediaResponse.Data.file,
                                            download: getDataDownloadPermission,
                                            caption: getCaption
                                        }
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    $('.business-identity-proof-content-box').empty();
                                    // if (response.hasOwnProperty('id_proofs') && Object.keys(response['id_proofs']['id_proof_multimedia']).length > 0) {
                                    //     await asyncEach(response['id_proofs']['id_proof_multimedia'], async (e, index) => {
                                    //         await getUploadedMultimedia(e.asset_id, getDataId);
                                    //     });
                                    // }
                                    if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                                        $.each(response.id_proofs, function (index, id_proof) {
                                            //console.log("check", id_proof.id_proof_type);
                                            //                 var loadedfile = `<div class="business-add-identity-proof-wrapper">
                                            //                 <div class="business-add-identity-proof-type-container">
                                            //                     <div class="business-add-identity-proof-type-sub-container">
                                            //                         <label for="business-add-identity-proof-type-select-dropdown">Select ID Type</label>
                                            //                         <select id="business-add-identity-proof-type-select-dropdown" class="browser-default" disabled>
                                            //                             <option value="">--Select Type--</option>                                                    
                                            //                             <option value="aadhar-card">Aadhar Card</option>
                                            //                             <option value="driving-license">Driving License</option>
                                            //                             <option value="election-card">Election Card</option>
                                            //                         </select>
                                            //                     </div>
                                            //                     <a class="waves-effect waves-light btn add-identity-proof-btn"><i class="material-icons">add</i></a>
                                            //                 </div>                                            
                                            //                 <div class="business-add-identity-proof-multimedia-wrapper multimedia-append-container" data-id="identity-proof-load-btn">
                                            //                 <div class="grid uploaded-multimedia-files" data-type="file">
                                            //     <div class="thumbnail-wrapper">
                                            //        <a class="">
                                            //           <div class="thumbnail"></div>
                                            //        </a>                     
                                            //     </div>
                                            //     <div class="file-details ellipsify" data-image-id="${id_proof.id_proof_multimedia.thumbnail}">
                                            //        <div class="file-name">
                                            //           <a class="thumb-title">${id_proof.id_proof_multimedia.name}</a>
                                            //        </div>  
                                            //        <div class="file-size">
                                            //        <div class="thumb-meta">
                                            //           <span class="thumb-info">${id_proof.id_proof_multimedia.size}</span>
                                            //        </div>
                                            //     </div>                    
                                            //     </div>
                                            //     <div class="file-selected-remove-btn hide">
                                            //     <i class="material-icons">cancel</i>
                                            // </div>
                                            //  </div>`;
                                            var getData = {
                                                id_proof: id_proof
                                            };
                                            fetch.appendHtml(function (err) {
                                                //console.log("completed***")
                                            }, 'layouts/popup/added_identity_proof', '#added-identity-proof-template', '.business-identity-proof-content-box', getData);

                                            // $('.business-identity-proof-content-box').append(loadedfile);
                                            $(`.file-details[data-image-id="${id_proof.id_proof_multimedia.thumbnail}"]`).parents('.business-add-identity-proof-wrapper').find('#business-add-identity-proof-type-select-dropdown').find(`option[value="${id_proof.id_proof_type}"]`).prop("selected", "selected");
                                        })
                                    }
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    $('.upload-preview-common-layout').addClass('hide');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "pancard-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    pan_card_details: {
                                        pan_card_number: $('#business_pancard').text(),
                                        pan_card_multimedia: {
                                            name: getDataName,
                                            size: multimediaResponse.msg.Data.filedata.filesize,
                                            thumbnail: multimediaResponse.Data.file,
                                            download: getDataDownloadPermission,
                                            caption: getCaption
                                        }
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        // if (response.hasOwnProperty('pan_card_details') && response['pan_card_details']['pan_card_multimedia'].length > 0) {
                                        if (response.pan_card_details !== undefined && response.pan_card_details.pan_card_multimedia.length > 0) {
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response.pan_card_details.pan_card_multimedia, async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no")
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "shop-established-license-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    shop_established_license: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('shop_established_license') && response['shop_established_license'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['shop_established_license'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "gst-license-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    gst_details: {
                                        gst_number: $('#business_gst_license').text(),
                                        gst_multimedia: {
                                            name: getDataName,
                                            size: multimediaResponse.msg.Data.filedata.filesize,
                                            thumbnail: multimediaResponse.Data.file,
                                            download: getDataDownloadPermission,
                                            caption: getCaption
                                        }
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        // if (response.hasOwnProperty('pan_card_details') && response['pan_card_details']['pan_card_multimedia'].length > 0) {
                                        if (response.gst_details !== undefined && response.gst_details.gst_multimedia.length > 0) {
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response.gst_details.gst_multimedia, async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no")
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "partnership-deed-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    partnership_deed: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('partnership_deed') && response['partnership_deed'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['partnership_deed'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "partnership-registration-certificate-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    partnership_registration_certificate: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('partnership_registration_certificate') && response['partnership_registration_certificate'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['partnership_registration_certificate'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "llp-registration-certificate-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    llp_registration_certificate: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('llp_registration_certificate') && response['llp_registration_certificate'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['llp_registration_certificate'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "transaction-person-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    transaction_person: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('transaction_person') && response['transaction_person'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['transaction_person'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "memorandum-of-association-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    memorandum_of_association: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('memorandum_of_association') && response['memorandum_of_association'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['memorandum_of_association'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "articles-of-association-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    article_of_association: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('article_of_association') && response['article_of_association'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['article_of_association'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            } else if (getDataId == "trust-establishment-license-load-btn") {
                var getImageSource = $(`.multimedia-append-container[data-id="${getDataId}"]`).find('.selected-multimedia-files').find('img').attr('src');
                // var getImageSource = $(".upload-preview-common-layout #upload-file-preview").find('img').attr('src');
                //console.log("getImageSource", getImageSource);
                if (getImageSource == null || getImageSource == undefined || getImageSource == "") {
                    removeLoader();
                    $($this).attr('disabled', false);
                    Materialize.toast("Please add atlest one file", 4000, 'round error-alert');
                } else {
                    savebusinessMultimedia(getImageSource, getDataId, function (err, multimediaResponse) {
                        if (err) {
                            $($this).attr('disabled', false);
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("multimediaResponse", multimediaResponse);
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    trust_foundation_established_licence: {
                                        name: getDataName,
                                        size: multimediaResponse.msg.Data.filedata.filesize,
                                        thumbnail: multimediaResponse.Data.file,
                                        download: getDataDownloadPermission,
                                        caption: getCaption
                                    },
                                }
                            }
                            businessUpdate(reqParam)
                                .then((response) => {
                                    //console.log("businessUpdate", response);
                                    digibiz.device_multimedia_uploaded_files = [];
                                    digibiz.device_multimedia_selected_files = [];
                                    digibiz.uploadingFiles = [];
                                    const start = async () => {
                                        if (response.hasOwnProperty('trust_foundation_established_licence') && response['trust_foundation_established_licence'].length > 0) {
                                            //console.log("length is present");
                                            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.grid`).remove();
                                            await asyncEach(response['trust_foundation_established_licence'], async (e, index) => {
                                                //console.log("e", e);
                                                await getUploadedBusinessMultimedia(e, getDataId);
                                            });
                                        } else {
                                            //console.log("no length");
                                        }
                                    }
                                    start();
                                    $('.upload-preview-common-layout').addClass('hide');
                                    Materialize.toast("Successfully uploaded File", 4000, 'round error-alert');
                                    removeLoader();
                                    $($this).attr('disabled', false);
                                })
                                .catch((err) => {
                                    //console.log("error in update business api", err);
                                    if (err.msg == "no updated data found") {
                                        removeLoader();
                                        $($this).attr('disabled', false);
                                    }
                                })
                        }
                    })
                }
            }
        } else {
            //console.log("else part");
            removeLoader();
            $($this).attr('disabled', false);
            //console.log("error in validateBeforeSave");
        }
    });

    $(document).on('click', '.uploaded-multimedia-files', function () {
        // if (sessionStorage.getItem('digibiz_role') == "employee" || sessionStorage.getItem('digibiz_role') == "customer") {
        //     //console.log("can't display")
        // } else {
        addLoader();
        var getImageId = $(this).find('.file-details').attr('data-image-id');
        var getUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;
        //console.log("getUrl", getUrl);
        var viewer_data = {
            viewer_id: "file-preview-popup",
            viewer_file_id: null,
            viewer_mime_type: "image",
            asset_content: '<img src= "' + getUrl + '">'
        };
        showFileViewer(viewer_data, function () {
            removeLoader();
        });
        // }
    });


    // $(document).on('click', '.multimedia-save', function () {
    //     addLoader();
    //     // var reqParam;
    //     var getDataId = $(this).attr('data-id');
    //     if (validateBeforeSave(getDataId)) {
    //         if (getDataId == "identity-proof-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz ID Proof attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         id_proofs: {
    //                                             id_proof_type: $('#business-add-identity-proof-type-select-dropdown').val(),
    //                                             id_proof_number: $('#identity_proof_text_box').text(),
    //                                             id_proof_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('id_proofs') && Object.keys(response['id_proofs']['id_proof_multimedia']).length > 0) {
    //                                                 await asyncEach(response['id_proofs']['id_proof_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz ID Proof attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             id_proofs: {
    //                                                 id_proof_type: $('#business-add-identity-proof-type-select-dropdown').val(),
    //                                                 id_proof_number: $('#identity_proof_text_box').text(),
    //                                                 id_proof_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('id_proofs') && Object.keys(response['id_proofs']['id_proof_multimedia']).length > 0) {
    //                                                     await asyncEach(response['id_proofs']['id_proof_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "pancard-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Pan card attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         pan_card_details: {
    //                                             pan_card_number: $('#business_pancard').text(),
    //                                             pan_card_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('pan_card_details') && Object.keys(response['pan_card_details']['pan_card_multimedia']).length > 0) {
    //                                                 await asyncEach(response['pan_card_details']['pan_card_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz ID Proof attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             id_proofs: {
    //                                                 id_proof_type: $('#business-add-identity-proof-type-select-dropdown').val(),
    //                                                 id_proof_number: $('#identity_proof_text_box').text(),
    //                                                 id_proof_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('id_proofs') && Object.keys(response['id_proofs']['id_proof_multimedia']).length > 0) {
    //                                                     await asyncEach(response['id_proofs']['id_proof_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "shop-established-license-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Shop established licence attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         shop_established_license: {
    //                                             shop_established_license_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('shop_established_license') && Object.keys(response['shop_established_license']['shop_established_license_multimedia']).length > 0) {
    //                                                 await asyncEach(response['shop_established_license']['shop_established_license_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz shop established licence attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             shop_established_license: {
    //                                                 shop_established_license_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('shop_established_license') && Object.keys(response['shop_established_license']['shop_established_license_multimedia']).length > 0) {
    //                                                     await asyncEach(response['shop_established_license']['shop_established_license_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "gst-license-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz GST attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         gst_details: {
    //                                             gst_number: $('#business_gst_license').text(),
    //                                             gst_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('gst_details') && Object.keys(response['gst_details']['gst_multimedia']).length > 0) {
    //                                                 await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz GST attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             gst_details: {
    //                                                 gst_number: $('#business_gst_license').text(),
    //                                                 gst_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('gst_details') && Object.keys(response['gst_details']['gst_multimedia']).length > 0) {
    //                                                     await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "partnership-deed-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Partnership deed attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         partnership_deed: {
    //                                             partnership_deed_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('partnership_deed') && Object.keys(response['partnership_deed']['partnership_deed_multimedia']).length > 0) {
    //                                                 await asyncEach(response['partnership_deed']['partnership_deed_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz Partnership deed attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             partnership_deed: {
    //                                                 partnership_deed_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('partnership_deed') && Object.keys(response['partnership_deed']['partnership_deed_multimedia']).length > 0) {
    //                                                     await asyncEach(response['partnership_deed']['partnership_deed_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "partnership-registration-certificate-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Partnership Registration Certificate attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         partnership_registration_certificate: {
    //                                             partnership_registration_certificate_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('partnership_registration_certificate') && Object.keys(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia']).length > 0) {
    //                                                 await asyncEach(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz Partnership Registration Certificate attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             partnership_registration_certificate: {
    //                                                 partnership_registration_certificate_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('partnership_registration_certificate') && Object.keys(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia']).length > 0) {
    //                                                     await asyncEach(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "llp-registration-certificate-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz LLP registration certificate attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         llp_registration_certificate: {
    //                                             llp_registration_certificate_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('llp_registration_certificate') && Object.keys(response['llp_registration_certificate']['llp_registration_certificate_multimedia']).length > 0) {
    //                                                 await asyncEach(response['llp_registration_certificate']['llp_registration_certificate_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz LLP registration certificate attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             llp_registration_certificate: {
    //                                                 llp_registration_certificate_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('llp_registration_certificate') && Object.keys(response['llp_registration_certificate']['llp_registration_certificate_multimedia']).length > 0) {
    //                                                     await asyncEach(response['llp_registration_certificate']['llp_registration_certificate_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "transaction-person-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz transaction person attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         transaction_person: {
    //                                             transaction_person_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('transaction_person') && Object.keys(response['transaction_person']['transaction_person_multimedia']).length > 0) {
    //                                                 await asyncEach(response['transaction_person']['transaction_person_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz transaction person attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             transaction_person: {
    //                                                 transaction_person_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('transaction_person') && Object.keys(response['transaction_person']['transaction_person_multimedia']).length > 0) {
    //                                                     await asyncEach(response['transaction_person']['transaction_person_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "memorandum-of-association-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Memorandom of Association attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         memorandum_of_association: {
    //                                             memorandum_of_association_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('memorandum_of_association') && Object.keys(response['memorandum_of_association']['memorandum_of_association_multimedia']).length > 0) {
    //                                                 await asyncEach(response['memorandum_of_association']['memorandum_of_association_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz Memorandom of Association attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             memorandum_of_association: {
    //                                                 memorandum_of_association_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('memorandum_of_association') && Object.keys(response['memorandum_of_association']['memorandum_of_association_multimedia']).length > 0) {
    //                                                     await asyncEach(response['memorandum_of_association']['memorandum_of_association_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "articles-of-association-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Articles of Association attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         article_of_association: {
    //                                             article_of_association_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('article_of_association') && Object.keys(response['article_of_association']['article_of_association_multimedia']).length > 0) {
    //                                                 await asyncEach(response['article_of_association']['article_of_association_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz Memorandom of Association attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             article_of_association: {
    //                                                 article_of_association_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('article_of_association') && Object.keys(response['article_of_association']['article_of_association_multimedia']).length > 0) {
    //                                                     await asyncEach(response['article_of_association']['article_of_association_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         } else if (getDataId == "trust-establishment-license-load-btn") {
    //             //check for device upload
    //             if (digibiz.device_multimedia_selected_files.length > 0) {
    //                 //add multimedia
    //                 asyncEach(digibiz.device_multimedia_selected_files, async function (element, index) {
    //                     //write into asset 
    //                     var data = {
    //                         "user_id": getUserID(),
    //                         "fileName": element.name,
    //                         "options": {
    //                             "encryption": "true",
    //                             "level": "1",
    //                             "filemanager": {
    //                                 "device_id": crossplat.device.uuid,
    //                                 "owner": {
    //                                     "type": "individual",
    //                                     "id": getUserID()
    //                                 },
    //                                 "app": "Digibiz",
    //                                 "purpose_name": $('#business_name').text(),
    //                                 "type": "file",
    //                                 "access_type": "system",
    //                                 "file": { "permission": "read", "keywords": "Digibiz Trust Establishment Liecence attached" }
    //                             }
    //                         }
    //                     }
    //                     try {
    //                         var writeResponse = await callWriteStorage(element, data)
    //                         digibiz.device_multimedia_selected_files[index]['response'] = writeResponse;
    //                         digibiz.device_multimedia_uploaded_files.push({
    //                             storage_id: writeResponse.Data.filename,
    //                             asset_id: writeResponse.Data.asset_id,
    //                             file_type: writeResponse.Data.filedata.type,
    //                             upload_type: "device"
    //                         });
    //                         if (digibiz.device_multimedia_uploaded_files.length == index + 1) {
    //                             var multimedia_data = digibiz.device_multimedia_uploaded_files;
    //                             //add to req params
    //                             if (digibiz.device_multimedia_uploaded_files.length > 0) {
    //                                 var reqParam = {
    //                                     device_id: crossplat.device.uuid,
    //                                     id: sessionStorage.getItem('business_id'),
    //                                     data: {
    //                                         trust_foundation_established_licence: {
    //                                             trust_foundation_established_licence_multimedia: multimedia_data
    //                                         },
    //                                     }
    //                                 }
    //                                 businessUpdate(reqParam)
    //                                     .then((response) => {
    //                                         //console.log("businessUpdate", response);
    //                                         digibiz.device_multimedia_uploaded_files = [];
    //                                         digibiz.device_multimedia_selected_files = [];
    //                                         const start = async () => {
    //                                             if (response.hasOwnProperty('trust_foundation_established_licence') && Object.keys(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia']).length > 0) {
    //                                                 await asyncEach(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia'], async (e, index) => {
    //                                                     await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                 });
    //                                             }
    //                                         }
    //                                         start();
    //                                         removeLoader();
    //                                     })
    //                                     .catch((err) => {
    //                                         //console.log("error in update business api", err);
    //                                         if (err.msg == "no updated data found") {
    //                                             removeLoader();
    //                                         }
    //                                     })
    //                             }
    //                         }
    //                     }
    //                     catch (e) {
    //                         removeLoader();
    //                         Materialize.toast(`Token has been expired or revoked ! Please try again later`, 3000, "round error-alert");

    //                     }
    //                 })
    //             } else
    //                 //check for cloud upload
    //                 if (digibiz.cloud_multimedia_selected_files.length > 0) {
    //                     asyncEach(digibiz.cloud_multimedia_selected_files, async (value, ind) => {
    //                         var file = await getAssetDetailsCloud(value);
    //                         var data = {
    //                             identifier: value,
    //                             file: {
    //                                 name: file.file_attributes.name.relative,
    //                                 size: file.file_attributes.size.filesize
    //                             }
    //                         }
    //                         var index = digibiz.assets.findIndex(e => e.file_attributes.name.relative == data.file.name);
    //                         if (index != -1) {
    //                             $(`[data-asset_id= ${value}]`).find(".checkbox input").prop('checked', false);
    //                             Materialize.toast('File already exists', 3000, 'rounded error-alert');
    //                         } else {
    //                             var requestParams = {
    //                                 "location": file.location,
    //                                 "parent": file.parent,
    //                                 "real_name": file.file_attributes.name.real,
    //                                 "owner": {
    //                                     "id": window.sessionStorage.getItem('user_id'),
    //                                     "type": "individual"
    //                                 },
    //                                 "userid": window.sessionStorage.getItem('user_id'),
    //                                 "app": "Digibiz",
    //                                 "request_type": $('#business_name').text(),
    //                                 "filemanager": {
    //                                     "device_id": crossplat.device.uuid,
    //                                     "owner": {
    //                                         "type": "individual",
    //                                         "id": window.sessionStorage.getItem('user_id')
    //                                     },
    //                                     "app": "Digibiz",
    //                                     "type": "file",
    //                                     "access_type": "system",
    //                                     "file": {
    //                                         "permission": "read",
    //                                         "keywords": "Digibiz Trust Establishment Liecence attached"
    //                                     }
    //                                 }
    //                             };
    //                             var storage_result = await callStorageCopy(requestParams);
    //                             //console.log("storage_result", storage_result);
    //                             digibiz.cloud_multimedia_uploaded_files.push({
    //                                 asset_id: storage_result.asset_id,
    //                                 storage_id: storage_result.filename,
    //                                 file_type: storage_result.filedata.type,
    //                                 upload_type: "cloud"
    //                             })
    //                             if (digibiz.cloud_multimedia_selected_files.length == (ind + 1)) {
    //                                 var multimedia_data = digibiz.cloud_multimedia_uploaded_files;
    //                                 //add to req params
    //                                 if (digibiz.cloud_multimedia_uploaded_files.length > 0) {
    //                                     var reqParam = {
    //                                         device_id: crossplat.device.uuid,
    //                                         id: sessionStorage.getItem('business_id'),
    //                                         data: {
    //                                             trust_foundation_established_licence: {
    //                                                 trust_foundation_established_licence_multimedia: multimedia_data
    //                                             },
    //                                         }
    //                                     }
    //                                     businessUpdate(reqParam)
    //                                         .then((response) => {
    //                                             //console.log("businessUpdate", response);
    //                                             digibiz.cloud_uploading_files = [];
    //                                             digibiz.cloud_multimedia_selected_files = [];
    //                                             digibiz.cloud_multimedia_uploaded_files = [];
    //                                             const start = async () => {
    //                                                 if (response.hasOwnProperty('trust_foundation_established_licence') && Object.keys(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia']).length > 0) {
    //                                                     await asyncEach(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia'], async (e, index) => {
    //                                                         await getUploadedMultimedia(e.asset_id, getDataId);
    //                                                     });
    //                                                 }
    //                                             }
    //                                             start();
    //                                             removeLoader();
    //                                         })
    //                                         .catch((err) => {
    //                                             //console.log("error in update business api", err);
    //                                             if (err.msg == "no updated data found") {
    //                                                 removeLoader();
    //                                             }
    //                                         })
    //                                 }
    //                             }
    //                         }
    //                     })
    //                 }
    //         }
    //     } else {
    //         removeLoader();
    //         //console.log("error in validateBeforeSave");
    //     }
    // });

    $(document).on('keydown', '#business_name, #business_display_name, #business_contact_name, #business_contact_number, #business_email, #address_text_box, #identity_proof_text_box, #business_pancard, #business_gst_license, #transaction_password_field', function () {
        removeError($(this));
    });
    $(document).on('change', '#business-type-choose-select-dropdown, #business-add-address-type-select-dropdown, #business-add-identity-proof-type-select-dropdown', function () {
        removeError($(this));
    });




    $(document).on('click', '.cancel-businesss-address-btn', function () {
        $(this).parent('.business-address-content-box').remove();
    });



    /*******************************BUSINESS MANAGEMENT(ends)******************************/

    $(document).on('click', '#employee-identity-picture-load-btn', function () {
        digibiz.isEmployeeIdentityPictureSelected = false;
        $('.multimedia_wrapper').find('.error_note').remove();
        addLoader();
        var action_parms = {
            action_id: "employee-identity-picture-type-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device",
                    attr: [{ name: "id", value: "employee-identity-picture-device-upload-type-btn" }]
                },
                {
                    name: "Cloud",
                    // attr: [{ name: "id", value: "employee-identity-picture-cloud-upload-type-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera",
                    attr: [{ name: "id", value: "employee-identity-picture-camera-upload-type-btn" }]
                }
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //device group display picture
    $(document).on('click', '#employee-identity-picture-device-upload-type-btn', function () {
        addLoader();
        $('#employee-identity-picture-upload').val("");
        $('#employee-identity-picture-upload').trigger('click');
        $('#employee-identity-picture-type-action-sheet').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "employee-identity-picture-modal",
            modal_header: "",
            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "employee-identity-crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: ''
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                    // //console.log("scroll initiated for modal pop-up class")
                    // appScroll.scrollBar('.modal-popup-content');
                }
            }
            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
        });
    });

    //device upload select picture
    $(document).on("change", `#employee-identity-picture-upload`, function () {
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            if (!(config.identityPictureFileFormat.includes(fileType.toLowerCase()))) {
                $('#employee-identity-picture-upload').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#employee-identity-picture-upload').val('');
                $('#employee-identity-picture-upload').attr("src", "");//empty
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#employee-identity-picture-upload').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#employee-identity-picture-upload').val('');
                $('#employee-identity-picture-upload').attr("src", "");//empty
            }
            else {
                if (files[0])
                    var photo = files[0];
                var reader = new FileReader();
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //employeecrop button-save's picture
    $(document).on('click', '#employee-identity-crop-button', function () {
        addLoader();
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                saveEmployeeIdentityPicture(reader.result, blob, function (err, employeeIdentityPicture) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        //console.log("employeeIdentityPicture", employeeIdentityPicture);
                        // var resultData = employeeIdentityPicture;
                        // //console.log("resultData", resultData);
                        // var employeeIdentityPictureData = {};
                        // if (resultData != undefined) {
                        //     employeeIdentityPictureData = {
                        //         asset_id: resultData.Data.asset_id,
                        //         storage_id: resultData.Data.filename
                        //     }
                        // }
                        // requestParams = {
                        //     device_id: crossplat.device.uuid,
                        //     id: sessionStorage.getItem('employee_id'),
                        //     data: {
                        //         identity_picture: employeeIdentityPictureData
                        //     }
                        // }
                        // employeeUpdate(requestParams)
                        //     .then((response) => {
                        //         //console.log("response", response);
                        $('#employee_identity_picture').attr("src", reader.result);
                        //remove +
                        $('.employee-identity-picture-multimedia-load-btn').remove();
                        //remove delete
                        $('#employee-identity-picture-delete').remove();
                        $('.employee-add-identity-picture-container').find('.mask').removeClass('hide');
                        //append photo_camera first and then delete
                        $('#employee_identity_picture').siblings('.mask').append(`<a class="info employee-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="employee-identity-picture-load-btn" data-thumbnail-id="${employeeIdentityPicture}">photo_camera</i></a>`);
                        $('#employee_identity_picture').siblings('.mask').append(`<a class="info employee-identity-picture-delete-btn cursor_pointer"><i class="material-icons" id="employee-identity-picture-delete" data-thumbnail-id="${employeeIdentityPicture}">delete</i></a>`);
                        $('#modal-close-btn').trigger('click');
                        $('#camera-modal').remove();
                        removeLoader();
                        digibiz.cropper.destroy();
                        // })
                        // .catch((err) => {
                        //     removeLoader();
                        //     Materialize.toast(`Error in uploading identity picture.`, 3000, 'round error-alert');
                        // })
                    }
                });
            }
            reader.readAsDataURL(blob);
        })
    });


    //Step-4 delete employee identity picture
    $(document).on('click', '#employee-identity-picture-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        e.stopPropagation();
        var alert_parms = {
            alert_id: "alert-delete-employee-identity-pic-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Identity picture",
            alert_body: `Do you want to delete the employee identity picture?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-employee-identity-pic-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-employee-identity-pic-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-employee-identity-pic-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
        });
    })
    // Step-5 delete NO clicked
    $(document).on('click', '#btn-delete-employee-identity-pic-confirm-no', function () {
        $('#alert-delete-employee-identity-pic-confirm-cancel').remove();
    })
    // Step-6 delete YES clicked
    $(document).on('click', '#btn-delete-employee-identity-pic-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-employee-identity-pic-confirm-cancel').attr('delete-thumbnail-id');
        $('#alert-delete-employee-identity-pic-confirm-cancel').remove();
        //api call to delete employee identity picture from dj cloud bucket
        var employeeId = sessionStorage.getItem('employee_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            identity_picture_id: thumbnailId,
            employee_id: employeeId,
        }
        addLoader();
        employeeDeleteIdentityPicture(requesParam)
            .then((response) => {
                removeLoader();
                $('#employee-identity-picture-upload').val('');
                $('#employee_identity_picture').attr("src", "");//empty
                $('#employee-identity-picture-delete').remove();//remove delete button
                $('#employee-identity-picture-load-btn').attr('data-thumbnail-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    })

    //cloud employee identity picture
    // $(document).on('click', '#employee-identity-picture-cloud-upload-type-btn', function () {
    //     addLoader();
    //     $('#employee-identity-picture-upload').val("");
    //     $('#employee-identity-picture-type-action-sheet').remove();

    //     $('.grid-view-container').removeClass('edit-mode');
    //     $('input[name="fileselection[]"]').prop('checked', false);
    //     $(".expand-search-input").removeAttr("socketid");
    //     $(".expand-search-input").val('');
    //     getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
    //         digibiz.cloudAssets = assetsDetails.Data.assets;
    //         showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
    //             removeLoader();
    //             $('.filemanger_container_toggle').trigger('click');
    //             $('.file-manager-footer').removeClass('hide');
    //             $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
    //         })
    //     }).catch((err) => {
    //         Materialize.toast("No assets found", 3000, 'rounded error-alert');
    //         showFilemanagerAssetsFilesList(null, function () {
    //             removeLoader();
    //         })
    //     });

    // });

    //Camera Upload employee identity
    $(document).on('click', '#employee-identity-picture-camera-upload-type-btn', function () {
        addLoader();
        $('#employee-identity-picture-upload').val("");
        $('#employee-identity-picture-type-action-sheet').remove();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');

                    $('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    window.cameraMediaFile = path;
                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }
                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "employee-identity-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "employee-identity-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        //console.log("123 check");
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                                //revoke stream(stop device)
                                                if (window.camerastream) {
                                                    window.camerastream.getTracks()[0].stop();
                                                }
                                            };
                                            $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500)
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                removeLoader();
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
            removeLoader();
        }
    });

    // $(document).on('click', '#employee-identity-picture-camera-upload-type-btn', function () {
    //     addLoader();
    //     $('#employee-identity-picture-upload').val("");
    //     $('#employee-identity-picture-type-action-sheet').remove();
    //     fetch.getHtml(function (fetcherror, html) {
    //         var modal_data = {
    //             modal_id: "camera-modal",
    //             modal_header: "Camera",
    //             modal_platform: crossplat.device.platform,
    //             modal_body: html,
    //             // modal_action_buttons: [{
    //             //     "name": "Add",
    //             //     "id": "add-selected-employees-group",
    //             // }]
    //         }
    //         showModal(modal_data, function () {
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 // if ($('.modal-popup-content').length > 0) {
    //                 //     //console.log("scroll initiated for modal pop-up class")
    //                 //     appScroll.scrollBar('.modal-popup-content');
    //                 // }
    //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //             } else {
    //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //             }
    //             $('#modal-close-btn').addClass('hide');
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 const vgaConstraints = { video: true };
    //                 navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //                     //global stream
    //                     window.camerastream = stream;
    //                     //remove Hide class from upload preview
    //                     //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     // $("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     // $(".file-manager-footer").addClass('hide');
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
    //                     //show preview
    //                     var videoElement = document.querySelector('#capture-video');
    //                     // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
    //                     //console.log("videoElement", videoElement);
    //                     videoElement.srcObject = stream;
    //                     videoElement.play();
    //                 });
    //             } else {
    //                 //andriod
    //                 // capture callback
    //                 var captureSuccess = function (mediaFiles) {
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('disabled');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('.upload-preview-footer').removeClass('hide');
    //                     //show preview
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".file-manager-footer").addClass('hide');
    //                     //remove Hide class from upload preview
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-attatched-new-file").addClass('hide');
    //                     //change send button attribute
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //                     var i, path, viewPath, len;
    //                     for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //                         path = mediaFiles[i].localURL;
    //                         //console.log("path", path);
    //                         // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
    //                         viewPath = mediaFiles[i].fullPath;
    //                         //console.log("viewPath", viewPath);
    //                         window.cameraMediaFile = path;
    //                         //append captured photo

    //                         var img = new Image;
    //                         //console.log("img", img);
    //                         //console.log("path", path);
    //                         img.src = viewPath;
    //                         //console.log("img11", img);
    //                         img.classList.add('preview-file');
    //                         var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //                         //console.log("getElement", getElement);
    //                         // document.querySelector('#upload-file-preview').appendChild(img);
    //                         $(getElement).append(img);
    //                         //revoke stream(stop device)
    //                         if (window.camerastream) {
    //                             window.camerastream.getTracks()[0].stop();
    //                         }
    //                         // var image = $('#image_cropper')[0];
    //                         // image.src = path;
    //                         // $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         // digibiz.cropper = new Cropper(image, {
    //                         //     viewMode: 0,
    //                         //     aspectRatio: 1 / 1,
    //                         //     minContainerWidth: 72,
    //                         //     minContainerHeight: 72,
    //                         //     minCropBoxWidth: 72,
    //                         //     minCropBoxHeight: 72,
    //                         //     maxWidth: 100,
    //                         //     maxHeight: 400,
    //                         //     zoomable: true,
    //                         //     rotatable: true,
    //                         //     responsive: true,
    //                         //     movable: true,
    //                         //     ready: function () {
    //                         //     }
    //                         // });
    //                     };
    //                 };
    //                 // capture error callback
    //                 var captureError = function (error) {
    //                     navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //                 };
    //                 // start image capture            
    //                 navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //             }
    //             removeLoader();
    //         });
    //     }, 'page/common/camera', '#camera-template', null);
    //     // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //     //     const vgaConstraints = { video: true };
    //     //     navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //     //         //global stream
    //     //         window.camerastream = stream;
    //     //         //remove Hide class from upload preview
    //     //         if ($("#upload-preview-wrapper").hasClass('hide')) {
    //     //             $("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //     //         }
    //     //         //Change Title
    //     //         $(".upload-preview-header span").text("Capture Photo");
    //     //         $("#file-manager-container").addClass('hide');
    //     //         $(".upload-preview-container").removeClass('hide');
    //     //         $(".file-manager-footer").addClass('hide');
    //     //         //hide send button, caption & add button
    //     //         $(".upload-preview-container-file-caption").addClass('hide');
    //     //         $(".upload-preview-footer").addClass('hide');
    //     //         $("#upload-permission-btn").addClass('hide');
    //     //         $('#upload-preview-container-text-box').text("");
    //     //         $("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue"><i class="material-icons">photo_camera</i></button>`);
    //     //         //show preview
    //     //         var videoElement = document.querySelector('#capture-video');
    //     //         videoElement.srcObject = stream;
    //     //         videoElement.play();
    //     //     });
    //     // } else {
    //     //     //andriod
    //     //     // capture callback
    //     //     var captureSuccess = function (mediaFiles) {
    //     //         $('#upload-footer-send-btn').removeClass('disabled');
    //     //         $('#upload-footer-send-btn').removeClass('hide');
    //     //         $('.upload-preview-footer').removeClass('hide');
    //     //         //show preview
    //     //         $("#file-manager-container").addClass('hide');
    //     //         $(".upload-preview-container").removeClass('hide');
    //     //         $(".file-manager-footer").addClass('hide');
    //     //         //remove Hide class from upload preview
    //     //         if ($("#upload-preview-wrapper").hasClass('hide')) {
    //     //             $("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //     //             $('div[data-filemanager="filemanager"]').addClass('hide');
    //     //         }
    //     //         //Change Title
    //     //         $(".upload-preview-header span").text("Capture Photo");
    //     //         //hide send button, caption & add button
    //     //         $("#upload-file-preview").empty();
    //     //         $(".upload-preview-container-file-caption").removeClass('hide');
    //     //         $('#upload-preview-container-text-box').text("");
    //     //         $("#upload-footer-attatched-new-file").addClass('hide');
    //     //         //change send button attribute
    //     //         $("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //     //         var i, path, len;
    //     //         for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //     //             path = mediaFiles[i].localURL;
    //     //             window.cameraMediaFile = path;
    //     //             //append captured photo

    //     //             var image = $('#image_cropper')[0];
    //     //             image.src = path;
    //     //             $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //     //             digibiz.cropper = new Cropper(image, {
    //     //                 viewMode: 0,
    //     //                 aspectRatio: 1 / 1,
    //     //                 minContainerWidth: 72,
    //     //                 minContainerHeight: 72,
    //     //                 minCropBoxWidth: 72,
    //     //                 minCropBoxHeight: 72,
    //     //                 maxWidth: 100,
    //     //                 maxHeight: 400,
    //     //                 zoomable: true,
    //     //                 rotatable: true,
    //     //                 responsive: true,
    //     //                 movable: true,
    //     //                 ready: function () {
    //     //                 }
    //     //             });
    //     //         };
    //     //     };
    //     //     // capture error callback
    //     //     var captureError = function (error) {
    //     //         navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //     //     };
    //     //     // start image capture            
    //     //     navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //     // }
    //     removeLoader();
    // });

    $(document).on('click', '.employee_identity_pic_preview', function () {
        var getId = $(this).attr('data-thumbnail-id');
        addLoader();
        var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getId}`;

        // getImageUrl(avtarUrl).then((res) => {
        // }).catch((err) => {
        //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
        //         var data = {
        //             file_error: err
        //         }
        //         fetch.getHtml(function (fetcherror, html) {
        //             //console.log("got html")
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "identity-picture-preview-modal",
        //                 modal_header: "",
        //                 modal_body: html
        //             }
        //             showModal(modal_data, function () {
        //                 //console.log("modal added");
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 removeLoader();
        //             });

        //         }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        //     } else {
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-picture-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                removeLoader();
            });

        }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        //     }
        // })

    });


    $(document).on('click', '#business-display-picture-mutimedia-add', function () {
        sessionStorage.removeItem('business_upload_for');
        $('.multimedia_wrapper').find('.error_note').remove();
        addLoader();
        var action_parms = {
            action_id: "business-display-picture-type-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device",
                    attr: [{ name: "id", value: "business-display-picture-device-upload-type-btn" }]
                },
                {
                    name: "Cloud",
                    // attr: [{ name: "id", value: "business-display-picture-cloud-upload-type-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera",
                    attr: [{ name: "id", value: "business-display-picture-camera-upload-type-btn" }]
                }
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //device business display picture
    $(document).on('click', '#business-display-picture-device-upload-type-btn', function () {
        addLoader();
        $('#business-display-upload').val("");
        $('#business-display-upload').trigger('click');
        $('#business-display-picture-type-action-sheet').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "business-display-picture-modal",
            modal_header: "",
            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "business-display-crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: ''
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                    // //console.log("scroll initiated for modal pop-up class")
                    // appScroll.scrollBar('.modal-popup-content');
                }
            }
            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
        });
    });

    //device upload select picture
    $(document).on("change", `#business-display-upload`, function () {
        var files = this.files;
        var getOldBusinessDisplayPicture = $('#business_display_picture').attr("src");
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            if (!(config.identityPictureFileFormat.includes(fileType.toLowerCase()))) {
                $('#business_display_picture').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#business-display-upload').val('');
                $('#business_display_picture').attr("src", getOldBusinessDisplayPicture);//empty
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#business_display_picture').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#business-display-upload').val('');
                $('#business_display_picture').attr("src", getOldBusinessDisplayPicture);//empty
            }
            else {
                if (files[0])
                    var photo = files[0];
                //console.log("photo", photo);
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //business display crop button-save's picture(this is the new code, where on crop it will be written immediately to the DJcloud)
    $(document).on('click', '#business-display-crop-button', function () {
        addLoader();
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                savebusinessDisplayPicture(reader.result, function (err, businessDisplayPicture) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        console.log("businessDisplayPicture", businessDisplayPicture);
                        $('#business_display_picture').attr("src", reader.result);
                        //remove +
                        $('.business-display-picture-multimedia-load-btn').remove();
                        //remove delete
                        $('#business-display-picture-delete').remove();
                        $('.business-display-picture-wrapper').find('.mask').removeClass('hide');
                        //append photo_camera first and then delete
                        $('#business_display_picture').siblings('.mask').append(`<a class="business_display_pic_preview" data-asset_id="${businessDisplayPicture.thumbnail}"><i class="material-icons">pageview</i></a>`);
                        $('#business_display_picture').siblings('.mask').append(`<a class="info business-display-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="business-display-picture-mutimedia-add" data-thumbnail-id="${businessDisplayPicture.thumbnail}">photo_camera</i></a>`);
                        $('#business_display_picture').siblings('.mask').append(`<a class="info business-display-picture-delete-btn cursor_pointer remove-pic"><i class="material-icons" id="business-display-picture-delete" data-thumbnail-id="${businessDisplayPicture.thumbnail}">cancel</i></a>`);
                        // $('#modal-close-btn').trigger('click');
                        $('#business-display-picture-modal').remove();
                        removeLoader();
                        digibiz.cropper.destroy();
                    }
                });
            }
            reader.readAsDataURL(blob);
        })
    });

    //Step-4 delete business display picture
    $(document).on('click', '#business-display-picture-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        //console.log("delete business display image thumbnail_id", thumbnail_id);
        e.stopPropagation();
        // if (image_id) {
        var alert_parms = {
            alert_id: "alert-delete-business-display-pic-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Display picture",
            alert_body: `Do you want to delete the business display picture?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-business-display-pic-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-business-display-pic-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-business-display-pic-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
        });
    })

    // Step-5 delete NO clicked
    $(document).on('click', '#btn-delete-business-display-pic-confirm-no', function () {
        $('#alert-delete-business-display-pic-confirm-cancel').remove();
    })
    // Step-6 delete YES clicked
    $(document).on('click', '#btn-delete-business-display-pic-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-business-display-pic-confirm-cancel').attr('delete-thumbnail-id');
        $('#alert-delete-business-display-pic-confirm-cancel').remove();
        //api call to delete business display picture from dj cloud bucket
        var businessId = sessionStorage.getItem('business_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            display_picture_id: thumbnailId,
            business_id: businessId,
        }
        addLoader();
        businessDeleteDisplayPicture(requesParam)
            .then((response) => {
                removeLoader();
                $('#business-display-upload').val('');
                $('#business_display_picture').attr("src", "");//empty
                $('#business-display-picture-delete').remove();//remove delete button
                $('.business_display_pic_preview').remove();
                $('#business-display-picture-mutimedia-add').attr('data-thumbnail-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    //Step-4 delete business display picture
    $(document).on('click', '#business-display-video-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        //console.log("delete business display image thumbnail_id", thumbnail_id);
        e.stopPropagation();
        // if (image_id) {
        var alert_parms = {
            alert_id: "alert-delete-business-display-video-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Display Video",
            alert_body: `Do you want to delete the business display Video?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-business-display-video-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-business-display-video-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-business-display-video-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
        });
    })
    // Step-5 delete NO clicked
    $(document).on('click', '#btn-delete-business-display-video-confirm-no', function () {
        $('#alert-delete-business-display-video-confirm-cancel').remove();
    })
    // Step-6 delete YES clicked
    $(document).on('click', '#btn-delete-business-display-video-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-business-display-video-confirm-cancel').attr('delete-thumbnail-id');
        $('#alert-delete-business-display-video-confirm-cancel').remove();
        //api call to delete business display picture from dj cloud bucket
        var businessId = sessionStorage.getItem('business_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            display_video_thumbnail_id: thumbnailId,
            business_id: businessId,
        }
        addLoader();
        businessDeleteDisplayVideo(requesParam)
            .then((response) => {
                removeLoader();
                $('#business-display-video-upload').val('');
                $('#business_display_video').attr("src", "");
                $('#business-display-video-delete').remove();
                $('.business_display_video_preview').remove();
                $('#business-display-video-mutimedia-add').attr('data-thumbnail-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })

    });
    //business display picture cloud
    // $(document).on('click', '#business-display-picture-cloud-upload-type-btn', function () {
    //     addLoader();
    //     // $('#business-display-upload').val("");
    //     $('#business-display-picture-type-action-sheet').remove();
    //     sessionStorage.setItem('business_upload_for', "business_display_picture")
    //     $('.grid-view-container').removeClass('edit-mode');
    //     $('input[name="fileselection[]"]').prop('checked', false);
    //     $(".expand-search-input").removeAttr("socketid");
    //     $(".expand-search-input").val('');
    //     // getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
    //     //     digibiz.cloudAssets = assetsDetails.Data.assets;
    //     //     showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
    //     //         removeLoader();
    //     //         $('.filemanger_container_toggle').trigger('click');
    //     //         $('.file-manager-footer').removeClass('hide');
    //     //         $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
    //     //     })
    //     // })
    //     //     .catch((err) => {
    //     //         Materialize.toast("No assets found", 3000, 'rounded error-alert');
    //     //         showFilemanagerAssetsFilesList(null, function () {
    //     //             removeLoader();
    //     //         })
    //     //     });

    // });

    //Camera Upload business display picture
    $(document).on('click', '#business-display-picture-camera-upload-type-btn', function () {
        addLoader();
        $('#business-display-upload').val("");
        $('#business-display-picture-type-action-sheet').remove();
        //hide the mask, so that delete and add will be hidden
        // $('.business-display-picture-wrapper').find('.mask').addClass('hide');
        sessionStorage.setItem('camera_for', "business_display_picture");
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }                    
                    $('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                    removeLoader();
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
                    window.cameraMediaFile = path;
                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }

                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "business-display-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "business-display-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
                    });

                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        //console.log("123 check", window.cameraMediaFile);
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            //console.log("entry", entry)
                            entry.file(function (file) {
                                //console.log("file", file);
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    //console.log("readerEvent", readerEvent)
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            //console.log("image", image);
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            //console.log("complete")
                                            removeLoader();
                                        } else {
                                            //console.log("12345")
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500);
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                removeLoader();
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
            removeLoader();
        }
    });
    // $(document).on('click', '#business-display-picture-camera-upload-type-btn', function () {
    //     addLoader();
    //     $('#business-display-upload').val("");
    //     $('#business-display-picture-type-action-sheet').remove();
    //     //hide the mask, so that delete and add will be hidden
    //     // $('.business-display-picture-wrapper').find('.mask').addClass('hide');
    //     sessionStorage.setItem('camera_for', "business_display_picture");
    //     fetch.getHtml(function (fetcherror, html) {
    //         var modal_data = {
    //             modal_id: "camera-modal",
    //             modal_header: "Camera",
    //             modal_platform: crossplat.device.platform,
    //             modal_body: html,
    //             // modal_action_buttons: [{
    //             //     "name": "Add",
    //             //     "id": "add-selected-employees-group",
    //             // }]
    //         }
    //         showModal(modal_data, function () {
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                 // if ($('.modal-popup-content').length > 0) {
    //                 //     //console.log("scroll initiated for modal pop-up class")
    //                 //     appScroll.scrollBar('.modal-popup-content');
    //                 // }
    //             } else {
    //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //             }
    //             $('#modal-close-btn').addClass('hide');
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 const vgaConstraints = { video: true };
    //                 navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //                     //global stream
    //                     window.camerastream = stream;
    //                     //remove Hide class from upload preview
    //                     //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     // $("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     // $(".file-manager-footer").addClass('hide');
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
    //                     //show preview
    //                     var videoElement = document.querySelector('#capture-video');
    //                     // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
    //                     //console.log("videoElement", videoElement);
    //                     videoElement.srcObject = stream;
    //                     videoElement.play();
    //                 });
    //             } else {
    //                 //andriod
    //                 // capture callback
    //                 var captureSuccess = function (mediaFiles) {
    //                     //console.log("mediaFiles", mediaFiles)
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('disabled');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('.upload-preview-footer').removeClass('hide');
    //                     //show preview
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".file-manager-footer").addClass('hide');
    //                     //remove Hide class from upload preview
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-attatched-new-file").addClass('hide');
    //                     //change send button attribute
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //                     var i, path, viewPath, len;
    //                     for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //                         path = mediaFiles[i].localURL;
    //                         // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
    //                         viewPath = mediaFiles[i].fullPath;
    //                         window.cameraMediaFile = path;
    //                         //append captured photo

    //                         var img = new Image;
    //                         //console.log("img", img);
    //                         //console.log("path", path);
    //                         //console.log("viewPath", viewPath);
    //                         img.src = viewPath;
    //                         //console.log("img11", img);
    //                         img.classList.add('preview-file');
    //                         var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //                         //console.log("getElement", getElement);
    //                         // document.querySelector('#upload-file-preview').appendChild(img);
    //                         $(getElement).append(img);
    //                         //revoke stream(stop device)
    //                         if (window.camerastream) {
    //                             window.camerastream.getTracks()[0].stop();
    //                         }
    //                         $('#camera-modal').addClass('hide');
    //                         // $('#camera-modal').remove();
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).addClass('hide');
    //                         //CROPPER MODAL
    //                         var modal_data = {
    //                             modal_platform: crossplat.device.platform,
    //                             modal_id: "business-display-picture-modal",
    //                             modal_header: "",
    //                             modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
    //                             modal_action_buttons: [{
    //                                 id: "business-display-crop-button",
    //                                 name: `crop`,
    //                                 attr: [{
    //                                     name: "data-id",
    //                                     value: ''
    //                                 }]
    //                             }]
    //                         }
    //                         showModal(modal_data, function () {
    //                             removeLoader();
    //                             if ($('.modal-popup-content').length > 0) {
    //                                 if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
    //                                     //console.log("scroll initiated for modal pop-up class")
    //                                     appScroll.scrollBar('.modal-popup-content');
    //                                 }
    //                             }
    //                             $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
    //                             $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
    //                         });

    //                         setTimeout(function () {
    //                             var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
    //                             //console.log("123 check", window.cameraMediaFile);
    //                             window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
    //                                 //console.log("entry", entry)
    //                                 entry.file(function (file) {
    //                                     //console.log("file", file);
    //                                     var readerdataurl = new FileReader;
    //                                     readerdataurl.onloadend = function (readerEvent) {
    //                                         //console.log("readerEvent", readerEvent)
    //                                         var readerArrayBuffer = new FileReader;
    //                                         readerArrayBuffer.onloadend = function (evt) {
    //                                             var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
    //                                             // callapi(readerEvent, blob);
    //                                             var types = blob.type.split('/');
    //                                             var extension = types[1];
    //                                             if (supported_types.includes(extension.toLowerCase())) {
    //                                                 $('.image_container').remove();
    //                                                 var url = URL.createObjectURL(blob);

    //                                                 var image = document.getElementById('image_cropper');
    //                                                 //console.log("image", image);
    //                                                 image.src = readerEvent.target.result;
    //                                                 image.onload = function (element) {
    //                                                     $('.group_image_delete').hide();
    //                                                 };
    //                                                 $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                                 digibiz.cropper = new Cropper(image, {
    //                                                     viewMode: 2,
    //                                                     aspectRatio: 1 / 1,
    //                                                     minContainerWidth: 72,
    //                                                     minContainerHeight: 72,
    //                                                     minCropBoxWidth: 72,
    //                                                     minCropBoxHeight: 72,
    //                                                     maxWidth: 100,
    //                                                     maxHeight: 400,
    //                                                     zoomable: true,
    //                                                     rotatable: true,
    //                                                     responsive: true,
    //                                                     movable: true,
    //                                                     ready: function () {
    //                                                         //cropper.zoom(-0.6);
    //                                                     }
    //                                                 });
    //                                                 //console.log("complete")
    //                                                 removeLoader();
    //                                             } else {
    //                                                 //console.log("12345")
    //                                             }
    //                                         }
    //                                         readerArrayBuffer.readAsArrayBuffer(file);
    //                                     };
    //                                     readerdataurl.readAsDataURL(file);
    //                                 });
    //                             }, function (err) {
    //                                 //console.log('error getting the camera media file', err);
    //                             });
    //                         }, 500)

    //                         // var image = $('#image_cropper')[0];
    //                         // image.src = path;
    //                         // $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         // digibiz.cropper = new Cropper(image, {
    //                         //     viewMode: 0,
    //                         //     aspectRatio: 1 / 1,
    //                         //     minContainerWidth: 72,
    //                         //     minContainerHeight: 72,
    //                         //     minCropBoxWidth: 72,
    //                         //     minCropBoxHeight: 72,
    //                         //     maxWidth: 100,
    //                         //     maxHeight: 400,
    //                         //     zoomable: true,
    //                         //     rotatable: true,
    //                         //     responsive: true,
    //                         //     movable: true,
    //                         //     ready: function () {
    //                         //     }
    //                         // });
    //                     };
    //                 };
    //                 // capture error callback
    //                 var captureError = function (error) {
    //                     navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //                 };
    //                 // start image capture            
    //                 navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //             }
    //             removeLoader();
    //         });
    //     }, 'page/common/camera', '#camera-template', null);
    //     // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //     //     const vgaConstraints = { video: true };
    //     //     navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //     //         //global stream
    //     //         window.camerastream = stream;
    //     //         //remove Hide class from upload preview
    //     //         if ($(`#upload-preview-wrapper[data-for="business_display_picture"]`).hasClass('hide')) {
    //     //             $(`#upload-preview-wrapper[data-for="business_display_picture"]`).removeClass('hide').addClass('slide-top');
    //     //             $('div[data-filemanager="filemanager"]').addClass('hide');
    //     //         }
    //     //         //Change Title
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".upload-preview-header span").text("Capture Photo");
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#file-manager-container").addClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".upload-preview-container").removeClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".file-manager-footer").addClass('hide');
    //     //         //hide send button, caption & add button
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".upload-preview-container-file-caption").addClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".upload-preview-footer").addClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#upload-permission-btn").addClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find('#upload-preview-container-text-box').text("");
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue"><i class="material-icons">photo_camera</i></button>`);
    //     //         //show preview
    //     //         var videoElement = document.querySelector('#capture-video');
    //     //         videoElement.srcObject = stream;
    //     //         videoElement.play();
    //     //     });
    //     // } else {
    //     //     //andriod
    //     //     // capture callback
    //     //     var captureSuccess = function (mediaFiles) {
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find('#upload-footer-send-btn').removeClass('disabled');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find('#upload-footer-send-btn').removeClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find('.upload-preview-footer').removeClass('hide');
    //     //         //show preview
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#file-manager-container").addClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".upload-preview-container").removeClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".file-manager-footer").addClass('hide');
    //     //         //remove Hide class from upload preview
    //     //         if ($(`#upload-preview-wrapper[data-for="business_display_picture"]`).hasClass('hide')) {
    //     //             $(`#upload-preview-wrapper[data-for="business_display_picture"]`).removeClass('hide').addClass('slide-top');
    //     //             $('div[data-filemanager="filemanager"]').addClass('hide');
    //     //         }
    //     //         //Change Title
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"] span`).text("Capture Photo");
    //     //         //hide send button, caption & add button
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#upload-file-preview").empty();
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find('#upload-preview-container-text-box').text("");
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#upload-footer-attatched-new-file").addClass('hide');
    //     //         //change send button attribute
    //     //         $(`#upload-preview-wrapper[data-for="business_display_picture"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //     //         var i, path, len;
    //     //         for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //     //             path = mediaFiles[i].localURL;
    //     //             window.cameraMediaFile = path;
    //     //             //append captured photo

    //     //             var image = $('#image_cropper')[0];
    //     //             image.src = path;
    //     //             $('#business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //     //             digibiz.cropper = new Cropper(image, {
    //     //                 viewMode: 0,
    //     //                 aspectRatio: 1 / 1,
    //     //                 minContainerWidth: 72,
    //     //                 minContainerHeight: 72,
    //     //                 minCropBoxWidth: 72,
    //     //                 minCropBoxHeight: 72,
    //     //                 maxWidth: 100,
    //     //                 maxHeight: 400,
    //     //                 zoomable: true,
    //     //                 rotatable: true,
    //     //                 responsive: true,
    //     //                 movable: true,
    //     //                 ready: function () {
    //     //                 }
    //     //             });
    //     //         };
    //     //     };
    //     //     // capture error callback
    //     //     var captureError = function (error) {
    //     //         navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //     //     };
    //     //     // start image capture            
    //     //     navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //     // }
    //     removeLoader();
    // });

    $(document).on('click', '.business_display_pic_preview', function () {
        // var thumbnailId = $(this).attr('data-asset_id');
        // console.log("thumbnailId", thumbnailId);
        //image is present
        var getBusinessId = sessionStorage.getItem('business_id')
        // if ($('body').attr('app') == "business_owner_business_list") {
        //     getBusinessId = $($this).parents('.business-wrapper').attr('data-business-id');
        // } else if ($('body').attr('app') == "employee_business_list") {
        //     getBusinessId = $($this).parents('.employee-business-wrapper').attr('data-business-id');
        // } else if ($('body').attr('app') == "customer_business_list") {
        //     getBusinessId = $($this).parents('.employee-business-wrapper').attr('data-business-id');
        // } else if ($('body').attr('app') == "view_business_profile") {
        //     getBusinessId = sessionStorage.getItem('business_id')
        // } else {
        //     getBusinessId = $($this).find('img').attr('data-business-id')
        // }
        var getImageId = $(this).attr('data-asset_id');
        var avtarUrl = `${api.get_business_multimedia}?business_id=${getBusinessId}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "business-display-picture-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                removeLoader();
            });

        }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
    });

    $(document).on('click', '.view-employee-business', function () {
        //TODO(should show all the apps which has been assigned to this employee by the role assignment)
        addLoader();
        var getBusinessId = $(this).parents('.employee-business-wrapper').attr('data-business-id');
        var getEmployeeStatus = $(this).parents('.employee-business-wrapper').attr('data-status');
        //console.log("getBusinessId", getBusinessId);
        if (getEmployeeStatus == "active" || getEmployeeStatus == "unassigned") {
            var reqParamss = {
                device_id: crossplat.device.uuid,
                id: getBusinessId
            }
            businessGet(reqParamss)
                .then((result) => {
                    if (result.status.status == "self-verified" || result.status.status == "inactive_pending") {

                        var requestParams = {
                            device_id: crossplat.device.uuid,
                            selected: true,
                            id: getBusinessId,
                            type: "business"
                        }
                        fetch.apiCall(function (response, status, xhr) {
                            if (status === "success") {
                                var reqParam = {
                                    device_id: crossplat.device.uuid,
                                    // get_by: "core_user_id",
                                    get_by: "account_id",
                                    business_id: getBusinessId,
                                    // core_user_id: sessionStorage.getItem('user_id'),
                                    account_id: sessionStorage.getItem('account_id')
                                }
                                employeeGet(reqParam)
                                    .then((response) => {
                                        // //console.log("qwert", response);
                                        sessionStorage.setItem('business_id', getBusinessId);
                                        sessionStorage.setItem('business_name', result.name);
                                        sessionStorage.setItem('employee_id', response.dj_unique_employee_id);
                                        location.hash = `employee/business/apps/hub`;
                                    })
                                    .catch((err) => {
                                        //console.log("Error in getting employee id");
                                        removeLoader();
                                    })
                            } else {
                                var alert_parms = {
                                    alert_id: "alert-no-business-active-storage-available",
                                    alert_platform: crossplat.device.platform,
                                    alert_title: "Alert",
                                    alert_body: `<div>Reauthenticate business Storage. Please contact business owners to reauthenticate the storage.</div>`,
                                    alert_btn: [{
                                        name: "OK",
                                        attr: [{ name: "id", value: "btn-no-business-active-storage-available-ok" }]
                                    }]
                                }
                                showAlert(alert_parms, function () {
                                    removeLoader();
                                });
                            }
                        }, api.check_token, "POST", "JSON", requestParams);
                    } else {
                        removeLoader();
                        Materialize.toast(`Business is inactive.`, 3000, "round error-alert");
                    }
                })
                .catch((err) => {
                    //console.log("Error in getting business");
                    removeLoader();
                })
        } else if (getEmployeeStatus == "accepted") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                get_by: "account_id",
                business_id: getBusinessId,
                account_id: sessionStorage.getItem('account_id')
            }
            employeeGet(reqParam).then((employeeresult) => {
                if (employeeresult.status.status == "active") {
                    var reqParamss = {
                        device_id: crossplat.device.uuid,
                        id: getBusinessId
                    }
                    businessGet(reqParamss)
                        .then((result) => {
                            if (result.status.status == "self-verified" || result.status.status == "inactive_pending") {

                                var requestParams = {
                                    device_id: crossplat.device.uuid,
                                    selected: true,
                                    id: getBusinessId,
                                    type: "business"
                                }
                                fetch.apiCall(function (response, status, xhr) {
                                    if (status === "success") {
                                        sessionStorage.setItem('business_id', getBusinessId);
                                        sessionStorage.setItem('business_name', result.name);
                                        sessionStorage.setItem('employee_id', employeeresult.dj_unique_employee_id);
                                        location.hash = `employee/business/apps/hub`;

                                    } else {
                                        var alert_parms = {
                                            alert_id: "alert-no-business-active-storage-available",
                                            alert_platform: crossplat.device.platform,
                                            alert_title: "Alert",
                                            alert_body: `<div>Reauthenticate business Storage. Please contact business owners to reauthenticate the storage.</div>`,
                                            alert_btn: [{
                                                name: "OK",
                                                attr: [{ name: "id", value: "btn-no-business-active-storage-available-ok" }]
                                            }]
                                        }
                                        showAlert(alert_parms, function () {
                                            removeLoader();
                                        });
                                    }
                                }, api.check_token, "POST", "JSON", requestParams);
                            } else {
                                removeLoader();
                                Materialize.toast(`Business is inactive.`, 3000, "round error-alert");
                            }
                        })
                        .catch((err) => {
                            //console.log("Error in getting business");
                            removeLoader();
                        })
                } else {
                    var alert_parms = {
                        alert_id: "alert-employee-customer-not-active-box",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Alert",
                        alert_body: `<div>Please wait until administrator activates your employee account.</div>`,
                        alert_btn: [{
                            name: "OK",
                            attr: [{ name: "id", value: "btn-employee-customer-not-active-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                }
            }).catch((err) => {
                console.log('err', err);
                var alert_parms = {
                    alert_id: "alert-employee-customer-not-active-box",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Alert",
                    alert_body: `<div>Please wait until administrator activates your employee account.</div>`,
                    alert_btn: [{
                        name: "OK",
                        attr: [{ name: "id", value: "btn-employee-customer-not-active-ok" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            })
        } else {
            var alert_parms = {
                alert_id: "alert-employee-customer-not-active-box",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `<div>You are inactive. Please contact your business administrators.</div>`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "btn-employee-customer-not-active-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });

    $(document).on('click', '#btn-employee-customer-not-active-ok', function () {
        $('#alert-employee-customer-not-active-box').remove();
    });

    $(document).on('click', '#btn-business-not-active-ok', function () {
        $('#alert-business-not-active-box').remove();
    });

    $(document).on('click', '#btn-no-business-active-storage-available-ok', function () {
        $('#alert-no-business-active-storage-available').remove();
    });

    $(document).on('click', '.employee-icon-navigate-app', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var getApp = $(this).attr('data-app');
        if (getApp == "bizcontacts" || getApp == "bizgroups") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                get_by: "id",
                id: sessionStorage.getItem('employee_id'),
            }
            employeeGet(reqParam)
                .then((result) => {
                    //add the navigate log
                    addLoader();
                    var requestParam = {
                        device_id: crossplat.device.uuid,
                        platform: crossplat.device.platform,
                        app: getApp,
                        role: "employee",
                        employee_role: result.employee_role,
                        account_id: sessionStorage.getItem('account_id'),
                        business_id: sessionStorage.getItem('business_id'),
                        member_id: sessionStorage.getItem('employee_id'),
                    }
                    navigateLogsAdd(requestParam)
                        .then((response) => {
                            setTimeout(function () {
                                deviceHelper.navigateApp(getApp);
                            }, 500)
                        })
                        .catch((err) => {
                            removeLoader();
                            // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                        })
                })
                .catch((err) => {
                    removeLoader();
                })
        } else {
            //check if this app is active for this business
            var appName;
            if (getApp == "digibiz_assets") {
                appName = "bizassets";
            } else {
                appName = getApp;
            }
            var requesParam = {
                device_id: crossplat.device.uuid,
                get_by: "check_app",
                business_id: sessionStorage.getItem('business_id'),
                app: appName,
            }
            getAppPermission(requesParam)
                .then((appResponse) => {
                    if (appResponse.status.status == "active") {
                        if (getApp == "bizmeet" || getApp == "bizcall") {
                            removeLoader();
                        } else {
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                get_by: "id",
                                id: sessionStorage.getItem('employee_id'),
                            }
                            employeeGet(reqParam)
                                .then((result) => {
                                    //add the navigate log
                                    addLoader();
                                    var requestParam = {
                                        device_id: crossplat.device.uuid,
                                        platform: crossplat.device.platform,
                                        app: getApp,
                                        role: "employee",
                                        employee_role: result.employee_role,
                                        account_id: sessionStorage.getItem('account_id'),
                                        business_id: sessionStorage.getItem('business_id'),
                                        member_id: sessionStorage.getItem('employee_id'),
                                    }
                                    navigateLogsAdd(requestParam)
                                        .then((response) => {
                                            setTimeout(function () {
                                                deviceHelper.navigateApp(getApp);
                                            }, 500)
                                        })
                                        .catch((err) => {
                                            removeLoader();
                                            // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                                        })
                                })
                                .catch((err) => {
                                    removeLoader();
                                })
                        }
                    } else if (appResponse.status.status == "inactive") {
                        var alert_parms = {
                            alert_id: "app-permission-not-present-alert",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Access Denied`,
                            alert_body: `This app is inactive. Please contact business administrator.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "access-denied-app-permission-not-present" }]
                            }
                            ]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else {
                        var alert_parms = {
                            alert_id: "app-permission-not-present-alert",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Access Denied`,
                            alert_body: `This app is not activated by the business. Please contact business administrator.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "access-denied-app-permission-not-present" }]
                            }
                            ]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    }
                })
                .catch((err) => {
                    //console.log('err', err);
                    var alert_parms = {
                        alert_id: "app-permission-not-present-alert",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Access Denied`,
                        alert_body: `This app is not activated by the business. Please contact business administrator.`,
                        alert_btn: [{
                            name: "OK",
                            attr: [{ name: "id", value: "access-denied-app-permission-not-present" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                })
        }
    });

    //employee contact list
    $(document).on('click', '.employee-contact-list', function () {
        addLoader();
        location.hash = `employee/contact/list`;
    });

    //on click of all employees list
    $(document).on('click', '.all-employee-list-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-employee-contact-list-type-tab', 'all_employees');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-contact-list-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-contact-list-type-tab')}"]`).addClass('active');
        $('.voiceit_private_page_search_container').removeClass('hide');
        allEmployessListPage();
    });

    //on click of department wise employees list
    $(document).on('click', '.department-wise-list-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-employee-contact-list-type-tab', 'department_wise');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-employee-contact-list-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-employee-contact-list-type-tab')}"]`).addClass('active');
        $('.voiceit_private_page_search_container').addClass('hide');
        departmentWiseEmployessListPage();
    });

    //department list in modal(not-used) in contact list
    // $(document).on('click', '#department-list-selection-data', function () {
    //     addLoader();
    //     digibiz.department_wise_employees_list = [];
    //     var reqParams = {
    //         device_id: crossplat.device.uuid,
    //         list_by: "department",
    //         business_id: sessionStorage.getItem('business_id')
    //     }
    //     departmentList(reqParams)
    //         .then((departmentResponse) => {
    //             //console.log("departmentResponse", departmentResponse);
    //             var departmentListResponse = {
    //                 departmentList: departmentResponse
    //             }
    //             fetch.getHtml(function (fetcherror, html) {
    //                 var modal_data = {
    //                     modal_id: "department-wise-employees-list-modal",
    //                     modal_header: "Select Department",
    //                     modal_platform: crossplat.device.platform,
    //                     modal_body: html,
    //                     modal_action_buttons: [{
    //                         "name": "Confirm",
    //                         "id": "department-wise-employee-list-confirm",
    //                     }]
    //                 }
    //                 showModal(modal_data, function () {
    //                     removeLoader();
    //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                     } else {
    //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                     }
    //                 });
    //             }, 'layouts/popup/employee_department_assignment_list', '#employee-department-assignment-template', departmentListResponse);
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("error in department list");
    //         })
    // });

    $(document).on('click', '#department-list-selection-data', function () {
        addLoader();
        digibiz.department_list_selection = [];
        digibiz.alreadySelectedDepartment = [];
        digibiz.department_wise_employees_list = [];
        var reqParams = {
            device_id: crossplat.device.uuid,
            list_by: "department",
            business_id: sessionStorage.getItem('business_id')
        }
        departmentList(reqParams)
            .then((departmentResponse) => {
                //console.log("departmentResponse", departmentResponse);
                var modal_data = {
                    modal_id: "department-wise-employees-list-modal",
                    modal_header: "Select Department",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="department-list-main-container">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="department-list-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons department-list-close-btn hide">close</i></span>
                                        </div>
                                        <div id="department-list-selection-wrapper"></div>
                                        </div>`,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "department-wise-employee-list-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processDepartmentListSelection(departmentResponse, function () {
                        // setTimeout(function () {
                        removeLoader();
                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        // let element = document.querySelector(".expand-search-input");
                        var element = $('#department-wise-employees-list-modal').find('.expand-search-input');
                        //console.log("elem", element)
                        // let element = document.querySelector($(elem));
                        // 
                        //console.log('element222click', $(element));
                        if (element) {
                            //console.log('element22', element);
                            //if element is there
                            // element.addEventListener("input", function () {
                            $(document).on('input', element, function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                // element.setAttribute("socketid", timestamp);
                                element.attr("socketid", timestamp);
                            });
                            // element.addEventListener("keyup", function (e) {
                            $(document).on('keyup', element, function () {
                                // if (!hasClass(e.target, 'filemanager-search')) {
                                //console.log("not has class")
                                // on keyup get attribute 
                                // socketid = element.getAttribute("socketid");
                                socketid = element.attr("socketid");
                                // keyword = element.value;
                                keyword = element.val();
                                //console.log("socketid", socketid)
                                //console.log("keyword", keyword)
                                if (socketid && keyword) {
                                    //if socketid attribute and keyword is there
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    currentroute = $("body").attr('app');
                                    data = {
                                        room: crossplat.device.uuid,
                                        socketid,
                                        app: 'digibiz',
                                        keyword
                                    };
                                    switch (currentroute) {
                                        case 'employee_contact_list':
                                            if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "department_wise") {
                                                if ($('#department-wise-employees-list-modal').length > 0) {
                                                    data['index'] = 'getEmployeeCreatDepartmentSelection';
                                                    data['business_id'] = sessionStorage.getItem('business_id');
                                                }
                                            }
                                            break;
                                        default:
                                            break;
                                    }
                                    addLoader();
                                    //console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                } else {
                                    //console.log("going to else part")
                                    //else show default list
                                    removeLoader();
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                    currentroute = $("body").attr('app');
                                    // element.removeAttribute("socketid");
                                    element.attr("socketid", "");
                                    switch (currentroute) {
                                        case 'employee_contact_list':
                                            if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "department_wise") {
                                                if ($('#department-wise-employees-list-modal').length > 0) {
                                                    processDepartmentListSelection(digibiz.department_list_selection, function () {
                                                    });
                                                }
                                            }
                                            break;
                                        default:
                                            break;
                                    }

                                }
                            });
                        }
                        // }, 100);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in department list");
            })
    });

    //can select only one department in department list for department wise contact list
    $(document).on('click', '.department-selected', function () {
        if ($('#department-wise-employees-list-modal').find('.department-selected:checked').length > 1) {
            $('.department-selected').prop('checked', false);
            $(this).prop('checked', true);
        }
    });

    //on click of department wise employee list confirm(only one tick is allowed)
    $(document).on('click', '#department-wise-employee-list-confirm', function () {
        addLoader();
        // if ($('#department-wise-employees-list-modal').find('.selected-department:checked').length > 0 && $('#department-wise-employees-list-modal').find('.selected-department:checked').length < 2) {
        if ($('#department-wise-employees-list-modal').find('.department-list-data-wrapper.selected-row').length > 0 && $('#department-wise-employees-list-modal').find('.department-list-data-wrapper.selected-row').length < 2) {
            //console.log("perfect")
            // var getDepartmentId = $('#department-wise-employees-list-modal').find('.selected-department:checked').parents('.department-wrapper').attr('data-id');
            var getDepartmentId = $('#department-wise-employees-list-modal').find('.department-list-data-wrapper.selected-row').attr('data-id');
            var reqparams = {
                device_id: crossplat.device.uuid,
                list_by: "department",
                business_id: sessionStorage.getItem('business_id'),
                department_id: getDepartmentId
            }
            employeeList(reqparams)
                .then((response) => {
                    //console.log("departmentList response", response);
                    processDepartmentWiseEmployeeList(response, function () {
                        $('#department-wise-employees-list-modal').remove();
                        removeLoader();
                    });
                })
                .catch((err) => {
                    if (err.msg == 'No data found') {
                        var response = [];
                        processDepartmentWiseEmployeeList(response, function () {
                            $('#department-wise-employees-list-modal').remove();
                            removeLoader();
                        });
                    } else {
                        removeLoader();
                        //console.log("err in department list", err);
                    }
                })
        } else {
            removeLoader();
            Materialize.toast("Please select only 1 department.", 3000, 'round success-alert');
        }
    });
    /*******************CUSTOMER MANAGEMENT***************************/
    $(document).on('click', '.customer-identifiers', function () {
        addLoader();
        location.hash = `customers/identifiers/list`;
    });

    //old code
    // $(document).on('click', '.customer-identifiers-tab', function () {
    //     addLoader();
    //     sessionStorage.setItem('selected-customer-identifier-tab', "customer");
    //     $('.tab-content').removeClass('active');
    //     $(`.tab-content[id="${sessionStorage.getItem('selected-customer-identifier-tab')}"`).addClass('active');
    //     $('.tab').removeClass('active');
    //     $(`.tab[data-id="${sessionStorage.getItem('selected-customer-identifier-tab')}"]`).addClass('active');
    //     digibiz.customer_identifiers = [];
    //     customerIdentifierListPage();
    // });

    //new code
    $(document).on('click', '.customer-identifiers-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-tab', "identifiers");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-tab')}"]`).addClass('active');
        digibiz.customer_identifiers = [];
        customerIdentifierListPage();
    });

    //not-used
    $(document).on('click', '.associate-customer-identifiers-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-customer-identifier-tab', "associate_customer");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-customer-identifier-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-customer-identifier-tab')}"]`).addClass('active');
        digibiz.associate_customer_identifiers = [];
        associateCustomerIdentifierListPage();
    });

    //old code
    // $(document).on('click', '.primary-customer-label-tab', function () {
    //     addLoader();
    //     sessionStorage.setItem('selected-customer-identifier-tab', "customer_label");
    //     $('.tab-content').removeClass('active');
    //     $(`.tab-content[id="${sessionStorage.getItem('selected-customer-identifier-tab')}"`).addClass('active');
    //     $('.tab').removeClass('active');
    //     $(`.tab[data-id="${sessionStorage.getItem('selected-customer-identifier-tab')}"]`).addClass('active');
    //     // digibiz.associate_customer_identifiers = [];
    //     primaryCustomerLabelListPage();
    // });

    //new code
    $(document).on('click', '.customer-label-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-tab', "labels");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-tab')}"]`).addClass('active');
        digibiz.associate_customer_identifiers = [];
        associateCustomerIdentifierListPage();
    });

    //customer identifier add button
    $(document).on('click', '#customer_identifier_add_button', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-customer-identifier-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Identifier Name",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-new-customer-identifier-cancel" }]
                    },
                    {
                        name: "Add",
                        attr: [{ name: "id", value: "alert-new-customer-identifier-add" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        }, 'layouts/popup/customer_identifier', '#customer-identifier-template', null);
    });

    //on click of cancel
    $(document).on('click', '#alert-new-customer-identifier-cancel, #alert-edit-customer-identifier-cancel', function () {
        $('#modal-customer-identifier-add-cancel').remove();
    });

    //on click of add
    $(document).on('click', '#alert-new-customer-identifier-add', function () {
        addLoader();
        var getIdentifierName = $('#customer_identifier_name').text();
        var type = "customer_identifier";
        if (validateIdentifierData(type)) {
            $('#modal-customer-identifier-add-cancel').remove();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "customer",
                identifier: firstLetterUpperCase(getIdentifierName),
            }
            customerIdentifierAdd(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierAdd success", response);
                    if ($('.no_data').length > 0) {
                        $('.no_data').remove();
                    }
                    //         var template = `<div class="customer-identifier-wrapper" data-id="${response.id}" data-status="${response.status.status}">                    
                    //     <div class="profile-pic-info-wrapper">                            
                    //       <div class="customer-identifier-data-wrapper ellipsify">
                    //         <div class="customer-identifier-name" value="${response.identifier}"><span class="truncate">${response.identifier}</span></div>
                    //       </div>              
                    //     </div>  
                    //     <div class="btn-wrap">              
                    //      <div class="more-menu-wrapper show-action-customer-identifier-data" id="show-action-customer-identifier-data"><i class="material-icons">more_vert</i></div>
                    //     </div>
                    //   </div>`;
                    //         $('.customer-identifiers-list-contentbox').prepend(template);
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '#show-action-customer-identifier-data', function () {
        var getIdentifierId = $(this).parents('.customer-identifier-wrapper').attr('data-id');
        addLoader();
        var action_sheet_parms = {
            action_id: "customer-identifier-actions",
            action_platform: crossplat.device.platform,
            action_title: "Actions",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "id", value: "customer_identifier_edit" }]
            },
            {
                name: "Delete",
                attr: [{ name: "id", value: "customer_identifier_delete" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $('#customer-identifier-actions').attr('data-id', getIdentifierId);
            removeLoader();
        });
    });

    //edit
    $(document).on('click', '#customer_identifier_edit', function () {
        addLoader();
        var getIdentifierId = $('#customer-identifier-actions').attr('data-id');
        $('#customer-identifier-actions').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getIdentifierId
        }
        customerIdentifierGet(reqParam)
            .then((response) => {
                //console.log("customerIdentifierGet success", response);
                var getData = {
                    identifier: response.identifier,
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        var alert_parms = {
                            alert_id: "modal-customer-identifier-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Identifier Name",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-customer-identifier-cancel" }]
                            },
                            {
                                name: "Add",
                                attr: [{ name: "id", value: "alert-edit-customer-identifier-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-customer-identifier-add-cancel').attr('data-id', getIdentifierId);
                            removeLoader();
                        });
                    }
                }, 'layouts/popup/customer_identifier', '#customer-identifier-template', getData);
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in getting customer identifier")
            })
    });

    //confirm edit(with new identifier name)
    $(document).on('click', '#alert-edit-customer-identifier-add', function () {
        addLoader();
        var getIdentifierName = $('#customer_identifier_name').text();
        var getIdentifierId = $('#modal-customer-identifier-add-cancel').attr('data-id');
        var type = "customer_identifier";
        if (validateIdentifierData(type)) {
            $('#modal-customer-identifier-add-cancel').remove();
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: getIdentifierId,
                data: {
                    identifier: firstLetterUpperCase(getIdentifierName),
                }
            }
            customerIdentifierUpdate(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierUpdate success", response);
                    // $(`.customer-identifier-wrapper[data-id="${response.id}"]`).find('.customer-identifier-name').attr('value', response.identifier);
                    // $(`.customer-identifier-wrapper[data-id="${response.id}"]`).find('.customer-identifier-name').find('span').text(response.identifier);
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("Error in customerIdentifierUpdate customer identifier");
                })
        } else {
            removeLoader();
        }
    });

    //delete
    $(document).on('click', '#customer_identifier_delete', function () {
        addLoader();
        var getIdentifierId = $('#customer-identifier-actions').attr('data-id');
        $('#customer-identifier-actions').remove();
        fetch.getHtml(function (fetcherror, html) {
            var alert_parms = {
                alert_id: "alert-delete-customer-identifier-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Delete Customer Identifier`,
                alert_body: html,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-customer-identifier-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-customer-identifier-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-delete-customer-identifier-confirm-cancel').attr('data-id', getIdentifierId); //set getIdentifierId
            });
        }, 'layouts/alert_templates/delete_identier', '#delete-identifier-template', null);
    });

    //on delete no
    $(document).on('click', '#btn-delete-customer-identifier-cancel-no', function () {
        $('#alert-delete-customer-identifier-confirm-cancel').remove();
    });

    //on delete confirm
    $(document).on('click', '#btn-delete-customer-identifier-confirm-yes', function () {
        addLoader();
        var getIdentifierId = $('#alert-delete-customer-identifier-confirm-cancel').attr('data-id');
        var getDeleteFolderValue = $('.delete-identifier-folder-delete-yes-radio-button').is(':checked');
        $('#alert-delete-customer-identifier-confirm-cancel').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getIdentifierId,
            folder_delete: getDeleteFolderValue
        }
        customerIdentifierDelete(reqParam)
            .then((response) => {
                $(`.customer-identifier-wrapper[data-id="${getIdentifierId}"]`).remove();
                Materialize.toast(`Successfully Deleted`, 3000, 'round success-alert');
                if ($('.customer-identifier-wrapper').length == 0) {
                    $('.customer-identifiers-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                //console.log("Error in deleting customer identifier");
            })
    });

    //associate customer identifier add button
    $(document).on('click', '#associate_customer_identifier_add_button', function () {
        addLoader();
        if ($('.associate-customer-identifier-wrapper').length < config.AssociateCustomerMax) {
            fetch.getHtml(function (fetcherror, html) {
                if (!fetcherror) {
                    var alert_parms = {
                        alert_id: "modal-associate-customer-identifier-add-cancel",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Identifier Name",
                        alert_body: html,
                        alert_btn: [{
                            name: "Cancel",
                            attr: [{ name: "id", value: "alert-new-associate-customer-identifier-cancel" }]
                        },
                        {
                            name: "Add",
                            attr: [{ name: "id", value: "alert-new-associate-customer-identifier-add" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                }
            }, 'layouts/popup/associate_customer_identifier', '#associate-customer-identifier-template', null);
        } else {
            removeLoader();
            Materialize.toast(`Maximum Exceeded`, 3000, 'round success-alert');
        }
    });

    //on click of cancel
    $(document).on('click', '#alert-new-associate-customer-identifier-cancel, #alert-edit-associate-customer-identifier-cancel', function () {
        $('#modal-associate-customer-identifier-add-cancel').remove();
    });

    //on click of add
    $(document).on('click', '#alert-new-associate-customer-identifier-add', function () {
        addLoader();
        var getIdentifierName = $('#associate_customer_identifier_name').text();
        var type = "associate_customer_identifier";
        if (validateIdentifierData(type)) {
            $('#modal-associate-customer-identifier-add-cancel').remove();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "associate_customer",
                identifier: firstLetterUpperCase(getIdentifierName),
            }
            customerIdentifierAdd(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierAdd success", response);
                    if ($('.no_data').length > 0) {
                        $('.no_data').remove();
                    }
                    var template = `<div class="associate-customer-identifier-wrapper" data-id="${response.id}" data-status="${response.status.status}">                    
                <div class="profile-pic-info-wrapper">                            
                  <div class="associate-customer-identifier-data-wrapper ellipsify">
                    <div class="associate-customer-identifier-name" value="${response.identifier}"><span class="truncate">${response.identifier}</span></div>
                  </div>              
                </div>  
                <div class="btn-wrap">              
                 <div class="more-menu-wrapper show-action-associate-customer-identifier-data" id="show-action-associate-customer-identifier-data"><i class="material-icons">more_vert</i></div>
                </div>
              </div>`;
                    $('.associate-customer-identifiers-list-contentbox').prepend(template);
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                    //console.log("Error in adding associate customer identifier");
                })
        } else {
            removeLoader();
        }
    });

    //more vert button
    $(document).on('click', '#show-action-associate-customer-identifier-data', function () {
        var getIdentifierId = $(this).parents('.associate-customer-identifier-wrapper').attr('data-id');
        addLoader();
        var action_sheet_parms = {
            action_id: "associate-customer-identifier-actions",
            action_platform: crossplat.device.platform,
            action_title: "Actions",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "id", value: "associate_customer_identifier_edit" }]
            },
            {
                name: "Delete",
                attr: [{ name: "id", value: "associate_customer_identifier_delete" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $('#associate-customer-identifier-actions').attr('data-id', getIdentifierId);
            removeLoader();
        });
    });

    //edit
    $(document).on('click', '#associate_customer_identifier_edit', function () {
        addLoader();
        var getIdentifierId = $('#associate-customer-identifier-actions').attr('data-id');
        $('#associate-customer-identifier-actions').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getIdentifierId
        }
        customerIdentifierGet(reqParam)
            .then((response) => {
                //console.log("customerIdentifierAdd success", response);
                var getData = {
                    identifier: response.identifier,
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        var alert_parms = {
                            alert_id: "modal-associate-customer-identifier-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Identifier Name",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-associate-customer-identifier-cancel" }]
                            },
                            {
                                name: "Add",
                                attr: [{ name: "id", value: "alert-edit-associate-customer-identifier-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-associate-customer-identifier-add-cancel').attr('data-id', getIdentifierId);
                            removeLoader();
                        });
                    }
                }, 'layouts/popup/associate_customer_identifier', '#associate-customer-identifier-template', getData);
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in getting associate customer identifier")
            })
    });

    //confirm edit(with new identifier name)
    $(document).on('click', '#alert-edit-associate-customer-identifier-add', function () {
        addLoader();
        var getIdentifierName = $('#associate_customer_identifier_name').text();
        var getIdentifierId = $('#modal-associate-customer-identifier-add-cancel').attr('data-id');
        var type = "associate_customer_identifier";
        if (validateIdentifierData(type)) {
            $('#modal-associate-customer-identifier-add-cancel').remove();
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: getIdentifierId,
                data: {
                    identifier: firstLetterUpperCase(getIdentifierName),
                }
            }
            customerIdentifierUpdate(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierUpdate success", response);
                    // $(`.associate-customer-identifier-wrapper[data-id="${response.id}"]`).find('.associate-customer-identifier-name').attr('value', response.identifier);
                    // $(`.associate-customer-identifier-wrapper[data-id="${response.id}"]`).find('.associate-customer-identifier-name').find('span').text(response.identifier);
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("Error in customerIdentifierUpdate customer identifier");
                })
        } else {
            removeLoader();
        }
    });

    //delete
    $(document).on('click', '#associate_customer_identifier_delete', function () {
        addLoader();
        var getIdentifierId = $('#associate-customer-identifier-actions').attr('data-id');
        $('#associate-customer-identifier-actions').remove();
        var alert_parms = {
            alert_id: "alert-delete-associate-customer-identifier-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Associate Customer Identifier`,
            alert_body: `Are you sure you want to delete the associate customer identifier?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-associate-customer-identifier-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-associate-customer-identifier-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-associate-customer-identifier-confirm-cancel').attr('data-id', getIdentifierId); //set getIdentifierId
        });
    });

    //on delete no
    $(document).on('click', '#btn-delete-associate-customer-identifier-cancel-no', function () {
        $('#alert-delete-associate-customer-identifier-confirm-cancel').remove();
    });

    //on delete confirm
    $(document).on('click', '#btn-delete-associate-customer-identifier-confirm-yes', function () {
        addLoader();
        var getIdentifierId = $('#alert-delete-associate-customer-identifier-confirm-cancel').attr('data-id');
        $('#alert-delete-associate-customer-identifier-confirm-cancel').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getIdentifierId
        }
        customerIdentifierDelete(reqParam)
            .then((response) => {
                $(`.associate-customer-identifier-wrapper[data-id="${getIdentifierId}"]`).remove();
                Materialize.toast(`Successfully Deleted`, 3000, 'round success-alert');
                if ($('.associate-customer-identifier-wrapper').length == 0) {
                    $('.associate-customer-identifiers-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                //console.log("Error in deleting associate customer identifier");
            })
    });

    $(document).on('click', '#primary_customer_label_add_button', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            if (!fetcherror) {
                var alert_parms = {
                    alert_id: "modal-primary-customer-label-add-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Label Name",
                    alert_body: html,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "alert-new-primary-customer-label-cancel" }]
                    },
                    {
                        name: "Add",
                        attr: [{ name: "id", value: "alert-new-primary-customer-label-add" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        }, 'layouts/popup/primary_customer_label', '#primary-customer-label-template', null);
    });

    //on click of cancel
    $(document).on('click', '#alert-new-primary-customer-label-cancel', function () {
        $('#modal-primary-customer-label-add-cancel').remove();
    });

    //on click of add
    $(document).on('click', '#alert-new-primary-customer-label-add', function () {
        addLoader();
        var getIdentifierName = $('#primary_customer_label_name').text();
        var type = "primary_customer_label";
        if (validateIdentifierData(type)) {
            $('#modal-primary-customer-label-add-cancel').remove();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "primary_customer",
                identifier: firstLetterUpperCase(getIdentifierName),
            }
            customerIdentifierAdd(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierAdd success", response);
                    if ($('.no_data').length > 0) {
                        $('.no_data').remove();
                    }
                    //         var template = `<div class="customer-identifier-wrapper" data-id="${response.id}" data-status="${response.status.status}">                    
                    //     <div class="profile-pic-info-wrapper">                            
                    //       <div class="customer-identifier-data-wrapper ellipsify">
                    //         <div class="customer-identifier-name" value="${response.identifier}"><span class="truncate">${response.identifier}</span></div>
                    //       </div>              
                    //     </div>  
                    //     <div class="btn-wrap">              
                    //      <div class="more-menu-wrapper show-action-customer-identifier-data" id="show-action-customer-identifier-data"><i class="material-icons">more_vert</i></div>
                    //     </div>
                    //   </div>`;
                    //         $('.customer-identifiers-list-contentbox').prepend(template);
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("Error in adding customer identifier");
                })
        } else {
            removeLoader();
        }
    });

    //show-action-primary-customer-label-data
    $(document).on('click', '#show-action-primary-customer-label-data', function () {
        var getIdentifierId = $(this).parents('.customer-identifier-wrapper').attr('data-id');
        addLoader();
        var action_sheet_parms = {
            action_id: "primary-customer-label-actions",
            action_platform: crossplat.device.platform,
            action_title: "Actions",
            action_btn: [{
                name: "Edit",
                attr: [{ name: "id", value: "primary_customer_label_edit" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $('#primary-customer-label-actions').attr('data-id', getIdentifierId);
            removeLoader();
        });
    });

    $(document).on('click', '#primary_customer_label_edit', function () {
        addLoader();
        var getIdentifierId = $('#primary-customer-label-actions').attr('data-id');
        $('#primary-customer-label-actions').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getIdentifierId
        }
        customerIdentifierGet(reqParam)
            .then((response) => {
                //console.log("customerIdentifierAdd success", response);
                var getData = {
                    identifier: response.identifier,
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        var alert_parms = {
                            alert_id: "modal-primary-customer-label-add-cancel",
                            alert_platform: crossplat.device.platform,
                            alert_title: "Label Name",
                            alert_body: html,
                            alert_btn: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-edit-primary-customer-label-cancel" }]
                            },
                            {
                                name: "Add",
                                attr: [{ name: "id", value: "alert-edit-primary-customer-label-add" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#modal-primary-customer-label-add-cancel').attr('data-id', getIdentifierId);
                            removeLoader();
                        });
                    }
                }, 'layouts/popup/primary_customer_label', '#primary-customer-label-template', getData);
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in getting associate customer identifier")
            })
    });

    $(document).on('click', '#alert-edit-primary-customer-label-cancel', function () {
        $('#modal-primary-customer-label-add-cancel').remove();
    });

    $(document).on('click', '#alert-edit-primary-customer-label-add', function () {
        addLoader();
        var getIdentifierName = $('#primary_customer_label_name').text();
        var getIdentifierId = $('#modal-primary-customer-label-add-cancel').attr('data-id');
        var type = "primary_customer_label";
        if (validateIdentifierData(type)) {
            $('#modal-primary-customer-label-add-cancel').remove();
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: getIdentifierId,
                data: {
                    identifier: firstLetterUpperCase(getIdentifierName),
                }
            }
            customerIdentifierUpdate(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierUpdate success", response);
                    // $(`.associate-customer-identifier-wrapper[data-id="${response.id}"]`).find('.associate-customer-identifier-name').attr('value', response.identifier);
                    // $(`.associate-customer-identifier-wrapper[data-id="${response.id}"]`).find('.associate-customer-identifier-name').find('span').text(response.identifier);
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("Error in customerIdentifierUpdate customer identifier");
                })
        } else {
            removeLoader();
        }
    });




    //remove error message on pop-up
    $(document).on('keydown', '#customer_identifier_name, #associate_customer_identifier_name', function () {
        removeError($(this));
    });

    $(document).on('change', '#select-identifier-visibility-type', function () {
        removeError($(this));
    });


    //creation customer
    $(document).on('click', '.customer-creation', function () {
        addLoader();
        // location.hash = `customer_creation/identifiers/list`;
        // location.hash = `customer_creation`;
        location.hash = `identifiers_list_customer_creation`;
    });

    $(document).on('click', '.customer-pending-tab', function () {
        addLoader();
        // sessionStorage.setItem('selected-customer-tab', "customer_pending");
        sessionStorage.setItem('selected-tab', "customer_pending");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-tab')}"]`).addClass('active');

        // var getActiveTab = sessionStorage.getItem('selected-tab');
        // sessionStorage.setItem('identifier_id', getIdentifierId);
        // if (getActiveTab == "customer_active") {
        //     location.hash = `customer_creation/active/list`;
        // } else if (getActiveTab == "customer_pending") {
        //     location.hash = `customer_creation/pending/list`;
        // }
        // location.hash = `customer_creation/pending/list`;
        // pendingCustomerListPage();
        pendingCustomerCreationListPage();
    });

    $(document).on('click', '.customer-active-tab', function () {
        addLoader();
        // sessionStorage.setItem('selected-customer-tab', "customer_active");
        sessionStorage.setItem('selected-tab', "customer_active");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-tab')}"]`).addClass('active');
        // activeCustomerListPage();
        activeCustomerCreationListPage();
    });

    $(document).on('click', '.customer-alumini-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-tab', "customer_alumini");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-tab')}"]`).addClass('active');
        aluminiCustomerListPage();
    });

    //on click of the customer identifiers in the customer creation list page
    $(document).on('click', '.create-customer-identifier-wrapper', function () {
        addLoader();
        var getIdentifierId = $(this).attr('data-id');
        //old code
        // var getActiveTab = sessionStorage.getItem('selected-tab');
        // sessionStorage.setItem('identifier_id', getIdentifierId);
        // if (getActiveTab == "customer_active") {
        //     location.hash = `customer_creation/active/list`;
        // } else if (getActiveTab == "customer_pending") {
        //     location.hash = `customer_creation/pending/list`;
        // }
        sessionStorage.setItem('identifier_id', getIdentifierId);
        location.hash = `customer_creation`;

        //old code
        // var getIdentifierId = $(this).attr('data-id');
        // var getActiveTab = sessionStorage.getItem('selected-customer-tab');
        // sessionStorage.setItem('identifier_id', getIdentifierId);
        // if (getActiveTab == "customer_active") {
        //     location.hash = `customer_creation/active/list`;
        // } else if (getActiveTab == "customer_pending") {
        //     location.hash = `customer_creation/pending/list`;
        // }
    });

    //on click of add customer button
    $(document).on('click', '#add-customer-btn', function () {
        addLoader();
        // $('#choose-customer-identifier-confirm-button').trigger('click');
        if (sessionStorage.getItem('identifier_id') == null || sessionStorage.getItem('identifier_id') == undefined || sessionStorage.getItem('identifier_id') == "") {
            //console.log("empty");
            removeLoader();
            Materialize.toast("Please select a identifier", 3000, 'round error-alert');
        } else {
            $(`#choose-customer-identifier-modal`).remove();
            removeLoader();
            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                location.hash = `customer/create`;
            } else {//android/ios
                var action_sheet_parms = {
                    action_id: "customer_creation_by_selection_modal",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "By Notification",
                        attr: [{ name: "id", value: "customer_by_notification" }]
                    },
                    {
                        name: "By QR-code",
                        attr: [{ name: "id", value: "customer_by_qr_code" }]
                    }
                    ]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                });
            }
        }
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     business_id: sessionStorage.getItem('business_id'),
        //     list_by: "customer"
        // }

        // customerIdentifierList(reqParam)
        //     .then((response) => {
        //         if (response.length > 0) {
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "choose-customer-identifier-modal",
        //                 modal_header: "Choose Identifier",
        //                 modal_body: `<div id="choose-customer-identifiers-list-container">                                 
        //                                 <div class="search">
        //                                     <div class="expand-search-wrap search-wrapper" id="choose_customer_identifiers_list_expand_search_wrap">
        //                                         <span class="searchbtn waves-effect cursor-pointer" id="choose-customer-identifiers-list-search-btn"><i class="material-icons">search</i></span>
        //                                         <input class="expand-search-input searchexpand" id="choose_customer_identifier_list_expand_search_input" type="search" placeholder="Search" autocomplete="off"/>
        //                                         <span class="searchclosebtn" id="choose_customer_identifier_list_searchclosebtn"><i class="material-icons choose-customer-identifier-list-close-btn hide">close</i></span>
        //                                     </div>
        //                                 </div>
        //                                 <div id="choose-customer-identifier-list"></div>
        //                             </div>`,
        //                 modal_action_buttons: [{
        //                     name: "Confirm",
        //                     attr: [{ name: "id", value: "choose-customer-identifier-confirm-button" }]
        //                 }]
        //             }
        //             showModal(modal_data, function () {
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 processChooseCustomerIdentifierList(response, function () {
        //                     removeLoader();
        //                     setTimeout(function () {
        //                         // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
        //                         var element = $('#choose-customer-identifier-modal').find('.expand-search-input');
        //                         if (element) {
        //                             //console.log('element22', element);
        //                             //if element is there
        //                             $(document).on('input', element, function () {
        //                                 //on input set attribute socketid 
        //                                 timestamp = (new Date()).getTime();
        //                                 element.attr("socketid", timestamp);
        //                             });
        //                             // element.addEventListener("keyup", function (e) {
        //                             $(document).on('keyup', element, function () {
        //                                 // if (!hasClass(e.target, 'filemanager-search')) {
        //                                 //console.log("not has class")
        //                                 // on keyup get attribute 
        //                                 socketid = element.attr("socketid");
        //                                 keyword = element.val();
        //                                 if (socketid && keyword) {
        //                                     //if socketid attribute and keyword is there
        //                                     document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
        //                                     currentroute = $("body").attr('app');
        //                                     data = {
        //                                         room: crossplat.device.uuid,
        //                                         socketid,
        //                                         app: 'digibiz',
        //                                         keyword
        //                                     };
        //                                     switch (currentroute) {
        //                                         case 'customer_creation':
        //                                             if ($('.tab.active').attr('data-id') == "customer_pending") {
        //                                                 if ($('#choose-customer-identifier-modal').length > 0) {
        //                                                     data['index'] = 'getCustomerIdentifiersTab';
        //                                                     data['business_id'] = sessionStorage.getItem('business_id');
        //                                                 }
        //                                             }
        //                                             break;
        //                                         default:
        //                                             break;
        //                                     }
        //                                     addLoader();
        //                                     //console.log("search emit", data);
        //                                     sockets.searchSocket.emit('search', data);
        //                                     setTimeout(() => {
        //                                         removeLoader();
        //                                     }, 300);
        //                                 } else {
        //                                     //console.log("going to else part")
        //                                     //else show default list
        //                                     removeLoader();
        //                                     document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
        //                                     currentroute = $("body").attr('app');
        //                                     // element.removeAttribute("socketid");
        //                                     element.attr("socketid", "");
        //                                     switch (currentroute) {
        //                                         case 'customer_creation':
        //                                             if ($('.tab.active').attr('data-id') == "customer_pending") {
        //                                                 if ($('#choose-customer-identifier-modal').length > 0) {
        //                                                     processChooseCustomerIdentifierList(digibiz.chooseCustomerIdentifiers, function () {
        //                                                     });
        //                                                 }
        //                                             }
        //                                             break;
        //                                         default:
        //                                             break;
        //                                     }

        //                                 }
        //                             });
        //                             $(document).on('click', '.searchclosebtn', function () {
        //                                 if ($('.tab.active').attr('data-id') == "customer_pending") {
        //                                     if ($('#choose-customer-identifier-modal').length > 0) {
        //                                         processChooseCustomerIdentifierList(digibiz.chooseCustomerIdentifiers, function () {
        //                                         });
        //                                     }
        //                                 }
        //                             })
        //                         }
        //                     }, 0);
        //                 });
        //             });
        //         } else {
        //             //console.log("no length");
        //             var alert_parms = {
        //                 alert_id: "alert-no-identifiers-found-add-cancel-popup",
        //                 alert_platform: crossplat.device.platform,
        //                 alert_title: `Alert`,
        //                 alert_body: `Please add identifiers to create the customers.`,
        //                 alert_btn: [{
        //                     name: "Cancel",
        //                     attr: [{ name: "id", value: "btn-cancel-identifier-add-customer-creation" }]
        //                 },
        //                 {
        //                     name: "Ok",
        //                     attr: [{ name: "id", value: "btn-ok-identifier-add-customer-creation" }]
        //                 }]
        //             }
        //             showAlert(alert_parms, function () {
        //                 removeLoader();
        //             });
        //         }
        //     })
        //     .catch((err) => {
        //         //console.log("err", err);
        //         var alert_parms = {
        //             alert_id: "alert-no-identifiers-found-add-cancel-popup",
        //             alert_platform: crossplat.device.platform,
        //             alert_title: `Alert`,
        //             alert_body: `Please add identifiers to create the customers.`,
        //             alert_btn: [{
        //                 name: "Cancel",
        //                 attr: [{ name: "id", value: "btn-cancel-identifier-add-customer-creation" }]
        //             },
        //             {
        //                 name: "Ok",
        //                 attr: [{ name: "id", value: "btn-ok-identifier-add-customer-creation" }]
        //             }]
        //         }
        //         showAlert(alert_parms, function () {
        //             removeLoader();
        //         });
        //     })
    });
    // $(document).on('click', '#add-customer-btn', function () {
    //     addLoader();
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         business_id: sessionStorage.getItem('business_id'),
    //         list_by: "customer"
    //     }
    //     customerIdentifierList(reqParam)
    //         .then((response) => {
    //             if (response.length > 0) {
    //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                     location.hash = `customer/create`;
    //                 } else {//android/ios
    //                     var action_sheet_parms = {
    //                         action_id: "customer_creation_by_selection_modal",
    //                         action_platform: crossplat.device.platform,
    //                         action_title: "Options",
    //                         action_btn: [{
    //                             name: "By Notification",
    //                             attr: [{ name: "id", value: "customer_by_notification" }]
    //                         },
    //                         {
    //                             name: "By QR-code",
    //                             attr: [{ name: "id", value: "customer_by_qr_code" }]
    //                         }
    //                         ]
    //                     }
    //                     showAction(action_sheet_parms, function () {
    //                         removeLoader();
    //                         $(".action-sheet-container").removeClass('hide').addClass('slide-top');
    //                     });
    //                 }
    //             } else {
    //                 //console.log("no length");
    //                 var alert_parms = {
    //                     alert_id: "alert-no-identifiers-found-add-cancel-popup",
    //                     alert_platform: crossplat.device.platform,
    //                     alert_title: `Alert`,
    //                     alert_body: `Please add identifiers to create the customers.`,
    //                     alert_btn: [{
    //                         name: "Cancel",
    //                         attr: [{ name: "id", value: "btn-cancel-identifier-add-customer-creation" }]
    //                     },
    //                     {
    //                         name: "Ok",
    //                         attr: [{ name: "id", value: "btn-ok-identifier-add-customer-creation" }]
    //                     }]
    //                 }
    //                 showAlert(alert_parms, function () {
    //                     removeLoader();
    //                 });
    //             }
    //         })
    //         .catch((err) => {
    //             //console.log("err", err);
    //             var alert_parms = {
    //                 alert_id: "alert-no-identifiers-found-add-cancel-popup",
    //                 alert_platform: crossplat.device.platform,
    //                 alert_title: `Alert`,
    //                 alert_body: `Please add identifiers to create the customers.`,
    //                 alert_btn: [{
    //                     name: "Cancel",
    //                     attr: [{ name: "id", value: "btn-cancel-identifier-add-customer-creation" }]
    //                 },
    //                 {
    //                     name: "Ok",
    //                     attr: [{ name: "id", value: "btn-ok-identifier-add-customer-creation" }]
    //                 }]
    //             }
    //             showAlert(alert_parms, function () {
    //                 removeLoader();
    //             });
    //         })
    // });

    //cancel button
    $(document).on('click', '#btn-cancel-identifier-add-customer-creation', function () {
        $('#alert-no-identifiers-found-add-cancel-popup').remove();
    });

    //ok button
    $(document).on('click', '#btn-ok-identifier-add-customer-creation', function () {
        $('#alert-no-identifiers-found-add-cancel-popup').remove();
        $('.customer-identifiers-tab').click();
    });

    //customer by notification
    $(document).on('click', '#customer_by_notification', function () {
        addLoader();
        $('#customer_creation_by_selection_modal').remove();
        location.hash = `customer/create`;
    });

    //customer by QR code
    $(document).on('click', '#customer_by_qr_code', function () {
        addLoader();
        $('#customer_creation_by_selection_modal').remove();
        location.hash = '#customer/scan_qr';
    });

    //cancel button in customer creation flow
    $(document).on('click', '.cancel-customer-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        if (location.href.split('#').pop() == "collaborator/customer/create") {
            location.hash = `customer/collaborators`;
        } else {
            if (sessionStorage.getItem('customer_id')) {
                if (sessionStorage.getItem('digibiz_role') == "customer") {
                    sessionStorage.removeItem('edit_from');
                    location.hash = `customer/profile`;
                } else {
                    reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('customer_id'),
                        data: {
                            socket_enable_status: "true",
                            update_for: "socket_enable_status"
                        }
                    }
                    //console.log("reqParam", reqParam);
                    customerUpdate(reqParam)
                        .then((response) => {
                            //console.log("customerUpdate", response);
                            sessionStorage.removeItem('customer_id');
                            sessionStorage.removeItem('customer_name');
                            //new code
                            // location.hash = `customer_creation`;
                            //old code
                            // var getActiveTab = sessionStorage.getItem('selected-customer-tab');
                            // if (getActiveTab == "customer_active") {
                            // location.hash = `customer_creation/active/list`;
                            location.hash = `customer_creation`;
                            // } else if (getActiveTab == "customer_pending") {
                            //     location.hash = `customer_creation/pending/list`;
                            // }
                            appScroll.scrollBar('#main-container').destory();
                        })
                        .catch((err) => {
                            //console.log("error in update business api", err);
                            if (err.msg == "no updated data found") {
                                sessionStorage.removeItem('customer_id');
                                //new code
                                location.hash = `customer_creation`;
                                //old code
                                // var getActiveTab = sessionStorage.getItem('selected-customer-tab');
                                // if (getActiveTab == "customer_active") {
                                //     location.hash = `customer_creation/active/list`;
                                // } else if (getActiveTab == "customer_pending") {
                                //     location.hash = `customer_creation/pending/list`;
                                // }
                            }
                        })
                }
            } else {
                //new code
                location.hash = `customer_creation`;

                //old code
                // var getActiveTab = sessionStorage.getItem('selected-customer-tab');
                // if (getActiveTab == "customer_active") {
                //     location.hash = `customer_creation/active/list`;
                // } else if (getActiveTab == "customer_pending") {
                //     location.hash = `customer_creation/pending/list`;
                // }
            }
        }
    });

    //notify button in customer creation flow
    $(document).on('click', '.notify-customer-btn', function (e) {
        addLoader();
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        if ($('#add-customer-mobile-number').val().length > 0) {
            var mobile_number = $('#add-customer-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
            var reqParams = {
                device_id: crossplat.device.uuid,
                data: {
                    "jeevi": ["name", "id", "profile_display", "user_name"]
                }
            }
            if ($('#add-customer-mobile-number').intlTelInput("isValidNumber")) {
                reqParams.type = "mobile_number";
                reqParams.value = mobile_number;

                getRolesForContactNumberCustomer(reqParams, function () {
                    // $('#add-jeevi-member').removeClass('disabled');
                });

            } else {
                removeLoader();
                Materialize.toast(`Please enter valid number`, 3000, 'round error-alert');
            }
        } else {
            removeLoader();
            Materialize.toast(`Please enter data`, 3000, 'round success-alert');
        }
    });

    // $(document).on('click', '.notify-customer-btn', function () {
    //     addLoader();
    //     var data_type;
    //     if ($('#jeevi_member_field').val().length > 0) {
    //         var unique_name = $('#jeevi_member_field').val().trim();
    //         data_type = "unique_name";
    //     } else 
    //     if ($('#add-customer-mobile-number').val().length > 0) {
    //         var mobileNumber = $('#add-customer-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
    //         data_type = "mobile_number";
    //     }
    //     //console.log("data_type", data_type);
    //     if (data_type == null || data_type == undefined || data_type == "") {
    //         removeLoader();
    //         Materialize.toast(`Please enter data`, 3000, 'round success-alert');
    //     } else {
    //         var reqParam = {
    //             device_id: crossplat.device.uuid,
    //             data_type: data_type,
    //             add_type: "add",
    //             type: "customer",
    //             business_id: sessionStorage.getItem('business_id'),
    //             identifier_id: sessionStorage.getItem('identifier_id'),
    //             unique_name: unique_name,
    //             mobile_number: mobileNumber,
    //             // role: {
    //             //     id: "532291264783713815",
    //             //     type: "individual",
    //             //     business_id: sessionStorage.getItem('business_id'),
    //             // }
    //         }
    //         notificationAdd(reqParam)
    //             .then((response) => {
    //                 //console.log("notificationAdd response", response);
    //                 Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
    //                 var getActiveTab = sessionStorage.getItem('selected-customer-tab');
    //                 if (getActiveTab == "customer_active") {
    //                     location.hash = `customer_creation/active/list`;
    //                 } else if (getActiveTab == "customer_pending") {
    //                     location.hash = `customer_creation/pending/list`;
    //                 }
    //             })
    //             .catch((err) => {
    //                 //console.log("notificationAdd error", err);
    //                 Materialize.toast(err.msg, 3000, 'round success-alert');
    //                 removeLoader();
    //             });
    //     }
    // });

    //on click of pending customer wrapper
    $(document).on('click', '.pending-customer-wrapper', function () {
        addLoader();
        var getUUid = $(this).attr('data-uuid');
        var getCustomerNotificationType = $(this).attr('data-type');
        var getCollaboratorBusinessId = $(this).attr('data-collaborator_business_id');
        sessionStorage.setItem('contact_uuid', getUUid);
        sessionStorage.setItem('customer_notification_type', getCustomerNotificationType);
        sessionStorage.setItem('collaborator_business_id', getCollaboratorBusinessId);
        location.hash = `customer/notification/details`;
    });

    //resent customer notification
    $(document).on('click', '#resent-customer-notification', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            add_type: "resend",
            identifier_id: sessionStorage.getItem('identifier_id'),
            contact_user_id: sessionStorage.getItem('contact_user_id'),
        }
        notificationAdd(reqParam)
            .then((response) => {
                //console.log("notificationAdd response", response);
                Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                var getActiveTab = sessionStorage.getItem('selected-customer-tab');
                if (getActiveTab == "customer_active") {
                    location.hash = `customer_creation/active/list`;
                } else if (getActiveTab == "customer_pending") {
                    location.hash = `customer_creation/pending/list`;
                }
            })
            .catch((err) => {
                //console.log("notificationAdd error", err);
                Materialize.toast(err.msg, 3000, 'round success-alert');
                removeLoader();
            });
    });

    $(document).on('click', '#delete-customer-notification', function () {
        addLoader();
        var getNotificationId = $(this).parents('.customer-notification-details-wrapper').attr('data-notification-id');
        var getNotificationType = $(this).parents('.customer-notification-details-wrapper').attr('data-notification-type');
        var reqParam = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationId,
            notification_type: getNotificationType
        }
        notificationDelete(reqParam)
            .then((response) => {
                //console.log("notificationDelete success", response);
                removeLoader();
                $(this).parents('.customer-notification-details-wrapper').remove();
                if ($('.customer-notification-details-wrapper').length == 0) {
                    $('.customer-notification-details-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
                Materialize.toast(`Successfully deleted the notification.`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                //console.log("notificationDelete err", err);
                Materialize.toast(`Error in deleting the notification.`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#show-action-active-customer-data', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getCustomerId = $(this).parents('.active-customer-wrapper').attr('data-customer-id');
        var getCustomerStatus = $(this).parents('.active-customer-wrapper').attr('data-status');
        var getCustomerSocketStatus = $(this).parents('.active-customer-wrapper').attr('data-socket-status');
        if (getCustomerStatus == "active") {
            var action_sheet_parms = {
                action_id: "customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Edit",
                    attr: [{ name: "class", value: "customer_edit" }]
                },
                {
                    name: "Inactivate",
                    attr: [{ name: "class", value: "customer_inactivate" }]
                },
                {
                    name: "Delete",
                    attr: [{ name: "class", value: "customer_delete" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('customer_id', getCustomerId);
                $(".action-sheet-container").attr('customer_socket_status', getCustomerSocketStatus);
            });
        } else if (getCustomerStatus == "accepted") {
            var action_sheet_parms = {
                action_id: "customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Complete Profile",
                    attr: [{ name: "class", value: "customer_edit" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('customer_id', getCustomerId);
                $(".action-sheet-container").attr('customer_socket_status', getCustomerSocketStatus);
            });
        } else if (getCustomerStatus == "inactive") {
            var action_sheet_parms = {
                action_id: "customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Edit",
                    attr: [{ name: "class", value: "customer_edit" }]
                },
                {
                    name: "Activate",
                    attr: [{ name: "class", value: "customer_activate" }]
                },
                {
                    name: "Delete",
                    attr: [{ name: "class", value: "customer_delete" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('customer_id', getCustomerId);
                $(".action-sheet-container").attr('customer_socket_status', getCustomerSocketStatus);
            });
        } else if (getCustomerStatus == "exited") {
            var action_sheet_parms = {
                action_id: "customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Delete",
                        attr: [{ name: "class", value: "customer_delete" }]
                    }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('customer_id', getCustomerId);
                $(".action-sheet-container").attr('customer_socket_status', getCustomerSocketStatus);
            });
        }

    });

    //customer edit
    $(document).on('click', '.customer_edit', function () {
        addLoader();
        var getCustomerId = $('.action-sheet-container').attr('customer_id');
        var getSocketStatus = $(".action-sheet-container").attr('customer_socket_status');
        if (getSocketStatus == "true") {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: getCustomerId,
                data: {
                    socket_enable_status: "false",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            customerUpdate(reqParam)
                .then((response) => {
                    //console.log("customerUpdate", response);
                    sessionStorage.setItem('customer_id', getCustomerId);
                    sessionStorage.setItem('customer_name', `${response.name.first} ${response.name.first}`);
                    $('#customer_alert_actions').remove();
                    location.hash = `customer/create`;
                })
                .catch((err) => {
                    //console.log("error in update customer update api", err);
                    if (err.msg == "no updated data found") {
                        sessionStorage.setItem('customer_id', getCustomerId);
                        $('#customer_alert_actions').remove();
                        location.hash = `customer/create`;
                    }
                })
        } else {//getSocketStatus is false
            $('#customer_alert_actions').remove();
            Materialize.toast(`Access Denied! You or other administrator is creating this customer at other place.`, 3000, "round error-alert");
            var alert_parms = {
                alert_id: "alert-customer-device-change-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Access Denied! You or other administrator is creating this customer at other place. Would to like to cancel there and continue here?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-customer-device-change-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-customer-device-change-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-customer-device-change-confirm-cancel').attr('data-customer-id', getCustomerId); //set getCustomerId
            });
        }
    });

    $(document).on('click', '#btn-customer-device-change-cancel-no', function () {
        $('#alert-customer-device-change-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-customer-device-change-confirm-yes', function () {
        addLoader();
        var getCustomerId = $('#alert-customer-device-change-confirm-cancel').attr('data-customer-id');
        var requestParams = {
            device_id: crossplat.device.uuid,
            customer_id: getCustomerId
        }
        customerDeviceChange(requestParams)
            .then((response) => {
                //console.log("customerDeviceChange", response);
                sessionStorage.setItem("customer_id", getCustomerId);
                //console.log("success in changing device");
                $('#alert-customer-device-change-confirm-cancel').remove();
                location.hash = `customer/create`;
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in changing device");
            })
    });

    $(document).on('click', '#btn-customer-changed-device-ok', function () {
        addLoader();
        $('#alert-customer-changed-device-confirm').remove();
        sessionStorage.removeItem('customer_id');
        location.hash = `customer_creation/active/list`;
    });

    //customer create forward button
    $(document).on('click', '.customer-forward-btn', function () {
        console.log('efewgrg', location.href.split('#').pop());
        addLoader();
        var getPresentStep = $(this).attr('data-present-step');
        console.log('getPresentStep', getPresentStep)
        if (getPresentStep == "2" || getPresentStep == 2) {
            // if (validateCustomerStepTwo()) {
            if (location.href.split('#').pop() == "collaborator/customer/create") {
                console.log('4455');
                var getEmail = $('#customer_email').text().trim();
                var getAlternateEmail = $('#customer_alternate_email').text().trim();
                var getLabel = $('#customer_label_name').text().trim();
                var getDateOfBirth = $('#customer_date_of_birth').val().trim();
                var weddingAnniversary = $('#customer_wedding_anniversary').val().trim();
                var getDisplayName = $('#customer_display_name').text().trim();
                if ($('#add-customer-display-phone-number').val().length > 0) {
                    var getDisplayphoneNumber = $('#add-customer-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
                } else {
                    var getDisplayphoneNumber;
                }
                // var getCustomerIdentifier = $('#customer-identifier-choose-select-dropdown').val();
                var getCustomerIdentifier = $(`.customer-creation-parts-container[data-step="2"]`).find('.selected-value-customer-identifier').attr('data-id');

                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('collaborator_business_customers_id'),
                    data: {
                        identifier_id: getCustomerIdentifier,
                        email: getEmail,
                        alternate_email: getAlternateEmail,
                        label: firstLetterUpperCase(getLabel),
                        display_name: firstLetterUpperCase(getDisplayName),
                        display_phone_number: getDisplayphoneNumber,
                        status: 'active',
                        date_of_birth: getDateOfBirth,
                        wedding_anniversary: weddingAnniversary,
                        // identity_picture: customerIdentityPictureData
                    }
                }
                collaboratorCustomerBusinessUpdate(requestParams)
                    .then((response) => {
                        //console.log("response", response);
                        removeLoader();
                        //update the next and back button with step 3
                        $('.customer-back-btn').attr('data-present-step', '2');
                        $('.customer-forward-btn').attr('data-present-step', '2');
                        //update the stepper
                        $('.customer-create-stepper').removeClass('is-active');
                        $(`.customer-create-stepper[data-stepper="4"]`).addClass('is-active');
                        //show the next content
                        $(`.customer-creation-parts-container[data-step="2"]`).addClass('hide');
                        $(`.customer-creation-parts-container[data-step="3"]`).addClass('hide');
                        $(`.customer-creation-parts-container[data-step="4"]`).removeClass('hide');
                        //hide forward button
                        // $('.customer-forward-btn').addClass('hide');
                        //show back button
                        $('.customer-back-btn').removeClass('hide');
                        //show register button
                        // $('.register-customer-btn').removeClass('hide');
                    })
                    .catch((err) => {
                        if (err.msg == "no updated data found") {
                            removeLoader();
                            //update the next and back button with step 3
                            $('.customer-back-btn').attr('data-present-step', '3');
                            $('.customer-forward-btn').attr('data-present-step', '3');
                            //update the stepper
                            $('.customer-create-stepper').removeClass('is-active');
                            $(`.customer-create-stepper[data-stepper="3"]`).addClass('is-active');
                            //show the next content
                            $(`.customer-creation-parts-container[data-step="2"]`).addClass('hide');
                            $(`.customer-creation-parts-container[data-step="3"]`).removeClass('hide');
                            //hide forward button
                            // $('.customer-forward-btn').addClass('hide');
                            //show back button
                            $('.customer-back-btn').removeClass('hide');
                            //show register button
                            // $('.register-customer-btn').removeClass('hide');
                        }
                        //console.log("error in customerUpdate");
                    })

            } else {
                var getEmail = $('#customer_email').text().trim();
                var getAlternateEmail = $('#customer_alternate_email').text().trim();
                var getLabel = $('#customer_label_name').text().trim();
                var getDateOfBirth = $('#customer_date_of_birth').val().trim();
                var weddingAnniversary = $('#customer_wedding_anniversary').val().trim();
                var getDisplayName = $('#customer_display_name').text().trim();
                if ($('#add-customer-display-phone-number').val().length > 0) {
                    var getDisplayphoneNumber = $('#add-customer-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
                } else {
                    var getDisplayphoneNumber;
                }
                // var getCustomerIdentifier = $('#customer-identifier-choose-select-dropdown').val();
                var getCustomerIdentifier = $(`.customer-creation-parts-container[data-step="2"]`).find('.selected-value-customer-identifier').attr('data-id');

                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('customer_id'),
                    data: {
                        identifier_id: getCustomerIdentifier,
                        email: getEmail,
                        alternate_email: getAlternateEmail,
                        label: firstLetterUpperCase(getLabel),
                        display_name: firstLetterUpperCase(getDisplayName),
                        display_phone_number: getDisplayphoneNumber,
                        status: 'active',
                        date_of_birth: getDateOfBirth,
                        wedding_anniversary: weddingAnniversary,
                        // identity_picture: customerIdentityPictureData
                    }
                }
                customerUpdate(requestParams)
                    .then((response) => {
                        //console.log("response", response);
                        removeLoader();
                        //update the next and back button with step 3
                        $('.customer-back-btn').attr('data-present-step', '3');
                        $('.customer-forward-btn').attr('data-present-step', '3');
                        //update the stepper
                        $('.customer-create-stepper').removeClass('is-active');
                        $(`.customer-create-stepper[data-stepper="3"]`).addClass('is-active');
                        //show the next content
                        $(`.customer-creation-parts-container[data-step="2"]`).addClass('hide');
                        $(`.customer-creation-parts-container[data-step="3"]`).removeClass('hide');
                        //hide forward button
                        // $('.customer-forward-btn').addClass('hide');
                        //show back button
                        $('.customer-back-btn').removeClass('hide');
                        //show register button
                        // $('.register-customer-btn').removeClass('hide');
                    })
                    .catch((err) => {
                        if (err.msg == "no updated data found") {
                            removeLoader();
                            //update the next and back button with step 3
                            $('.customer-back-btn').attr('data-present-step', '3');
                            $('.customer-forward-btn').attr('data-present-step', '3');
                            //update the stepper
                            $('.customer-create-stepper').removeClass('is-active');
                            $(`.customer-create-stepper[data-stepper="3"]`).addClass('is-active');
                            //show the next content
                            $(`.customer-creation-parts-container[data-step="2"]`).addClass('hide');
                            $(`.customer-creation-parts-container[data-step="3"]`).removeClass('hide');
                            //hide forward button
                            // $('.customer-forward-btn').addClass('hide');
                            //show back button
                            $('.customer-back-btn').removeClass('hide');
                            //show register button
                            // $('.register-customer-btn').removeClass('hide');
                        }
                        //console.log("error in customerUpdate");
                    })
            }

            // } else {
            //     removeLoader();
            //     //console.log("error in validateCustomerStepTwo");
            // }
        }
        if (getPresentStep == "3" || getPresentStep == 3) {
            //update the next and back button with step 3
            $('.customer-back-btn').attr('data-present-step', '4');
            $('.customer-forward-btn').attr('data-present-step', '4');
            //update the stepper
            $('.customer-create-stepper').removeClass('is-active');
            $(`.customer-create-stepper[data-stepper="4"]`).addClass('is-active');
            //show the next content
            $(`.customer-creation-parts-container[data-step="3"]`).addClass('hide');
            $(`.customer-creation-parts-container[data-step="4"]`).removeClass('hide');
            //hide forward button
            $('.customer-forward-btn').addClass('hide');
            //show back button
            $('.customer-back-btn').removeClass('hide');
            // //show register button
            // $('.register-customer-btn').removeClass('hide');
            removeLoader();
            //console.log("yesssss")
        }
    });

    //customer back button
    $(document).on('click', '.customer-back-btn', function () {
        addLoader();
        var getPresentStep = $(this).attr('data-present-step');
        if (getPresentStep == "3" || getPresentStep == 3) {
            //update the next and back button with step 2
            $('.customer-forward-btn').attr('data-present-step', '2');
            $(this).attr('data-present-step', '2');
            //update the stepper
            $('.customer-create-stepper').removeClass('is-active');
            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
            //show the back content
            $(`.customer-creation-parts-container[data-step="3"]`).addClass('hide');
            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
            //show forward button
            $('.customer-forward-btn').removeClass('hide');
            //hide back button
            $('.customer-back-btn').addClass('hide');
            //hide register button
            // $('.register-customer-btn').addClass('hide');
            removeLoader();
        }
        if (getPresentStep == "4" || getPresentStep == 4) {
            //update the next and back button with step 3
            $('.customer-forward-btn').attr('data-present-step', '3');
            $('.customer-back-btn').attr('data-present-step', '3');
            //update the stepper
            $('.customer-create-stepper').removeClass('is-active');
            $(`.customer-create-stepper[data-stepper="3"]`).addClass('is-active');
            //show the back content
            $(`.customer-creation-parts-container[data-step="4"]`).addClass('hide');
            $(`.customer-creation-parts-container[data-step="3"]`).removeClass('hide');
            //show forward button
            $('.customer-forward-btn').removeClass('hide');
            //hide back button
            // $('.customer-back-btn').addClass('hide');
            //hide register button
            // $('.register-customer-btn').addClass('hide');
            removeLoader();
        }
    });

    //customer identity picture upload
    $(document).on('click', '#customer-identity-picture-load-btn', function () {
        digibiz.isCustomerIdentityPictureSelected = false;
        $('.multimedia_wrapper').find('.error_note').remove();
        addLoader();
        var action_parms = {
            action_id: "customer-identity-picture-type-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device",
                    attr: [{ name: "id", value: "customer-identity-picture-device-upload-type-btn" }]
                },
                {
                    name: "Cloud",
                    // attr: [{ name: "id", value: "customer-identity-picture-cloud-upload-type-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera",
                    attr: [{ name: "id", value: "customer-identity-picture-camera-upload-type-btn" }]
                }
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //customer identity picture device upload click
    $(document).on('click', '#customer-identity-picture-device-upload-type-btn', function () {
        addLoader();
        $('#customer-identity-picture-upload').val("");
        $('#customer-identity-picture-upload').trigger('click');
        $('#customer-identity-picture-type-action-sheet').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "customer-identity-picture-modal",
            modal_header: "",
            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "customer-identity-crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: ''
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                    // //console.log("scroll initiated for modal pop-up class")
                    // appScroll.scrollBar('.modal-popup-content');
                }
            }
            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
        });
    });

    //device upload select picture
    $(document).on("change", `#customer-identity-picture-upload`, function () {
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            if (!(config.identityPictureFileFormat.includes(fileType.toLowerCase()))) {
                $('#customer-identity-picture-upload').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#customer-identity-picture-upload').val('');
                $('#customer-identity-picture-upload').attr("src", "");//empty
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#customer-identity-picture-upload').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#customer-identity-picture-upload').val('');
                $('#customer-identity-picture-upload').attr("src", "");//empty
            }
            else {
                if (files[0])
                    var photo = files[0];
                var reader = new FileReader();
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //customer identity picture crop button click
    $(document).on('click', '#customer-identity-crop-button', function () {
        // digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
        //     var reader = new FileReader();
        //     reader.onloadend = function (event) {
        //         if ($('#customer-identity-picture-modal').attr('picture-type') == 'customer_identity_picture') {
        //             $('#customer_identity_picture').attr("src", reader.result);
        //             $('#customer-identity-picture-load-btn').replaceWith(`<i class="material-icons" id="customer-identity-picture-delete">delete</i>`)
        //             $('#customer-identity-picture-delete').parent().removeClass('customer-identity-picture-multimedia-load-btn');
        //             $('#modal-close-btn').trigger('click');
        //             digibiz.isCustomerIdentityPictureSelected = true;
        //         }
        //         digibiz.cropper.destroy();
        //     }
        //     reader.readAsDataURL(blob);
        // });
        addLoader();
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                saveCustomerIdentityPicture(reader.result, blob, function (err, IdentityPicture) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        // var resultData = IdentityPicture;
                        // //console.log("resultData", resultData);
                        // var customerIdentityPictureData = {};
                        // if (resultData != undefined) {
                        //     customerIdentityPictureData = {
                        //         asset_id: resultData.Data.asset_id,
                        //         storage_id: resultData.Data.filename
                        //     }
                        // }
                        // var requestParams = {
                        //     device_id: crossplat.device.uuid,
                        //     id: sessionStorage.getItem('customer_id'),
                        //     data: {
                        //         identity_picture: customerIdentityPictureData
                        //     }
                        // }
                        // customerUpdate(requestParams)
                        //     .then((response) => {
                        //         //console.log("response", response);
                        //         //console.log("IdentityPicture", IdentityPicture);
                        $('#customer_identity_picture').attr("src", reader.result);
                        //remove +
                        $('.customer-identity-picture-multimedia-load-btn').remove();
                        //remove delete
                        $('#customer-identity-picture-delete').remove();
                        $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');
                        //append photo_camera first and then delete
                        $('#customer_identity_picture').siblings('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn" data-thumbnail-id="${IdentityPicture}">photo_camera</i></a>`);
                        $('#customer_identity_picture').siblings('.mask').append(`<a class="info customer-identity-picture-delete-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-delete" data-thumbnail-id="${IdentityPicture}">delete</i></a>`);
                        $('#customer-identity-picture-modal').remove();
                        removeLoader();
                        digibiz.cropper.destroy();
                        // })
                        // .catch((err) => {
                        //     removeLoader();
                        //     Materialize.toast(`Error in uploading identity picture.`, 3000, 'round error-alert');
                        // })
                    }
                });
            }
            reader.readAsDataURL(blob);
        })
    });

    //Delete customer identity picture
    $(document).on('click', '#customer-identity-picture-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        e.stopPropagation();
        var alert_parms = {
            alert_id: "alert-delete-customer-identity-pic-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Identity picture",
            alert_body: `Do you want to delete the customer identity picture?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-customer-identity-pic-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-customer-identity-pic-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-customer-identity-pic-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
        });
    })
    //delete NO clicked
    $(document).on('click', '#btn-delete-customer-identity-pic-confirm-no', function () {
        $('#alert-delete-customer-identity-pic-confirm-cancel').remove();
    })
    //delete YES clicked
    $(document).on('click', '#btn-delete-customer-identity-pic-confirm-yes', function () {
        // var assetId = $('#alert-delete-customer-identity-pic-confirm-cancel').attr('delete-asset-id');
        // $('#alert-delete-customer-identity-pic-confirm-cancel').remove();
        // //api call to delete asset
        // var customerId = sessionStorage.getItem('customer_id');
        // var requesParam = {
        //     device_id: crossplat.device.uuid,
        //     asset_id: assetId,
        //     customer_id: customerId,
        // }
        // addLoader();
        // customerDeleteAsset(requesParam)
        //     .then((response) => {
        //         removeLoader();
        //         $('#customer-identity-picture-upload').val('');
        //         $('#customer_identity_picture').attr("src", "");//empty
        //         $('#customer-identity-picture-delete').replaceWith(`<i class="material-icons" id="customer-identity-picture-load-btn">add</i>`)
        //         $('#customer-identity-picture-load-btn').parent().addClass('customer-identity-picture-multimedia-load-btn');
        //         $('.customer_identity_pic_preview').remove();
        //         digibiz.isCustomerIdentityPictureSelected = false;
        //     })
        //     .catch((err) => {
        //         removeLoader();
        //         Materialize.toast(err.msg, 3000, 'round error-alert');
        //     })
        var thumbnailId = $('#alert-delete-customer-identity-pic-confirm-cancel').attr('delete-thumbnail-id');
        $('#alert-delete-customer-identity-pic-confirm-cancel').remove();
        //api call to delete customer identity picture from dj cloud bucket
        var customerId = sessionStorage.getItem('customer_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            identity_picture_id: thumbnailId,
            customer_id: customerId,
        }
        addLoader();
        customerDeleteIdentityPicture(requesParam)
            .then((response) => {
                removeLoader();
                $('#customer-identity-picture-upload').val('');
                $('#customer_identity_picture').attr("src", "");//empty
                $('#customer-identity-picture-delete').remove();//remove delete button
                $('#customer-identity-picture-load-btn').attr('data-thumbnail-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });


    //customer identity picture cloud upload
    $(document).on('click', '#customer-identity-picture-cloud-upload-type-btn', function () {
        addLoader();
        $('#customer-identity-picture-upload').val("");
        $('#customer-identity-picture-type-action-sheet').remove();

        $('.grid-view-container').removeClass('edit-mode');
        $('input[name="fileselection[]"]').prop('checked', false);
        $(".expand-search-input").removeAttr("socketid");
        $(".expand-search-input").val('');
        getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
            digibiz.cloudAssets = assetsDetails.Data.assets;
            showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
                removeLoader();
                $('.filemanger_container_toggle').trigger('click');
                $('.file-manager-footer').removeClass('hide');
                $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
            })
        }).catch((err) => {
            Materialize.toast("No assets found", 3000, 'rounded error-alert');
            showFilemanagerAssetsFilesList(null, function () {
                removeLoader();
            })
        });
    });

    //customer identity picture camera upload
    $(document).on('click', '#customer-identity-picture-camera-upload-type-btn', function () {
        addLoader();
        $('#customer-identity-picture-upload').val("");
        $('#customer-identity-picture-type-action-sheet').remove();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }                    
                    $('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                    removeLoader();
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    window.cameraMediaFile = path;

                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }

                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "customer-identity-picture-modal",
                        modal_header: "",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "customer-identity-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                                //revoke stream(stop device)
                                                if (window.camerastream) {
                                                    window.camerastream.getTracks()[0].stop();
                                                }
                                            };
                                            $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 0,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500)
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                removeLoader();
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
            removeLoader();
        }
    });
    // $(document).on('click', '#customer-identity-picture-camera-upload-type-btn', function () {
    //     addLoader();
    //     $('#customer-identity-picture-upload').val("");
    //     $('#customer-identity-picture-type-action-sheet').remove();

    //     fetch.getHtml(function (fetcherror, html) {
    //         var modal_data = {
    //             modal_id: "camera-modal",
    //             modal_header: "Camera",
    //             modal_platform: crossplat.device.platform,
    //             modal_body: html,
    //             // modal_action_buttons: [{
    //             //     "name": "Add",
    //             //     "id": "add-selected-employees-group",
    //             // }]
    //         }
    //         showModal(modal_data, function () {
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                 // if ($('.modal-popup-content').length > 0) {
    //                 //     //console.log("scroll initiated for modal pop-up class")
    //                 //     appScroll.scrollBar('.modal-popup-content');
    //                 // }
    //             } else {
    //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //             }
    //             $('#modal-close-btn').addClass('hide');
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 const vgaConstraints = { video: true };
    //                 navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //                     //global stream
    //                     window.camerastream = stream;
    //                     //remove Hide class from upload preview
    //                     //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     // $("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     // $(".file-manager-footer").addClass('hide');
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
    //                     //show preview
    //                     var videoElement = document.querySelector('#capture-video');
    //                     // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
    //                     //console.log("videoElement", videoElement);
    //                     videoElement.srcObject = stream;
    //                     videoElement.play();
    //                 });
    //             } else {
    //                 //andriod
    //                 // capture callback
    //                 var captureSuccess = function (mediaFiles) {
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('disabled');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('.upload-preview-footer').removeClass('hide');
    //                     //show preview
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".file-manager-footer").addClass('hide');
    //                     //remove Hide class from upload preview
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-attatched-new-file").addClass('hide');
    //                     //change send button attribute
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //                     var i, path, viewPath, len;
    //                     for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //                         path = mediaFiles[i].localURL;
    //                         // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
    //                         viewPath = mediaFiles[i].fullPath;
    //                         window.cameraMediaFile = path;
    //                         //append captured photo

    //                         var img = new Image;
    //                         //console.log("img", img);
    //                         //console.log("path", path);
    //                         img.src = viewPath;
    //                         //console.log("img11", img);
    //                         img.classList.add('preview-file');
    //                         var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //                         //console.log("getElement", getElement);
    //                         // document.querySelector('#upload-file-preview').appendChild(img);
    //                         $(getElement).append(img);
    //                         //revoke stream(stop device)
    //                         if (window.camerastream) {
    //                             window.camerastream.getTracks()[0].stop();
    //                         }

    //                         // var image = $('#image_cropper')[0];
    //                         // image.src = path;
    //                         // $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         // digibiz.cropper = new Cropper(image, {
    //                         //     viewMode: 0,
    //                         //     aspectRatio: 1 / 1,
    //                         //     minContainerWidth: 72,
    //                         //     minContainerHeight: 72,
    //                         //     minCropBoxWidth: 72,
    //                         //     minCropBoxHeight: 72,
    //                         //     maxWidth: 100,
    //                         //     maxHeight: 400,
    //                         //     zoomable: true,
    //                         //     rotatable: true,
    //                         //     responsive: true,
    //                         //     movable: true,
    //                         //     ready: function () {
    //                         //     }
    //                         // });
    //                     };
    //                 };
    //                 // capture error callback
    //                 var captureError = function (error) {
    //                     navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //                 };
    //                 // start image capture            
    //                 navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //             }
    //             removeLoader();
    //         });
    //     }, 'page/common/camera', '#camera-template', null);
    //     // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //     //     const vgaConstraints = { video: true };
    //     //     navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //     //         //global stream
    //     //         window.camerastream = stream;
    //     //         //remove Hide class from upload preview
    //     //         if ($("#upload-preview-wrapper").hasClass('hide')) {
    //     //             $("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //     //         }
    //     //         //Change Title
    //     //         $(".upload-preview-header span").text("Capture Photo");
    //     //         $("#file-manager-container").addClass('hide');
    //     //         $(".upload-preview-container").removeClass('hide');
    //     //         $(".file-manager-footer").addClass('hide');
    //     //         //hide send button, caption & add button
    //     //         $(".upload-preview-container-file-caption").addClass('hide');
    //     //         $(".upload-preview-footer").addClass('hide');
    //     //         $("#upload-permission-btn").addClass('hide');
    //     //         $('#upload-preview-container-text-box').text("");
    //     //         $("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue"><i class="material-icons">photo_camera</i></button>`);
    //     //         //show preview
    //     //         var videoElement = document.querySelector('#capture-video');
    //     //         videoElement.srcObject = stream;
    //     //         videoElement.play();
    //     //     });
    //     // } else {
    //     //     //andriod
    //     //     // capture callback
    //     //     var captureSuccess = function (mediaFiles) {
    //     //         $('#upload-footer-send-btn').removeClass('disabled');
    //     //         $('#upload-footer-send-btn').removeClass('hide');
    //     //         $('.upload-preview-footer').removeClass('hide');
    //     //         //show preview
    //     //         $("#file-manager-container").addClass('hide');
    //     //         $(".upload-preview-container").removeClass('hide');
    //     //         $(".file-manager-footer").addClass('hide');
    //     //         //remove Hide class from upload preview
    //     //         if ($("#upload-preview-wrapper").hasClass('hide')) {
    //     //             $("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //     //             $('div[data-filemanager="filemanager"]').addClass('hide');
    //     //         }
    //     //         //Change Title
    //     //         $(".upload-preview-header span").text("Capture Photo");
    //     //         //hide send button, caption & add button
    //     //         $("#upload-file-preview").empty();
    //     //         $(".upload-preview-container-file-caption").removeClass('hide');
    //     //         $('#upload-preview-container-text-box').text("");
    //     //         $("#upload-footer-attatched-new-file").addClass('hide');
    //     //         //change send button attribute
    //     //         $("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //     //         var i, path, len;
    //     //         for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //     //             path = mediaFiles[i].localURL;
    //     //             window.cameraMediaFile = path;
    //     //             //append captured photo

    //     //             var image = $('#image_cropper')[0];
    //     //             image.src = path;
    //     //             $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //     //             digibiz.cropper = new Cropper(image, {
    //     //                 viewMode: 0,
    //     //                 aspectRatio: 1 / 1,
    //     //                 minContainerWidth: 72,
    //     //                 minContainerHeight: 72,
    //     //                 minCropBoxWidth: 72,
    //     //                 minCropBoxHeight: 72,
    //     //                 maxWidth: 100,
    //     //                 maxHeight: 400,
    //     //                 zoomable: true,
    //     //                 rotatable: true,
    //     //                 responsive: true,
    //     //                 movable: true,
    //     //                 ready: function () {
    //     //                 }
    //     //             });
    //     //         };
    //     //     };
    //     //     // capture error callback
    //     //     var captureError = function (error) {
    //     //         navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //     //     };
    //     //     // start image capture            
    //     //     navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //     // }
    //     removeLoader();
    // });

    //customer identity picture preview
    $(document).on('click', '.customer_identity_pic_preview', function () {
        var getId = $(this).attr('data-thumbnail-id');
        addLoader();
        var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${getId}`;
        // getImageUrl(avtarUrl).then((res) => {
        // }).catch((err) => {
        //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
        //         var data = {
        //             file_error: err
        //         }
        //         fetch.getHtml(function (fetcherror, html) {
        //             //console.log("got html")
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "identity-picture-preview-modal",
        //                 modal_header: "",
        //                 modal_body: html
        //             }
        //             showModal(modal_data, function () {
        //                 //console.log("modal added");
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 removeLoader();
        //             });

        //         }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        //     } else {
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-picture-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                removeLoader();
            });

        }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        //     }
        // })

    });

    //add associate customer button click
    $(document).on('click', '#customer_associate_customer_assignment_btn', function () {
        addLoader();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "add-associate-customer",
                    modal_header: "Add Associate Customer",
                    modal_body: html,
                    modal_action_buttons: [{
                        name: "Confirm",
                        attr: [{ name: "id", value: "notify-associate-customer-btn" }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    mobileFlaginit();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                });
            }, 'page/customer/associate_customer_notify_modal', '#add-associate-customer-notify-template', null);
        } else {//android/ios
            var action_sheet_parms = {
                action_id: "associate_customer_creation_by_selection_modal",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "By Notification",
                    attr: [{ name: "id", value: "associate_customer_by_notification" }]
                },
                {
                    name: "By QR-code",
                    attr: [{ name: "id", value: "associate_customer_by_qr_code" }]
                }
                ]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            });
        }
    });

    //associate customer by notification
    $(document).on('click', '#associate_customer_by_notification', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "add-associate-customer",
                modal_header: "Add Associate Customer",
                modal_body: html,
                modal_action_buttons: [{
                    name: "Notify",
                    attr: [{ name: "id", value: "notify-associate-customer-btn" }]
                }]
            }
            showModal(modal_data, function () {
                $('#associate_customer_creation_by_selection_modal').remove();
                removeLoader();
                mobileFlaginit();
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
            });
        }, 'page/customer/associate_customer_notify_modal', '#add-associate-customer-notify-template', null);
    });

    //associate customer by QR code
    $(document).on('click', '#associate_customer_by_qr_code', function () {
        addLoader();
        $('#associate_customer_creation_by_selection_modal').remove();
        location.hash = '#associate_customer/scan_qr';
    });

    //notify associate customer
    $(document).on('click', '#notify-associate-customer-btn', function (e) {
        addLoader();
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        if ($('#add-associate-customer-mobile-number').val().length > 0) {
            var mobile_number = $('#add-associate-customer-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
            var reqParams = {
                device_id: crossplat.device.uuid,
                data: {
                    "jeevi": ["name", "id", "profile_display", "user_name"]
                }
            }
            if ($('#add-associate-customer-mobile-number').intlTelInput("isValidNumber")) {
                reqParams.type = "mobile_number";
                reqParams.value = mobile_number;
                getRolesForContactNumberAssociateCustomer(reqParams, function () {
                    // $('#add-jeevi-member').removeClass('disabled');
                });
            } else {
                removeLoader();
                Materialize.toast(`Please enter valid number`, 3000, 'round success-alert');
            }
        } else {
            removeLoader();
            Materialize.toast(`Please enter data`, 3000, 'round success-alert');
        }
    });
    // $(document).on('click', '#notify-associate-customer-btn', function () {
    //     addLoader();
    //     var data_type;
    //     if ($('#associate_customer_unique_name_field').val().length > 0) {
    //         var unique_name = $('#associate_customer_unique_name_field').val();
    //         data_type = "unique_name";
    //     } else if ($('#add-associate-customer-mobile-number').val().length > 0) {
    //         var mobileNumber = $('#add-associate-customer-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
    //         data_type = "mobile_number";
    //     }
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         data_type: data_type,
    //         add_type: "add",
    //         type: "associate_customer",
    //         business_id: sessionStorage.getItem('business_id'),
    //         customer_id: sessionStorage.getItem('customer_id'),
    //         unique_name: unique_name,
    //         mobile_number: mobileNumber
    //     }
    //     notificationAdd(reqParam)
    //         .then((response) => {
    //             //console.log("notificationAdd response", response);
    //             var value;
    //             if (data_type == "unique_name") {
    //                 value = unique_name;
    //             } else if (data_type == "mobile_number") {
    //                 value = mobileNumber;
    //             }
    //             var jeeviParam = {
    //                 device_id: crossplat.device.uuid,
    //                 type: data_type,
    //                 value: value,
    //                 data: {
    //                     jeevi: ["name", "id", "profile_display", "user_name"]
    //                 }
    //             }
    //             getJeeviContactDetail(jeeviParam)
    //                 .then((result) => {
    //                     //console.log("result", result.Data);
    //                     var template = `<div class="customer-associate-customer-assignment-box pending-associate-customer-wrapper" data-notification-id="${response.id}" data-customer-id="${response.customer_id}" data-contact-uuid="${response.contact.uuid}" data-account-id="${response.contact.user_id}">
    //                             <div class="customer-associate-customer-assignment-wrapper">
    //                             <div class="customer-associate-customer-assignment-name-container">                      
    //                             <div class="customer-associate-customer-assignment-name-wrapper">                      
    //                                 <div class="customer-associate-customer-assignment-name">${result.Data.jeevi.name.first} ${result.Data.jeevi.name.last}</div> 
    //                                 <div class="customer-associate-customer-status">Status: ${response.contact.status.status}</div>                     
    //                                 </div>                      
    //                             </div>             
    //                             </div>              
    //                         </div>`;
    //                     //console.log("template", template);
    //                     //check if already this persons row is present if present remove that and add new
    //                     $(`.customer-associate-customer-assignment-box[data-account-id="${response.contact.user_id}"]`).remove();
    //                     $('.customer-associate-customer-assignment-list-main-container').append(template);
    //                     $('#add-associate-customer').remove();
    //                     Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
    //                     removeLoader();
    //                 })
    //                 .catch((err) => {
    //                     removeLoader();
    //                     //console.log("error in getting user detisl");
    //                 });
    //         })
    //         .catch((err) => {
    //             //console.log("notificationAdd error", err);
    //             Materialize.toast(err.msg, 3000, 'round success-alert');
    //             removeLoader();
    //         });
    // })

    //on click of pending associate customer
    $(document).on('click', '.pending-associate-customer-wrapper', function () {
        addLoader();
        digibiz.associate_customer_notification_details_list = [];
        var getAccountID = $(this).attr('data-account-id');
        var getContactUuid = $(this).attr('data-contact-uuid');
        //console.log("getAccountID", getAccountID);
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "pending_associate_customer_logs",
            business_id: sessionStorage.getItem('business_id'),
            customer_id: sessionStorage.getItem('customer_id'),
            contact_user_id: getAccountID
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                var getData = response;
                //console.log("getData", getData);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "associate-customers-pending-notification-details-modal",
                    modal_header: "Notification Details",
                    modal_body: `<div id="associate-customer-notification-details-container">
        <span class="searchbtn waves-effect cursor-pointer" id="associate-customer-notification-details-list-search-btn"><i class="material-icons">search</i></span>
        <div class="expand-search-wrap" id="associate_customer_notification_details_list_expand_search_wrap">
            <input class="expand-search-input" id="associate_customer_notification_details_list_expand_search_input" type="search" placeholder="Search" autocomplete="off"/>
            <span class="searchclosebtn" id="associate_customer_notification_details_list_searchclosebtn"><i class="material-icons associate-customer-notification-details-list-close-btn hide">close</i></span>
        </div>
        <div id="associate-customer-notification-details-list"></div>
    </div>`
                }
                showModal(modal_data, function () {
                    // if ($(".modal-popup-content").length > 0) {
                    //     appScroll.scrollBar(".modal-popup-content");
                    // }
                    $('#associate-customers-pending-notification-details-modal').attr('contact-uuid', getContactUuid)
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processPendingAssociateCustomerNotificationDetailsList(getData, function () {
                        removeLoader();
                        // setTimeout(function () {
                        //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                        // }, 0);
                    });
                });
            })
            .catch((err) => {
                //console.log("error in getting pending associate customer notification details list/logs");
                removeLoader();
            })
    })


    //on click of register customer button
    // $(document).on('click', '.register-customer-btn', function () {
    //     addLoader();
    //     var requestParams = {
    //         device_id: crossplat.device.uuid,
    //         id: sessionStorage.getItem('customer_id'),
    //         data: {
    //             status: "active",
    //             socket_enable_status: "true",
    //         }
    //     }
    //     customerUpdate(requestParams)
    //         .then((response) => {
    //             sessionStorage.removeItem('customer_id');
    //             removeLoader();
    //             Materialize.toast("SuccessFully Registered", 3000, 'round success-alert');
    //             var getActiveTab = sessionStorage.getItem('selected-customer-tab');
    //             if (getActiveTab == "customer_active") {
    //                 location.hash = `customer_creation/active/list`;
    //             } else if (getActiveTab == "customer_pending") {
    //                 location.hash = `customer_creation/pending/list`;
    //             }
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("err in registering", err);
    //         });
    // });

    $(document).on('click', '#delete-associate-customer-notification', function () {
        addLoader();
        var getNotificationId = $(this).parents('.associate-customer-notification-details-wrapper').attr('data-notification-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationId
        }
        notificationDelete(reqParam)
            .then((response) => {
                //console.log("notificationDelete success", response);
                removeLoader();
                $(this).parents('.associate-customer-notification-details-list-contentbox').remove();
                if ($('.associate-customer-notification-details-wrapper').length == 0) {
                    $('.associate-customer-notification-details-list').append(`<div class="no_data">No data found</div>`);
                }
                if ($(`.pending-associate-customer-wrapper[data-notification-id="${getNotificationId}"]`).length > 0) {
                    $(`.pending-associate-customer-wrapper[data-notification-id="${getNotificationId}"]`).remove();
                }
                Materialize.toast(`Successfully deleted the notification.`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                //console.log("notificationDelete err", err);
                Materialize.toast(`Error in deleting the notification.`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#show_action_customer_associate-customer_assignment', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var getAssociateCustomerId = $(this).parents('.customer-associate-customer-assignment-box').attr('data-id');
        var getAssociateCustomerStatus = $(this).parents('.customer-associate-customer-assignment-box').attr('data-status');
        if (getAssociateCustomerStatus == "active") {
            var action_sheet_parms = {
                action_id: "associate_customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Edit",
                    attr: [{ name: "class", value: "associate_customer_edit" }]
                },
                {
                    name: "Inactivate",
                    attr: [{ name: "class", value: "associate_customer_inactivate" }]
                },
                {
                    name: "Delete",
                    attr: [{ name: "class", value: "associate_customer_delete" }]
                },
                {
                    name: "Show Access",
                    attr: [{ name: "class", value: "associate_customer_show_access_list" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('associate_customer_id', getAssociateCustomerId);
            });
        } else if (getAssociateCustomerStatus == "accepted") {
            var action_sheet_parms = {
                action_id: "associate_customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Complete Profile",
                    attr: [{ name: "class", value: "associate_customer_edit" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('associate_customer_id', getAssociateCustomerId);
            });
        } else if (getAssociateCustomerStatus == "inactive") {
            var action_sheet_parms = {
                action_id: "associate_customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Edit",
                    attr: [{ name: "class", value: "associate_customer_edit" }]
                },
                {
                    name: "Activate",
                    attr: [{ name: "class", value: "associate_customer_activate" }]
                },
                {
                    name: "Delete",
                    attr: [{ name: "class", value: "associate_customer_delete" }]
                },
                {
                    name: "Show Access",
                    attr: [{ name: "class", value: "associate_customer_show_access_list" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('associate_customer_id', getAssociateCustomerId);
            });
        } else if (getAssociateCustomerStatus == "exited") {
            var action_sheet_parms = {
                action_id: "associate_customer_alert_actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Delete",
                        attr: [{ name: "class", value: "associate_customer_delete" }]
                    }
                ]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('associate_customer_id', getAssociateCustomerId);
            });
        }

    });

    //edit associate customer
    $(document).on('click', '.associate_customer_edit', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getAssociateCustomerId = $('#associate_customer_alert_actions').attr('associate_customer_id');
        $('#associate_customer_alert_actions').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "associate_customer_only"
        }
        //get the associate customer identifiers list(for the sake of dropdown)
        customerIdentifierList(reqParam)
            .then((response) => {
                var requestParms = {
                    device_id: crossplat.device.uuid,
                    get_by: "id",
                    id: getAssociateCustomerId
                }
                //get the associate customer data
                associateCustomerGet(requestParms)
                    .then((result) => {
                        if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                            if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${result.id}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                                result.identity_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (result.hasOwnProperty('identity_video') && result.identity_video) {
                            if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${result.id}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                                result.identity_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        var associateCustomerData = {
                            associateCustomerData: result,
                            associateCustomerIdentifierList: response,
                        }
                        //console.log("associateCustomerData", associateCustomerData);
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "edit-associate-customer-modal",
                                modal_header: "Edit Associate Customer",
                                modal_body: html,
                                modal_action_buttons: [{
                                    name: "Save",
                                    attr: [{ name: "id", value: "save-associate-customer-btn" }]
                                }]
                            }
                            showModal(modal_data, function () {
                                removeLoader();
                                mobileFlaginit();
                                calenderInit('#associate_customer_date_of_birth');
                                calenderInit('#associate_customer_wedding_anniversary');
                                //update associate customer identifier dropdown                                
                                if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                    var getIdentifier = response.find((e) => e.id == result.identifier_id);
                                    $('#associate-customer-identifier-choose-select-dropdown').val(getIdentifier.identifier);
                                }
                                $('#edit-associate-customer-modal').attr('data-associate-customer-id', getAssociateCustomerId);
                                $('#edit-associate-customer-modal').attr('data-associate-customer-name', `${result.name.first} ${result.name.last}`);
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/customer/edit_associate_customer', '#edit-associate-customer-template', associateCustomerData);
                    })
                    .catch((err) => {
                        var associateCustomerData = {
                            associateCustomerIdentifierList: response,
                        }
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "edit-associate-customer-modal",
                                modal_header: "Edit Associate Customer",
                                modal_body: html,
                                modal_action_buttons: [{
                                    name: "Save",
                                    attr: [{ name: "id", value: "save-associate-customer-btn" }]
                                }]
                            }
                            showModal(modal_data, function () {
                                removeLoader();
                                mobileFlaginit();
                                calenderInit('#associate_customer_date_of_birth');
                                calenderInit('#associate_customer_wedding_anniversary');
                                $('#edit-associate-customer-modal').attr('data-associate-customer-id', getAssociateCustomerId);
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/customer/edit_associate_customer', '#edit-associate-customer-template', associateCustomerData);
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No associate customer identifiers found.`, 3000, "round error-alert");
                //console.log("Error in getting associate customer identifiers");
            })
    });

    //save the associate customer details
    $(document).on('click', '#save-associate-customer-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getAssociateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
        if (validateAssociateCustomer()) {
            var getEmail = $('#associate_customer_email').text().trim();
            var getAlternateEmail = $('#associate_customer_alternate_email').text().trim();
            var getDisplayName = $('#associate_customer_display_name').text().trim();
            var getDateOfBirth = $('#associate_customer_date_of_birth').val().trim();
            var weddingAnniversary = $('#associate_customer_wedding_anniversary').val().trim();
            if ($('#add-associate-customer-display-phone-number').val().length > 0) {
                var getDisplayphoneNumber = $('#add-associate-customer-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
            } else {
                var getDisplayphoneNumber;
            }
            // var getAssociateCustomerIdentifier = $('#associate-customer-identifier-choose-select-dropdown').val();
            // var getAssociateCustomerIdentifierId = $('#associate-customer-identifier-choose-select-dropdown').find(`option[value="${getAssociateCustomerIdentifier}"]`).attr('data-id');
            var getAssociateCustomerIdentifier = $('.selected-value-associate-customer-identifier').attr('data-value');
            var getAssociateCustomerIdentifierId = $('.selected-value-associate-customer-identifier').attr('data-id');

            // //save identity-pic
            // saveIdentityPicture(function (err, identityResponse) {
            //     if (err) {
            //         removeLoader();
            //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
            //     } else {
            // var resultData = identityResponse;
            // //console.log("resultData", resultData);
            // var associateCustomerIdentityPictureData = {};
            // if (resultData != undefined) {
            //     associateCustomerIdentityPictureData = {
            //         asset_id: resultData.Data.asset_id,
            //         storage_id: resultData.Data.filename
            //     }
            // }
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: getAssociateCustomerId,
                data: {
                    identifier_id: getAssociateCustomerIdentifierId,
                    email: getEmail,
                    alternate_email: getAlternateEmail,
                    display_name: firstLetterUpperCase(getDisplayName),
                    display_phone_number: getDisplayphoneNumber,
                    // identity_picture: associateCustomerIdentityPictureData,
                    status: "active",
                    date_of_birth: getDateOfBirth,
                    wedding_anniversary: weddingAnniversary,
                }
            }
            associateCustomerUpdate(requestParams)
                .then((response) => {
                    //console.log("response", response);
                    removeLoader();
                    $('#edit-associate-customer-modal').remove();
                    $(`.customer-associate-customer-assignment-box[data-id="${response.id}"]`).attr('data-status', 'active');
                    $(`.customer-associate-customer-assignment-box[data-id="${response.id}"]`).find('.customer-associate-customer-status').text(`Status: active`);
                })
                .catch((err) => {
                    if (err.msg == "no updated data found") {
                        removeLoader();
                        $('#edit-associate-customer-modal').remove();
                    }
                    //console.log("error in customerUpdate");
                })
            //     }
            // })
        } else {
            removeLoader();
        }
    });

    //delete associate customer(from action sheet)
    $(document).on('click', '.associate_customer_delete', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getAssociateCustomerId = $(this).parents('#associate_customer_alert_actions').attr('associate_customer_id');
        $('#associate_customer_alert_actions').remove();
        fetch.getHtml(function (fetcherror, html) {
            var alert_parms = {
                alert_id: "alert-delete-associate-customer-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Delete Associate Customer`,
                alert_body: html,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-associate-customer-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-associate-customer-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-delete-associate-customer-confirm-cancel').attr('data-associate-customer-id', getAssociateCustomerId); //set getAssociateCustomerId
            });

        }, 'layouts/alert_templates/delete_associate_customer', '#delete-associate-customer-template', null);
    });

    //DELETE NO
    $(document).on('click', '#btn-delete-associate-customer-cancel-no', function () {
        $('#alert-delete-associate-customer-confirm-cancel').remove();
    });

    //DELETE YES
    $(document).on('click', '#btn-delete-associate-customer-confirm-yes', function () {
        addLoader();
        var getAssociateCustomerId = $('#alert-delete-associate-customer-confirm-cancel').attr('data-associate-customer-id');
        var getDeleteFolderValue = $('.delete-associate-customer-folder-delete-yes-radio-button').is(':checked');
        $('#alert-delete-associate-customer-confirm-cancel').remove();
        var reqParams = {
            device_id: crossplat.device.uuid,
            id: getAssociateCustomerId,
            folder_delete: getDeleteFolderValue,
            status: "deleted"
        }
        associateCustomerDelete(reqParams)
            .then((response) => {
                Materialize.toast(`Successfully deleted`, 3000, "round error-alert");
                $(`.customer-associate-customer-assignment-box[data-id="${getAssociateCustomerId}"]`).remove();
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in deleting the associate customer");
            })
    });

    //associate customer identity picture upload
    $(document).on('click', '#associate-customer-identity-picture-load-btn', function () {
        digibiz.isAssociateCustomerIdentityPictureSelected = false;
        addLoader();
        var action_parms = {
            action_id: "associate-customer-identity-picture-type-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device",
                    attr: [{ name: "id", value: "associate-customer-identity-picture-device-upload-type-btn" }]
                },
                {
                    name: "Cloud",
                    // attr: [{ name: "id", value: "associate-customer-identity-picture-cloud-upload-type-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera",
                    attr: [{ name: "id", value: "associate-customer-identity-picture-camera-upload-type-btn" }]
                }
            ]
        };
        showAction(action_parms, function () {
            $('.associate-customer-add-identity-picture-container').find('.error_note').remove();
            removeLoader();
        });
    });

    //associate customer identity picture device upload click
    $(document).on('click', '#associate-customer-identity-picture-device-upload-type-btn', function () {
        addLoader();
        $('#associate-customer-identity-picture-upload').val("");
        $('#associate-customer-identity-picture-upload').trigger('click');
        $('#associate-customer-identity-picture-type-action-sheet').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "associate-customer-identity-picture-modal",
            modal_header: "",
            modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "associate-customer-identity-crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: ''
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                // if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                //     //console.log("scroll initiated for modal pop-up class")
                //     appScroll.scrollBar('.modal-popup-content');
                // }
            }
            $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
        });
    });

    //device upload select picture
    $(document).on("change", `#associate-customer-identity-picture-upload`, function () {
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            if (!(config.identityPictureFileFormat.includes(fileType.toLowerCase()))) {
                //console.log("!!", $('.associate-customer-add-identity-picture-container').find('.error_note'))
                if ($('.associate-customer-add-identity-picture-container').find('.error_note').length == 0) {
                    //console.log("123")
                    $('#associate-customer-identity-picture-upload').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                }
                $('#associate-customer-identity-picture-upload').val('');
                // $('#associate-customer-identity-picture-upload').attr("src", "");//empty
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                if ($('.associate-customer-add-identity-picture-container').find('.error_note').length == 0) {
                    $('#associate-customer-identity-picture-upload').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                }
                $('#associate-customer-identity-picture-upload').val('');
                // $('#associate-customer-identity-picture-upload').attr("src", "");//empty
            }
            else {
                if (files[0])
                    var photo = files[0];
                var reader = new FileReader();
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //customer identity picture crop button click
    $(document).on('click', '#associate-customer-identity-crop-button', function () {
        addLoader();
        var getAssociateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                saveAssociateCustomerIdentityPicture(reader.result, blob, function (err, IdentityPicture) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        // var resultData = IdentityPicture;
                        // //console.log("resultData", resultData);
                        // var customerIdentityPictureData = {};
                        // if (resultData != undefined) {
                        //     customerIdentityPictureData = {
                        //         asset_id: resultData.Data.asset_id,
                        //         storage_id: resultData.Data.filename
                        //     }
                        // }
                        // var requestParams = {
                        //     device_id: crossplat.device.uuid,
                        //     id: getAssociateCustomerId,
                        //     data: {
                        //         identity_picture: customerIdentityPictureData
                        //     }
                        // }
                        // associateCustomerUpdate(requestParams)
                        //     .then((response) => {
                        //         //console.log("response", response);
                        $('#associate_customer_identity_picture').attr("src", reader.result);
                        //remove +
                        $('.associate-customer-identity-picture-multimedia-load-btn').remove();
                        //remove delete
                        $('#associate_customer-identity-picture-delete').parent('.cursor_pointer').remove();
                        $('.associate-customer-add-identity-picture-container').find('.mask').removeClass('hide');
                        //append photo_camera first and then delete
                        $('#associate_customer_identity_picture').siblings('.mask').append(`<a class="info associate-customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="associate-customer-identity-picture-load-btn" data-thumbnail-id="${IdentityPicture}">photo_camera</i></a>`);
                        $('#associate_customer_identity_picture').siblings('.mask').append(`<a class="info associate-customer-identity-picture-delete-btn cursor_pointer"><i class="material-icons" id="associate_customer-identity-picture-delete" data-thumbnail-id="${IdentityPicture}">delete</i></a>`);
                        // $('#modal-close-btn').trigger('click');
                        $('#associate-customer-identity-picture-modal').remove();
                        removeLoader();
                        digibiz.cropper.destroy();
                        // })
                        // .catch((err) => {
                        //     removeLoader();
                        //     Materialize.toast(`Error in uploading identity picture.`, 3000, 'round error-alert');
                        // })
                    }
                });
            }
            reader.readAsDataURL(blob);
        })
    });

    //Delete associste customer identity picture
    $(document).on('click', '#associate_customer-identity-picture-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        e.stopPropagation();
        var alert_parms = {
            alert_id: "alert-delete-associate-customer-identity-pic-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Identity picture",
            alert_body: `Do you want to delete the associate customer identity picture?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-associate-customer-identity-pic-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-associate-customer-identity-pic-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-associate-customer-identity-pic-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
        });
    })
    //delete NO clicked
    $(document).on('click', '#btn-delete-associate-customer-identity-pic-confirm-no', function () {
        $('#alert-delete-associate-customer-identity-pic-confirm-cancel').remove();
    });
    //delete YES clicked
    $(document).on('click', '#btn-delete-associate-customer-identity-pic-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-associate-customer-identity-pic-confirm-cancel').attr('delete-thumbnail-id');
        $('#alert-delete-associate-customer-identity-pic-confirm-cancel').remove();
        //api call to delete customer identity picture from dj cloud bucket
        var associateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            identity_picture_id: thumbnailId,
            associate_customer_id: associateCustomerId,
        }
        addLoader();
        associateCustomerDeleteIdentityPicture(requesParam)
            .then((response) => {
                removeLoader();
                $('#associate-customer-identity-picture-upload').val('');
                $('#associate_customer_identity_picture').attr("src", "");//empty
                $('#associate_customer-identity-picture-delete').remove();//remove delete button
                $('#associate-customer-identity-picture-load-btn').attr('data-thumbnail-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });


    //customer identity picture cloud upload
    $(document).on('click', '#associate-customer-identity-picture-cloud-upload-type-btn', function () {
        addLoader();
        $('#associate-customer-identity-picture-upload').val("");
        $('#associate-customer-identity-picture-type-action-sheet').remove();

        $('.grid-view-container').removeClass('edit-mode');
        $('input[name="fileselection[]"]').prop('checked', false);
        $(".expand-search-input").removeAttr("socketid");
        $(".expand-search-input").val('');
        getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
            digibiz.cloudAssets = assetsDetails.Data.assets;
            showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
                removeLoader();
                $('.filemanger_container_toggle').trigger('click');
                $('.file-manager-footer').removeClass('hide');
                $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
            })
        }).catch((err) => {
            Materialize.toast("No assets found", 3000, 'rounded error-alert');
            showFilemanagerAssetsFilesList(null, function () {
                removeLoader();
            })
        });
    });

    //customer identity picture camera upload
    $(document).on('click', '#associate-customer-identity-picture-camera-upload-type-btn', function () {
        addLoader();
        $('#associate-customer-identity-picture-upload').val("");
        $('#associate-customer-identity-picture-type-action-sheet').remove();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');

                    $('#camera-modal').find('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                    removeLoader();
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    window.cameraMediaFile = path;

                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }

                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "associate-customer-identity-picture-modal",
                        modal_header: "",
                        modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "associate-customer-identity-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                                //revoke stream(stop device)
                                                if (window.camerastream) {
                                                    window.camerastream.getTracks()[0].stop();
                                                }
                                            };
                                            $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500);
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                removeLoader();
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
            removeLoader();
        }
    });

    //customer identity picture preview
    $(document).on('click', '.associate_customer_identity_pic_preview', function () {
        var getId = $(this).attr('data-thumbnail-id');
        var getAssociateCustomerId = $(this).parents('#edit-associate-customer-modal').attr('data-associate-customer-id');
        addLoader();
        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${getAssociateCustomerId}&device_id=${crossplat.device.uuid}&image_id=${getId}`;
        // getImageUrl(avtarUrl).then((res) => {
        // }).catch((err) => {
        //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
        //         fetch.getHtml(function (fetcherror, html) {
        //             //console.log("got html")
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "identity-picture-preview-modal",
        //                 modal_header: "",
        //                 modal_body: html
        //             }
        //             showModal(modal_data, function () {
        //                 //console.log("modal added");
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 removeLoader();
        //             });

        //         }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        //     } else {
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-picture-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                removeLoader();
            });

        }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        // }
        // })
    });

    //customer groups button click
    $(document).on('click', '.customer-groups', function () {
        addLoader();
        // sessionStorage.setItem('customer_module', 'customer_groups_list');
        location.hash = `customer/groups/identifiers/list`;
    });

    //customer contact button click
    $(document).on('click', '.customer-contact-list', function () {
        addLoader();
        // sessionStorage.setItem('customer_module', 'customer_contact_list');
        location.hash = `customer/contacts/identifiers/list`;
    });

    //on click of identifier wrapper in the contact identifiers list page
    $(document).on('click', '.customer-contacts-identifier-wrapper', function () {
        addLoader();
        var getIdentifierId = $(this).attr('data-id');
        sessionStorage.setItem('identifier_id', getIdentifierId);
        location.hash = `customer/contacts_items/list`;
    });

    //on click of custom customers group tab
    $(document).on('click', '.custom-customer-group-identifier-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-customer-group-type-tab', 'custom');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-customer-group-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-customer-group-type-tab')}"]`).addClass('active');
        digibiz.custom_groups_list = [];
        customCustomerGroupsListPage();
    });

    //on click of standard customers group tab
    $(document).on('click', '.standard-customer-group-identifier-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-customer-group-type-tab', 'standard');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-customer-group-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-customer-group-type-tab')}"]`).addClass('active');
        standardCustomerGroupsIdentifierListPage();
    });


    //on click of standard groups identifier wrapper
    $(document).on('click', '.customer-groups-identifier-wrapper', function () {
        addLoader();
        var getIdentifierId = $(this).attr('data-id');
        sessionStorage.setItem('identifier_id', getIdentifierId);
        location.hash = `customer/groups/list`;
    });

    //on click of basic group(i.e., all PC/ All PC+AC)
    $(document).on('click', '.view-customer-group', function () {
        addLoader();
        // var getGroupId = $(this).attr('data-id');
        // sessionStorage.setItem('group_id', getGroupId);
        // location.hash = `customer/group_details`;
        var getGroupId = $(this).parents('.customer-group-wrapper').attr('data-id');
        var getGroupType = $(this).parents('.customer-group-wrapper').attr('data-type');
        var socket_enable_status = $(this).parents('.customer-group-wrapper').attr('data-socket_enable_status');
        var getGroupCreatedStatus = $(this).parents('.customer-group-wrapper').attr('data-created_status');
        if (getGroupCreatedStatus && getGroupCreatedStatus == "progress") {
            removeLoader();
            Materialize.toast(`Group creation/updation in progress, please wait......might take few moments`, 3000, 'round error-alert');
        } else {
            if (getGroupType == "custom") {
                var getCustomGroupFrom = $(this).parents('.customer-group-wrapper').attr('data-group-from');
                sessionStorage.setItem('group_from', getCustomGroupFrom);
            }
            if (socket_enable_status == "true") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: getGroupId,
                    data: {
                        socket_enable_status: "false",
                        update_for: "socket_enable_status"
                    }
                }
                //console.log("reqParam", reqParam);
                employeeGroupUpdate(reqParam)
                    .then((response) => {
                        sessionStorage.removeItem('group_id');
                        sessionStorage.setItem('group_type', getGroupType);
                        sessionStorage.setItem('group_id', getGroupId);
                        location.hash = `customer/group_details`;
                    }).catch((err) => {
                        console.log('err', err);
                    })


            } else {
                Materialize.toast(`Access Denied! You or other administrator is updating this group at other place.`, 3000, "round error-alert");
                var alert_parms = {
                    alert_id: "alert-group-device-change-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Access Denied! You or other administrator is updating this group at other place. Would to like to cancel there and continue here?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-group-device-change-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-group-device-change-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                    $('#alert-group-device-change-confirm-cancel').attr('data-group-id', getGroupId); //set getEmployeeId
                    $('#alert-group-device-change-confirm-cancel').attr('data-group-type', getGroupType); //set getEmployeeId           
                });
            }
        }

    });

    //on click of any customer items wrapper
    $(document).on('click', '.customer-contacts-item-wrapper', function () {
        addLoader();
        var getItemId = $(this).attr('data-id');
        sessionStorage.setItem('item_id', getItemId);
        location.hash = `customer/contact/list`;
    });

    //customer_group_cancel_button
    $(document).on('click', '#customer_group_cancel_button', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                data: {
                    socket_enable_status: "true",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeGroupUpdate(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('group_id');
                    sessionStorage.removeItem('group_from');
                    sessionStorage.removeItem('group_type');
                    if (sessionStorage.getItem('identifier_id')) {
                        location.hash = `customer/groups/list`;
                    } else {
                        location.hash = `customer/groups/identifiers/list`;
                    }
                }).catch((err) => {
                    console.log('err', err);
                })
        } else {
            sessionStorage.removeItem('group_id');
            sessionStorage.removeItem('group_from');
            sessionStorage.removeItem('group_type');
            if (sessionStorage.getItem('identifier_id')) {
                location.hash = `customer/groups/list`;
            } else {
                location.hash = `customer/groups/identifiers/list`;
            }
        }
        appScroll.scrollBar('#main-container').destroy();
    });

    //save/add customer group
    $(document).on('click', '#customer_group_add_button', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getGroupName = $('#customerGroupName').val();
        var getGroupDescription = $('#customer_group_desc').val();
        // var getGroupVisibility = $('#select-visibility-type').val();
        var getGroupVisibility = $('.selected-value-group-visbility').attr('data-value');
        if (validateCustomerGroup()) {
            if (sessionStorage.getItem('group_id')) {
                // saveGroupPicture(function (err, identityResponse) {
                //     if (err) {
                //         removeLoader();
                //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                //     } else {
                // var resultData = identityResponse;
                // //console.log("resultData", resultData);
                // var groupPictureData = {};
                // if (resultData != undefined) {
                //     groupPictureData = {
                //         asset_id: resultData.Data.asset_id,
                //         storage_id: resultData.Data.filename
                //     }
                // }
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('group_id'),
                    data: {
                        name: firstLetterUpperCase(getGroupName),
                        description: firstLetterUpperCase(getGroupDescription),
                        // group_image: groupPictureData,
                        visibility: getGroupVisibility
                    }
                }
                employeeGroupUpdate(reqparams)
                    .then((response) => {
                        //console.log("employeeGroupUpdate sucess", response);
                        sessionStorage.removeItem('group_from');
                        sessionStorage.removeItem('group_id');
                        if (sessionStorage.getItem('identifier_id')) {
                            location.hash = `customer/groups/list`;
                        } else {
                            location.hash = `customer/groups/identifiers/list`;
                        }
                    })
                    .catch((err) => {
                        //console.log("employeeGroupUpdate err", err);
                        if (err.msg == "no updated data found") {
                            sessionStorage.removeItem('group_from');
                            sessionStorage.removeItem('group_id');
                            if (sessionStorage.getItem('identifier_id')) {
                                location.hash = `customer/groups/list`;
                            } else {
                                location.hash = `customer/groups/identifiers/list`;
                            }
                        } else {
                            removeLoader();
                        }
                    })
                //     }
                // })
            } else {//first time saving/creating(applicable only for custom group)
                //check if the custom group is from contact_list or group list
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    let selectedmembers = [];
                    $.each($("input[name='selectedmembers[]']:checked"), function () {
                        // selectedmembers.push($(this).val());
                        selectedmembers.push({
                            id: $(this).val(),
                            type: $(this).attr('data-type')
                        });
                    });
                    var contactlist = removeDuplicates(selectedmembers, 'id');
                    //console.log("contactlist", contactlist);
                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                group_for: "customer",
                                custom_group_from: sessionStorage.getItem('group_from'),
                                group_type: "custom",
                                visibility: getGroupVisibility,
                                name: firstLetterUpperCase(getGroupName),
                                description: firstLetterUpperCase(getGroupDescription),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size,
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    //console.log("success in group creation", response);
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: response.id,
                                        members: contactlist
                                    }
                                    groupMemberAdd(requestParams)
                                        .then((result) => {
                                            digibiz.groupPictureblob = {};
                                            sessionStorage.removeItem('group_from');
                                            sessionStorage.removeItem('group_id');
                                            sessionStorage.removeItem('group_type');

                                        })
                                        .catch((err) => {
                                            removeLoader();
                                            Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                                        })
                                    location.hash = `customer/groups/identifiers/list`;
                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                        }
                    })
                } else {//group list
                    let selectedmembers = [];
                    $.each($("input[name='selectedmembers[]']:checked"), function () {
                        selectedmembers.push($(this).val());
                    });
                    var contactlist = uniqueArray(selectedmembers);
                    //console.log("contactlist", contactlist);
                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                group_for: "customer",
                                custom_group_from: sessionStorage.getItem('group_from'),
                                group_type: sessionStorage.getItem('group_type'),
                                visibility: getGroupVisibility,
                                name: firstLetterUpperCase(getGroupName),
                                description: firstLetterUpperCase(getGroupDescription),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size,
                                customer_data: contactlist
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    digibiz.groupPictureblob = {};
                                    //console.log("success in group creation", response);
                                    sessionStorage.removeItem('group_from');
                                    sessionStorage.removeItem('group_id');
                                    sessionStorage.removeItem('group_type');

                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                            location.hash = `customer/groups/identifiers/list`;
                        }
                    })
                }
            }
        } else {
            removeLoader();
        }
    });

    //add customer custom group
    $(document).on('click', '#customer_custom_group_add_button', function () {
        addLoader();
        sessionStorage.setItem('group_type', "custom");
        location.hash = `customer/group_details`;
    });

    //add customer custom group member add button
    $(document).on('click', '#add_customer_group_customer_btn', function () {
        //console.log("clicked", sessionStorage.getItem('group_id'));
        digibiz.customerSelectedContactList = [];
        if (sessionStorage.getItem('group_id') === undefined || sessionStorage.getItem('group_id') === null || sessionStorage.getItem('group_id') == "") {
            // if (sessionStorage.getItem('group_from') == "contact_list") {

            // } else if (sessionStorage.getItem('group_from') == "group_list") {

            // } else {
            var action_sheet_parms = {
                action_id: "customer_group_creation_add_members_type",
                action_platform: crossplat.device.platform,
                action_title: "Add by",
                action_btn: [{
                    name: "Contact List",
                    attr: [{ name: "id", value: "customer_group_creation_add_members_by_contact_list" }]
                },
                {
                    name: "Group List",
                    attr: [{ name: "id", value: "customer_group_creation_add_members_by_group_list" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    $('#customer_group_creation_add_members_type').addClass('hide');
                    $('#customer_group_creation_add_members_by_contact_list').trigger('click');
                    removeLoader();
                } else if (sessionStorage.getItem('group_from') == "group_list") {
                    $('#customer_group_creation_add_members_type').addClass('hide');
                    $('#customer_group_creation_add_members_by_group_list').trigger('click');
                    removeLoader();
                } else {
                    removeLoader();
                }
            });
            // }
        } else {
            //console.log("present id")
            var action_sheet_parms = {
                action_id: "customer_group_creation_add_members_type",
                action_platform: crossplat.device.platform,
                action_title: "Add by",
                action_btn: [{
                    name: "Contact List",
                    attr: [{ name: "id", value: "customer_group_creation_add_members_by_contact_list" }]
                },
                {
                    name: "Group List",
                    attr: [{ name: "id", value: "customer_group_creation_add_members_by_group_list" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $('#customer_group_creation_add_members_type').addClass('hide');
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    $('#customer_group_creation_add_members_by_contact_list').trigger('click');
                } else if (sessionStorage.getItem('group_from') == "group_list") {
                    $('#customer_group_creation_add_members_by_group_list').trigger('click');
                }
                removeLoader();
            });
        }
    });


    //customer contact list for group creation
    $(document).on('click', '#customer_group_creation_add_members_by_contact_list', function () {
        //console.log("clicked triggered");
        addLoader();
        sessionStorage.setItem('group_from', 'contact_list');
        $('#customer_group_creation_add_members_type').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        getCustomerGroupContactList(reqParam)
            .then((response) => {
                removeLoader();
                //console.log("getCustomerGroupContactList", response);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "modal-customer-group-contact-list-selection",
                    modal_header: "Contact List",
                    modal_body: `<div id="customer-group-contacts-items-list-main-container">
                                    <div class="search">                                                                            
                                        <div class="expand-search-wrap search-wrapper" id="customer-group-contacts-items-list-search-btn">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                            <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                            <span class="searchclosebtn"><i class="material-icons customer-group-contacts-items-list-close-btn hide">close</i></span>
                                        </div>
                                    </div>
                                    <div id="customer-group-contacts-items-list-wrapper"></div>
                                </div>`,
                    modal_action_buttons: [{
                        "name": "Add",
                        "id": "add-selected-customers-group",
                    }]
                }
                showModal(modal_data, function () {
                    // removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processCustomerGroupContactsList(response, function () {
                        setTimeout(function () {
                            listenForCustomerGroupContactsListScrollEvent($(".modal-popup-content"));
                            var element = $('#modal-customer-group-contact-list-selection').find('.expand-search-input');
                            if (element) {
                                //console.log('element22', element);
                                //if element is there
                                $(document).on('input', element, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element.attr("socketid");
                                    keyword = element.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword
                                        };
                                        switch (currentroute) {
                                            case 'customer_groups_details':
                                                if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                                                    if ($('#modal-customer-group-contact-list-selection').length > 0) {
                                                        //console.log("modal-customer-group-contact-list-selection")
                                                        data['index'] = 'getCustomerGroupContactListMemberSelection';
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                }
                                                break;
                                            default:
                                                break;
                                        }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part")
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'customer_groups_details':
                                                if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                                                    if ($('#modal-customer-group-contact-list-selection').length > 0) {
                                                        processCustomerGroupContactsList(response, function () { });
                                                    }
                                                }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                                        if ($('#modal-customer-group-contact-list-selection').length > 0) {
                                            processCustomerGroupContactsList(response, function () { });
                                        }
                                    }
                                })
                            }
                        }, 0);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
            })
    });

    //on click of add button
    $(document).on('click', '#add-selected-customers-group', function () {
        addLoader();
        // if ($('.customer-group-contact-select-btn:checked').length > 0) {
        if ($('.customer-group-contact-select-btn-checkbox-click-wrapper.selected-row').length > 0) {
            if (sessionStorage.getItem('group_id')) {
                var alert_parms = {
                    alert_id: "alert-customer-group-member-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-customer-group-member-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-customer-group-member-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

                // let selectedmembers = [];
                // $.each($('.customer-group-contact-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).find('.customer-group-contact-select-btn').attr('data-id'),
                //         type: $(element).find('.customer-group-contact-select-btn').attr('data-type')
                //     });
                // });
                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCustomerGroupsDetailPage();
                //         $('#modal-customer-group-contact-list-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                $('.search-member-button').removeClass('hide');
                $.each($('.customer-group-contact-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
                    var getCustomerId = $(element).find('.customer-group-contact-select-btn').attr('data-id');
                    //console.log("getCustomerId", getCustomerId);
                    var getCustomerName = $(element).find('.customer-contact-name span').text();
                    //console.log("getCustomerName", getCustomerName);
                    var getCustomerNameImageLetter = $(element).find('.customer-contact-name span').text().charAt(0);
                    //console.log("getCustomerNameImageLetter", getCustomerNameImageLetter);
                    var getCustomerType = $(element).find('.customer-group-contact-select-btn').attr('data-type');
                    //console.log("getCustomerType", getCustomerType);
                    var getRoleId = $(element).find('.customer-group-contact-select-btn').attr('data-role-id');
                    //console.log("getRoleId", getRoleId);
                    var getRoleType = $(element).find('.customer-group-contact-select-btn').attr('data-role-type');
                    //console.log("getRoleType", getRoleType);
                    var getRoleBusinessID = $(element).find('.customer-group-contact-select-btn').attr('data-role-business-id');
                    //console.log("getRoleBusinessID", getRoleBusinessID);
                    var getRoleBusinessName = $(element).find('.customer-contact-role-business-name span').text();
                    //console.log("getRoleBusinessName", getRoleBusinessName);
                    var getMainIdentifier = $(element).parent('.accordion-content').parents('.accordion-content').siblings('.accordion-title').find('.customer-contacts-identifier-name').text();
                    //console.log('getMainIdentifier', getMainIdentifier);
                    var getLabel = $(element).find('.customer-group-contact-select-btn').attr('data-label');
                    if (getCustomerType == "associate_customer") {
                        var getParentCustomerId = $(element).find('.customer-group-contact-select-btn').attr('data-parent-customer-id');
                        //console.log("getParentCustomerId", getParentCustomerId);
                        var getAssociateCustomerInfo = $(element).find('.associate-customer-info span').text();
                        //console.log("getAssociateCustomerInfo", getAssociateCustomerInfo);
                        if (getCustomerId != undefined) {
                            var members = {
                                id: getCustomerId,
                                name: getCustomerName,
                                imageLetter: getCustomerNameImageLetter,
                                customer_type: getCustomerType,
                                role_id: getRoleId,
                                role_type: getRoleType,
                                role_business_id: getRoleBusinessID,
                                role_business_name: getRoleBusinessName,
                                main_identifier: getMainIdentifier,
                                parent_customer_id: getParentCustomerId,
                                associate_customter_info: getAssociateCustomerInfo,
                                type: "associate_customer",
                                selected: true,
                                label: getLabel
                            }
                            var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                            if (index == -1) {
                                digibiz.selectedMembers.push(members);
                                // }
                                if (getRoleType == "employee") {
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}" data-parent-customer-id="${getParentCustomerId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}" data-label="${getLabel}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                            <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                            <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                            <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getAssociateCustomerInfo}-${getMainIdentifier}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    //console.log("template", template)
                                    //console.log("123", $('#customer-group-members-list'))
                                    $('#customer-group-members-list').append(template);
                                    $('#modal-customer-group-contact-list-selection').remove();
                                } else {
                                    //console.log("got")
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}" data-parent-customer-id="${getParentCustomerId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}" data-label="${getLabel}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                            <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                            <span class="truncate selected-member-info wrapper-secondary-heading">${getAssociateCustomerInfo}-${getMainIdentifier}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    //console.log("template", template)
                                    //console.log("123", $('#customer-group-members-list'))
                                    $('#customer-group-members-list').append(template);
                                }

                            }
                            $('#modal-customer-group-contact-list-selection').remove();
                        } else {
                            removeLoader();
                            //console.log("customer id is undefined")
                        }
                    } else {//customer type
                        if (getCustomerId != undefined) {
                            var members = {
                                id: getCustomerId,
                                name: getCustomerName,
                                imageLetter: getCustomerNameImageLetter,
                                customer_type: getCustomerType,
                                role_id: getRoleId,
                                role_type: getRoleType,
                                role_business_id: getRoleBusinessID,
                                role_business_name: getRoleBusinessName,
                                main_identifier: getMainIdentifier,
                                label: getLabel,
                                type: "customer",
                                // parent_customer_id: getParentCustomerId,
                                // associate_customter_info: getAssociateCustomerInfo,                             
                                selected: true
                            }
                            var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                            if (index == -1) {
                                digibiz.selectedMembers.push(members);
                                // }
                                if (getRoleType == "employee") {
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}" data-label="${getLabel}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                        <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                        <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                        <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMainIdentifier}-${getLabel}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    $('#customer-group-members-list').append(template);
                                    $('#modal-customer-group-contact-list-selection').remove();
                                } else {
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}" data-label="${getLabel}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                        <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                        <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMainIdentifier}-${getLabel}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    $('#customer-group-members-list').append(template);
                                }
                                $('#modal-customer-group-contact-list-selection').remove();
                            }
                        } else {
                            removeLoader();
                            //console.log("customer id is undefined")
                        }
                    }

                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select alteast 1 contact`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-customer-group-member-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.customer-group-contact-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
            selectedmembers.push({
                id: $(element).find('.customer-group-contact-select-btn').attr('data-id'),
                type: $(element).find('.customer-group-contact-select-btn').attr('data-type')
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                removeLoader();
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                $('#alert-customer-group-member-add-confirm-cancel').remove();
                getCustomerGroupsDetailPage();
                $('#modal-customer-group-contact-list-selection').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })

    $(document).on('click', '#btn-customer-group-member-add-confirm-no', function () {
        $('#alert-customer-group-member-add-confirm-cancel').remove();
    })

    //delete custom customer group member
    $(document).on('click', '#delete_custom_customer_group_member', function () {
        addLoader();
        var getMemberId = $(this).attr('data-member-id');
        var alert_parms = {
            alert_id: "alert-delete-custom-customer-group-member-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Member`,
            alert_body: `Are you sure you want to delete the member?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-custom-customer-group-member-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-custom-customer-group-member-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-custom-customer-group-member-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
        });
    });

    //Delete no employee member
    $(document).on('click', '#btn-delete-custom-customer-group-member-cancel-no', function () {
        $('#alert-delete-custom-customer-group-member-confirm-cancel').remove();
    });

    //Delete yes employee member
    $(document).on('click', '#btn-delete-custom-customer-group-member-confirm-yes', function () {
        addLoader();
        var getMemberId = $('#alert-delete-custom-customer-group-member-confirm-cancel').attr('data-member-id');
        $('#alert-delete-custom-customer-group-member-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            id: getMemberId
        }
        checkGroupMemberDelete(requestParams)
            .then((result) => {
                groupMemberDelete(requestParams)
                    .then((response) => {
                        //console.log("employeeGroupMemberDelete response", response);
                        $(`.custom-customer-group-member-wrapper[data-member-id="${getMemberId}"]`).remove();
                        removeLoader();
                        Materialize.toast(`Successfully removed member`, 3000, 'round success-alert');
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("Error in member removing");
                        Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                // Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                if (err.msg == "Minimum 2 members are required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 2 members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 1 moderator is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-moderator-ok",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 moderator is required. Please add moderator to delete the selected member.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-moderator-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    removeLoader();
                }
            })
    });

    //customer custom group by group list
    $(document).on('click', '#customer_group_creation_add_members_by_group_list', function () {
        addLoader();
        digibiz.customerGroupCustomGroupsList = [];
        sessionStorage.setItem('group_from', 'group_list');
        $('#customer_group_creation_add_members_type').remove();
        //get all std groups
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            list_by: "draft_active_standard_customer_groups",
            count: 20,
            offset: 0
        }
        groupsList(reqParams)
            .then((response) => {
                //console.log("employeeGroupList response", response);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "modal-customer-group-groups-list-selection",
                    modal_header: "Groups List",
                    modal_body: `<div id="customer-group-custom-groups-list-main-container">
                                        <div class="search">
                                            <div class="expand-search-wrap search-wrapper" id="customer-group-custom-groups-list-search-btn">
                                                <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                <span class="searchclosebtn"><i class="material-icons customer-group-custom-groups-list-close-btn hide">close</i></span>
                                            </div>                                        
                                        </div>
                                    <div id="customer-group-custom-groups-list-wrapper"></div>
                                    </div>`,
                    modal_action_buttons: [{
                        "name": "Add",
                        "id": "add-selected-customers-group-custom-groups",
                    }]
                };
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processCustomerGroupCustomGroupList(response, function () {
                        removeLoader();
                        setTimeout(function () {
                            listenForCustomerGroupCustomGroupListScrollEvent($(".modal-popup-content"));
                            var element = $('#modal-customer-group-groups-list-selection').find('.expand-search-input');
                            if (element) {
                                //console.log('element22', element);
                                //if element is there
                                $(document).on('input', element, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element.attr("socketid");
                                    keyword = element.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword
                                        };
                                        switch (currentroute) {
                                            case 'customer_groups_details':
                                                if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                                                    if ($('#modal-customer-group-groups-list-selection').length > 0) {
                                                        data['index'] = 'getCustomerGroupGroupListMemberSelection';
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                }
                                                break;
                                            default:
                                                break;
                                        }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part")
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'customer_groups_details':
                                                if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                                                    if ($('#modal-customer-group-groups-list-selection').length > 0) {
                                                        processCustomerGroupCustomGroupList(response, function () { });
                                                    }
                                                }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                                        if ($('#modal-customer-group-groups-list-selection').length > 0) {
                                            processCustomerGroupCustomGroupList(response, function () { });
                                        }
                                    }
                                })
                            }
                        }, 0);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
            })
    });

    //add selected groups to custom customer group
    $(document).on('click', '#add-selected-customers-group-custom-groups', function () {
        addLoader();
        // if ($('.customer-group-custom-group-select-btn:checked').length > 0) {
        if ($('.customer-group-custom-group-select-btn-checkbox-click-wrapper.selected-row').length > 0) {
            if (sessionStorage.getItem('group_id')) {
                var alert_parms = {
                    alert_id: "alert-customer-group-member-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-customer-standard-group-member-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-customer-group-member-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

                // let selectedmembers = [];
                // $.each($('.customer-group-custom-group-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).find('.customer-group-custom-group-select-btn').attr('data-id')
                //     });
                // });
                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     id: sessionStorage.getItem('group_id'),
                //     customer_data: contactlist
                // }
                // customerGroupMemberGroupUpdate(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCustomerGroupsDetailPage();
                //         $('#modal-customer-group-groups-list-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                $('.search-member-button').addClass('hide');
                $.each($('.customer-group-custom-group-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
                    var getGroupId = $(element).find('.customer-group-custom-group-select-btn').attr('data-id');
                    var getGroupName = $(element).find('.customer-custom-group-name span').text();
                    var getGroupNameImageLetter = $(element).find('.customer-custom-group-name span').text().charAt(0);
                    if (getGroupId != undefined) {

                        var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getGroupId}"><div class="file-select">
                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getGroupId}" id="selected-${getGroupId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                        <span>${getGroupNameImageLetter}</span> 
                     </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getGroupId}">${getGroupName}</span></div>
                </div>`;
                        // $('#customer-group-members-list').append(template);
                        console.log('leee', $(`.customer-group-member-wrapper[data-id="${getGroupId}"]`).length);
                        if ($(`.customer-group-member-wrapper[data-id="${getGroupId}"]`).length == 0) {
                            $('#customer-group-members-list').append(template);
                        }

                        $('#modal-customer-group-groups-list-selection').remove();
                    } else {
                        removeLoader();
                        //console.log("group id is undefined")
                    }
                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 group.`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-customer-standard-group-member-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.customer-group-custom-group-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
            selectedmembers.push({
                id: $(element).find('.customer-group-custom-group-select-btn').attr('data-id')
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id'),
            customer_data: contactlist
        }
        customerGroupMemberGroupUpdate(requestParams)
            .then((result) => {
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                getCustomerGroupsDetailPage();
                $('#modal-customer-group-groups-list-selection').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })

    })

    //delete member group
    $(document).on('click', '#delete_custom_customer_group_member_group', function () {
        addLoader();
        var getMemberId = $(this).attr('data-group-id');
        var alert_parms = {
            alert_id: "alert-delete-custom-customer-group-member-group-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Member Group`,
            alert_body: `Are you sure you want to delete the member group?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-custom-customer-group-member-group-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-custom-customer-group-member-group-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-custom-customer-group-member-group-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
        });
    });

    //Delete no customer group member group
    $(document).on('click', '#btn-delete-custom-customer-group-member-group-cancel-no', function () {
        $('#alert-delete-custom-customer-group-member-group-confirm-cancel').remove();
    });

    //Delete yes customer group member-group
    $(document).on('click', '#btn-delete-custom-customer-group-member-group-confirm-yes', function () {
        addLoader();
        var getMemberId = $('#alert-delete-custom-customer-group-member-group-confirm-cancel').attr('data-member-id');
        $('#alert-delete-custom-customer-group-member-group-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id'),
            group_id: getMemberId
        }
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getMemberId,
            group_id: sessionStorage.getItem('group_id'),
        }
        checkGroupMemberDelete(reqparams)
            .then((result) => {
                customerGroupMemberGroupDelete(requestParams)
                    .then((response) => {
                        //console.log("customerGroupMemberGroupDelete response", response);
                        $(`.custom-customer-group-member-wrapper[data-group-id="${getMemberId}"]`).remove();
                        removeLoader();
                        Materialize.toast(`Successfully removed member group`, 3000, 'round success-alert');
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("Error in member group removing");
                        Materialize.toast(`Error in member group removing`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                // Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                if (err.msg == "Minimum 2 members are required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 2 members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 1 moderator is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-moderator-ok",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 moderator is required. Please add moderator to delete the selected member.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-moderator-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    removeLoader();
                }
            })
    });



    //group image multimedia
    $(document).on('click', '#group-image-load-btn', function () {
        digibiz.isGroupPictureSelected = false;
        addLoader();
        var action_parms = {
            action_id: "group-image-type-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device",
                    attr: [{ name: "id", value: "group-image-device-upload-type-btn" }]
                },
                {
                    name: "Cloud",
                    // attr: [{ name: "id", value: "group-image-cloud-upload-type-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera",
                    attr: [{ name: "id", value: "group-image-camera-upload-type-btn" }]
                }
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //group image device upload
    $(document).on('click', '#group-image-device-upload-type-btn', function () {
        addLoader();
        $('#group-image-upload').val("");
        $('#group-image-upload').trigger('click');
        $('#group-image-type-action-sheet').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "group-image-modal",
            modal_header: "",
            modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "group-image-crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: ''
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                    // //console.log("scroll initiated for modal pop-up class")
                    // appScroll.scrollBar('.modal-popup-content');
                }
            }
            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#group-image-modal').attr('picture-type', 'group_image');
        });
    });

    //group image device upload select picture
    $(document).on("change", `#group-image-upload`, function () {
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            if (!(config.identityPictureFileFormat.includes(fileType.toLowerCase()))) {
                $('#group-image-upload').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#group-image-upload').val('');
                $('#group_image').attr("src", "");//empty
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#group-image-upload').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#group-image-upload').val('');
                $('#group_image').attr("src", "");//empty
            }
            else {
                if (files[0])
                    var photo = files[0];
                var reader = new FileReader();
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //group image crop button click
    $(document).on('click', '#group-image-crop-button', function () {
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                if ($('#group-image-modal').attr('picture-type') == 'group_image') {
                    if (sessionStorage.getItem('group_id')) {
                        saveGroupPictureSecondTime(reader.result, blob, function (err, groupImageData) {
                            if (err) {
                                removeLoader();
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            } else {
                                //console.log("groupImageData", groupImageData);
                                $('#group_image').attr("src", reader.result);
                                //remove +
                                $('#group-image-load-btn').remove();
                                //remove delete
                                $('#group-image-delete').remove();
                                $('.group-info-wrapper').find('.mask').removeClass('hide');
                                //append photo_camera first and then delete
                                $('#group_image').siblings('.mask').append(`<a class="info group-image-multimedia-load-btn cursor_pointer"><i class="material-icons" id="group-image-load-btn" data-thumbnail-id="${groupImageData}">photo_camera</i></a>`);
                                $('#group_image').siblings('.mask').append(`<a class="info cursor_pointer"><i class="material-icons" id="group-image-delete" data-image-id="${groupImageData}">delete</i></a>`);
                                $('#group-image-modal').remove();
                                $('#camera-modal').remove();
                                removeLoader();
                                digibiz.isGroupPictureSelected = true;
                                digibiz.groupPictureblob = {};
                                digibiz.cropper.destroy();
                            }
                        });
                    } else {
                        $('#group_image').attr("src", reader.result);
                        $('#group-image-load-btn').replaceWith(`<i class="material-icons" id="group-image-delete">delete</i>`)
                        $('#group-image-delete').parent().removeClass('group-image-multimedia-load-btn');
                        // $('#modal-close-btn').trigger('click');
                        $('#group-image-modal').remove();
                        $('#camera-modal').remove();
                        digibiz.isGroupPictureSelected = true;
                        digibiz.groupPictureblob = blob;
                        digibiz.cropper.destroy();
                    }
                }
            }
            reader.readAsDataURL(blob);
        });
    });

    //Delete group image
    $(document).on('click', '#group-image-delete', function (e) {
        var image_id = $(this).attr('data-image-id');
        //console.log("delete group image", image_id);
        e.stopPropagation();
        if (image_id) {
            var alert_parms = {
                alert_id: "alert-delete-group-image-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: "Delete Group Image",
                alert_body: `Do you want to delete the group image?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-group-image-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-group-image-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                $('#alert-delete-group-image-confirm-cancel').attr('delete-image-id', image_id);
            });
        } else {
            $('#group-image-upload').val('');
            $('#group_image').attr("src", "");//empty
            $('#group-image-delete').replaceWith(`<i class="material-icons" id="group-image-load-btn">add</i>`)
            $('#group-image-load-btn').parent().addClass('group-image-multimedia-load-btn');
            $('.group_image_preview').remove();
            digibiz.isGroupPictureSelected = false;
        }
    })
    //delete NO clicked
    $(document).on('click', '#btn-delete-group-image-confirm-no', function () {
        $('#alert-delete-group-image-confirm-cancel').remove();
    })
    //delete YES clicked
    $(document).on('click', '#btn-delete-group-image-confirm-yes', function () {
        var imageId = $('#alert-delete-group-image-confirm-cancel').attr('delete-image-id');
        $('#alert-delete-group-image-confirm-cancel').remove();
        //api call to delete asset
        var groupId = sessionStorage.getItem('group_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            group_image_id: imageId,
            group_id: groupId,
        }
        addLoader();
        groupImageDelete(requesParam)
            .then((response) => {
                removeLoader();
                $('#group-image-upload').val('');
                $('#group_image').attr("src", "");//empty
                $('#group-image-delete').remove();//remove delete button
                $('#group-image-load-btn').attr('data-thumbnail-id', '');
                digibiz.isGroupPictureSelected = false;
                digibiz.groupPictureblob = {};
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    //group image cloud upload
    // $(document).on('click', '#group-image-cloud-upload-type-btn', function () {
    //     addLoader();
    //     $('#group-image-upload').val("");
    //     $('#group-image-type-action-sheet').remove();

    //     $('.grid-view-container').removeClass('edit-mode');
    //     $('input[name="fileselection[]"]').prop('checked', false);
    //     $(".expand-search-input").removeAttr("socketid");
    //     $(".expand-search-input").val('');
    //     getFilemanagerAssets(null, "personal_workspace").then((assetsDetails) => {
    //         digibiz.cloudAssets = assetsDetails.Data.assets;
    //         showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
    //             removeLoader();
    //             $('.filemanger_container_toggle').trigger('click');
    //             $('.file-manager-footer').removeClass('hide');
    //             $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
    //         })
    //     }).catch((err) => {
    //         Materialize.toast("No assets found", 3000, 'rounded error-alert');
    //         showFilemanagerAssetsFilesList(null, function () {
    //             removeLoader();
    //         })
    //     });
    // });

    //group image camera upload
    $(document).on('click', '#group-image-camera-upload-type-btn', function () {
        addLoader();
        $('#group-image-upload').val("");
        $('#group-image-type-action-sheet').remove();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');

                    $('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                    removeLoader();
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
                    window.cameraMediaFile = path;
                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }
                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "group-image-modal",
                        modal_header: "",
                        modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "group-image-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#group-image-modal').attr('picture-type', 'group_image');
                    });
                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group-image-delete').hide();
                                            };
                                            $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500)
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                removeLoader();
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
            removeLoader();
        }

    });
    // $(document).on('click', '#group-image-camera-upload-type-btn', function () {
    //     addLoader();
    //     $('#group-image-upload').val("");
    //     $('#group-image-type-action-sheet').remove();

    //     fetch.getHtml(function (fetcherror, html) {
    //         var modal_data = {
    //             modal_id: "camera-modal",
    //             modal_header: "Camera",
    //             modal_platform: crossplat.device.platform,
    //             modal_body: html,
    //             // modal_action_buttons: [{
    //             //     "name": "Add",
    //             //     "id": "add-selected-employees-group",
    //             // }]
    //         }
    //         showModal(modal_data, function () {
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 // if ($('.modal-popup-content').length > 0) {
    //                 //     //console.log("scroll initiated for modal pop-up class")
    //                 //     appScroll.scrollBar('.modal-popup-content');
    //                 // }
    //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //             } else {
    //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //             }
    //             $('#modal-close-btn').addClass('hide');
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 const vgaConstraints = { video: true };
    //                 navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //                     //global stream
    //                     window.camerastream = stream;
    //                     //remove Hide class from upload preview
    //                     //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     // $("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     // $(".file-manager-footer").addClass('hide');
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
    //                     //show preview
    //                     var videoElement = document.querySelector('#capture-video');
    //                     // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
    //                     //console.log("videoElement", videoElement);
    //                     videoElement.srcObject = stream;
    //                     videoElement.play();
    //                 });
    //             } else {
    //                 //andriod
    //                 // capture callback
    //                 var captureSuccess = function (mediaFiles) {
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('disabled');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-footer-send-btn').removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('.upload-preview-footer').removeClass('hide');
    //                     //show preview
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#file-manager-container").addClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".file-manager-footer").addClass('hide');
    //                     //remove Hide class from upload preview
    //                     if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").hasClass('hide')) {
    //                         $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //                     }
    //                     //Change Title
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
    //                     //hide send button, caption & add button
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").empty();
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").removeClass('hide');
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-attatched-new-file").addClass('hide');
    //                     //change send button attribute
    //                     $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //                     var i, path, viewPath, len;
    //                     for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //                         path = mediaFiles[i].localURL;
    //                         // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
    //                         viewPath = mediaFiles[i].fullPath;
    //                         window.cameraMediaFile = path;
    //                         //append captured photo

    //                         // var img = new Image;
    //                         // img.src = URL.createObjectURL(blob);
    //                         // img.classList.add('preview-file');
    //                         // var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //                         // //console.log("getElement", getElement);
    //                         // // document.querySelector($(getElement)).appendChild(img);
    //                         // $(getElement).append(img);
    //                         // $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-close-btn').attr('identifier', img.src);
    //                         // identifier = img.src;
    //                         // //revoke stream(stop device)
    //                         // if (window.camerastream) {
    //                         //     window.camerastream.getTracks()[0].stop();
    //                         // }




    //                         var img = new Image;
    //                         //console.log("img", img);
    //                         //console.log("path", path);
    //                         img.src = viewPath;
    //                         //console.log("img11", img);
    //                         img.classList.add('preview-file');
    //                         var getElement = $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-file-preview');
    //                         //console.log("getElement", getElement);
    //                         // document.querySelector('#upload-file-preview').appendChild(img);
    //                         $(getElement).append(img);
    //                         //revoke stream(stop device)
    //                         if (window.camerastream) {
    //                             window.camerastream.getTracks()[0].stop();
    //                         }


    //                         // var image = $('#image_cropper')[0];
    //                         // image.src = path;
    //                         // $('#transaction-signature-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         // digibiz.cropper = new Cropper(image, {
    //                         //     viewMode: 0,
    //                         //     aspectRatio: 1 / 1,
    //                         //     minContainerWidth: 72,
    //                         //     minContainerHeight: 72,
    //                         //     minCropBoxWidth: 72,
    //                         //     minCropBoxHeight: 72,
    //                         //     maxWidth: 100,
    //                         //     maxHeight: 400,
    //                         //     zoomable: true,
    //                         //     rotatable: true,
    //                         //     responsive: true,
    //                         //     movable: true,
    //                         //     ready: function () {
    //                         //     }
    //                         // });
    //                     };
    //                 };
    //                 // capture error callback
    //                 var captureError = function (error) {
    //                     navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //                 };
    //                 // start image capture            
    //                 navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //             }
    //             removeLoader();
    //         });
    //     }, 'page/common/camera', '#camera-template', null);

    //     // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //     //     const vgaConstraints = { video: true };
    //     //     navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
    //     //         //global stream
    //     //         window.camerastream = stream;
    //     //         //remove Hide class from upload preview
    //     //         if ($("#upload-preview-wrapper").hasClass('hide')) {
    //     //             $("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //     //         }
    //     //         //Change Title
    //     //         $(".upload-preview-header span").text("Capture Photo");
    //     //         $("#file-manager-container").addClass('hide');
    //     //         $(".upload-preview-container").removeClass('hide');
    //     //         $(".file-manager-footer").addClass('hide');
    //     //         //hide send button, caption & add button
    //     //         $(".upload-preview-container-file-caption").addClass('hide');
    //     //         $(".upload-preview-footer").addClass('hide');
    //     //         $("#upload-permission-btn").addClass('hide');
    //     //         $('#upload-preview-container-text-box').text("");
    //     //         $("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue"><i class="material-icons">photo_camera</i></button>`);
    //     //         //show preview
    //     //         var videoElement = document.querySelector('#capture-video');
    //     //         videoElement.srcObject = stream;
    //     //         videoElement.play();
    //     //     });
    //     // } else {
    //     //     //andriod
    //     //     // capture callback
    //     //     var captureSuccess = function (mediaFiles) {
    //     //         $('#upload-footer-send-btn').removeClass('disabled');
    //     //         $('#upload-footer-send-btn').removeClass('hide');
    //     //         $('.upload-preview-footer').removeClass('hide');
    //     //         //show preview
    //     //         $("#file-manager-container").addClass('hide');
    //     //         $(".upload-preview-container").removeClass('hide');
    //     //         $(".file-manager-footer").addClass('hide');
    //     //         //remove Hide class from upload preview
    //     //         if ($("#upload-preview-wrapper").hasClass('hide')) {
    //     //             $("#upload-preview-wrapper").removeClass('hide').addClass('slide-top');
    //     //             $('div[data-filemanager="filemanager"]').addClass('hide');
    //     //         }
    //     //         //Change Title
    //     //         $(".upload-preview-header span").text("Capture Photo");
    //     //         //hide send button, caption & add button
    //     //         $("#upload-file-preview").empty();
    //     //         $(".upload-preview-container-file-caption").removeClass('hide');
    //     //         $('#upload-preview-container-text-box').text("");
    //     //         $("#upload-footer-attatched-new-file").addClass('hide');
    //     //         //change send button attribute
    //     //         $("#upload-footer-send-btn").attr('data-uploadtype', 'camera');
    //     //         var i, path, len;
    //     //         for (i = 0, len = mediaFiles.length; i < len; i += 1) {
    //     //             path = mediaFiles[i].localURL;
    //     //             window.cameraMediaFile = path;
    //     //             //append captured photo

    //     //             var image = $('#image_cropper')[0];
    //     //             image.src = path;
    //     //             $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //     //             digibiz.cropper = new Cropper(image, {
    //     //                 viewMode: 0,
    //     //                 aspectRatio: 1 / 1,
    //     //                 minContainerWidth: 72,
    //     //                 minContainerHeight: 72,
    //     //                 minCropBoxWidth: 72,
    //     //                 minCropBoxHeight: 72,
    //     //                 maxWidth: 100,
    //     //                 maxHeight: 400,
    //     //                 zoomable: true,
    //     //                 rotatable: true,
    //     //                 responsive: true,
    //     //                 movable: true,
    //     //                 ready: function () {
    //     //                 }
    //     //             });
    //     //         };
    //     //     };
    //     //     // capture error callback
    //     //     var captureError = function (error) {
    //     //         navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
    //     //     };
    //     //     // start image capture            
    //     //     navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
    //     // }
    //     removeLoader();
    // });

    //group image picture preview
    $(document).on('click', '.group_image_preview', function () {
        var imageId = $(this).attr('data-image-id');
        //console.log("imageId", imageId);
        addLoader();
        getIdentityPicInfo(imageId)
            .then((info) => {
                var assetParam = {
                    device_id: crossplat.device.uuid,
                    location: info.location,
                    parent: info.parent,
                    owner: info.owner,
                    real_name: info.file_attributes.name.real
                }
                getViewMultimediaUrl(assetParam)
                    .then((response) => {
                        viewFile(info.file_attributes.name.relative, response.Data, function () {
                        })
                    })
                    .catch((err) => {
                        removeLoader();
                        // if drive is inactive 
                        if (err.hasOwnProperty("message") && err.message.hasOwnProperty("error_description")) {
                            Materialize.toast(`${err.message.error_description} ! Please try again later`, 3000, "round error-alert");
                        }
                        else if (err.hasOwnProperty("error") && err.error.hasOwnProperty("msg")) {
                            //if file is deleted
                            Materialize.toast(`${err.error.msg} ! Please try again later`, 3000, 'round error-alert');
                        }
                        else {
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        }
                    });
                resolve();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'rounderror-alert');
            });
    });




    /*******************CUSTOMER MANAGEMENT***************************/

    /*************COLLABORATOR MANAGEMENT************************/
    //collaborator management icon click
    $(document).on('click', '.collaborator-management', function () {
        addLoader();
        location.hash = `collaborator/hub`;
    });

    //collaborator contact list icon click
    $(document).on('click', '.collaborator-contact-list', function () {
        addLoader();
        sessionStorage.removeItem('selected-collaborator-tab')
        location.hash = `collaborator/contact/list`;
    });

    //business notification icon click
    $(document).on('click', '.business_notifications', function () {
        addLoader();
        location.hash = `business/notifications`;
    });

    //add collaborator button
    $(document).on('click', '#collaborator-add-btn', function () {
        addLoader();
        if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
            var action_sheet_parms = {
                action_id: "add-collaborator-type-action-sheet",
                action_platform: crossplat.device.platform,
                action_title: "Add by",
                action_btn: [{
                    name: "Business Unique Name",
                    attr: [{ name: "id", value: "add_collaborator_by_business_unique_name" }]
                },
                {
                    name: "Business Name",
                    attr: [{ name: "id", value: "add_collaborator_by_business_name" }]
                },
                {
                    name: "QR Scan",
                    attr: [{ name: "id", value: "add_collaborator_by_qr_scan" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
            });
        } else {
            var action_sheet_parms = {
                action_id: "add-collaborator-type-action-sheet",
                action_platform: crossplat.device.platform,
                action_title: "Add by",
                action_btn: [{
                    name: "Business Unique Name",
                    attr: [{ name: "id", value: "add_collaborator_by_business_unique_name" }]
                },
                {
                    name: "Business Name",
                    attr: [{ name: "id", value: "add_collaborator_by_business_name" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
            });
        }
    });

    //add collaborator by business unique name
    $(document).on('click', '#add_collaborator_by_business_unique_name', function () {
        addLoader();
        // fetch.getHtml(function (fetcherror, html) {
        //     var modal_data = {
        //         modal_id: "modal-add-collaborator-by-business-unique-name",
        //         modal_header: "Add Collaborator-Business Unique Name",
        //         modal_platform: crossplat.device.platform,
        //         modal_body: html,
        //         modal_action_buttons: [{
        //             "name": "Notify",
        //             "id": "notify-collaboration-business-unique-name-btn",
        //         }]
        //     }
        //     showModal(modal_data, function () {
        //         $('#add-collaborator-type-action-sheet').remove();
        //         if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //             $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //         } else {
        //             $('.custom-modal-popup').show().addClass('modal-slide-top');
        //         }
        //         removeLoader();
        //     });
        // }, 'page/collaborator/collaborator_unique_name_notify_modal', '#add-collaborator-unique-name-notify-template', null);
        var alert_parms = {
            alert_id: "alert-add-collaborator-business-unique-name",
            alert_platform: crossplat.device.platform,
            alert_title: "Business unique name",
            alert_body: `<input class="business-unique-name validation" type="text" id="business_unique_name_field" placeholder="Enter business unique name"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "notify-collaboration-business-unique-name-cancel-btn" }]
            },
            {
                name: "Notify",
                attr: [{ name: "id", value: "notify-collaboration-business-unique-name-confirm-btn" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#add-collaborator-type-action-sheet').remove();
        });
    });

    //cancel business unique name alert
    $(document).on('click', '#notify-collaboration-business-unique-name-cancel-btn', function () {
        $('#alert-add-collaborator-business-unique-name').remove();
        removeLoader();
    });

    //confirm notify business unique name alert
    $(document).on('click', '#notify-collaboration-business-unique-name-confirm-btn', function () {
        addLoader();
        if ($('#business_unique_name_field').val() == "") {
            showError($('#business_unique_name_field'), `This field is required`);
            removeLoader();
        } else {
            var reqparams = {
                device_id: crossplat.device.uuid,
                type: "collaborator_contact_list",
                requestor_business_id: sessionStorage.getItem('business_id'),
                add_type: "add",
                data_type: "business_unique_name",
                business_unique_name: $('#business_unique_name_field').val()
            }
            businessNotificationAdd(reqparams)
                .then((response) => {
                    //console.log("businessNotificationAdd response", response);
                    removeLoader();
                    Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                    $('#alert-add-collaborator-business-unique-name').remove();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                })
        }
    });


    //add collaborator by business name
    $(document).on('click', '#add_collaborator_by_business_name', function () {
        addLoader();
        $('#add-collaborator-type-action-sheet').remove();
        location.hash = `collaborator/add`;
    });

    //notify
    $(document).on('click', '#notify-collaborator-contact', function () {
        addLoader();
        if (digibiz.collboratorContactAdd.hasOwnProperty('selected')) {
            //console.log("yes");
            var reqparams = {
                device_id: crossplat.device.uuid,
                type: "collaborator_contact_list",
                requestor_business_id: sessionStorage.getItem('business_id'),
                add_type: "add",
                data_type: "business_name",
                business_id: digibiz.collboratorContactAdd.business_id
            }
            businessNotificationAdd(reqparams)
                .then((response) => {
                    //console.log("businessNotificationAdd response", response);
                    removeLoader();
                    Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                    location.hash = `collaborator/contact/list`;
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                })
        } else {
            //console.log("no");
            Materialize.toast(`Please select 1 Business.`, 3000, 'round error-alert');
            removeLoader();
        }
    });

    //if by QR code
    $(document).on('click', '#add_collaborator_by_qr_scan', function () {
        addLoader();
        $('#add-collaborator-type-action-sheet').remove();
        location.hash = '#collaborator/scan_qr';
    });


    //collaborator pending tab
    $(document).on('click', '.collaborator-pending-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-collaborator-tab', 'pending_collaborator');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
        digibiz.pending_collaborator_contact_list = [];
        pendingCollaboratorContactListPage();
    });

    //collaborator active tab
    $(document).on('click', '.collaborator-active-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-collaborator-tab', 'active_collaborator');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
        digibiz.collaborator_contact_list = [];
        activeCollaboratorContactListPage();
    });


    //collaborator alumini tab
    $(document).on('click', '.collaborator-alumini-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-collaborator-tab', 'alumini_collaborator');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
        digibiz.alumini_collaborator_contact_list = [];
        aluminiCollaboratorContactListPage();
    });

    //pending collaborator wrapper details page
    $(document).on('click', '.pending-collaborator-data-wrapper', function () {
        addLoader();
        var getBusinessId = $(this).parents('.pending-collaborator-contact-wrapper').attr('data-business-id');
        sessionStorage.setItem('collaborator_business_id', getBusinessId);
        location.hash = `collaborator/contact_list/notification/details`;
    });

    //delete pendinf business contact list collabortor notification
    $(document).on('click', '#delete-collaborator-contact-list-notification', function () {
        addLoader();
        var getNotificationId = $(this).parents('.collaborator-contact-list-notification-details-wrapper').attr('data-notification-id');
        var reqparams = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationId
        }
        businessNotificationDelete(reqparams)
            .then((response) => {
                $(`.collaborator-contact-list-notification-details-wrapper[data-notification-id="${getNotificationId}"]`).remove();
                if ($(`.collaborator-contact-list-notification-details-wrapper`).length > 0) {

                } else {
                    location.hash = `collaborator/contact/list`;
                }
                Materialize.toast(`Successfully deleted`, 3000, "round error-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the notification`, 3000, "round error-alert");
            })
    });

    //accept business notification
    $(document).on('click', '#business-notification-accept-btn', function () {
        addLoader();
        var getNotificationId = $(this).parents('.accept_reject_wrap').attr('data-notification-id');
        var getReceiverBusinessId = $(this).parents('.accept_reject_wrap').attr('data-receiver-business-id');
        var getSenderBusinessId = $(this).parents('.accept_reject_wrap').attr('data-owner-business-id');
        var customerIdentifierId = $(this).parents('.accept_reject_wrap').attr('data-customer_identifier_id');
        var getType = $(this).parents('.accept_reject_wrap').attr('data-type');
        sessionStorage.removeItem('receiver_business_id');
        sessionStorage.setItem('receiver_business_id', getReceiverBusinessId);
        if (getType == "collaborator_contact_list") {
            var reqparams = {
                device_id: crossplat.device.uuid,
                notification_id: getNotificationId,
                business_id: getReceiverBusinessId,
                action: "accepted"
            }
            businessNotificationChangeStatus(reqparams)
                .then((response) => {
                    //console.log("businessNotificationChangeStatus", response);
                    if (response.type == "collaborator_contact_list" && response.contact.status.status == "accepted") {
                        var requestParams = {
                            device_id: crossplat.device.uuid,
                            acceptor_business_id: response.contact.business_id,
                            requestor_business_id: response.owner.business_id,
                            notification_id: getNotificationId
                        }
                        collaboratorAdd(requestParams)
                            .then((result) => {
                                //console.log("collaboratorAdd", result);
                                Materialize.toast(`Successfully Accepted`, 3000, "round error-alert");
                                $(this).parents(`.business-notification-list-wrapper`).remove();
                                removeLoader();
                            })
                            .catch((err) => {
                                //console.log("error in adding collaborator");
                                removeLoader();
                            })
                    }
                })
                .catch((err) => {
                    //console.log("error in accepting the notification");
                    removeLoader();
                })
        } else if (getType == "collaborator_group") {
            var getGroupId = $(this).parents('.accept_reject_wrap').attr('data-group-id');
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "list_only_active",
                business_id: getReceiverBusinessId,
                count: 20,
                offset: 0
            }
            employeeList(reqParam)
                .then((employeeResponse) => {
                    digibiz.employee_list = employeeResponse;
                    //console.log("employeeList response", employeeResponse);
                    var EmployeeList = {
                        EmployeeList: employeeResponse.map(e => {
                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.name.first.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                            return e;
                        }),
                        from: "direct"
                    }
                    //console.log("EmployeeList", EmployeeList);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-collaborator-group-employees-selection",
                            modal_header: "Employee List",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-collaborator-group-selected-employees",
                            }]
                        }
                        showModal(modal_data, function () {
                            //hide the modal close btn
                            // $('#modal-close-btn').addClass('hide');
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            listenForEmployeeList($('.modal-popup-content'));

                            $('#modal-collaborator-group-employees-selection').attr('data-group-id', getGroupId);
                            $('#modal-collaborator-group-employees-selection').attr('data-notification-id', getNotificationId);
                            $('#modal-collaborator-group-employees-selection').attr('data-receiver-business-id', getReceiverBusinessId)
                            // Materialize.toast(`Successfully Accepted`, 3000, "round error-alert");
                            // $(this).parents(`.business-notification-list-wrapper`).remove();
                            removeLoader();
                        });
                    }, 'page/collaborator/employee_selection_list', '#employee-selection-list-template', EmployeeList);
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`Cannot accept the business if there is no employees in your business.`, 3000, 'round success-alert');
                })
        } else if (getType == "collaborator_customer_contact_list") {
            var getGroupId = $(this).parents('.accept_reject_wrap').attr('data-group-id');
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "list_only_active",
                business_id: getReceiverBusinessId,
                count: 20,
                offset: 0
            }
            employeeList(reqParam)
                .then((employeeResponse) => {
                    //console.log("employeeList response", employeeResponse);
                    var EmployeeList = {
                        EmployeeList: employeeResponse.map(e => {
                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.name.first.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                            return e;
                        }),
                        from: "direct"
                    }
                    //console.log("EmployeeList", EmployeeList);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-collaborator-group-employees-selection",
                            modal_header: "Employee List",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-collaborator-customer-selected-employees",
                            }]
                        }
                        showModal(modal_data, function () {
                            //hide the modal close btn
                            // $('#modal-close-btn').addClass('hide');
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            listenForEmployeeList($('.modal-popup-content'));
                            $('#modal-collaborator-group-employees-selection').attr('data-group-id', getGroupId);
                            $('#modal-collaborator-group-employees-selection').attr('data-notification-id', getNotificationId);
                            $('#modal-collaborator-group-employees-selection').attr('data-receiver-business-id', getReceiverBusinessId)
                            $('#modal-collaborator-group-employees-selection').attr('data-sender-business-id', getSenderBusinessId)
                            $('#modal-collaborator-group-employees-selection').attr('data-customer-identifier-id', customerIdentifierId);
                            // Materialize.toast(`Successfully Accepted`, 3000, "round error-alert");
                            // $(this).parents(`.business-notification-list-wrapper`).remove();
                            removeLoader();
                        });
                    }, 'page/collaborator/employee_selection_list', '#employee-selection-list-template', EmployeeList);
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`Cannot accept the business if there is no employees in your business.`, 3000, 'round success-alert');
                })
        }
    });

    //reject business notification
    $(document).on('click', '#business-notification-reject-btn', function () {
        addLoader();
        var getNotificationId = $(this).parents('.accept_reject_wrap').attr('data-notification-id');
        var getReceiverBusinessId = $(this).parents('.accept_reject_wrap').attr('data-receiver-business-id');
        var getSenderBusinessId = $(this).parents('.accept_reject_wrap').attr('data-sender-business-id');
        var reqparams = {
            device_id: crossplat.device.uuid,
            notification_id: getNotificationId,
            business_id: getReceiverBusinessId,
            collaborator_business_id: getSenderBusinessId,
            action: "rejected"
        }
        businessNotificationChangeStatus(reqparams)
            .then((response) => {
                //console.log("businessNotificationChangeStatus", response);
                // if (response.type == "collaborator_contact_list" && response.contact.status.status == "rejected") {
                Materialize.toast(`Successfully Rejected`, 3000, "round error-alert");
                $(this).parents(`.business-notification-list-wrapper`).remove();
                removeLoader();
                // } 
            })
            .catch((err) => {
                //console.log("error in accepting the notification");
                removeLoader();
            })
    });

    //resent collaborator contact list notification
    $(document).on('click', '#resent-collaborator-contact-notification', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "collaborator_contact_list",
            add_type: "resend",
            receiver_business_id: sessionStorage.getItem('collaborator_business_id'),
            requestor_business_id: sessionStorage.getItem('business_id'),
        }
        businessNotificationAdd(reqParam)
            .then((response) => {
                //console.log("businessNotificationAdd response", response);
                Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                location.hash = `collaborator/contact/list`;
            })
            .catch((err) => {
                //console.log("notificationAdd error", err);
                Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                removeLoader();
            });
    });

    $(document).on('click', '#add-collaborator-group-selected-employees', function () {
        addLoader();
        var getGroupID = $('#modal-collaborator-group-employees-selection').attr('data-group-id');
        var getNotificationId = $('#modal-collaborator-group-employees-selection').attr('data-notification-id');
        var getReceiverBusinessId = $('#modal-collaborator-group-employees-selection').attr('data-receiver-business-id');
        let selectedmembers = [];
        $.each($('.collaborator-group-employee-select-btn:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).attr('data-dj-unique-employee-id'),
                business_id: sessionStorage.getItem('business_id'),
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        if (selectedmembers.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: getGroupID,
                members: contactlist
            }
            groupMemberAdd(requestParams)
                .then((result) => {
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        notification_id: getNotificationId,
                        business_id: getReceiverBusinessId,
                        action: "accepted"
                    }
                    businessNotificationChangeStatus(reqparams)
                        .then((response) => {
                            // Materialize.toast("Members Added Successfully", 3000, 'round success-alert');                
                            Materialize.toast(`Successfully Accepted Notification.`, 3000, "round error-alert");
                            $('#modal-collaborator-group-employees-selection').remove();
                            $(`.accept_reject_wrap[data-notification-id="${getNotificationId}"]`).parents(`.business-notification-list-wrapper`).remove();
                            removeLoader();
                        })
                        .catch((err) => {
                            //console.log("error in accepting the notification");
                            Materialize.toast("Error in accepting the business.", 3000, 'round success-alert');
                            removeLoader();
                        })
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast("Error in members adding", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
            Materialize.toast("Please add employees.", 3000, 'round success-alert');
        }
    });

    //collaboration group button click
    $(document).on('click', '.collaborator-groups', function () {
        addLoader();
        location.hash = `collaborator/groups/list`;
    });

    //create collaborator group
    $(document).on('click', '#create-collaborator-group', function () {
        addLoader();
        location.hash = `collaborator/group/create`;
    });

    //create collaborator group cancel icon
    $(document).on('click', '#collaborator_group_cancel_button', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                data: {
                    socket_enable_status: "true",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeGroupUpdate(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('group_id');
                    location.hash = `collaborator/groups/list`;
                    appScroll.scrollBar("#main-container").destroy();
                }).catch((err) => {
                    console.log('err', err);
                })
        } else {
            sessionStorage.removeItem('group_id');
            location.hash = `collaborator/groups/list`;
        }
    });

    //add collaborator group, owner business's employees button
    $(document).on('click', '#add_group_owner_business_employees', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",//list_unassigned_active
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        employeeList(reqParam)
            .then((response) => {
                //console.log("employeeList response", response);
                let unique_member = [];
                $.each(response, function (index, value) {
                    unique_member.push(value);
                });
                //console.log("unique_member", unique_member);
                digibiz.collaborator_group_owner_employee_members = response;
                digibiz.employee_list = response;
                $.each($("input[name='selectedmembers[]']"), function (index, element) {
                    //console.log("checkvalue", $(element).val())
                    // unique_member = unique_member.filter(function (e) {
                    //     return e.dj_unique_employee_id != $(element).val();
                    // });
                });
                var EmployeeList = {
                    EmployeeList: unique_member.map(e => {
                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                            // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                            //console.log("1234");
                            var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            if (e.hasOwnProperty('display_name') && e.display_name) {
                                e['imageLetter'] = e.display_name.charAt(0);
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                            // } else {
                            //     if (e.hasOwnProperty('display_name') && e.display_name) {
                            //         e['imageLetter'] = e.display_name.charAt(0);
                            //     } else {
                            //         e['imageLetter'] = e.name.first.charAt(0);
                            //     }
                            // }
                        } else {
                            if (e.hasOwnProperty('display_name') && e.display_name) {
                                e['imageLetter'] = e.display_name.charAt(0);
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                        }
                        return e;
                    })
                }
                //console.log("EmployeeList", EmployeeList);
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "modal-collaborator-group-owner-business-employee-selection",
                        modal_header: "Employee List",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-collaborator-group-owner-business-selected-employees-group",
                        }]
                    }
                    showModal(modal_data, function () {
                        //add search element
                        $('.employee-selection-member-list').prepend(`<div class="search">
                                <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                    <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                </div>
                            </div>`);
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        removeLoader();
                        setTimeout(function () {
                            listenForEmployeeList($(".modal-popup-content"));
                            var element = $('#employee-list-selection-search-btn').find('.expand-search-input');
                            if (element) {
                                //console.log('element22', element);
                                //if element is there
                                $(document).on('input', element, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element.attr("socketid");
                                    keyword = element.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword
                                        };
                                        switch (currentroute) {
                                            case 'collaborator_group_create':
                                                // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-collaborator-group-owner-business-employee-selection').length > 0) {
                                                    // if (sessionStorage.getItem('group_from') == "employee_list") {
                                                    data['index'] = 'getEmployeeContactListAllEmployees';
                                                    data['business_id'] = sessionStorage.getItem('business_id')
                                                    // }
                                                }
                                                // }
                                                break;
                                            default:
                                                break;
                                        }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'collaborator_group_create':
                                                // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-collaborator-group-owner-business-employee-selection').length > 0) {
                                                    //console.log("ERROR", unique_member)
                                                    processSearchedEmployeeGroupEmployeeSelectionList(unique_member, function () { })
                                                }
                                                // }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                        if ($('#modal-employee-selection').length > 0) {
                                            //console.log("CLOSED", unique_member)
                                            processSearchedEmployeeGroupEmployeeSelectionList(unique_member, function () { })
                                        }
                                    }
                                })
                            }
                        }, 0);
                    });
                }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);

            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
            })
    });



    //on change of selected members
    $(document).on('change', 'input[name="selectedmembers[]"]', function () {
        console.log('ccommm', $(this).val());
        if ($('body').attr('app') == "collaborator_group_create") {
            if ($(this).hasClass('collaborator-group-owner-business-employee-member')) {
                var dj_unique_employee_id = $(this).val();
                var index = digibiz.collaborator_group_owner_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
                if (index != -1) {
                    if ($(this).is(':checked')) {
                        digibiz.collaborator_group_owner_employee_members[index]['selected'] = true;
                    } else {
                        digibiz.collaborator_group_owner_employee_members[index]['selected'] = false;
                    }
                }
                var index1 = digibiz.selectedMembers.findIndex(e => e.id == dj_unique_employee_id);
                if (index1 != -1) {
                    if ($(this).is(':checked')) {
                        digibiz.selectedMembers[index1].selected = false;
                    } else {
                        digibiz.selectedMembers[index1].selected = false;
                    }
                }
                //check if moderator is choosed of this employee and then uncheck it if selected
                if ($(`.collaborator-group-employee-moderator-member[value="${dj_unique_employee_id}"]:checked`).length > 0) {
                    $(`.collaborator-group-employee-moderator-member[value="${dj_unique_employee_id}"]`).prop('checked', false);
                }
            } else if ($(this).hasClass('contactlists')) {
                var dj_unique_employee_id = $(this).attr('data-dj-unique-employee-id');
                console.log('dj_unique_employee_id', dj_unique_employee_id);
                var index1 = digibiz.selectedMembers.findIndex(e => e.id == dj_unique_employee_id);
                if (index1 != -1) {
                    if ($(this).is(':checked')) {
                        digibiz.selectedMembers[index1].selected = false;
                    } else {
                        digibiz.selectedMembers[index1].selected = false;
                    }
                }
            }
        } else {
            if (sessionStorage.getItem('group_from') == "employee_list") {
                var dj_unique_employee_id = $(this).val();
                var index = digibiz.employee_group_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
                if (index != -1) {
                    if ($(this).is(':checked')) {
                        digibiz.employee_group_employee_members[index]['selected'] = true;
                    } else {
                        digibiz.employee_group_employee_members[index]['selected'] = false;
                    }
                }
                var index1 = digibiz.selectedMembers.findIndex(e => e.id == dj_unique_employee_id);
                if (index1 != -1) {
                    if ($(this).is(':checked')) {
                        digibiz.selectedMembers[index1].selected = false;
                    } else {
                        digibiz.selectedMembers[index1].selected = false;
                    }
                }
            } else if (sessionStorage.getItem('group_from') == "department_list") {
                var getDepartmentId = $(this).val();
                if ($(this).is(':checked')) {
                    digibiz.employee_group_department_members.push({
                        "id": getDepartmentId
                    })
                } else {
                    digibiz.employee_group_department_members = digibiz.employee_group_department_members.filter((e) => {
                        return e.id != getDepartmentId;
                    });
                }
                var index1 = digibiz.selectedMembers.findIndex(e => e.id == getDepartmentId);
                if (index1 != -1) {
                    digibiz.selectedMembers[index1].selected = false;
                }
            } else if (sessionStorage.getItem('group_from') == "contact_list") {
                var id = $(this).val();
                console.log('id', id);
                var index1 = digibiz.selectedMembers.findIndex(e => e.id == id);
                if (index1 != -1) {
                    if ($(this).is(':checked')) {
                        digibiz.selectedMembers[index1].selected = false;
                    } else {
                        digibiz.selectedMembers[index1].selected = false;
                    }
                }
            }
        }
    });

    //add collaborator group owner business employee data
    $(document).on('click', '#add-collaborator-group-owner-business-selected-employees-group', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            let selectedmembers = [];
            $.each($('.employee-select-btn:checked'), function (index, element) {
                selectedmembers.push({
                    id: $(element).attr('data-dj-unique-employee-id'),
                    business_id: sessionStorage.getItem('business_id')
                });
            });
            var contactlist = uniqueArray(selectedmembers);
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                members: contactlist
            }
            groupMemberAdd(requestParams)
                .then((result) => {
                    removeLoader();
                    $('#modal-collaborator-group-owner-business-employee-selection').remove();
                    Materialize.toast("Successfully added members.", 3000, 'round success-alert');
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                })
        } else {
            if ($('.employee-select-btn:checked').length > 0) {
                $.each($('.employee-select-btn:checked'), function (index, element) {
                    var getDJUniqueEmployeeId = $(element).attr('data-dj-unique-employee-id');
                    var getEmployeeName = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text();
                    var getDesignationName = $(element).parents('.employee-selection-list-container').find('.employee-information').text();
                    var getEmployeeNameImageLetter = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                    //console.log("getEmployeeName", getEmployeeName);
                    if (getDJUniqueEmployeeId != undefined) {
                        var template = `<div class="tooltipped collaborator-group-employee-member-wrapper member-listing-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in collaborator-group-owner-business-employee-member" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getEmployeeNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span>
                 <span class="truncate">${getDesignationName}</span></div>
            </div>`;

                        $('#modal-collaborator-group-owner-business-employee-selection').remove();

                        var index = digibiz.selectedMembers.findIndex(e => e.id == $(element).attr('data-dj-unique-employee-id'));
                        if (index == -1) {
                            $('#collaborator-group-owner-business-employees-list').append(template);
                            var selectedmembers = {
                                id: getDJUniqueEmployeeId,
                                name: getEmployeeName,
                                imageLetter: getEmployeeNameImageLetter,
                                dj_unique_employee_id: getDJUniqueEmployeeId,
                                selected: true,
                                type: "employee_list"
                            }
                            digibiz.selectedMembers.push(selectedmembers);
                        }
                        setTimeout(() => {
                            appScroll.scrollBar("#collaborator-group-owner-business-employees-list");
                        }, 500)
                    } else {
                        removeLoader();
                        //console.log("Dj unique employee id is undefined")
                    }
                })
                removeLoader();
            } else {
                removeLoader();
                Materialize.toast(`Please select atleast 1 employee.`, 3000, 'round success-alert');
            }
        }
    });

    //add collaborator group members business(collaborated businesses)
    $(document).on('click', '#add_collaborator_group_business_btn', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "my_collaborators",
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        collaboratorList(reqParam)
            .then((response) => {
                //console.log("collaboratorList response", response);
                let unique_collaborator_contact_list = [];
                $.each(response, function (index, value) {
                    unique_collaborator_contact_list.push(value);
                });
                // //console.log("unique_collaborator_contact_list", unique_collaborator_contact_list);
                digibiz.collaborator_contact_list = response;
                $.each($("input[name='selectedcollaboratorcontact[]']"), function (index, element) {
                    // //console.log("checkvalue", $(element).val())
                    unique_collaborator_contact_list = unique_collaborator_contact_list.filter(function (e) {
                        return e.id != $(element).val();
                    });
                });
                $.each($('.collaborator-group-business-member-wrapper'), function (index, elem) {
                    // //console.log("elem", elem)
                    unique_collaborator_contact_list = unique_collaborator_contact_list.filter(function (e) {
                        return e.business_id != $(elem).attr('data-business-id');
                    });
                })
                var collaboratorContactList = {
                    collaboratorContactList: digibiz.collaborator_contact_list.map(e => {
                        // collaboratorContactList: unique_collaborator_contact_list.map(e => {
                        if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                            if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                                // //console.log("1234");
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                                e.business_display_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.business_name.charAt(0);
                            } else {
                                e['imageLetter'] = e.business_name.charAt(0);
                            }
                        } else {
                            e['imageLetter'] = e.business_name.charAt(0);
                        }
                        return e;
                    })
                }
                //console.log("collaboratorContactList", collaboratorContactList);
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "modal-collaborator-group-contact-list-selection",
                        modal_header: "Collaborator Contact List",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-collaborator-group-contact-list-selected",
                        }]
                    }
                    showModal(modal_data, function () {
                        //add search element
                        $('.collaborator-contact-selection-list-main-container').prepend(`<div class="search"><div class="expand-search-wrap search-wrapper" id="collaborator-contact-selection-list-search-btn">
                             <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                             <span class="searchclosebtn"><i class="material-icons collaborator-contact-selection-list-close-btn hide">close</i></span>
                         </div></div>`);
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        removeLoader();
                        setTimeout(function () {
                            listenForCollaboratorGroupContactListScrollEvent($(".modal-popup-content"));
                            var element = $('#collaborator-contact-selection-list-search-btn').find('.expand-search-input');
                            if (element) {
                                //console.log('element22', element);
                                //if element is there
                                $(document).on('input', element, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element.attr("socketid");
                                    keyword = element.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword
                                        };
                                        switch (currentroute) {
                                            case 'collaborator_group_create':
                                                // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-collaborator-group-contact-list-selection').length > 0) {
                                                    // if (sessionStorage.getItem('group_from') == "employee_list") {
                                                    data['index'] = 'getActiveCollaboratorListPage';
                                                    data['business_id'] = sessionStorage.getItem('business_id')
                                                    // }
                                                }
                                                // }
                                                break;
                                            default:
                                                break;
                                        }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'collaborator_group_create':
                                                // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-collaborator-group-contact-list-selection').length > 0) {
                                                    //console.log("ERROR", unique_member)
                                                    processActiveCollaboratorContactList(unique_collaborator_contact_list, function () { })
                                                }
                                                // }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    if ($('#modal-collaborator-group-contact-list-selection').length > 0) {
                                        //console.log("CLOSED", unique_member)
                                        processActiveCollaboratorContactList(unique_collaborator_contact_list, function () {
                                        });
                                    }
                                })
                            }
                        }, 0);
                    });
                }, 'page/collaborator/contact_list_selection', '#collaborator-contact-selection-list-template', collaboratorContactList);

            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Contacts Found`, 3000, 'round success-alert');
            })
    });
    // $(document).on('click', '#add_collaborator_group_business_btn', function () {
    //     addLoader();
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         list_by: "my_collaborators",
    //         business_id: sessionStorage.getItem('business_id')
    //     }
    //     collaboratorList(reqParam)
    //         .then((response) => {
    //             //console.log("collaboratorList response", response);
    //             let unique_collaborator_contact_list = [];
    //             $.each(response, function (index, value) {
    //                 unique_collaborator_contact_list.push(value);
    //             });
    //             // //console.log("unique_collaborator_contact_list", unique_collaborator_contact_list);
    //             digibiz.collaborator_contact_list = response;
    //             $.each($("input[name='selectedcollaboratorcontact[]']"), function (index, element) {
    //                 // //console.log("checkvalue", $(element).val())
    //                 unique_collaborator_contact_list = unique_collaborator_contact_list.filter(function (e) {
    //                     return e.id != $(element).val();
    //                 });
    //             });
    //             $.each($('.collaborator-group-business-member-wrapper'), function (index, elem) {
    //                 // //console.log("elem", elem)
    //                 unique_collaborator_contact_list = unique_collaborator_contact_list.filter(function (e) {
    //                     return e.business_id != $(elem).attr('data-business-id');
    //                 });
    //             })
    //             var collaboratorContactList = {
    //                 collaboratorContactList: unique_collaborator_contact_list.map(e => {
    //                     if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
    //                         if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
    //                             // //console.log("1234");
    //                             var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
    //                             e.business_display_picture['avtarUrl'] = avtarUrl;
    //                         } else {
    //                             e['imageLetter'] = e.business_name.charAt(0);
    //                         }
    //                     } else {
    //                         e['imageLetter'] = e.business_name.charAt(0);
    //                     }
    //                     return e;
    //                 })
    //             }
    //             //console.log("collaboratorContactList", collaboratorContactList);
    //             fetch.getHtml(function (fetcherror, html) {
    //                 var modal_data = {
    //                     modal_id: "modal-collaborator-group-contact-list-selection",
    //                     modal_header: "Collaborator Contact List",
    //                     modal_platform: crossplat.device.platform,
    //                     modal_body: html,
    //                     modal_action_buttons: [{
    //                         "name": "Add",
    //                         "id": "add-collaborator-group-contact-list-selected",
    //                     }]
    //                 }
    //                 showModal(modal_data, function () {
    //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                         if ($('.modal-popup-content').length > 0) {
    //                             //console.log("scroll initiated for modal pop-up class")
    //                             appScroll.scrollBar('.modal-popup-content');
    //                         }
    //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                     } else {
    //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                     }
    //                     removeLoader();
    //                 });
    //             }, 'page/collaborator/contact_list_selection', '#collaborator-contact-selection-list-template', collaboratorContactList);

    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             Materialize.toast(`No Contacts Found`, 3000, 'round success-alert');
    //         })
    // });


    //contact select btn
    $(document).on('change', '.contact-select-btn', function () {
        //console.log("qwer");
        var contact_id = $(this).attr('data-id');
        if ($('body').attr('app') == "collaborator_group_create") {
            var index = digibiz.collaborator_contact_list.findIndex(e => e.id == contact_id);
            if (index != -1) {
                if ($(this).is(':checked')) {
                    digibiz.collaborator_contact_list[index]['selected'] = true;
                } else {
                    digibiz.collaborator_contact_list[index]['selected'] = false;
                }
            }
        }
    });

    //add collaborator contact list selected
    $(document).on('click', '#add-collaborator-group-contact-list-selected', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            //console.log("$%^&$%^&%^&")
            if ($('.contact-select-btn:checked').length > 0) {
                var alert_parms = {
                    alert_id: "alert-collaborator-group-contact-list-selected-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-collaborator-group-contact-list-selected-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-collaborator-group-contact-list-selected-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });


            } else {
                removeLoader();
                Materialize.toast(`Please select atleast 1 business.`, 3000, 'round success-alert');
            }
        } else {//first time group creation
            if ($('.contact-select-btn:checked').length > 0) {
                $.each($('.contact-select-btn:checked'), function (index, element) {
                    var getContactId = $(element).attr('data-id');
                    var getBusinessId = $(element).attr('data-business-id');
                    var getContactName = $(element).parents('.collaborator-contact-selection-list-container').find('.contact-name-wrapper').text();
                    var getContactNameImageLetter = $(element).parents('.collaborator-contact-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                    var getContactImage = $(element).parents('.collaborator-contact-selection-list-container').find('img').attr('src');
                    if (getContactId != undefined) {
                        var template = `<div class="tooltipped collaborator-group-member-wrapper member-listing-wrapper" data-contact-id="${getContactId}" data-business-id="${getBusinessId}"><div class="file-select">
                <input type="checkbox" name="selectedcollaboratorcontact[]" class="contactlists filled-in collaborator-group-business-member" value="${getContactId}" data-business-id="${getBusinessId}" id="selected-${getContactId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getContactNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getContactId}">${getContactName}</span></div>
            </div>`;

                        if ($(`.collaborator-group-member-wrapper[data-business-id="${getBusinessId}"]`).length == 0) {
                            $('#collaborator-group-members-list').append(template);
                        }
                        $('#modal-collaborator-group-contact-list-selection').remove();
                        setTimeout(() => {
                            appScroll.scrollBar("#collaborator-group-members-list");
                        }, 500)
                    } else {
                        removeLoader();
                        //console.log("collaborator contact id is undefined")
                    }
                })
                removeLoader();
            } else {
                removeLoader();
                Materialize.toast(`Please select atleast 1 business.`, 3000, 'round success-alert');
            }
        }
    });

    $(document).on('click', '#btn-collaborator-group-contact-list-selected-add-confirm-no', function () {
        $('#alert-collaborator-group-contact-list-selected-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-collaborator-group-contact-list-selected-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.contact-select-btn:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).attr('data-business-id')
            });
        });
        var contactlist = uniqueArray(selectedmembers);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            type: "business",
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                // removeLoader();
                // $('#modal-collaborator-group-contact-list-selection').remove();
                // Materialize.toast("Successfully added members.", 3000, 'round success-alert');
                //get the group members(business) and send notification to them
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    group_id: sessionStorage.getItem('group_id'),
                    // business_id: sessionStorage.getItem('business_id')
                }
                groupMemberList(reqParams)
                    .then((resultData) => {
                        var getBusinessData = [];
                        $.each(selectedmembers, function (ind, element) {
                            $.each(resultData, function (index, elem) {//get only now added businesses
                                if (elem.type == "business" && elem.member.business_id == element.id) {
                                    getBusinessData.push({
                                        id: elem.member.business_id,
                                        group_member_id: elem.id,
                                    })
                                }
                            });
                        })
                        setTimeout(function () {
                            var reqParms = {
                                device_id: crossplat.device.uuid,
                                type: "collaborator_group",
                                group_id: sessionStorage.getItem('group_id'),
                                requestor_business_id: sessionStorage.getItem('business_id'),
                                receiver_business_ids: getBusinessData
                            }
                            businessNotificationAdd(reqParms)
                                .then((result) => {
                                    removeLoader();
                                    $('#alert-collaborator-group-contact-list-selected-add-confirm-cancel').remove();
                                    $('#modal-collaborator-group-contact-list-selection').remove();
                                    Materialize.toast("Successfully added members.", 3000, 'round success-alert');
                                    getCollaboratorGroupDetailsPage();
                                    // Materialize.toast(`Group created successfully.`, 3000, "round success-alert");
                                    // location.hash = `collaborator/groups/list`;                                            
                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                                })
                        }, 500);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })

    //on change of selectedcollaboratorcontact
    $(document).on('change', 'input[name="selectedcollaboratorcontact[]"]', function () {
        if ($('body').attr('app') == "collaborator_group_create") {
            var contact_id = $(this).val();
            var index = digibiz.collaborator_contact_list.findIndex(e => e.id == contact_id);
            if (index != -1) {
                if ($(this).is(':checked')) {
                    digibiz.collaborator_contact_list[index]['selected'] = true;
                } else {
                    digibiz.collaborator_contact_list[index]['selected'] = false;
                }
            }
        }
    });


    //create collaborator group
    $(document).on('click', '#collaborator_group_add_button', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        if (validateCollaboratorGroup()) {
            var getGroupName = $('#collaboratorGroupName').val().trim();
            var getGroupDescription = $('#collaborator_group_desc').val().trim();
            // var getGroupActiveWhen = $('#select-group-active-when').val();
            var getGroupActiveWhen = $('.selected-value-group-active-when').attr('data-value')
            if (sessionStorage.getItem('group_id')) {
                // saveGroupPicture(function (err, identityResponse) {
                //     if (err) {
                //         removeLoader();
                //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                //     } else {
                //         var resultData = identityResponse;
                //         //console.log("resultData", resultData);
                //         var groupPictureData = {};
                //         if (resultData != undefined) {
                //             groupPictureData = {
                //                 asset_id: resultData.Data.asset_id,
                //                 storage_id: resultData.Data.filename
                //             }
                //         }
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('group_id'),
                    data: {
                        name: firstLetterUpperCase(getGroupName),
                        description: firstLetterUpperCase(getGroupDescription),
                        // group_image: groupPictureData,
                        group_active_by: getGroupActiveWhen,
                    }
                }
                employeeGroupUpdate(reqparams)
                    .then((response) => {
                        //console.log("employeeGroupUpdate sucess", response);
                        sessionStorage.removeItem('group_id');
                        location.hash = `collaborator/groups/list`;
                    })
                    .catch((err) => {
                        //console.log("employeeGroupUpdate err", err);
                        if (err.msg == "no updated data found") {
                            sessionStorage.removeItem('group_id');
                            location.hash = `collaborator/groups/list`;
                        } else {
                            removeLoader();
                        }
                    })
                //     }
                // })
            } else {//first time saving/creating
                let selectedmembers = [], selectedbusinesses = [], moderatorData = [];
                $.each($("input.collaborator-group-owner-business-employee-member:checked"), function (index, element) {
                    selectedmembers.push({
                        id: $(element).attr('value'),
                        type: "employee"
                    });
                });
                $.each($("input.collaborator-group-business-member:checked"), function (index, element) {
                    selectedbusinesses.push({
                        id: $(element).attr('data-business-id')
                    });
                });
                $.each($("input.collaborator-group-employee-moderator-member:checked"), function (index, element) {
                    moderatorData.push({
                        id: $(element).attr('value'),
                        type: "employee",
                        business_id: sessionStorage.getItem('business_id'),
                        status: "active"
                    });
                });
                var membersList = removeDuplicates(selectedmembers, 'id');
                //console.log("membersList", membersList);
                var businessList = removeDuplicates(selectedbusinesses, 'id');
                //console.log("businessList", businessList);
                var moderatorList = removeDuplicates(moderatorData, 'id');
                //console.log("moderatorList", moderatorList);
                //save identity-pic
                saveGroupPictureFirstTime(function (err, identityResponse) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        // var resultData = identityResponse;
                        // //console.log("resultData", resultData);
                        // var groupImageData = {};
                        // if (resultData != undefined) {
                        //     groupImageData = {
                        //         asset_id: resultData.Data.asset_id,
                        //         storage_id: resultData.Data.filename
                        //     }
                        // }
                        let requestParams = {
                            device_id: crossplat.device.uuid,
                            name: firstLetterUpperCase(getGroupName),
                            description: firstLetterUpperCase(getGroupDescription),
                            thumbnail_content: identityResponse,
                            size: digibiz.groupPictureblob.size,
                            group_for: "collaborator",
                            business_id: sessionStorage.getItem('business_id'),
                            group_active_by: getGroupActiveWhen,
                            members: membersList,
                            businesses: businessList,
                            moderator_data: moderatorList
                        }
                        groupAdd(requestParams)
                            .then((response) => {
                                //console.log("success in groupAdd", response);
                                //get the group members(business) and send notification to them
                                var moderatorRequestParams = {
                                    device_id: crossplat.device.uuid,
                                    id: response.id,
                                    moderator_data: moderatorList
                                }
                                groupModeratorAdd(moderatorRequestParams)
                                    .then((moderatorResponse) => {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            group_id: response.id,
                                            // business_id: sessionStorage.getItem('business_id')
                                        }
                                        groupMemberList(reqParams)
                                            .then((resultData) => {
                                                var getBusinessData = [];
                                                $.each(resultData, function (index, elem) {//remove creator business data
                                                    if (elem.type == "business" && elem.member.business_id != sessionStorage.getItem('business_id')) {
                                                        getBusinessData.push({
                                                            id: elem.member.business_id,
                                                            group_member_id: elem.id,
                                                        })
                                                    }
                                                })
                                                setTimeout(function () {
                                                    var reqParms = {
                                                        device_id: crossplat.device.uuid,
                                                        type: "collaborator_group",
                                                        group_id: response.id,
                                                        requestor_business_id: sessionStorage.getItem('business_id'),
                                                        receiver_business_ids: getBusinessData
                                                    }
                                                    businessNotificationAdd(reqParms)
                                                        .then((result) => {
                                                            removeLoader();
                                                            digibiz.groupPictureblob = {};
                                                            Materialize.toast(`Group created successfully.`, 3000, "round success-alert");

                                                        })
                                                        .catch((err) => {
                                                            removeLoader();
                                                            Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                                                        })

                                                }, 500);
                                            })
                                            .catch((err) => {
                                                removeLoader();
                                                Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                                            })
                                        location.hash = `collaborator/groups/list`;
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                                    })
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                            })
                    }
                })

            }
        } else {
            removeLoader();
        }
    });


    $(document).on('click', '.role-assignmant-management', function () {
        addLoader();
        location.hash = `role_management/employee_list`;
    });

    $(document).on('click', '.role_management_employee_data', function () {
        addLoader();
        var employee_id = $(this).parents('.role_management_employee_wrapper').attr('data-employee-id');
        sessionStorage.setItem('employee_id', employee_id);
        location.hash = `role_management/employee/apps_access_list`;
    });

    $(document).on('click', '#employee_role_assignment_btn, #customer_role_assignment_btn', function () {//add_new_role_assignment
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_id: "employee-role-assignment-modal",
                modal_header: "Role Assignment",
                modal_platform: crossplat.device.platform,
                modal_body: html,
                modal_action_buttons: [{
                    "name": "Back",
                    "id": "employee_role_assignment_back_btn",
                    "class": "hide"
                },
                {
                    "name": "Next",
                    "id": "employee_role_assignment_next_btn",
                    "class": "hide"
                },
                {
                    "name": "Save",
                    "id": "employee_role_assignment_save_btn",
                    "class": "hide"
                },
                {
                    "name": "Confirm",
                    "id": "employee_role_assignment_confirm_btn",
                    "class": "hide"
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if (sessionStorage.getItem('customer_id')) {
                    $('#role-assignment-app-choose-select-dropdown').find(`option[value="digibiz"]`).addClass('hide');
                }
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
            });
        }, 'page/role_management/role_assignment_modal', '#role-assignment-template', null);
    });

    $(document).on('change', '#role-assignment-app-choose-select-dropdown', function () {
        if ($(this).val() == "digibiz") {
            $('#employee_role_assignment_confirm_btn').addClass('hide');
            $('#employee_role_assignment_next_btn').removeClass('hide');
        } else if ($(this).val() == "bizchat") {
            $('#employee_role_assignment_confirm_btn').addClass('hide');
            $('#employee_role_assignment_next_btn').removeClass('hide');
        } else if ($(this).val() == "bizvoiceit") {
            $('#employee_role_assignment_confirm_btn').addClass('hide');
            $('#employee_role_assignment_next_btn').removeClass('hide');
        }
    });

    $(document).on('click', '#role-assignment-app-choose-select-dropdown .custom-dropdown li', function () {
        //console.log("111")
        if ($('.selected-value-role-assignment-app').attr('data-value').length > 0) {
            var getValue = $('.selected-value-role-assignment-app').attr('data-value');
            //console.log("getValue", getValue)
            if (getValue == "digibiz") {
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                $('#employee_role_assignment_next_btn').removeClass('hide');
            } else if (getValue == "bizchat") {
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                $('#employee_role_assignment_next_btn').removeClass('hide');
            } else if (getValue == "bizvoiceit") {
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                $('#employee_role_assignment_next_btn').removeClass('hide');
            }
        }
    });

    //role management confirm button
    $(document).on('click', '#employee_role_assignment_confirm_btn', function () {
        addLoader();
        var getAppValue = $('.selected-value-role-assignment-app').attr('data-value');
        //console.log("getAppValue", getAppValue)
        // if ($('#role-assignment-app-choose-select-dropdown').val() == "bizchat") {
        if (getAppValue == "bizchat") {
            var reqparams;
            if (sessionStorage.getItem('employee_id')) {
                reqparams = {
                    device_id: crossplat.device.uuid,
                    type: "employee",
                    member_id: sessionStorage.getItem('employee_id'),
                    business_id: sessionStorage.getItem('business_id'),
                    // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                    app_name: getAppValue,
                    access_data: {
                        app_access: "true"
                    }
                }
            } else if (sessionStorage.getItem('customer_id')) {
                reqparams = {
                    device_id: crossplat.device.uuid,
                    type: "customer",
                    member_id: sessionStorage.getItem('customer_id'),
                    business_id: sessionStorage.getItem('business_id'),
                    // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                    app_name: getAppValue,
                    access_data: {
                        app_access: "true"
                    }
                }
            }
            roleManagementAdd(reqparams)
                .then((response) => {
                    //console.log("roleManagementAdd", response);
                    $('#employee-role-assignment-modal').remove();
                    Materialize.toast(`Successfully added`, 3000, "round success-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
        } else
            // if ($('#role-assignment-app-choose-select-dropdown').val() == "bizvoiceit") {
            if (getAppValue == "bizvoiceit") {
                //check which step is active
                var getStepNumber = $('.role-assignment-select-app.active').attr('data-step');
                if (getStepNumber != undefined || getStepNumber != null || getStepNumber != "") {
                    if (getStepNumber == "2") {
                        //set in the session and global variable
                        digibiz.role_assignment = {
                            app_access: "true",
                            create_respond_access: $('input[name="create_respond_app_access"]:checked').attr('data-id')
                        }
                        var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                        getRoleAssignmentSession.create_respond_access = $('input[name="create_respond_app_access"]:checked').attr('data-id');
                        sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                        if (sessionStorage.getItem('edit_role')) {
                            var reqparams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('edit_role'),
                                data: {
                                    access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                }
                            }
                            roleManagementUpdate(reqparams)
                                .then((response) => {
                                    //console.log("roleManagementUpdate", response);
                                    digibiz.role_assignment = {};
                                    sessionStorage.removeItem('role_assignment');
                                    sessionStorage.removeItem('edit_role');
                                    $('#employee-role-assignment-modal').remove();
                                    Materialize.toast(`Successfully updated`, 3000, "round success-alert");
                                    removeLoader();
                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast(err.msg, 3000, "round error-alert");
                                })
                        } else {
                            var reqparams = {};
                            if (sessionStorage.getItem('employee_id')) {
                                reqparams = {
                                    device_id: crossplat.device.uuid,
                                    type: "employee",
                                    member_id: sessionStorage.getItem('employee_id'),
                                    business_id: sessionStorage.getItem('business_id'),
                                    // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                                    app_name: getAppValue,
                                    access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                }
                            } else if (sessionStorage.getItem('customer_id')) {
                                reqparams = {
                                    device_id: crossplat.device.uuid,
                                    type: "customer",
                                    member_id: sessionStorage.getItem('customer_id'),
                                    business_id: sessionStorage.getItem('business_id'),
                                    // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                                    app_name: getAppValue,
                                    access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                }
                            }
                            roleManagementAdd(reqparams)
                                .then((response) => {
                                    //console.log("roleManagementAdd", response);
                                    digibiz.role_assignment = {};
                                    sessionStorage.removeItem('role_assignment');
                                    $('#employee-role-assignment-modal').remove();
                                    Materialize.toast(`Successfully added`, 3000, "round success-alert");
                                    removeLoader();
                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast(err.msg, 3000, "round error-alert");
                                })
                        }
                    } else if (getStepNumber == "5") {
                        var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                        if (getRoleAssignmentSession.share_type_mode == "common") {
                            //prepare checked checkbox share group access
                            var group_access_data = [];
                            var getCheckedCommonCheckbox = $(`.role-assignment-app-share-type-group-access-contentbox[data-type="common"]`).find('input.bizvoiceit-share-type-group-app-access:checked');
                            if ($(getCheckedCommonCheckbox).length > 0) {
                                $.each($(getCheckedCommonCheckbox), function (index, element) {
                                    group_access_data.push($(element).attr('data-id'));
                                });
                            }
                            //push inside each sub_app_access_data
                            $.each(getRoleAssignmentSession.sub_app_access_data, function (index, elem) {
                                elem.share_types = group_access_data;
                            });
                            sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                            if (sessionStorage.getItem('edit_role')) {
                                var reqparams = {
                                    device_id: crossplat.device.uuid,
                                    id: sessionStorage.getItem('edit_role'),
                                    data: {
                                        access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                    }
                                }
                                roleManagementUpdate(reqparams)
                                    .then((response) => {
                                        //console.log("roleManagementUpdate", response);
                                        digibiz.role_assignment = {};
                                        sessionStorage.removeItem('role_assignment');
                                        sessionStorage.removeItem('edit_role');
                                        $('#employee-role-assignment-modal').remove();
                                        Materialize.toast(`Successfully updated`, 3000, "round success-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            } else {
                                var reqparams = {};
                                if (sessionStorage.getItem('employee_id')) {
                                    reqparams = {
                                        device_id: crossplat.device.uuid,
                                        type: "employee",
                                        member_id: sessionStorage.getItem('employee_id'),
                                        business_id: sessionStorage.getItem('business_id'),
                                        // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                                        app_name: getAppValue,
                                        access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                    }
                                } else if (sessionStorage.getItem('customer_id')) {
                                    reqparams = {
                                        device_id: crossplat.device.uuid,
                                        type: "customer",
                                        member_id: sessionStorage.getItem('customer_id'),
                                        business_id: sessionStorage.getItem('business_id'),
                                        // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                                        app_name: getAppValue,
                                        access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                    }
                                }
                                roleManagementAdd(reqparams)
                                    .then((response) => {
                                        //console.log("roleManagementAdd", response);
                                        digibiz.role_assignment = {};
                                        sessionStorage.removeItem('role_assignment');
                                        $('#employee-role-assignment-modal').remove();
                                        Materialize.toast(`Successfully added`, 3000, "round success-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            }

                        } else if (getRoleAssignmentSession.share_type_mode == "custom") {
                            //loop sub_app_access and store which all group access is given for that sub_app
                            $.each(getRoleAssignmentSession.sub_app_access_data, function (index, elem) {
                                var group_access_data = [];
                                var getCheckedCheckbox = $(`.role-assignment-app-share-type-group-access-contentbox[data-type="custom"]`).find(`.role-assignment-app-share-type-group-access-wrapper[data-app="${elem.sub_app}"]`).find('input.bizvoiceit-share-type-group-app-access:checked');
                                if ($(getCheckedCheckbox).length > 0) {
                                    $.each($(getCheckedCheckbox), function (index, element) {
                                        group_access_data.push($(element).attr('data-id'));
                                    });
                                    elem.share_types = group_access_data;
                                }
                            });
                            sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                            if (sessionStorage.getItem('edit_role')) {
                                var reqparams = {
                                    device_id: crossplat.device.uuid,
                                    id: sessionStorage.getItem('edit_role'),
                                    data: {
                                        access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                    }
                                }
                                roleManagementUpdate(reqparams)
                                    .then((response) => {
                                        //console.log("roleManagementUpdate", response);
                                        digibiz.role_assignment = {};
                                        sessionStorage.removeItem('role_assignment');
                                        sessionStorage.removeItem('edit_role');
                                        $('#employee-role-assignment-modal').remove();
                                        Materialize.toast(`Successfully updated`, 3000, "round success-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            } else {
                                var reqparams = {};
                                if (sessionStorage.getItem('employee_id')) {
                                    reqparams = {
                                        device_id: crossplat.device.uuid,
                                        type: "employee",
                                        member_id: sessionStorage.getItem('employee_id'),
                                        business_id: sessionStorage.getItem('business_id'),
                                        // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                                        app_name: getAppValue,
                                        access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                    }
                                } else if (sessionStorage.getItem('customer_id')) {
                                    reqparams = {
                                        device_id: crossplat.device.uuid,
                                        type: "customer",
                                        member_id: sessionStorage.getItem('customer_id'),
                                        business_id: sessionStorage.getItem('business_id'),
                                        // app_name: $('#role-assignment-app-choose-select-dropdown').val(),
                                        app_name: getAppValue,
                                        access_data: JSON.parse(sessionStorage.getItem("role_assignment"))
                                    }
                                }
                                roleManagementAdd(reqparams)
                                    .then((response) => {
                                        //console.log("roleManagementAdd", response);
                                        digibiz.role_assignment = {};
                                        sessionStorage.removeItem('role_assignment');
                                        $('#employee-role-assignment-modal').remove();
                                        Materialize.toast(`Successfully added`, 3000, "round success-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            }
                        }
                    }
                } else {
                    removeLoader();
                    Materialize.toast(`Error in getting step`, 3000, "round error-alert");
                }
            } else
                // if ($('#role-assignment-app-choose-select-dropdown').val() == "digibiz") {
                if (getAppValue == "digibiz") {
                    var getStepNumber = $('.role-assignment-select-app.active').attr('data-step');
                    if (getStepNumber != undefined || getStepNumber != null || getStepNumber != "") {
                        if (getStepNumber == "6") {
                            var getSelectedData = $('input[name="digibiz_module_admin_access"]:checked').attr('data-id');
                            var reqparams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                type: getSelectedData,
                                employee_id: $('#employee-role-assignment-modal').attr('data-employee-id'),
                                // performer_id: sessionStorage.getItem('user_id'),
                                // performer_type: "individual"
                            }
                            if (sessionStorage.getItem('delete_module_admin') == "true") {
                                reqparams.delete_module_admin = "true"
                            }
                            businessOwnerAdd(reqparams)
                                .then((response) => {
                                    //console.log("businessOwnerAdd", response);
                                    digibiz.alreadyModuleAdmin = response;
                                    sessionStorage.removeItem('delete_module_admin');
                                    $('#employee-role-assignment-modal').remove();
                                    Materialize.toast(`Successfully added`, 3000, "round success-alert");
                                    removeLoader();
                                })
                                .catch((err) => {
                                    removeLoader();
                                    if (err.msg == "Cannot add! This employee is present as module_admin.") {
                                        var alert_parms = {
                                            alert_id: "alert-digibiz-module-admin-role-present-yes-no",
                                            alert_platform: crossplat.device.platform,
                                            alert_title: `Alert`,
                                            alert_body: `This employee is present as module admin. Module admin access of this employee will removed if this employee is made digibiz admin. Are you sure you want to make him as digibiz-admin?`,
                                            alert_btn: [{
                                                name: "Yes",
                                                attr: [{ name: "id", value: "btn-alert-lert-digibiz-module-admin-role-present-confirm-yes" }]
                                            },
                                            {
                                                name: "No",
                                                attr: [{ name: "id", value: "btn-lert-digibiz-module-admin-role-present-confirm-no" }]
                                            }]
                                        }
                                        showAlert(alert_parms, function () {
                                            removeLoader();
                                        });
                                    } else {
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    }
                                })
                        }
                        if (getStepNumber == "7") {
                            var selected_modules_data = [];
                            var revoked_data = [];
                            //get all checkbox
                            if ($('.digibiz-module-access:checked').length <= 3) {
                                var getCheckboxes = $('.digibiz-module-access');
                                $.each(getCheckboxes, function (index, element) {
                                    if ($(element).is(':checked')) {
                                        var findModuleAdmin = digibiz.alreadyModuleAdmin.find((e) => e.module == $(element).attr('data-id'));
                                        if (findModuleAdmin == undefined) {
                                            selected_modules_data.push({
                                                "name": $(element).attr('data-id')
                                            })
                                        }
                                    }
                                });
                                //check unchecked one's
                                $.each(digibiz.alreadyModuleAdmin, function (index, element) {
                                    var check = $(`.digibiz-module-access[data-id="${element.module}"]`).is(':checked');
                                    if (check == false) {
                                        revoked_data.push(element);
                                    }
                                });
                                if (selected_modules_data.length > 0 || revoked_data.length > 0) {
                                    if (selected_modules_data.length > 0) {
                                        var getSelectedData = $('input[name="digibiz_module_admin_access"]:checked').attr('data-id')
                                        var reqparams = {
                                            device_id: crossplat.device.uuid,
                                            business_id: sessionStorage.getItem('business_id'),
                                            type: getSelectedData,
                                            modules: selected_modules_data,
                                            employee_id: $('#employee-role-assignment-modal').attr('data-employee-id'),
                                            performer_id: sessionStorage.getItem('user_id'),
                                            performer_type: "individual"
                                        }
                                        if (sessionStorage.getItem('delete_module_admin') == "true") {
                                            reqparams.delete_module_admin = "true"
                                        }
                                        businessOwnerAdd(reqparams)
                                            .then((response) => {
                                                //console.log("businessOwnerAdd", response);
                                                digibiz.alreadyModuleAdmin = [];
                                                sessionStorage.removeItem('delete_module_admin');
                                                $('#employee-role-assignment-modal').remove();
                                                Materialize.toast(`Successfully added`, 3000, "round success-alert");
                                                removeLoader();
                                            })
                                            .catch((err) => {
                                                removeLoader();
                                                if (err.msg == "Cannot add! This employee is present as module_admin.") {
                                                    var alert_parms = {
                                                        alert_id: "alert-digibiz-module-admin-role-present-yes-no",
                                                        alert_platform: crossplat.device.platform,
                                                        alert_title: `Alert`,
                                                        alert_body: `This employee is present as module admin. Module admin access of this employee will removed if this employee is made digibiz admin. Are you sure you want to make him as digibiz-admin?`,
                                                        alert_btn: [
                                                            {
                                                                name: "Yes",
                                                                attr: [{ name: "id", value: "btn-alert-lert-digibiz-module-admin-role-present-confirm-yes" }]
                                                            },
                                                            {
                                                                name: "No",
                                                                attr: [{ name: "id", value: "btn-lert-digibiz-module-admin-role-present-confirm-no" }]
                                                            }]
                                                    }
                                                    showAlert(alert_parms, function () {
                                                        removeLoader();
                                                    });
                                                } else {
                                                    Materialize.toast(err.msg, 3000, "round error-alert");
                                                }
                                            })
                                    }
                                    if (revoked_data.length > 0) {
                                        $.each(revoked_data, function (index, element) {
                                            var requesParam = {
                                                device_id: crossplat.device.uuid,
                                                id: element.id
                                            }
                                            businessOwnerDelete(requesParam)
                                                .then((resultData) => {
                                                    //console.log("businessOwnerDelete", resultData);
                                                    digibiz.alreadyModuleAdmin = [];
                                                    sessionStorage.removeItem('delete_module_admin');
                                                    $('#employee-role-assignment-modal').remove();
                                                    Materialize.toast(`Successfully added`, 3000, "round success-alert");
                                                    removeLoader();
                                                })
                                                .catch((err) => {
                                                    removeLoader();
                                                    Materialize.toast(err.msg, 3000, "round error-alert");
                                                })
                                        })
                                    }
                                } else {
                                    Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
                                    removeLoader();
                                }
                            } else {
                                Materialize.toast(`Can select only 3 modules.`, 3000, "round error-alert");
                                removeLoader();
                            }
                        } else {
                            removeLoader();
                        }
                    }
                }
    });


    $(document).on('click', '#btn-lert-digibiz-module-admin-role-present-confirm-no', function () {
        $('#alert-digibiz-module-admin-role-present-yes-no').remove();
        sessionStorage.removeItem('add_business_owner_data');
    });

    $(document).on('click', '#btn-alert-lert-digibiz-module-admin-role-present-confirm-yes', function () {
        var getEmployeeID = $('#alert-digibiz-module-admin-role-present-yes-no').attr('data-employee-id');
        $('#alert-digibiz-module-admin-role-present-yes-no').remove();
        sessionStorage.setItem('delete_module_admin', "true");
        // //console.log("check element", $('#employee_role_assignment_confirm_btn'))
        // $('#employee_role_assignment_confirm_btn').trigger('click');
        var reqparams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "digibiz_admin",
            employee_id: getEmployeeID,
            // performer_id: sessionStorage.getItem('user_id'),
            // performer_type: "individual"
        }
        if (sessionStorage.getItem('delete_module_admin') == "true") {
            reqparams.delete_module_admin = "true"
        }
        businessOwnerAdd(reqparams)
            .then((response) => {
                //console.log("businessOwnerAdd", response);
                digibiz.alreadyModuleAdmin = response;
                sessionStorage.removeItem('delete_module_admin');
                $('#employee-role-assignment-modal').remove();
                $('#modal-digibiz-admin-add-employee-selection').remove();
                Materialize.toast(`Successfully added`, 3000, "round success-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                if (err.msg == "Cannot add! This employee is present as module_admin.") {
                    var alert_parms = {
                        alert_id: "alert-digibiz-module-admin-role-present-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `This employee is present as module admin. Module admin access of this employee will removed if this employee is made digibiz admin. Are you sure you want to make him as digibiz-admin?`,
                        alert_btn: [{
                            name: "Yes",
                            attr: [{ name: "id", value: "btn-alert-lert-digibiz-module-admin-role-present-confirm-yes" }]
                        },
                        {
                            name: "No",
                            attr: [{ name: "id", value: "btn-lert-digibiz-module-admin-role-present-confirm-no" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    Materialize.toast(err.msg, 3000, "round error-alert");
                }
            })
    });

    //role management next button
    $(document).on('click', '#employee_role_assignment_next_btn', function () {
        addLoader();
        //check app
        var getAppValue = $('.selected-value-role-assignment-app').attr('data-value');
        // if ($('#role-assignment-app-choose-select-dropdown').val() == "bizvoiceit") {
        if (getAppValue == "bizvoiceit") {
            //check step number
            if ($('.role-assignment-select-app.active').attr('data-step') == "1") {
                digibiz.role_assignment = {
                    app_access: "true",
                }
                sessionStorage.setItem("role_assignment", JSON.stringify(digibiz.role_assignment));
                //remove active class and hide the present step
                $(`.role-assignment-select-app[data-step="1"]`).removeClass('active');
                $(`.role-assignment-select-app[data-step="1"]`).addClass('hide');
                //add active class and show the next step of bizvoiceit
                $(`.role-assignment-select-app[data-step="2"]`).addClass('active');
                $(`.role-assignment-select-app[data-step="2"]`).removeClass('hide');
                //hide the next button
                $('#employee_role_assignment_next_btn').addClass('hide');
                removeLoader();
            } else if ($('.role-assignment-select-app.active').attr('data-step') == "2") {
                digibiz.role_assignment = {
                    app_access: "true",
                    create_respond_access: $('input[name="create_respond_app_access"]:checked').attr('data-id')
                }
                var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                getRoleAssignmentSession.create_respond_access = $('input[name="create_respond_app_access"]:checked').attr('data-id');
                sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                //remove active class and hide the present step
                $(`.role-assignment-select-app[data-step="2"]`).removeClass('active');
                $(`.role-assignment-select-app[data-step="2"]`).addClass('hide');
                //add active class and show the next step of bizvoiceit
                $(`.role-assignment-select-app[data-step="3"]`).addClass('active');
                $(`.role-assignment-select-app[data-step="3"]`).removeClass('hide');
                //hide the next button
                // $('#employee_role_assignment_next_btn').addClass('hide');
                removeLoader();
            } else if ($('.role-assignment-select-app.active').attr('data-step') == "3") {
                var selected_sub_apps_data = [];
                //get all checkbox
                var getCheckboxes = $('.bizvoiceit-sub-app-access');
                $.each(getCheckboxes, function (index, element) {
                    if ($(element).is(':checked')) {
                        selected_sub_apps_data.push({
                            "sub_app": $(element).attr('data-id')
                        })
                    }
                });
                if (selected_sub_apps_data.length > 0) {
                    digibiz.role_assignment = {
                        app_access: "true",
                        create_respond_access: $('input[name="create_respond_app_access"]:checked').attr('data-id'),
                        sub_app_access_data: selected_sub_apps_data
                    }
                    var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                    getRoleAssignmentSession.sub_app_access_data = selected_sub_apps_data;
                    sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                    //remove active class and hide the present step
                    $(`.role-assignment-select-app[data-step="3"]`).removeClass('active');
                    $(`.role-assignment-select-app[data-step="3"]`).addClass('hide');
                    //add active class and show the next step of bizvoiceit
                    $(`.role-assignment-select-app[data-step="4"]`).addClass('active');
                    $(`.role-assignment-select-app[data-step="4"]`).removeClass('hide');
                    //show back button
                    $('#employee_role_assignment_back_btn').removeClass('hide');
                    //hide the next button
                    // $('#employee_role_assignment_next_btn').addClass('hide');
                    removeLoader();
                } else {
                    removeLoader();
                    Materialize.toast(`Please select sub-apps`, 3000, "round error-alert");
                }
            } else if ($('.role-assignment-select-app.active').attr('data-step') == "4") {
                //check if atleast 1 share mode is selected
                if ($('input:radio[name="share_type_mode_access"]:checked').length > 0) {
                    // digibiz.role_assignment = {
                    //     app_access: "true",
                    //     create_respond_access: $('input[name="create_respond_app_access"]:checked').attr('data-id'),
                    //     sub_app_access_data: selected_sub_apps_data
                    // }
                    var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                    getRoleAssignmentSession.share_type_mode = $('input:radio[name="share_type_mode_access"]:checked').attr('data-id');
                    sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                    //remove active class and hide the present step
                    $(`.role-assignment-select-app[data-step="4"]`).removeClass('active');
                    $(`.role-assignment-select-app[data-step="4"]`).addClass('hide');
                    //check which share type more is selected and show appropriate elements
                    if ($('input:radio[name="share_type_mode_access"]:checked').attr('data-id') == "common") {
                        //unselect all the checkbox
                        $('.bizvoiceit-share-type-group-app-access').prop('checked', false);
                        //hide the custom elements
                        $(`.role-assignment-app-share-type-group-access-contentbox[data-type="custom"]`).addClass('hide');
                        //show the common elements
                        $(`.role-assignment-app-share-type-group-access-contentbox[data-type="common"]`).removeClass('hide');
                        //add active class and show the next step of bizvoiceit
                        $(`.role-assignment-select-app[data-step="5"]`).addClass('active');
                        $(`.role-assignment-select-app[data-step="5"]`).removeClass('hide');
                        //hide next button
                        $('#employee_role_assignment_next_btn').addClass('hide');
                        //show confirm button
                        $('#employee_role_assignment_confirm_btn').removeClass('hide');
                    }
                    if ($('input:radio[name="share_type_mode_access"]:checked').attr('data-id') == "custom") {
                        //unselect all the checkbox
                        $('.bizvoiceit-share-type-group-app-access').prop('checked', false);
                        //hide all the sub_app wrappers
                        $(`.role-assignment-app-share-type-group-access-wrapper`).addClass('hide');
                        //hide the common elements
                        $(`.role-assignment-app-share-type-group-access-contentbox[data-type="common"]`).addClass('hide');
                        //show the custom elements
                        $(`.role-assignment-app-share-type-group-access-contentbox[data-type="custom"]`).removeClass('hide');
                        //get all the selected sub-apps and show those elements
                        var getSessionSubAppAccess = JSON.parse(sessionStorage.getItem('role_assignment'));
                        if (getSessionSubAppAccess.sub_app_access_data.length > 0) {
                            $.each(getSessionSubAppAccess.sub_app_access_data, function (index, element) {
                                $(`.role-assignment-app-share-type-group-access-wrapper[data-app="${element.sub_app}"]`).removeClass('hide');
                            })
                        }
                        //add active class and show the next step of bizvoiceit
                        $(`.role-assignment-select-app[data-step="5"]`).addClass('active');
                        $(`.role-assignment-select-app[data-step="5"]`).removeClass('hide');
                        //hide next button
                        $('#employee_role_assignment_next_btn').addClass('hide');
                        //show confirm button
                        $('#employee_role_assignment_confirm_btn').removeClass('hide');
                    }

                    removeLoader();
                } else {
                    removeLoader();
                    Materialize.toast(`Please select one option`, 3000, "round error-alert");
                }
            }
        }
        // if ($('#role-assignment-app-choose-select-dropdown').val() == "digibiz") {
        if (getAppValue == "digibiz") {
            //check step number
            if ($('.role-assignment-select-app.active').attr('data-step') == "1") {
                digibiz.role_assignment = {
                    app_access: "true",
                }
                sessionStorage.setItem("role_assignment", JSON.stringify(digibiz.role_assignment));
                //remove active class and hide the present step
                $(`.role-assignment-select-app[data-step="1"]`).removeClass('active');
                $(`.role-assignment-select-app[data-step="1"]`).addClass('hide');
                //add active class and show the next step of digibiz
                $(`.role-assignment-select-app[data-step="6"]`).addClass('active');
                $(`.role-assignment-select-app[data-step="6"]`).removeClass('hide');
                //hide the next button
                $('#employee_role_assignment_next_btn').addClass('hide');
                removeLoader();

            } else if ($('.role-assignment-select-app.active').attr('data-step') == "6") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    list_by: "employee_module_access_list",
                    employee_id: $('#employee-role-assignment-modal').attr('data-employee-id')
                }
                businessOwnerList(reqParam)
                    .then((response) => {
                        //console.log("businessOwnerList response", response);
                        digibiz.alreadyModuleAdmin = response;
                        if (response.length > 0) {
                            $.each(response, function (index, val) {
                                $(`.digibiz-module-access[data-id="${val.module}"]`).prop('checked', true);
                            })
                        }
                        digibiz.role_assignment = {
                            app_access: "true",
                            admin_type: $('input[name="digibiz_module_admin_access"]:checked').attr('data-id')
                        }
                        var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                        getRoleAssignmentSession.admin_type = $('input[name="digibiz_module_admin_access"]:checked').attr('data-id');
                        sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                        //remove active class and hide the present step
                        $(`.role-assignment-select-app[data-step="6"]`).removeClass('active');
                        $(`.role-assignment-select-app[data-step="6"]`).addClass('hide');
                        //add active class and show the next step of digibiz
                        $(`.role-assignment-select-app[data-step="7"]`).addClass('active');
                        $(`.role-assignment-select-app[data-step="7"]`).removeClass('hide');
                        //hide the next button
                        $('#employee_role_assignment_next_btn').addClass('hide');
                        //show back button
                        $('#employee_role_assignment_back_btn').addClass('hide');
                        //show the Confirm button
                        $('#employee_role_assignment_confirm_btn').removeClass('hide');
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in getting results")
                    })
            }
        }
        // if ($('#role-assignment-app-choose-select-dropdown').val() == "bizchat") {
        if (getAppValue == "bizchat") {
            //check step number
            if ($('.role-assignment-select-app.active').attr('data-step') == "1") {
                bizchatCustomerIdentifierApiCall()
                    .then(() => {
                        //check if employee role assignment
                        if (sessionStorage.getItem('employee_id')) {
                            digibiz.role_assignment = {
                                app_access: "true",
                            }
                            sessionStorage.setItem("role_assignment", JSON.stringify(digibiz.role_assignment));

                            //remove active class and hide the present step
                            $(`.role-assignment-select-app[data-step="1"]`).removeClass('active');
                            $(`.role-assignment-select-app[data-step="1"]`).addClass('hide');
                            //add active class and show the next step of bizchat
                            $(`.role-assignment-select-app[data-step="8"]`).addClass('active');
                            $(`.role-assignment-select-app[data-step="8"]`).removeClass('hide');
                            //change title
                            $('#employee-role-assignment-modal').find('.modal-toolbar-container').text('Role Assignment - Bizchat - Select Contacts type')
                            removeLoader();
                        } else {
                            bizchatEmployeeDepartmentApiCall()
                                .then(() => {
                                    digibiz.role_assignment = {
                                        app_access: "true",
                                    }
                                    sessionStorage.setItem("role_assignment", JSON.stringify(digibiz.role_assignment));

                                    //remove active class and hide the present step
                                    $(`.role-assignment-select-app[data-step="1"]`).removeClass('active');
                                    $(`.role-assignment-select-app[data-step="1"]`).addClass('hide');
                                    //add active class and show the next step of bizchat
                                    $(`.role-assignment-select-app[data-step="8"]`).addClass('active');
                                    $(`.role-assignment-select-app[data-step="8"]`).removeClass('hide');
                                    //change title
                                    $('#employee-role-assignment-modal').find('.modal-toolbar-container').text('Role Assignment - Bizchat - Select Contacts type')
                                    removeLoader();
                                })
                                .catch((err) => {
                                    removeLoader();
                                })
                        }
                    })
                    .catch((err) => {
                        digibiz.role_assignment = {
                            app_access: "true",
                        }
                        sessionStorage.setItem("role_assignment", JSON.stringify(digibiz.role_assignment));
                        //remove active class and hide the present step
                        $(`.role-assignment-select-app[data-step="1"]`).removeClass('active');
                        $(`.role-assignment-select-app[data-step="1"]`).addClass('hide');
                        //add active class and show the next step of bizchat
                        $(`.role-assignment-select-app[data-step="8"]`).addClass('active');
                        $(`.role-assignment-select-app[data-step="8"]`).removeClass('hide');
                        //change title
                        $('#employee-role-assignment-modal').find('.modal-toolbar-container').text('Role Assignment - Bizchat - Select Contacts type')
                        removeLoader();
                    });

            } else if ($('.role-assignment-select-app.active').attr('data-step') == "8") {
                var selected_contacts_type_data = [];
                //get all selected contacts type
                var getCheckboxes = $('.bizchat-contacts-access');
                $.each(getCheckboxes, function (index, element) {
                    if ($(element).is(':checked')) {
                        selected_contacts_type_data.push({
                            "contact_type": $(element).attr('data-id')
                        })
                    }
                });
                if (selected_contacts_type_data.length > 0) {
                    digibiz.role_assignment = {
                        app_access: "true",
                        contacts_type_access: selected_contacts_type_data
                    }
                    var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                    getRoleAssignmentSession.contacts_type_access = selected_contacts_type_data;
                    sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                    //remove active class and hide the present step
                    $(`.role-assignment-select-app[data-step="8"]`).removeClass('active');
                    $(`.role-assignment-select-app[data-step="8"]`).addClass('hide');
                    //check which all contact types are checked...and show the appropriate next step
                    //check if employee contacts are checked, if yes, show step 9 to choose between (all/department wise) employee
                    if ($(`input.bizchat-contacts-access[data-id="employee_contacts"]`).is(':checked')) {
                        //add active class and show(remove class hide) the next step of bizchat(step-9)
                        $(`.role-assignment-select-app[data-step="9"]`).addClass('active');
                        $(`.role-assignment-select-app[data-step="9"]`).removeClass('hide');
                    } else
                        //check if customer contacts are checked, if yes, show step 10 to choose identifiers
                        if ($(`input.bizchat-contacts-access[data-id="customer_contacts"]`).is(':checked')) {
                            //add active class and show(remove class hide) the next step of bizchat(step-10)
                            $(`.role-assignment-select-app[data-step="10"]`).addClass('active');
                            $(`.role-assignment-select-app[data-step="10"]`).removeClass('hide');
                        } else {//prospect is checked, sogo to step-12 for giving access to custom group
                            //add active class and show(remove class hide) the next step of bizchat(step-12)
                            $(`.role-assignment-select-app[data-step="12"]`).addClass('active');
                            $(`.role-assignment-select-app[data-step="12"]`).removeClass('hide');
                        }

                    //show back button
                    $('#employee_role_assignment_back_btn').removeClass('hide');
                    removeLoader();
                } else {
                    removeLoader();
                    Materialize.toast(`Please select atleast 1 contact type`, 3000, "round error-alert");
                }
            } else if ($('.role-assignment-select-app.active').attr('data-step') == "9") {
                //check if atleast one is checked
                if ($('input[name="bizchat_employee_contacts_acces"]:checked').length > 0) {
                    // digibiz.role_assignment = {
                    //     app_access: "true",
                    //     contacts_type_access: selected_contacts_type_data
                    // }
                    var getRoleAssignmentSession = JSON.parse(sessionStorage.getItem('role_assignment'));
                    getRoleAssignmentSession.employee_contact_type_access = $('input[name="bizchat_employee_contacts_acces"]:checked').attr('data-id');
                    sessionStorage.setItem("role_assignment", JSON.stringify(getRoleAssignmentSession));
                } else {
                    removeLoader();
                    Materialize.toast(`Please select 1 option`, 3000, "round error-alert");
                }
            }
        }

    });


    //role management back button
    $(document).on('click', '#employee_role_assignment_back_btn', function () {
        addLoader();
        //check app
        var getAppValue = $('.selected-value-role-assignment-app').attr('data-value');
        // if ($('#role-assignment-app-choose-select-dropdown').val() == "bizvoiceit") {
        if (getAppValue == "bizvoiceit") {
            //check step number
            if ($('.role-assignment-select-app.active').attr('data-step') == "4") {
                //remove active class and hide the present step
                $(`.role-assignment-select-app[data-step="4"]`).removeClass('active');
                $(`.role-assignment-select-app[data-step="4"]`).addClass('hide');
                //add active class and show the previous step of bizvoiceit
                $(`.role-assignment-select-app[data-step="3"]`).addClass('active');
                $(`.role-assignment-select-app[data-step="3"]`).removeClass('hide');
                //hide back button
                $('#employee_role_assignment_back_btn').addClass('hide');
                removeLoader();
            } else if ($('.role-assignment-select-app.active').attr('data-step') == "5") {
                //remove active class and hide the present step
                $(`.role-assignment-select-app[data-step="5"]`).removeClass('active');
                $(`.role-assignment-select-app[data-step="5"]`).addClass('hide');
                //add active class and show the previous step of bizvoiceit
                $(`.role-assignment-select-app[data-step="4"]`).addClass('active');
                $(`.role-assignment-select-app[data-step="4"]`).removeClass('hide');
                //hide confirm button
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                //display next button
                $('#employee_role_assignment_next_btn').removeClass('hide');
                removeLoader();
            }
        }
    });

    //bizvoiceit create respond 
    $(document).on('change', 'input:radio[name="create_respond_app_access"]', function () {
        //check whether it is checked or unchecked
        if ($(this).is(':checked')) {
            addLoader();
            //get whether it is create or respond
            var getData = $(this).attr('data-id');
            if (getData == "create") {
                //hide confirm button
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                //show next button
                $('#employee_role_assignment_next_btn').removeClass('hide');
                removeLoader();
            }
            if (getData == "respond") {
                //show confirm button
                $('#employee_role_assignment_confirm_btn').removeClass('hide');
                //hide next button
                $('#employee_role_assignment_next_btn').addClass('hide');
                removeLoader();
            }
            if (getData == "create-respond") {
                //hide confirm button
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                //show next button
                $('#employee_role_assignment_next_btn').removeClass('hide');
                removeLoader();
            }
        }
    });

    //role data options
    $(document).on('click', '#show-action-role-management-employee-app-access-data', function () {
        addLoader();
        var dataApp = $(this).parents('.role_management_employee_apps_access_wrapper').attr('data-app');
        var roleID = $(this).parents('.role_management_employee_apps_access_wrapper').attr('data-id');
        if (dataApp == "bizchat") {
            var action_sheet_parms = {
                action_id: "role-management-employee-app-access-actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "delete_role_management_app_access" }]
                    }
                ]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('data-role-id', roleID);
            });
        }
        if (dataApp == "bizvoiceit") {
            var action_sheet_parms = {
                action_id: "role-management-employee-app-access-actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Edit",
                        attr: [{ name: "id", value: "edit_role_management_app_access" }]
                    },
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "delete_role_management_app_access" }]
                    }
                ]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('data-role-id', roleID);
            });
        }
        if (dataApp == "digibiz") {
            var action_sheet_parms = {
                action_id: "role-management-employee-app-access-actions",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "delete_role_management_app_access" }]
                    }
                ]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $(".action-sheet-container").attr('data-role-id', roleID);
            });
        }
    });

    //delete role
    $(document).on('click', '#delete_role_management_app_access', function () {
        addLoader();
        var getRoleId = $('#role-management-employee-app-access-actions').attr('data-role-id');
        $('#role-management-employee-app-access-actions').remove();
        var alert_parms = {
            alert_id: "alert-delete-role-management-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Role`,
            alert_body: `Are you sure you want to delete this role?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-role-management-confirm" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-role-management-cancel" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-role-management-confirm-cancel').attr('data-role-id', getRoleId);
        });
    });

    //delete role no
    $(document).on('click', '#btn-delete-role-management-cancel', function () {
        addLoader();
        $('#alert-delete-role-management-confirm-cancel').remove();
        removeLoader();
    });

    //delete role confirm yes
    $(document).on('click', '#btn-delete-role-management-confirm', function () {
        addLoader();
        var getRoleId = $('#alert-delete-role-management-confirm-cancel').attr('data-role-id');
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getRoleId
        }
        roleManagementDelete(reqparams)
            .then((response) => {
                //console.log("roleManagementDelete", response);
                removeLoader();
                $('#alert-delete-role-management-confirm-cancel').remove();
                Materialize.toast(`Successfully Deleted`, 3000, "round success-alert");
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting role`, 3000, "round error-alert");
            })
    });

    //edit role
    $(document).on('click', '#edit_role_management_app_access', function () {
        addLoader();
        var getRoleId = $('#role-management-employee-app-access-actions').attr('data-role-id');
        $('#role-management-employee-app-access-actions').remove();
        var reqparams = {
            device_id: crossplat.device.uuid,
            get_by: "role_id",
            id: getRoleId
        }
        roleManagementGet(reqparams)
            .then((response) => {
                //console.log("roleManagementGet", response);
                var getRoleData = {
                    roleData: response
                }
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "employee-role-assignment-modal",
                        modal_header: "Role Assignment",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Back",
                            "id": "employee_role_assignment_back_btn",
                            "class": "hide"
                        },
                        {
                            "name": "Next",
                            "id": "employee_role_assignment_next_btn",
                            "class": "hide"
                        },
                        {
                            "name": "Save",
                            "id": "employee_role_assignment_save_btn",
                            "class": "hide"
                        },
                        {
                            "name": "Confirm",
                            "id": "employee_role_assignment_confirm_btn",
                            "class": "hide"
                        }]
                    }
                    showModal(modal_data, function () {
                        sessionStorage.setItem('edit_role', getRoleId);
                        removeLoader();
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        //hide step 1
                        $(`.role-assignment-select-app[data-step="1"]`).removeClass('active').addClass('hide');
                        //show step 2
                        $(`.role-assignment-select-app[data-step="2"]`).addClass('active').removeClass('hide');
                        //set session of access_data
                        sessionStorage.setItem("role_assignment", JSON.stringify(response.access_data));
                        if (response.app_name == "bizvoiceit") {
                            if ($('input:radio[name="create_respond_app_access"]:checked').length > 0) {
                                //get whether it is create or respond or both
                                var getData = $('input:radio[name="create_respond_app_access"]:checked').attr('data-id');
                                if (getData == "create") {
                                    //hide confirm button
                                    $('#employee_role_assignment_confirm_btn').addClass('hide');
                                    //show next button
                                    $('#employee_role_assignment_next_btn').removeClass('hide');
                                    removeLoader();
                                }
                                if (getData == "respond") {
                                    //show confirm button
                                    $('#employee_role_assignment_confirm_btn').removeClass('hide');
                                    //hide next button
                                    $('#employee_role_assignment_next_btn').addClass('hide');
                                    removeLoader();
                                }
                                if (getData == "create-respond") {
                                    //hide confirm button
                                    $('#employee_role_assignment_confirm_btn').addClass('hide');
                                    //show next button
                                    $('#employee_role_assignment_next_btn').removeClass('hide');
                                    removeLoader();
                                }
                            }
                            //check the sub_apps
                            if (response.access_data.sub_app_access_data.length > 0) {
                                $.each(response.access_data.sub_app_access_data, function (index, element) {
                                    $(`input:checkbox.bizvoiceit-sub-app-access[data-id="${element.sub_app}"]`).prop('checked', true);
                                });
                            }
                            //check the common share type
                            if (response.access_data.share_type_mode == "common") {
                                var getShareTypes = [];
                                getShareTypes = response.access_data.sub_app_access_data[0].share_types;
                                if (getShareTypes.length > 0) {
                                    $.each(getShareTypes, function (index, val) {
                                        $(`.role-assignment-app-share-type-group-access-contentbox[data-type="common"]`).find(`.input:checkbox.bizvoiceit-share-type-group-app-access[data-id="${val}"]`).prop('checked', true);
                                    })
                                }
                            }
                            //check the custom share type
                            if (response.access_data.share_type_mode == "custom") {
                                $.each(response.access_data.sub_app_access_data, function (index, elem) {
                                    if (elem.share_types.length > 0) {
                                        $.each(elem.share_types, function (index, val) {
                                            $(`.role-assignment-app-share-type-group-access-contentbox[data-type="custom"]`).find(`.role-assignment-app-share-type-group-access-wrapper[data-app="${elem.sub_app}"]`).find(`.input:checkbox.bizvoiceit-share-type-group-app-access[data-id="${val}"]`).prop('checked', true);
                                        })
                                    }
                                });
                            }
                        }
                    });
                }, 'page/role_management/role_assignment_modal', '#role-assignment-template', getRoleData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in getting the role.`, 3000, "round error-alert");
            })
    });

    //digibiz digibiz/module admin change
    $(document).on('change', 'input:radio[name="digibiz_module_admin_access"]', function () {
        //check whether it is checked or unchecked
        if ($(this).is(':checked')) {
            addLoader();
            //get whether it is digibiz-admin or module-admin
            var getData = $(this).attr('data-id');
            if (getData == "module_admin") {
                //hide confirm button
                $('#employee_role_assignment_confirm_btn').addClass('hide');
                //show next button
                $('#employee_role_assignment_next_btn').removeClass('hide');
                removeLoader();
            }
            if (getData == "digibiz_admin") {
                //show confirm button
                $('#employee_role_assignment_confirm_btn').removeClass('hide');
                //hide next button
                $('#employee_role_assignment_next_btn').addClass('hide');
                removeLoader();
            }
        }
    });


    //digibiz logs
    $(document).on('click', '.digibiz-business-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "business");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.employee-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "employee");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.customer-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "customer_logs");
        location.hash = "digibiz/logs";
    });


    $(document).on('click', '.digibiz-notification-role-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "notification_role_page");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-business-notification-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "business_notification_page");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-business-owner-role-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "business_owner_business_list_page");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-business-app-hub-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "business_app_hub_page");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.jeevi-hub-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "jeevi_hub_page");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-hub-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "digibiz_hub_page");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-roles-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "digibiz_roles_logs");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-login-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "digibiz_login_logs");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.digibiz-business-logs', function () {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "digibiz_business_logs");
        location.hash = "digibiz/logs";
    });



    $(document).on('click', '#app-permission-logs-btn', function (e) {
        addLoader();
        $('body').click();
        sessionStorage.setItem('log_type', "app_permission_logs");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.communication-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "communication_group_logs");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.business-notification-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "business_notification_activity_logs");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.collaborator-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "collaborator_group_logs");
        location.hash = "digibiz/logs";
    });

    $(document).on('click', '.member-collaborator-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "member_collaborator_group_logs");
        location.hash = "digibiz/logs";
    });


    /*************COMMUNICATION MANAGEMENT(starts)************************/
    $(document).on('click', '.communication-management', function () {
        addLoader();
        location.hash = `communication/groups`;
    });

    //communication group add
    $(document).on('click', '#communication-group-add-btn', function () {
        addLoader();
        if (sessionStorage.getItem('selected-communication-group-type-tab') == "communication") {
            var action_sheet_parms = {
                action_id: "communication-group-create-add-from-actions",
                action_platform: crossplat.device.platform,
                action_title: "Actions",
                action_btn: [{
                    name: "Contact List",
                    attr: [{ name: "id", value: "communication_group_from_contact_list_btn" }]
                },
                {
                    name: "Group List",
                    attr: [{ name: "id", value: "communication_group_from_group_list_btn" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                removeLoader();
            });
        } else if (sessionStorage.getItem('selected-communication-group-type-tab') == "employee") {
            var action_sheet_parms = {
                action_id: "communication-group-activate-add-from-actions",
                action_platform: crossplat.device.platform,
                action_title: "Activate From",
                action_btn: [{
                    name: "Employee Group",
                    attr: [{ name: "id", value: "communication_activate_from_employee_group_list_btn" }]
                },
                {
                    name: "Customer Group",
                    attr: [{ name: "id", value: "communication_activate_from_customer_group_list_btn" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $('#communication-group-activate-add-from-actions').addClass('hide');
                $('#communication_activate_from_employee_group_list_btn').trigger('click');
                removeLoader();
            });
        } else if (sessionStorage.getItem('selected-communication-group-type-tab') == "customer") {
            var action_sheet_parms = {
                action_id: "communication-group-activate-add-from-actions",
                action_platform: crossplat.device.platform,
                action_title: "Activate From",
                action_btn: [{
                    name: "Employee Group",
                    attr: [{ name: "id", value: "communication_activate_from_employee_group_list_btn" }]
                },
                {
                    name: "Customer Group",
                    attr: [{ name: "id", value: "communication_activate_from_customer_group_list_btn" }]
                }]
            }
            showAction(action_sheet_parms, function () {
                $('#communication-group-activate-add-from-actions').addClass('hide');
                $('#communication_activate_from_customer_group_list_btn').trigger('click');
                removeLoader();
            });
        }
        // var action_sheet_parms = {
        //     action_id: "communication-group-add-button-actions",
        //     action_platform: crossplat.device.platform,
        //     action_title: "Add by",
        //     action_btn: [{
        //         name: "Activate",
        //         attr: [{ name: "id", value: "communication_group_activate_group_btn" }]
        //     },
        //     {
        //         name: "Create",
        //         attr: [{ name: "id", value: "communication_group_create_group_btn" }]
        //     }]
        // }
        // showAction(action_sheet_parms, function () {
        //     removeLoader();
        // });
    });

    //create communication group
    // $(document).on('click', '#communication_group_create_group_btn', function () {
    //     addLoader();
    //     $('#communication-group-add-button-actions').remove();
    //     sessionStorage.setItem('group_type', 'create');
    //     var action_sheet_parms = {
    //         action_id: "communication-group-create-add-from-actions",
    //         action_platform: crossplat.device.platform,
    //         action_title: "Actions",
    //         action_btn: [{
    //             name: "Contact List",
    //             attr: [{ name: "id", value: "communication_group_from_contact_list_btn" }]
    //         },
    //         {
    //             name: "Group List",
    //             attr: [{ name: "id", value: "communication_group_from_group_list_btn" }]
    //         }]
    //     }
    //     showAction(action_sheet_parms, function () {
    //         removeLoader();
    //     });
    // });

    //activate communication group
    // $(document).on('click', '#communication_group_activate_group_btn', function () {
    //     addLoader();
    //     $('#communication-group-add-button-actions').remove();
    //     sessionStorage.setItem('group_type', 'activate');
    //     var action_sheet_parms = {
    //         action_id: "communication-group-activate-add-from-actions",
    //         action_platform: crossplat.device.platform,
    //         action_title: "Activate From",
    //         action_btn: [{
    //             name: "Employee Group",
    //             attr: [{ name: "id", value: "communication_activate_from_employee_group_list_btn" }]
    //         },
    //         {
    //             name: "Customer Group",
    //             attr: [{ name: "id", value: "communication_activate_from_customer_group_list_btn" }]
    //         }]
    //     }
    //     showAction(action_sheet_parms, function () {
    //         removeLoader();
    //     });
    // });


    //activate from employee group list
    $(document).on('click', '#communication_activate_from_employee_group_list_btn', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "employee",
            list_by: "business",
            business_id: sessionStorage.getItem('business_id')
        }
        groupsList(reqParam)
            .then((response) => {
                //console.log("success in groups list", response);
                // var groupsList = {
                //     groupList: response.map(e => {
                //         if (e.hasOwnProperty('group_image') && e.group_image) {
                //             if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                //                 var avtarUrl = `${api.get_employee_group_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}`;
                //                 e.group_image['avtarUrl'] = avtarUrl;
                //             } else {
                //                 e['imageLetter'] = e.name.charAt(0);
                //             }
                //         } else {
                //             e['imageLetter'] = e.name.charAt(0);
                //         }
                //         return e;
                //     })
                // }
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "modal-communication-group-activate-employee-group-list-selection",
                    modal_header: "Employee Groups",
                    modal_body: `<div id="communication-group-activate-employee-group-list-main-container">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                         <div class="expand-search-wrap" id="communication-group-activate-employee-group-list-search-btn">
                                         <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                         <span class="searchclosebtn"><i class="material-icons communication-group-activate-employee-group-list-close-btn hide">close</i></span>
                                    </div>
                                    <div id="communication-group-activate-employee-group-list-wrapper"></div>
                                    </div>`,
                    modal_action_buttons: [{
                        "name": "Add Moderator",
                        "id": "communication-group-activate-employee-group-next-btn",
                    }]
                }
                showModal(modal_data, function () {
                    $('#communication-group-activate-add-from-actions').remove();
                    removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processCommunicationGroupActivateEmployeeGroupsList(response, function () {
                        setTimeout(function () {
                            // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        }, 0);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in groups list")
            })
    });

    //employee group next button
    $(document).on('click', '#communication-group-activate-employee-group-next-btn', function () {
        addLoader();
        if ($('input[name="communication-activate-employee-group"]:checked').length > 0) {
            var getGroupId = $('input[name="communication-activate-employee-group"]:checked').parents('.group-selection-wrapper').attr('data-group-id');
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: getGroupId
            }
            groupGet(requestParams)
                .then((groupResponse) => {
                    if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator) {
                        digibiz.alreadySelected = groupResponse.moderator;
                    }
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: getGroupId
                    }
                    groupMemberList(reqParam)
                        .then((response) => {
                            //console.log("groupMemberList", response);
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "modal-communication-group-activate-employee-group-employee-list-selection",
                                modal_header: "Employee Group Members",
                                modal_body: `<div id="communication-group-activate-employee-group-employee-list-main-container">
                                             <div class="search">                                         
                                                <div class="expand-search-wrap search-wrapper" id="communication-group-activate-employee-group-employee-list-search-btn">
                                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                    <span class="searchclosebtn"><i class="material-icons communication-group-activate-employee-group-employee-list-close-btn hide">close</i></span>
                                                </div>
                                            </div>
                                        <div id="communication-group-activate-employee-group-employee-list-wrapper"></div>
                                        </div>`,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "communication-group-activate-employee-group-employee-select-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                $('#modal-communication-group-activate-employee-group-list-selection').remove();
                                $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id', getGroupId);
                                removeLoader();
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                processCommunicationGroupActivateEmployeeGroupEmployeeList(response, groupResponse, function () {
                                    setTimeout(function () {
                                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                    }, 0);
                                });
                            });

                        })
                        .catch((err) => {
                            removeLoader();
                            //console.log("error in group get");
                        })
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting the group")
                })
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 group.`, 3000, "round error-alert");
        }
    });

    //save employee group moderator
    $(document).on('click', '#communication-group-activate-employee-group-employee-select-save-btn', function () {
        addLoader();
        var groupID = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
        // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
        var alert_parms = {
            alert_id: "alert-employee-group-moderator-add-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Alert`,
            alert_body: `Already added or existing moderator
                won't be added again.Only new moderator will be added`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-employee-group-moderator-add-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-employee-group-moderator-add-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-employee-group-moderator-add-confirm-cancel').attr('data-group-id', groupID);
        });




    });

    $(document).on('click', '#btn-employee-group-moderator-add-confirm-no', function () {
        $('#alert-employee-group-moderator-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-employee-group-moderator-add-confirm-yes', function () {
        var groupID = $('#alert-employee-group-moderator-add-confirm-cancel').attr('data-group-id');
        var moderator_data = [];
        var revoked_data = [];
        //get all checkbox
        var getCheckboxes = $('.communication-group-employee-select-btn');
        $('#alert-employee-group-moderator-add-confirm-cancel').remove();
        $.each(getCheckboxes, function (index, element) {
            // if ($(element).is(':checked')) {
            if ($(element).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row')) {
                moderator_data.push({
                    "id": $(element).attr('data-dj-unique-employee-id'),
                    "type": "employee",
                    "user_id": $(element).attr('data-dj-unique-employee-id'),
                    "group_id": $(element).parents('.accordion-content').attr('data-group-id')
                })
            }
        });
        //check unchecked one's
        //console.log("digibiz.alreadySelected", digibiz.alreadySelected)
        // var alreadySelected = digibiz.communicationActivateEmployeeGroupEmployeeList
        $.each(digibiz.alreadySelected, function (index, element) {
            if (element.hasOwnProperty('group_id') && element.group_id) {
                // var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
                var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
                if (check == false) {
                    revoked_data.push(element);
                }
                //console.log("moderator_data", moderator_data);
                var getModerator = moderator_data.findIndex(e => e.id == element.id && e.group_id == element.group_id);
                //console.log("getModerator", getModerator);
                if (getModerator > -1) {
                    // delete moderator_data[getModerator];
                    moderator_data.splice(getModerator, 1);
                }
                // moderator_data = moderator_data.filter(function (e) {
                //     return (e.id != element.id && e.group_id != element.group_id);
                // });
            } else {
                // var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
                var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
                if (check == false) {
                    revoked_data.push(element);
                }
                moderator_data = moderator_data.filter(function (e) {
                    return e.id != element.id;
                });
            }
        });
        //console.log("moderator_data", moderator_data);
        //console.log("revoked_data", revoked_data);
        if (moderator_data.length > 0 || revoked_data.length > 0) {
            if (moderator_data.length > 0) {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: groupID,
                    moderator_data: moderator_data
                }
                groupModeratorAdd(requestParams)
                    .then((response) => {
                        if (revoked_data.length > 0) {
                            $.each(revoked_data, function (index, element) {
                                var requesParam = {
                                    device_id: crossplat.device.uuid,
                                    id: groupID,
                                    moderator_id: element.id,
                                }
                                if (element.hasOwnProperty('group_id') && element.group_id) {
                                    requesParam.moderator_group_id = element.group_id;
                                }
                                groupModeratorDelete(requesParam)
                                    .then((resultData) => {
                                        //console.log("groupModeratorDelete", resultData);
                                        digibiz.alreadySelected = [];
                                        digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                                        $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                                        Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            })
                        } else {
                            //console.log("groupModeratorAdd", response);
                            digibiz.alreadySelected = [];
                            digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                            $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        }
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            }
            if (moderator_data.length == 0) {
                if (revoked_data.length > 0) {
                    $.each(revoked_data, function (index, element) {
                        var requesParam = {
                            device_id: crossplat.device.uuid,
                            id: groupID,
                            moderator_id: element.id,
                        }
                        if (element.hasOwnProperty('group_id') && element.group_id) {
                            requesParam.moderator_group_id = element.group_id;
                        }
                        groupModeratorDelete(requesParam)
                            .then((resultData) => {
                                //console.log("groupModeratorDelete", resultData);
                                digibiz.alreadySelected = [];
                                digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                                $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                                Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(err.msg, 3000, "round error-alert");
                            })
                    })
                }
            }
        } else {
            // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            removeLoader();
            // } else {
            //     Materialize.toast(`Please select atleast 1 member.`, 3000, "round error-alert");
            // }
        }

    })

    //activate from customer group list
    $(document).on('click', '#communication_activate_from_customer_group_list_btn', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "customer",
            list_by: "business",
            business_id: sessionStorage.getItem('business_id')
        }
        groupsList(reqParam)
            .then((response) => {
                //console.log("success in groups list", response);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "modal-communication-group-activate-customer-group-list-selection",
                    modal_header: "Customer groups",
                    modal_body: `<div id="communication-group-activate-customer-group-list-main-container">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                         <div class="expand-search-wrap" id="communication-group-activate-customer-group-list-search-btn">
                                         <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                         <span class="searchclosebtn"><i class="material-icons communication-group-activate-customer-group-list-close-btn hide">close</i></span>
                                    </div>
                                    <div id="communication-group-activate-customer-group-list-wrapper"></div>
                                    </div>`,
                    modal_action_buttons: [{
                        "name": "Add Moderator",
                        "id": "communication-group-activate-customer-group-next-btn",
                    }]
                }
                showModal(modal_data, function () {
                    $('#communication-group-activate-add-from-actions').remove();
                    removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processCommunicationGroupActivateCustomerGroupsList(response, function () {
                        setTimeout(function () {
                            // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        }, 0);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in groups list")
            })
    });

    //customer group next button
    $(document).on('click', '#communication-group-activate-customer-group-next-btn', function () {
        addLoader();
        if ($('input[name="communication-activate-customer-group"]:checked').length > 0) {
            var getGroupId = $('input[name="communication-activate-customer-group"]:checked').parents('.group-selection-wrapper').attr('data-group-id');
            //console.log("getGroupId", getGroupId);
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: getGroupId
            }
            groupGet(requestParams)
                .then((groupResponse) => {
                    if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator) {
                        digibiz.alreadySelected = groupResponse.moderator;
                    }
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: getGroupId
                    }
                    groupMemberList(reqParam)
                        .then((response) => {
                            //console.log("groupMemberList", response);
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "modal-communication-group-activate-customer-group-customers-list-selection",
                                modal_header: "Customer Group Members",
                                modal_body: `<div id="communication-group-activate-customer-group-customers-list-main-container">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="communication-group-activate-customer-group-customers-list-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons communication-group-activate-customer-group-customers-list-close-btn hide">close</i></span>
                                        </div>
                                        <div id="communication-group-activate-customer-group-customers-list-wrapper"></div>
                                        </div>`,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "communication-group-activate-customer-group-customers-select-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                $('#modal-communication-group-activate-customer-group-list-selection').remove();
                                $('#modal-communication-group-activate-customer-group-customers-list-selection').attr('data-group-id', getGroupId);
                                removeLoader();
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                processCommunicationGroupActivateCustomerGroupCustomersList(response, function () {
                                    setTimeout(function () {
                                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                    }, 0);
                                });
                            });

                        })
                        .catch((err) => {
                            removeLoader();
                            //console.log("error in group get");
                        })
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting the group")
                })
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 group.`, 3000, "round error-alert");
        }
    });

    //save customer group moderator
    $(document).on('click', '#communication-group-activate-customer-group-customers-select-save-btn', function () {
        addLoader();
        var groupID = $('#modal-communication-group-activate-customer-group-customers-list-selection').attr('data-group-id');
        var moderator_data = [];
        var revoked_data = [];
        if ($('.communication-group-activate-customer-select-btn').length > 0) {
            //get all checkbox
            var getCheckboxes = $('.communication-group-activate-customer-select-btn');
            $.each(getCheckboxes, function (index, element) {
                if ($(element).is(':checked')) {
                    moderator_data.push({
                        "id": $(element).attr('data-customer-id'),
                        "type": $(element).parents('.customer-selection-list-container').find('.contact-profile-container').attr('data-customer-type'),
                        "group_id": groupID
                    })
                }
            });
            //check unchecked one's
            $.each(digibiz.alreadySelected, function (index, element) {
                var check = $(`.communication-group-activate-customer-select-btn[data-customer-id="${element.id}"]`).is(':checked');
                // //console.log("check", check);
                if (check == false) {
                    revoked_data.push(element);
                }
            });
            //console.log("revoked_data", revoked_data);
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: groupID,
                moderator_data: moderator_data
            }
            groupModeratorAdd(requestParams)
                .then((response) => {
                    //console.log("groupModeratorAdd", response);
                    digibiz.alreadySelected = [];
                    digibiz.communicationActivateCustomerGroupCustomersList = [];
                    $('#modal-communication-group-activate-customer-group-customers-list-selection').remove();
                    Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: groupID,
                        moderator_id: element.id
                    }
                    groupModeratorDelete(requesParam)
                        .then((resultData) => {
                        })
                        .catch((err) => {
                        })
                })
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 member.`, 3000, "round error-alert");
        }
    });

    //used
    $(document).on('click', '#communication_group_from_contact_list_btn', function () {
        addLoader();
        sessionStorage.setItem('group_type', 'create');
        sessionStorage.setItem('group_from', 'contact_list');
        $('#communication-group-create-add-from-actions').remove();
        location.hash = `communication/group_details`;
    });

    $(document).on('click', '#communication_group_from_group_list_btn', function () {
        addLoader();
        sessionStorage.setItem('group_type', 'create');
        sessionStorage.setItem('group_from', 'group_list');
        $('#communication-group-create-add-from-actions').remove();
        location.hash = `communication/group_details`;
    });

    //communication group-> employee members
    // $(document).on('click', '#add_communication_group_employee_members', function () {
    //     addLoader();
    //     var getGroupType = sessionStorage.getItem('group_from');
    //     if (getGroupType == "contact_list") {
    //         addLoader();
    //         var getMembers = [];
    //         if ($('.communication-group-employee-member-wrapper').length > 0) {
    //             $.each($('.communication-group-employee-member-wrapper'), function (index, element) {
    //                 getMembers.push({
    //                     id: $(element).attr('data-dj-unique-employee-id'),
    //                     type: "new_member"
    //                 });
    //             });
    //         }
    //         if ($('#communication-group-employee-members-list').find('.communication-group-member-wrapper').length > 0) {
    //             $.each($('#communication-group-employee-members-list .communication-group-member-wrapper'), function (index, element) {
    //                 getMembers.push({
    //                     id: $(element).attr('data-employee-id'),
    //                     type: "old_member"
    //                 });
    //             });
    //         }
    //         var reqParam = {
    //             device_id: crossplat.device.uuid,
    //             list_by: "list_unassigned_active",
    //             business_id: sessionStorage.getItem('business_id')
    //         }
    //         employeeList(reqParam)
    //             .then((response) => {
    //                 //console.log("employeeList response", response);
    //                 var EmployeeList = {
    //                     EmployeeList: response.map(e => {
    //                         if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                             if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
    //                                 var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
    //                                 e.identity_picture['avtarUrl'] = avtarUrl;
    //                             } else {
    //                                 e['imageLetter'] = e.name.first.charAt(0);
    //                             }
    //                         } else {
    //                             e['imageLetter'] = e.name.first.charAt(0);
    //                         }
    //                         return e;
    //                     }),
    //                     from: "direct"
    //                 }
    //                 //console.log("EmployeeList", EmployeeList);
    //                 fetch.getHtml(function (fetcherror, html) {
    //                     var modal_data = {
    //                         modal_id: "modal-communication-group-employees-selection",
    //                         modal_header: "Employee List",
    //                         modal_platform: crossplat.device.platform,
    //                         modal_body: html,
    //                         modal_action_buttons: [{
    //                             "name": "Add",
    //                             "id": "add-communication-group-selected-employees",
    //                         }]
    //                     }
    //                     showModal(modal_data, function () {
    //                         if (getMembers.length > 0) {
    //                             $.each(getMembers, function (index, element) {
    //                                 if (element.type == "new_member") {
    //                                     $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
    //                                 } else if (element.type == "old_member") {
    //                                     // $('#communication-group-employee-members-list').find(`.communication-group-member-wrapper[data-employee-id="${element.id}"]`).remove();
    //                                     $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
    //                                 }
    //                             })
    //                             if ($('#modal-communication-group-employees-selection').find(`.contact-profile-container`).length > 0) {
    //                                 //console.log("empty modal")
    //                             } else {
    //                                 $('.employee-selection-member-list').append('<div class="no-data">No Employees found</div>');
    //                             }
    //                         }
    //                         if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                             $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         } else {
    //                             $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                         }
    //                         removeLoader();
    //                     });
    //                 }, 'page/communication/employee_selection_list', '#employee-selection-list-template', EmployeeList);
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
    //             })
    //     } else if (getGroupType == "group_list") {//using group list
    //         addLoader();
    //         digibiz.communicationCreateEmployeeGroupsList = [];
    //         var reqParam = {
    //             device_id: crossplat.device.uuid,
    //             type: "employee",
    //             list_by: "active_employee_groups",
    //             business_id: sessionStorage.getItem('business_id')
    //         }
    //         groupsList(reqParam)
    //             .then((response) => {
    //                 //console.log("success in groups list", response);
    //                 var modal_data = {
    //                     modal_id: "modal-communication-group-employee-group-selection",
    //                     modal_header: "Employee Group List",
    //                     modal_platform: crossplat.device.platform,
    //                     modal_body: `<div id="communication-group-create-employee-group-list-main-container">
    //                         <span class="searchbtn waves-effect"><i class="material-icons">search</i></span>
    //                          <div class="expand-search-wrap" id="communication-group-create-employee-group-list-search-btn">
    //                          <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
    //                          <span class="searchclosebtn"><i class="material-icons communication-group-create-employee-group-list-close-btn hide">close</i></span>
    //                     </div>
    //                     <div id="communication-group-create-employee-group-list-wrapper"></div>
    //                     </div>`,
    //                     modal_action_buttons: [{
    //                         "name": "Add",
    //                         "id": "add-communication-group-selected-employee-group",
    //                     }]
    //                 }
    //                 showModal(modal_data, function () {
    //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                     } else {
    //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                     }
    //                     processCommunicationGroupCreateEmployeeGroupsList(response, function () {
    //                         setTimeout(function () {
    //                             // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
    //                             var element = $('#modal-communication-group-employee-group-selection').find('.expand-search-input');
    //                             if (element) {
    //                                 //console.log('elementSearchCheck', element);
    //                                 //if element is there
    //                                 $(document).on('input', element, function () {
    //                                     //on input set attribute socketid 
    //                                     timestamp = (new Date()).getTime();
    //                                     element.attr("socketid", timestamp);
    //                                 });
    //                                 // element.addEventListener("keyup", function (e) {
    //                                 $(document).on('keyup', element, function () {
    //                                     // on keyup get attribute 
    //                                     socketid = element.attr("socketid");
    //                                     keyword = element.val();
    //                                     if (socketid && keyword) {
    //                                         //if socketid attribute and keyword is there
    //                                         document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
    //                                         currentroute = $("body").attr('app');
    //                                         data = {
    //                                             room: crossplat.device.uuid,
    //                                             socketid,
    //                                             app: 'digibiz',
    //                                             keyword
    //                                         };
    //                                         switch (currentroute) {
    //                                             case 'communication_group_details':
    //                                                 if ($('#modal-communication-group-employee-group-selection').length > 0) {
    //                                                     data['index'] = 'getCommunicationGroupEmployeeGroupSelection';
    //                                                     data['business_id'] = sessionStorage.getItem('business_id');
    //                                                 }
    //                                                 break;
    //                                             default:
    //                                                 break;
    //                                         }
    //                                         addLoader();
    //                                         //console.log("search emit", data);
    //                                         sockets.searchSocket.emit('search', data);
    //                                         setTimeout(() => {
    //                                             removeLoader();
    //                                         }, 300);
    //                                     } else {
    //                                         //console.log("going to else part")
    //                                         //else show default list
    //                                         removeLoader();
    //                                         document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
    //                                         currentroute = $("body").attr('app');
    //                                         // element.removeAttribute("socketid");
    //                                         element.attr("socketid", "");
    //                                         switch (currentroute) {
    //                                             case 'communication_group_details':
    //                                                 if ($('#modal-communication-group-employee-group-selection').length > 0) {
    //                                                     processCommunicationGroupCreateEmployeeGroupsList(response, function () { })
    //                                                 }
    //                                                 break;
    //                                             default:
    //                                                 break;
    //                                         }

    //                                     }
    //                                 });
    //                                 $(document).on('click', '.searchclosebtn', function () {
    //                                     if ($('#modal-communication-group-employee-group-selection').length > 0) {
    //                                         processCommunicationGroupCreateEmployeeGroupsList(response, function () { })
    //                                     }
    //                                 })
    //                             }
    //                         }, 0);
    //                     });
    //                     removeLoader();
    //                 });
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 Materialize.toast(`No Employee Groups Found.`, 3000, 'round success-alert');
    //             })
    //     }
    // });

    $(document).on('click', '#add_communication_group_employee_members', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getGroupType = sessionStorage.getItem('group_from');
        if (getGroupType == "contact_list") {
            addLoader();
            digibiz.communicationGroupEmployeeSelectionList = [];
            digibiz.alreadySelected = [];
            var getMembers = [];
            if ($('.communication-group-employee-member-wrapper').length > 0) {
                $.each($('.communication-group-employee-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-dj-unique-employee-id'),
                        type: "new_member"
                    });
                    digibiz.alreadySelected.push({
                        id: $(element).attr('data-dj-unique-employee-id'),
                        type: "new_member"
                    })
                });
            }
            if ($('#communication-group-employee-members-list').find('.communication-group-member-wrapper').length > 0) {
                $.each($('#communication-group-employee-members-list .communication-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-employee-id'),
                        type: "old_member"
                    });
                    digibiz.alreadySelected.push({
                        id: $(element).attr('data-employee-id'),
                        type: "old_member"
                    })
                });
            }
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "list_only_active",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: 0
            }
            employeeList(reqParam)
                .then((response) => {
                    //console.log("employeeList response", response);
                    var modal_data = {
                        modal_id: "modal-communication-group-employees-selection",
                        modal_header: "Employee List",
                        modal_platform: crossplat.device.platform,
                        modal_body: `<div id="communication-group-employees-selection-list-main-container">
                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                             <div class="expand-search-wrap" id="communication-group-create-employee-group-list-search-btn">
                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                             <span class="searchclosebtn"><i class="material-icons hide">close</i></span>
                        </div>
                        <div id="communication-group-employees-selection-list-wrapper"></div>
                        </div>`,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-communication-group-selected-employees",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        removeLoader();
                        processCommunicationGroupCreateEmployeeSelectionList(response, function () {
                            setTimeout(function () {
                                listenForCommunicationGroupCreateEmployeeSelectionListScrollEvent($(".modal-popup-content"));
                                var element = $('#modal-communication-group-employees-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('elementSearchCheck', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-employees-selection').length > 0) {
                                                        data['index'] = 'getCommunicationGroupEmployeeMembersSelection';
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-employees-selection').length > 0) {
                                                        processCommunicationGroupCreateEmployeeSelectionList(response, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#modal-communication-group-employees-selection').length > 0) {
                                            processCommunicationGroupCreateEmployeeSelectionList(response, function () { })
                                        }
                                    })
                                }
                            }, 0);
                        });
                    });
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
                })
        } else if (getGroupType == "group_list") {//using group list
            addLoader();
            digibiz.communicationCreateEmployeeGroupsList = [];
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "active_employee_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: 0
            }
            groupsList(reqParam)
                .then((response) => {
                    //console.log("success in groups list", response);
                    var modal_data = {
                        modal_id: "modal-communication-group-employee-group-selection",
                        modal_header: "Employee Group List",
                        modal_platform: crossplat.device.platform,
                        modal_body: `<div id="communication-group-create-employee-group-list-main-container">
                        <div class="search">
                            <div class="expand-search-wrap search-wrapper" id="communication-group-create-employee-group-list-search-btn">
                                <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                <span class="searchclosebtn"><i class="material-icons communication-group-create-employee-group-list-close-btn hide">close</i></span>
                            </div>
                        </div>
                        <div id="communication-group-create-employee-group-list-wrapper"></div>
                        </div>`,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-communication-group-selected-employee-group",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        processCommunicationGroupCreateEmployeeGroupsList(response, function () {
                            setTimeout(function () {
                                appScroll.scrollBar('.modal-popup-content');
                                listenForCommunicationGroupCreateEmployeeGroupsListScrollEvent($(".modal-popup-content"));
                                var element = $('#modal-communication-group-employee-group-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('elementSearchCheck', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-employee-group-selection').length > 0) {
                                                        data['index'] = 'getCommunicationGroupEmployeeGroupSelection';
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-employee-group-selection').length > 0) {
                                                        processCommunicationGroupCreateEmployeeGroupsList(response, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#modal-communication-group-employee-group-selection').length > 0) {
                                            processCommunicationGroupCreateEmployeeGroupsList(response, function () { })
                                        }
                                    })
                                }
                            }, 0);
                        });
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`No Employee Groups Found.`, 3000, 'round success-alert');
                })
        }
    });

    //communication group-> customer members
    $(document).on('click', '#add_communication_group_customer_members', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        digibiz.communicationSelectedContactList = [];
        digibiz.communicationGroupsCustomerContactsList = [];
        digibiz.communicationCreateCustomersGroupsList = [];
        var getGroupType = sessionStorage.getItem('group_from');
        if (getGroupType == "contact_list") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                count: 15,
                offset: 0,
                "list_by": "customer"
            }
            // getCustomerGroupContactList(reqParam)
            customerIdentifierList(reqParam)
                .then((response) => {
                    removeLoader();
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "modal-communication-group-customer-contact-list-selection",
                        modal_header: "Contact List",
                        modal_body: `<div id="communication-group-contacts-items-list-main-container">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="communication-group-contacts-items-list-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons communication-group-contacts-items-list-close-btn hide">close</i></span>
                                        </div>
                                        <div id="communication-group-contacts-items-list-wrapper"></div>
                                        </div>`,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-communication-group-selected-customers",
                        }]
                    }
                    showModal(modal_data, function () {
                        // removeLoader();
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        // processCommunicationGroupCustomerContactsList(response, function () {
                        processCommunicationGroupContactListCustomerList(response, function () {
                            setTimeout(function () {
                                listenForCommunicationGroupContactListCustomerListScrollEvent($(".modal-popup-content"));
                                var element = $('#modal-communication-group-customer-contact-list-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('elementSearchCheck', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-customer-contact-list-selection').length > 0) {
                                                        data['index'] = 'getCustomerIdentifiersTab';//reused
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-customer-contact-list-selection').length > 0) {
                                                        processCommunicationGroupContactListCustomerList(response, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#modal-communication-group-customer-contact-list-selection').length > 0) {
                                            processCommunicationGroupContactListCustomerList(response, function () { })
                                        }
                                    })
                                }
                            }, 0);
                        });
                    });
                })
                .catch((err) => {
                    removeLoader();
                })
        } else if (getGroupType == "group_list") {//using group list
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "customer",
                list_by: "draft_active_customer_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: 0
            }
            groupsList(reqParam)
                .then((response) => {
                    //console.log("success in groups list", response);
                    var modal_data = {
                        modal_id: "modal-communication-group-customer-group-selection",
                        modal_header: "Customer Group List",
                        modal_platform: crossplat.device.platform,
                        modal_body: `<div id="communication-group-create-customer-group-list-main-container">
                        <div class="search">
                            <div class="expand-search-wrap search-wrapper" id="communication-group-create-customer-group-list-search-btn">
                                <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                <span class="searchclosebtn"><i class="material-icons communication-group-create-customer-group-list-close-btn hide">close</i></span>
                            </div>
                        </div>
                        <div id="communication-group-create-customer-group-list-wrapper"></div>
                        </div>`,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-communication-group-selected-customer-group",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        processCommunicationGroupCreateCustomerGroupsList(response, function () {
                            setTimeout(function () {
                                listenForCommunicationGroupCreateCustomerGroupsListScrollEvent($(".modal-popup-content"));
                                var element = $('#modal-communication-group-customer-group-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('elementSearchCheck', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-customer-group-selection').length > 0) {
                                                        data['index'] = 'getCommunicationGroupCustomerGroupSelection';
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-customer-group-selection').length > 0) {
                                                        processCommunicationGroupCreateCustomerGroupsList(response, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#modal-communication-group-customer-group-selection').length > 0) {
                                            processCommunicationGroupCreateCustomerGroupsList(response, function () { })
                                        }
                                    })
                                }
                            }, 0);
                        });
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`No customer groups found.`, 3000, 'round success-alert');
                })
        }
    });

    //communication group-> collaborator members
    $(document).on('click', '#add_communication_group_collaborator_members', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getGroupType = sessionStorage.getItem('group_from');
        if (getGroupType == "group_list") {//using group list only
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "all_my_active_collaborator_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: 0
            }
            collaboratorGroupsList(reqParam)
                .then((response) => {
                    //console.log("success in collaboratorGroupsList", response);
                    var modal_data = {
                        modal_id: "modal-communication-group-collaborator-group-selection",
                        modal_header: "Collaborator Group List",
                        modal_platform: crossplat.device.platform,
                        modal_body: `<div id="communication-group-create-collaborator-group-list-main-container">
                        <div class="search">
                            <div class="expand-search-wrap search-wrapper" id="communication-group-create-collaborator-group-list-search-btn">
                                <span class="searchbtn waves-effect"><i class="material-icons">search</i></span>
                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                <span class="searchclosebtn"><i class="material-icons communication-group-create-collaborator-group-list-close-btn hide">close</i></span>
                            </div>
                        </div>
                        <div id="communication-group-create-collaborator-group-list-wrapper"></div>
                        </div>`,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-communication-group-selected-collaborator-group",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        processCommunicationGroupCreateCollaboratorGroupsList(response, function () {
                            setTimeout(function () {
                                listenForCommunicationGroupCreateCollaboratorGroupsListScrollEvent($(".modal-popup-content"));
                                var element = $('#modal-communication-group-collaborator-group-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('elementSearchCheck', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-collaborator-group-selection').length > 0) {
                                                        data['index'] = 'getCommunicationGroupCollaboratorGroupSelection';
                                                        data['business_id'] = sessionStorage.getItem('business_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'communication_group_details':
                                                    if ($('#modal-communication-group-collaborator-group-selection').length > 0) {
                                                        processCommunicationGroupCreateCollaboratorGroupsList(response, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#modal-communication-group-collaborator-group-selection').length > 0) {
                                            processCommunicationGroupCreateCollaboratorGroupsList(response, function () { })
                                        }
                                    })
                                }
                            }, 0);
                        });
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`No Collaborator Groups Found.`, 3000, 'round success-alert');
                })
        } else {
            removeLoader();
        }
    });


    //add selected employee contact list communication group
    $(document).on('click', '#add-communication-group-selected-employees', function () {
        addLoader();
        if ($('.communication-group-employee-select-btn:checked').length > 0) {
            if (sessionStorage.getItem('group_id')) {//edit case
                var alert_parms = {
                    alert_id: "alert-communication-group-selected-employees-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-communication-group-selected-employees-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-communication-group-selected-employees-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

                // let selectedmembers = [];
                // $.each($('.communication-group-employee-select-btn:checked'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).attr('data-dj-unique-employee-id'),
                //         type: "employee"
                //     });
                //     var index = digibiz.selectedMembers.findIndex(e => e.id == $(element).attr('data-dj-unique-employee-id'));
                //     if (index == -1) {
                //         digibiz.selectedMembers.push(selectedmembers);
                //     }
                // });

                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCommunicationGroupDetailPage();
                //         $('#modal-communication-group-employees-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                $.each($('.communication-group-employee-select-btn:checked'), function (index, element) {
                    var getDJUniqueEmployeeId = $(element).attr('data-dj-unique-employee-id');
                    var getEmployeeName = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text();
                    var getDesignationName = $(element).parents('.employee-selection-list-container').find('.group-designation-name ').text();
                    var getEmployeeNameImageLetter = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                    //console.log("getEmployeeName", getEmployeeName);
                    if (getDJUniqueEmployeeId != undefined) {
                        var index = digibiz.selectedMembers.findIndex(e => e.id == $(element).attr('data-dj-unique-employee-id'));
                        if (index == -1) {
                            var template = `<div class="tooltipped communication-group-employee-member-wrapper member-listing-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
            <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-employee-member-checkbox filled-in" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                <span>${getEmployeeNameImageLetter}</span> 
             </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span>
             <span class="truncate">${getDesignationName}</span></div>
        </div>`;
                            $('#communication-group-employee-members-list').append(template);
                            $('#modal-communication-group-employees-selection').remove();


                            var selectedmembers = {
                                id: getDJUniqueEmployeeId,
                                name: getEmployeeName,
                                designation_name: getDesignationName,
                                imageLetter: getEmployeeNameImageLetter,
                                dj_unique_employee_id: getDJUniqueEmployeeId,
                                selected: true,
                                type: "employee_list"
                            }
                            digibiz.selectedMembers.push(selectedmembers);
                        } else {
                            $('#modal-communication-group-employees-selection').remove();
                        }
                    } else {
                        removeLoader();
                        //console.log("Dj unique employee id is undefined")
                    }
                })
                removeLoader();
            }
            appScroll.scrollBar('#communication-group-employee-members-list');
        } else {
            removeLoader();
            Materialize.toast(`Please select alteast 1 contact`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-communication-group-selected-employees-add-confirm-no', function () {
        $('#alert-communication-group-selected-employees-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-communication-group-selected-employees-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.communication-group-employee-select-btn:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).attr('data-dj-unique-employee-id'),
                type: "employee"
            });
            var index = digibiz.selectedMembers.findIndex(e => e.id == $(element).attr('data-dj-unique-employee-id'));
            if (index == -1) {
                digibiz.selectedMembers.push(selectedmembers);
            }
        });

        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                // getCommunicationGroupDetailPage();
                $('#modal-communication-group-employees-selection').remove();
                $('#alert-communication-group-selected-employees-add-confirm-cancel').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
            sessionStorage.removeItem('group_id')
            location.hash = `communication/groups`;
    })

    //add selected customer contacts to communication group
    $(document).on('click', '#add-communication-group-selected-customers', function () {
        addLoader();
        // if ($('.communication-group-customer-contact-select-btn:checked').length > 0) {
        if ($('.communication-group-customer-contact-select-btn-checkbox-click-wrapper.selected-row').length > 0) {
            if (sessionStorage.getItem('group_id')) {//edit case
                var alert_parms = {
                    alert_id: "alert-communication-group-selected-customers-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-communication-group-selected-customers-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-communication-group-selected-customers-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

                // let selectedmembers = [];
                // $.each($('.communication-group-customer-contact-select-btn:checked'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).attr('data-id'),
                //         type: "customer",
                //         customer_type: $(element).attr('data-type')
                //     });
                // });
                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCommunicationGroupDetailPage();
                //         $('#modal-communication-group-customer-contact-list-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                //console.log("1st time adding");
                $.each($('.communication-group-customer-contact-select-btn-checkbox-click-wrapper.selected-row'), function (index, element) {
                    //console.log("$(element)", $(element));
                    var getCustomerId = $(element).find('.communication-group-customer-contact-select-btn').attr('data-id');
                    //console.log("getCustomerId", getCustomerId);
                    var getCustomerName = $(element).find('.communication-groups-identifier-based-contact-data-wrapper').find('.customer-contact-name span').text();
                    //console.log("getCustomerName", getCustomerName);
                    var getCustomerNameImageLetter = $(element).find('.communication-groups-identifier-based-contact-data-wrapper').find('.customer-contact-name span').text().charAt(0);
                    //console.log("getCustomerNameImageLetter", getCustomerNameImageLetter);
                    var getCustomerType = $(element).find('.communication-group-customer-contact-select-btn').attr('data-type');
                    //console.log("getCustomerType", getCustomerType);
                    var getRoleId = $(element).find('.communication-group-customer-contact-select-btn').attr('data-role-id');
                    //console.log("getRoleId", getRoleId);
                    var getRoleType = $(element).find('.communication-group-customer-contact-select-btn').attr('data-role-type');
                    //console.log("getRoleType", getRoleType);
                    var getRoleBusinessID = $(element).find('.communication-group-customer-contact-select-btn').attr('data-role-business-id');
                    //console.log("getRoleBusinessID", getRoleBusinessID);
                    var getRoleBusinessName = $(element).find('.customer-role-business-name span').text();
                    //console.log("getRoleBusinessName", getRoleBusinessName);
                    var getMoreInfo = $(element).find('.communication-group-customer-contact-select-btn').attr('data-more-info');
                    console.log("getMoreInfo", getMoreInfo);
                    console.log('getCustomerType', getCustomerType);
                    if (getCustomerType == "associate_customer") {
                        // var getParentCustomerId = $(element).find(`.communication-groups-identifier-based-contact-data-wrapper[data-id="${getCustomerId}"]`).attr('data-parent-customer-id');
                        var getParentCustomerId = $(element).attr('data-parent-customer-id');
                        //console.log("getParentCustomerId", getParentCustomerId);
                        var getIdentifierId = $(element).parents(`.accordion-contenttt[data-content-type="contact_item"]`).siblings(`.accordion-titleee[data-type="contact_item"]`).attr('data-associate-customer-identifier-id');
                        //console.log("getIdentifierId", getIdentifierId);
                        var getParentCustomerIdentifierId = $(element).parents(`.accordion-contenttt[data-content-type="identifier"]`).attr('id');
                        var getAssociateCustomerInfo = $(element).find('.associate-customer-info span').text();
                        console.log("getAssociateCustomerInfo", getAssociateCustomerInfo);
                        if (getCustomerId != undefined) {
                            var members = {
                                id: getCustomerId,
                                name: getCustomerName,
                                imageLetter: getCustomerNameImageLetter,
                                customer_type: getCustomerType,
                                role_id: getRoleId,
                                role_type: getRoleType,
                                role_business_id: getRoleBusinessID,
                                role_business_name: getRoleBusinessName,
                                // main_identifier: getMainIdentifier,
                                parent_customer_id: getParentCustomerId,
                                parent_customer_identifier_id: getParentCustomerIdentifierId,
                                identifier_id: getIdentifierId,
                                associate_customter_info: getAssociateCustomerInfo,
                                more_info: getMoreInfo,
                                type: "associate_customer",
                                selected: true
                            }
                            console.log('members', members)
                            var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                            if (index == -1) {
                                digibiz.selectedMembers.push(members);
                                // }
                                if (getRoleType == "employee") {
                                    var template = `<div class="tooltipped communication-group-customer-member-wrapper member-listing-wrapper" data-id="${getCustomerId}" data-identifier-id="${getIdentifierId}" data-parent-customer-identifier-id="${getParentCustomerIdentifierId}" data-parent-customer-id="${getParentCustomerId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-customer-member-checkbox filled-in" value="${getCustomerId}" data-type="${getCustomerType}" data-parent-customer-id="${getParentCustomerId}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                            <span class="truncate" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                            <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                            <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMoreInfo}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    $('#communication-group-customer-members-list').append(template);
                                    if ($('.communication-group-customer-contact-select-btn-checkbox-click-wrapper.selected-row').length == (index + 1)) {
                                        //console.log("@@KILLING")
                                        $('#modal-communication-group-customer-contact-list-selection').remove();
                                    }
                                } else {
                                    var template = `<div class="tooltipped communication-group-customer-member-wrapper member-listing-wrapper" data-id="${getCustomerId}" data-identifier-id="${getIdentifierId}" data-parent-customer-identifier-id="${getParentCustomerIdentifierId}" data-parent-customer-id="${getParentCustomerId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-customer-member-checkbox filled-in" value="${getCustomerId}" data-type="${getCustomerType}" data-parent-customer-id="${getParentCustomerId}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                            <span class="truncate" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                            <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getAssociateCustomerInfo}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    $('#communication-group-customer-members-list').append(template);
                                }
                                if ($('.communication-group-customer-contact-select-btn-checkbox-click-wrapper.selected-row').length == (index + 1)) {
                                    //console.log("@@KILLING")
                                    $('#modal-communication-group-customer-contact-list-selection').remove();
                                }
                            }
                        } else {
                            removeLoader();
                            //console.log("customer id is undefined")
                        }
                    } else {
                        var getIdentifierId = $(element).parents(`.accordion-contenttt[data-content-type="identifier"]`).attr('id');
                        //console.log("getIdentifierId", getIdentifierId);
                        if (getCustomerId != undefined) {
                            var members = {
                                id: getCustomerId,
                                name: getCustomerName,
                                imageLetter: getCustomerNameImageLetter,
                                customer_type: getCustomerType,
                                role_id: getRoleId,
                                role_type: getRoleType,
                                role_business_id: getRoleBusinessID,
                                role_business_name: getRoleBusinessName,
                                // main_identifier: getMainIdentifier,
                                // parent_customer_id: getParentCustomerId,
                                // parent_customer_identifier_id: getParentCustomerIdentifierId,
                                // identifier_id:getIdentifierId,
                                // associate_customter_info: getAssociateCustomerInfo,
                                more_info: getMoreInfo,
                                type: "customer",
                                selected: true
                            }
                            console.log('members', members)
                            var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                            if (index == -1) {
                                digibiz.selectedMembers.push(members);
                                // }
                                if (getRoleType == "employee") {
                                    var template = `<div class="tooltipped communication-group-customer-member-wrapper member-listing-wrapper" data-id="${getCustomerId}" data-identifier-id="${getIdentifierId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-customer-member-checkbox filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>                                                        
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                            <span class="truncate" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                            <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                            <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMoreInfo}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    $('#communication-group-customer-members-list').append(template);
                                    if ($('.communication-group-customer-contact-select-btn-checkbox-click-wrapper.selected-row').length == (index + 1)) {
                                        //console.log("@@KILLING")
                                        $('#modal-communication-group-customer-contact-list-selection').remove();
                                    }
                                } else {
                                    var template = `<div class="tooltipped communication-group-customer-member-wrapper member-listing-wrapper" data-id="${getCustomerId}" data-identifier-id="${getIdentifierId}">
                                                    <div class="file-select">
                                                        <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-customer-member-checkbox filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                        <i class="material-icons">done</i>
                                                        <div class="profile-text group-profile-text text-small-size">
                                                            <span>${getCustomerNameImageLetter}</span> 
                                                        </div>                                                        
                                                    </div>
                                                    <div class="filemanager-file-wrapper">
                                                        <div>
                                                            <span class="truncate" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                            <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMoreInfo}</span>
                                                        </div>
                                                    </div>
                                                </div>`;
                                    $('#communication-group-customer-members-list').append(template);
                                }
                                if ($('.communication-group-customer-contact-select-btn-checkbox-click-wrapper.selected-row').length == (index + 1)) {
                                    //console.log("@@KILLING")
                                    $('#modal-communication-group-customer-contact-list-selection').remove();
                                }
                            }
                        } else {
                            removeLoader();
                            //console.log("customer id is undefined")
                        }
                    }

                })
                removeLoader();
            }
            appScroll.scrollBar('#communication-group-customer-members-list');
        } else {
            removeLoader();
            Materialize.toast(`Please select alteast 1 contact`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-communication-group-selected-customers-add-confirm-no', function () {
        $('#alert-communication-group-selected-customers-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-communication-group-selected-customers-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.communication-group-customer-contact-select-btn:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).attr('data-id'),
                type: "customer",
                customer_type: $(element).attr('data-type')
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                getCommunicationGroupDetailPage();
                $('#modal-communication-group-customer-contact-list-selection').remove();
                $('#alert-communication-group-selected-customers-add-confirm-cancel').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })


    //add selected employee groups to the comuunication group
    $(document).on('click', '#add-communication-group-selected-employee-group', function () {
        addLoader();
        if ($('.communication-group-create-employee-group-selected:checked').length > 0) {
            if (sessionStorage.getItem('group_id')) {//edit case

                var alert_parms = {
                    alert_id: "alert-communication-group-selected-employees-groups-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-communication-group-selected-employees-groups-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-communication-group-selected-employees-groups-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

                // let selectedmembers = [];
                // $.each($('.communication-group-create-employee-group-selected:checked'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).parents('.group-selection-wrapper').attr('data-group-id'),
                //         type: "employee_group"
                //     });
                // });
                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCommunicationGroupDetailPage();
                //         $('#modal-communication-group-employee-group-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                $.each($('.communication-group-create-employee-group-selected:checked'), function (index, element) {
                    var getGroupId = $(element).parents('.group-selection-wrapper').attr('data-group-id');
                    var getGroupName = $(element).parents('.group-selection-wrapper').find('.employee-group-name').text();
                    var getGroupNameImageLetter = $(element).parents('.group-selection-wrapper').find('.employee-group-name').text().charAt(0);
                    var getGroupType = $(element).parents('.group-selection-wrapper').attr('data-standard-custom-type');
                    //console.log("getGroupName", getGroupName);
                    if (getGroupType == "standard") {
                        var getDepartmentId = $(element).parents('.group-selection-wrapper').attr('data-department-id');
                        if (getGroupId != undefined) {
                            var template = `<div class="tooltipped communication-group-employee-group-member-wrapper member-listing-wrapper" data-id="${getGroupId}" data-department-id="${getDepartmentId}"><div class="file-select">
            <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-employee-group-member-checkbox filled-in" value="${getGroupId}" id="selected-${getGroupId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                <span>${getGroupNameImageLetter}</span> 
             </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getGroupId}">${getGroupName}</span></div>
        </div>`;
                            $('#communication-group-employee-members-list').append(template);
                            $('#modal-communication-group-employee-group-selection').remove();
                        } else {
                            removeLoader();
                            //console.log("group id is undefined")
                        }
                    } else {
                        if (getGroupId != undefined) {
                            var template = `<div class="tooltipped communication-group-employee-group-member-wrapper member-listing-wrapper" data-id="${getGroupId}"><div class="file-select">
            <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-employee-group-member-checkbox filled-in" value="${getGroupId}" id="selected-${getGroupId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                <span>${getGroupNameImageLetter}</span> 
             </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getGroupId}">${getGroupName}</span></div>
        </div>`;
                            $('#communication-group-employee-members-list').append(template);
                            $('#modal-communication-group-employee-group-selection').remove();
                        } else {
                            removeLoader();
                            //console.log("group id is undefined")
                        }
                    }
                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select alteast 1 group`, 3000, "round error-alert");
        }
    });


    $(document).on('click', '#btn-communication-group-selected-employees-groups-add-confirm-no', function () {
        $('#alert-communication-group-selected-employees-groups-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-communication-group-selected-employees-groups-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.communication-group-create-employee-group-selected:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).parents('.group-selection-wrapper').attr('data-group-id'),
                type: "employee_group"
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                $('#alert-communication-group-selected-employees-groups-add-confirm-cancel').remove();
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                getCommunicationGroupDetailPage();
                $('#modal-communication-group-employee-group-selection').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })


    //add selected customer groups to the comuunication group
    $(document).on('click', '#add-communication-group-selected-customer-group', function () {
        addLoader();
        if ($('.communication-group-create-customer-group-selected:checked').length > 0) {
            if (sessionStorage.getItem('group_id')) {//edit case

                var alert_parms = {
                    alert_id: "alert-communication-group-selected-customers-groups-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-communication-group-selected-customers-groups-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-communication-group-selected-customers-groups-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });

                // let selectedmembers = [];
                // $.each($('.communication-group-create-customer-group-selected:checked'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).parents('.group-selection-wrapper').attr('data-group-id'),
                //         type: "customer_group"
                //     });
                // });
                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCommunicationGroupDetailPage();
                //         $('#modal-communication-group-customer-group-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                $.each($('.communication-group-create-customer-group-selected:checked'), function (index, element) {
                    var getGroupId = $(element).parents('.group-selection-wrapper').attr('data-group-id');
                    var getGroupName = $(element).parents('.group-selection-wrapper').find('.customer-group-name').text();
                    var getGroupNameImageLetter = $(element).parents('.group-selection-wrapper').find('.customer-group-name').text().charAt(0);
                    //console.log("getGroupName", getGroupName);
                    if (getGroupId != undefined) {
                        var template = `<div class="tooltipped communication-group-customer-group-member-wrapper member-listing-wrapper" data-id="${getGroupId}"><div class="file-select">
            <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-customer-group-member-checkbox filled-in" value="${getGroupId}" id="selected-${getGroupId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                <span>${getGroupNameImageLetter}</span> 
             </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getGroupId}">${getGroupName}</span></div>
        </div>`;
                        $('#communication-group-customer-members-list').append(template);
                        $('#modal-communication-group-customer-group-selection').remove();
                    } else {
                        removeLoader();
                        //console.log("group id is undefined")
                    }
                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select alteast 1 group`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#btn-communication-group-selected-customers-groups-add-confirm-no', function () {
        $('#alert-communication-group-selected-customers-groups-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-communication-group-selected-customers-groups-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.communication-group-create-customer-group-selected:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).parents('.group-selection-wrapper').attr('data-group-id'),
                type: "customer_group"
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                getCommunicationGroupDetailPage();
                $('#modal-communication-group-customer-group-selection').remove();
                $('#alert-communication-group-selected-customers-groups-add-confirm-cancel').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })

    //add selected collaborator groups to the comuunication group
    $(document).on('click', '#add-communication-group-selected-collaborator-group', function () {
        addLoader();
        if ($('.communication-group-create-collaborator-group-selected:checked').length > 0) {
            if (sessionStorage.getItem('group_id')) {//edit case
                var alert_parms = {
                    alert_id: "alert-communication-group-selected-collaborator-groups-add-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Already added or existing members
                    won't be added again.Only new members will be added`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-communication-group-selected-collaborator-groups-add-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-communication-group-selected-collaborator-groups-add-confirm-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();

                });
                // let selectedmembers = [];
                // $.each($('.communication-group-create-collaborator-group-selected:checked'), function (index, element) {
                //     selectedmembers.push({
                //         id: $(element).parents('.group-selection-wrapper').attr('data-group-id'),
                //         type: "collaborator_group"
                //     });
                // });
                // var contactlist = removeDuplicates(selectedmembers, 'id');
                // //console.log("contactlist", contactlist);
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     group_id: sessionStorage.getItem('group_id'),
                //     members: contactlist
                // }
                // groupMemberAdd(requestParams)
                //     .then((result) => {
                //         Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                //         getCommunicationGroupDetailPage();
                //         $('#modal-communication-group-collaborator-group-selection').remove();
                //     })
                //     .catch((err) => {
                //         removeLoader();
                //         Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                //     })
            } else {//first time adding
                $.each($('.communication-group-create-collaborator-group-selected:checked'), function (index, element) {
                    var getGroupId = $(element).parents('.group-selection-wrapper').attr('data-group-id');
                    var getGroupName = $(element).parents('.group-selection-wrapper').find('.collaborator-group-name').text();
                    var getGroupNameImageLetter = $(element).parents('.group-selection-wrapper').find('.collaborator-group-name').text().charAt(0);
                    //console.log("getGroupName", getGroupName);
                    if (getGroupId != undefined) {
                        var template = `<div class="tooltipped communication-group-collaborator-group-member-wrapper member-listing-wrapper" data-id="${getGroupId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists communication-group-collaborator-group-member-checkbox filled-in" value="${getGroupId}" id="selected-${getGroupId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getGroupNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getGroupId}">${getGroupName}</span></div>
            </div>`;
                        $('#communication-group-collaborator-members-list').append(template);
                        $('#modal-communication-group-collaborator-group-selection').remove();
                    } else {
                        removeLoader();
                        //console.log("group id is undefined")
                    }
                })
                removeLoader();
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select alteast 1 group`, 3000, "round error-alert");
        }
    });


    $(document).on('click', '#btn-communication-group-selected-collaborator-groups-add-confirm-no', function () {
        $('#alert-communication-group-selected-collaborator-groups-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-communication-group-selected-collaborator-groups-add-confirm-yes', function () {
        addLoader();
        let selectedmembers = [];
        $.each($('.communication-group-create-collaborator-group-selected:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).parents('.group-selection-wrapper').attr('data-group-id'),
                type: "collaborator_group"
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        //console.log("contactlist", contactlist);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            members: contactlist
        }
        groupMemberAdd(requestParams)
            .then((result) => {
                Materialize.toast("Members Added Successfully", 3000, 'round success-alert');
                getCommunicationGroupDetailPage();
                $('#modal-communication-group-collaborator-group-selection').remove();
                $('#alert-communication-group-selected-collaborator-groups-add-confirm-cancel').remove();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in group members adding", 3000, 'round success-alert');
            })
    })


    //communication group save button
    $(document).on('click', '#communication_group_save_button', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getGroupName = $('#communicationGroupName').val().trim();
        var getGroupDescription = $('#communication_group_desc').val().trim();
        // var getGroupVisibility = $('#select-visibility-type').val();
        var getGroupVisibility = $('.selected-value-group-visbility').attr('data-value');
        if (validateCommunicationGroupData()) {
            if (sessionStorage.getItem('group_id')) {
                //save identity-pic
                // saveGroupPicture(function (err, identityResponse) {
                //     if (err) {
                //         removeLoader();
                //         Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                //     } else {
                //         var resultData = identityResponse;
                //         //console.log("resultData", resultData);
                //         var groupImageData = {};
                //         if (resultData != undefined) {
                //             groupImageData = {
                //                 asset_id: resultData.Data.asset_id,
                //                 storage_id: resultData.Data.filename
                //             }
                //         }
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('group_id'),
                    data: {
                        name: firstLetterUpperCase(getGroupName),
                        description: firstLetterUpperCase(getGroupDescription),
                        visibility: getGroupVisibility,
                        // group_image: groupImageData,
                    }
                }
                employeeGroupUpdate(reqparams)
                    .then((response) => {
                        //console.log("communicationGroupUpdate", response);
                        digibiz.groupPictureblob = {};
                        sessionStorage.removeItem('group_type');
                        sessionStorage.removeItem('group_from');
                        sessionStorage.removeItem('group_id');
                        location.hash = `communication/groups`;
                    })
                    .catch((err) => {
                        if (err.msg == 'no updated data found') {
                            digibiz.groupPictureblob = {};
                            sessionStorage.removeItem('group_type');
                            sessionStorage.removeItem('group_from');
                            sessionStorage.removeItem('group_id');
                            location.hash = `communication/groups`;
                        } else {
                            removeLoader();
                            //console.log("err in group update", err);
                        }
                    })
                //     }
                // })
            } else {//first time saving/creating
                //check if the communication group is from contact_list or group list
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    let selectedmembers = [], moderatorData = [];
                    $.each($("input.communication-group-employee-member-checkbox:checked"), function (index, element) {
                        selectedmembers.push({
                            id: $(element).val(),
                            type: "employee"
                        });
                    });
                    $.each($("input.communication-group-customer-member-checkbox:checked"), function (index, element) {
                        selectedmembers.push({
                            id: $(element).val(),
                            type: "customer",
                            customer_type: $(element).attr('data-type')
                        });
                    });
                    $.each($("input.communication-group-moderator-member-not-saved:checked"), function (index, element) {
                        moderatorData.push({
                            id: $(element).attr('value'),
                            type: $(element).attr('data-type'),
                            status: "active"
                        });
                    });
                    var contactlist = removeDuplicates(selectedmembers, 'id');

                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                visibility: getGroupVisibility,
                                group_for: "communication",
                                group_from: sessionStorage.getItem('group_type'),
                                group_type: sessionStorage.getItem('group_from'),
                                name: firstLetterUpperCase(getGroupName),
                                description: firstLetterUpperCase(getGroupDescription),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size,
                                moderator_data: moderatorData
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    sessionStorage.setItem('group_creation_running', true);
                                    //console.log("success in groupAdd", response);
                                    digibiz.selectedMembers = [];
                                    // digibiz.selectedMembers = contactlist;
                                    // console.log("contactlist", digibiz.selectedMembers);
                                    var reqParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: response.id,
                                        members: contactlist
                                        // members: contactlist
                                    }
                                    groupMemberAdd(reqParams)
                                        .then((result) => {
                                            digibiz.groupPictureblob = {};
                                            var reeeqqParams = {
                                                device_id: crossplat.device.uuid,
                                                id: response.id,
                                                type: "com_group_add",
                                                moderator_data: []
                                            }
                                            groupModeratorAdd(reeeqqParams)
                                                .then((response) => {
                                                    //console.log("groupModeratorAdd", response);
                                                })
                                                .catch((err) => {
                                                    removeLoader();
                                                    // Materialize.toast(err.msg, 3000, "round error-alert");
                                                })

                                            sessionStorage.removeItem('group_type');
                                            sessionStorage.removeItem('group_from');
                                            sessionStorage.removeItem('group_id');
                                            sessionStorage.removeItem('group_creation_running');

                                        })
                                        .catch((err) => {
                                            removeLoader();
                                            Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                                        })
                                    // var reeeqqParams = {
                                    //     device_id: crossplat.device.uuid,
                                    //     id: response.id,
                                    //     type: "com_group_add",
                                    //     moderator_data: []
                                    // }
                                    // groupModeratorAdd(reeeqqParams)
                                    //     .then((response) => {
                                    //         //console.log("groupModeratorAdd", response);
                                    //     })
                                    //     .catch((err) => {
                                    //         removeLoader();
                                    //         // Materialize.toast(err.msg, 3000, "round error-alert");
                                    //     })
                                    location.hash = `communication/groups`;

                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                        }
                    })
                } else {//group list
                    let selectedmembers = [];
                    $.each($("input.communication-group-employee-group-member-checkbox:checked"), function () {
                        selectedmembers.push({
                            id: $(this).val(),
                            type: "employee_group"
                        });
                    });
                    $.each($("input.communication-group-collaborator-group-member-checkbox:checked"), function () {
                        selectedmembers.push({
                            id: $(this).val(),
                            type: "collaborator_group"
                        });
                    });
                    $.each($("input.communication-group-customer-group-member-checkbox:checked"), function () {
                        selectedmembers.push({
                            id: $(this).val(),
                            type: "customer_group",
                        });
                    });
                    var contactlist = removeDuplicates(selectedmembers, 'id');
                    //console.log("contactlist", contactlist);
                    //save identity-pic
                    saveGroupPictureFirstTime(function (err, identityResponse) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            // var resultData = identityResponse;
                            // //console.log("resultData", resultData);
                            // var groupImageData = {};
                            // if (resultData != undefined) {
                            //     groupImageData = {
                            //         asset_id: resultData.Data.asset_id,
                            //         storage_id: resultData.Data.filename
                            //     }
                            // }
                            let requestParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id'),
                                visibility: getGroupVisibility,
                                group_for: "communication",
                                group_from: sessionStorage.getItem('group_type'),
                                group_type: sessionStorage.getItem('group_from'),
                                name: firstLetterUpperCase(getGroupName),
                                description: firstLetterUpperCase(getGroupDescription),
                                thumbnail_content: identityResponse,
                                size: digibiz.groupPictureblob.size
                            }
                            groupAdd(requestParams)
                                .then((response) => {
                                    sessionStorage.setItem('group_creation_running', true);
                                    //console.log("success in groupAdd", response);
                                    var reqParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: response.id,
                                        members: contactlist
                                    }
                                    groupMemberAdd(reqParams)
                                        .then((result) => {
                                            digibiz.groupPictureblob = {};
                                            sessionStorage.removeItem('group_type');
                                            sessionStorage.removeItem('group_from');
                                            sessionStorage.removeItem('group_id');
                                            sessionStorage.removeItem('group_creation_running');
                                        })
                                        .catch((err) => {
                                            removeLoader();
                                            Materialize.toast("Error in group members adding", 3000, 'round success-alert');
                                        })
                                    var reeeqqParams = {
                                        device_id: crossplat.device.uuid,
                                        id: response.id,
                                        type: "com_group_add",
                                        moderator_data: []
                                    }
                                    groupModeratorAdd(reeeqqParams)
                                        .then((response) => {
                                            //console.log("groupModeratorAdd", response);
                                            // location.hash = `communication/groups`;
                                        })
                                        .catch((err) => {
                                            removeLoader();
                                            Materialize.toast(err.msg, 3000, "round error-alert");
                                        })
                                    location.hash = `communication/groups`;
                                })
                                .catch((err) => {
                                    removeLoader();
                                    Materialize.toast("Error in group creation", 3000, 'round success-alert');
                                })
                        }
                    })
                }
            }
        } else {
            removeLoader();
        }
    });

    //no communication group initial moderator
    $(document).on('click', '#btn-communication-group-initial-add-moderator-cancel-no', function () {
        addLoader();
        sessionStorage.removeItem('group_type');
        sessionStorage.removeItem('group_from');
        sessionStorage.removeItem('group_id');
        $('#alert-communication-group-initial-add-moderator-confirm-cancel').remove();
        location.hash = `communication/groups`;
    });

    //yes communication group initial moderator(not-used)
    $(document).on('click', '#btn-communication-group-initial-add-moderator-confirm-yes', function () {
        addLoader();
        var groupId = $('#alert-communication-group-initial-add-moderator-confirm-cancel').attr('data-group-id');
        $('#alert-communication-group-initial-add-moderator-confirm-cancel').remove();
        var reqparams = {
            device_id: crossplat.device.uuid,
            group_id: groupId
        }
        getGroupMembers(reqparams)
            .then((memresponse) => {
                var response = memresponse.membersList;
                //console.log("success", response);
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    var getData = {
                        dataList: response.map(e => {
                            if (e.member.type == "employee") {
                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                    // } else {
                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                    // }
                                } else {
                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                }
                            } else if (e.member.type == "customer") {
                                if (e.member.customer_type == "customer") {
                                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                        var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                        e.identity_picture['avtarUrl'] = avtarUrl;
                                        e['imageLetter'] = e.member_name.first.charAt(0);
                                        // } else {
                                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                                        // }
                                    } else {
                                        e['imageLetter'] = e.member_name.first.charAt(0);
                                    }
                                } else if (e.member.customer_type == "associate_customer") {
                                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                        var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                        e.identity_picture['avtarUrl'] = avtarUrl;
                                        e['imageLetter'] = e.member_name.first.charAt(0);
                                        // } else {
                                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                                        // }
                                    } else {
                                        e['imageLetter'] = e.member_name.first.charAt(0);
                                    }
                                }
                            }
                            return e;
                        }),
                        page_for: "contact_list_moderator"
                    }
                    //console.log("getData", getData);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-communication-group-moderator-selection",
                            modal_header: "Members list",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-communication-group-selected-moderator",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#modal-communication-group-moderator-selection').find('#modal-close-btn').remove();
                            $('#modal-communication-group-moderator-selection').attr('data-at', 'initial');
                            $('#modal-communication-group-moderator-selection').attr('data-group-id', groupId);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            removeLoader();
                        });
                    }, 'page/communication/moderator_selection_list', '#moderator-selection-list-template', getData);
                } else if (sessionStorage.getItem('group_from') == "group_list") {//group_list
                    var getData = {
                        dataList: response.map(e => {
                            if (e.member.type == "employee_group") {
                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.member_name.charAt(0);
                                    // } else {
                                    //     e['imageLetter'] = e.member_name.charAt(0);
                                    // }
                                } else {
                                    e['imageLetter'] = e.member_name.charAt(0);
                                }
                            } else if (e.member.type == "customer_group") {
                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.member_name.charAt(0);
                                    // } else {
                                    //     e['imageLetter'] = e.member_name.charAt(0);
                                    // }
                                } else {
                                    e['imageLetter'] = e.member_name.charAt(0);
                                }
                            }
                            return e;
                        }),
                        page_for: "group_list_moderator"
                    }
                    //console.log("getData", getData);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-communication-group-create-group-list-moderator-selection",
                            modal_header: "Members list",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Add Moderator",
                                "id": "add-communication-group-create-group-list-selected-moderator",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#modal-communication-group-create-group-list-moderator-selection').attr('data-group-id', groupId);
                            $('#modal-communication-group-create-group-list-moderator-selection').attr('data-at', 'initial')
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            removeLoader();
                        });
                    }, 'page/communication/moderator_selection_list', '#moderator-selection-list-template', getData);
                }
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No group Members Found`, 3000, 'round success-alert');
            })
    });

    //view communication group
    $(document).on('click', '.view-communication-group', function () {
        addLoader();
        var getGroupId = $(this).parents('.communication-group-wrapper').attr('data-id');
        sessionStorage.removeItem('group_id');
        sessionStorage.setItem('group_id', getGroupId);
        var socket_enable_status = $(this).parents('.communication-group-wrapper').attr('data-socket_enable_status');
        var getGroupCreatedStatus = $(this).parents('.communication-group-wrapper').attr('data-created_status');
        if (getGroupCreatedStatus && getGroupCreatedStatus == "progress") {
            removeLoader();
            Materialize.toast(`Group creation/updation in progress, please wait......might take few moments`, 3000, 'round error-alert');
        } else {
            digibiz.selectedMembers = [];
            if (socket_enable_status == "true") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: getGroupId,
                    data: {
                        socket_enable_status: "false",
                        update_for: "socket_enable_status"
                    }
                }
                //console.log("reqParam", reqParam);
                employeeGroupUpdate(reqParam)
                    .then((response) => {
                        console.log('response', response);
                    }).catch((err) => {
                        console.log('err', err);
                    })

                location.hash = `communication/group_details`;
            } else {
                Materialize.toast(`Access Denied! You or other administrator is updating this group at other place.`, 3000, "round error-alert");
                var alert_parms = {
                    alert_id: "alert-group-device-change-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Access Denied! You or other administrator is updating this group at other place. Would to like to cancel there and continue here?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-group-device-change-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-group-device-change-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                    $('#alert-group-device-change-confirm-cancel').attr('data-group-id', getGroupId); //set getEmployeeId
                    // $('#alert-group-device-change-confirm-cancel').attr('data-group-type', getGroupType); //set getEmployeeId           
                });
            }
        }
    });

    //view communication employee group
    $(document).on('click', '.view-communication-employee-group', function () {
        addLoader();
        var getGroupId = $(this).parents('.communication-employee-group-wrapper').attr('data-id');
        sessionStorage.removeItem('group_id');
        sessionStorage.setItem('group_id', getGroupId);
        digibiz.selectedMembers = [];
        location.hash = `communication/employee/group_details`;
    });

    //view communication customer group
    $(document).on('click', '.view-communication-customer-group', function () {
        addLoader();
        var getGroupId = $(this).parents('.communication-customer-group-wrapper').attr('data-id');
        sessionStorage.removeItem('group_id');
        sessionStorage.setItem('group_id', getGroupId); 3
        digibiz.selectedMembers = [];
        location.hash = `communication/customer/group_details`;
    });

    //cancel communication employee group
    $(document).on('click', '#communication_employee_group_cancel_button', function () {
        addLoader();
        sessionStorage.removeItem('group_id');
        digibiz.selectedMembers = [];
        location.hash = `communication/groups`;
    });

    //cancel communication customer group
    $(document).on('click', '#communication_customer_group_cancel_button', function () {
        addLoader();
        sessionStorage.removeItem('group_id');
        digibiz.selectedMembers = [];
        location.hash = `communication/groups`;


    });

    // //delete any member in communication group
    // $(document).on('click', '#delete_communication_group_employee_member, #delete_communication_group_customer_member', function () {
    //     addLoader();
    //     var getMemberId = $(this).attr('data-member-id');
    //     var alert_parms = {
    //         alert_id: "alert-delete-communication-group-member-confirm-cancel",
    //         alert_platform: crossplat.device.platform,
    //         alert_title: `Delete Member`,
    //         alert_body: `Are you sure you want to delete the member?`,
    //         alert_btn: [{
    //             name: "Yes",
    //             attr: [{ name: "id", value: "btn-delete-communication-group-member-confirm-yes" }]
    //         },
    //         {
    //             name: "No",
    //             attr: [{ name: "id", value: "btn-delete-communication-group-member-cancel-no" }]
    //         }]
    //     }
    //     showAlert(alert_parms, function () {
    //         removeLoader();
    //         $('#alert-delete-communication-group-member-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
    //     });
    // });

    // //Delete no communication group member
    // $(document).on('click', '#btn-delete-communication-group-member-cancel-no', function () {
    //     $('#alert-delete-communication-group-member-confirm-cancel').remove();
    // });

    // //Delete yes communication group member
    // $(document).on('click', '#btn-delete-communication-group-member-confirm-yes', function () {
    //     addLoader();
    //     var getMemberId = $('#alert-delete-communication-group-member-confirm-cancel').attr('data-member-id');
    //     $('#alert-delete-communication-group-member-confirm-cancel').remove();
    //     var requestParams = {
    //         device_id: crossplat.device.uuid,
    //         group_id: sessionStorage.getItem('group_id'),
    //         id: getMemberId
    //     }
    //     groupMemberDelete(requestParams)
    //         .then((response) => {
    //             //console.log("communicationGroupMemberDelete response", response);
    //             $(`.communication-group-member-wrapper[data-member-id="${getMemberId}"]`).remove();
    //             removeLoader();
    //             Materialize.toast(`Successfully removed member`, 3000, 'round success-alert');
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("Error in member removing");
    //             Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
    //         })
    // });

    //communication group cancel button
    $(document).on('click', '#communication_group_cancel_button', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                data: {
                    socket_enable_status: "true",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeGroupUpdate(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('group_type');
                    sessionStorage.removeItem('group_id');
                    sessionStorage.removeItem('group_from');
                    location.hash = `communication/groups`;
                }).catch((err) => {
                    console.log('err', err);
                })
        } else {
            sessionStorage.removeItem('group_type');
            sessionStorage.removeItem('group_id');
            sessionStorage.removeItem('group_from');
            location.hash = `communication/groups`;
        }
        appScroll.scrollBar('#main-container').destroy();
    });


    //communication management group
    $(document).on('click', '#delete_communication_group', function () {
        addLoader();
        var getGroupId = sessionStorage.getItem('group_id');
        var alert_parms = {
            alert_id: "alert-delete-communication-group-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Group`,
            alert_body: `Are you sure you want to delete the group?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-communication-group-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-communication-group-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-communication-group-confirm-cancel').attr('data-group-id', getGroupId); //set getGroupId
        });
    });

    //Delete no communication group
    $(document).on('click', '#btn-delete-communication-group-cancel-no', function () {
        $('#alert-delete-communication-group-confirm-cancel').remove();
    });

    //Delete yes communication group
    $(document).on('click', '#btn-delete-communication-group-confirm-yes', function () {
        addLoader();
        var getGroupId = $('#alert-delete-communication-group-confirm-cancel').attr('data-group-id');
        $('#alert-delete-communication-group-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getGroupId
        }
        employeeGroupDelete(requestParams)
            .then((response) => {
                // //console.log("communicationGroupDelete response", response);
                Materialize.toast(`Successfully deleted group.`, 3000, 'round success-alert');
                sessionStorage.removeItem('group_from');
                sessionStorage.removeItem('group_id');
                sessionStorage.removeItem('group_type');
                location.hash = `communication/groups`;
            })
            .catch((err) => {
                removeLoader();
                //console.log("Error in member removing");
                Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
            })
    });
    /*************COMMUNICATION MANAGEMENT(ends)************************/

    // $(document).on('change', '#business-storage-type-choose-select-dropdown', function () {
    //     var reqParams = {
    //         device_id: crossplat.device.uuid,
    //         platform: crossplat.device.platform,
    //         business_id: sessionStorage.getItem('business_id')
    //     }
    //     // googleStorage(reqParams, function (e) { });
    //     googleStorage(reqParams)
    //         .then((response) => {
    //             //console.log("success in google drive", response);
    //         })
    //         .catch((err) => {
    //             //console.log("error in google drive", err);
    //         })
    // });

    $(document).on('change', '#business-storage-type-choose-select-dropdown', function () {
        if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {

        } else {
            //check whether is it edit/add
            var current_url = location.href.split('#').pop();
            var data_from;
            if (current_url && current_url.includes('business/add')) {
                data_from = "create";
            } else if (current_url && current_url.includes('business/edit')) {
                data_from = "edit";
            }
            if ($(this).val() == "GoogleDrive") {
                window.open(`${api.digibiz_google_storage}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&business_id=${sessionStorage.getItem('business_id')}&data_from=${data_from}`, "_self");
            } else if ($(this).val() == "DropBox") {
                window.open(`${api.digibiz_dropbox_storage}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&business_id=${sessionStorage.getItem('business_id')}&data_from=${data_from}`, "_self");
            } else if ($(this).val() == "OneDrive") {
                window.open(`${api.digibiz_onedrive_storage}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&business_id=${sessionStorage.getItem('business_id')}&data_from=${data_from}`, "_self");
            }
            // Materialize.toast($(this).val() + " is set as default storage. And is active now.", 3000, 'success-alert');
        }
    });



    $(document).on('click', '.view-customer-business', function () {
        addLoader();
        var $this = $(this);
        var getBusinessId = $($this).parents('.employee-business-wrapper').attr('data-business-id');
        var getBusinessName = $($this).parents('.employee-business-wrapper').attr('data-business-id');
        var getCustomerStatus = $($this).parents('.employee-business-wrapper').attr('data-status');
        var getRoleId = $($this).parents('.employee-business-wrapper').attr('data-role_id');
        var getRoleType = $($this).parents('.employee-business-wrapper').attr('data-role_type');
        var getRoleStatus = $($this).parents('.employee-business-wrapper').attr('data-role_status');
        if (getCustomerStatus == "active") {
            var reqParamss = {
                device_id: crossplat.device.uuid,
                id: getBusinessId
            }
            businessGet(reqParamss)
                .then((result) => {
                    if (result.status.status == "self-verified" || result.status.status == "inactive_pending") {
                        // if(getRoleStatus == "active") {
                        var requestParams = {
                            device_id: crossplat.device.uuid,
                            selected: true,
                            id: getBusinessId,
                            type: "business"
                        }
                        fetch.apiCall(function (response, status, xhr) {
                            if (status === "success") {
                                var getCustomerType = $($this).parents('.employee-business-wrapper').attr('data-customer-type');
                                if (getCustomerType == "customer") {
                                    var getIdentifierId = $($this).parents('.employee-business-wrapper').attr('data-customer-identifier-id');
                                    var getIdentifierItemId = $($this).parents('.employee-business-wrapper').attr('data-identifier-item-id');
                                    var customerId = $($this).parents('.employee-business-wrapper').attr('data-customer-id');
                                    sessionStorage.setItem('business_id', getBusinessId);
                                    sessionStorage.setItem('business_name', result.name);
                                    sessionStorage.setItem('customer_type', getCustomerType);
                                    sessionStorage.setItem('customer_identifier_id', getIdentifierId);
                                    sessionStorage.setItem('identifier_item_id', getIdentifierItemId);
                                    sessionStorage.setItem('customer_id', customerId);
                                    sessionStorage.setItem('customer_cloud_folder', result.customer_cloud_folder);
                                    location.hash = `customer/business/apps/hub`;
                                    // var reqParam = {
                                    //     device_id: crossplat.device.uuid,
                                    //     get_by: "identifier",
                                    //     business_id: getBusinessId,
                                    //     identifier_id: getIdentifierId,
                                    //     core_user_id: sessionStorage.getItem('user_id')
                                    // }
                                    // customerGet(reqParam)
                                    //     .then((response) => {
                                    //         //console.log("qwert", response);
                                    //         // sessionStorage.setItem('customer_id', response.id);
                                    //         location.hash = `customer/business/apps/hub`;
                                    //     })
                                    //     .catch((err) => {
                                    //         //console.log("Error in getting customer id");
                                    //         removeLoader();
                                    //     })
                                } else if (getCustomerType == "associate_customer") {
                                    var getAssociateIdentifierId = $($this).parents('.employee-business-wrapper').attr('data-associate-identifier-id');
                                    var getParentIdentifierId = $($this).parents('.employee-business-wrapper').attr('data-parent-identifier-id');
                                    var getIdentifierItemId = $($this).parents('.employee-business-wrapper').attr('data-identifier-item-id');
                                    var customerId = $($this).parents('.employee-business-wrapper').attr('data-customer-id');
                                    var parentCustomerId = $($this).parents('.employee-business-wrapper').attr('data-parent-customer-id');
                                    sessionStorage.setItem('business_id', getBusinessId);
                                    sessionStorage.setItem('business_name', result.name);
                                    sessionStorage.setItem('customer_type', getCustomerType);
                                    sessionStorage.setItem('associate_customer_identifier_id', getAssociateIdentifierId);
                                    sessionStorage.setItem('parent_identifier_id', getParentIdentifierId);
                                    sessionStorage.setItem('identifier_item_id', getIdentifierItemId);
                                    sessionStorage.setItem('customer_id', customerId);
                                    sessionStorage.setItem('customer_cloud_folder', result.customer_cloud_folder);
                                    sessionStorage.setItem('parent_customer_id', parentCustomerId);
                                    location.hash = `customer/business/apps/hub`;
                                    // var reqParam = {
                                    //     device_id: crossplat.device.uuid,
                                    //     get_by: "identifier",
                                    //     business_id: sessionStorage.getItem('business_id'),
                                    //     identifier_id: getAssociateIdentifierId,
                                    // }
                                    // associateCustomerGet(reqParam)
                                    //     .then((response) => {
                                    //         //console.log("qwert", response);
                                    //         sessionStorage.setItem('customer_id', response.id);
                                    //         location.hash = `customer/business/apps/hub`;
                                    //     })
                                    //     .catch((err) => {
                                    //         //console.log("Error in getting customer id");
                                    //         removeLoader();
                                    //     })
                                }
                            } else {
                                var alert_parms = {
                                    alert_id: "alert-no-business-active-storage-available",
                                    alert_platform: crossplat.device.platform,
                                    alert_title: "Alert",
                                    alert_body: `<div>Reauthenticate business Storage. Please contact business owners to reauthenticate the storage.</div>`,
                                    alert_btn: [{
                                        name: "OK",
                                        attr: [{ name: "id", value: "btn-no-business-active-storage-available-ok" }]
                                    }]
                                }
                                showAlert(alert_parms, function () {
                                    removeLoader();
                                });
                            }
                        }, api.check_token, "POST", "JSON", requestParams);
                        // } else {
                        //     removeLoader();
                        //     Materialize.toast(`Role is inactive.`, 3000, "round error-alert");  
                        // }
                    } else {
                        removeLoader();
                        Materialize.toast(`Business is inactive.`, 3000, "round error-alert");
                    }
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("Error in getting business");
                })
        } else if (getCustomerStatus == "accepted") {
            var alert_parms = {
                alert_id: "alert-employee-customer-not-active-box",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `<div>Please wait until administrator activates your account.</div>`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "btn-employee-customer-not-active-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        } else {
            var alert_parms = {
                alert_id: "alert-employee-customer-not-active-box",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `<div>You are inactive. Please contact your business administrators.</div>`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "btn-employee-customer-not-active-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });


    $(document).on('click', '.customer-icon-navigate-app', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var getApp = $(this).attr('data-app');
        // //check if this app is active for this business
        var appName;
        if (getApp == "digibiz_assets") {
            appName = "bizassets";
        } else {
            appName = getApp;
        }
        var requesParam = {
            device_id: crossplat.device.uuid,
            get_by: "check_app",
            business_id: sessionStorage.getItem('business_id'),
            app: appName,
        }
        getAppPermission(requesParam)
            .then((appResponse) => {
                if (appResponse.status.status == "active") {
                    if (getApp == "bizmeet" || getApp == "bizcall") {
                        removeLoader();
                    } else {
                        //add the navigate log
                        addLoader();
                        var reqParam = {};
                        if (sessionStorage.getItem('customer_type') == "customer") {
                            reqParam = {
                                device_id: crossplat.device.uuid,
                                platform: crossplat.device.platform,
                                app: getApp,
                                role: "customer",
                                account_id: sessionStorage.getItem('account_id'),
                                business_id: sessionStorage.getItem('business_id'),
                                customer_type: sessionStorage.getItem('customer_type'),
                                member_id: sessionStorage.getItem('customer_id'),
                                identifier_id: sessionStorage.getItem('customer_identifier_id'),
                                identifier_item_id: sessionStorage.getItem('identifier_item_id')
                            }
                        } else {
                            reqParam = {
                                device_id: crossplat.device.uuid,
                                platform: crossplat.device.platform,
                                app: getApp,
                                role: "customer",
                                account_id: sessionStorage.getItem('account_id'),
                                business_id: sessionStorage.getItem('business_id'),
                                customer_type: sessionStorage.getItem('customer_type'),
                                member_id: sessionStorage.getItem('customer_id'),
                                identifier_id: sessionStorage.getItem('associate_customer_identifier_id'),
                                identifier_item_id: sessionStorage.getItem('identifier_item_id'),
                                parent_identifier_id: sessionStorage.getItem('parent_identifier_id'),
                                parent_customer_id: sessionStorage.getItem('parent_customer_id')
                            }
                        }
                        navigateLogsAdd(reqParam)
                            .then((response) => {
                                //redirect to ask us app
                                // localStorage.setItem("navigate_role", "customer");
                                //console.log("check", localStorage.getItem('navigate_role'));
                                setTimeout(function () {
                                    deviceHelper.navigateApp(getApp);
                                }, 500)
                            })
                            .catch((err) => {
                                removeLoader();
                                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                            })
                    }
                } else if (appResponse.status.status == "inactive") {
                    var alert_parms = {
                        alert_id: "app-permission-not-present-alert",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Access Denied`,
                        alert_body: `This app is inactive. Please contact business administrator.`,
                        alert_btn: [{
                            name: "OK",
                            attr: [{ name: "id", value: "access-denied-app-permission-not-present" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    var alert_parms = {
                        alert_id: "app-permission-not-present-alert",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Access Denied`,
                        alert_body: `This app is not activated by the business. Please contact business administrator.`,
                        alert_btn: [{
                            name: "OK",
                            attr: [{ name: "id", value: "access-denied-app-permission-not-present" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                }
            })
            .catch((err) => {
                //console.log('err', err);
                var alert_parms = {
                    alert_id: "app-permission-not-present-alert",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Access Denied`,
                    alert_body: `This app is not activated by the business. Please contact business administrator.`,
                    alert_btn: [{
                        name: "OK",
                        attr: [{ name: "id", value: "access-denied-app-permission-not-present" }]
                    }
                    ]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            })
    });


















    /**********************EMPLOYEE ACCESS MANAGEMENT**************************/

    $(document).on('click', '#employee_contact_access_assignment_btn', function () {
        addLoader();
        var action_sheet_parms = {
            action_id: "employee_contact_access_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Access",
            action_btn: [{
                name: "Add Access",
                attr: [{ name: "id", value: "employee_control_access_action" }]
            },
                // {
                //     name: "Show Access",
                //     attr: [{ name: "id", value: "employee_contact_show_access_action" }]
                // }
            ]
        }
        showAction(action_sheet_parms, function () {
            removeLoader();
        });
    });

    //employee add contact access
    $(document).on('click', '#employee_control_access_action', function () {
        addLoader();
        var action_sheet_parms = {
            action_id: "employee_control_access_for_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Access For",
            action_btn: [{
                name: "Employee contact",
                attr: [{ name: "id", value: "employee_control_access_for_employee_contact_action" }]
            },
            {
                name: "Customer contact",
                attr: [{ name: "id", value: "employee_control_access_for_customer_contact_action" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $('#employee_contact_access_action_sheet').remove();
            removeLoader();
        });
    });

    //employee show access


    //employee contact add access for employee contact
    $(document).on('click', '#employee_control_access_for_employee_contact_action', function () {
        addLoader();
        var action_sheet_parms = {
            action_id: "employee_control_access_for_employee_contact_type_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Access To",
            action_btn: [{
                name: "Employee List",
                attr: [{ name: "id", value: "employee_control_access_for_employee_contact_employees_action" }]
            },
            {
                name: "Department Wise",
                attr: [{ name: "id", value: "employee_control_access_for_employee_contact_department_wise_action" }]
            },
            {
                name: "Custom Group Wise",
                attr: [{ name: "id", value: "employee_control_access_for_employee_contact_custom_group_action" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            $('#employee_control_access_for_action_sheet').remove();
            removeLoader();
        });
    });

    //add access employee 
    $(document).on('click', '#employee_control_access_for_employee_contact_employees_action', function () {
        addLoader();
        digibiz.access_list = [];
        //check whether this employee has access to only employees/Employee-superadmin and show tick for it
        var requesParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id'),
            access_for: "employee_contact",
            access_to: "employee_wise",
        }
        accessList(requesParam)
            .then((result) => {
                //console.log("accessList", result);
                digibiz.access_list = result;
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "employee-contact-add-access-for-employee-contact-employee-wise-selection-modal",
                        modal_header: "Employee List",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Save",
                            "id": "employee-contact-add-access-for-employee-contact-employee-wise-save-btn",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        $('#employee_control_access_for_employee_contact_type_action_sheet').remove();
                        if (result.length > 0) {
                            $.each(result, function (index, value) {
                                $(`.employee-wise-employee-selected[data-type="${value.access_data.type}"]`).prop('checked', true);
                            });
                        }
                        removeLoader();
                    });
                }, 'layouts/popup/employee_contact_access_employee_wise_list', '#employee-contact-access-employee-wise-list-template', null);

            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching access list.`, 3000, "round error-alert");
            })
    });

    //add access employee wise save button
    $(document).on('click', '#employee-contact-add-access-for-employee-contact-employee-wise-save-btn', function () {
        addLoader();
        var employee_data = [];
        var revoked_data = [];
        //get all checkbox
        // var getCheckboxes = $('.employee-wise-employee-selected');
        // $.each(getCheckboxes, function (index, element) {
        //     if ($(element).is(':checked')) {//checked once send to add contact access api
        //         employee_data.push({
        //             "type": $(element).attr('data-type')
        //         })
        //     }
        // });
        var getCheckboxes = $('.employee-contact-access-employee-wise-wrapper');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).hasClass('selected-row')) {//checked once send to add contact access api
                employee_data.push({
                    "type": $(element).attr('data-type')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.access_list, function (index, element) {
            // var check = $(`.employee-wise-employee-selected[data-type="${element.access_data.type}"]`).is(':checked');
            var check = $(`.employee-contact-access-employee-wise-wrapper[data-type="${element.access_data.type}"]`).hasClass('selected-row');
            // //console.log("check", check);
            if (check == false) {
                revoked_data.push(element);
            }
            employee_data = employee_data.filter((e) => {
                return e.type != element.access_data.type
            })
        });
        //console.log("revoked_data", revoked_data);
        if (employee_data.length > 0 || revoked_data.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "employee",
                member_id: sessionStorage.getItem('employee_id'),
                access_for: "employee_contact",
                access_to: "employee_wise",
                access_data: employee_data
            }
            contactAccessAdd(requestParams)
                .then((response) => {
                    //console.log("contactAccessAdd", response);
                    digibiz.access_list = [];
                    $('#employee-contact-add-access-for-employee-contact-employee-wise-selection-modal').remove();
                    Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: element.id
                    }
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            digibiz.access_list = [];
                            $('#employee-contact-add-access-for-employee-contact-employee-wise-selection-modal').remove();
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                })
            }
        } else {
            removeLoader();
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
        }
    });



    //add access all employees
    $(document).on('click', '#employee_control_access_for_employee_contact_all_employees_action', function () {
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id'),
            access_for: "employee_contact",
            access_to: "all_employees"
        }
        contactAccessAdd(reqparams)
            .then((response) => {
                //console.log("contactAccessAdd", response);
                $('#employee_control_access_for_employee_contact_type_action_sheet').remove();
                Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, "round error-alert");
            })
    });

    //add access department wise
    $(document).on('click', '#employee_control_access_for_employee_contact_department_wise_action', function () {
        addLoader();
        digibiz.access_list = [];
        //first get all the department this employee has access and show tick for it
        var requesParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id'),
            access_for: "employee_contact",
            access_to: "department_wise",
        }
        accessList(requesParam)
            .then((result) => {
                //console.log("accessList", result);
                digibiz.access_list = result;
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    list_by: "department",
                    business_id: sessionStorage.getItem('business_id')
                }
                departmentList(reqParams)
                    .then((departmentResponse) => {
                        //console.log("departmentResponse", departmentResponse);
                        var departmentListResponse = {
                            departmentList: departmentResponse
                        }
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_id: "employee-contact-add-access-for-employee-contact-department-wise-selection-modal",
                                modal_header: "Department List",
                                modal_platform: crossplat.device.platform,
                                modal_body: html,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "employee-contact-add-access-for-employee-contact-department-wise-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                $('#employee_control_access_for_employee_contact_type_action_sheet').remove();
                                if (result.length > 0) {
                                    $.each(result, function (index, value) {
                                        // value.access_data.id
                                        //console.log("present access", value.access_data.id, $(`.sub-department-box[data-id="${value.access_data.id}"]`));
                                        $(`.selected-department[data-id="${value.access_data.id}"]`).prop('checked', true);
                                    });
                                }
                                removeLoader();
                            });
                        }, 'layouts/popup/employee_contact_access_department_list', '#employee-contact-access-department-list-template', departmentListResponse);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`Error in fetching department list.`, 3000, "round error-alert");
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching access list.`, 3000, "round error-alert");
            })
    });

    //add access department wise save button
    $(document).on('click', '#employee-contact-add-access-for-employee-contact-department-wise-save-btn', function () {
        addLoader();
        var department_data = [];
        var revoked_data = [];
        //get all checkbox
        // var getCheckboxes = $('.selected-department');
        // $.each(getCheckboxes, function (index, element) {
        //     if ($(element).is(':checked')) {//checked once send to add contact access api
        //         department_data.push({
        //             "id": $(element).attr('data-id')
        //         })
        //     }
        // });
        var getCheckboxes = $('.employee-contact-access-department-list-data');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).hasClass('selected-row')) {//checked once send to add contact access api
                department_data.push({
                    "id": $(element).attr('data-id')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.access_list, function (index, element) {
            // if ($(`.sub-department-box[data-id="${element.access_data.id}"]`).length > 0) {//check if that elem is present in the modal
            var check = $(`.employee-contact-access-department-list-data[data-id="${element.access_data.id}"]`).hasClass('selected-row');
            // //console.log("check", check);
            if (check == false) {
                revoked_data.push(element);
            }
            department_data = department_data.filter((e) => {
                return e.id != element.access_data.id
            })
            // }
        });
        //console.log("revoked_data", revoked_data);
        if (department_data.length > 0 || revoked_data.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "employee",
                member_id: sessionStorage.getItem('employee_id'),
                access_for: "employee_contact",
                access_to: "department_wise",
                access_data: department_data
            }
            contactAccessAdd(requestParams)
                .then((response) => {
                    digibiz.access_list = [];
                    //console.log("contactAccessAdd", response);
                    $('#employee-contact-add-access-for-employee-contact-department-wise-selection-modal').remove();
                    Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: element.id
                    }
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            digibiz.access_list = [];
                            $('#employee-contact-add-access-for-employee-contact-department-wise-selection-modal').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                })
            }
        } else {
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            removeLoader();
        }
    });

    //add access custom group wise
    $(document).on('click', '#employee_control_access_for_employee_contact_custom_group_action', function () {
        addLoader();
        digibiz.access_list = [];
        //first get all the custom group this employee has access and show tick for it
        var requesParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id'),
            access_for: "employee_contact",
            access_to: "custom_group_wise",
        }
        accessList(requesParam)
            .then((result) => {
                //console.log("accessList", result);
                digibiz.access_list = result;
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id')
                }
                activeCustomGroupEmployeeList(reqParams)
                    .then((response) => {
                        //console.log("activeCustomGroupEmployeeList", response);
                        var activeCustomGroupEmployeeListResponse = {
                            activeCustomGroupEmployeeList: response.map(e => {
                                if (e.hasOwnProperty('group_image') && e.group_image) {
                                    if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                        var avtarUrl = `${api.get_employee_group_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}`;
                                        e.group_image['avtarUrl'] = avtarUrl;
                                        e['imageLetter'] = e.name.charAt(0);
                                    } else {
                                        e['imageLetter'] = e.name.charAt(0);
                                    }
                                } else {
                                    e['imageLetter'] = e.name.charAt(0);
                                }
                                return e;
                            })
                        }
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_id: "employee-contact-add-access-for-employee-contact-custom-group-wise-selection-modal",
                                modal_header: "Custom Group List",
                                modal_platform: crossplat.device.platform,
                                modal_body: html,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "employee-contact-add-access-for-employee-contact-custom-group-wise-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                $('#employee_control_access_for_employee_contact_type_action_sheet').remove();
                                //check all the already given access custom groups
                                if (result.length > 0) {
                                    $.each(result, function (index, value) {
                                        // value.access_data.id
                                        //console.log("present access", value.access_data.id);
                                        $(`.employee-custom-group-wrapper[data-group-id="${value.access_data.id}"]`).find('.custom-group-selected').prop('checked', true);
                                    });
                                }
                                removeLoader();
                            });
                        }, 'layouts/popup/employee_contact_access_custom_group_list', '#employee-contact-access-custom-group-list-template', activeCustomGroupEmployeeListResponse);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`No custom groups found.`, 3000, "round error-alert");
                    })
            })

    });

    //add access custom group wise save button
    $(document).on('click', '#employee-contact-add-access-for-employee-contact-custom-group-wise-save-btn', function () {
        addLoader();
        var custom_group_data = [];
        var revoked_data = [];
        //get all checkbox
        // var getCheckboxes = $('.custom-group-selected');
        // $.each(getCheckboxes, function (index, element) {
        //     if ($(element).is(':checked')) {
        //         custom_group_data.push({
        //             "id": $(element).parents('.employee-custom-group-wrapper').attr('data-group-id')
        //         })
        //     }
        // });
        var getCheckboxes = $('.employee-contact-access-custom-group-list-data');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).hasClass('selected-row')) {
                custom_group_data.push({
                    "id": $(element).attr('data-group-id')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.access_list, function (index, element) {
            // var check = $(`.employee-custom-group-wrapper[data-group-id="${element.access_data.id}"]`).find('.custom-group-selected').is(':checked');
            var check = $(`.employee-contact-access-custom-group-list-data[data-group-id="${element.access_data.id}"]`).find('.custom-group-selected').is(':checked');
            // //console.log("check", check);
            if (check == false) {
                revoked_data.push(element);
            }
            custom_group_data = custom_group_data.filter((e) => {
                return e.id != element.access_data.id
            })
        });
        //console.log("revoked_data", revoked_data);
        if (custom_group_data.length > 0 || revoked_data.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "employee",
                member_id: sessionStorage.getItem('employee_id'),
                access_for: "employee_contact",
                access_to: "custom_group_wise",
                access_data: custom_group_data
            }
            contactAccessAdd(requestParams)
                .then((response) => {
                    //console.log("contactAccessAdd", response);
                    digibiz.access_list = [];
                    $('#employee-contact-add-access-for-employee-contact-custom-group-wise-selection-modal').remove();
                    Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: element.id
                    }
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            digibiz.access_list = [];
                            $('#employee-contact-add-access-for-employee-contact-custom-group-wise-selection-modal').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        })
                        .catch((err) => {
                        })
                })
            }
        } else {
            removeLoader();
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
        }
    });

    //employee contact add access for customer contact
    $(document).on('click', '#employee_control_access_for_customer_contact_action', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer"
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                var getData = {
                    customer_contacts_identifiers_list_data: response,
                };
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "employee-contact-add-access-for-customer-contact-identifier-selection-modal",
                        modal_header: "Identifier Selection",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Next",
                            "id": "employee-contact-add-access-for-customer-contact-identifier-next-btn",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        $('#employee_control_access_for_action_sheet').remove();
                        removeLoader();
                    });
                }, 'layouts/popup/identifier_selection', '#customer-identifier-selection-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching customer identifiers list.`, 3000, "round error-alert");
            })
    });

    //employee - contact add access for customer contact - identifier select next button
    $(document).on('click', '#employee-contact-add-access-for-customer-contact-identifier-next-btn', function () {
        addLoader();
        digibiz.access_list = [];
        // var getIdentifierSelected = $('#select-customer-identifier-for-role-assignment').val();        
        // var getIdentifierId = $('#select-customer-identifier-for-role-assignment').find(`option[value="${getIdentifierSelected}"]`).attr('data-id');
        var getIdentifierSelected = $('.selected-value-customer-identifier-for-role-assignment').attr('data-value');
        var getIdentifierId = $('.selected-value-customer-identifier-for-role-assignment').attr('data-id');
        //console.log("getIdentifierId", getIdentifierId);
        //first get all the identifier items this employee has access and show tick for it
        var requesParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id'),
            access_for: "customer_contact",
            access_to: getIdentifierId
        }
        accessList(requesParam)
            .then((result) => {
                //console.log("accessList", result);
                digibiz.access_list = result;
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    type: "customer",
                    list_by: "primary_customer_identifier",
                    primary_customer_identifier_id: getIdentifierId
                }
                listContactsList(reqParams)
                    .then((response) => {
                        //console.log("listContactsList response", response);
                        var getData = {
                            identifier_items_list_data: response
                        }
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_id: "employee-contact-add-access-for-customer-contact-identifier-item-selection-modal",
                                modal_header: "Identifier Item Selection",
                                modal_platform: crossplat.device.platform,
                                modal_body: html,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "employee-contact-add-access-for-customer-contact-identifier-item-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                $('#employee-contact-add-access-for-customer-contact-identifier-selection-modal').remove();
                                //set identifier id and identifier name
                                $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').attr('data-parent-identifier_id', getIdentifierId);
                                $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').attr('data-parent-identifier_name', getIdentifierSelected);
                                //check the already given identifier item access
                                if (result.length > 0) {
                                    $.each(result, function (index, value) {
                                        // value.access_data.id
                                        //console.log("present access", value.access_data.id);
                                        $(`.customer-identifier-item-wrapper[data-id="${value.access_data.id}"]`).find('.customer-identifier-item-selected').prop('checked', true);
                                    });
                                }
                                removeLoader();
                            });
                        }, 'layouts/popup/identifier_items_list', '#identifier-items-list-data-template', getData);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`Error in fetching customer identifiers items list.`, 3000, "round error-alert");
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching access list.`, 3000, "round error-alert");
            })
    });

    //employee - contact add access for customer contact save btn
    $(document).on('click', '#employee-contact-add-access-for-customer-contact-identifier-item-save-btn', function () {
        addLoader();
        var getPrimaryIdentifierId = $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').attr('data-parent-identifier_id');
        var identifier_item_data = [];
        var revoked_data = [];
        //get all checkbox
        // var getCheckboxes = $('.customer-identifier-item-selected');
        // $.each(getCheckboxes, function (index, element) {
        //     if ($(element).is(':checked')) {
        //         identifier_item_data.push({
        //             "id": $(element).parents('.customer-identifier-item-wrapper').attr('data-id')
        //         })
        //     }
        // });
        var getCheckboxes = $('.identifier-items-list-data');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).hasClass('selected-row')) {
                identifier_item_data.push({
                    "id": $(element).attr('data-id')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.access_list, function (index, element) {
            // var check = $(`.customer-identifier-item-wrapper[data-id="${element.access_data.id}"]`).find('.customer-identifier-item-selected').is(':checked');
            var check = $(`.identifier-items-list-data[data-id="${element.access_data.id}"]`).hasClass('selected-row');
            // //console.log("check", check);
            if (check == false) {
                revoked_data.push(element);
            }
        });
        //console.log("revoked_data", revoked_data);
        if (identifier_item_data.length > 0 || revoked_data.length > 0) {
            if (identifier_item_data.length > 0) {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    type: "employee",
                    member_id: sessionStorage.getItem('employee_id'),
                    access_for: "customer_contact",
                    access_to: getPrimaryIdentifierId,
                    access_data: identifier_item_data
                }
                contactAccessAdd(requestParams)
                    .then((response) => {
                        //console.log("contactAccessAdd", response);
                        $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').remove();
                        Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            }
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: element.id
                    }
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').remove();
                            Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                })
            }
        } else {
            removeLoader();
            Materialize.toast(`No data found to save.`, 3000, "round error-alert");
        }
    });

    //employee - group access
    $(document).on('click', '#employee_group_access_assignment_btn', function () {
        addLoader();
        //first get the group access list and check whether this employee has group access
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id')
        }
        groupAccessList(reqParam)
            .then((result) => {
                var alert_parms = {
                    alert_id: "alert-revoke-group-access-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Revoke Group Access`,
                    alert_body: `Are you sure you want to revoke the group access?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-revoke-group-access-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-revoke-group-access-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    $('#alert-revoke-group-access-confirm-cancel').attr('data-id', result.id);
                    removeLoader();
                });
            })
            .catch((err) => {
                var alert_parms = {
                    alert_id: "alert-give-group-access-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Group Access`,
                    alert_body: `Are you sure you want to provide the group access?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-give-group-access-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-give-group-access-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            })
    });

    //group access give no
    $(document).on('click', '#btn-give-group-access-cancel-no', function () {
        $('#alert-give-group-access-confirm-cancel').remove();
    });

    //group access revoke no
    $(document).on('click', '#btn-revoke-group-access-cancel-no', function () {
        $('#alert-revoke-group-access-confirm-cancel').remove();
    });

    //group access give yes
    $(document).on('click', '#btn-give-group-access-confirm-yes', function () {
        addLoader();
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id')
        }
        groupAccessAdd(requestParams)
            .then((response) => {
                //console.log("groupAccessAdd", response);
                $('#alert-give-group-access-confirm-cancel').remove();
                Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, "round error-alert");
            })
    });

    //group access revoke yes
    $(document).on('click', '#btn-revoke-group-access-confirm-yes', function () {
        addLoader();
        var getId = $('#alert-revoke-group-access-confirm-cancel').attr('data-id');
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId
        }
        groupRevokeAccess(requestParams)
            .then((response) => {
                //console.log("groupRevokeAccess", response);
                $('#alert-revoke-group-access-confirm-cancel').remove();
                Materialize.toast(`Successfully in revoking access.`, 3000, "round error-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, "round error-alert");
            })
    });

    //employee app access
    $(document).on('click', '#employee_app_access_assignment_btn, #customer-app-access-add', function () {//add_new_role_assignment
        addLoader();
        var employeeId;
        if ($('body').attr('app') == "employee_access_list") {
            employeeId = $(this).parents('.employee-access-employee-wrapper').attr('data-id');
        }
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_id: "employee-role-assignment-modal",
                modal_header: "App Access",
                modal_platform: crossplat.device.platform,
                modal_body: html,
                modal_action_buttons: [{
                    "name": "Back",
                    "id": "employee_role_assignment_back_btn",
                    "class": "hide"
                },
                {
                    "name": "Next",
                    "id": "employee_role_assignment_next_btn",
                    "class": "hide"
                },
                {
                    "name": "Save",
                    "id": "employee_role_assignment_save_btn",
                    "class": "hide"
                },
                {
                    "name": "Confirm",
                    "id": "employee_role_assignment_confirm_btn",
                    "class": "hide"
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if ($('body').attr('app') == "employee_access_list") {
                    $('#employee-role-assignment-modal').attr('data-employee-id', employeeId)
                }
                //remove digibiz from the group if customer
                if ($('body').attr('app') == "customer_access_identifiers_item_page") {
                    $('#role-assignment-app-choose-select-dropdown').find(`option[value="digibiz"]`).addClass('hide');
                }
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
            });
        }, 'page/role_management/role_assignment_modal', '#role-assignment-template', null);
    });



    $(document).on('click', '#employee_access_list', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid
        }
        contactAccessList(reqParam)
            .then((response) => {
                //console.log("contactAccessList", response);
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
            })
    });

    $(document).on('click', '#delete_records', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid
        }
        deleteRecords(reqParam)
            .then((response) => {
                //console.log("deleteRecords", response);
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
            })
    });



    /***********CUSTOMER ACCESS MODULE***************/
    $(document).on('click', '.customer-access-module', function () {
        addLoader();
        location.hash = `customer/access/identifiers`;
    });

    $(document).on('click', '.collaborator-business-customer-list-module', function () {
        addLoader();
        location.hash = `customer/collaborators`;
    });

    //on click of customer access identifier wrapper
    $(document).on('click', '.customer-access-identifier-wrapper', function () {
        addLoader();
        var getIdentifierId = $(this).attr('data-id');
        sessionStorage.setItem('identifier_id', getIdentifierId);
        location.hash = `customer/access/identifier/items`;
    });

    //on click of customer access identifier item wrapper
    $(document).on('click', '.customer-access-identifier-item-wrapper', function () {
        addLoader();
        var getIdentifierItemId = $(this).attr('data-id');
        sessionStorage.setItem('identifier_item_id', getIdentifierItemId);
        location.hash = `customer/access/identifier/item/page`;
    });


    //on click of add access button for customer contact access
    $(document).on('click', '#customer-contact-access-add', function () {
        addLoader();
        var action_sheet_parms = {
            action_id: "customer_contact_acess_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Access To",
            action_btn: [{
                name: "Employee Contacts",
                attr: [{ name: "id", value: "customer_contact_add_access_for_employee_contact_action" }]
            },
            {
                name: "Customer Contacts",
                attr: [{ name: "id", value: "customer_contact_add_access_for_customer_contact_action" }]
            }]
        }
        showAction(action_sheet_parms, function () {
            removeLoader();
        });
    })

    //on click of add access button for customer contact access for employees
    $(document).on('click', '#customer_contact_add_access_for_employee_contact_action', function () {
        addLoader();
        digibiz.customer_employee_contact_access_selection = [];
        digibiz.access_list = [];
        //first get all the employees this customer identifier item has access and show tick for it
        var requesParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            access_for: "employee_contact",
            access_to: sessionStorage.getItem('identifier_id'),
            access_item_id: sessionStorage.getItem('identifier_item_id')
        }
        accessList(requesParam)
            .then((result) => {
                digibiz.access_list = result;
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    access_to: sessionStorage.getItem('identifier_id'),
                    access_data_id: sessionStorage.getItem('identifier_item_id')
                }
                identifierItemsEmployeesAccessList(reqParam)
                    .then((response) => {
                        //console.log("response", response);
                        // var getData = {
                        //     employee_Data: response
                        // }
                        // //console.log("getData", getData);
                        // fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "customer-contact-add-access-for-employee-contact-selection-modal",
                            modal_header: "Employee Selection",
                            modal_platform: crossplat.device.platform,
                            // modal_body: html,
                            modal_action_buttons: [{
                                "name": "Save",
                                "id": "customer-contact-add-access-for-employee-contact-save-btn",
                            }],
                            modal_body: `<div id="customer-employee-add-access-list-container-modal">
                <div id="customer-employee-contact-access-selection-content-box"></div></div>`
                        }
                        //console.log("modal_data", modal_data);
                        showModal(modal_data, function () {
                            //console.log("987")
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            //hide save button if no data in the modal
                            // if (digibiz.access_list.length == 0) {
                            //     $('#customer-contact-add-access-for-employee-contact-save-btn').addClass('hide');
                            // }
                            $('#customer_contact_acess_action_sheet').remove();
                            // $('#employee-contact-add-access-for-customer-contact-identifier-selection-modal').remove();
                            // //set identifier id and identifier name
                            // $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').attr('data-parent-identifier_id', getIdentifierId);
                            // $('#employee-contact-add-access-for-customer-contact-identifier-item-selection-modal').attr('data-parent-identifier_name', getIdentifierSelected);
                            //console.log("11")
                            processCustomerEmployeeContactAccessSelection(response, function () {
                                removeLoader();
                                // setTimeout(function () {
                                //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                                // }, 0);
                            });
                        });
                        // }, 'layouts/popup/customer_contact_access_employee_selection', '#customer-contact-access-employee-selection-template', getData);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching custom groups list.`, 3000, "round error-alert");
            })
    });

    //on click of save button for custom identifier item 
    $(document).on('click', '#customer-contact-add-access-for-employee-contact-save-btn', function () {
        addLoader();
        var employee_data = [];
        var revoked_data = [];
        //get all checkbox
        // var getCheckboxes = $('.customer-contact-access-employee-selected');
        var getCheckboxes = $('.customer-contact-access-employee-selected-checkbox-click-wrapper');
        $.each(getCheckboxes, function (index, element) {
            // if ($(element).is(':checked')) {
            if ($(element).hasClass('selected-row')) {
                employee_data.push({
                    "id": $(element).attr('data-id')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.access_list, function (index, element) {
            // var check = $(`.customer-contact-access-employee-wrapper[data-id="${element.access_data.id}"]`).find('.customer-contact-access-employee-selected').is(':checked');
            var check = $(`.customer-contact-access-employee-wrapper[data-id="${element.access_data.id}"]`).hasClass('selected-row');
            if (check == false) {
                revoked_data.push(element);
            }
            // var checkEmployeeData = employee_data.find(e => e.id == element.access_data.id);
            // //console.log("checkEmployeeData",checkEmployeeData);
            // if(checkEmployeeData != undefined || checkEmployeeData != null) {
            employee_data = employee_data.filter((p) => {
                return p.id != element.access_data.id;
            });
            // }

        });
        //console.log("employee_data", employee_data);
        //console.log("revoked_data", revoked_data);
        if (employee_data.length > 0 || revoked_data.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "customer",
                access_for: "employee_contact",
                access_to: sessionStorage.getItem('identifier_id'),
                access_item_id: sessionStorage.getItem('identifier_item_id'),
                access_data: employee_data
            }
            contactAccessAdd(requestParams)
                .then((response) => {
                    //console.log("contactAccessAdd", response);
                    $('#customer-contact-add-access-for-employee-contact-selection-modal').remove();
                    Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: element.id
                    }
                    revokeAccess(requesParam)
                        .then((resultData) => {
                        })
                        .catch((err) => {
                        })
                })
            }
        } else {
            if ($('.customer-contact-access-employee-selected:checked').length > 0) {
                Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            } else {
                Materialize.toast(`Please select atleast 1 employee`, 3000, "round error-alert");
            }
            removeLoader();
        }
    });

    //on click of add access button for customer contact access for customer
    $(document).on('click', '#customer_contact_add_access_for_customer_contact_action', function () {
        // addLoader();
        // digibiz.access_list = [];
        // // getCustomerContactAddAccessForCustomerContact();
        // //first get all the customer identifier items this customer identifier item has access and show tick for it
        // var requesParam = {
        //     device_id: crossplat.device.uuid,
        //     business_id: sessionStorage.getItem('business_id'),
        //     type: "customer",
        //     access_for: "customer_contact",
        //     access_to: sessionStorage.getItem('identifier_id'),
        //     access_item_id: sessionStorage.getItem('identifier_item_id')
        // }
        // accessList(requesParam)
        //     .then((result) => {
        //         //console.log("accessList", result);
        //         digibiz.access_list = result;
        //         var reqParam = {
        //             device_id: crossplat.device.uuid,
        //             business_id: sessionStorage.getItem('business_id'),
        //             type: "customer",
        //             list_by: "primary_customer_identifier",
        //             primary_customer_identifier_id: sessionStorage.getItem('identifier_id')
        //         }
        //         listContactsList(reqParam)
        //             .then((response) => {
        //                 // var getData = {
        //                 //     identifier_items_list_data: response
        //                 // }
        //                 // fetch.getHtml(function (fetcherror, html) {
        //                 var modal_data = {
        //                     modal_id: "customer-contact-add-access-for-customer-contact-item-selection-modal",
        //                     modal_header: "Identifier Item Selection",
        //                     modal_platform: crossplat.device.platform,
        //                     // modal_body: html,
        //                     modal_action_buttons: [{
        //                         "name": "Save",
        //                         "id": "customer-contact-add-access-for-customer-contact-item-save-btn",
        //                     }],
        //                     modal_body: `<div id="customer-contact-add-access-customer-contact-item-list-container-modal">
        //         <div id="customer-contact-add-access-customer-contact-item-list-content-box"></div></div>`

        //                 }
        //                 showModal(modal_data, function () {
        //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                     } else {
        //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                     }
        //                     $('#customer_contact_acess_action_sheet').remove();
        //                     getCustomerContactAddAccessForCustomerContact(response, function () {
        //                         removeLoader();
        //                         // setTimeout(function () {
        //                         //     listenForFollowUserScrollEvent($(".modal-popup-content"));
        //                         // }, 0);
        //                     });

        //                 });
        //                 // }, 'layouts/popup/identifier_items_list', '#identifier-items-list-data-template', getData);
        //             })
        //             .catch((err) => {
        //                 removeLoader();
        //                 Materialize.toast(err.msg, 3000, "round error-alert");
        //             })
        //     })
        //     .catch((err) => {
        //         removeLoader();
        //         Materialize.toast(`Error in fetching identifier items list.`, 3000, "round error-alert");
        //     })
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer"
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                response = response.filter(e => e.id == sessionStorage.getItem('identifier_id'));
                console.log('response', response);
                var getData = {
                    customer_contacts_identifiers_list_data: response,
                };
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "customer-contact-add-access-for-customer-contact-identifier-selection-modal",
                        modal_header: "Identifier Selection",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Next",
                            "id": "customer-contact-add-access-for-customer-contact-identifier-next-btn",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        $('#customer_contact_acess_action_sheet').remove();
                        removeLoader();
                    });
                }, 'layouts/popup/identifier_selection', '#customer-identifier-selection-template', getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching customer identifiers list.`, 3000, "round error-alert");
            })
    });


    $(document).on('click', '#customer-contact-add-access-for-customer-contact-identifier-next-btn', function () {
        addLoader();
        digibiz.customer_contact_add_access_customer_contact_item_selection = [];
        digibiz.access_list = [];
        // var getIdentifierSelected = $('#select-customer-identifier-for-role-assignment').val();
        // var getIdentifierId = $('#select-customer-identifier-for-role-assignment').find(`option[value="${getIdentifierSelected}"]`).attr('data-id');
        var getIdentifierSelected = $('.selected-value-customer-identifier-for-role-assignment').attr('data-value');
        var getIdentifierId = $('.selected-value-customer-identifier-for-role-assignment').attr('data-id');
        //console.log("getIdentifierId", getIdentifierId);
        //first get all the identifier items this employee has access and show tick for it        
        var requesParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            access_for: "customer_contact",
            access_to: sessionStorage.getItem('identifier_id'),
            access_item_id: sessionStorage.getItem('identifier_item_id')
        }
        accessList(requesParam)
            .then((result) => {
                //console.log("accessList", result);
                digibiz.access_list = result;
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    type: "customer",
                    list_by: "primary_customer_identifier",
                    primary_customer_identifier_id: getIdentifierId
                }
                listContactsList(reqParam)
                    .then((response) => {
                        // var getData = {
                        //     identifier_items_list_data: response
                        // }
                        // fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "customer-contact-add-access-for-customer-contact-item-selection-modal",
                            modal_header: "Identifier Item Selection",
                            modal_platform: crossplat.device.platform,
                            // modal_body: html,
                            modal_action_buttons: [{
                                "name": "Save",
                                "id": "customer-contact-add-access-for-customer-contact-item-save-btn",
                            }],
                            modal_body: `<div id="customer-contact-add-access-customer-contact-item-list-container-modal">
                <div id="customer-contact-add-access-customer-contact-item-list-content-box"></div></div>`

                        }
                        showModal(modal_data, function () {
                            $('#customer-contact-add-access-for-customer-contact-item-selection-modal').attr('data-identifier-id', getIdentifierId)
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            $('#customer-contact-add-access-for-customer-contact-identifier-selection-modal').remove();
                            getCustomerContactAddAccessForCustomerContact(response, function () {
                                removeLoader();
                                // setTimeout(function () {
                                //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                                // }, 0);
                            });

                        });
                        // }, 'layouts/popup/identifier_items_list', '#identifier-items-list-data-template', getData);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in fetching identifier items list.`, 3000, "round error-alert");
            })
    });

    //on click of add access button for customer contact access for customer save btn
    $(document).on('click', '#customer-contact-add-access-for-customer-contact-item-save-btn', function () {
        addLoader();
        var getIdentifierId = $(this).parents('#customer-contact-add-access-for-customer-contact-item-selection-modal').attr('data-identifier-id');
        var identifier_item_data = [];
        var revoked_data = [];
        //get all checkbox
        var getCheckboxes = $('.customer-identifier-item-selected');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).is(':checked')) {
                identifier_item_data.push({
                    "id": $(element).parents('.customer-identifier-item-wrapper').attr('data-id')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.access_list, function (index, element) {
            if (element.access_to == getIdentifierId && element.access_item_id == sessionStorage.getItem('identifier_item_id')) {
                var check = $(`.customer-identifier-item-wrapper[data-id="${element.access_data.id}"]`).find('.customer-identifier-item-selected').is(':checked');
                //console.log("check", check);
                if (check == false) {
                    revoked_data.push(element);
                }
                identifier_item_data = identifier_item_data.filter((e) => {
                    return e.id != element.access_data.id
                })
            }
        });
        //console.log("identifier_item_data", identifier_item_data);
        //console.log("revoked_data", revoked_data);
        if (identifier_item_data.length > 0 || revoked_data.length > 0) {
            if (identifier_item_data.length > 0) {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    type: "customer",
                    access_for: "customer_contact",
                    access_to: sessionStorage.getItem('identifier_id'),
                    access_item_id: sessionStorage.getItem('identifier_item_id'),
                    access_data: identifier_item_data
                }
                contactAccessAdd(requestParams)
                    .then((response) => {
                        //console.log("contactAccessAdd", response);
                        $('#customer-contact-add-access-for-customer-contact-item-selection-modal').remove();
                        Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            }
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: element.id
                    }
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            $('#customer-contact-add-access-for-customer-contact-item-selection-modal').remove();
                            Materialize.toast(`Successfully updated`, 3000, "round error-alert");
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                })
            }
        } else {
            removeLoader();
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
        }
    });

    //on click of add access button for customer group access
    $(document).on('click', '#customer-group-access-add', function () {
        addLoader();
        //first get the group access list and check whether this identifier item has group access
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            access_to: sessionStorage.getItem('identifier_id'),
            access_item_id: sessionStorage.getItem('identifier_item_id')
        }
        groupAccessList(reqParam)
            .then((result) => {
                var alert_parms = {
                    alert_id: "alert-revoke-customer-group-access-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Revoke Group Access`,
                    alert_body: `Are you sure you want to revoke the group access?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-revoke-customer-group-access-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-revoke-customer-group-access-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    $('#alert-revoke-customer-group-access-confirm-cancel').attr('data-id', result.id);
                    removeLoader();
                });
            })
            .catch((err) => {
                var alert_parms = {
                    alert_id: "alert-give-customer-group-access-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Group Access`,
                    alert_body: `Are you sure you want to provide the group access?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-give-customer-group-access-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-give-customer-group-access-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            })
    });

    //group access give no
    $(document).on('click', '#btn-give-customer-group-access-cancel-no', function () {
        $('#alert-give-customer-group-access-confirm-cancel').remove();
    });

    //group access revoke no
    $(document).on('click', '#btn-revoke-customer-group-access-cancel-no', function () {
        $('#alert-revoke-customer-group-access-confirm-cancel').remove();
    });

    //group access give yes
    $(document).on('click', '#btn-give-customer-group-access-confirm-yes', function () {
        addLoader();
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            access_to: sessionStorage.getItem('identifier_id'),
            access_item_id: sessionStorage.getItem('identifier_item_id')
        }
        groupAccessAdd(requestParams)
            .then((response) => {
                //console.log("groupAccessAdd", response);
                $('#alert-give-customer-group-access-confirm-cancel').remove();
                Materialize.toast(`Successfully in giving access.`, 3000, "round error-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, "round error-alert");
            })
    });

    //group access revoke yes
    $(document).on('click', '#btn-revoke-customer-group-access-confirm-yes', function () {
        addLoader();
        var getId = $('#alert-revoke-customer-group-access-confirm-cancel').attr('data-id');
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getId
        }
        groupRevokeAccess(requestParams)
            .then((response) => {
                //console.log("groupRevokeAccess", response);
                $('#alert-revoke-customer-group-access-confirm-cancel').remove();
                Materialize.toast(`Successfully in revoking access.`, 3000, "round error-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, "round error-alert");
            })
    });





    /**********************STORAGE ACCOUNT*************************/

    /**
    * Add Storage
    */
    $(document).on('click', '.add-storage-account', function () {
        addLoader();
        var alert_parms = {
            alert_id: "add-storage",
            alert_platform: crossplat.device.platform,
            alert_title: "Add Storage",
            alert_body: `<div class="add-storage-list-wrapper">
            <ul>
                <li data-storage="DJ">DJ</li>
                <li data-storage="GoogleDrive">Google Drive</li>
                <li data-storage="DropBox">Drop box</li>
                <li data-storage="OneDrive">One drive</li>
            </ul>
            </div>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "alert-cancel" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            //console.log("digibiz.storages", digibiz.storages);
            digibiz.storages.forEach((e) => {
                $('.add-storage-list-wrapper').find(`li[data-storage="${e.name}"]`).addClass('disable');
            });
        });
    });

    $(document).on('click', '.add-storage-digibiz-account', function () {
        addLoader();
        var alert_parms = {
            alert_id: "add-storage",
            alert_platform: crossplat.device.platform,
            alert_title: "Add Storage",
            alert_body: `<div class="add-storage-list-wrapper">
            <ul>
                <li data-storage="DJ">DJ</li>
                <li data-storage="GoogleDrive">Google Drive</li>
                <li data-storage="DropBox">Drop box</li>
                <li data-storage="OneDrive">One drive</li>
            </ul>
            </div>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "alert-cancel" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            //console.log("digibiz.digibiz_storages", digibiz.digibiz_storages);
            digibiz.digibiz_storages.forEach((e) => {
                $('.add-storage-list-wrapper').find(`li[data-storage="${e.name}"]`).addClass('disable');
            });
        });
    });

    /*
     * Alert cancel button
     */
    $(document).on('click', '#alert-cancel', function () {
        $(`.custom-modal[id="add-storage"]`).remove();
    });

    /**
     * set Storage account
     */

    $(document).on('click', '.add-storage-list-wrapper ul li', function () {
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        $(`.custom-modal[id="add-storage"]`).remove();
        if (config.storages.map(e => e.name).includes(selected_storage)) {
            //console.log("@@@")
            activateStorage(selected_storage, function (e) {
                //console.log("!@#$!@#$!@#")
            });
        } else {
            //console.log("invalid storage selected");
        }
    });


    $(document).on('click', '#add_storage_digibiz_account_finish', function () {
        addLoader();
        var requestParms = {
            device_id: crossplat.device.uuid,
            uuid: sessionStorage.getItem("uuid"),
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                //console.log("account is present", response);
                if (response.Data.hasOwnProperty('storage') && response.Data.storage) {
                    //console.log("got storage", response.Data.storage);
                    //olddddd code
                    // location.hash = `#land/page`;


                    //latest code
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        selected: true,
                        id: sessionStorage.getItem('account_id'),
                        type: "individual"
                    }
                    fetch.apiCall(function (result, status, xhr) {
                        if (status === "success") {
                            window.sessionStorage.setItem('storage_token', JSON.stringify(result.Data));
                            //newwwww code
                            sessionStorage.removeItem('role');
                            // location.hash = `#prospect/app/hub`;
                            if (sessionStorage.getItem('digibiz_storage_selection') == "first") {
                                // location.hash = `#prospect/app/hub`;
                                location.hash = `jeevi/app/hub`;
                                console.log('fwefwef');
                            } else {
                                // location.hash = `#prospect/settings`;
                                location.hash = `digibiz/profile`;
                            }
                        } else {
                            if (result.status == 400) {
                                window.sessionStorage.setItem('storage_token', JSON.stringify(result.responseJSON.Data));
                                removeLoader();
                                Materialize.toast(`Please select atleast 1 active storage.`, 3000, "round error-alert");
                            } else {
                                removeLoader();
                                console.log("!@#$!@#$ checkkkkkkk in middleware")
                            }
                        }
                    }, api.check_token, "POST", "JSON", requestParams);


                } else {//no storage
                    //console.log("no storage");
                    removeLoader();
                    Materialize.toast(`Please select atleast 1 storage.`, 3000, "round error-alert");
                }
            } else {
                removeLoader();
                Materialize.toast(`Account not found.`, 3000, "round error-alert");
            }
        }, api.get_account, "POST", "JSON", requestParms);
    });

    // $(document).on('click', '.add-storage-account', function () {
    //     addLoader();
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         id: sessionStorage.getItem('business_id')
    //     }
    //     businessGet(reqParam)
    //         .then((response) => {
    //             //console.log("response", response);
    //             var action_sheet_parms = {
    //                 action_id: "business_storage_selection_action_sheet",
    //                 action_platform: crossplat.device.platform,
    //                 action_title: "Storages",
    //                 action_btn: [{
    //                     name: "DJ",
    //                     attr: [{ name: "id", value: "business_storage_dj_action" }]
    //                 },
    //                 {
    //                     name: "Google Drive",
    //                     attr: [{ name: "id", value: "business_storage_google_drive_action_sheet" }]
    //                 },
    //                 {
    //                     name: "Drop box",
    //                     attr: [{ name: "id", value: "business_storage_drop_box_action_sheet" }]
    //                 },
    //                 {
    //                     name: "One drive",
    //                     attr: [{ name: "id", value: "business_storage_one_drive_action_sheet" }]
    //                 }]
    //             }
    //             showAction(action_sheet_parms, function () {
    //                 removeLoader();
    //                 if (response.hasOwnProperty('storage') && response.storage) {
    //                     //console.log("present");
    //                 }
    //             });
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("error in getting business details");
    //         })
    // });


    // //google drive storage
    // $(document).on('click', '#business_storage_google_drive_action_sheet', function () {
    //     addLoader();
    //     if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
    //         removeLoader();
    //     } else {
    //         //check whether is it edit/add
    //         var current_url = location.href.split('#').pop();
    //         var data_from;
    //         if (current_url && current_url.includes('business/add')) {
    //             data_from = "create";
    //         } else if (current_url && current_url.includes('business/edit')) {
    //             data_from = "edit";
    //         }
    //         window.open(`${api.digibiz_google_storage}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&business_id=${sessionStorage.getItem('business_id')}&data_from=${data_from}`, "_self");
    //         removeLoader();
    //         Materialize.toast("Google Drive is set as default storage. And is active now.", 3000, 'success-alert');
    //     }
    // });

    // //drop box storage
    // $(document).on('click', '#business_storage_drop_box_action_sheet', function () {
    //     if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
    //         removeLoader();
    //     } else {
    //         //check whether is it edit/add
    //         var current_url = location.href.split('#').pop();
    //         var data_from;
    //         if (current_url && current_url.includes('business/add')) {
    //             data_from = "create";
    //         } else if (current_url && current_url.includes('business/edit')) {
    //             data_from = "edit";
    //         }
    //         window.open(`${api.digibiz_dropbox_storage}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&business_id=${sessionStorage.getItem('business_id')}&data_from=${data_from}`, "_self");
    //         removeLoader();
    //         Materialize.toast("Dropbox is set as default storage. And is active now.", 3000, 'success-alert');
    //     }
    // });

    // //one drive storage
    // $(document).on('click', '#business_storage_one_drive_action_sheet', function () {
    //     addLoader();
    //     if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
    //         removeLoader();
    //     } else {
    //         //check whether is it edit/add
    //         var current_url = location.href.split('#').pop();
    //         var data_from;
    //         if (current_url && current_url.includes('business/add')) {
    //             data_from = "create";
    //         } else if (current_url && current_url.includes('business/edit')) {
    //             data_from = "edit";
    //         }
    //         window.open(`${api.digibiz_onedrive_storage}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&business_id=${sessionStorage.getItem('business_id')}&data_from=${data_from}`, "_self");
    //         removeLoader();
    //         Materialize.toast("OneDrive is set as default storage. And is active now.", 3000, 'success-alert');
    //     }
    // });


    /**********************VALIDATION WHILE TYPING IN THE FIELD**************************/
    $(document).on('click', '#employee_display_name, #employee_type, #edited_employee_type, #employee_category, #edited_employee_category, #employee_designation, #employeeGroupName, #employee_group_desc, #business_name, #business_display_name, #department_name, #new_department_name, #employee_company_employee_id, #employee_display_name, #add-employee-display-phone-number, #communicationGroupName, #customerGroupName, #customer_group_desc, #collaboratorGroupName, #collaborator_group_desc, #customer_label_name, #associate_customer_display_name, #associate_customer_email, #add-associate-customer-display-phone-number, #customer_email, #customer_display_name', function () {
        removeError($(this));
        console.log('texarea selected');
        if ($(this).is('textarea')) {
            console.log('texarea selected 1');
        }
    });
    $(document).on('keydown', '#employee_display_name, #employee_type, #edited_employee_type, #employee_category, #edited_employee_category, #employee_designation, #employeeGroupName, #employee_group_desc, #business_name, #business_display_name, #department_name, #new_department_name, #employee_company_employee_id, #employee_display_name, #add-employee-display-phone-number, #communicationGroupName, #customerGroupName, #customer_group_desc, #collaboratorGroupName, #collaborator_group_desc, #customer_label_name, #associate_customer_display_name, #associate_customer_email, #add-associate-customer-display-phone-number, #customer_email, #customer_display_name', function () {
        removeError($(this));
    });

    $(document).on('change', '#select-visibility-type, #select-group-active-when, #employee-type-choose-select-dropdown, #employee-category-choose-select-dropdown, #employee-designation-choose-select-dropdown, #employee_date_of_joining, #business_date_of_commencement, #business_date_of_incorporation', function () {
        removeError($(this));
    });

    $(document).on('click', '#digibiz_logout', function () {
        var alert_parms = {
            alert_id: "alert-digibiz-logout",
            alert_platform: crossplat.device.platform,
            alert_title: "Logout",
            alert_body: `Are you sure you want to go to logout of digibiz?`,
            alert_btn: [{
                name: "NO",
                attr: [{ name: "id", value: "alert-digibiz-logout-no" }]
            },
            {
                name: "YES",
                attr: [{ name: "id", value: "alert-digibiz-logout-yes" }]
            }]
        }
        showAlert(alert_parms, function () {
        });
    });

    $(document).on('click', '#alert-digibiz-logout-no', function () {
        $('#alert-digibiz-logout').remove();
    });

    $(document).on('click', '#alert-digibiz-logout-yes', function () {
        $('#alert-digibiz-logout').remove();
        sessionStorage.clear();
        setTimeout(function () {
            deviceHelper.navigateToAccounts('core');
        }, 1000);
    });


    $(document).on('click', 'input.communication-group-activate-employee-select-btn, .communication-group-employee-select-btn', function () {
        addLoader();
        var $this = $(this);
        if ($('input.communication-group-activate-employee-select-btn:checked').length > 3) {
            $($this).prop('checked', false);
            Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
            removeLoader();
        } else {
            removeLoader();
        }
    });

    // $(document).on('click', '.communication-employee-selection-list', function () {
    //     addLoader();
    //     var $this = $(this);
    //     if ($('.communication-employee-selection-list.selected-row').length > 3) {
    //         $($this).prop('checked', false);
    //         Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    // $(document).on('click', 'input.communication-group-employee-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     if ($('input.communication-group-employee-select-btn:checked').length > 3) {
    //         $($this).prop('checked', false);
    //         Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });



    $(document).on('change', 'input.communication-group-activate-customer-select-btn', function () {
        // addLoader();
        // var $this = $(this);
        // if ($('input.communication-group-activate-customer-select-btn:checked').length > 3) {
        //     $($this).prop('checked', false);
        //     Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
        //     removeLoader();
        // } else {
        //     removeLoader();
        // }
        addLoader();
        var $this = $(this);
        if ($($this).is(':checked')) {
            var getUnfixedModerators = digibiz.alreadySelected.filter(e => {
                return e.moderator_type != "fixed";
            })
            //console.log("123", getUnfixedModerators.length);
            //console.log("checkkkk", $('input.communication-group-activate-customer-select-btn:checked').not(":disabled"))
            //console.log("check", $('input.communication-group-activate-customer-select-btn:checked').not(":disabled").length)
            if ((getUnfixedModerators.length + $('input.communication-group-activate-customer-select-btn:checked').not(":disabled").length) > 3) {
                $($this).prop('checked', false);
                Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
                removeLoader();
            } else {
                var getid = $($this).attr('data-customer-id');
                var gettype = $($this).attr('data-customer-type');
                if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                    var index = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex(e => e.id == getid && e.type == gettype);
                    if (index != -1) {
                        if ($($this).is(':checked')) {
                            digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = true;
                        } else {
                            digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = false;
                        }
                    }
                    removeLoader();
                } else {
                    removeLoader();
                }
            }
        } else {
            //console.log("uncheck");
            var getId = $($this).attr('id');
            //console.log("getId", getId);
            digibiz.alreadySelected = digibiz.alreadySelected.filter(e => {
                return e.id != getId;
            })
            $($this).prop('checked', false);
            var getid = $($this).attr('data-customer-id');
            var gettype = $($this).attr('data-customer-type');
            if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                var index = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex(e => e.id == getid && e.type == gettype);
                if (index != -1) {
                    if ($($this).is(':checked')) {
                        digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = true;
                    } else {
                        digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = false;
                    }
                }
                removeLoader();
            } else {
                removeLoader();
            }
        }
    });

    //collaborator group moderator length check
    $(document).on('click', 'input.collaborator-group-moderator-select-btn', function () {
        //console.log("clicked on collaborator-group-moderator-select-btn")
        // addLoader();
        // var $this = $(this);
        // if ($($this).is(':checked')) {
        //     if ($('input.collaborator-group-moderator-select-btn:checked').length > 3) {
        //         $($this).prop('checked', false);
        //         Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
        //         removeLoader();
        //     } else {
        //         removeLoader();
        //     }
        // } else {
        //     if (sessionStorage.getItem('group_id')) {
        //         if ($('input.collaborator-group-moderator-select-btn:checked').length == 0) {
        //             $($this).prop('checked', true);
        //             Materialize.toast("Minimum 1 moderators is required.", 3000, 'round success-alert');
        //             removeLoader();
        //         } else {
        //             removeLoader();
        //         }
        //     } else {
        //         removeLoader();
        //     }
        // }
    });

    $(document).on('click', 'input.communication-group-moderator-select-btn', function () {
        addLoader();
        var $this = $(this);
        if ($('input.communication-group-moderator-select-btn:checked').length > 3) {
            $($this).prop('checked', false);
            Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
            removeLoader();
        } else {
            removeLoader();
        }
    });

    //communication group -> group_list -> moderator add checkbox click check
    $(document).on('change', 'input.communication-group-create-employee-moderator-select-btn', function () {
        addLoader();
        var $this = $(this);
        if ($($this).is(':checked')) {
            var getUnfixedModerators = digibiz.alreadySelected.filter(e => {
                return e.moderator_type != "fixed";
            })
            //console.log("123", getUnfixedModerators.length);
            //console.log("checkkkk", $('input.communication-group-create-employee-moderator-select-btn:checked').not(":disabled"))
            //console.log("check", $('input.communication-group-create-employee-moderator-select-btn:checked').not(":disabled").length)
            if ((getUnfixedModerators.length + $('input.communication-group-create-employee-moderator-select-btn:checked').not(":disabled").length) > 3) {
                $($this).prop('checked', false);
                Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
                removeLoader();
            } else {
                var getid = $(this).attr('data-dj-unique-employee-id');
                if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                    var index = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
                    if (index != -1) {
                        if ($($this).is(':checked')) {
                            digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = true;
                        } else {
                            digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = false;
                        }
                    }
                    removeLoader();
                } else {
                    removeLoader();
                }
            }
        } else {
            //console.log("uncheck");
            var getId = $($this).attr('id');
            //console.log("getId", getId);
            digibiz.alreadySelected = digibiz.alreadySelected.filter(e => {
                return e.id != getId;
            })
            $($this).prop('checked', false);
            var getid = $(this).attr('data-dj-unique-employee-id');
            if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                var index = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
                if (index != -1) {
                    if ($($this).is(':checked')) {
                        digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = true;
                    } else {
                        digibiz.communicationCreateEmployeeGroupEmployeeList[index]['selected'] = false;
                    }
                }
                removeLoader();
            } else {
                removeLoader();
            }
        }

    })


    $(document).on('click', '.collaborator-groups-list-wrapper', function () {
        addLoader();
        var getGroupId = $(this).attr('data-group-id');
        var socket_enable_status = $(this).attr('data-socket_enable_status');
        var getGroupCreatedStatus = $(this).attr('data-created_status');
        if (getGroupCreatedStatus && getGroupCreatedStatus == "progress") {
            removeLoader();
            Materialize.toast(`Group creation/updation in progress, please wait......might take few moments`, 3000, 'round error-alert');
        } else {
            sessionStorage.removeItem('group_id');
            sessionStorage.setItem('group_id', getGroupId);
            if (socket_enable_status == "true") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: getGroupId,
                    data: {
                        socket_enable_status: "false",
                        update_for: "socket_enable_status"
                    }
                }
                //console.log("reqParam", reqParam);
                employeeGroupUpdate(reqParam)
                    .then((response) => {
                        console.log('response', response);
                    }).catch((err) => {
                        console.log('err', err);
                    })

                sessionStorage.setItem('group_id', getGroupId);
                location.hash = `collaborator/group_details`;
            } else {
                Materialize.toast(`Access Denied! You or other administrator is updating this group at other place.`, 3000, "round error-alert");
                var alert_parms = {
                    alert_id: "alert-group-device-change-confirm-cancel",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Access Denied! You or other administrator is updating this group at other place. Would to like to cancel there and continue here?`,
                    alert_btn: [{
                        name: "Yes",
                        attr: [{ name: "id", value: "btn-group-device-change-confirm-yes" }]
                    },
                    {
                        name: "No",
                        attr: [{ name: "id", value: "btn-group-device-change-cancel-no" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                    $('#alert-group-device-change-confirm-cancel').attr('data-group-id', getGroupId); //set getEmployeeId
                    // $('#alert-group-device-change-confirm-cancel').attr('data-group-type', getGroupType); //set getEmployeeId           
                });
            }
        }

    });

    //colloborator group add moderator btn(already created group)
    $(document).on('click', '#collaborator_group_add_moderator', function () {
        addLoader();
        var getGroupReqParms = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        groupGet(getGroupReqParms)
            .then((result) => {
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    group_id: sessionStorage.getItem('group_id'),
                    business_id: sessionStorage.getItem('business_id'),
                    count: 20,
                    offset: 0
                }
                getCollaboratorBusinessEmployeeMembers(reqparams)
                    .then((response) => {
                        //console.log("success", response);
                        digibiz.colloborator_group_moderator_list = [];
                        digibiz.colloborator_group_moderator_list = response;
                        var EmployeeList = {
                            EmployeeList: response.map(e => {
                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                    // } else {
                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                    // }
                                } else {
                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                }
                                return e;
                            }),
                            page_for: "moderator"
                        }
                        //console.log("EmployeeList", EmployeeList);
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_id: "modal-collaborator-group-moderator-selection",
                                modal_header: "Business Employee List",
                                modal_platform: crossplat.device.platform,
                                modal_body: html,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "add-collaborator-group-selected-moderator",
                                }]
                            }
                            showModal(modal_data, function () {
                                //add search element
                                $('.moderator-selection-list-main-box').prepend(`<div class="search">
                                        <div class="expand-search-wrap search-wrapper" id="moderator-selection-list-search-btn">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                            <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                            <span class="searchclosebtn"><i class="material-icons moderator-selection-list-close-btn hide">close</i></span>
                                        </div>
                                    </div>`);
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                //check already present moderators
                                if (result.hasOwnProperty('moderator') && result.moderator) {
                                    digibiz.alreadySelected = result.moderator;
                                    $.each(result.moderator, function (index, elem) {
                                        $(`.collaborator-group-moderator-select-btn[data-dj-unique-employee-id="${elem.id}"]`).parents('.employee-select-btn-wrapper').addClass('selected-row');
                                        $(`.collaborator-group-moderator-select-btn[data-dj-unique-employee-id="${elem.id}"]`).prop('checked', true);
                                    })
                                }
                                removeLoader();
                                setTimeout(function () {
                                    listenForCollaboratorGroupModeratorsListScrollEvent($(".modal-popup-content"));
                                    var element = $('#moderator-selection-list-search-btn').find('.expand-search-input');
                                    if (element) {
                                        //console.log('element22', element);
                                        //if element is there
                                        $(document).on('input', element, function () {
                                            //on input set attribute socketid 
                                            timestamp = (new Date()).getTime();
                                            element.attr("socketid", timestamp);
                                        });
                                        // element.addEventListener("keyup", function (e) {
                                        $(document).on('keyup', element, function () {
                                            // if (!hasClass(e.target, 'filemanager-search')) {
                                            //console.log("not has class")
                                            // on keyup get attribute 
                                            socketid = element.attr("socketid");
                                            keyword = element.val();
                                            if (socketid && keyword) {
                                                //if socketid attribute and keyword is there
                                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                currentroute = $("body").attr('app');
                                                data = {
                                                    room: crossplat.device.uuid,
                                                    socketid,
                                                    app: 'digibiz',
                                                    keyword
                                                };
                                                switch (currentroute) {
                                                    case 'collaborator_group_create':
                                                        // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                                                            // if (sessionStorage.getItem('group_from') == "employee_list") {
                                                            data['index'] = 'getEmployeeContactListAllEmployees';
                                                            data['business_id'] = sessionStorage.getItem('business_id')
                                                            // }
                                                        }
                                                        // }
                                                        break;
                                                    default:
                                                        break;
                                                }
                                                addLoader();
                                                //console.log("search emit", data);
                                                sockets.searchSocket.emit('search', data);
                                                setTimeout(() => {
                                                    removeLoader();
                                                }, 300);
                                            } else {
                                                //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                                //else show default list
                                                removeLoader();
                                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                currentroute = $("body").attr('app');
                                                // element.removeAttribute("socketid");
                                                element.attr("socketid", "");
                                                switch (currentroute) {
                                                    case 'collaborator_group_create':
                                                        // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                                                            //console.log("ERROR", unique_member)
                                                            processSearchedEmployeeGroupEmployeeSelectionList(finalSelectedEmployeeList, function () { })
                                                        }
                                                        // }
                                                        break;
                                                    default:
                                                        break;
                                                }

                                            }
                                        });
                                        $(document).on('click', '.searchclosebtn', function () {
                                            if ($("body").attr('app') == "collaborator_group_create") {
                                                if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                                                    //console.log("CLOSED", unique_member)
                                                    processSearchedEmployeeGroupEmployeeSelectionList(finalSelectedEmployeeList, function () { })
                                                }
                                            }
                                        })
                                    }
                                }, 0);
                            });
                        }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', EmployeeList);
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No group Found`, 3000, 'round success-alert');
            })

    });
    // $(document).on('click', '#collaborator_group_add_moderator', function () {
    //     addLoader();
    //     var getGroupReqParms = {
    //         device_id: crossplat.device.uuid,
    //         id: sessionStorage.getItem('group_id')
    //     }
    //     groupGet(getGroupReqParms)
    //         .then((result) => {
    //             var reqparams = {
    //                 device_id: crossplat.device.uuid,
    //                 group_id: sessionStorage.getItem('group_id'),
    //                 business_id: sessionStorage.getItem('business_id')
    //             }
    //             getCollaboratorBusinessEmployeeMembers(reqparams)
    //                 .then((response) => {
    //                     //console.log("success", response);
    //                     var EmployeeList = {
    //                         EmployeeList: response.map(e => {
    //                             if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                 if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                     var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                     e.identity_picture['avtarUrl'] = avtarUrl;
    //                                 } else {
    //                                     e['imageLetter'] = e.member_name.first.charAt(0);
    //                                 }
    //                             } else {
    //                                 e['imageLetter'] = e.member_name.first.charAt(0);
    //                             }
    //                             return e;
    //                         }),
    //                         page_for: "moderator"
    //                     }
    //                     //console.log("EmployeeList", EmployeeList);
    //                     fetch.getHtml(function (fetcherror, html) {
    //                         var modal_data = {
    //                             modal_id: "modal-collaborator-group-moderator-selection",
    //                             modal_header: "Business Employee List",
    //                             modal_platform: crossplat.device.platform,
    //                             modal_body: html,
    //                             modal_action_buttons: [{
    //                                 "name": "Save",
    //                                 "id": "add-collaborator-group-selected-moderator",
    //                             }]
    //                         }
    //                         showModal(modal_data, function () {
    //                             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                 if ($('.modal-popup-content').length > 0) {
    //                                     //console.log("scroll initiated for modal pop-up class")
    //                                     appScroll.scrollBar('.modal-popup-content');
    //                                 }
    //                             } else {
    //                                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                             }
    //                             //check already present moderators
    //                             if (result.hasOwnProperty('moderator') && result.moderator) {
    //                                 digibiz.alreadySelected = result.moderator;
    //                                 $.each(result.moderator, function (index, elem) {
    //                                     $(`.collaborator-group-moderator-select-btn[data-dj-unique-employee-id="${elem.id}"]`).prop('checked', true);
    //                                 })
    //                             }
    //                             removeLoader();
    //                         });
    //                     }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', EmployeeList);
    //                 })
    //                 .catch((err) => {
    //                     removeLoader();
    //                     Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
    //                 })
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             Materialize.toast(`No group Found`, 3000, 'round success-alert');
    //         })

    // });

    $(document).on('click', '#add-collaborator-group-selected-moderator', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            var groupID = sessionStorage.getItem('group_id');

            var alert_parms = {
                alert_id: "alert-collaborator-group-moderator-add-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Already added or existing moderator
                won't be added again.Only new moderator will be added`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-collaborator-group-moderator-add-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-collaborator-group-moderator-add-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-collaborator-group-moderator-add-confirm-cancel').attr('data-group-id', groupID);
            });




        } else {//first-time
            if ($('.collaborator-group-moderator-select-btn:checked').length > 0) {
                $.each($('.collaborator-group-moderator-select-btn:checked'), function (index, element) {
                    var getDJUniqueEmployeeId = $(element).attr('data-dj-unique-employee-id');
                    var getEmployeeName = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text();
                    var getEmployeeNameImageLetter = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                    //console.log("getEmployeeName", getEmployeeName);
                    if (getDJUniqueEmployeeId != undefined) {
                        var template = `<div class="tooltipped collaborator-group-employee-moderator-member-wrapper member-listing-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in collaborator-group-employee-moderator-member" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getEmployeeNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span></div>
            </div>`;
                        $('#collaborator-group-moderator-list').append(template);
                        $('#modal-collaborator-group-moderator-selection').remove();
                    } else {
                        removeLoader();
                        //console.log("Dj unique employee id is undefined")
                    }
                })
                removeLoader();
            } else {
                removeLoader();
                Materialize.toast(`Please select atleast 1 employee.`, 3000, 'round success-alert');
            }
        }
    });

    $(document).on('click', '#btn-collaborator-group-moderator-add-confirm-no', function () {
        $('#alert-collaborator-group-moderator-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-collaborator-group-moderator-add-confirm-yes', function () {
        var groupID = sessionStorage.getItem('group_id');
        $('#alert-collaborator-group-moderator-add-confirm-cancel').remove();
        var moderator_data = [];
        var revoked_data = [];
        // if ($('.collaborator-group-moderator-select-btn:checked').length > 0) {
        //get all checkbox
        var getCheckboxes = $('.collaborator-group-moderator-select-btn');
        $.each(getCheckboxes, function (index, element) {
            if ($(element).is(':checked')) {
                moderator_data.push({
                    "id": $(element).attr('data-dj-unique-employee-id'),
                    "type": "employee",
                    "business_id": sessionStorage.getItem('group_id')
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.alreadySelected, function (index, element) {
            var check = $(`.collaborator-group-moderator-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
            // //console.log("check", check);
            if (check == false) {
                revoked_data.push(element);
            }
            //remove already present moderators from moderator data
            moderator_data = moderator_data.filter(function (e) {
                return e.id != element.id;
            });
        });
        //console.log("revoked_data", revoked_data);
        if (moderator_data.length > 0 || revoked_data.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: groupID,
                moderator_data: moderator_data
            }
            groupModeratorAdd(requestParams)
                .then((response) => {
                    //console.log("groupModeratorAdd", response);
                    digibiz.alreadySelected = [];
                    digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                    $('#modal-collaborator-group-moderator-selection').remove();
                    Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.msg, 3000, "round error-alert");
                })
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: groupID,
                        moderator_id: element.id
                    }
                    groupModeratorDelete(requesParam)
                        .then((resultData) => {
                            //console.log("groupModeratorDelete", resultData);
                            digibiz.alreadySelected = [];
                            digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                            $('#modal-collaborator-group-moderator-selection').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                })
            }
        } else {
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            removeLoader();
        }
    })


    // $(document).on('click', '#add_communication_group_moderator_members', function () {
    //     addLoader();
    //     var getGroupReqParms = {
    //         device_id: crossplat.device.uuid,
    //         id: sessionStorage.getItem('group_id')
    //     }
    //     groupGet(getGroupReqParms)
    //         .then((result) => {
    //             var reqparams = {
    //                 device_id: crossplat.device.uuid,
    //                 group_id: sessionStorage.getItem('group_id'),
    //             }
    //             getGroupMembers(reqparams)
    //                 .then((response) => {
    //                     //console.log("success", response);
    //                     if (result.group_type == "contact_list") {
    //                         var getData = {
    //                             dataList: response.map(e => {
    //                                 if (e.member.type == "employee") {
    //                                     if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                         if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                             var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                             e.identity_picture['avtarUrl'] = avtarUrl;
    //                                         } else {
    //                                             e['imageLetter'] = e.member_name.first.charAt(0);
    //                                         }
    //                                     } else {
    //                                         e['imageLetter'] = e.member_name.first.charAt(0);
    //                                     }
    //                                 } else if (e.member.type == "customer") {
    //                                     if (e.member.customer_type == "customer") {
    //                                         if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                             if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                                 var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                                 e.identity_picture['avtarUrl'] = avtarUrl;
    //                                             } else {
    //                                                 e['imageLetter'] = e.member_name.first.charAt(0);
    //                                             }
    //                                         } else {
    //                                             e['imageLetter'] = e.member_name.first.charAt(0);
    //                                         }
    //                                     } else if (e.member.customer_type == "associate_customer") {
    //                                         if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                             if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                                 var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                                 e.identity_picture['avtarUrl'] = avtarUrl;
    //                                             } else {
    //                                                 e['imageLetter'] = e.member_name.first.charAt(0);
    //                                             }
    //                                         } else {
    //                                             e['imageLetter'] = e.member_name.first.charAt(0);
    //                                         }
    //                                     }
    //                                 }
    //                                 return e;
    //                             }),
    //                             page_for: "contact_list_moderator"
    //                         }
    //                         //console.log("getData", getData);
    //                         fetch.getHtml(function (fetcherror, html) {
    //                             var modal_data = {
    //                                 modal_id: "modal-communication-group-moderator-selection",
    //                                 modal_header: "Members list",
    //                                 modal_platform: crossplat.device.platform,
    //                                 modal_body: html,
    //                                 modal_action_buttons: [{
    //                                     "name": "Add",
    //                                     "id": "add-communication-group-selected-moderator",
    //                                 }]
    //                             }
    //                             showModal(modal_data, function () {
    //                                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                 } else {
    //                                     $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                                 }
    //                                 //check already present moderators
    //                                 if (result.hasOwnProperty('moderator') && result.moderator) {
    //                                     digibiz.alreadySelected = result.moderator;
    //                                     $.each(result.moderator, function (index, elem) {
    //                                         $(`.communication-group-moderator-select-btn[data-id="${elem.id}"]`).prop('checked', true);
    //                                     })
    //                                 }
    //                                 removeLoader();
    //                             });
    //                         }, 'page/communication/moderator_selection_list', '#moderator-selection-list-template', getData);
    //                     } else {//group_list
    //                         var getData = {
    //                             dataList: response.map(e => {
    //                                 if (e.member.type == "employee_group") {
    //                                     if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                         if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                             var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                             e.identity_picture['avtarUrl'] = avtarUrl;
    //                                         } else {
    //                                             e['imageLetter'] = e.member_name.charAt(0);
    //                                         }
    //                                     } else {
    //                                         e['imageLetter'] = e.member_name.charAt(0);
    //                                     }
    //                                 } else if (e.member.type == "customer_group") {
    //                                     if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                         if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                             var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                             e.identity_picture['avtarUrl'] = avtarUrl;
    //                                         } else {
    //                                             e['imageLetter'] = e.member_name.charAt(0);
    //                                         }
    //                                     } else {
    //                                         e['imageLetter'] = e.member_name.charAt(0);
    //                                     }
    //                                 }
    //                                 return e;
    //                             }),
    //                             page_for: "group_list_moderator"
    //                         }
    //                         //console.log("getData", getData);
    //                         fetch.getHtml(function (fetcherror, html) {
    //                             var modal_data = {
    //                                 modal_id: "modal-communication-group-create-group-list-moderator-selection",
    //                                 modal_header: "Members list",
    //                                 modal_platform: crossplat.device.platform,
    //                                 modal_body: html,
    //                                 modal_action_buttons: [{
    //                                     "name": "Add Moderator",
    //                                     "id": "add-communication-group-create-group-list-selected-moderator",
    //                                 }]
    //                             }
    //                             showModal(modal_data, function () {
    //                                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                                 } else {
    //                                     $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                                 }
    //                                 removeLoader();
    //                             });
    //                         }, 'page/communication/moderator_selection_list', '#moderator-selection-list-template', getData);
    //                     }
    //                 })
    //                 .catch((err) => {
    //                     removeLoader();
    //                     Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
    //                 })
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             Materialize.toast(`No group Found`, 3000, 'round success-alert');
    //         })

    // });



    // $(document).on('click', '#add-communication-group-selected-moderator', function () {
    //     addLoader();
    //     var initialGroupModerator;
    //     if ($('#modal-communication-group-moderator-selection').attr('data-at') == "initial") {
    //         initialGroupModerator = true;
    //         var groupID = $('#modal-communication-group-moderator-selection').attr('data-group-id');
    //     } else {
    //         var groupID = sessionStorage.getItem('group_id');
    //     }
    //     var moderator_data = [];
    //     var revoked_data = [];
    //     //get all checkbox
    //     var getCheckboxes = $('.communication-group-moderator-select-btn');
    //     $.each(getCheckboxes, function (index, element) {
    //         if ($(element).is(':checked')) {
    //             var getType, userId;
    //             if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type') == "customer") {
    //                 if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type') == "customer") {
    //                     getType = 'customer';
    //                     userId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-account-id');
    //                 } else if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type') == "associate_customer") {
    //                     getType = 'associate_customer';
    //                     userId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-account-id');
    //                 }
    //             } else if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type') == "employee") {
    //                 getType = 'employee';
    //                 userId = $(element).attr('data-id');
    //             }
    //             moderator_data.push({
    //                 "id": $(element).attr('data-id'),
    //                 "type": getType,
    //                 "group_id": groupID,
    //                 "user_id": userId
    //             })
    //         }
    //     });
    //     //check unchecked one's
    //     $.each(digibiz.alreadySelected, function (index, element) {
    //         var check = $(`.communication-group-moderator-select-btn[data-id="${element.id}"]`).is(':checked');
    //         // //console.log("check", check);
    //         if (check == false) {
    //             revoked_data.push(element);
    //         }
    //         moderator_data = moderator_data.filter((p) => {
    //             return p.id != element.id;
    //         });
    //     });
    //     //console.log("moderator_data", moderator_data);
    //     //console.log("revoked_data", revoked_data);
    //     if (moderator_data.length > 0 || revoked_data.length > 0) {
    //         var requestParams = {
    //             device_id: crossplat.device.uuid,
    //             id: groupID,
    //             moderator_data: moderator_data
    //         }
    //         groupModeratorAdd(requestParams)
    //             .then((response) => {
    //                 //console.log("groupModeratorAdd", response);
    //                 digibiz.alreadySelected = [];
    //                 digibiz.communicationActivateEmployeeGroupEmployeeList = [];
    //                 $('#modal-communication-group-moderator-selection').remove();
    //                 Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
    //                 getCommunicationGroupDetailPage();
    //                 if (initialGroupModerator == true) {
    //                     sessionStorage.removeItem('group_type');
    //                     sessionStorage.removeItem('group_from');
    //                     sessionStorage.removeItem('group_id');
    //                     location.hash = `communication/groups`;
    //                 }
    //                 removeLoader();
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 Materialize.toast(err.msg, 3000, "round error-alert");
    //             })
    //         if (revoked_data.length > 0) {
    //             $.each(revoked_data, function (index, element) {
    //                 var requesParam = {
    //                     device_id: crossplat.device.uuid,
    //                     id: groupID,
    //                     moderator_id: element.id
    //                 }
    //                 groupModeratorDelete(requesParam)
    //                     .then((resultData) => {
    //                     })
    //                     .catch((err) => {
    //                     })
    //             })
    //             getCommunicationGroupDetailPage();
    //         }
    //     } else {
    //         if ($('.communication-group-moderator-select-btn:checked').length > 0) {
    //             Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
    //         } else {
    //             Materialize.toast(`Please select atleast 1 member.`, 3000, "round error-alert");
    //         }
    //         removeLoader();
    //     }
    // });


    $(document).on('click', '#add-communication-group-create-group-list-selected-moderator', function () {
        addLoader();
        digibiz.communicationCreateEmployeeGroupEmployeeList = [];
        if ($('input[name="communication-group-create-group-list-moderator-select"]:checked').length > 0) {
            var getGroupId = $('input[name="communication-group-create-group-list-moderator-select"]:checked').parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-id');
            var getGroupType = $('input[name="communication-group-create-group-list-moderator-select"]:checked').parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type');
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: getGroupId
            }
            groupGet(requestParams)
                .then((groupResponse) => {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: getGroupId
                    }
                    groupMemberList(reqParam)
                        // getCompleteGroupMembers(reqParam)
                        .then((response) => {
                            //console.log("groupMemberList", response);
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "modal-communication-group-create-employee-group-employee-list-selection",
                                modal_header: "Group Members",
                                modal_body: `<div id="communication-group-create-employee-group-employee-list-main-container">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="communication-group-create-employee-group-employee-list-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons communication-group-create-employee-group-employee-list-close-btn hide">close</i></span>
                                        </div>
                                        <div id="communication-group-create-employee-group-employee-list-wrapper"></div>
                                        </div>`,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "communication-group-create-employee-group-employee-select-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                $('#modal-communication-group-create-group-list-moderator-selection').remove();
                                $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id', getGroupId);
                                $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-type', getGroupType);
                                // if (initialGroupModerator == true) {
                                //     $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-at', "initial");
                                //     $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-main-group-id', mainGroupId);
                                // }
                                removeLoader();
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                if (getGroupType == "employee_group") {
                                    processCommunicationGroupCreateEmployeeGroupEmployeeList(response, function () {
                                        setTimeout(function () {
                                            var element = $('#modal-communication-group-create-employee-group-employee-list-selection').find('.expand-search-input');
                                            if (element) {
                                                //console.log('element22', element);
                                                //if element is there
                                                $(document).on('input', element, function () {
                                                    //on input set attribute socketid 
                                                    timestamp = (new Date()).getTime();
                                                    element.attr("socketid", timestamp);
                                                });
                                                // element.addEventListener("keyup", function (e) {
                                                $(document).on('keyup', element, function () {
                                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                                    //console.log("not has class")
                                                    // on keyup get attribute 
                                                    socketid = element.attr("socketid");
                                                    keyword = element.val();
                                                    if (socketid && keyword) {
                                                        //if socketid attribute and keyword is there
                                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                        currentroute = $("body").attr('app');
                                                        data = {
                                                            room: crossplat.device.uuid,
                                                            socketid,
                                                            app: 'digibiz',
                                                            keyword
                                                        };
                                                        switch (currentroute) {
                                                            case 'communication_group_details':
                                                                if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                                                                    data['index'] = 'getCommunicationGroupListModeratorListEmployee';
                                                                    data['group_id'] = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id');
                                                                    // data['maingroup_id'] = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id');
                                                                }
                                                                break;
                                                            default:
                                                                break;
                                                        }
                                                        addLoader();
                                                        //console.log("search emit", data);
                                                        sockets.searchSocket.emit('search', data);
                                                        setTimeout(() => {
                                                            removeLoader();
                                                        }, 300);
                                                    } else {
                                                        //console.log("going to else part")
                                                        //else show default list
                                                        removeLoader();
                                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                        currentroute = $("body").attr('app');
                                                        // element.removeAttribute("socketid");
                                                        element.attr("socketid", "");
                                                        switch (currentroute) {
                                                            case 'communication_group_details':
                                                                if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                                                                    processCommunicationGroupCreateEmployeeGroupEmployeeList(digibiz.communicationCreateEmployeeGroupEmployeeList, function () { })
                                                                }
                                                                break;
                                                            default:
                                                                break;
                                                        }

                                                    }
                                                });
                                                $(document).on('click', '.searchclosebtn', function () {
                                                    if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                                                        processCommunicationGroupCreateEmployeeGroupEmployeeList(digibiz.communicationCreateEmployeeGroupEmployeeList, function () { })
                                                    }
                                                })
                                            }
                                        }, 0);
                                    });
                                } else if (getGroupType == "customer_group") {
                                    processCommunicationGroupCreateCustomerGroupCustomerList(response, function () {
                                        setTimeout(function () {
                                            var element = $('#modal-communication-group-create-employee-group-employee-list-selection').find('.expand-search-input');
                                            if (element) {
                                                //console.log('element22', element);
                                                //if element is there
                                                $(document).on('input', element, function () {
                                                    //on input set attribute socketid 
                                                    timestamp = (new Date()).getTime();
                                                    element.attr("socketid", timestamp);
                                                });
                                                // element.addEventListener("keyup", function (e) {
                                                $(document).on('keyup', element, function () {
                                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                                    //console.log("not has class")
                                                    // on keyup get attribute 
                                                    socketid = element.attr("socketid");
                                                    keyword = element.val();
                                                    if (socketid && keyword) {
                                                        //if socketid attribute and keyword is there
                                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                        currentroute = $("body").attr('app');
                                                        data = {
                                                            room: crossplat.device.uuid,
                                                            socketid,
                                                            app: 'digibiz',
                                                            keyword
                                                        };
                                                        switch (currentroute) {
                                                            case 'communication_group_details':
                                                                if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                                                                    data['index'] = 'getCommunicationGroupListModeratorListCustomer';
                                                                    data['group_id'] = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id');
                                                                    // data['maingroup_id'] = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id');
                                                                }
                                                                break;
                                                            default:
                                                                break;
                                                        }
                                                        addLoader();
                                                        //console.log("search emit", data);
                                                        sockets.searchSocket.emit('search', data);
                                                        setTimeout(() => {
                                                            removeLoader();
                                                        }, 300);
                                                    } else {
                                                        //console.log("going to else part")
                                                        //else show default list
                                                        removeLoader();
                                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                        currentroute = $("body").attr('app');
                                                        // element.removeAttribute("socketid");
                                                        element.attr("socketid", "");
                                                        switch (currentroute) {
                                                            case 'communication_group_details':
                                                                if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                                                                    processCommunicationGroupCreateCustomerGroupCustomerList(digibiz.communicationCreateEmployeeGroupEmployeeList, function () { })
                                                                }
                                                                break;
                                                            default:
                                                                break;
                                                        }

                                                    }
                                                });
                                                $(document).on('click', '.searchclosebtn', function () {
                                                    if ($('#modal-communication-group-create-employee-group-employee-list-selection').length > 0) {
                                                        processCommunicationGroupCreateCustomerGroupCustomerList(digibiz.communicationCreateEmployeeGroupEmployeeList, function () { })
                                                    }
                                                })
                                            }
                                        }, 0);
                                    });
                                }
                            });

                        })
                        .catch((err) => {
                            removeLoader();
                            //console.log("error in group get");
                        })
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting the group")
                })
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 group.`, 3000, "round error-alert");
        }
    });

    $(document).on('click', '#communication-group-create-employee-group-employee-select-save-btn', function () {
        addLoader();
        // var initialGroupModerator, mainGroupID;
        // if ($('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-at') == "initial") {
        //     initialGroupModerator = true;
        //     mainGroupID = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-main-group-id');
        // } else {
        mainGroupID = sessionStorage.getItem('group_id');
        // }
        var groupID = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id');
        var groupType = $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-type');
        var moderator_data = [];
        var revoked_data = [];
        if (groupType == "employee_group") {
            // if ($('.communication-group-create-employee-moderator-select-btn:checked').length > 0) {
            //get all checkbox
            var getCheckboxes = $('.communication-group-create-employee-moderator-select-btn');
            $.each(getCheckboxes, function (index, element) {
                if ($(element).is(':checked')) {
                    moderator_data.push({
                        "id": $(element).attr('data-dj-unique-employee-id'),
                        "type": "employee",
                        "user_id": $(element).attr('data-dj-unique-employee-id'),
                        "group_id": groupID,
                    })
                }
            });
            //check unchecked one's
            $.each(digibiz.alreadySelected, function (index, element) {
                if (element.group_id == groupID) {
                    var check = $(`.communication-group-create-employee-moderator-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
                    //console.log("check", check);
                    if (check == false) {
                        revoked_data.push(element);
                    }
                    //console.log("moderator_data", moderator_data);
                    var getModerator = moderator_data.findIndex(e => e.id == element.id && e.group_id == element.group_id);
                    //console.log("getModerator", getModerator);
                    if (getModerator > -1) {
                        // delete moderator_data[getModerator];
                        moderator_data.splice(getModerator, 1);
                    }
                    // moderator_data = moderator_data.filter(function (e) {
                    //     return (e.id != element.id && e.group_id != element.group_id);
                    // });
                }
            });
            //console.log("moderator_data", moderator_data);
            //console.log("revoked_data", revoked_data);
            if (moderator_data.length > 0 || revoked_data.length > 0) {
                if (moderator_data.length > 0) {
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        id: mainGroupID,
                        moderator_data: moderator_data
                    }
                    groupModeratorAdd(requestParams)
                        .then((response) => {
                            //console.log("groupModeratorAdd", response);
                            digibiz.alreadySelected = [];
                            digibiz.communicationCreateEmployeeGroupEmployeeList = [];
                            $('#modal-communication-group-create-employee-group-employee-list-selection').remove();
                            Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
                            if (initialGroupModerator == true) {
                                sessionStorage.removeItem('group_type');
                                sessionStorage.removeItem('group_from');
                                sessionStorage.removeItem('group_id');
                                location.hash = `communication/groups`;
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                }
                if (revoked_data.length > 0) {
                    $.each(revoked_data, function (index, element) {
                        var requesParam = {
                            device_id: crossplat.device.uuid,
                            id: mainGroupID,
                            moderator_id: element.id
                        }
                        if (element.hasOwnProperty('group_id') && element.group_id) {
                            requesParam.moderator_group_id = element.group_id;
                        }
                        groupModeratorDelete(requesParam)
                            .then((resultData) => {
                                digibiz.alreadySelected = [];
                                digibiz.communicationCreateEmployeeGroupEmployeeList = [];
                                $('#modal-communication-group-create-employee-group-employee-list-selection').remove();
                                Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
                            })
                            .catch((err) => {
                            })
                    })
                }
            } else {
                removeLoader();
                Materialize.toast(`No changes to save.`, 3000, "round error-alert");
            }
        } else if (groupType == "customer_group") {
            // if ($('.communication-group-activate-customer-select-btn:checked').length > 0) {
            //get all checkbox
            var getCheckboxes = $('.communication-group-activate-customer-select-btn');
            $.each(getCheckboxes, function (index, element) {
                if ($(element).is(':checked')) {
                    moderator_data.push({
                        "id": $(element).attr('data-customer-id'),
                        "type": $(element).parents('.customer-selection-list-container').find('.contact-profile-container').attr('data-customer-type'),
                        "user_id": $(element).attr('data-customer-id'),
                        "group_id": groupID
                    })
                }
            });
            //console.log("digibiz.alreadySelected", digibiz.alreadySelected);
            //check unchecked one's
            $.each(digibiz.alreadySelected, function (index, element) {
                //console.log("element", element);
                //console.log("check if cond", $(`#modal-communication-group-create-employee-group-employee-list-selection`).attr('data-group-type'));
                //console.log("123", $(`#modal-communication-group-create-employee-group-employee-list-selection`).attr('data-group-id'))
                //console.log("456", element.group_id)
                if ($(`#modal-communication-group-create-employee-group-employee-list-selection`).attr('data-group-type') == "customer_group" && element.group_id == $(`#modal-communication-group-create-employee-group-employee-list-selection`).attr('data-group-id')) {
                    //console.log("!@!@")
                    var check = $(`.communication-group-activate-customer-select-btn[data-customer-id="${element.id}"]`).is(':checked');
                    //console.log("check", check);
                    if (check == false) {
                        revoked_data.push(element);
                    }
                }
            });
            //console.log("moderator_data", moderator_data);
            //console.log("revoked_data", revoked_data);
            if (moderator_data.length > 0 || revoked_data.length > 0) {
                if (moderator_data.length > 0) {
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        id: mainGroupID,
                        moderator_data: moderator_data
                    }
                    groupModeratorAdd(requestParams)
                        .then((response) => {
                            //console.log("groupModeratorAdd", response);
                            digibiz.alreadySelected = [];
                            digibiz.communicationCreateEmployeeGroupEmployeeList = [];
                            $('#modal-communication-group-create-employee-group-employee-list-selection').remove();
                            Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
                            if (initialGroupModerator == true) {
                                sessionStorage.removeItem('group_type');
                                sessionStorage.removeItem('group_from');
                                sessionStorage.removeItem('group_id');
                                location.hash = `communication/groups`;
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                }
                if (revoked_data.length > 0) {
                    $.each(revoked_data, function (index, element) {
                        var requesParam = {
                            device_id: crossplat.device.uuid,
                            id: groupID,
                            moderator_id: element.id
                        }
                        groupModeratorDelete(requesParam)
                            .then((resultData) => {
                                digibiz.alreadySelected = [];
                                digibiz.communicationCreateEmployeeGroupEmployeeList = [];
                                $('#modal-communication-group-create-employee-group-employee-list-selection').remove();
                                Materialize.toast(`Successfully in adding moderator.`, 3000, "round error-alert");
                            })
                            .catch((err) => {
                            })
                    })
                }
            } else {
                removeLoader();
                Materialize.toast(`No changes to save.`, 3000, "round error-alert");
            }
        }
    });



    //communication group employee tab
    $(document).on('click', '.communication-group-employee-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-communication-group-type-tab', "employee");
        digibiz.communicationEmployeeGroupsList = [];
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-communication-group-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-communication-group-type-tab')}"]`).addClass('active');
        getCommunicationEmployeePage();
    });

    //communication group customer tab
    $(document).on('click', '.communication-group-customer-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-communication-group-type-tab', "customer");
        digibiz.communicationCustomerGroupsList = [];
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-communication-group-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-communication-group-type-tab')}"]`).addClass('active');
        getCommunicationCustomerPage();
    });

    //communication group communication tab
    $(document).on('click', '.communication-group-communication-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-communication-group-type-tab', "communication");
        digibiz.communicationGroupsList = [];
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-communication-group-type-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-communication-group-type-tab')}"]`).addClass('active');
        getCommunicationGroupsPage();
    });


    $(document).on('click', '#btn-digibiz-admin-access-revoked-ok', function () {
        addLoader();
        // digibiz.business_owner_business_list = [];
        $('#alert-digibiz-admin-access-revoked').remove();
        // get all the required sessions and clear all and then set them again
        var userId = sessionStorage.getItem('user_id');
        var UUID = sessionStorage.getItem('uuid');
        var socketId = sessionStorage.getItem('socketID');
        var getAccountID = sessionStorage.getItem('account_id');
        var getAccountDetails = sessionStorage.getItem('accountDetails');
        var storageTokenDetails = sessionStorage.getItem('storage_token');
        var profileDetails = sessionStorage.getItem('profile_details');
        var DigibizRole = sessionStorage.getItem('digibiz_role');
        var getRoleBtn = sessionStorage.getItem('get_role_btn');
        sessionStorage.clear();
        sessionStorage.setItem('user_id', userId);
        sessionStorage.setItem('uuid', UUID);
        sessionStorage.setItem('socketID', socketId);
        sessionStorage.setItem('account_id', getAccountID);
        sessionStorage.setItem('accountDetails', getAccountDetails);
        sessionStorage.setItem('storage_token', storageTokenDetails);
        sessionStorage.setItem('profile_details', profileDetails);
        sessionStorage.setItem('digibiz_role', DigibizRole);
        sessionStorage.setItem('get_role_btn', getRoleBtn);
        location.hash = `business_owner/business/list`;
    });


    //collaborator group member(business) more vert button
    $(document).on('click', '#collaborator_group_business_member_actions', function () {
        addLoader();
        var getBusinessId = $(this).parents('.collaborator-group-business-member-wrapper').attr('data-business-id');
        var getMemberId = $(this).parents('.collaborator-group-business-member-wrapper').attr('data-id');
        if (sessionStorage.getItem('selected-collaborator-tab') == "other_group_collaborator") {
            if (getBusinessId == sessionStorage.getItem('business_id')) {
                var action_sheet_parms = {
                    action_id: "collaborator-group-business-member-action-sheet",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Show Employees",
                        attr: [{ name: "id", value: "collaborator_group_business_member_show_employees_action" }]
                    },
                    {
                        name: "Add Employees",
                        attr: [{ name: "id", value: "collaborator_group_business_member_add_employees_action" }]
                    },
                    {
                        name: "Exit",
                        attr: [{ name: "id", value: "collaborator_group_business_member_exit_action" }]
                    }
                    ]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('business_id', getBusinessId);
                    $(".action-sheet-container").attr('member_id', getMemberId);
                });

            } else {
                var action_sheet_parms = {
                    action_id: "collaborator-group-business-member-action-sheet",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Show Employees",
                        attr: [{ name: "id", value: "collaborator_group_business_member_show_employees_action" }]
                    }
                    ]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('business_id', getBusinessId);
                    $(".action-sheet-container").attr('member_id', getMemberId);
                });
            }
        } else {
            if (getBusinessId == sessionStorage.getItem('business_id')) {
                var action_sheet_parms = {
                    action_id: "collaborator-group-business-member-action-sheet",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Show Employees",
                        attr: [{ name: "id", value: "collaborator_group_business_member_show_employees_action" }]
                    },
                    {
                        name: "Add Employees",
                        attr: [{ name: "id", value: "collaborator_group_business_member_add_employees_action" }]
                    }
                    ]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('business_id', getBusinessId);
                    $(".action-sheet-container").attr('member_id', getMemberId);
                });

            } else {
                var action_sheet_parms = {
                    action_id: "collaborator-group-business-member-action-sheet",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "Show Employees",
                        attr: [{ name: "id", value: "collaborator_group_business_member_show_employees_action" }]
                    },
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "collaborator_group_business_member_delete_action" }]
                    }]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $(".action-sheet-container").attr('business_id', getBusinessId);
                    $(".action-sheet-container").attr('member_id', getMemberId);
                });
            }
        }
    });


    //show collaborator group business member employees
    $(document).on('click', '#collaborator_group_business_member_show_employees_action', function () {
        addLoader();
        digibiz.show_employees_collaborator_group = [];
        var getBusinessId = $('#collaborator-group-business-member-action-sheet').attr('business_id');
        var reqparams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            business_id: getBusinessId
        }
        getCollaboratorBusinessEmployeeMembers(reqparams)
            .then((response) => {
                //console.log("success", response);
                // if (getBusinessId == sessionStorage.getItem('business_id')) {
                //     var EmployeeList = {
                //         EmployeeList: response.map(e => {
                //             if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                //                 if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                //                     var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                //                     e.identity_picture['avtarUrl'] = avtarUrl;
                //                 } else {
                //                     e['imageLetter'] = e.member_name.first.charAt(0);
                //                 }
                //             } else {
                //                 e['imageLetter'] = e.member_name.first.charAt(0);
                //             }
                //             e.can_edit = "yes"
                //             return e;
                //         }),
                //         page_for: "listing_employees"
                //     }
                // } else {
                //     var EmployeeList = {
                //         EmployeeList: response.map(e => {
                //             if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                //                 if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                //                     var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                //                     e.identity_picture['avtarUrl'] = avtarUrl;
                //                 } else {
                //                     e['imageLetter'] = e.member_name.first.charAt(0);
                //                 }
                //             } else {
                //                 e['imageLetter'] = e.member_name.first.charAt(0);
                //             }
                //             return e;
                //         }),
                //         page_for: "listing_employees"
                //     }
                // }
                // //console.log("EmployeeList", EmployeeList);
                // fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "modal-collaborator-group-business-members",
                    modal_header: "Business Employee List",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="collaborator-group-show-employees-business-member-main-container">
                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                     <div class="expand-search-wrap" id="communication-group-activate-employee-group-employee-list-search-btn">
                     <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                     <span class="searchclosebtn"><i class="material-icons hide">close</i></span>
                </div>
                <div id="collaborator-group-show-employees-business-member-list-wrapper"></div>
                </div>`
                }
                showModal(modal_data, function () {
                    $('#collaborator-group-business-member-action-sheet').remove();
                    $('#modal-collaborator-group-business-members').attr('data-business-id', getBusinessId)
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                    showEmployeesCollaboratorGroupBusinessMembers(response, function () {
                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        var element = $('#modal-collaborator-group-business-members').find('.expand-search-input');
                        if (element) {
                            //console.log('element22', element);
                            //if element is there
                            $(document).on('input', element, function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                element.attr("socketid", timestamp);
                            });
                            // element.addEventListener("keyup", function (e) {
                            $(document).on('keyup', element, function () {
                                // if (!hasClass(e.target, 'filemanager-search')) {
                                //console.log("not has class")
                                // on keyup get attribute 
                                socketid = element.attr("socketid");
                                keyword = element.val();
                                if (socketid && keyword) {
                                    //if socketid attribute and keyword is there
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    currentroute = $("body").attr('app');
                                    data = {
                                        room: crossplat.device.uuid,
                                        socketid,
                                        app: 'digibiz',
                                        keyword
                                    };
                                    switch (currentroute) {
                                        case 'collaborator_group_details':
                                            if ($('#modal-collaborator-group-business-members').length > 0) {
                                                data['index'] = 'getCollaboratorGroupBusinessMemberShowEmployeesSearch';
                                                data['group_id'] = sessionStorage.getItem('group_id');
                                                data['business_id'] = getBusinessId;
                                            }
                                            break;
                                        default:
                                            break;
                                    }
                                    addLoader();
                                    //console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                } else {
                                    //console.log("going to else part")
                                    //else show default list
                                    removeLoader();
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                    currentroute = $("body").attr('app');
                                    // element.removeAttribute("socketid");
                                    element.attr("socketid", "");
                                    switch (currentroute) {
                                        case 'collaborator_group_details':
                                            if ($('#modal-collaborator-group-business-members').length > 0) {
                                                showEmployeesCollaboratorGroupBusinessMembers(digibiz.show_employees_collaborator_group, function () { })
                                            }
                                            break;
                                        default:
                                            break;
                                    }

                                }
                            });
                            $(document).on('click', '.searchclosebtn', function () {
                                if ($('#modal-collaborator-group-business-members').length > 0) {
                                    showEmployeesCollaboratorGroupBusinessMembers(digibiz.show_employees_collaborator_group, function () { })
                                }
                            })
                        }
                    });
                });
                // }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', EmployeeList);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#collaborator_group_business_member_delete_action', function () {
        addLoader();
        // if ($('.employee-selection-list-container').length > 1) {
        var getBusinessId = $('#collaborator-group-business-member-action-sheet').attr('business_id');
        var getMemberId = $('#collaborator-group-business-member-action-sheet').attr('member_id');
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            id: getMemberId,
            memberBusinessId: getBusinessId
        }
        checkGroupMemberDelete(requestParams)
            .then((result) => {
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: getMemberId,
                    group_id: sessionStorage.getItem('group_id'),
                    status: "deleted"
                }
                groupMemberDelete(reqparams)
                    .then((response) => {
                        //console.log("success", response);
                        $('#collaborator-group-business-member-action-sheet').remove();
                        $(`.collaborator-group-business-member-wrapper[data-id="${getMemberId}"]`).find('.business-member-data-wrapper').find('.collaborator-group-business-member-status').text('Deleted')
                        // $(`.collaborator-group-business-member-wrapper[data-id="${getMemberId}"]`).remove();
                        // $(this).parents('.employee-selection-list-container').find(`.contact-profile-container[data-member-id ="${getMemberId}"]`).parent().remove();
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`Error in deleting the member.`, 3000, 'round error-alert');
                    })
                // } else {
                //     removeLoader();
                //     Materialize.toast(`Minimum 1 employee is required.`, 3000, 'round success-alert');
                // }
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
                if (err.msg == "Minimum 1 business member is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 business should be present in the group. Group will get deleted if the selected business is removed. Are you sure you want to remove the business?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-business-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-business-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-business-id', getBusinessId);
                        removeLoader();
                    });
                }
            })
    });

    $(document).on('click', '#btn-alert-group-member-delete-error-business-delete-group-confirm', function () {
        addLoader();
        var getMemberId = $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id');
        var getBusinessId = $('#alert-group-member-delete-error-members-yes-no').attr('data-business-id');

        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        employeeGroupDelete(reqparams)
            .then((response) => {
                removeLoader();
                $('#collaborator-group-business-member-action-sheet').remove();
                sessionStorage.removeItem('group_id');
                $('#alert-group-member-delete-error-members-yes-no').remove();
                Materialize.toast(`Successfully deleted.`, 3000, "round success-alert");
                location.hash = `collaborator/groups/list`;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the group.`, 3000, "round error-alert");
            })
    })

    $(document).on('click', '#btn-alert-group-member-delete-error-business-cancel-confirm', function () {
        removeLoader();
        $('#collaborator-group-business-member-action-sheet').remove();
        $('#alert-group-member-delete-error-members-yes-no').remove();
    })

    $(document).on('click', '#collaborator_group_business_member_exit_action', function () {
        addLoader();
        // if ($('.employee-selection-list-container').length > 1) {
        var getBusinessId = $('#collaborator-group-business-member-action-sheet').attr('business_id');
        var getMemberId = $('#collaborator-group-business-member-action-sheet').attr('member_id');
        // var requestParams = {
        //     device_id: crossplat.device.uuid,
        //     group_id: sessionStorage.getItem('group_id'),
        //     id: getBusinessId
        // }
        // checkGroupMemberDelete(requestParams)
        //     .then((result) => {
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getMemberId,
            group_id: sessionStorage.getItem('group_id'),
            member_business_id: getBusinessId,
            status: "exited"
        }
        groupMemberDelete(reqparams)
            .then((response) => {
                //console.log("success", response);
                removeLoader();
                $('#collaborator-group-business-member-action-sheet').remove();
                Materialize.toast(`Exited succcessfully.`, 3000, 'round success-alert');
                location.hash = `collaborator/groups/list`;

                $(`.collaborator-group-business-member-wrapper[data-id="${getMemberId}"]`).find('.business-member-data-wrapper').find('.collaborator-group-business-member-status').text('Exited')

                // $(`.collaborator-group-business-member-wrapper[data-id="${getMemberId}"]`).remove();
                // $(this).parents('.employee-selection-list-container').find(`.contact-profile-container[data-member-id ="${getMemberId}"]`).parent().remove();

            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the member.`, 3000, 'round error-alert');
            })
        // } else {
        //     removeLoader();
        //     Materialize.toast(`Minimum 1 employee is required.`, 3000, 'round success-alert');
        // }
        // })
        // .catch((err) => {
        //     removeLoader();
        //     Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
        // })
    });

    $(document).on('click', '#delete-collaborator-group-member-business-employee', function () {
        addLoader();
        // if ($('.employee-selection-list-container').length > 1) {
        var getMemberId = $(this).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-member-id');
        var getEmployeeId = $(this).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-dj-unique-employee-id');
        var alert_parms = {
            alert_id: "alert-delete-collaborator-group-member-business-employee-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Member`,
            alert_body: `Are you sure you want to delete the member?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-collaborator-group-member-business-employee-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-collaborator-group-member-business-employee-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-collaborator-group-member-business-employee-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
            $('#alert-delete-collaborator-group-member-business-employee-confirm-cancel').attr('data-employee-id', getEmployeeId); //set getEmployeeId
        });


    });

    //Delete no employee member
    $(document).on('click', '#btn-delete-collaborator-group-member-business-employee-cancel-no', function () {
        $('#alert-delete-collaborator-group-member-business-employee-confirm-cancel').remove();
    });

    //Delete yes employee member
    $(document).on('click', '#btn-delete-collaborator-group-member-business-employee-confirm-yes', function () {
        addLoader();
        var getMemberId = $('#alert-delete-collaborator-group-member-business-employee-confirm-cancel').attr('data-member-id');
        var getEmployeeId = $('#alert-delete-collaborator-group-member-business-employee-confirm-cancel').attr('data-employee-id');

        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            id: getMemberId,
            employee_id: getEmployeeId
        }
        $('#alert-delete-collaborator-group-member-business-employee-confirm-cancel').remove();
        checkGroupMemberDelete(requestParams)
            .then((result) => {
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: getMemberId,
                    employee_id: getEmployeeId,
                    group_id: sessionStorage.getItem('group_id')
                }
                groupMemberDelete(reqparams)
                    .then((response) => {
                        //console.log("success", response);
                        $(this).parents('.employee-selection-list-container').find(`.contact-profile-container[data-member-id ="${getMemberId}"]`).parent().remove();
                        $(`.contact-profile-container[data-member-id ="${getMemberId}"]`).parent('.employee-selection-list-container').remove();
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`Error in deleting the employee.`, 3000, 'round success-alert');
                    })
                // } else {
                //     removeLoader();
                //     Materialize.toast(`Minimum 1 employee is required.`, 3000, 'round success-alert');
                // }
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`${err.msg}`, 3000, 'round success-alert');
            })
    });

    //add collaborator employees for the business
    // $(document).on('click', '#collaborator_group_business_member_add_employees_action', function () {
    //     addLoader();
    //     var getBusinessId = $('#collaborator-group-business-member-action-sheet').attr('business_id');
    //     var requestparams = {
    //         device_id: crossplat.device.uuid,
    //         group_id: sessionStorage.getItem('group_id'),
    //         business_id: getBusinessId
    //     }
    //     getCollaboratorBusinessEmployeeMembers(requestparams)
    //         .then((result) => {
    //             //console.log("result", result);
    //             var reqParam = {
    //                 device_id: crossplat.device.uuid,
    //                 list_by: "list_only_active",
    //                 business_id: getBusinessId
    //             }
    //             employeeList(reqParam)
    //                 .then((response) => {
    //                     //console.log("employeeList response", response);
    //                     let unique_member = [];
    //                     $.each(response, function (index, value) {
    //                         unique_member.push(value);
    //                     });

    //                     digibiz.collaborator_group_owner_employee_members = response;
    //                     //first time group
    //                     $.each($("input[name='selectedmembers[]']"), function (index, element) {
    //                         unique_member = unique_member.filter(function (e) {
    //                             return e.dj_unique_employee_id != $(element).val();
    //                         });
    //                     });
    //                     //edit
    //                     $.each(result, function (index, element) {
    //                         unique_member = unique_member.filter(function (e) {
    //                             return e.dj_unique_employee_id != element.member.employee_id;
    //                         });
    //                     });
    //                     //console.log("unique_member 11", unique_member);
    //                     var EmployeeList = {
    //                         EmployeeList: unique_member.map(e => {
    //                             if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                                 if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                     //console.log("1234");
    //                                     var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                     e.identity_picture['avtarUrl'] = avtarUrl;
    //                                 } else {
    //                                     e['imageLetter'] = e.name.first.charAt(0);
    //                                 }
    //                             } else {
    //                                 e['imageLetter'] = e.name.first.charAt(0);
    //                             }
    //                             return e;
    //                         })
    //                     }
    //                     //console.log("EmployeeList", EmployeeList);
    //                     fetch.getHtml(function (fetcherror, html) {
    //                         var modal_data = {
    //                             modal_id: "modal-collaborator-group-owner-business-employee-selection",
    //                             modal_header: "Employee List",
    //                             modal_platform: crossplat.device.platform,
    //                             modal_body: html,
    //                             modal_action_buttons: [{
    //                                 "name": "Add",
    //                                 "id": "add-collaborator-group-owner-business-selected-employees-group",
    //                             }]
    //                         }
    //                         showModal(modal_data, function () {
    //                             $('#collaborator-group-business-member-action-sheet').remove();
    //                             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                             } else {
    //                                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                             }
    //                             removeLoader();
    //                         });
    //                     }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);

    //                 })
    //                 .catch((err) => {
    //                     removeLoader();
    //                     Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
    //                 })
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
    //         })
    // });

    $(document).on('click', '#collaborator_group_business_member_add_employees_action', function () {
        addLoader();
        var getBusinessId = $('#collaborator-group-business-member-action-sheet').attr('business_id');
        //get already present employee in this group from this business
        var requestparams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            business_id: getBusinessId
        }
        getCollaboratorBusinessEmployeeMembers(requestparams)
            .then((result) => {
                //console.log("result", result);
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "list_only_active",//list_unassigned_active
                    business_id: getBusinessId,
                    count: 20,
                    offset: 0
                }

                employeeList(reqParam)
                    .then((response) => {
                        //console.log("employeeList response", response);
                        let unique_member = [];
                        $.each(response, function (index, value) {
                            unique_member.push(value);
                        });

                        //first time group creation(remove employess already added to the group)
                        $.each($("input[name='selectedmembers[]']"), function (index, element) {
                            unique_member = unique_member.filter(function (e) {
                                return e.dj_unique_employee_id != $(element).val();
                            });
                        });
                        //edit case(remove employess already added to the group)
                        $.each(result, function (index, element) {
                            unique_member = unique_member.filter(function (e) {
                                return e.dj_unique_employee_id != element.member.employee_id;
                            });
                        });
                        //console.log("unique_member 11", unique_member);
                        digibiz.collaborator_group_owner_employee_members = unique_member;//all employees of this business
                        digibiz.employee_list = response;
                        // fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-collaborator-group-owner-business-employee-selection",
                            modal_header: "Employee List",
                            modal_platform: crossplat.device.platform,
                            modal_body: `<div id="collaborator-group-owner-business-employees-selection-main-container">
                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                             <div class="expand-search-wrap" id="communication-group-activate-employee-group-employee-list-search-btn">
                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                             <span class="searchclosebtn"><i class="material-icons hide">close</i></span>
                        </div>
                        <div id="collaborator-group-owner-business-employees-selection-list-wrapper"></div>
                        </div>`,
                            modal_action_buttons: [{
                                "name": "Add",
                                "id": "add-collaborator-group-owner-business-selected-employees-group",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#collaborator-group-business-member-action-sheet').remove();
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            removeLoader();
                            collaboratorGroupOwnerBusinessEmployeeSelection(unique_member, function () {
                                listenForEmployeeList($('.modal-popup-content'));
                                var element = $('#modal-collaborator-group-owner-business-employee-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'collaborator_group_details':
                                                    var getEmployeeIds = [];
                                                    $.each(unique_member, function (index, elemm) {
                                                        getEmployeeIds.push(elemm.dj_unique_employee_id);
                                                    })
                                                    if ($('#modal-collaborator-group-owner-business-employee-selection').length > 0) {
                                                        data['index'] = 'getCollaboratorGroupOwnerBusinessEmployeesSelection';
                                                        data['employee_data'] = getEmployeeIds;
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'collaborator_group_details':
                                                    if ($('#modal-collaborator-group-owner-business-employee-selection').length > 0) {
                                                        collaboratorGroupOwnerBusinessEmployeeSelection(unique_member, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#modal-collaborator-group-owner-business-employee-selection').length > 0) {
                                            collaboratorGroupOwnerBusinessEmployeeSelection(unique_member, function () { })
                                        }
                                    })
                                }
                            });
                        });
                        // }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);

                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Employees Found`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#btn-alert-group-member-delete-error-moderator-ok', function () {
        $('#alert-group-member-delete-error-moderator-ok').remove();
    });

    $(document).on('click', '#btn-alert-group-member-delete-error-members-cancel-confirm', function () {
        $('#alert-group-member-delete-error-members-yes-no').remove();
    });

    $(document).on('click', '#btn-alert-group-member-delete-error-members-delete-group-confirm', function () {
        addLoader();
        // var getMemberId = $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id');
        // $('#alert-group-member-delete-error-members-yes-no').remove();
        // var requestParams = {
        //     device_id: crossplat.device.uuid,
        //     group_id: sessionStorage.getItem('group_id'),
        //     id: getMemberId
        // }
        // groupMemberDelete(requestParams)
        //     .then((response) => {
        //         sessionStorage.removeItem('group_id');
        //         sessionStorage.removeItem('group_from');
        //         sessionStorage.removeItem('group_type');
        //         if ($('body').attr('app') == "employee_group_create") {
        //             // $(`.custom-employee-group-member-wrapper[data-member-id="${getMemberId}"]`).remove();
        //             location.hash = `employee_group_creation/list`;
        //         } else if ($('body').attr('app') == "customer_groups_details") {
        //             location.hash = `customer/groups/identifiers/list`;
        //         } else if ($('body').attr('app') == "communication_group_details") {
        //             location.hash = `communication/groups`;
        //         }
        //         removeLoader();
        //         Materialize.toast(`Successfully deleted group.`, 3000, 'round success-alert');
        //     })
        //     .catch((err) => {
        //         removeLoader();
        //         //console.log("Error in member removing");
        //         Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
        //     })
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        employeeGroupDelete(reqparams)
            .then((response) => {
                sessionStorage.removeItem('group_id');
                sessionStorage.removeItem('group_type');
                sessionStorage.removeItem('group_from');
                $('#alert-group-member-delete-error-members-yes-no').remove();
                Materialize.toast(`Successfully deleted.`, 3000, "round success-alert");
                if ($('body').attr('app') == "employee_group_create") {
                    location.hash = `employee_group_creation/list`;
                } else if ($('body').attr('app') == "customer_groups_details") {
                    location.hash = `customer/groups/identifiers/list`;
                } else if ($('body').attr('app') == "communication_group_details") {
                    location.hash = `communication/groups`;
                } else if ($('body').attr('app') == "collaborator_group_details") {
                    location.hash = `collaborator/groups/list`;
                }
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the group.`, 3000, "round error-alert");
            })
    });


    //communication group -> contact list -> delete member
    $(document).on('click', '#delete_communication_group_employee_member, #delete_communication_group_customer_member', function () {
        addLoader();
        var getMemberId = $(this).attr('data-member-id');
        var alert_parms = {
            alert_id: "alert-delete-communication-group-member-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Member`,
            alert_body: `Are you sure you want to delete the member?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-communication-group-member-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-communication-group-member-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-communication-group-member-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
        });
    });

    //Delete no employee member
    $(document).on('click', '#btn-delete-communication-group-member-cancel-no', function () {
        $('#alert-delete-communication-group-member-confirm-cancel').remove();
    });

    //Delete yes employee member
    $(document).on('click', '#btn-delete-communication-group-member-confirm-yes', function () {
        addLoader();
        var getMemberId = $('#alert-delete-communication-group-member-confirm-cancel').attr('data-member-id');
        $('#alert-delete-communication-group-member-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            id: getMemberId
        }
        checkGroupMemberDelete(requestParams)
            .then((result) => {
                groupMemberDelete(requestParams)
                    .then((response) => {
                        $(`.communication-group-member-wrapper[data-member-id="${getMemberId}"]`).remove();
                        $(`.communication-group-moderator-member-wrapper[data-id="${getMemberId}"]`).remove();
                        removeLoader();
                        Materialize.toast(`Successfully removed employee`, 3000, 'round success-alert');
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("Error in member removing");
                        Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                // Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                if (err.msg == "Minimum 2 employee members are required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 2 employee members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 2 customer members are required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 2 customer members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 1 moderator is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-moderator-ok",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 moderator is required. Please add moderator to delete the selected member.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-moderator-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    removeLoader();
                }
            })
    });

    //communication group -> group list -> delete member
    $(document).on('click', '#delete_communication_group_employee_group_member, #delete_communication_group_customer_group_member, #delete_communication_group_collaborator_group_member', function () {
        addLoader();
        var getMemberId = $(this).attr('data-group-id');//communication group member id
        var alert_parms = {
            alert_id: "alert-delete-communication-group-member-group-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete Member`,
            alert_body: `Are you sure you want to delete the member?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-communication-group-member-group-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-communication-group-member-group-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-communication-group-member-group-confirm-cancel').attr('data-member-id', getMemberId); //set getMemberId
        });
    });

    //Delete no employee member
    $(document).on('click', '#btn-delete-communication-group-member-group-cancel-no', function () {
        $('#alert-delete-communication-group-member-group-confirm-cancel').remove();
    });

    //Delete yes employee member
    $(document).on('click', '#btn-delete-communication-group-member-group-confirm-yes', function () {
        addLoader();
        var getMemberId = $('#alert-delete-communication-group-member-group-confirm-cancel').attr('data-member-id');
        $('#alert-delete-communication-group-member-group-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            id: getMemberId
        }
        checkGroupMemberDelete(requestParams)
            .then((result) => {
                groupMemberDelete(requestParams)
                    .then((response) => {
                        $(`.communication-group-member-wrapper[data-member-id="${getMemberId}"]`).remove();
                        removeLoader();
                        Materialize.toast(`Successfully removed employee`, 3000, 'round success-alert');
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("Error in member removing");
                        Materialize.toast(`Error in member removing`, 3000, 'round success-alert');
                    })
            })
            .catch((err) => {
                // Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                if (err.msg == "Minimum 1 employee/collaborator member is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 employee/collaborator members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 1 customer member is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-members-yes-no",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 customer members should be present in the group. Group will get deleted if the selected member is removed. Are you sure you want to remove the member?`,
                        alert_btn: [{
                            name: "Delete Group",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-delete-group-confirm" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-members-cancel-confirm" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-group-member-delete-error-members-yes-no').attr('data-member-id', getMemberId);
                        removeLoader();
                    });
                } else if (err.msg == "Minimum 1 moderator is required") {
                    var alert_parms = {
                        alert_id: "alert-group-member-delete-error-moderator-ok",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Minimum 1 moderator is required. Please add moderator to delete the selected member.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "btn-alert-group-member-delete-error-moderator-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                } else {
                    removeLoader();
                }
            })
    });






    $(document).on('click', '.digibiz-business-settings', function () {
        addLoader();
        var getBusinessRole = sessionStorage.getItem('business_role');
        if (getBusinessRole == "super_admin") {
            $('body').click();
            location.hash = `business/settings`;
        } else {
            var alert_parms = {
                alert_id: "access-denied-business-settings-module-alert",
                alert_platform: crossplat.device.platform,
                alert_title: `Access Denied`,
                alert_body: `Only super-admins can access the module.`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "access-denied-business-settings-module-alert-ok" }]
                }
                ]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });


    $(document).on('click', '.module-admin-business-settings', function () {
        addLoader();
        $('body').click();
        location.hash = `module_admin/management`;
    });


    $(document).on('click', '.module-admin-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-business-settings-tab', "module_admin");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-business-settings-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-business-settings-tab')}"]`).addClass('active');
        businessModuleAdminsTab();
    });

    $(document).on('click', '.digibiz-admin-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-business-settings-tab', "digibiz_admin");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-business-settings-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-business-settings-tab')}"]`).addClass('active');
        businessDigibizAdminsTab();
    });

    $(document).on('click', '#digibiz-admin-revoke-btn, #module-admin-revoke-btn', function () {
        addLoader();
        //should add transaction pop-up
        var getType = sessionStorage.getItem('selected-business-settings-tab');
        var getBusinessOwnerMemberId = $(this).parents('.employee-wrapper').attr('data-id');
        var getAccountId = $(this).parents('.employee-wrapper').attr('data-account-id');
        if (getAccountId == sessionStorage.getItem('account_id')) {
            removeLoader();
            Materialize.toast(`Cannot revoke your owner access.`, 3000, 'round success-alert');
        }
        // else if (getType == "digibiz_admin" && $('#digibiz-admin-list-wrapper').find('.employee-wrapper').length == "1") {
        //     var alert_parms = {
        //         alert_id: "alert-business-digibiz-admin-revoke-error-ok",
        //         alert_platform: crossplat.device.platform,
        //         alert_title: `Alert`,
        //         alert_body: `Minimum 1 digibiz admin is required. Please add digibiz admin to revoke the selected member.`,
        //         alert_btn: [{
        //             name: "Ok",
        //             attr: [{ name: "id", value: "btn-alert-business-digibiz-admin-revoke-error-ok" }]
        //         }]
        //     }
        //     showAlert(alert_parms, function () {
        //         removeLoader();
        //     });
        // } 
        else {
            var reqparams = {
                device_id: crossplat.device.uuid,
                id: getBusinessOwnerMemberId
            }
            businessOwnerDelete(reqparams)
                .then((response) => {
                    removeLoader();
                    Materialize.toast(`Successfully revoked.`, 3000, 'round success-alert');
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`Error`, 3000, 'round success-alert');
                })
        }
    });

    $(document).on('click', '#btn-alert-business-digibiz-admin-revoke-error-ok', function () {
        $('#alert-business-digibiz-admin-revoke-error-ok').remove();
    });


    $(document).on('click', '#activate-employee-group-btn, #add_employee_group_moderator', function () {
        addLoader();
        digibiz.employeeSelectedContactList = [];
        digibiz.communicationActivateEmployeeGroupEmployeeList = [];
        var getGroupId, group_from;

        if ($('body').attr('app') == "employee_group_create") {
            getGroupId = sessionStorage.getItem('group_id');
            group_from = sessionStorage.getItem('group_from');
        } else {
            getGroupId = $(this).parents('.employee-group-wrapper').attr('data-group-id');
            group_from = $(this).parents('.employee-group-wrapper').attr('data-group-from');
        }
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getGroupId
        }
        groupGet(requestParams)
            .then((groupResponse) => {
                sessionStorage.removeItem('activate_group_id');
                sessionStorage.setItem('activate_group_id', getGroupId);
                //console.log("groupResponse", groupResponse);
                if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator) {
                    digibiz.alreadySelected = groupResponse.moderator;
                    //console.log("digibiz.alreadySelected", digibiz.alreadySelected);
                }
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    group_id: getGroupId,
                    count: 20,
                    offset: 0
                }
                getCompleteGroupMembers(reqParam)
                    .then((response) => {
                        console.log("getCompleteGroupMembers", response);
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "modal-communication-group-activate-employee-group-employee-list-selection",
                            modal_header: "Group Members",
                            modal_body: `<div id="communication-group-activate-employee-group-employee-list-main-container">
                                            <div class="search">
                                             <div class="expand-search-wrap search-wrapper" id="communication-group-activate-employee-group-employee-list-search-btn">
                                                <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                <span class="searchclosebtn"><i class="material-icons communication-group-activate-employee-group-employee-list-close-btn hide">close</i></span>
                                             </div>
                                            </div>
                                        <div id="communication-group-activate-employee-group-employee-list-wrapper"></div>
                                        </div>`,
                            modal_action_buttons: [{
                                "name": "Save",
                                "id": "communication-group-activate-employee-group-employee-select-save-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id', getGroupId);
                            $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type', group_from);
                            removeLoader();
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            processCommunicationGroupActivateEmployeeGroupEmployeeList(response, groupResponse, function () {
                                listenForGroupMembersList($('.modal-popup-content'));
                                setTimeout(function () {
                                    // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                    var element = $('#modal-communication-group-activate-employee-group-employee-list-selection').find('.expand-search-input');
                                    if (element) {
                                        //console.log('element22', element);
                                        //if element is there
                                        $(document).on('input', element, function () {
                                            //on input set attribute socketid 
                                            timestamp = (new Date()).getTime();
                                            element.attr("socketid", timestamp);
                                        });
                                        // element.addEventListener("keyup", function (e) {
                                        $(document).on('keyup', element, function () {
                                            // if (!hasClass(e.target, 'filemanager-search')) {
                                            //console.log("not has class")
                                            // on keyup get attribute 
                                            socketid = element.attr("socketid");
                                            keyword = element.val();
                                            if (socketid && keyword) {
                                                //if socketid attribute and keyword is there
                                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                currentroute = $("body").attr('app');
                                                data = {
                                                    room: crossplat.device.uuid,
                                                    socketid,
                                                    app: 'digibiz',
                                                    keyword
                                                };
                                                switch (currentroute) {
                                                    case 'employee_group_creation_list':
                                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                data['index'] = 'getEmployeeStandardGroupModeratorList';
                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                            }
                                                        } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                if (group_from == "standard_group") {
                                                                    data['index'] = 'getEmployeeCustomStandardGroupModeratorList';
                                                                    data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                } else {
                                                                    data['index'] = 'getDigibizGroupMembersListPage';
                                                                    data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    case 'employee_group_create':
                                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                data['index'] = 'getEmployeeStandardGroupModeratorList';
                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                            }
                                                        } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                if (group_from == "standard_group") {
                                                                    data['index'] = 'getEmployeeCustomStandardGroupModeratorList';
                                                                    data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                } else {
                                                                    data['index'] = 'getDigibizGroupMembersListPage';
                                                                    data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                }
                                                            }
                                                        }
                                                        break;
                                                    default:
                                                        break;
                                                }
                                                addLoader();
                                                //console.log("search emit", data);
                                                sockets.searchSocket.emit('search', data);
                                                setTimeout(() => {
                                                    removeLoader();
                                                }, 300);
                                            } else {
                                                //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                                //else show default list
                                                removeLoader();
                                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                currentroute = $("body").attr('app');
                                                // element.removeAttribute("socketid");
                                                element.attr("socketid", "");
                                                switch (currentroute) {
                                                    case 'employee_group_creation_list':
                                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                            }
                                                        } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                            }
                                                        }
                                                        break;
                                                    case 'employee_group_create':
                                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                            }
                                                        } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                            }
                                                        }
                                                        break;
                                                    default:
                                                        break;
                                                }

                                            }
                                        });
                                        $(document).on('click', '.searchclosebtn', function () {
                                            //console.log("1234", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                    //console.log("1111")
                                                    processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                }
                                            } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                    processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                }
                                            }
                                        })
                                    }
                                }, 0);
                            });
                        });

                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in group get");
                    })
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in getting the group")
            })
    });


    $(document).on('click', '#digibiz_business_logout', function () {
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            role: sessionStorage.getItem('digibiz_role'),
            business_id: sessionStorage.getItem('business_id'),
            data: {
                status: "inactive"
            }
        }
        navigateLogsUpdate(reqparams)
            .then((response) => {
                sessionStorage.removeItem('business_id');
                sessionStorage.removeItem('employee_id');
                // location.hash = `employee/business/list`;
                location.hash = `employee/business/list`;
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in logging out of the business.")
                Materialize.toast(`Error in logging out.`, 3000, 'round error-alert');
            })

    });


    $(document).on('click', '#prospect_app_hub_logout', function () {
        //console.log("clicked logout")
        addLoader();
        sessionStorage.removeItem('digibiz_role');
        sessionStorage.clear();
        setTimeout(function () {
            deviceHelper.navigateToAccounts('core');
        }, 1000);
    });

    //used
    $(document).on('click', '#activate-communication-group-btn', function () {
        addLoader();
        digibiz.communicationGroupActivate = [];
        var getGroupId;
        if ($('body').attr('app') == "communication_groups") {
            getGroupId = $(this).parents('.communication-group-wrapper').attr('data-id');
        } else {
            getGroupId = sessionStorage.getItem('group_id');
        }
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: getGroupId
        }
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: getGroupId
        }
        groupGet(reqparams)
            .then((groupResponse) => {
                //console.log("groupResponse", groupResponse);
                if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator) {
                    digibiz.alreadySelected = groupResponse.moderator;
                    //console.log(" digibiz.alreadySelected", digibiz.alreadySelected);
                }
                if (groupResponse.group_type == "contact_list") {
                    getCompleteGroupMembers(requestParams)
                        .then((response) => {
                            //console.log("getCompleteGroupMembers", response);
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "modal-communication-group-moderator-selection",
                                modal_header: "Group Members",
                                modal_body: `<div id="communication-group-members-main-container">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="communication-group-members-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons communication-group-members-close-btn hide">close</i></span>
                                        </div>
                                        <div id="communication-group-members-wrapper"></div>
                                        </div>`,
                                modal_action_buttons: [{
                                    "name": "Save",
                                    "id": "communication-group-activate-save-btn",
                                }]
                            }
                            showModal(modal_data, function () {
                                $('#modal-communication-group-moderator-selection').attr('data-group-id', getGroupId);
                                removeLoader();
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                processCommunicationGroupActivate(response, groupResponse, function () {
                                    setTimeout(function () {
                                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                        var element = $('#modal-communication-group-moderator-selection').find('.expand-search-input');
                                        if (element) {
                                            //console.log('element22', element);
                                            //if element is there
                                            $(document).on('input', element, function () {
                                                //on input set attribute socketid 
                                                timestamp = (new Date()).getTime();
                                                element.attr("socketid", timestamp);
                                            });
                                            // element.addEventListener("keyup", function (e) {
                                            $(document).on('keyup', element, function () {
                                                // if (!hasClass(e.target, 'filemanager-search')) {
                                                //console.log("not has class")
                                                // on keyup get attribute 
                                                socketid = element.attr("socketid");
                                                keyword = element.val();
                                                if (socketid && keyword) {
                                                    //if socketid attribute and keyword is there
                                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                    currentroute = $("body").attr('app');
                                                    data = {
                                                        room: crossplat.device.uuid,
                                                        socketid,
                                                        app: 'digibiz',
                                                        keyword
                                                    };
                                                    switch (currentroute) {
                                                        case 'communication_groups':
                                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                data['index'] = 'getCommunicationContactListModeratorList';
                                                                data['group_id'] = $('#modal-communication-group-moderator-selection').attr('data-group-id');
                                                            }
                                                            break;
                                                        default:
                                                            break;
                                                    }
                                                    addLoader();
                                                    //console.log("search emit", data);
                                                    sockets.searchSocket.emit('search', data);
                                                    setTimeout(() => {
                                                        removeLoader();
                                                    }, 300);
                                                } else {
                                                    //console.log("going to else part")
                                                    //else show default list
                                                    removeLoader();
                                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                    currentroute = $("body").attr('app');
                                                    // element.removeAttribute("socketid");
                                                    element.attr("socketid", "");
                                                    switch (currentroute) {
                                                        case 'communication_groups':
                                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                processCommunicationGroupActivate(response, groupResponse, function () { })
                                                            }
                                                            break;
                                                        default:
                                                            break;
                                                    }

                                                }
                                            });
                                            $(document).on('click', '.searchclosebtn', function () {
                                                if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                    processCommunicationGroupActivate(response, groupResponse, function () { })
                                                }
                                            })
                                        }
                                    }, 0);
                                });
                            });
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(`No group Members Found`, 3000, 'round success-alert');
                        })
                } else {//group_list
                    getGroupMembers(requestParams)
                        .then((memresponse) => {
                            var response = memresponse.membersList;
                            //console.log("success", response);
                            var finalMembersData = response.filter(e => {
                                return e.member.type != "collaborator_group"
                            })
                            var getData = {
                                dataList: finalMembersData.map(e => {
                                    if (e.member.type == "employee_group") {
                                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                            // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                            var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                            e.identity_picture['avtarUrl'] = avtarUrl;
                                            e['imageLetter'] = e.member_name.charAt(0);
                                            // } else {
                                            //     e['imageLetter'] = e.member_name.charAt(0);
                                            // }
                                        } else {
                                            e['imageLetter'] = e.member_name.charAt(0);
                                        }
                                    } else if (e.member.type == "customer_group") {
                                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                            // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                            var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                            e.identity_picture['avtarUrl'] = avtarUrl;
                                            e['imageLetter'] = e.member_name.charAt(0);
                                            // } else {
                                            //     e['imageLetter'] = e.member_name.charAt(0);
                                            // }
                                        } else {
                                            e['imageLetter'] = e.member_name.charAt(0);
                                        }
                                    }
                                    return e;
                                }),
                                page_for: "group_list_moderator"
                            }
                            //console.log("getData", getData);
                            fetch.getHtml(function (fetcherror, html) {
                                var modal_data = {
                                    modal_id: "modal-communication-group-create-group-list-moderator-selection",
                                    modal_header: "Members list",
                                    modal_platform: crossplat.device.platform,
                                    modal_body: html,
                                    modal_action_buttons: [{
                                        "name": "Add Moderator",
                                        "id": "add-communication-group-create-group-list-selected-moderator",
                                    }]
                                }
                                showModal(modal_data, function () {
                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                        if ($('.modal-popup-content').length > 0) {
                                            //console.log("scroll initiated for modal pop-up class")
                                            appScroll.scrollBar('.modal-popup-content');
                                        }
                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    } else {
                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                    }
                                    removeLoader();
                                });
                            }, 'page/communication/moderator_selection_list', '#moderator-selection-list-template', getData);
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(`No group Members Found`, 3000, 'round success-alert');
                        })
                }
            });
    });

    //used
    $(document).on('click', '#add_communication_group_moderator_members', function () {
        addLoader();
        digibiz.communicationCreateEmployeeGroupEmployeeList = [];
        digibiz.communicationGroupActivate = [];
        digibiz.alreadySelected = [];
        if (sessionStorage.getItem('group_id')) {
            var getGroupId = sessionStorage.getItem('group_id');
            var reqparams = {
                device_id: crossplat.device.uuid,
                id: getGroupId
            }
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: getGroupId,
                count: 20,
                offset: 0
            }
            groupGet(reqparams)
                .then((groupResponse) => {
                    //console.log("groupResponse", groupResponse);
                    if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator) {
                        digibiz.alreadySelected = groupResponse.moderator;
                        //console.log(" digibiz.alreadySelected", digibiz.alreadySelected);
                    }
                    if (groupResponse.group_type == "contact_list") {
                        getCompleteGroupMembers(requestParams)
                            .then((response) => {
                                //console.log("getCompleteGroupMembers", response);
                                var modal_data = {
                                    modal_platform: crossplat.device.platform,
                                    modal_id: "modal-communication-group-moderator-selection",
                                    modal_header: "Group Members",
                                    modal_body: `<div id="communication-group-members-main-container">
                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                             <div class="expand-search-wrap" id="communication-group-members-search-btn">
                                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                             <span class="searchclosebtn"><i class="material-icons communication-group-members-close-btn hide">close</i></span>
                                        </div>
                                        <div id="communication-group-members-wrapper"></div>
                                        </div>`,
                                    modal_action_buttons: [{
                                        "name": "Save",
                                        "id": "communication-group-activate-save-btn",
                                    }]
                                }
                                showModal(modal_data, function () {
                                    $('#modal-communication-group-moderator-selection').attr('data-group-id', getGroupId);
                                    removeLoader();
                                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                        if ($('.modal-popup-content').length > 0) {
                                            //console.log("scroll initiated for modal pop-up class")
                                            appScroll.scrollBar('.modal-popup-content');
                                        }
                                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    } else {
                                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                                    }
                                    processCommunicationGroupActivate(response, groupResponse, function () {
                                        setTimeout(function () {
                                            listenForCommunicationGroupActivateScrollEvent($(".modal-popup-content"));
                                            var element = $('#modal-communication-group-moderator-selection').find('.expand-search-input');
                                            if (element) {
                                                //console.log('element22', element);
                                                //if element is there
                                                $(document).on('input', element, function () {
                                                    //on input set attribute socketid 
                                                    timestamp = (new Date()).getTime();
                                                    element.attr("socketid", timestamp);
                                                });
                                                // element.addEventListener("keyup", function (e) {
                                                $(document).on('keyup', element, function () {
                                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                                    //console.log("not has class")
                                                    // on keyup get attribute 
                                                    socketid = element.attr("socketid");
                                                    keyword = element.val();
                                                    if (socketid && keyword) {
                                                        //if socketid attribute and keyword is there
                                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                        currentroute = $("body").attr('app');
                                                        data = {
                                                            room: crossplat.device.uuid,
                                                            socketid,
                                                            app: 'digibiz',
                                                            keyword
                                                        };
                                                        switch (currentroute) {
                                                            case 'communication_groups':
                                                                if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                    data['index'] = 'getCommunicationContactListModeratorList';
                                                                    data['group_id'] = $('#modal-communication-group-moderator-selection').attr('data-group-id');
                                                                }
                                                                break;
                                                            case 'communication_group_details':
                                                                if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                    data['index'] = 'getCommunicationContactListModeratorList';
                                                                    data['group_id'] = $('#modal-communication-group-moderator-selection').attr('data-group-id');
                                                                }
                                                                break;
                                                            default:
                                                                break;
                                                        }
                                                        addLoader();
                                                        //console.log("search emit", data);
                                                        sockets.searchSocket.emit('search', data);
                                                        setTimeout(() => {
                                                            removeLoader();
                                                        }, 300);
                                                    } else {
                                                        //console.log("going to else part")
                                                        //else show default list
                                                        removeLoader();
                                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                        currentroute = $("body").attr('app');
                                                        // element.removeAttribute("socketid");
                                                        element.attr("socketid", "");
                                                        switch (currentroute) {
                                                            case 'communication_groups':
                                                                if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                    groupResponse.moderator = [];
                                                                    processCommunicationGroupActivate(digibiz.communicationGroupActivate, groupResponse, function () { })
                                                                }
                                                                break;
                                                            case 'communication_group_details':
                                                                if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                    groupResponse.moderator = [];
                                                                    processCommunicationGroupActivate(digibiz.communicationGroupActivate, groupResponse, function () { })
                                                                }
                                                                break;
                                                            default:
                                                                break;
                                                        }

                                                    }
                                                });
                                                $(document).on('click', '.searchclosebtn', function () {
                                                    if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                        groupResponse.moderator = [];
                                                        processCommunicationGroupActivate(digibiz.communicationGroupActivate, groupResponse, function () { })
                                                    }
                                                })
                                            }
                                        }, 0);
                                    });
                                });
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(`No group Members Found`, 3000, 'round success-alert');
                            })
                    } else {//group_list
                        getGroupMembers(requestParams)
                            .then((memresponse) => {
                                var response = memresponse.membersList;
                                //console.log("success", response);
                                var finalMembersData = response.filter(e => {
                                    return e.member.type != "collaborator_group"
                                })
                                var getData = {
                                    dataList: finalMembersData.map(e => {
                                        if (e.member.type == "employee_group") {
                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                e.identity_picture['avtarUrl'] = avtarUrl;
                                                e['imageLetter'] = e.member_name.charAt(0);
                                                // } else {
                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                // }
                                            } else {
                                                e['imageLetter'] = e.member_name.charAt(0);
                                            }
                                        } else if (e.member.type == "customer_group") {
                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                e.identity_picture['avtarUrl'] = avtarUrl;
                                                e['imageLetter'] = e.member_name.charAt(0);
                                                // } else {
                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                // }
                                            } else {
                                                e['imageLetter'] = e.member_name.charAt(0);
                                            }
                                        }
                                        return e;
                                    }),
                                    page_for: "group_list_moderator"
                                }
                                //console.log("getData", getData);
                                fetch.getHtml(function (fetcherror, html) {
                                    var modal_data = {
                                        modal_id: "modal-communication-group-create-group-list-moderator-selection",
                                        modal_header: "Members list",
                                        modal_platform: crossplat.device.platform,
                                        modal_body: html,
                                        modal_action_buttons: [{
                                            "name": "Add Moderator",
                                            "id": "add-communication-group-create-group-list-selected-moderator",
                                        }]
                                    }
                                    showModal(modal_data, function () {
                                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                            if ($('.modal-popup-content').length > 0) {
                                                //console.log("scroll initiated for modal pop-up class")
                                                appScroll.scrollBar('.modal-popup-content');
                                            }
                                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        } else {
                                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                                        }
                                        removeLoader();
                                    });
                                }, 'page/communication/moderator_selection_list', '#moderator-selection-list-template', getData);
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(`No group Members Found`, 3000, 'round success-alert');
                            })
                    }
                });
        } else {//first time group creation
            //console.log("1st time");
            if (sessionStorage.getItem('group_from') == "contact_list") {
                var finalGroupModeratorList = [];
                employeeMembersList(function (err, employeeData) {
                    if (err) {
                        removeLoader();
                        //console.log("error employee")
                    } else {
                        //console.log("employeeData", employeeData);
                        $.each(employeeData, function (index, employee) {
                            finalGroupModeratorList.push(employee);
                        })
                        customerMembersList(function (err, customerData) {
                            if (err) {
                                removeLoader();
                                //console.log("error customer")
                            } else {
                                // console.log("customerData", customerData);
                                $.each(customerData, function (ind, customer) {
                                    finalGroupModeratorList.push(customer);
                                })
                                associateCustomerMembersList(function (err, associateCustomerData) {
                                    if (err) {
                                        removeLoader();
                                        //console.log("error associatecustomer")
                                    } else {
                                        //console.log("associateCustomerData", associateCustomerData);
                                        $.each(associateCustomerData, function (inddex, associateCustomer) {
                                            finalGroupModeratorList.push(associateCustomer);
                                        })
                                        if (finalGroupModeratorList.length > 0) {
                                            console.log("check length", finalGroupModeratorList);
                                            var groupResponse = {
                                                group_type: sessionStorage.getItem('group_from')
                                            }
                                            var modal_data = {
                                                modal_platform: crossplat.device.platform,
                                                modal_id: "modal-communication-group-moderator-selection",
                                                modal_header: "Group Members",
                                                modal_body: `<div id="communication-group-members-main-container">
                                                        <span class="searchbtn waves-effect cursor-pointer hide"><i class="material-icons">search</i></span>
                                                         <div class="expand-search-wrap" id="communication-group-members-search-btn">
                                                         <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                         <span class="searchclosebtn"><i class="material-icons communication-group-members-close-btn hide">close</i></span>
                                                    </div>
                                                    <div id="communication-group-members-wrapper"></div>
                                                    </div>`,
                                                modal_action_buttons: [{
                                                    "name": "Save",
                                                    "id": "communication-group-activate-save-btn",
                                                }]
                                            }
                                            showModal(modal_data, function () {
                                                $('#modal-communication-group-moderator-selection').attr('data-group-id', getGroupId);
                                                removeLoader();
                                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                    if ($('.modal-popup-content').length > 0) {
                                                        //console.log("scroll initiated for modal pop-up class")
                                                        appScroll.scrollBar('.modal-popup-content');
                                                    }
                                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                } else {
                                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                }
                                                processCommunicationGroupActivate(finalGroupModeratorList, groupResponse, function () {
                                                    setTimeout(function () {
                                                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                                        var element = $('#modal-communication-group-moderator-selection').find('.expand-search-input');
                                                        if (element) {
                                                            //console.log('element22', element);
                                                            //if element is there
                                                            $(document).on('input', element, function () {
                                                                //on input set attribute socketid 
                                                                timestamp = (new Date()).getTime();
                                                                element.attr("socketid", timestamp);
                                                            });
                                                            // element.addEventListener("keyup", function (e) {
                                                            $(document).on('keyup', element, function () {
                                                                // if (!hasClass(e.target, 'filemanager-search')) {
                                                                //console.log("not has class")
                                                                // on keyup get attribute 
                                                                socketid = element.attr("socketid");
                                                                keyword = element.val();
                                                                if (socketid && keyword) {
                                                                    //if socketid attribute and keyword is there
                                                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                                    currentroute = $("body").attr('app');
                                                                    data = {
                                                                        room: crossplat.device.uuid,
                                                                        socketid,
                                                                        app: 'digibiz',
                                                                        keyword
                                                                    };
                                                                    switch (currentroute) {
                                                                        case 'communication_groups':
                                                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                                data['index'] = 'getCommunicationContactListModeratorList';
                                                                                data['group_id'] = $('#modal-communication-group-moderator-selection').attr('data-group-id');
                                                                            }
                                                                            break;
                                                                        case 'communication_group_details':
                                                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                                data['index'] = 'getCommunicationContactListModeratorList';
                                                                                data['group_id'] = $('#modal-communication-group-moderator-selection').attr('data-group-id');
                                                                            }
                                                                            break;
                                                                        default:
                                                                            break;
                                                                    }
                                                                    addLoader();
                                                                    //console.log("search emit", data);
                                                                    sockets.searchSocket.emit('search', data);
                                                                    setTimeout(() => {
                                                                        removeLoader();
                                                                    }, 300);
                                                                } else {
                                                                    //console.log("going to else part")
                                                                    //else show default list
                                                                    removeLoader();
                                                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                                    currentroute = $("body").attr('app');
                                                                    // element.removeAttribute("socketid");
                                                                    element.attr("socketid", "");
                                                                    switch (currentroute) {
                                                                        case 'communication_groups':
                                                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                                processCommunicationGroupActivate(finalGroupModeratorList, groupResponse, function () { })
                                                                            }
                                                                            break;
                                                                        case 'communication_group_details':
                                                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                                processCommunicationGroupActivate(finalGroupModeratorList, groupResponse, function () { })
                                                                            }
                                                                            break;
                                                                        default:
                                                                            break;
                                                                    }

                                                                }
                                                            });
                                                            $(document).on('click', '.searchclosebtn', function () {
                                                                if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                                    processCommunicationGroupActivate(finalGroupModeratorList, groupResponse, function () { })
                                                                }
                                                            })
                                                        }
                                                    }, 0);
                                                });
                                            });
                                        } else {
                                            removeLoader();
                                            //console.log("Please add group members");
                                            Materialize.toast("Please add group members.", 3000, 'rounded error-alert');
                                        }
                                    }
                                })
                            }
                        })
                    }
                })
            } else {//using group_list

            }
        }
    });


    $(document).on('click', '#communication-group-activate-save-btn', function () {
        addLoader();
        //console.log("1123", sessionStorage.getItem('group_id'))
        // //console.log("1223", $('#modal-communication-group-moderator-selection').attr('data-group-id'))
        var getGroupId = $('#modal-communication-group-moderator-selection').attr('data-group-id');
        //console.log("getGroupId", getGroupId);
        if (sessionStorage.getItem('group_id') || getGroupId != undefined) {
            //console.log("123", $('#modal-communication-group-moderator-selection').attr('data-group-id'))
            var groupID = $('#modal-communication-group-moderator-selection').attr('data-group-id');
            //console.log("groupID", groupID);
            var alert_parms = {
                alert_id: "alert-communication-group-moderator-add-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Already added or existing moderator
                won't be added again.Only new moderator will be added`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-communication-group-moderator-add-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-communication-group-moderator-add-confirm-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-communication-group-moderator-add-confirm-cancel').attr('data-group-id', groupID);
            });


        } else {//first-time
            //console.log("first-time");
            if ($('.communication-group-moderator-select-btn:checked').length > 0) {
                $.each($('.communication-group-moderator-select-btn:checked'), function (index, element) {
                    if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type') == "employee") {
                        var getDJUniqueEmployeeId = $(element).attr('data-id');
                        var getEmployeeName = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text();
                        var getDesignationName = $(element).parents('.employee-selection-list-container').find('.designation-name').text();
                        var getEmployeeNameImageLetter = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                        var getEmployeeNameImageAvatarUrl = $(element).parents('.employee-selection-list-container').find('img').attr('src');
                        //console.log("getEmployeeName", getEmployeeName);
                        if (getDJUniqueEmployeeId != undefined) {
                            var template = `<div class="tooltipped communication-group-moderator-member-wrapper-not-saved member-listing-wrapper" data-id="${getDJUniqueEmployeeId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in communication-group-moderator-member-not-saved" data-type="employee" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getEmployeeNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span>
                 <span class="truncate">${getDesignationName}</span></div>
            </div>`;
                            $('#communication-group-moderator-members-list').append(template);
                            $('#modal-communication-group-moderator-selection').remove();
                        } else {
                            removeLoader();
                            //console.log("Dj unique employee id is undefined")
                        }
                    } else if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type') == "customer") {
                        if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type') == "customer") {
                            var getId = $(element).attr('data-id');
                            var getType = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type');
                            var get_more_info = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-more_info');
                            var get_associate_customter_info = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-associate_customter_info');
                            var get_role_business_name = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-role_business_name');
                            console.log('get_role_business_name', get_role_business_name);
                            var getName = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text();
                            var getImageLetter = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                            var getIdentifierId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-identifier-id');
                            var getImageAvatarUrl = $(element).parents('.employee-selection-list-container').find('img').attr('src');
                            if (getId != undefined) {
                                var template = `<div class="tooltipped communication-group-moderator-member-wrapper-not-saved member-listing-wrapper" data-id="${getId}" data-identifier-id="${getIdentifierId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in communication-group-moderator-member-not-saved" data-type="${getType}" value="${getId}" id="selected-${getId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getId}">${getName}</span>|<span>${get_more_info}</span>|<span>${get_role_business_name}</span></div>
            </div>`;
                                $('#communication-group-moderator-members-list').append(template);
                                $('#modal-communication-group-moderator-selection').remove();
                            } else {
                                removeLoader();
                                //console.log("id is undefined")
                            }
                        } else {//asociate_customer
                            var getId = $(element).attr('data-id');
                            var getType = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type');
                            var getName = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text();
                            var getImageLetter = $(element).parents('.employee-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
                            var getImageAvatarUrl = $(element).parents('.employee-selection-list-container').find('img').attr('src');
                            var getIdentifierId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-identifier-id');
                            var getParentCustomerId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-parent-customer-id');
                            var getParentCustomerIdentifierId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-parent-customer-identifier-id');
                            var get_associate_customter_info = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-associate_customter_info');
                            var get_role_business_name = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-role_business_name');
                            console.log('get_role_business_namee', get_role_business_name);
                            if (getId != undefined) {
                                var template = `<div class="tooltipped communication-group-moderator-member-wrapper-not-saved member-listing-wrapper" data-id="${getId}" data-identifier-id="${getIdentifierId}" data-parent-customer-id="${getParentCustomerId}" data-parent-customer-identifier-id="${getParentCustomerIdentifierId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in communication-group-moderator-member-not-saved" data-type="${getType}" value="${getId}" id="selected-${getId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getId}">${getName}</span>|<span>${get_associate_customter_info}</span>|<span>${get_role_business_name}</span></div>
            </div>`;
                                $('#communication-group-moderator-members-list').append(template);
                                $('#modal-communication-group-moderator-selection').remove();
                            } else {
                                removeLoader();
                                //console.log("id is undefined")
                            }
                        }
                    }
                })
                removeLoader();
            } else {
                removeLoader();
                Materialize.toast(`Please select atleast 1 employee.`, 3000, 'round success-alert');
            }
        }
        appScroll.scrollBar('#communication-group-moderator-members-list');
    });

    $(document).on('click', '#btn-communication-group-moderator-add-confirm-no', function () {
        $('#alert-communication-group-moderator-add-confirm-cancel').remove();
    })

    $(document).on('click', '#btn-communication-group-moderator-add-confirm-yes', function () {
        var getGroupId = $('#modal-communication-group-moderator-selection').attr('data-group-id');
        var moderator_data = [];
        var revoked_data = [];
        //get all checkbox
        var getCheckboxes = $('.communication-group-moderator-select-btn');
        $('#alert-communication-group-moderator-add-confirm-cancel').remove();
        $.each(getCheckboxes, function (index, element) {
            if ($(element).is(':checked')) {
                var getType, userId;
                if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type') == "customer") {
                    if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type') == "customer") {
                        getType = 'customer';
                        userId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-account-id');
                    } else if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-customer-type') == "associate_customer") {
                        getType = 'associate_customer';
                        userId = $(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-account-id');
                    }
                } else if ($(element).parents('.employee-selection-list-container').find('.contact-profile-container').attr('data-type') == "employee") {
                    getType = 'employee';
                    userId = $(element).attr('data-id');
                }
                moderator_data.push({
                    "id": $(element).attr('data-id'),
                    "type": getType,
                    "user_id": userId
                })
            }
        });
        //check unchecked one's
        $.each(digibiz.alreadySelected, function (index, element) {
            if (element.hasOwnProperty('group_id') && element.group_id) {
                var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${element.id}"]`).is(':checked');
                if (check == false) {
                    revoked_data.push(element);
                }
                moderator_data = moderator_data.filter(function (e) {
                    return e.id != element.id;
                });
            } else {
                var check = $(`.communication-group-moderator-select-btn[data-id="${element.id}"]`).is(':checked');
                if (check == false) {
                    revoked_data.push(element);
                }
                moderator_data = moderator_data.filter(function (e) {
                    return e.id != element.id;
                });
            }
        });
        //console.log("revoked_data", revoked_data);
        //console.log("moderator_data", moderator_data);
        if (moderator_data.length > 0 || revoked_data.length > 0) {
            if (moderator_data.length > 0) {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: groupID,
                    moderator_data: moderator_data
                }
                groupModeratorAdd(requestParams)
                    .then((response) => {
                        //console.log("groupModeratorAdd", response);
                        digibiz.alreadySelected = [];
                        digibiz.communicationGroupActivate = [];
                        $('#modal-communication-group-moderator-selection').remove();
                        Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            }
            if (revoked_data.length > 0) {
                $.each(revoked_data, function (index, element) {
                    var requesParam = {
                        device_id: crossplat.device.uuid,
                        id: groupID,
                        moderator_id: element.id
                    }
                    groupModeratorDelete(requesParam)
                        .then((resultData) => {
                            //console.log("groupModeratorDelete", resultData);
                            digibiz.alreadySelected = [];
                            digibiz.communicationGroupActivate = [];
                            $('#modal-communication-group-moderator-selection').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                })
            }
        } else {
            // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            removeLoader();
            // } else {
            //     Materialize.toast(`Please select atleast 1 member.`, 3000, "round error-alert");
            // }
        }
    })

    //collaborator group, add moderator button
    $(document).on('click', '#add_group_moderator_employees', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {

        } else {//first time creation            
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "list_only_active",//list_unassigned_active
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: 0
            }
            employeeList(reqParam)
                .then((response) => {
                    //console.log("employeeList response", response);
                    var finalSelectedEmployeeList = [];
                    //members list
                    $.each($('.collaborator-group-owner-business-employee-member:checked'), function (index, employee) {
                        console.log('employee', employee);
                        var getEmployee = response.find(e => e.dj_unique_employee_id == $(employee).attr('value'));
                        console.log('getEmployee', getEmployee);
                        if (getEmployee != undefined) {
                            finalSelectedEmployeeList.push(getEmployee);
                        }
                    });
                    console.log('finalSelectedEmployeeList', finalSelectedEmployeeList);
                    //remove already added moderators from finalSelectedEmployeeList
                    $.each($('.collaborator-group-employee-moderator-member'), function (index, employee) {
                        finalSelectedEmployeeList = finalSelectedEmployeeList.filter(p => {
                            return p.dj_unique_employee_id != $(employee).attr('value');
                        })
                    });
                    var EmployeeList = {
                        EmployeeList: finalSelectedEmployeeList.map(e => {
                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                // if (e.hasOwnProperty('display_name') && e.display_name) {
                                //     e['imageLetter'] = e.display_name.charAt(0);
                                // } else {
                                // e['imageLetter'] = e.name.first.charAt(0);
                                // }
                                // } else {
                                //     if (e.hasOwnProperty('display_name') && e.display_name) {
                                //         e['imageLetter'] = e.display_name.charAt(0);
                                //     } else {
                                //         e['imageLetter'] = e.name.first.charAt(0);
                                //     }
                                // }
                            } else {
                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                    e['imageLetter'] = e.display_name.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            }
                            return e;
                        }),
                        page_for: "moderator_first_time"
                    }
                    console.log("EmployeeList", EmployeeList);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "modal-collaborator-group-moderator-selection",
                            modal_header: "Moderator selection List",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Save",
                                "id": "add-collaborator-group-selected-moderator",
                            }]
                        }
                        showModal(modal_data, function () {
                            //add search element
                            $('.moderator-selection-list-main-box').prepend(`<div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="moderator-selection-list-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons moderator-selection-list-close-btn hide">close</i></span>
                                    </div>
                                </div>
                            `);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            removeLoader();
                            setTimeout(function () {
                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                var element = $('#moderator-selection-list-search-btn').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'collaborator_group_create':
                                                    // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                    if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                                                        // if (sessionStorage.getItem('group_from') == "employee_list") {
                                                        data['index'] = 'getEmployeeContactListAllEmployees';
                                                        data['business_id'] = sessionStorage.getItem('business_id')
                                                        // }
                                                    }
                                                    // }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'collaborator_group_create':
                                                    // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                    if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                                                        //console.log("ERROR", unique_member)
                                                        processSearchedEmployeeGroupEmployeeSelectionList(finalSelectedEmployeeList, function () { })
                                                    }
                                                    // }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($("body").attr('app') == "collaborator_group_create") {
                                            if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                                                //console.log("CLOSED", unique_member)
                                                processSearchedEmployeeGroupEmployeeSelectionList(finalSelectedEmployeeList, function () { })
                                            }
                                        }
                                    })
                                }
                            }, 0);
                        });
                    }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', EmployeeList);
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting employees");
                })
        }
    });
    // $(document).on('click', '#add_group_moderator_employees', function () {
    //     addLoader();
    //     if (sessionStorage.getItem('group_id')) {

    //     } else {//first time creation            
    //         var reqParam = {
    //             device_id: crossplat.device.uuid,
    //             list_by: "list_only_active",//list_unassigned_active
    //             business_id: sessionStorage.getItem('business_id')
    //         }
    //         employeeList(reqParam)
    //             .then((response) => {
    //                 //console.log("employeeList response", response);
    //                 var finalSelectedEmployeeList = [];
    //                 //members list
    //                 $.each($('.collaborator-group-owner-business-employee-member:checked'), function (index, employee) {
    //                     var getEmployee = response.find(e => e.dj_unique_employee_id == $(employee).attr('value'));
    //                     if (getEmployee != undefined) {
    //                         finalSelectedEmployeeList.push(getEmployee);
    //                     }
    //                 });
    //                 //moderators list
    //                 $.each($('.collaborator-group-employee-moderator-member'), function (index, employee) {
    //                     finalSelectedEmployeeList = finalSelectedEmployeeList.filter(p => {
    //                         return p.dj_unique_employee_id != $(employee).attr('value');
    //                     })
    //                 });
    //                 var EmployeeList = {
    //                     EmployeeList: finalSelectedEmployeeList.map(e => {
    //                         if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                             if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
    //                                 var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
    //                                 e.identity_picture['avtarUrl'] = avtarUrl;
    //                             } else {
    //                                 e['imageLetter'] = e.name.first.charAt(0);
    //                             }
    //                         } else {
    //                             e['imageLetter'] = e.name.first.charAt(0);
    //                         }
    //                         return e;
    //                     }),
    //                     page_for: "moderator_first_time"
    //                 }
    //                 //console.log("EmployeeList", EmployeeList);
    //                 fetch.getHtml(function (fetcherror, html) {
    //                     var modal_data = {
    //                         modal_id: "modal-collaborator-group-moderator-selection",
    //                         modal_header: "Moderator selection List",
    //                         modal_platform: crossplat.device.platform,
    //                         modal_body: html,
    //                         modal_action_buttons: [{
    //                             "name": "Save",
    //                             "id": "add-collaborator-group-selected-moderator",
    //                         }]
    //                     }
    //                     showModal(modal_data, function () {
    //                         if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                             if ($('.modal-popup-content').length > 0) {
    //                                 //console.log("scroll initiated for modal pop-up class")
    //                                 appScroll.scrollBar('.modal-popup-content');
    //                             }
    //                             $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         } else {
    //                             $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                         }
    //                         removeLoader();
    //                     });
    //                 }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', EmployeeList);
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 //console.log("error in getting employees");
    //             })
    //     }
    // });

    //delete collaborator group
    $(document).on('click', '#delete_collaborator_group', function () {
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        employeeGroupDelete(reqparams)
            .then((response) => {
                sessionStorage.removeItem('group_id');
                Materialize.toast(`Successfully deleted.`, 3000, "round success-alert");
                location.hash = `collaborator/groups/list`;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in deleting the group.`, 3000, "round error-alert");
            })
    })

    //reassign customer group
    $(document).on('click', '.reassign-customer-btn', function () {
        addLoader();
        // var getAlreadySelectedIdentifier = $('#customer-identifier-choose-select-dropdown').val();
        var getAlreadySelectedIdentifierId = $('.selected-value-customer-identifier').attr('data-id');
        var getAlreadySelectedIdentifierValue = $('.selected-value-customer-identifier').attr('data-value');
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "customer",
            business_id: sessionStorage.getItem('business_id')
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                var customerIdentifier = {
                    customerIdentifier: response,
                    alreadySelectedIdentifierValue: getAlreadySelectedIdentifierValue,
                    alreadySelectedIdentifierId: getAlreadySelectedIdentifierId
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (!fetcherror) {
                        removeLoader();
                        // var alert_parms = {
                        //     alert_id: "alert-customer-identifier-reassign-confirm-cancel",
                        //     alert_platform: crossplat.device.platform,
                        //     alert_title: "Customer Identifier Re-assign",
                        //     alert_body: html,
                        //     alert_btn: [{
                        //         name: "Cancel",
                        //         attr: [{ name: "id", value: "alert-cancel-customer-identifier-reassign" }]
                        //     },
                        //     {
                        //         name: "Confirm",
                        //         attr: [{ name: "id", value: "alert-confirm-customer-identifier-reassign" }]
                        //     }]
                        // }
                        // showAlert(alert_parms, function () {
                        //     appScroll.scrollBar('#customer-identifier-reassign-choose-select-dropdown .custom-dropdown');
                        //     // $('#customer-identifier-reassign-choose-select-dropdown').val(getAlreadySelectedIdentifierId);
                        // });
                        // var modal_data = {
                        //     modal_id: "alert-customer-identifier-reassign-confirm-cancel",
                        //     modal_header: "Customer Identifier Re-assign",
                        //     modal_platform: crossplat.device.platform,
                        //     modal_body: html,
                        //     modal_action_buttons: [{
                        //         "name": "Cancel",
                        //         "id": "alert-cancel-customer-identifier-reassign",
                        //     }, {
                        //         "name": "Confirm",
                        //         "id": "alert-confirm-customer-identifier-reassign",
                        //     }]
                        // }
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "alert-customer-identifier-reassign-confirm-cancel",
                            modal_header: "Customer Identifier Re-assign",
                            modal_body: html,
                            modal_action_buttons: [{
                                name: "Cancel",
                                attr: [{ name: "id", value: "alert-cancel-customer-identifier-reassign" }]
                            },
                            {
                                name: "Confirm",
                                attr: [{ name: "id", value: "alert-confirm-customer-identifier-reassign" }]
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#modal-close-btn').remove();
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    }
                }, 'layouts/popup/customer_identifier_reassign', '#customer-identifier-reassign-choose-template', customerIdentifier);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in getting the identifiers.`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '#alert-cancel-customer-identifier-reassign', function () {
        addLoader();
        $('#alert-customer-identifier-reassign-confirm-cancel').remove();
        removeLoader();
    });

    $(document).on('click', '#alert-confirm-customer-identifier-reassign', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        addLoader();
        // var getReassignIdentifierId = $('#customer-identifier-reassign-choose-select-dropdown').val();
        var getReassignIdentifierId = $('.selected-value-customer-identifier-reassign').attr('data-id');
        if (location.href.split('#').pop() == "collaborator/customer/create") {
            var requesParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('collaborator_business_customers_id'),
                reassign_customer_identifier_id: getReassignIdentifierId
            }
            collaboratorCustomerReassign(requesParam)
                .then((response) => {
                    //console.log("customerReassign response", response);
                    $('#customer-identifier-choose-select-dropdown').val(getReassignIdentifierId);
                    Materialize.toast(`${response}`, 3000, "round success-alert");


                    // var reqParam = {
                    //     device_id: crossplat.device.uuid,
                    //     id: sessionStorage.getItem('customer_id'),
                    //     data: {
                    //         socket_enable_status: "true",
                    //         update_for: "socket_enable_status"
                    //     }
                    // }
                    // //console.log("reqParam", reqParam);
                    // collaboratorCustomerBusinessUpdate(reqParam)
                    //     .then((response) => {
                    $('#alert-customer-identifier-reassign-confirm-cancel').remove();
                    //console.log("customerUpdate", response);
                    // sessionStorage.removeItem('customer_id');
                    // sessionStorage.removeItem('customer_name');
                    location.hash = `customer/collaborators`;
                    // })
                    // .catch((err) => {
                    //     $('#alert-customer-identifier-reassign-confirm-cancel').remove();
                    //     //console.log("error in update business api", err);
                    //     if (err.msg == "no updated data found") {
                    //         sessionStorage.removeItem('customer_id');
                    //         location.hash = `customer_creation`;
                    //     }
                    // })

                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                })
        } else {
            var requesParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('customer_id'),
                reassign_customer_identifier_id: getReassignIdentifierId
            }
            customerReassign(requesParam)
                .then((response) => {
                    //console.log("customerReassign response", response);
                    $('#customer-identifier-choose-select-dropdown').val(getReassignIdentifierId);
                    Materialize.toast(`${response}`, 3000, "round success-alert");


                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('customer_id'),
                        data: {
                            socket_enable_status: "true",
                            update_for: "socket_enable_status"
                        }
                    }
                    //console.log("reqParam", reqParam);
                    customerUpdate(reqParam)
                        .then((response) => {
                            $('#alert-customer-identifier-reassign-confirm-cancel').remove();
                            //console.log("customerUpdate", response);
                            sessionStorage.removeItem('customer_id');
                            sessionStorage.removeItem('customer_name');
                            location.hash = `customer_creation/active/list`;
                        })
                        .catch((err) => {
                            $('#alert-customer-identifier-reassign-confirm-cancel').remove();
                            //console.log("error in update business api", err);
                            if (err.msg == "no updated data found") {
                                sessionStorage.removeItem('customer_id');
                                location.hash = `customer_creation`;
                            }
                        })

                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                })
        }
    });


    $(document).on('click', '.module-admin-management-wrapper', function () {
        addLoader();
        sessionStorage.setItem('module_type', $(this).attr('data-type'));
        location.hash = `module_admin/list`;
        // var getType = $(this).attr('data-type');
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     business_id: sessionStorage.getItem('business_id'),
        //     list_by: "module_wise_module_admin",
        //     module: getType
        // }
        // businessOwnerList(reqParam)
        //     .then((response) => {
        //         //console.log("businessOwnerList response", response);
        //         var dataList = {
        //             dataList: response.map(e => {
        //                 if (e.module == "customer_management") {
        //                     e.module_name = 'Customer Management';
        //                 } else if (e.module == "employee_management") {
        //                     e.module_name = 'Employee Management';
        //                 } else if (e.module == "communication_management") {
        //                     e.module_name = 'Communication Management';
        //                 } else if (e.module == "collaborator_management") {
        //                     e.module_name = 'Collaborator Management';
        //                 }
        //                 if (e.owner_data.employee_data.hasOwnProperty('identity_picture') && e.owner_data.employee_data.identity_picture) {
        //                     if (e.owner_data.employee_data.identity_picture.hasOwnProperty('thumbnail') && e.owner_data.employee_data.identity_picture.thumbnail) {
        //                         var avtarUrl = `${api.get_employee_identity_picture}?id=${e.owner_data.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.owner_data.employee_data.identity_picture.thumbnail}`;
        //                         e.owner_data.employee_data.identity_picture['avtarUrl'] = avtarUrl;
        //                     } else {
        //                         e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
        //                     }
        //                 } else {
        //                     e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
        //                 }
        //                 return e;
        //             })
        //         }
        //         fetch.replaceHtml(function () {
        //             if ($('.employee-wrapper').length == 0) {
        //                 $('#module-admin-list-wrapper').append(`<div class="no_data">No data found</div>`);
        //             }
        //             removeLoader();
        //         }, "page/business/module_admins_list_data", "#module-admin-list-template", "#module-admin-list-data-container", dataList);
        //     })
        //     .catch((err) => {
        //         //console.log("error in businessOwnerList list");
        //         fetch.replaceHtml(function () {
        //             removeLoader();
        //         }, "page/business/module_admins_list_data", "#module-admin-list-template", "#module-admin-list-data-container", null);
        //     })
    });


    $(document).on('click', '.active-super-admin-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-super-admin-management-tab', "active-super-admin");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-super-admin-management-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-super-admin-management-tab')}"]`).addClass('active');
        digibiz.active_super_admins_list = [];
        activeSuperAdminsTab();
    });

    $(document).on('click', '.pending-super-admin-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-super-admin-management-tab', "pending-super-admin");
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-super-admin-management-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-super-admin-management-tab')}"]`).addClass('active');
        digibiz.pending_super_admins_list = [];
        pendingSuperAdminsTab();
    });

    // $(document).on('click', '#super_admin_add_button', function () {
    //     addLoader();
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         business_id: sessionStorage.getItem('business_id'),
    //         list_by: "pending_super_admins"
    //     }
    //     notificationList(reqParam)
    //         .then((response) => {
    //             //console.log("notificationList response", response);
    //             var getLength = $('.active-super-admin-list-contentbox').find('.employee-wrapper').length + response.length;
    //             //console.log("getLength", getLength);
    //             if (getLength < 3) {
    //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                     fetch.getHtml(function (fetcherror, html) {
    //                         var modal_data = {
    //                             modal_platform: crossplat.device.platform,
    //                             modal_id: "add-super-admin-modal",
    //                             modal_header: "Add Super-Admin",
    //                             modal_body: html,
    //                             modal_action_buttons: [{
    //                                 name: "Notify",
    //                                 attr: [{ name: "id", value: "notify-super-admin-btn" }]
    //                             }]
    //                         }
    //                         showModal(modal_data, function () {
    //                             removeLoader();
    //                             mobileFlaginit();
    //                             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                                 if ($('.modal-popup-content').length > 0) {
    //                                     //console.log("scroll initiated for modal pop-up class")
    //                                     appScroll.scrollBar('.modal-popup-content');
    //                                 }
    //                                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                             } else {
    //                                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                             }
    //                         });
    //                     }, 'page/business/super_admin_notify_modal', '#add-super-admin-notify-template', null);
    //                 } else {
    //                     var action_sheet_parms = {
    //                         action_id: "super_admin_creation_by_selection_modal",
    //                         action_platform: crossplat.device.platform,
    //                         action_title: "Options",
    //                         action_btn: [{
    //                             name: "By Notification",
    //                             attr: [{ name: "id", value: "super_admin_by_notification" }]
    //                         },
    //                         {
    //                             name: "By QR-code",
    //                             attr: [{ name: "id", value: "super_admin_by_qr_code" }]
    //                         }
    //                         ]
    //                     }
    //                     showAction(action_sheet_parms, function () {
    //                         removeLoader();
    //                         $(".action-sheet-container").removeClass('hide').addClass('slide-top');
    //                     });
    //                 }
    //             } else {
    //                 removeLoader();
    //                 Materialize.toast(`Maximum super admins reached.`, 3000, 'round success-alert');
    //             }
    //         })
    //         .catch((err) => {
    //             if ($('.active-super-admin-list-contentbox').find('.employee-wrapper').length < 3) {
    //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                     fetch.getHtml(function (fetcherror, html) {
    //                         var modal_data = {
    //                             modal_platform: crossplat.device.platform,
    //                             modal_id: "add-super-admin-modal",
    //                             modal_header: "Add Super-Admin",
    //                             modal_body: html,
    //                             modal_action_buttons: [{
    //                                 name: "Notify",
    //                                 attr: [{ name: "id", value: "notify-super-admin-btn" }]
    //                             }]
    //                         }
    //                         showModal(modal_data, function () {
    //                             removeLoader();
    //                             mobileFlaginit();
    //                             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                                 if ($('.modal-popup-content').length > 0) {
    //                                     //console.log("scroll initiated for modal pop-up class")
    //                                     appScroll.scrollBar('.modal-popup-content');
    //                                 }
    //                                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                             } else {
    //                                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                             }
    //                         });
    //                     }, 'page/business/super_admin_notify_modal', '#add-super-admin-notify-template', null);
    //                 } else {
    //                     var action_sheet_parms = {
    //                         action_id: "super_admin_creation_by_selection_modal",
    //                         action_platform: crossplat.device.platform,
    //                         action_title: "Options",
    //                         action_btn: [{
    //                             name: "By Notification",
    //                             attr: [{ name: "id", value: "super_admin_by_notification" }]
    //                         },
    //                         {
    //                             name: "By QR-code",
    //                             attr: [{ name: "id", value: "super_admin_by_qr_code" }]
    //                         }
    //                         ]
    //                     }
    //                     showAction(action_sheet_parms, function () {
    //                         removeLoader();
    //                         $(".action-sheet-container").removeClass('hide').addClass('slide-top');
    //                     });
    //                 }
    //             } else {
    //                 removeLoader();
    //                 Materialize.toast(`Maximum super admins reached.`, 3000, 'round success-alert');
    //             }
    //         })
    // });

    //by notification
    $(document).on('click', '#super_admin_by_notification', function () {
        addLoader();
        fetch.getHtml(function (fetcherror, html) {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "add-super-admin-modal",
                modal_header: "Add Super-Admin",
                modal_body: html,
                modal_action_buttons: [{
                    name: "Notify",
                    attr: [{ name: "id", value: "notify-super-admin-btn" }]
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                mobileFlaginit();
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
            });
        }, 'page/business/super_admin_notify_modal', '#add-super-admin-notify-template', null);
    });

    //by qr code
    $(document).on('click', '#super_admin_by_qr_code', function () {
        addLoader();
        $('#super_admin_creation_by_selection_modal').remove();
        location.hash = '#super_admin/scan_qr';
    });

    $(document).on('click', '#notify-super-admin-btn', function () {
        addLoader();
        var data_type;
        if ($('#super_admin_unique_name_field').val().trim().length > 0) {
            var unique_name = $('#super_admin_unique_name_field').val().trim();
            data_type = "unique_name";
        } else if ($('#add-super-admin-mobile-number').val().trim().length > 0) {
            var mobileNumber = $('#add-super-admin-mobile-number').intlTelInput("getNumber").replace(/\s/g, '');
            data_type = "mobile_number";
        }
        //console.log("data_type", data_type);
        if (data_type == null || data_type == undefined || data_type == "") {
            removeLoader();
            Materialize.toast(`Please enter data`, 3000, 'round success-alert');
        } else {
            var reqParam = {
                device_id: crossplat.device.uuid,
                data_type: data_type,
                add_type: "add",
                type: "super_admin",
                business_id: sessionStorage.getItem('business_id'),
                unique_name: unique_name,
                mobile_number: mobileNumber
            }
            notificationAdd(reqParam)
                .then((response) => {
                    //console.log("notificationAdd response", response);
                    Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                    $('#add-super-admin-modal').remove();
                    removeLoader();
                })
                .catch((err) => {
                    //console.log("notificationAdd error", err);
                    Materialize.toast(err.msg, 3000, 'round success-alert');
                    removeLoader();
                });
        }
    });


    $(document).on('click', '#delete-super-admin-icon', function () {
        addLoader();
        var getEmployeeId = $(this).parents('.employee-wrapper').attr('data-employee-id');
        var action_sheet_parms = {
            action_id: "super_admin_delete_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Revoke Super Admin",
                attr: [{ name: "id", value: "revoke_super_admin" }]
            },
            {
                name: "Delete Employee",
                attr: [{ name: "id", value: "delete_super_admin_employee" }]
            }
            ]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $(".action-sheet-container").attr('data-employee-id', getEmployeeId);
            removeLoader();
        });
    });

    $(document).on('click', '#revoke_super_admin', function () {
        addLoader();
        var getEmployeeId = $('#super_admin_delete_action_sheet').attr('data-employee-id');
        $('#super_admin_delete_action_sheet').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "revoke_super_admin",
            super_admin_employee_id: getEmployeeId
        }
        businessSuperAdminRevoke(reqParam)
            .then((response) => {
                //console.log("success is super-admin revoke", response);
                $(`.employee-wrapper[data-employee-id="${getEmployeeId}"]`).remove();
                Materialize.toast(`Successfully revoked.`, 3000, 'round error-alert');
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`${err.msg}`, 3000, 'round error-alert');
            })
    });

    $(document).on('click', '#delete_super_admin_employee', function () {
        addLoader();
        var getEmployeeId = $('#super_admin_delete_action_sheet').attr('data-employee-id');
        $('#super_admin_delete_action_sheet').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "delete_employee",
            super_admin_employee_id: getEmployeeId
        }
        businessSuperAdminRevoke(reqParam)
            .then((response) => {
                //console.log("success is super-admin revoke", response);
                $(`.employee-wrapper[data-employee-id="${getEmployeeId}"]`).remove();
                Materialize.toast(`Successfully deleted.`, 3000, 'round error-alert');
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`${err.msg}`, 3000, 'round error-alert');
            })
    });

    $(document).on("click", '.digibiz-filemanager', function (e) {
        sessionStorage.removeItem('business_upload_for');
        sessionStorage.removeItem('employee_upload_for');
        sessionStorage.removeItem('customer_upload_for');
        sessionStorage.removeItem('associate_customer_upload_for');
        sessionStorage.removeItem('individual_assets');
        digibiz.cloudAssets = [];
        if ($('body').attr('app') == "business_edit" || $('body').attr('app') == "business_add") {
            var getStep = $('.bussines-forward-btn').attr('data-present-step');
            //console.log("getStep", getStep);
            if (getStep == 2 || getStep == "2") {
                if ($('#business-display-video-from-action-sheet').length > 0) {
                    $('#business-display-video-from-action-sheet').remove();
                    sessionStorage.setItem('business_upload_for', "business_identity_video");
                } else {
                    $('#business-display-picture-type-action-sheet').remove();
                    sessionStorage.setItem('business_upload_for', "business_display_picture");
                }
            } else if (getStep == 3 || getStep == "3") {
                $('#action-multimedia-upload-attachments-options').remove();
            } else if (getStep == 5 || getStep == "5") {
                var getDeclarationFor = $('#business-declaration-transaction-signature-type-action-sheet').attr('declaration_for');
                sessionStorage.setItem('cloud_upload_for', getDeclarationFor);
                $('#business-declaration-transaction-signature-type-action-sheet').remove();
            }
        }
        if ($('body').attr('app') == "employee_create" || $('body').attr('app') == "employee_edit") {
            if ($('#employee-identity-picture-type-action-sheet').length > 0) {
                $('#employee-identity-picture-type-action-sheet').remove();
            } else {
                $('#employee-display-video-from-action-sheet').remove();
                sessionStorage.setItem('employee_upload_for', "employee_identity_video");
            }
        }
        if ($('body').attr('app') == "customer_create" || $('body').attr('app') == "customer_edit") {
            if ($('#customer-identity-picture-type-action-sheet').length > 0) {
                $('#customer-identity-picture-type-action-sheet').remove();
            } else if ($('#associate-customer-identity-picture-type-action-sheet').length > 0) {
                $('#associate-customer-identity-picture-type-action-sheet').remove();
            } else if ($('#customer-display-video-from-action-sheet').length > 0) {
                $('#customer-display-video-from-action-sheet').remove();
                sessionStorage.setItem('customer_upload_for', "customer_identity_video");
            } else if ($('#associate-customer-display-video-from-action-sheet').length > 0) {
                $('#associate-customer-display-video-from-action-sheet').remove();
                sessionStorage.setItem('associate_customer_upload_for', "associate_customer_identity_video");
            }
        }
        if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details" || $('body').attr('app') == "collaborator_group_create") {
            $('#group-image-type-action-sheet').remove();
        }
        if ($('body').attr('app') == "digibiz_credentials") {
            var getUploadFor = $('#action-credentials-pictures-upload-attachments-options').attr('upload-for');
            if (getUploadFor == "transaction_picture") {
                $('#transaction_pictures_main_container').addClass('active');
            } else if (getUploadFor == "signature_picture") {
                $('#signature_pictures_main_container').addClass('active');
            }
            $('#action-credentials-pictures-upload-attachments-options').remove();
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "business-credential-picture-modal",
                modal_header: "Crop Image",
                modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                modal_action_buttons: [{
                    id: "business-credential-picture-crop-button",
                    name: `crop`,
                    attr: [{
                        name: "data-id",
                        value: ''
                    }]
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if ($('.modal-popup-content').length > 0) {
                    if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                        // //console.log("scroll initiated for modal pop-up class")
                        // appScroll.scrollBar('.modal-popup-content');
                    }
                }
                $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                $('#business-credential-picture-modal').attr('picture-type', getUploadFor);
            });
        }
        showCloudSelcetionList(function () {
            $('.filemanger_container_toggle').addClass('active');
            $('.file-manager-footer').removeClass('hide');
            $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
        });
    })


    $(document).on("click", '.individual-assets', function (e) {
        e.stopImmediatePropagation();
        sessionStorage.removeItem('individual_assets');
        sessionStorage.setItem('individual_assets', true);
        var requestParams = {
            device_id: crossplat.device.uuid,
            owner: {
                type: "individual",
                id: window.sessionStorage.getItem('user_id')
            },
            location: "personal_workspace",
            parent: null,
            first_request: 'true',
            offset: 0,
            count: 20
        };
        getIndividualAssets(requestParams).then((assetsDetails) => {
            digibiz.cloudAssets = assetsDetails.Data.assets;
            showIndividualFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
                // listenForFilemanagerAssetsScrollEvent($("#filemanger-assets-list-wrapper"));
                $('.cloud-storage-heading').addClass('hide').siblings('.arrow-back-btn').removeClass('hide');
                $('.file-manager-footer').removeClass('hide');
                $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
            })
        }).catch((err) => {
            //console.log('err', err);
            let res = JSON.parse(err.responseText);
            if (res.message == "No assets found") {
                showIndividualFilemanagerAssetsFilesList(null, function () {
                })
            }
        });
    });

    $(document).on('click', '.cloud-close-btn', function (e) {
        sessionStorage.removeItem('individual_assets');
        sessionStorage.removeItem('digibiz_assets');
        $('.filemanager').find('.expand-search-input').removeClass('filemanager-search');
        $('.filemanger_container_toggle').removeClass('active');
    });

    $(document).on('change', 'input[name="individualFilemanagerFileSelection[]"]', function () {
        let countCheckedCheckboxes = $('input[name="individualFilemanagerFileSelection[]"]').filter(':checked').length;
        //console.log("countCheckedCheckboxes", countCheckedCheckboxes);
        if (countCheckedCheckboxes > 1) {
            $(this).prop('checked', false);
            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
        } else {
            $(document).find('.number_of_files_selected .numbers_selected').text(countCheckedCheckboxes);
            if ($(this).is(':checked')) {
                $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                var assetId = $(this).attr('data-asset_id');
                var index = digibiz.assets.findIndex(e => e.id == assetId);
                if (index != -1) {
                    digibiz.assets[index]['checked'] = true;
                }
                $(this).parents('.filemanager-row').addClass('highlight');
            } else {
                $(this).parents('.filemanager-row').removeClass('highlight');
            }
        }
    });

    $(document).on('change', 'input[name="digibizFilemanagerFileSelection[]"]', function () {
        let countCheckedCheckboxes = $('input[name="digibizFilemanagerFileSelection[]"]').filter(':checked').length;
        if (countCheckedCheckboxes > 1) {
            $(this).prop('checked', false);
            Materialize.toast('You can select only 1 file', 4000, 'round error-alert');
        } else {
            $(document).find('.number_of_files_selected .numbers_selected').text(countCheckedCheckboxes);
            if ($(this).is(':checked')) {
                $('.filemanger_container_toggle').find('.grid-view-container').addClass('edit-mode');
                var assetId = $(this).attr('data-asset_id');
                var index = digibiz.assets.findIndex(e => e.id == assetId);
                if (index != -1) {
                    digibiz.assets[index]['checked'] = true;
                }
                $(this).parents('.filemanager-row').addClass('highlight');
            } else {
                $(this).parents('.filemanager-row').removeClass('highlight');
            }
        }
    });


    $(document).on("click", '.digibiz-assets', function (e) {
        sessionStorage.removeItem('digibiz_assets');
        sessionStorage.setItem('digibiz_assets', true);
        getAssets().then((assetsDetails) => {
            digibiz.cloudAssets = assetsDetails.Data.assets;
            showDigibizFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
                // listenForFilemanagerAssetsScrollEvent($("#filemanger-assets-list-wrapper"));
                $('.cloud-storage-heading').addClass('hide').siblings('.arrow-back-btn').removeClass('hide');
                $('.file-manager-footer').removeClass('hide');
                $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
            })
        }).catch((err) => {
            //console.log('err', err);
            let res = JSON.parse(err.responseText);
            if (res.message == "No assets found") {
                showDigibizFilemanagerAssetsFilesList(null, function () {
                    $('.cloud-storage-heading').addClass('hide').siblings('.arrow-back-btn').removeClass('hide');
                    $('.file-manager-footer').removeClass('hide');
                    $('.filemanager').find('.expand-search-input').addClass('filemanager-search');
                })
            }
        });

        // digibizFilemanagerNavigateToLocation(null, function () { });
    });











    //delete department from custom-department_list group
    $(document).on('click', '#delete-collaborator-contact-icon', function () {
        addLoader();
        var getCollaboratorContactId = $(this).parents('.collaborator-contact-wrapper').attr('data-id');
        var alert_parms = {
            alert_id: "alert-delete-collaborator-contact-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete collaborator contact`,
            alert_body: `Are you sure you want to delete the collaborator contact?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-collaborator-contact-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-collaborator-contact-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-collaborator-contact-confirm-cancel').attr('data-id', getCollaboratorContactId); //set getCollaboratorContactId
        });
    });

    //Delete no department member
    $(document).on('click', '#btn-delete-collaborator-contact-cancel-no', function () {
        $('#alert-delete-collaborator-contact-confirm-cancel').remove();
    });

    //Delete yes department member
    $(document).on('click', '#btn-delete-collaborator-contact-confirm-yes', function () {
        addLoader();
        var getCollaboratorContactId = $('#alert-delete-collaborator-contact-confirm-cancel').attr('data-id');
        $('#alert-delete-collaborator-contact-confirm-cancel').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getCollaboratorContactId
        }
        collaboratorDelete(requestParams)
            .then((response) => {
                //console.log("collaboratorDelete response", response);
                $(`.collaborator-contact-wrapper[data-id="${getCollaboratorContactId}"]`).remove();
                removeLoader();
                Materialize.toast(`Successfully removed contact.`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                //console.log("Error in removing collaborator contact");
                Materialize.toast(`Error in deleting`, 3000, 'round success-alert');
            })
    });


    /**
     * set default Storage
     */

    $(document).on('click', '.setdefault-account-btn', function () {
        console.log("setdefault-account-btn")
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        //console.log("selected_storage", selected_storage);
        $('#confirm-modal-storage').remove();
        if (config.storages.map(e => e.name).includes(selected_storage)) {
            activateStorage(selected_storage, function (e) {
                if (e) {
                    $(".setdefault-account-btn").removeClass('hide');
                    $($this).addClass('hide');
                }
            });
        } else {
            //console.log("invalid storage selected");
        }
    });

    $(document).on('click', '.show-active-account', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var drive = $(this).parents('.cloud-storage-account').attr('data-storage');
        //console.log("drive", drive);
        var storage_token = config.storages.find(e => e.name == drive);
        //console.log("storage_token", storage_token);
        if ($('body').attr('app') == "business_edit" || $('body').attr('app') == "business_add" || $('body').attr('app') == "business_storage") {
            var getData = digibiz.storages.find(e => e.name == drive);
            //console.log("getData", getData);
            if (storage_token) {
                var alert_parms = {
                    alert_id: "account",
                    alert_platform: crossplat.device.platform,
                    // ${storage_token.account.picture}
                    //     alert_body: `<div class="storage-active-account">
                    // <div class="profile-picture-wrapper"><img src="${getData.account.picture}"/></div>
                    // <div class="profile-details-wrapper"><div class="profile-name">${getData.account.name}</div><div class="profile-email">${getData.account.email}</div></div>
                    // <div class="profile-action-wrapper" id="logout-storage-account" data-storage="${drive}">Logout</div>
                    // </div>`,
                    alert_body: `<div class="storage-active-account">
                <div class="profile-picture-wrapper"><img src="${getData.account.picture}"/></div>
                <div class="profile-details-wrapper"><div class="profile-name">${getData.account.name}</div><div class="profile-email">${getData.account.email}</div></div>
                </div>`,
                    alert_btn: [
                        {
                            name: "Logout",
                            attr: [{ name: "id", value: "logout-storage-account" }, { name: "data-storage", value: drive }]
                        }, {
                            name: "ok",
                            attr: [{ name: "id", value: "show-active-account-ok" }]
                        }]
                }
                showAlert(alert_parms, function () { });
            }
        } else {
            var getData = digibiz.digibiz_storages.find(e => e.name == drive);
            //console.log("getData", getData);
            if (storage_token) {
                var alert_parms = {
                    alert_id: "account",
                    alert_platform: crossplat.device.platform,
                    // ${storage_token.account.picture}
                    alert_body: `<div class="storage-active-account">
                <div class="profile-picture-wrapper"><img src="${getData.account.picture}"/></div>
                <div class="profile-details-wrapper"><div class="profile-name">${getData.account.name}</div><div class="profile-email">${getData.account.email}</div></div>
                
                </div>`,
                    alert_btn: [
                        {
                            name: "Logout",
                            attr: [{ name: "id", value: "logout-storage-account" }, { name: "data-storage", value: drive }]
                        },
                        {
                            name: "ok",
                            attr: [{ name: "id", value: "show-active-account-ok" }]
                        }]
                }
                showAlert(alert_parms, function () { });
            }
        }
    });

    $(document).on('click', '#show-active-account-ok', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('.custom-modal').remove();
    });

    /**
     * logout Storage account popup
     */

    $(document).on('click', '#logout-storage-account', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        $('.custom-modal').remove();
        var alert_parms = {
            alert_id: "logout-account",
            alert_platform: crossplat.device.platform,
            alert_title: `Logout of ${selected_storage.toLowerCase()} account`,
            alert_body: `Are you sure you want to Logout?`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "logout-cancel" }]
            }, {
                name: "Logout",
                attr: [
                    {
                        name: "id", value: "logout-storage-account-confirm"
                    },
                    // {
                    //     name: "data-storage", value: selected_storage
                    // }
                ]
            }]
        }
        showAlert(alert_parms, function () {
            $('#logout-storage-account-confirm').attr('data-storage', selected_storage)
            config.storages.forEach((e) => {
                //console.log(e.name);
                $('.add-storage-list-wrapper').find(`li[data-storage="${e.name}"]`).addClass('disable');
            });
        });
    });

    $(document).on('click', '#logout-cancel', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#logout-account').remove();
    });

    /**
    * logout Storage account confirm
    */

    $(document).on('click', '#logout-storage-account-confirm', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        //call api
        $('.custom-modal').remove();
        if ($('body').attr('app') == "business_add" || $('body').attr('app') == "business_edit" || $('body').attr('app') == "business_storage") {
            var requestParams = {
                device_id: crossplat.device.uuid,
                drive: selected_storage,
                id: sessionStorage.getItem('business_id'),
                type: "business"
            }
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    if (selected_storage == "DropBox") {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            window.open('https://www.dropbox.com/logout', '_blank');
                        } else {
                            cordova.plugins.browsertab.openUrl('https://www.dropbox.com/logout', { scheme: "djbusiness://" });
                        }
                    }
                    // config.storages = config.storages.filter(e => e.name != selected_storage);
                    digibiz.storages = digibiz.storages.filter(e => e.name != selected_storage);
                    $(".cloud-storage-wrapper").find(`div[data-storage="${selected_storage}"]`).remove();
                    if (config.storages.length < 4 && $(".add-storage-account").length == 0) {
                        $(".cloud-storage-wrapper").append(`<div class="cloud-storage-account add-storage-account">
                            <i class="material-icons">add</i>
                        </div>`);
                    }
                    Materialize.toast(response.message, 3000, 'success-alert');
                } else {
                    var jsonResponse = JSON.parse(response.responseText);
                    Materialize.toast(jsonResponse.Data, 3000, 'error-alert');
                }
            }, api.revoke_storage, "POST", "JSON", requestParams);
        } else {
            var requestParams = {
                device_id: crossplat.device.uuid,
                drive: selected_storage,
                id: sessionStorage.getItem('account_id'),
                type: "individual"
            }
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    if (selected_storage == "DropBox") {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            window.open('https://www.dropbox.com/logout', '_blank');
                        } else {
                            cordova.plugins.browsertab.openUrl('https://www.dropbox.com/logout', { scheme: "djbusiness://" });
                        }
                    }
                    // config.storages = config.storages.filter(e => e.name != selected_storage);
                    digibiz.digibiz_storages = digibiz.digibiz_storages.filter(e => e.name != selected_storage);
                    $(".cloud-storage-wrapper").find(`div[data-storage="${selected_storage}"]`).remove();
                    if (config.storages.length < 4 && $(".add-storage-account").length == 0) {
                        $(".cloud-storage-wrapper").append(`<div class="cloud-storage-account add-storage-account">
                            <i class="material-icons">add</i>
                        </div>`);
                    }
                    Materialize.toast(response.message, 3000, 'success-alert');
                } else {
                    var jsonResponse = JSON.parse(response.responseText);
                    Materialize.toast(jsonResponse.Data, 3000, 'error-alert');
                }
            }, api.revoke_storage, "POST", "JSON", requestParams);
        }
    });



    $(document).on('click', '.employee-access-module', function () {
        addLoader();
        location.hash = `employee/access/list`;
    });


    $(document).on('click', '#employee_access_show_btn', function () {
        addLoader();
        digibiz.show_employee_access_list = [];
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "employee",
            member_id: sessionStorage.getItem('employee_id'),
        }
        showAccessEmployeeList(reqParam)
            .then((response) => {
                //console.log("showAccessEmployeeList", response);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "employee-access-show-modal",
                    modal_header: "Access List",
                    modal_body: `<div id="employee-access-list-container-modal">
        <span class="searchbtn waves-effect cursor-pointer hide" id="associate-customer-notification-details-list-search-btn"><i class="material-icons">search</i></span>
        <div class="expand-search-wrap hide" id="associate_customer_notification_details_list_expand_search_wrap">
            <input class="expand-search-input" id="associate_customer_notification_details_list_expand_search_input" type="search" placeholder="Search" autocomplete="off"/>
            <span class="searchclosebtn" id="associate_customer_notification_details_list_searchclosebtn"><i class="material-icons associate-customer-notification-details-list-close-btn hide">close</i></span>
        </div>
        <div id="employee-show-access-list-content-box"></div>
    </div>`,
                    modal_action_buttons: [{
                        id: "employee-access-remove-confirm-btn",
                        name: `CONFIRM`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processEmployeeShowAccessList(response, function () {
                        removeLoader();
                        // setTimeout(function () {
                        //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                        // }, 0);
                    });
                });
            })
            .catch((err) => {
                removeLoader();
            })
    });


    $(document).on('click', '#customer_access_show_btn', function () {
        if (location.href.split('#').pop() == "customer/collaborators") {
            digibiz.show_customer_access_list = [];
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "customer",
                id: sessionStorage.getItem('collaborator_business_customers_id'),
                identifier_id: sessionStorage.getItem('collaborator_business_identifier_id'),
                customer_type: "collaborator_customers"
            }
            getIdentifierItem(requestParams)
                .then((result) => {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id'),
                        type: "customer",
                        identifier_id: sessionStorage.getItem('collaborator_business_identifier_id'),
                        identifier_item_id: result.id,
                        member_id: sessionStorage.getItem('customer_id'),
                        collaborator_business_customers_id: sessionStorage.getItem('collaborator_business_customers_id'),
                        customer_type: "collaborator_customers"
                    }
                    showAccessCustomerList(reqParam)
                        .then((response) => {
                            //console.log("showAccessCustomerList", response);
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "customer-access-show-modal",
                                modal_header: "Access List",
                                modal_body: `<div id="customer-access-list-container-modal">
            <span class="searchbtn waves-effect cursor-pointer hide" id="associate-customer-notification-details-list-search-btn"><i class="material-icons">search</i></span>
            <div class="expand-search-wrap hide" id="associate_customer_notification_details_list_expand_search_wrap">
                <input class="expand-search-input" id="associate_customer_notification_details_list_expand_search_input" type="search" placeholder="Search" autocomplete="off"/>
                <span class="searchclosebtn" id="associate_customer_notification_details_list_searchclosebtn"><i class="material-icons associate-customer-notification-details-list-close-btn hide">close</i></span>
            </div>
            <div id="customer-show-access-list-content-box"></div>
        </div>`,
                                modal_action_buttons: [{
                                    id: "customer-access-remove-confirm-btn",
                                    name: `CONFIRM`,
                                    attr: [{
                                        name: "data-id",
                                        value: ''
                                    }]
                                }]
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                processCustomerShowAccessList(response, function () {
                                    removeLoader();
                                    // setTimeout(function () {
                                    //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                                    // }, 0);
                                });
                            });
                        })
                        .catch((err) => {
                            removeLoader();
                        })
                })
                .catch((err) => {
                    removeLoader();
                })

        } else {
            digibiz.show_customer_access_list = [];
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "customer",
                id: sessionStorage.getItem('customer_id')
            }
            getIdentifierItem(requestParams)
                .then((result) => {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id'),
                        type: "customer",
                        identifier_id: sessionStorage.getItem('identifier_id'),
                        identifier_item_id: result.id,
                        member_id: sessionStorage.getItem('customer_id'),
                    }
                    showAccessCustomerList(reqParam)
                        .then((response) => {
                            //console.log("showAccessCustomerList", response);
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "customer-access-show-modal",
                                modal_header: "Access List",
                                modal_body: `<div id="customer-access-list-container-modal">
        <span class="searchbtn waves-effect cursor-pointer hide" id="associate-customer-notification-details-list-search-btn"><i class="material-icons">search</i></span>
        <div class="expand-search-wrap hide" id="associate_customer_notification_details_list_expand_search_wrap">
            <input class="expand-search-input" id="associate_customer_notification_details_list_expand_search_input" type="search" placeholder="Search" autocomplete="off"/>
            <span class="searchclosebtn" id="associate_customer_notification_details_list_searchclosebtn"><i class="material-icons associate-customer-notification-details-list-close-btn hide">close</i></span>
        </div>
        <div id="customer-show-access-list-content-box"></div>
    </div>`,
                                modal_action_buttons: [{
                                    id: "customer-access-remove-confirm-btn",
                                    name: `CONFIRM`,
                                    attr: [{
                                        name: "data-id",
                                        value: ''
                                    }]
                                }]
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                processCustomerShowAccessList(response, function () {
                                    removeLoader();
                                    // setTimeout(function () {
                                    //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                                    // }, 0);
                                });
                            });
                        })
                        .catch((err) => {
                            removeLoader();
                        })
                })
                .catch((err) => {
                    removeLoader();
                })
        }
    });

    $(document).on('click', '.associate_customer_show_access_list', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        digibiz.show_associate_customer_access_list = [];
        var getAssociateCustomerId = $('#associate_customer_alert_actions').attr('associate_customer_id');
        addLoader();
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "associate_customer",
            id: getAssociateCustomerId
        }
        getIdentifierItem(requestParams)
            .then((result) => {
                //console.log("result", result);
                var getIdentifierIdData = result.data.find((e) => e.type == "associate_customer_identifier");
                //console.log("getIdentifierIdData", getIdentifierIdData);
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    type: "associate_customer",
                    identifier_id: getIdentifierIdData.identifier_id,
                    identifier_item_id: result.id,
                    member_id: getAssociateCustomerId,
                    parent_identifier_id: result.parent_customer_identifier_id
                }
                showAccessCustomerList(reqParam)
                    .then((response) => {
                        //console.log("showAccessCustomerList", response);
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "associate-customer-access-show-modal",
                            modal_header: "Access List",
                            modal_body: `<div id="customer-access-list-container-modal">
        <span class="searchbtn waves-effect cursor-pointer hide" id="associate-customer-notification-details-list-search-btn"><i class="material-icons">search</i></span>
        <div class="expand-search-wrap hide" id="associate_customer_notification_details_list_expand_search_wrap">
            <input class="expand-search-input" id="associate_customer_notification_details_list_expand_search_input" type="search" placeholder="Search" autocomplete="off"/>
            <span class="searchclosebtn" id="associate_customer_notification_details_list_searchclosebtn"><i class="material-icons associate-customer-notification-details-list-close-btn hide">close</i></span>
        </div>
        <div id="associate-customer-show-access-list-content-box"></div>
    </div>`
                        }
                        showModal(modal_data, function () {
                            $('#associate_customer_alert_actions').remove();
                            $('#associate-customer-access-show-modal').attr('data-associate-customer-id', getAssociateCustomerId);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            processAssociateCustomerShowAccessList(response, function () {
                                removeLoader();
                                // setTimeout(function () {
                                //     listenForFollowUserScrollEvent($(".modal-popup-content"));
                                // }, 0);
                            });
                        });
                    })
                    .catch((err) => {
                        removeLoader();
                    })
            })
            .catch((err) => {
                removeLoader();
            })
    });


    $(document).on('click', '.app_hub_btn', function (e) {
        e.stopPropagation();
        $("#alert-exit-card-confirm-cancel").remove();
        $('.menu-overlay').remove();
        sessionStorage.removeItem("profile_details");
        sessionStorage.clear();
        setTimeout(function () {
            deviceHelper.navigateToAccounts('core');
        }, 1000);
    });


    //business
    $(document).on('click', '#business-display-video-mutimedia-add', function () {
        // addLoader();
        addLoader();
        var action_parms = {
            action_id: "business-display-video-from-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device Upload",
                    attr: [{ name: "id", value: "business-display-video-device-upload-btn" }]
                },
                {
                    name: "Cloud Upload",
                    // attr: [{ name: "id", value: "business-display-video-cloud-upload-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera Upload",
                    // attr: [{ name: "id", value: "business-display-video-camera-upload-btn" }]
                    attr: [{ name: "class", value: "trigger-videocam" }]
                },
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //employee
    $(document).on('click', '#employee-identity-video-load-btn', function () {
        // addLoader();
        addLoader();
        var action_parms = {
            action_id: "employee-display-video-from-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device Upload",
                    attr: [{ name: "id", value: "employee-display-video-device-upload-btn" }]
                },
                {
                    name: "Cloud Upload",
                    // attr: [{ name: "id", value: "business-display-video-cloud-upload-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera Upload",
                    attr: [{ name: "class", value: "trigger-videocam" }]
                },
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //customer
    $(document).on('click', '#customer-identity-video-load-btn', function () {
        // addLoader();
        addLoader();
        var action_parms = {
            action_id: "customer-display-video-from-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device Upload",
                    attr: [{ name: "id", value: "customer-display-video-device-upload-btn" }]
                },
                {
                    name: "Cloud Upload",
                    // attr: [{ name: "id", value: "business-display-video-cloud-upload-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera Upload",
                    attr: [{ name: "class", value: "trigger-videocam" }]
                },
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //associate-customer
    $(document).on('click', '#associate-customer-identity-video-load-btn', function () {
        // addLoader();
        addLoader();
        var action_parms = {
            action_id: "associate-customer-display-video-from-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Select Type",
            action_btn: [
                {
                    name: "Device Upload",
                    attr: [{ name: "id", value: "associate-customer-display-video-device-upload-btn" }]
                },
                {
                    name: "Cloud Upload",
                    // attr: [{ name: "id", value: "business-display-video-cloud-upload-btn" }]
                    attr: [{ name: "class", value: "digibiz-filemanager" }]
                },
                {
                    name: "Camera Upload",
                    attr: [{ name: "class", value: "trigger-videocam" }]
                },
            ]
        };
        showAction(action_parms, function () {
            removeLoader();
        });
    });

    //DEVICE UPLOAD - Business
    $(document).on('click', '#business-display-video-device-upload-btn', function (e) {
        e.stopPropagation();
        $('#business-display-video-from-action-sheet').remove();
        $('#business-display-video-upload').val("");
        $('#business-display-video-upload').trigger('click');
    });

    //DEVICE UPLOAD - employee
    $(document).on('click', '#employee-display-video-device-upload-btn', function (e) {
        e.stopPropagation();
        $('#employee-display-video-from-action-sheet').remove();
        $('#employee-identity-video-upload').val("");
        $('#employee-identity-video-upload').trigger('click');
    });

    //DEVICE UPLOAD - customer
    $(document).on('click', '#customer-display-video-device-upload-btn', function (e) {
        e.stopPropagation();
        $('#customer-display-video-from-action-sheet').remove();
        $('#customer-identity-video-upload').val("");
        $('#customer-identity-video-upload').trigger('click');
    });
    //DEVICE UPLOAD - associate_customer
    $(document).on('click', '#associate-customer-display-video-device-upload-btn', function (e) {
        e.stopPropagation();
        $('#associate-customer-display-video-from-action-sheet').remove();
        $('#associate-customer-identity-video-upload').val("");
        $('#associate-customer-identity-video-upload').trigger('click');
    });

    //device upload video-select video-business
    $(document).on("change", '#business-display-video-upload', async function (e) {
        e.stopPropagation();
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            //console.log("fileType", fileType);
            if (!(config.multimediaVideoFormat.includes(fileType.toLowerCase()))) {
                $('#business_display_video').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#business-display-video-upload').val('');
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#business_display_video').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#business-display-video-upload').val('');
            }
            else {
                if (files[0])
                    var video = files[0];
                //console.log("video", video);
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onload = async function (event) {
                    var result = event.target.result;
                    //console.log("result", result);
                    digibiz.fileObject = {};
                    var fileObj = {
                        file: files[0],
                        identifier: (new Date()).getTime(),
                        fileURI: URL.createObjectURL(files[0]),
                        file_type: files[0].type,
                        file_name: files[0].name,
                        file_content_base64: result
                    }
                    digibiz.fileObject = fileObj;
                    //empty container
                    $(this).val('');
                    var thubnail = await generateThubnail(digibiz.fileObject.file);
                    //console.log("thubnail", thubnail);
                    digibiz.fileObject['thubnail'] = thubnail;
                    fetch.getHtml(function (fetcherror, html) {
                        //console.log("got html")
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "identity-video-modal",
                            modal_header: "",
                            modal_body: html,
                            modal_action_buttons: [{
                                id: "identity-video-confirm",
                                name: `Confirm`,
                                attr: [{
                                    name: "data-id",
                                    value: "business"
                                }]
                            }]
                        }
                        showModal(modal_data, function () {
                            //console.log("modal added");
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                            //console.log("previewContent", previewContent);
                            //append multimedia
                            $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                        });
                        removeLoader();

                    }, 'page/common/identity_video', '#identity-video-template', null);
                };
                reader.readAsDataURL(video);

                // if (files[0]) {
                //     digibiz.fileObject = {};
                //     var fileObj = {
                //         file: files[0],
                //         identifier: (new Date()).getTime(),
                //         fileURI: URL.createObjectURL(files[0]),
                //         file_type: files[0].type,
                //         file_name: files[0].name
                //     }
                //     digibiz.fileObject = fileObj;
                //     //empty container
                //     $(this).val('');
                //     var thubnail = await generateThubnail(digibiz.fileObject.file);
                //     //console.log("thubnail", thubnail);
                //     digibiz.fileObject['thubnail'] = thubnail;
                //     //console.log("check type", digibiz.fileObject.fileURI)
                //     var getVideoContent = blob2Base64(digibiz.fileObject.fileURI);
                //     //console.log("getVideoContent", getVideoContent);
                //     digibiz.fileObject['file_content'] = getVideoContent;
                //     fetch.getHtml(function (fetcherror, html) {
                //         //console.log("got html")
                //         var modal_data = {
                //             modal_platform: crossplat.device.platform,
                //             modal_id: "identity-video-modal",
                //             modal_header: "",
                //             modal_body: html,
                //             modal_action_buttons: [{
                //                 id: "identity-video-confirm",
                //                 name: `Confirm`,
                //                 attr: [{
                //                     name: "data-id",
                //                     value: "business"
                //                 }]
                //             }]
                //         }
                //         showModal(modal_data, function () {
                //             //console.log("modal added");
                //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                //             } else {
                //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
                //             }
                //             var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                //             //console.log("previewContent", previewContent);
                //             //append multimedia
                //             $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                //     <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //         });
                //         removeLoader();

                //     }, 'page/common/identity_video', '#identity-video-template', null);
                // }


            }
        }
    });

    //device upload video-select video-employee
    $(document).on("change", '#employee-identity-video-upload', async function (e) {
        e.stopPropagation();
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            //console.log("fileType", fileType);
            if (!(config.multimediaVideoFormat.includes(fileType.toLowerCase()))) {
                $('#employee_identity_video').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#employee-identity-video-upload').val('');
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#employee_identity_video').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#employee-identity-video-upload').val('');
            }
            else {
                if (files[0])
                    var video = files[0];
                //console.log("video", video);
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onload = async function (event) {
                    var result = event.target.result;
                    //console.log("result", result);
                    digibiz.fileObject = {};
                    var fileObj = {
                        file: files[0],
                        identifier: (new Date()).getTime(),
                        fileURI: URL.createObjectURL(files[0]),
                        file_type: files[0].type,
                        file_name: files[0].name,
                        file_content_base64: result
                    }
                    digibiz.fileObject = fileObj;
                    //empty container
                    $(this).val('');
                    var thubnail = await generateThubnail(digibiz.fileObject.file);
                    //console.log("thubnail", thubnail);
                    digibiz.fileObject['thubnail'] = thubnail;
                    fetch.getHtml(function (fetcherror, html) {
                        //console.log("got html")
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "identity-video-modal",
                            modal_header: "",
                            modal_body: html,
                            modal_action_buttons: [{
                                id: "identity-video-confirm",
                                name: `Confirm`,
                                attr: [{
                                    name: "data-id",
                                    value: "employee"
                                }]
                            }]
                        }
                        showModal(modal_data, function () {
                            //console.log("modal added");
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                            //console.log("previewContent", previewContent);
                            //append multimedia
                            $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                        });
                        removeLoader();

                    }, 'page/common/identity_video', '#identity-video-template', null);
                };
                reader.readAsDataURL(video);
                // if (files[0]) {
                //     digibiz.fileObject = {};
                //     var fileObj = {
                //         file: files[0],
                //         identifier: (new Date()).getTime(),
                //         fileURI: URL.createObjectURL(files[0]),
                //         file_type: files[0].type,
                //         file_name: files[0].name
                //     }
                //     digibiz.fileObject = fileObj;
                //     //empty container
                //     $(this).val('');
                //     var thubnail = await generateThubnail(digibiz.fileObject.file);
                //     //console.log("thubnail", thubnail);
                //     digibiz.fileObject['thubnail'] = thubnail;
                //     fetch.getHtml(function (fetcherror, html) {
                //         //console.log("got html")
                //         var modal_data = {
                //             modal_platform: crossplat.device.platform,
                //             modal_id: "identity-video-modal",
                //             modal_header: "",
                //             modal_body: html,
                //             modal_action_buttons: [{
                //                 id: "identity-video-confirm",
                //                 name: `Confirm`,
                //                 attr: [{
                //                     name: "data-id",
                //                     value: "employee"
                //                 }]
                //             }]
                //         }
                //         showModal(modal_data, function () {
                //             //console.log("modal added");
                //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                //             } else {
                //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
                //             }
                //             var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                //             //console.log("previewContent", previewContent);
                //             //append multimedia
                //             $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                //         <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //         });
                //         removeLoader();

                //     }, 'page/common/identity_video', '#identity-video-template', null);
                // }
            }
        }
    });

    //device upload video-select video-customer
    $(document).on("change", '#customer-identity-video-upload', async function (e) {
        e.stopPropagation();
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            //console.log("fileType", fileType);
            if (!(config.multimediaVideoFormat.includes(fileType.toLowerCase()))) {
                $('#customer_identity_video').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#customer-identity-video-upload').val('');
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#customer_identity_video').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#customer-identity-video-upload').val('');
            }
            else {
                if (files[0])
                    var video = files[0];
                //console.log("video", video);
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onload = async function (event) {
                    var result = event.target.result;
                    //console.log("result", result);
                    digibiz.fileObject = {};
                    var fileObj = {
                        file: files[0],
                        identifier: (new Date()).getTime(),
                        fileURI: URL.createObjectURL(files[0]),
                        file_type: files[0].type,
                        file_name: files[0].name,
                        file_content_base64: result
                    }
                    digibiz.fileObject = fileObj;
                    //empty container
                    $(this).val('');
                    var thubnail = await generateThubnail(digibiz.fileObject.file);
                    //console.log("thubnail", thubnail);
                    digibiz.fileObject['thubnail'] = thubnail;
                    fetch.getHtml(function (fetcherror, html) {
                        //console.log("got html")
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "identity-video-modal",
                            modal_header: "",
                            modal_body: html,
                            modal_action_buttons: [{
                                id: "identity-video-confirm",
                                name: `Confirm`,
                                attr: [{
                                    name: "data-id",
                                    value: "customer"
                                }]
                            }]
                        }
                        showModal(modal_data, function () {
                            //console.log("modal added");
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                            //console.log("previewContent", previewContent);
                            //append multimedia
                            $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                        });
                        removeLoader();

                    }, 'page/common/identity_video', '#identity-video-template', null);
                };
                reader.readAsDataURL(video);
                // if (files[0]) {
                //     digibiz.fileObject = {};
                //     var fileObj = {
                //         file: files[0],
                //         identifier: (new Date()).getTime(),
                //         fileURI: URL.createObjectURL(files[0]),
                //         file_type: files[0].type,
                //         file_name: files[0].name
                //     }
                //     digibiz.fileObject = fileObj;
                //     //empty container
                //     $(this).val('');
                //     var thubnail = await generateThubnail(digibiz.fileObject.file);
                //     digibiz.fileObject['thubnail'] = thubnail;
                //     fetch.getHtml(function (fetcherror, html) {
                //         //console.log("got html")
                //         var modal_data = {
                //             modal_platform: crossplat.device.platform,
                //             modal_id: "identity-video-modal",
                //             modal_header: "",
                //             modal_body: html,
                //             modal_action_buttons: [{
                //                 id: "identity-video-confirm",
                //                 name: `Confirm`,
                //                 attr: [{
                //                     name: "data-id",
                //                     value: "customer"
                //                 }]
                //             }]
                //         }
                //         showModal(modal_data, function () {
                //             //console.log("modal added");
                //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                //             } else {
                //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
                //             }
                //             var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                //             //console.log("previewContent", previewContent);
                //             //append multimedia
                //             $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                //             <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //         });
                //         removeLoader();

                //     }, 'page/common/identity_video', '#identity-video-template', null);
                // }
            }
        }
    });

    //device upload video-select video-associate_customer
    $(document).on("change", '#associate-customer-identity-video-upload', async function (e) {
        e.stopPropagation();
        var files = this.files;
        if (files.length > 0) {
            //validation for file type 
            var fileType = files[0].name.split(".").pop();
            //console.log("fileType", fileType);
            if (!(config.multimediaVideoFormat.includes(fileType.toLowerCase()))) {
                $('#associate_customer_identity_video').parent().after(`<span class="error_note">${`Invalid file type`}</span>`);
                $('#associate-customer-identity-video-upload').val('');
            }
            //  validation for file size
            else if (files[0].size > config.maxSizeAllowIdentityPicture) {
                $('#associate_customer_identity_video').parent().after(`<span class="error_note">${`File size exceeding.Max allowed is 20MB`}</span>`);
                $('#associate-customer-identity-video-upload').val('');
            }
            else {
                if (files[0])
                    var video = files[0];
                //console.log("video", video);
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onload = async function (event) {
                    var result = event.target.result;
                    //console.log("result", result);
                    digibiz.fileObject = {};
                    var fileObj = {
                        file: files[0],
                        identifier: (new Date()).getTime(),
                        fileURI: URL.createObjectURL(files[0]),
                        file_type: files[0].type,
                        file_name: files[0].name,
                        file_content_base64: result
                    }
                    digibiz.fileObject = fileObj;
                    //empty container
                    $(this).val('');
                    var thubnail = await generateThubnail(digibiz.fileObject.file);
                    //console.log("thubnail", thubnail);
                    digibiz.fileObject['thubnail'] = thubnail;
                    fetch.getHtml(function (fetcherror, html) {
                        //console.log("got html")
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "identity-video-modal",
                            modal_header: "",
                            modal_body: html,
                            modal_action_buttons: [{
                                id: "identity-video-confirm",
                                name: `Confirm`,
                                attr: [{
                                    name: "data-id",
                                    value: "associate-customer"
                                }]
                            }]
                        }
                        showModal(modal_data, function () {
                            //console.log("modal added");
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                            //console.log("previewContent", previewContent);
                            //append multimedia
                            $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                    <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                        });
                        removeLoader();

                    }, 'page/common/identity_video', '#identity-video-template', null);
                };
                reader.readAsDataURL(video);
                // if (files[0]) {
                //     digibiz.fileObject = {};
                //     var fileObj = {
                //         file: files[0],
                //         identifier: (new Date()).getTime(),
                //         fileURI: URL.createObjectURL(files[0]),
                //         file_type: files[0].type,
                //         file_name: files[0].name
                //     }
                //     digibiz.fileObject = fileObj;
                //     //empty container
                //     $(this).val('');
                //     var thubnail = await generateThubnail(digibiz.fileObject.file);
                //     //console.log("thubnail", thubnail);
                //     digibiz.fileObject['thubnail'] = thubnail;
                //     fetch.getHtml(function (fetcherror, html) {
                //         //console.log("got html")
                //         var modal_data = {
                //             modal_platform: crossplat.device.platform,
                //             modal_id: "identity-video-modal",
                //             modal_header: "",
                //             modal_body: html,
                //             modal_action_buttons: [{
                //                 id: "identity-video-confirm",
                //                 name: `Confirm`,
                //                 attr: [{
                //                     name: "data-id",
                //                     value: "associate-customer"
                //                 }]
                //             }]
                //         }
                //         showModal(modal_data, function () {
                //             //console.log("modal added");
                //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                //             } else {
                //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
                //             }
                //             var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                //             //console.log("previewContent", previewContent);
                //             //append multimedia
                //             $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                //                 <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //         });
                //         removeLoader();

                //     }, 'page/common/identity_video', '#identity-video-template', null);
                // }
            }
        }
    });




    $(document).on('click', '#identity-video-confirm', function () {
        addLoader();
        var getDataId = $(this).attr('data-id');
        if (getDataId == "business") {
            savebusinessDisplayVideoThumbnail(digibiz.fileObject.thubnail, function (err, businessDisplayVideoThumbnail) {
                if (err) {
                    removeLoader();
                    Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                } else {
                    //passing base 64 content
                    savebusinessDisplayVideo(digibiz.fileObject.file_content_base64, businessDisplayVideoThumbnail, function (err, businessDisplayVideo) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("businessDisplayVideo", businessDisplayVideo);
                            $('#business_display_video').attr("src", digibiz.fileObject.fileURI);
                            //remove +
                            $('.business-display-video-multimedia-load-btn').remove();
                            //remove delete
                            $('#business-display-video-delete').remove();
                            $('.business-display-video-wrapper').find('.mask').removeClass('hide');
                            //append photo_camera first and then delete
                            $('#business_display_video').siblings('.mask').append(`<a class="business_display_video_preview" data-thumbnail-id="${businessDisplayVideo.thumbnail}" data-video-id="${businessDisplayVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                            $('#business_display_video').siblings('.mask').append(`<a class="info business-display-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="business-display-video-mutimedia-add" data-thumbnail-id="${businessDisplayVideo.thumbnail}" data-video-id="${businessDisplayVideo.video_id}">photo_camera</i></a>`);
                            $('#business_display_video').siblings('.mask').append(`<a class="info business-display-video-delete-btn cursor_pointer remove-pic"><i class="material-icons" id="business-display-video-delete" data-thumbnail-id="${businessDisplayVideo.thumbnail}" data-video-id="${businessDisplayVideo.video_id}">cancel</i></a>`);
                            $('#identity-video-modal').remove();
                            sessionStorage.removeItem('business_upload_for');
                            digibiz.fileObject = {};
                            digibiz.objectURLS = [];
                            removeLoader();
                        }
                    });
                }
            })
        } else if (getDataId == "employee") {
            saveEmployeeIdentityVideoThumbnail(digibiz.fileObject.thubnail, function (err, employeeIdentityVideoThumbnail) {
                if (err) {
                    removeLoader();
                    Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                } else {
                    //passing base 64 content
                    saveEmployeeIdentityVideo(digibiz.fileObject.file_content_base64, employeeIdentityVideoThumbnail, function (err, employeeIdentityVideo) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("employeeIdentityVideo", employeeIdentityVideo);
                            if (employeeIdentityVideo.hasOwnProperty('thumbnail') && employeeIdentityVideo.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${employeeIdentityVideo.thumbnail}`;
                                // $('#employee_identity_video').attr("src", digibiz.fileObject.fileURI);
                                $('#employee_identity_video').attr("src", avtarUrl);
                                //remove +
                                $('.employee-identity-video-multimedia-load-btn').remove();
                                //remove delete
                                $('#employee-identity-video-delete').remove();
                                $('.employee-add-identity-video-container').find('.mask').removeClass('hide');
                                //append photo_camera first and then delete
                                $('#employee_identity_video').siblings('.mask').append(`<a class="employee_identity_video_preview" data-thumbnail-id="${employeeIdentityVideo.thumbnail}" data-video-id="${employeeIdentityVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                $('#employee_identity_video').siblings('.mask').append(`<a class="info employee-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="employee-identity-video-load-btn" data-thumbnail-id="${employeeIdentityVideo.thumbnail}" data-video-id="${employeeIdentityVideo.video_id}">photo_camera</i></a>`);
                                $('#employee_identity_video').siblings('.mask').append(`<a class="info employee-identity-video-delete-btn cursor_pointer"><i class="material-icons" id="employee-identity-video-delete" data-thumbnail-id="${employeeIdentityVideo.thumbnail}" data-video-id="${employeeIdentityVideo.video_id}">delete</i></a>`);
                                $('#identity-video-modal').remove();
                                sessionStorage.removeItem('employee_upload_for')
                                digibiz.fileObject = {};
                                digibiz.objectURLS = [];
                                removeLoader();
                            }
                        }
                    })
                }
            });
        } else if (getDataId == "customer") {
            saveCustomerIdentityVideoThumbnail(digibiz.fileObject.thubnail, function (err, customerIdentityVideoThumbnail) {
                if (err) {
                    removeLoader();
                    Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                } else {
                    //passing base 64 content
                    saveCustomerIdentityVideo(digibiz.fileObject.file_content_base64, customerIdentityVideoThumbnail, function (err, customerIdentityVideo) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("customerIdentityVideo", customerIdentityVideo);
                            if (customerIdentityVideo.hasOwnProperty('thumbnail') && customerIdentityVideo.thumbnail) {
                                var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${customerIdentityVideo.thumbnail}`;
                                $('#customer_identity_video').attr("src", avtarUrl);
                                //remove +
                                $('.customer-identity-video-multimedia-load-btn').remove();
                                //remove delete
                                $('#customer-identity-video-delete').remove();
                                $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                                //append photo_camera first and then delete
                                $('#customer_identity_video').siblings('.mask').append(`<a class="customer_identity_video_preview" data-thumbnail-id="${customerIdentityVideo.thumbnail}" data-video-id="${customerIdentityVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                $('#customer_identity_video').siblings('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn" data-thumbnail-id="${customerIdentityVideo.thumbnail}" data-video-id="${customerIdentityVideo.video_id}">photo_camera</i></a>`);
                                $('#customer_identity_video').siblings('.mask').append(`<a class="info customer-identity-video-delete-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-delete" data-thumbnail-id="${customerIdentityVideo.thumbnail}" data-video-id="${customerIdentityVideo.video_id}">delete</i></a>`);
                                $('#identity-video-modal').remove();
                                digibiz.fileObject = {};
                                removeLoader();
                            }
                        }
                    })
                }
            });
        } else if (getDataId == "associate-customer") {
            saveAssociateCustomerIdentityVideoThumbnail(digibiz.fileObject.thubnail, function (err, associateCustomerIdentityVideoThumbnail) {
                if (err) {
                    removeLoader();
                    Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                } else {
                    //passing base 64 content
                    saveAssociateCustomerIdentityVideo(digibiz.fileObject.file_content_base64, associateCustomerIdentityVideoThumbnail, function (err, associateCustomerIdentityVideo) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("associateCustomerIdentityVideo", associateCustomerIdentityVideo);
                            if (associateCustomerIdentityVideo.hasOwnProperty('thumbnail') && associateCustomerIdentityVideo.thumbnail) {
                                var associateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id')
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${associateCustomerId}&device_id=${crossplat.device.uuid}&image_id=${associateCustomerIdentityVideo.thumbnail}`;
                                $('#associate_customer_identity_video').attr("src", avtarUrl);
                                //remove +
                                $('.associate-customer-identity-video-multimedia-load-btn').remove();
                                //remove delete
                                $('#associate-customer-identity-video-delete').remove();
                                $('.associate-customer-add-identity-video-container').find('.mask').removeClass('hide');
                                //append photo_camera first and then delete
                                $('#associate_customer_identity_video').siblings('.mask').append(`<a class="associate_customer_identity_video_preview" data-thumbnail-id="${associateCustomerIdentityVideo.thumbnail}" data-video-id="${associateCustomerIdentityVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                $('#associate_customer_identity_video').siblings('.mask').append(`<a class="info associate-customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="associate-customer-identity-video-load-btn" data-thumbnail-id="${associateCustomerIdentityVideo.thumbnail}" data-video-id="${associateCustomerIdentityVideo.video_id}">photo_camera</i></a>`);
                                $('#associate_customer_identity_video').siblings('.mask').append(`<a class="info associate_customer-identity-video-delete-btn cursor_pointer"><i class="material-icons" id="associate_customer-identity-video-delete" data-thumbnail-id="${associateCustomerIdentityVideo.thumbnail}" data-video-id="${associateCustomerIdentityVideo.video_id}">delete</i></a>`);
                                $('#identity-video-modal').remove();
                                digibiz.fileObject = {};
                                removeLoader();
                            }
                        }
                    })
                }
            });
        }
    });

    $(document).on('click', '.business_display_video_preview', function () {
        addLoader();
        var getVideoId = $(this).attr('data-video-id');
        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getVideoId}`;
        //console.log("avtarUrl", avtarUrl);
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-video-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                // //console.log("previewContent", previewContent);
                //         //append multimedia
                //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //     });
                removeLoader();
            });

        }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        // var getThumbnailId = $(this).attr('data-thumbnail-id');
        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // // var avtarUrl = `${api.get_business_multimedia}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // //console.log("avtarUrl", avtarUrl);
        // removeLoader();
    });

    $(document).on('click', '.employee_identity_video_preview', function () {
        addLoader();
        var getVideoId = $(this).attr('data-video-id');
        var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getVideoId}`;
        //console.log("avtarUrl", avtarUrl);
        // getImageUrl(avtarUrl).then((res) => {
        // }).catch((err) => {
        //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
        //         var data = {
        //             file_error: err
        //         }
        //         fetch.getHtml(function (fetcherror, html) {
        //             //console.log("got html")
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "identity-video-preview-modal",
        //                 modal_header: "",
        //                 modal_body: html
        //             }
        //             showModal(modal_data, function () {
        //                 //console.log("modal added");
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
        //                 // //console.log("previewContent", previewContent);
        //                 //         //append multimedia
        //                 //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
        //                 // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
        //                 //     });
        //                 removeLoader();
        //             });

        //         }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        //     } else {
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-video-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                // //console.log("previewContent", previewContent);
                //         //append multimedia
                //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //     });
                removeLoader();
            });

        }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        // var getThumbnailId = $(this).attr('data-thumbnail-id');
        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // // var avtarUrl = `${api.get_business_multimedia}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // //console.log("avtarUrl", avtarUrl);
        // removeLoader();
        //     }
        // })
    });

    $(document).on('click', '.customer_identity_video_preview', function () {
        addLoader();
        var getVideoId = $(this).attr('data-video-id');
        var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${getVideoId}`;
        //console.log("avtarUrl", avtarUrl);
        // getImageUrl(avtarUrl).then((res) => {
        // }).catch((err) => {
        //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
        //         var data = {
        //             file_error: err
        //         }
        //         fetch.getHtml(function (fetcherror, html) {
        //             //console.log("got html")
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "identity-video-preview-modal",
        //                 modal_header: "",
        //                 modal_body: html
        //             }
        //             showModal(modal_data, function () {
        //                 //console.log("modal added");
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
        //                 // //console.log("previewContent", previewContent);
        //                 //         //append multimedia
        //                 //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
        //                 // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
        //                 //     });
        //                 removeLoader();
        //             });

        //         }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        //     } else {
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-video-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                // //console.log("previewContent", previewContent);
                //         //append multimedia
                //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //     });
                removeLoader();
            });

        }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        // var getThumbnailId = $(this).attr('data-thumbnail-id');
        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // // var avtarUrl = `${api.get_business_multimedia}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // //console.log("avtarUrl", avtarUrl);
        // removeLoader();
        //     }
        // })
    });

    $(document).on('click', '.associate_customer_identity_video_preview', function () {
        addLoader();
        var getVideoId = $(this).attr('data-video-id');
        var getAssociateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${getAssociateCustomerId}&device_id=${crossplat.device.uuid}&image_id=${getVideoId}`;
        //console.log("avtarUrl", avtarUrl);
        // getImageUrl(avtarUrl).then((res) => {
        // }).catch((err) => {
        //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
        //         var data = {
        //             file_error: err
        //         }
        //         fetch.getHtml(function (fetcherror, html) {
        //             //console.log("got html")
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "identity-video-preview-modal",
        //                 modal_header: "",
        //                 modal_body: html
        //             }
        //             showModal(modal_data, function () {
        //                 //console.log("modal added");
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //                 // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
        //                 // //console.log("previewContent", previewContent);
        //                 //         //append multimedia
        //                 //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
        //                 // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
        //                 //     });
        //                 removeLoader();
        //             });

        //         }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        //     } else {
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-video-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                // //console.log("previewContent", previewContent);
                //         //append multimedia
                //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //     });
                removeLoader();
            });

        }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        // var getThumbnailId = $(this).attr('data-thumbnail-id');
        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // // var avtarUrl = `${api.get_business_multimedia}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // //console.log("avtarUrl", avtarUrl);
        // removeLoader();
        //     }
        // })
    });

    $(document).on('click', '.video_declaration_preview', function () {
        addLoader();
        var getVideoId = $(this).attr('data-video-id');
        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getVideoId}`;
        //console.log("avtarUrl", avtarUrl);
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "identity-video-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                // var previewContent = showVideoPreviewHtml(digibiz.fileObject.file.type.split('/')[0], digibiz.fileObject.fileURI);
                // //console.log("previewContent", previewContent);
                //         //append multimedia
                //         $(".image-list-container").append(`<div class="image-container preview-clicked-multimedia active">
                // <div class="image-wrapper" data-identifier="${digibiz.fileObject.identifier}">${previewContent}</div></div>`);
                //     });
                removeLoader();
            });

        }, 'page/common/identity_video_preview', '#identity-video-preview-template', data);
        // var getThumbnailId = $(this).attr('data-thumbnail-id');
        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // // var avtarUrl = `${api.get_business_multimedia}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${getThumbnailId}`;
        // //console.log("avtarUrl", avtarUrl);
        // removeLoader();
    });



    /**
     * Show qr
     */

    $(document).on('click', '#show-qr', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('body').click();
        addLoader();
        var data = {}, modalBody;
        if (sessionStorage.getItem('digibiz_role') == "employee") {
            // var getBusinessName = $(this).parents('.profile-metadata-container').siblings('.profile-metadata-container.business').find('.header-name span').text();

            // var getBusinessName = $('.profile-metadata-container.business').find('.header-name span').text();
            // var getEmployeeName = $('.profile-metadata.employee-customer').find('.header-name span').text();
            // var getEmployeeUniqueName = $('.profile-metadata.employee-customer').find('.unique_name').text();
            // var getEmployeeId = sessionStorage.getItem('employee_id');

            // var getBusinessId = $('#employee_business_list_more_icon_action').attr('data-business-id');
            var getBusinessId = $(this).parents('.employee-business-wrapper').attr('data-business-id');
            var getRecord = digibiz.employee_business_list.find((e) => e.id == getBusinessId);
            if (getRecord != undefined) {
                var getBusinessName = getRecord.name;
                var getEmployeeName = getRecord.employee_name;
                var getEmployeeUniqueName = getRecord.employee_unique_name;
                var getBusinessStatus = getRecord.status.status;
                var getEmployeeId = $(this).parents('.employee-business-wrapper').attr('data-employee-id');
                var profile_details = JSON.parse(sessionStorage.getItem('profile_details'));
                if (getBusinessStatus == "self-verified" || getBusinessStatus == "inactive_pending") {
                    data = {
                        employee_id: getEmployeeId,
                        mobile_number: profile_details.login.mobile_number,
                        // app: "digibiz"
                    }
                    modalBody = `<div class="contact-qr-container" data-app="digibiz"><div class="contact-qr-wrapper"><div class="username-wrapper"><span>${getEmployeeName}</span><span>${getBusinessName}</span><span>${getEmployeeUniqueName}</span></div><div id="contact-qr-code"></div></div></div>`;
                    //console.log("data", data);
                    encryptString(JSON.stringify(data), function (string) {
                        //console.log("string", string);
                        //console.log("string length", string.length);
                        var modal_data = {
                            modal_platform: crossplat.device.platform,
                            modal_id: "my-qr-popup",
                            modal_header: "My QR",
                            modal_body: modalBody
                        }
                        showModal(modal_data, function () {
                            $('#employee_business_list_more_icon_action').remove();
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }

                            $("#contact-qr-code").empty();
                            $('#contact-qr-code').qrcode({ width: 150, height: 150, text: string })
                            removeLoader();
                        });
                    });
                } else {
                    var alert_parms = {
                        alert_id: "alert-business-not-active-box",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Alert",
                        alert_body: `<div>Business is inactive. Please contact your business administrators.</div>`,
                        alert_btn: [{
                            name: "OK",
                            attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        removeLoader();
                    });
                }
            }
        } else {
            var profile_details = JSON.parse(sessionStorage.getItem('profile_details'));
            data = {
                jeevi_name: `${profile_details.individual.name.first} ${profile_details.individual.name.last}`,
                mobile_number: profile_details.login.mobile_number,
                // type: "individual"
            }
            modalBody = `<div class="contact-qr-container" data-app="digibiz"><div class="contact-qr-wrapper"><div class="username-wrapper"><span>${data.jeevi_name}</span><span>${data.mobile_number}</span></div><div id="contact-qr-code"></div></div></div>`;
            //console.log("data", data);
            encryptString(JSON.stringify(data), function (string) {
                //console.log("string", string);
                //console.log("string length", string.length);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "my-qr-popup",
                    modal_header: "My QR",
                    modal_body: modalBody
                }
                showModal(modal_data, function () {
                    $('#employee_business_list_more_icon_action').remove();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }

                    $("#contact-qr-code").empty();
                    $('#contact-qr-code').qrcode({ width: 150, height: 150, text: string })
                    removeLoader();
                });
            });
        }

    });

    $(document).on('click', '.business-qr-contact-icon', function (e) {
        e.preventDefault();
        addLoader();
        var data = {}, modalBody;
        if ($('body').attr('app') == "collaborator_add") {
            var getBusinessId = $(this).parents('.collaborator-contact-wrapper').attr('data-id');
            var getBusinessName = $(this).parents('.collaborator-contact-wrapper').find('.business-name').text();
            //console.log("getBusinessId", getBusinessId, "getBusinessName", getBusinessName);
            data = {
                business_id: getBusinessId,
            }
            modalBody = `<div class="contact-qr-container" data-app="digibiz"><div class="contact-qr-wrapper"><div class="username-wrapper"><span>${getBusinessName}</span></div><div id="contact-qr-code"></div></div></div>`;
            encryptString(JSON.stringify(data), function (string) {
                //console.log("string", string);
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "my-qr-popup",
                    modal_header: "Business QR",
                    modal_body: modalBody
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }

                    $("#contact-qr-code").empty();
                    $('#contact-qr-code').qrcode({ width: 150, height: 150, text: string })
                    removeLoader();
                });
            });
        } else {
            removeLoader();
        }
    });

    // $(document).on('click', '#customer-exit-icon', function () {
    //     addLoader();
    //     var getType = $('employee_business_list_more_icon_action').attr('data-type');
    //     var getId = $('employee_business_list_more_icon_action').attr('data-id');
    //     $('#employee_business_list_more_icon_action').remove();
    //     if (getType == "customer") {
    //         var reqParam = {
    //             device_id: crossplat.device.uuid,
    //             id: getId,
    //             status: "exited"
    //         };
    //         customerDelete(reqParam)
    //             .then((response) => {
    //                 removeLoader();
    //                 Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 Materialize.toast(`Error in exiting.`, 3000, "round error-alert");
    //             })
    //     } else if (getType == "associate_customer") {
    //         var reqParams = {
    //             device_id: crossplat.device.uuid,
    //             id: getId,
    //             status: "exited"
    //         }
    //         associateCustomerDelete(reqParams)
    //             .then((response) => {
    //                 Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
    //                 removeLoader();
    //             })
    //             .catch((err) => {
    //                 removeLoader();
    //                 //console.log("error in exited.");
    //             })
    //     }
    // });

    $(document).on('click', '#customer-exit-icon', function () {
        addLoader();
        var getType = $('#employee_business_list_more_icon_action').attr('data-type');
        var getId = $('#employee_business_list_more_icon_action').attr('data-id');
        $('#employee_business_list_more_icon_action').remove();
        var getDisplayType = "customer";
        if (getType == "associate_customer") {
            getDisplayType = "associate customer"
        }
        var alert_parms = {
            alert_id: "alert-customer-exit-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Exit`,
            alert_body: `Are you sure you want to exit as ${getDisplayType}?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-customer-exit-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-customer-exit-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-customer-exit-confirm-cancel').attr('data-id', getId);
            $('#alert-customer-exit-confirm-cancel').attr('data-type', getType);
        });
    });

    $(document).on('click', '#btn-customer-exit-cancel-no', function () {
        $('#alert-customer-exit-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-customer-exit-confirm-yes', function () {
        var getType = $('#alert-customer-exit-confirm-cancel').attr('data-type');
        var getId = $('#alert-customer-exit-confirm-cancel').attr('data-id');
        $('#alert-customer-exit-confirm-cancel').remove();
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-customer-exit-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-customer-exit-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            $('#alert-confirm-transactional-password').attr('data-id', getId);
            $('#alert-confirm-transactional-password').attr('data-type', getType);
            removeLoader();
        });
    });

    $(document).on('click', '#btn-customer-exit-cancel', function () {
        $('#alert-confirm-transactional-password').remove();
    });

    $(document).on('click', '#btn-customer-exit-confirm', function () {
        var getType = $('#alert-confirm-transactional-password').attr('data-type');
        var getId = $('#alert-confirm-transactional-password').attr('data-id');
        // $('#alert-confirm-transactional-password').remove();
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Customer Exit"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    $('#alert-confirm-transactional-password').remove();
                    if (getType == "customer") {
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            id: getId,
                            status: "exited"
                        };
                        customerDelete(reqParam)
                            .then((response) => {
                                removeLoader();
                                Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
                                if (digibiz.customer_business_list.length > 0) {
                                    console.log("business is there")
                                } else {
                                    location.hash = `jeevi/app/hub`;
                                    console.log('fwefwef');
                                }
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(`Error in exiting.`, 3000, "round error-alert");
                            })
                    } else if (getType == "associate_customer") {
                        var reqParams = {
                            device_id: crossplat.device.uuid,
                            id: getId,
                            status: "exited"
                        }
                        associateCustomerDelete(reqParams)
                            .then((response) => {
                                Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                                //console.log("error in exited.");
                            })
                    }
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    });

    //business inactivate and activate modal
    $(document).on('click', '.digibiz-active-inactive-settings', function () {
        addLoader();
        var getBusinessId = sessionStorage.getItem('business_id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getBusinessId
        }
        businessGet(reqParam)
            .then((response) => {
                sessionStorage.setItem('business_status', response.status.status);
                var getData = {
                    business_status: response.status.status,
                    business_settings: response.settings
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "business-inactive-active-settings",
                        modal_header: "Active/Inactive",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Save",
                            "id": "add-business-inactive-data",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        if (getData.business_status == "inactive" || getData.business_status == "inactive_pending") {
                            $('.business-inactive-start-end-date-time').removeClass('hide');
                        }
                        settingCalenderInit('#start-date');
                        settingCalenderInit('#end-date');
                        timepickInit('#start-time');
                        timepickInit('#end-time');
                        removeLoader();
                    });
                }, 'page/common/active_inactive_business', '#active_inactive_business-template', getData);
            })
            .catch((err) => {
                removeLoader();
            });
    });

    //business inactivate
    $(document).on('click', '#checkbox-toggle-inactivate-business', function (e) {
        let getData = $('#checkbox-toggle-inactivate-business').is(':checked');
        if (getData == true) {
            var action_sheet_parms = {
                action_id: "inactivate-business-at",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Inactivate Now",
                    attr: [{ name: "id", value: "business_inactivate_now" }]
                },
                {
                    name: "Inactivate Schedule",
                    attr: [{ name: "id", value: "business_inactivate_schedule" }]
                }
                ]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $('#inactivate-business-at').find('.action-sheet-cancel-btn').addClass('hide');
            });
        } else {
            $('#business-inactive-active-settings').removeAttr('business_inactivate_at');
            $('#inactivate-business-at').remove();
            $('.business-inactive-start-date-time').addClass('hide');
            $('.business-inactive-end-date-time').addClass('hide');
            $('.business-inactive-start-end-date-time').addClass('hide');
        }
    });

    //business inactivate now
    $(document).on('click', '#business_inactivate_now', function (e) {
        $('#business-inactive-active-settings').attr('business_inactivate_at', 'now')
        let getData = $('#checkbox-toggle-inactivate-business').is(':checked');
        if (getData == true) {
            $('#inactivate-business-at').remove();
            $('.business-inactive-start-end-date-time').removeClass('hide');
            $('.business-inactive-start-date-time').addClass('hide');
            $('.business-inactive-end-date-time').removeClass('hide');
            $('#start-date').val("");
            $('#start-time').val("");
            $('#end-date').val("");
            $('#end-time').val("");
            removeError($('#start-date'));
            removeError($('#start-time'));
            removeError($('#end-date'));
            removeError($('#end-time'));
        } else {
            $('#inactivate-business-at').remove();
            $('.business-inactive-start-end-date-time').addClass('hide');
        }
    });

    //business inactivate schedule
    $(document).on('click', '#business_inactivate_schedule', function (e) {
        $('#business-inactive-active-settings').attr('business_inactivate_at', 'schedule')
        let getData = $('#checkbox-toggle-inactivate-business').is(':checked');
        if (getData == true) {
            $('#inactivate-business-at').remove();
            $('.business-inactive-start-end-date-time').removeClass('hide');
            $('.business-inactive-start-date-time').removeClass('hide');
            $('.business-inactive-end-date-time').removeClass('hide');
            $('#start-date').val("");
            $('#start-time').val("");
            $('#end-date').val("");
            $('#end-time').val("");
            removeError($('#start-date'));
            removeError($('#start-time'));
            removeError($('#end-date'));
            removeError($('#end-time'));
        } else {
            $('#inactivate-business-at').remove();
            $('.business-inactive-start-end-date-time').addClass('hide');
        }
    });

    //business inactivate/activate modal save button click event
    $(document).on('click', '#add-business-inactive-data', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        if (sessionStorage.getItem('business_status') == "self-verified") {
            //console.log("self-verified");
            let getData = $('#checkbox-toggle-inactivate-business').is(':checked');
            if (getData == true) {
                var getType = $('#business-inactive-active-settings').attr('business_inactivate_at');
                if (validateSettingData(getType)) {
                    //console.log("validation successfull");
                    var alert_parms = {
                        alert_id: "alert-confirm-transactional-password",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Transactional Password",
                        alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                        alert_btn: [{
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-business-inactivate-activate-transaction-cancel" }]
                        },
                        {
                            name: "Confirm",
                            attr: [{ name: "id", value: "btn-business-inactivate-activate-transaction-confirm" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-confirm-transactional-password').attr('business_inactivate_at', getType);
                        // if ($('#alert-confirm-transactional-password').length > 1) {
                        //     $('#alert-confirm-transactional-password:last').remove();
                        // }
                        if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                            $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                        }
                        removeLoader();
                    });
                } else {
                    removeLoader();
                    //console.log("error! please check the data entered");
                }
            } else {//activate
                Materialize.toast(`No data to save.`, 3000, 'round error-alert');
                //console.log("activate");
                removeLoader();
            }
        } else if (sessionStorage.getItem('business_status') == "inactive_pending") {
            //console.log("123");
            let getActivateData = $('#checkbox-toggle-activate-business').is(':checked');
            //console.log("getActivateData", getActivateData);
            if (getActivateData == true) {//changed to activated
                var alert_parms = {
                    alert_id: "alert-confirm-transactional-password",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Transactional Password",
                    alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "btn-business-inactivate-activate-transaction-cancel" }]
                    },
                    {
                        name: "Confirm",
                        attr: [{ name: "id", value: "btn-business-inactivate-activate-transaction-confirm" }]
                    }
                    ]
                }
                showAlert(alert_parms, function () {
                    // if ($('#alert-confirm-transactional-password').length > 1) {
                    //     $('#alert-confirm-transactional-password:last').remove();
                    // }
                    if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                        $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                    }
                    removeLoader();
                });
            } else {//not-changed to active/not changed anything
                // $('#business-inactive-active-settings').remove();
                Materialize.toast(`No data to save.`, 3000, 'round error-alert');
                removeLoader();
            }
        } else if (sessionStorage.getItem('business_status') == "inactive") {
            var alert_parms = {
                alert_id: "alert-confirm-transactional-password",
                alert_platform: crossplat.device.platform,
                alert_title: "Transactional Password",
                alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                alert_btn: [{
                    name: "Cancel",
                    attr: [{ name: "id", value: "btn-business-inactivate-activate-transaction-cancel" }]
                },
                {
                    name: "Confirm",
                    attr: [{ name: "id", value: "btn-business-inactivate-activate-transaction-confirm" }]
                }
                ]
            }
            showAlert(alert_parms, function () {
                // if ($('#alert-confirm-transactional-password').length > 1) {
                //     $('#alert-confirm-transactional-password:last').remove();
                // }
                $('#checkbox-toggle-activate-business').prop('checked', true);
                if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                    $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                }
                removeLoader();
            });
        } else {
            //console.log("else");
            removeLoader();
        }
    });

    //cancel button in business inactivate/activate transactional alert pop-up(other click events also merged here)
    $(document).on('click', '#btn-business-delete-transaction-cancel, #btn-business-inactivate-activate-transaction-cancel, #btn-account-inactivate-activate-transaction-cancel', function () {
        removeLoader();
        $('#alert-confirm-transactional-password').remove();
    });

    //confirm button in business inactivate/activate transactional alert pop-up
    $(document).on('click', '#btn-business-inactivate-activate-transaction-confirm', function () {
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Business inactivate"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    //console.log("inactivate", response);
                    if (sessionStorage.getItem('business_status') == "self-verified") {
                        var business_inactivate_at = $('#alert-confirm-transactional-password').attr('business_inactivate_at');
                        var getStartDate = $('#start-date').val();
                        var getStartDate1 = getStartDate.split('/')[0];
                        //console.log("getStartDate1", getStartDate1);
                        var getStartMonth2 = getStartDate.split('/')[1];
                        //console.log("getStartMonth2", getStartMonth2);
                        var getStartYear3 = getStartDate.split('/')[2];
                        //console.log("getStartYear3", getStartYear3);
                        let startDate = getStartYear3 + '/' + getStartMonth2 + '/' + getStartDate1;
                        let startDateForStorage = getStartDate1 + '/' + getStartMonth2 + '/' + getStartYear3;
                        //console.log("startDate", startDate);
                        var startTimeValue = $('#start-time').val();
                        //console.log("startTimeValue", startTimeValue);
                        var beginSurvey;
                        if (startTimeValue) {
                            var startTime = timeConvertor(startTimeValue);
                            beginSurvey = moment(startDate + ' ' + startTime, 'YYYY-MM-DDHH:mm:ss').unix();
                            //console.log("beginSurvey", beginSurvey);
                        }

                        var getEndDate = $('#end-date').val();
                        var getEndDate1 = getEndDate.split('/')[0];
                        //console.log("getEndDate1", getEndDate1);
                        var getEndMonth2 = getEndDate.split('/')[1];
                        //console.log("getEndMonth2", getEndMonth2);
                        var getEndYear3 = getEndDate.split('/')[2];
                        //console.log("getEndYear3", getEndYear3);
                        var endDate = getEndYear3 + '/' + getEndMonth2 + '/' + getEndDate1;
                        var endDateForStorage = getEndDate1 + '/' + getEndMonth2 + '/' + getEndYear3;
                        //console.log("endDate", endDate);
                        var endTimeValue = $('#end-time').val();
                        //console.log("endTimeValue", endTimeValue);
                        var endTime = timeConvertor(endTimeValue);
                        //console.log("endTime", endTime);
                        var endSurvey = moment(endDate + ' ' + endTime, 'YYYY-MM-DDHH:mm:ss').unix();
                        //console.log("endSurvey", endSurvey);
                        var status, data_object;
                        if (business_inactivate_at == "now") {
                            status = "inactive";
                            data_object = {
                                "status": status,
                                "settings": {
                                    "inactivate_at": business_inactivate_at,
                                    "end_date": endDateForStorage,
                                    "end_time": endTimeValue,
                                    "end": endSurvey
                                }
                            }
                        } else {
                            status = "inactive_pending";
                            data_object = {
                                "status": status,
                                "settings": {
                                    "inactivate_at": business_inactivate_at,
                                    "start_date": startDateForStorage,
                                    "start_time": startTimeValue,
                                    "start": beginSurvey,
                                    "end_date": endDateForStorage,
                                    "end_time": endTimeValue,
                                    "end": endSurvey
                                }
                            }
                        }
                        var reqparams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('business_id'),
                            data: data_object
                        }
                        //console.log("reqparams", reqparams)
                        businessSettings(reqparams)
                            .then((response) => {
                                sessionStorage.removeItem('business_status');
                                $('#alert-confirm-transactional-password').remove();
                                $('#business-inactive-active-settings').remove();
                                //console.log("result", response);
                                if (business_inactivate_at == "now") {
                                    // sessionStorage.clear();
                                    var getBusinessAdminRoleBusiness = digibiz.business_owner_business_list.findIndex(e => e.id == sessionStorage.getItem('business_id'));
                                    if (getBusinessAdminRoleBusiness != -1) {
                                        digibiz.business_owner_business_list[getBusinessAdminRoleBusiness]['status']['status'] = 'inactive';
                                    }
                                    sessionStorage.removeItem('business_name');
                                    sessionStorage.removeItem('business_status');
                                    sessionStorage.removeItem('business_role');
                                    sessionStorage.removeItem('business_profile_socket_status');
                                    sessionStorage.removeItem('business_id');
                                    location.hash = `business_owner/business/list`;
                                    Materialize.toast('Successfully inactivated.', 3000, 'round success-alert');
                                } else {
                                    var getBusinessAdminRoleBusiness = digibiz.business_owner_business_list.findIndex(e => e.id == sessionStorage.getItem('business_id'));
                                    if (getBusinessAdminRoleBusiness != -1) {
                                        digibiz.business_owner_business_list[getBusinessAdminRoleBusiness]['status']['status'] = 'inactive_pending';
                                    }
                                    Materialize.toast('Successfully scheduled.', 3000, 'round success-alert');
                                }
                                removeLoader();
                            })
                            .catch((err) => {
                                $('#alert-confirm-transactional-password').remove();
                                $('#business-inactive-active-settings').remove();
                                //console.log("error");
                                removeLoader();
                            })
                    } else if (sessionStorage.getItem('business_status') == "inactive_pending") {
                        //console.log("123");
                        let getActivateData = $('#checkbox-toggle-activate-business').is(':checked');
                        //console.log("getActivateData", getActivateData);
                        if (getActivateData == true) {//changed to activated
                            var reqparams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    "status": "self-verified",
                                }
                            }
                            businessSettings(reqparams)
                                .then((response) => {
                                    $('#alert-confirm-transactional-password').remove();
                                    $('#business-inactive-active-settings').remove();
                                    sessionStorage.removeItem('business_status');
                                    //console.log("result", response);
                                    Materialize.toast('Successfully activated.', 3000, 'round success-alert');
                                    var getBusinessAdminRoleBusiness = digibiz.business_owner_business_list.findIndex(e => e.id == sessionStorage.getItem('business_id'));
                                    if (getBusinessAdminRoleBusiness != -1) {
                                        digibiz.business_owner_business_list[getBusinessAdminRoleBusiness]['status']['status'] = 'self-verified';
                                    }
                                    // location.reload();
                                    // if ($('body').attr('app') == "business_management") {
                                    //     businessManagementPage();
                                    // }
                                    removeLoader();
                                })
                                .catch((err) => {
                                    //console.log("error");
                                    removeLoader();
                                })
                        } else {//not-changed to active/not changed anything
                            $('#alert-confirm-transactional-password').remove();
                            $('#business-inactive-active-settings').remove();
                            removeLoader();
                        }
                    } else if (sessionStorage.getItem('business_status') == "inactive") {
                        //console.log("123");
                        let getActivateData = $('#checkbox-toggle-activate-business').is(':checked');
                        //console.log("getActivateData", getActivateData);
                        if (getActivateData == true) {//changed to activated
                            var reqparams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('business_id'),
                                data: {
                                    "status": "self-verified",
                                }
                            }
                            businessSettings(reqparams)
                                .then((response) => {
                                    $('#alert-confirm-transactional-password').remove();
                                    $('#business-inactive-active-settings').remove();
                                    sessionStorage.removeItem('business_status');
                                    //console.log("result", response);
                                    Materialize.toast('Successfully activated.', 3000, 'round success-alert');
                                    var getBusinessAdminRoleBusiness = digibiz.business_owner_business_list.findIndex(e => e.id == sessionStorage.getItem('business_id'));
                                    if (getBusinessAdminRoleBusiness != -1) {
                                        digibiz.business_owner_business_list[getBusinessAdminRoleBusiness]['status']['status'] = 'self-verified';
                                    }
                                    // location.reload();
                                    if ($('body').attr('app') == "business_management") {
                                        businessManagementPage();
                                    }
                                    removeLoader();
                                })
                                .catch((err) => {
                                    //console.log("error");
                                    removeLoader();
                                })
                        } else {//not-changed to active/not changed anything
                            $('#alert-confirm-transactional-password').remove();
                            $('#business-inactive-active-settings').remove();
                            removeLoader();
                        }
                    } else {
                        removeLoader();
                        //console.log("else");
                    }
                })
                .catch((err) => {
                    // $(this).attr('disabled', false);
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    });



    //digibiz-account inactivate and activate modal
    $(document).on('click', '.digibiz-account-active-inactive-settings', function () {
        addLoader();
        var getAccountId = sessionStorage.getItem('account_id');
        var getUUid = sessionStorage.getItem('uuid');
        var reqParam = {
            device_id: crossplat.device.uuid,
            uuid: getUUid
        }
        getDigibizAccount(reqParam)
            .then((response) => {
                //console.log("response", response);
                //console.log("23211", response.id, getAccountId)
                if (response.id == getAccountId) {
                    //console.log("9876")
                    sessionStorage.setItem('account_status', response.status.status);
                    var getData = {
                        account_status: response.status.status,
                        account_settings: response.settings
                    }
                    //console.log("getData", getData);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "account-inactive-active-settings",
                            modal_header: "Active/Inactive",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Save",
                                "id": "add-account-inactive-data",
                            }]
                        }
                        showModal(modal_data, function () {
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            if (getData.account_status == "inactive" || getData.account_status == "inactive_pending") {
                                $('.account-inactive-start-end-date-time').removeClass('hide');
                            }
                            settingCalenderInit('#start-date');
                            settingCalenderInit('#end-date');
                            timepickInit('#start-time');
                            timepickInit('#end-time');
                            removeLoader();
                        });
                    }, 'page/common/active_inactive_account', '#active_inactive_account-template', getData);
                } else {
                    //console.log("1234")
                }
            })
            .catch((err) => {
                //console.log("err", err)
                removeLoader();
            });
    });

    //digibiz account inactivate
    $(document).on('click', '#checkbox-toggle-inactivate-account', function (e) {
        let getData = $('#checkbox-toggle-inactivate-account').is(':checked');
        if (getData == true) {
            var action_sheet_parms = {
                action_id: "inactivate-account-at",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Inactivate Now",
                    attr: [{ name: "id", value: "account_inactivate_now" }]
                },
                {
                    name: "Inactivate Schedule",
                    attr: [{ name: "id", value: "account_inactivate_schedule" }]
                }
                ]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $('#inactivate-account-at').find('.action-sheet-cancel-btn').addClass('hide');
            });
        } else {
            $('#account-inactive-active-settings').removeAttr('account_inactivate_at');
            $('#inactivate-account-at').remove();
            $('.account-inactive-start-date-time').addClass('hide');
            $('.account-inactive-end-date-time').addClass('hide');
            $('.account-inactive-start-end-date-time').addClass('hide');
        }
    });

    //digibiz account inactivate now
    $(document).on('click', '#account_inactivate_now', function (e) {
        $('#account-inactive-active-settings').attr('account_inactivate_at', 'now')
        let getData = $('#checkbox-toggle-inactivate-account').is(':checked');
        if (getData == true) {
            $('#inactivate-account-at').remove();
            $('.account-inactive-start-end-date-time').removeClass('hide');
            $('.account-inactive-start-date-time').addClass('hide');
            $('.account-inactive-end-date-time').removeClass('hide');
            $('#start-date').val("");
            $('#start-time').val("");
            $('#end-date').val("");
            $('#end-time').val("");
            removeError($('#start-date'));
            removeError($('#start-time'));
            removeError($('#end-date'));
            removeError($('#end-time'));
        } else {
            $('#inactivate-account-at').remove();
            $('.account-inactive-start-end-date-time').addClass('hide');
        }
    });

    //digibiz account inactivate schedule
    $(document).on('click', '#account_inactivate_schedule', function (e) {
        $('#account-inactive-active-settings').attr('account_inactivate_at', 'schedule')
        let getData = $('#checkbox-toggle-inactivate-account').is(':checked');
        if (getData == true) {
            $('#inactivate-account-at').remove();
            $('.account-inactive-start-end-date-time').removeClass('hide');
            $('.account-inactive-start-date-time').removeClass('hide');
            $('.account-inactive-end-date-time').removeClass('hide');
            $('#start-date').val("");
            $('#start-time').val("");
            $('#end-date').val("");
            $('#end-time').val("");
            removeError($('#start-date'));
            removeError($('#start-time'));
            removeError($('#end-date'));
            removeError($('#end-time'));
        } else {
            $('#inactivate-account-at').remove();
            $('.account-inactive-start-end-date-time').addClass('hide');
        }
    });

    //digibiz account inactivate/activate modal save button click event
    $(document).on('click', '#add-account-inactive-data', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //console.log("click")
        if (sessionStorage.getItem('account_status') == "active") {
            //console.log("active");
            let getData = $('#checkbox-toggle-inactivate-account').is(':checked');
            if (getData == true) {
                var getType = $('#account-inactive-active-settings').attr('account_inactivate_at');
                if (validateSettingData(getType)) {
                    //console.log("validation successfull");
                    var alert_parms = {
                        alert_id: "alert-confirm-transactional-password",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Transactional Password",
                        alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                        alert_btn: [{
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-account-inactivate-activate-transaction-cancel" }]
                        },
                        {
                            name: "Confirm",
                            attr: [{ name: "id", value: "btn-account-inactivate-activate-transaction-confirm" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-confirm-transactional-password').attr('account_inactivate_at', getType);
                        // if ($('#alert-confirm-transactional-password').length > 1) {
                        //     $('#alert-confirm-transactional-password:last').remove();
                        // }
                        if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                            $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                        }
                        removeLoader();
                    });
                } else {
                    removeLoader();
                    //console.log("error! please check the data entered");
                }
            } else {//activate
                Materialize.toast(`No data to save.`, 3000, 'round error-alert');
                //console.log("activate");
                removeLoader();
            }
        } else if (sessionStorage.getItem('account_status') == "inactive_pending") {
            //console.log("123");
            let getActivateData = $('#checkbox-toggle-activate-account').is(':checked');
            //console.log("getActivateData", getActivateData);
            if (getActivateData == true) {//changed to activated
                var alert_parms = {
                    alert_id: "alert-confirm-transactional-password",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Transactional Password",
                    alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "btn-account-inactivate-activate-transaction-cancel" }]
                    },
                    {
                        name: "Confirm",
                        attr: [{ name: "id", value: "btn-account-inactivate-activate-transaction-confirm" }]
                    }
                    ]
                }
                showAlert(alert_parms, function () {
                    //console.log("$('#alert-confirm-transactional-password').length", $('#alert-confirm-transactional-password').length)
                    // if ($('#alert-confirm-transactional-password').length > 1) {
                    //     $('#alert-confirm-transactional-password:last').remove();
                    // }
                    if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                        $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                    }
                    removeLoader();
                });
            } else {//not-changed to active/not changed anything
                // $('#account-inactive-active-settings').remove();
                Materialize.toast(`No data to save.`, 3000, 'round error-alert');
                removeLoader();
            }
        } else if (sessionStorage.getItem('account_status') == "inactive") {
            var alert_parms = {
                alert_id: "alert-confirm-transactional-password",
                alert_platform: crossplat.device.platform,
                alert_title: "Transactional Password",
                alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                alert_btn: [{
                    name: "Cancel",
                    attr: [{ name: "id", value: "btn-account-inactivate-activate-transaction-cancel" }]
                },
                {
                    name: "Confirm",
                    attr: [{ name: "id", value: "btn-account-inactivate-activate-transaction-confirm" }]
                }
                ]
            }
            showAlert(alert_parms, function () {
                //console.log("$('#alert-confirm-transactional-password').length", $('#alert-confirm-transactional-password').length)
                // if ($('#alert-confirm-transactional-password').length > 1) {
                //     $('#alert-confirm-transactional-password:last').remove();
                // }
                if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                    $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                }
                removeLoader();
            });
        } else {
            //console.log("else");
            removeLoader();
        }
    });

    //confirm button in digibiz account inactivate/activate transactional alert pop-up
    $(document).on('click', '#btn-account-inactivate-activate-transaction-confirm', function () {
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Account inactivate"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    //console.log("inactivate", response);
                    if (sessionStorage.getItem('account_status') == "active") {
                        var account_inactivate_at = $('#alert-confirm-transactional-password').attr('account_inactivate_at');
                        // var startDate = $("#start-date").val();
                        // //console.log("startDate", startDate);
                        var getStartDate = $('#start-date').val();
                        var getStartDate1 = getStartDate.split('/')[0];
                        //console.log("getStartDate1", getStartDate1);
                        var getStartMonth2 = getStartDate.split('/')[1];
                        //console.log("getStartMonth2", getStartMonth2);
                        var getStartYear3 = getStartDate.split('/')[2];
                        //console.log("getStartYear3", getStartYear3);
                        let startDate = getStartYear3 + '/' + getStartMonth2 + '/' + getStartDate1;
                        let startDateForStorage = getStartDate1 + '/' + getStartMonth2 + '/' + getStartYear3;
                        //console.log("startDate", startDate);
                        var startTimeValue = $('#start-time').val();
                        //console.log("startTimeValue", startTimeValue);
                        var beginSurvey;
                        if (startTimeValue) {
                            var startTime = timeConvertor(startTimeValue);
                            beginSurvey = moment(startDate + ' ' + startTime, 'YYYY-MM-DDHH:mm:ss').unix();
                            //console.log("beginSurvey", beginSurvey);
                        }

                        var getEndDate = $('#end-date').val();
                        var getEndDate1 = getEndDate.split('/')[0];
                        //console.log("getEndDate1", getEndDate1);
                        var getEndMonth2 = getEndDate.split('/')[1];
                        //console.log("getEndMonth2", getEndMonth2);
                        var getEndYear3 = getEndDate.split('/')[2];
                        //console.log("getEndYear3", getEndYear3);
                        var endDate = getEndYear3 + '/' + getEndMonth2 + '/' + getEndDate1;
                        var endDateForStorage = getEndDate1 + '/' + getEndMonth2 + '/' + getEndYear3;
                        var endTimeValue = $('#end-time').val();
                        var endTime = timeConvertor(endTimeValue);
                        var endSurvey = moment(endDate + ' ' + endTime, 'YYYY-MM-DDHH:mm:ss').unix();
                        var status, data_object;
                        if (account_inactivate_at == "now") {
                            status = "inactive";
                            data_object = {
                                "status": status,
                                "settings": {
                                    "inactivate_at": account_inactivate_at,
                                    "end_date": endDateForStorage,
                                    "end_time": endTimeValue,
                                    "end": endSurvey
                                }
                            }
                        } else {
                            status = "inactive_pending";
                            data_object = {
                                "status": status,
                                "settings": {
                                    "inactivate_at": account_inactivate_at,
                                    "start_date": startDateForStorage,
                                    "start_time": startTimeValue,
                                    "start": beginSurvey,
                                    "end_date": endDateForStorage,
                                    "end_time": endTimeValue,
                                    "end": endSurvey
                                }
                            }
                        }
                        var reqparams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('account_id'),
                            data: data_object
                        }
                        accountSettings(reqparams)
                            .then((response) => {
                                sessionStorage.removeItem('account_status');
                                $('#alert-confirm-transactional-password').remove();
                                $('#account-inactive-active-settings').remove();
                                if (account_inactivate_at == "now") {
                                    // sessionStorage.clear();
                                    // console.log("")
                                    setTimeout(function () {
                                        deviceHelper.navigateToAccounts('core');
                                    }, 1000);
                                    Materialize.toast(`Successfully Digibiz Account Inactivated.`, 3000, 'round success-alert');
                                    logoutDigibiz();
                                } else {
                                    Materialize.toast(`Successfully Scheduled Digibiz Account Inactivate.`, 3000, 'round success-alert');
                                }
                                removeLoader();
                            })
                            .catch((err) => {
                                $('#alert-confirm-transactional-password').remove();
                                $('#account-inactive-active-settings').remove();
                                removeLoader();
                            })
                    } else if (sessionStorage.getItem('account_status') == "inactive_pending") {
                        let getActivateData = $('#checkbox-toggle-activate-account').is(':checked');
                        if (getActivateData == true) {//changed to activated
                            var reqparams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('account_id'),
                                data: {
                                    "status": "active",
                                }
                            }
                            accountSettings(reqparams)
                                .then((response) => {
                                    $('#alert-confirm-transactional-password').remove();
                                    $('#account-inactive-active-settings').remove();
                                    sessionStorage.removeItem('account_status');
                                    // deviceHelper.navigateAppCore('digibiz');
                                    // location.hash = `land/page`;
                                    //console.log("result", response);
                                    // sessionStorage.clear();
                                    location.reload();

                                    removeLoader();
                                })
                                .catch((err) => {
                                    //console.log("error");
                                    removeLoader();
                                })
                        } else {//not-changed to active/not changed anything
                            $('#alert-confirm-transactional-password').remove();
                            $('#account-inactive-active-settings').remove();
                            removeLoader();
                        }
                    } else if (sessionStorage.getItem('account_status') == "inactive") {
                        var reqparams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('account_id'),
                            data: {
                                "status": "active",
                            }
                        }
                        accountSettings(reqparams)
                            .then((response) => {
                                $('#alert-confirm-transactional-password').remove();
                                $('#account-inactive-active-settings').remove();
                                sessionStorage.removeItem('account_status');
                                // deviceHelper.navigateAppCore('digibiz');
                                // location.hash = `land/page`;
                                //console.log("result", response);
                                // sessionStorage.clear();
                                location.reload();

                                removeLoader();
                            })
                            .catch((err) => {
                                //console.log("error");
                                removeLoader();
                            })
                    } else {
                        removeLoader();
                        //console.log("else");
                    }
                })
                .catch((err) => {
                    // $(this).attr('disabled', false);
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    });




    $(document).on('click', '.digibiz_account_storage_btn', function () {
        addLoader();
        location.hash = `digibiz/account/storage`;
    });


    $(document).on('click', '.digibiz_account_settings_btn', function () {
        addLoader();
        $('body').click();
        location.hash = `digibiz/account/settings`;
    });

    /**
     * Change account 
     */
    $(document).on('click', '#change-drive-button', function (e) {
        //console.log("choose other storage")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $("#Reauthenticate-account").remove();
        Materialize.Toast.removeAll();
        if (!location.href.includes('digibiz/account/storage')) {
            addLoader();
            location.hash = 'digibiz/account/storage';
        }
    });

    $(document).on('click', '#change-business-drive-button', function () {
        $("#Reauthenticate-account").remove();
        Materialize.Toast.removeAll();
        // if (!location.href.includes('business/edit')) {
        //     addLoader();
        //     location.hash = 'business/edit';
        // }
    });

    /**
     * reauthenticate
     */
    $(document).on('click', '#reauthenticate-storage', function () {
        //console.log('click event');
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        $("#Reauthenticate-account").remove();
        Materialize.Toast.removeAll();
        //call api
        $('.alert-wrapper').remove();
        activateStorage(selected_storage, function (e) { });
    });



    /**
    * Logout and add new storage
    */
    $(document).on('click', '#logout-add-new-storage', function () {
        $("#Reauthenticate-account").remove();
        window.sessionStorage.removeItem('storage_token')
        Materialize.Toast.removeAll();
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        //call api
        var requestParams = {
            device_id: crossplat.device.uuid,
            drive: selected_storage,
            id: sessionStorage.getItem('account_id'),
            type: "individual",
            revoke_type: "reauthenticate"
        }
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                if (selected_storage == "DropBox") {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        window.open('https://www.dropbox.com/logout', '_blank');
                    } else {
                        cordova.plugins.browsertab.openUrl('https://www.dropbox.com/logout', { scheme: "djbusiness://" });
                    }
                }
                activateStorage(selected_storage, function (e) { });
            } else {
                var jsonResponse = JSON.parse(response.responseText);
                Materialize.toast(jsonResponse.Data, 3000, 'error-alert');
            }
        }, api.revoke_storage, "POST", "JSON", requestParams);
    });

    $(document).on('click', '#logout-add-new-business-storage', function () {
        $("#Reauthenticate-account").remove();
        window.sessionStorage.removeItem('business_storage_token')
        Materialize.Toast.removeAll();
        var $this = $(this);
        var selected_storage = $(this).attr('data-storage');
        //call api
        var requestParams = {
            device_id: crossplat.device.uuid,
            drive: selected_storage,
            id: sessionStorage.getItem('business_id'),
            type: "business",
            revoke_type: "reauthenticate"
        }
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                if (selected_storage == "DropBox") {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        window.open('https://www.dropbox.com/logout', '_blank');
                    } else {
                        cordova.plugins.browsertab.openUrl('https://www.dropbox.com/logout', { scheme: "djbusiness://" });
                    }
                }
                activateStorage(selected_storage, function (e) { });
            } else {
                var jsonResponse = JSON.parse(response.responseText);
                Materialize.toast(jsonResponse.Data, 3000, 'error-alert');
            }
        }, api.revoke_storage, "POST", "JSON", requestParams);
    });

    $(document).on('click', '.digibiz_business_settings_btn', function () {
        addLoader();
        $('body').click();
        location.hash = `digibiz/business/settings`;
    });


    $(document).on('click', '.digibiz-business-delete', function () {
        addLoader();
        var getBusinessRole = sessionStorage.getItem('business_role');
        if (getBusinessRole == "super_admin") {
            var getBusinessId = sessionStorage.getItem('business_id');
            var alert_parms = {
                alert_id: "alert-business-delete-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Delete Business`,
                alert_body: `Are you sure you want to delete the business?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-delete-business-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-delete-business-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-business-delete-confirm-cancel').attr('data-business-id', getBusinessId); //set getBusinessId
            });
        } else {
            var alert_parms = {
                alert_id: "access-denied-business-settings-module-alert",
                alert_platform: crossplat.device.platform,
                alert_title: `Access Denied`,
                alert_body: `Only super-admins can access the module.`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "access-denied-business-settings-module-alert-ok" }]
                }
                ]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });

    //Delete no
    $(document).on('click', '#btn-delete-business-cancel-no', function () {
        $('#alert-business-delete-confirm-cancel').remove();
    });

    //Delete yes
    $(document).on('click', '#btn-delete-business-confirm-yes', function () {
        addLoader();
        var getBusinessId = $('#alert-business-delete-confirm-cancel').attr('data-business-id');
        $('#alert-business-delete-confirm-cancel').remove();
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-business-delete-transaction-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-business-delete-transaction-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-confirm-transactional-password').attr('business_id', getBusinessId);
            if ($('#alert-confirm-transactional-password').length > 1) {
                $('#alert-confirm-transactional-password:last').remove();
            }
        });
        // var requestParams = {
        //     device_id: crossplat.device.uuid,
        //     id: getBusinessId,
        // }
        // businessDelete(requestParams)
        //     .then((response) => {
        //         //console.log("businessDelete response", response);
        //         removeLoader();
        //         Materialize.toast(`Successfully deleted business.`, 3000, 'round success-alert');
        //     })
        //     .catch((err) => {
        //         removeLoader();
        //         Materialize.toast(`Error in business delete.`, 3000, 'round success-alert');
        //     })
    });



    $(document).on('click', '#btn-business-delete-transaction-confirm', function () {
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Business Delete"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    var getBusinessId = $('#alert-confirm-transactional-password').attr('business_id');
                    $('#alert-confirm-transactional-password').remove();
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        id: getBusinessId,
                    }
                    businessDelete(requestParams)
                        .then((response) => {
                            //console.log("businessDelete response", response);
                            digibiz.business_owner_business_list = digibiz.business_owner_business_list.filter(function (e) {
                                return e.id != getBusinessId;
                            });
                            removeLoader();
                            Materialize.toast(`Successfully deleted business.`, 3000, 'round success-alert');
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(`Error in business delete.`, 3000, 'round success-alert');
                        })
                })
                .catch((err) => {
                    // $(this).attr('disabled', false);
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    })

    //delete digibiz account
    $(document).on('click', '.digibiz-account-delete', function () {
        // addLoader();
        // var getAccountId = sessionStorage.getItem('account_id');
        // var alert_parms = {
        //     alert_id: "alert-account-delete-confirm-cancel",
        //     alert_platform: crossplat.device.platform,
        //     alert_title: `Delete account`,
        //     alert_body: `Are you sure you want to delete the account?`,
        //     alert_btn: [{
        //         name: "Yes",
        //         attr: [{ name: "id", value: "btn-delete-account-confirm-yes" }]
        //     },
        //     {
        //         name: "No",
        //         attr: [{ name: "id", value: "btn-delete-account-cancel-no" }]
        //     }]
        // }
        // showAlert(alert_parms, function () {
        //     removeLoader();
        //     $('#alert-account-delete-confirm-cancel').attr('data-account-id', getAccountId); //set getBusinessId
        // });
        deviceHelper.navigateToAccounts('core', { purpose: 'settings_account', ref_app: 'business' });
    });

    //No for digibiz account delete
    $(document).on('click', '#btn-delete-account-cancel-no', function () {
        $('#alert-account-delete-confirm-cancel').remove();
    });

    //Yes for digibiz account delete
    $(document).on('click', '#btn-delete-account-confirm-yes', function () {
        addLoader();
        var getAccountId = $('#alert-account-delete-confirm-cancel').attr('data-account-id');
        $('#alert-account-delete-confirm-cancel').remove();
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-digibiz-account-delete-transaction-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-digibiz-account-delete-transaction-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            //to remove the alert box if 2 times it gets added
            if ($('#alert-confirm-transactional-password').length > 1) {
                $('#alert-confirm-transactional-password:last').remove();
            }
            $('#alert-confirm-transactional-password').attr('data-account-id', getAccountId)
            removeLoader();
        });
    });

    //cancel transaction password for digibiz account delete
    $(document).on('click', '#btn-digibiz-account-delete-transaction-cancel', function () {
        $('#alert-confirm-transactional-password').remove();
    });

    //confirm transaction password for digibiz account delete
    $(document).on('click', '#btn-digibiz-account-delete-transaction-confirm', function () {
        var getAccountId = $('#alert-confirm-transactional-password').attr('data-account-id');
        $('#alert-confirm-transactional-password').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getAccountId,
        }
        accountDelete(requestParams)
            .then((response) => {
                //console.log("accountDelete response", response);
                removeLoader();
                Materialize.toast(`Successfully deleted account.`, 3000, 'round success-alert');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in account delete.`, 3000, 'round success-alert');
            })
    });


    $(document).on('click', '.digibiz-business-storage', function () {
        addLoader();
        sessionStorage.removeItem('successCode');
        sessionStorage.removeItem('authErrorCode');
        sessionStorage.removeItem('business_storage_token');
        location.hash = `business/storage`;
    });

    //identitity video delete
    //customer
    $(document).on('click', '#customer-identity-video-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        var video_id = $(this).attr('data-video-id');
        e.stopPropagation();
        var alert_parms = {
            alert_id: "alert-delete-customer-identity-video-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Identity video",
            alert_body: `Do you want to delete the customer identity video?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-customer-identity-video-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-customer-identity-video-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-customer-identity-video-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
            $('#alert-delete-customer-identity-video-confirm-cancel').attr('delete-video-id', video_id);
        });
    })

    //delete NO clicked
    $(document).on('click', '#btn-delete-customer-identity-video-confirm-no', function () {
        $('#alert-delete-customer-identity-video-confirm-cancel').remove();
    })
    //delete YES clicked
    $(document).on('click', '#btn-delete-customer-identity-video-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-customer-identity-video-confirm-cancel').attr('delete-thumbnail-id');
        var videoId = $('#alert-delete-customer-identity-video-confirm-cancel').attr('delete-video-id');
        $('#alert-delete-customer-identity-video-confirm-cancel').remove();
        //api call to delete customer identity video 
        var customerId = sessionStorage.getItem('customer_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            identity_video_thumbnail_id: thumbnailId,
            identity_video_id: videoId,
            customer_id: customerId,
        }
        addLoader();
        customerDeleteIdentityVideo(requesParam)
            .then((response) => {
                removeLoader();
                $('#customer-identity-picture-upload').val('');
                $('#customer_identity_video').attr("src", "");//empty
                $('.customer_identity_video_preview').remove();
                $('#customer-identity-video-delete').remove();//remove delete button
                $('#customer-identity-video-load-btn').attr('data-thumbnail-id', '');
                $('#customer-identity-video-load-btn').attr('data-video-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    //associate-customer
    $(document).on('click', '#associate_customer-identity-video-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        var video_id = $(this).attr('data-video-id');
        e.stopPropagation();
        var alert_parms = {
            alert_id: "alert-delete-associate-customer-identity-video-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Identity video",
            alert_body: `Do you want to delete the identity video?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-associate-customer-identity-video-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-associate-customer-identity-video-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-associate-customer-identity-video-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
            $('#alert-delete-associate-customer-identity-video-confirm-cancel').attr('delete-video-id', video_id);
        });
    })

    //delete NO clicked
    $(document).on('click', '#btn-delete-associate-customer-identity-video-confirm-no', function () {
        $('#alert-delete-associate-customer-identity-video-confirm-cancel').remove();
    })
    //delete YES clicked
    $(document).on('click', '#btn-delete-associate-customer-identity-video-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-associate-customer-identity-video-confirm-cancel').attr('delete-thumbnail-id');
        var videoId = $('#alert-delete-associate-customer-identity-video-confirm-cancel').attr('delete-video-id');
        $('#alert-delete-associate-customer-identity-video-confirm-cancel').remove();
        //api call to delete customer identity video 
        var customerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            identity_video_thumbnail_id: thumbnailId,
            identity_video_id: videoId,
            associate_customer_id: customerId,
        }
        addLoader();
        associateCustomerDeleteIdentityVideo(requesParam)
            .then((response) => {
                removeLoader();
                $('#associate-customer-identity-picture-upload').val('');
                $('#associate_customer_identity_video').attr("src", "");//empty
                $('.associate_customer_identity_video_preview').remove();
                $('#associate_customer-identity-video-delete').remove();//remove delete button
                $('#associate-customer-identity-video-load-btn').attr('data-thumbnail-id', '');
                $('#associate-customer-identity-video-load-btn').attr('data-video-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });



    //employee
    $(document).on('click', '#employee-identity-video-delete', function (e) {
        var thumbnail_id = $(this).attr('data-thumbnail-id');
        var video_id = $(this).attr('data-video-id');
        e.stopPropagation();
        var alert_parms = {
            alert_id: "alert-delete-employee-identity-video-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete Identity video",
            alert_body: `Do you want to delete the identity video?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-employee-identity-video-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-employee-identity-video-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#alert-delete-employee-identity-video-confirm-cancel').attr('delete-thumbnail-id', thumbnail_id);
            $('#alert-delete-employee-identity-video-confirm-cancel').attr('delete-video-id', video_id);
        });
    })

    //delete NO clicked
    $(document).on('click', '#btn-delete-employee-identity-video-confirm-no', function () {
        $('#alert-delete-employee-identity-video-confirm-cancel').remove();
    })
    //delete YES clicked
    $(document).on('click', '#btn-delete-employee-identity-video-confirm-yes', function () {
        var thumbnailId = $('#alert-delete-employee-identity-video-confirm-cancel').attr('delete-thumbnail-id');
        var videoId = $('#alert-delete-employee-identity-video-confirm-cancel').attr('delete-video-id');
        $('#alert-delete-employee-identity-video-confirm-cancel').remove();
        //api call to delete customer identity video 
        var employeeId = sessionStorage.getItem('employee_id');
        var requesParam = {
            device_id: crossplat.device.uuid,
            identity_video_thumbnail_id: thumbnailId,
            identity_video_id: videoId,
            employee_id: employeeId,
        }
        addLoader();
        employeeDeleteIdentityVideo(requesParam)
            .then((response) => {
                removeLoader();
                $('#employee-identity-picture-upload').val('');
                $('#employee_identity_video').attr("src", "");//empty
                $('.employee_identity_video_preview').remove();
                $('#employee-identity-video-delete').remove();//remove delete button
                $('#employee-identity-video-load-btn').attr('data-thumbnail-id', '');
                $('#employee-identity-video-load-btn').attr('data-video-id', '');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    $(document).on('click', '.new-business-delete-btn', function () {
        addLoader();
        var getBusinessId = sessionStorage.getItem('business_id');
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-business-delete-transaction-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-business-delete-transaction-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-confirm-transactional-password').attr('business_id', getBusinessId);
            if ($('#alert-confirm-transactional-password').length > 1) {
                $('#alert-confirm-transactional-password:last').remove();
            }
        });
    });

    $(document).on('click', '#btn-business-owner-inactivate-ok', function () {
        $('#alert-business-owner-inactive-ok').remove();
        var getBusinessId = sessionStorage.getItem('business_id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getBusinessId
        }
        businessGet(reqParam)
            .then((response) => {
                sessionStorage.setItem('business_status', response.status.status);
                var getData = {
                    business_status: response.status.status,
                    business_settings: response.settings
                }
                //console.log("getData", getData);
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "business-inactive-active-settings",
                        modal_header: "Active/Inactive",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Activate",
                            "id": "add-business-inactive-data",
                        }]
                    }
                    showModal(modal_data, function () {
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        if (getData.business_status == "inactive") {
                            $('.business-inactive-main-container').addClass('hide');
                            $('.business-inactive-start-end-date-time').addClass('hide');
                        }
                        settingCalenderInit('#start-date');
                        settingCalenderInit('#end-date');
                        timepickInit('#start-time');
                        timepickInit('#end-time');
                        removeLoader();
                    });
                }, 'page/common/active_inactive_business', '#active_inactive_business-template', getData);
            })
            .catch((err) => {
                removeLoader();
            });
    });



    $(document).on('change', '#start-date', function (e) {
        removeError($('#start-date'));
    });
    $(document).on('change', '#end-date', function (e) {
        removeError($('#end-date'));
    });
    $(document).on('click, change', '#end-time', function (e) {
        removeError($('#end-time'));
    });
    $(document).on('click, change', '#start-time', function (e) {
        removeError($('#start-time'));
    });
    $(document).on('click', '.picker__close', function () {
        //console.log("v-sign roll a date confirm");
        if ($('#start-date').siblings('.error_note').text() == "Start date cannot be after the end date.") {
            removeError($('#start-date'));
        }
        if ($('#start-time').siblings('.error_note').text() == "Start Time and End Time cannot be same") {
            removeError($('#start-time'));
        }
        if ($('#start-time').siblings('.error_note').text() == "Selected time is in the past") {
            removeError($('#start-time'));
        }
        if ($('#start-date').siblings('.error_note').text() == "This field is required.") {
            if ($('#start-date').val().length > 0) {
                removeError($('#start-date'));
            }
        }
        if ($('#start-time').siblings('.error_note').text() == "This field is required.") {
            if ($('#start-time').val().length > 0) {
                removeError($('#start-time'));
            }
        }
        if ($('#end-date').siblings('.error_note').text() == "End date cannot be before the start date.") {
            removeError($('#end-date'));
        }
        if ($('#end-time').siblings('.error_note').text() == "Start Time and End Time cannot be same") {
            removeError($('#end-time'));
        }
        if ($('#end-time').siblings('.error_note').text() == "Selected time is in the past") {
            removeError($('#end-time'));
        }
        if ($('#end-time').siblings('.error_note').text() == "This field is required.") {
            if ($('#end-time').val().length > 0) {
                removeError($('#end-time'));
            }
        }
        if ($('#end-date').siblings('.error_note').text() == "This field is required.") {
            if ($('#end-date').val().length > 0) {
                //console.log("sdf");
                removeError($('#end-date'));
            } else {
                //console.log("df");
            }
        }
        if ($('#start-time').siblings('.error_note').text() == "Start Time cannot be greater") {
            removeError($('#start-time'));
        }
    });

    $(document).on('click', '.business_profile_slider_btn', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        $('body').click();
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        sessionStorage.setItem('business_id', getBusinessID);
        // $('#employee_business_list_more_icon_action').remove();
        // location.hash = `business/edit`;
        location.hash = `business/profile`;
    });

    $(document).on('click', '.employee_profile_slider_btn', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        $('body').click();
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        sessionStorage.setItem('business_id', getBusinessID);
        var getEmployeeID = $('#employee_business_list_more_icon_action').attr('data-employee-id');
        sessionStorage.setItem('employee_id', getEmployeeID);
        // location.hash = `employee/create`;
        location.hash = `employee/profile`;
    });

    $(document).on('click', '.customer_profile_slider_btn', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        $('body').click();
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        sessionStorage.setItem('business_id', getBusinessID);
        var getCustomerID = $('#employee_business_list_more_icon_action').attr('data-id');
        sessionStorage.setItem('customer_id', getCustomerID);
        var getCustomerType = $('#employee_business_list_more_icon_action').attr('data-type');
        sessionStorage.setItem('customer_type', getCustomerType);
        // location.hash = `customer/create`;
        location.hash = `customer/profile`;
    });

    //SEARCH
    $(document).on('click', '.searchbtn', function () {
        //console.log("clicked common search");
        var $this = $(this);
        addLoader();
        // if ($('body').attr('app') == "business_owner_business_list") {
        $($this).siblings('.expand-search-wrap').find('.expand-search-input').removeAttr('socketid');

        $($this).siblings('.expand-search-wrap').find('i').removeClass('hide');
        $($this).siblings('.expand-search-wrap').toggleClass('active').find('.expand-search-input').toggleClass('searchexpand');
        $($this).siblings('.expand-search-wrap').find('.expand-search-input').focus();
        removeLoader();
        // } else if() {

        // }
    });
    $(document).on('click', '.searchclosebtn', function (e) {
        //console.log("closed common search");
        var $this = $(this);
        $(document).find('.expand-search-wrap').removeClass('active').children('.expand-search-input').val('').removeClass('searchexpand');
        removeLoader();
        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
        currentroute = $("body").attr('app');
        switch (currentroute) {
            case 'collaborator_add':
                $('#collaborator-add-search-list-wrapper').find('.collaborator-add-search-business-list-contentbox').remove();
                $('#collaborator-add-search-list-wrapper').append(`<div class="no_data">Search Business</div>`);
                break;
            case 'business_owner_business_list':
                processBusinessOwnerBusinessList(digibiz.business_owner_business_list, function () {
                });
                break;
            case 'employee_business_list':
                processEmployeeBusinessList(digibiz.employee_business_list, function () {
                    // listenForFollowUserScrollEvent($(".modal-popup-content"));
                });
                break;
            case 'customer_business_list':
                processCustomerBusinessList(digibiz.customer_business_list, function () {
                    // listenForFollowUserScrollEvent($(".modal-popup-content"));
                });
                break;
            case 'department_management':
                processDepartmentList(digibiz.department_list, function () {
                });
                break;
            case 'employee_creation_list':
                if (sessionStorage.getItem('selected-employee-tab') == "employee_active") {
                    processActiveEmployeeCreationEmployeeList(digibiz.active_employee_creation_employee_list, function () {
                    });
                } else if (sessionStorage.getItem('selected-employee-tab') == "employee_pending") {
                    processPendingEmployeeCreationEmployeeList(digibiz.pending_employee_creation_employee_list, function () {
                    });
                }
                break;
            case 'employee_create':
                if ($('#assign-employee-department-modal').length > 0) {
                    processDepartmentListSelection(digibiz.department_list_selection, function () {
                    });
                }
                break;
            case 'employee_contact_list':
                if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "all_employees") {
                    processEmployeeList(digibiz.all_employees_list, function () {
                    });
                } else if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "department_wise") {
                    if ($('#department-wise-employees-list-modal').length > 0) {
                        processDepartmentListSelection(digibiz.department_list_selection, function () {
                        });
                    }
                }
                break;
            case 'employee_access_list':
                processEmployeeAccessList(digibiz.employee_access_list, function () {
                });
                break;
            case 'employee_types':
                processEmployeeTypesList(digibiz.employee_types_list, function () {
                });
                break;
            case 'employee_category':
                processEmployeeCategoryList(digibiz.employee_category_list, function () {
                });
                break;
            case 'employee_designation':
                processEmployeeDesignationList(digibiz.employee_designation_list, function () {
                });
                break;
            case 'employee_group_creation_list':
                if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                    if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                        // processCommunicationGroupActivateEmployeeGroupEmployeeList(response, groupResponse, function () { })
                    } else {
                        processStandardEmployeeGroupsList(digibiz.standard_employees_groups_list_page, function () {
                        });
                    }
                } else {
                    processCustomEmployeeGroupsList(digibiz.custom_employees_groups_list_page, function () {
                    });
                }
                break;
            case 'employee_access_list':
                processEmployeeAccessList(digibiz.employee_access_list, function () {
                });
                break;
            case 'customer_identifiers_list':
                if (sessionStorage.getItem('selected-customer-identifier-tab') == "customer") {
                    processCustomerIdentifiersList(digibiz.customer_identifiers, function () {
                    });
                } else {
                    processAssociateCustomerIdentifiersList(digibiz.associate_customer_identifiers, function () {
                    });
                }
                break;
            case 'customer_creation_identifiers_list':
                if (sessionStorage.getItem('selected-customer-tab') == "customer_active") {
                    processCustomerIdentifiersActiveCustomerCreationList(digibiz.customer_identifiers_active_customers_list, function () {
                    });
                } else {
                    processCustomerIdentifiersPendingCustomerCreationList(digibiz.customer_identifiers_pending_customers_list, function () {
                    });
                }
                break;
            case 'customer_creation_active_list':
                processActiveCustomerList(digibiz.customer_creation_active_list, function () {
                });
                break;
            case 'customer_creation_pending_list':
                processPendingCustomerList(digibiz.customer_creation_pending_list, function () {
                });
                break;
            case 'customer_contacts_identifiers_list':
                processCustomerContactsIdentifiersList(digibiz.customer_contacts_identifiers_list, function () {
                });
                break;
            case 'customer_contacts_items_list':
                processCustomerContactsItemsList(digibiz.contacts_items_list, function () {
                });
                break;
            case 'customer_contact_list':
                processCustomerContactList(digibiz.contacts_list, function () {
                });
                break;
            case 'customer_groups_identifiers_list':
                if (sessionStorage.getItem('selected-customer-group-type-tab') == "standard") {
                    processStandardCustomerGroupsIdentifiersList(digibiz.standard_customer_groups_identifiers_list, function () {
                    });
                } else {
                    processCustomerCustomGroupList(digibiz.custom_groups_list, function () {
                    });
                }
                break;
            case 'customer_groups_list':
                processCustomerGroupList(digibiz.groups_list, function () {
                });
                break;
            case 'customer_access_identifiers':
                processCustomerAccessIdentifiersList(digibiz.customer_access_identifiers_list, function () {
                });
                break;
            case 'customer_access_identifiers_items':
                processCustomerAccessIdentifierItemsList(digibiz.customer_access_identifier_items_list, function () {
                });
                break;
            case 'communication_groups':
                processCommunicationGroupsList(digibiz.communicationGroupsList, function () {
                });
                break;
            case 'collaborator_contact_list':
                if (sessionStorage.getItem('selected-collaborator-tab') == 'active_collaborator') {
                    processActiveCollaboratorContactList(digibiz.collaborator_contact_list, function () {
                    });
                } else if (sessionStorage.getItem('selected-collaborator-tab') == 'pending_collaborator') {
                    processPendingCollaboratorContactList(digibiz.pending_collaborator_contact_list, function () {
                    });
                }
            case 'collaborator_groups_list':
                processCollaboratorGroupsList(digibiz.collaborator_groups_list, function () {
                });
                break;
            case 'digibiz_logs':
                processSearchCloseLogsList(digibiz.logs_list, function () {
                });
                break;
            case 'business_notifications':
                processBusinessNotificationsList(digibiz.business_notifications, function () {
                });
                break;
        }
    });

    //ON KEY PRESS SEARCH CODE
    setTimeout(function () {
        // $(document).on('click', '#employee_department_assignment_btn', function () {
        //     setTimeout(function () {
        //         let element = document.querySelector(".expand-search-input");
        //         //console.log('element11click', element);
        //     }, 500);
        // })
        let element = document.querySelector(".expand-search-input");
        //console.log('element11', element);
        if (element) {
            //console.log('element', element);
            //if element is there
            element.addEventListener("input", function () {
                //on input set attribute socketid 
                timestamp = (new Date()).getTime();
                element.setAttribute("socketid", timestamp);
            });
            element.addEventListener("keyup", function (e) {
                // if (!hasClass(e.target, 'filemanager-search')) {
                //console.log("not has class")
                // on keyup get attribute 
                socketid = element.getAttribute("socketid");
                keyword = element.value;
                if (socketid && keyword) {
                    //if socketid attribute and keyword is there
                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                    currentroute = $("body").attr('app');
                    data = {
                        room: crossplat.device.uuid,
                        socketid,
                        app: 'digibiz',
                        keyword
                    };
                    switch (currentroute) {
                        case 'collaborator_add':
                            data['index'] = 'globalBusinessSearch';
                            break;
                        case 'business_owner_business_list':
                            data['index'] = 'myBusinesslist';
                            break;
                        case 'employee_business_list':
                            data['index'] = 'employeeBusinesslist';
                            break;
                        case 'customer_business_list':
                            data['index'] = 'customerBusinesslist';
                            break;
                        case 'department_management':
                            data['index'] = 'getDepartmentList';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'employee_creation_list':
                            if (sessionStorage.getItem('selected-employee-tab') == "employee_active") {
                                data['index'] = 'getEmployeeCreationActive';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            } else if (sessionStorage.getItem('selected-employee-tab') == "employee_pending") {
                                data['index'] = 'getEmployeeCreationPending';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'employee_create':
                            if ($('#assign-employee-department-modal').length > 0) {
                                data['index'] = 'getEmployeeCreatDepartmentSelection';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'employee_contact_list':
                            if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "all_employees") {
                                data['index'] = 'getEmployeeContactListAllEmployees';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'employee_access_list':
                            data['index'] = 'getEmployeeAccessListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'employee_types':
                            data['index'] = 'getEmployeetypesListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'employee_category':
                            data['index'] = 'getEmployeeCategoryListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'employee_designation':
                            data['index'] = 'getEmployeeDesignationListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'employee_group_creation_list':
                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                data['index'] = 'getEmployeeStandardGroupListPage';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            } else {
                                data['index'] = 'getEmployeeCustomGroupListPage';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'employee_group_create':
                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                if ($('#modal-employee-selection').length > 0) {
                                    data['index'] = 'getEmployeeContactListAllEmployees';
                                    data['business_id'] = sessionStorage.getItem('business_id');
                                }
                            }
                            break;
                        case 'employee_access_list':
                            data['index'] = 'getEmployeeContactListAllEmployees';//reused
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'customer_identifiers_list':
                            if (sessionStorage.getItem('selected-customer-identifier-tab') == "customer") {
                                data['index'] = 'getCustomerIdentifiersTab';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            } else {
                                data['index'] = 'getAssociateCustomerIdentifiersTab';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'customer_creation_identifiers_list':
                            if (sessionStorage.getItem('selected-customer-tab') == "customer_active") {
                                data['index'] = 'getCustomerIdentifiersTab';//reused
                                data['business_id'] = sessionStorage.getItem('business_id');
                            } else {
                                data['index'] = 'getCustomerIdentifiersTab';//reused
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        // case 'customer_creation':
                        //     if ($('.tab.active').attr('data-id') == "customer_pending") {
                        //         if ($('#choose-customer-identifier-modal').length > 0) {
                        //             data['index'] = 'getCustomerIdentifiersTab';
                        //             data['business_id'] = sessionStorage.getItem('business_id');
                        //         }
                        //     }
                        //     break;
                        case 'customer_creation_active_list':
                            data['index'] = 'getActiveCustomersListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            data['identifier_id'] = sessionStorage.getItem('identifier_id');
                            break;
                        case 'customer_creation_pending_list':
                            data['index'] = 'getPendingCustomersListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            data['identifier_id'] = sessionStorage.getItem('identifier_id');
                            break;
                        case 'customer_contacts_identifiers_list':
                            data['index'] = 'getCustomerIdentifiersTab';//reused
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'customer_contacts_items_list':
                            data['index'] = 'getCustomerIdentifierItemListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            data['identifier_id'] = sessionStorage.getItem('identifier_id');
                            break;
                        case 'customer_contact_list':
                            data['index'] = 'getCustomerContactListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            data['identifier_item_id'] = sessionStorage.getItem('item_id');
                            break;
                        case 'customer_groups_identifiers_list'://level 1
                            if (sessionStorage.getItem('selected-customer-group-type-tab') == "standard") {
                                data['index'] = 'getCustomerStandardGroupsListPage';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            } else {
                                data['index'] = 'getCustomerCustomGroupsListPage';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'customer_groups_list':
                            data['index'] = 'getCustomerStandardGroupsByIdentifierListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            data['identifier_id'] = sessionStorage.getItem('identifier_id');
                            break;
                        case 'customer_access_identifiers':
                            data['index'] = 'getCustomerIdentifiersTab';//reused
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'customer_access_identifiers_items'://reused
                            data['index'] = 'getCustomerIdentifierItemListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            data['identifier_id'] = sessionStorage.getItem('identifier_id');
                            break;
                        case 'communication_groups':
                            data['index'] = 'getCommunicationListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        case 'collaborator_contact_list':
                            if (sessionStorage.getItem('selected-collaborator-tab') == 'active_collaborator') {
                                data['index'] = 'getActiveCollaboratorListPage';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            } else if (sessionStorage.getItem('selected-collaborator-tab') == 'pending_collaborator') {
                                data['index'] = 'getPendingCollaboratorListPage';
                                data['business_id'] = sessionStorage.getItem('business_id');
                            }
                            break;
                        case 'collaborator_groups_list':
                            data['index'] = 'getCollaboratorGroupsListPage';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            if (sessionStorage.getItem('selected-collaborator-tab') == "my_group_collaborator") {
                                data.list_by = "business_collaborator_groups_page";
                            } else {
                                data.list_by = "business_other_collaborator_groups_page";
                            }
                            break;
                        case 'digibiz_logs':
                            // data['index'] = 'getEmployeeManagementActivityLogs';
                            // data['business_id'] = sessionStorage.getItem('business_id');
                            if ($('.wrapper-dropdown').find(".selected-dropdown").attr('data-value').length > 0) {
                                if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "jeevi_hub_page") {
                                    var list_by = "jeevi_hub_page";
                                    var action_type = "jeevi";
                                    var action_role = "digibiz";
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "digibiz_hub_page") {
                                    var list_by = "digibiz_account";
                                    var action_type = "digibiz";
                                    var action_role = "digibiz";
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "digibiz_roles_logs") {
                                    var list_by = "digibiz_roles";
                                    var action_type = "roles";
                                    var action_role = "digibiz";
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "notification_role_page") {
                                    var list_by = "notification_roles_page";
                                    var action_type = "notification";
                                    var action_role = "notification";
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "digibiz_business_logs") {
                                    var list_by = "digibiz_business_logs";
                                    var action_type = "business";
                                    var action_role = "business_owner";
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "business_app_hub_page") {
                                    var list_by = "business_app_hub_page";
                                    var action_type = "business";
                                    var action_role = "business_owner";
                                    var business_id = sessionStorage.getItem('business_id')
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "employee") {
                                    var list_by = "employee";
                                    var action_type = "employee";
                                    var action_role = "business_owner";
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "business_owner_business_list_page") {
                                    var list_by = "business_owner_roles_page";
                                    var action_type = "business";
                                    var action_role = "business_owner";
                                    var business_id = sessionStorage.getItem('business_id')
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "app_permission_logs") {
                                    var list_by = "app_permissions_page";
                                    var action_type = "business";
                                    var action_role = "business_owner";
                                    var business_id = sessionStorage.getItem('business_id')
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "employee") {
                                    var list_by = "business_module";
                                    var action_type = "employee";
                                    // var action_role = "business_owner";
                                    var business_id = sessionStorage.getItem('business_id')
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "customer_logs") {
                                    var list_by = "customer_logs";
                                    var action_type = "customer";
                                    var action_role = "business_owner";
                                    var business_id = sessionStorage.getItem('business_id')
                                } else if (sessionStorage.getItem('log_type') && sessionStorage.getItem('log_type') == "teams_group_logs") {
                                    var list_by = "business_teams";
                                    var action_type = "business_teams";
                                    var action_role = "business_owner";
                                    var business_id = sessionStorage.getItem('business_id')
                                }
                                if (sessionStorage.getItem('log_type') == "employee") {
                                    data['index'] = 'getEmployeeManagementActivityLogs';
                                    data['business_id'] = sessionStorage.getItem('business_id');
                                    data['type'] = "employee";
                                    data['action_type'] = action_type;
                                    // data['action_role'] = action_role;
                                    data['log_type'] = list_by;
                                    data['list_by'] = list_by;
                                    data["account_id"] = sessionStorage.getItem('account_id');
                                    data["user_id"] = sessionStorage.getItem('account_id');
                                    data['filter_value'] = $('.wrapper-dropdown').find(".selected-dropdown").attr('data-value');
                                } else if (sessionStorage.getItem('log_type') == "customer") {
                                    data['index'] = 'getCustomerManagementActivityLogs';
                                    data['business_id'] = sessionStorage.getItem('business_id');
                                    data['type'] = "customer";
                                    data['action_type'] = action_type;
                                    // data['action_role'] = action_role;
                                    data['log_type'] = list_by;
                                    data['list_by'] = list_by;
                                    data["account_id"] = sessionStorage.getItem('account_id');
                                    data["user_id"] = sessionStorage.getItem('account_id');
                                    data['filter_value'] = $('.wrapper-dropdown').find(".selected-dropdown").attr('data-value');
                                } else {
                                    data['index'] = 'getDigibizActivityLogsList';
                                    data['action_type'] = action_type;
                                    data['action_role'] = action_role;
                                    data['log_type'] = list_by;
                                    data['list_by'] = list_by;
                                    data['business_id'] = sessionStorage.getItem('business_id');
                                    data["account_id"] = sessionStorage.getItem('account_id');
                                    data["user_id"] = sessionStorage.getItem('account_id');
                                    data['filter_value'] = $('.wrapper-dropdown').find(".selected-dropdown").attr('data-value');
                                }

                                addLoader();
                                console.log('data', data);
                                sockets.searchSocket.emit('search', data);
                                setTimeout(() => {
                                    removeLoader();
                                }, 300);
                                break;
                            } else {
                                if (sessionStorage.getItem('log_type') == "digibiz_login_logs") {
                                    digibiz.logs_list = [];
                                    data['index'] = 'core_activities';
                                    data['log_type'] = sessionStorage.getItem('log_type');
                                    data['list_by'] = sessionStorage.getItem('log_type');
                                    data["account_id"] = sessionStorage.getItem('account_id');
                                    data["user_id"] = sessionStorage.getItem('user_id');
                                    data['filter_value'] = $('.wrapper-dropdown').find(".selected-dropdown").attr('data-value');
                                    addLoader();
                                    // console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                    break;
                                } else {
                                    Materialize.toast('Select filter value to search logs', 4000, 'round error-alert');
                                }
                            }
                        case 'business_notifications':
                            data['index'] = 'getBusinessNotifications';
                            data['business_id'] = sessionStorage.getItem('business_id');
                            break;
                        default:
                            break;
                    }
                    if (currentroute != "digibiz_logs") {
                        addLoader();
                        //console.log("search emit", data);
                        sockets.searchSocket.emit('search', data);
                        setTimeout(() => {
                            removeLoader();
                        }, 300);
                    }
                } else {
                    //console.log("going to else part")
                    //else show default list
                    removeLoader();
                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                    currentroute = $("body").attr('app');
                    element.removeAttribute("socketid");
                    switch (currentroute) {
                        case 'collaborator_add':
                            processSearchedCollaboratorAddSearchListPage([], function (pro) {
                            });
                            break;
                        case 'business_owner_business_list':
                            processBusinessOwnerBusinessList(digibiz.business_owner_business_list, function () {
                                // listenForFollowUserScrollEvent($(".modal-popup-content"));
                            });
                            break;
                        case 'employee_business_list':
                            processEmployeeBusinessList(digibiz.employee_business_list, function () {
                                // listenForFollowUserScrollEvent($(".modal-popup-content"));
                            });
                            break;
                        case 'customer_business_list':
                            processCustomerBusinessList(digibiz.customer_business_list, function () {
                                // listenForFollowUserScrollEvent($(".modal-popup-content"));
                            });
                            break;
                        case 'department_management':
                            processDepartmentList(digibiz.department_list, function () {
                                // listenForFollowUserScrollEvent($(".modal-popup-content"));
                            });
                            break;
                        case 'employee_creation_list':
                            if (sessionStorage.getItem('selected-employee-tab') == "employee_active") {
                                processActiveEmployeeCreationEmployeeList(digibiz.active_employee_creation_employee_list, function () {
                                });
                            } else if (sessionStorage.getItem('selected-employee-tab') == "employee_pending") {
                                processPendingEmployeeCreationEmployeeList(digibiz.pending_employee_creation_employee_list, function () {
                                });
                            }
                            break;
                        case 'employee_create':
                            if ($('#assign-employee-department-modal').length > 0) {
                                processDepartmentListSelection(digibiz.department_list_selection, function () {
                                });
                            }
                            break;
                        case 'employee_contact_list':
                            if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "all_employees") {
                                processEmployeeList(digibiz.all_employees_list, function () {
                                });
                            } else if (sessionStorage.getItem('selected-employee-contact-list-type-tab') == "department_wise") {
                                if ($('#department-wise-employees-list-modal').length > 0) {
                                    processDepartmentListSelection(digibiz.department_list_selection, function () {
                                    });
                                }
                            }
                            break;
                        case 'employee_access_list':
                            processEmployeeAccessList(digibiz.employee_access_list, function () {
                            });
                            break;
                        case 'employee_types':
                            processEmployeeTypesList(digibiz.employee_types_list, function () {
                            });
                            break;
                        case 'employee_category':
                            processEmployeeCategoryList(digibiz.employee_category_list, function () {
                            });
                            break;
                        case 'employee_designation':
                            processEmployeeDesignationList(digibiz.employee_designation_list, function () {
                            });
                            break;
                        case 'employee_group_creation_list':
                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                processStandardEmployeeGroupsList(digibiz.standard_employees_groups_list_page, function () {
                                });
                            } else {
                                processCustomEmployeeGroupsList(digibiz.custom_employees_groups_list_page, function () {
                                });
                            }
                            break;
                        case 'employee_access_list':
                            processEmployeeAccessList(digibiz.employee_access_list, function () {
                            });
                            break;
                        case 'customer_identifiers_list':
                            if (sessionStorage.getItem('selected-customer-identifier-tab') == "customer") {
                                processCustomerIdentifiersList(digibiz.customer_identifiers, function () {
                                });
                            } else {
                                processAssociateCustomerIdentifiersList(digibiz.associate_customer_identifiers, function () {
                                });
                            }
                            break;
                        case 'customer_creation_identifiers_list':
                            if (sessionStorage.getItem('selected-customer-tab') == "customer_active") {
                                processCustomerIdentifiersActiveCustomerCreationList(digibiz.customer_identifiers_active_customers_list, function () {
                                });
                            } else {
                                processCustomerIdentifiersPendingCustomerCreationList(digibiz.customer_identifiers_pending_customers_list, function () {
                                });
                            }
                            break;
                        // case 'customer_creation':
                        //     if ($('.tab.active').attr('data-id') == "customer_pending") {
                        //         if ($('#choose-customer-identifier-modal').length > 0) {
                        //             processChooseCustomerIdentifierList(digibiz.chooseCustomerIdentifiers, function () {
                        //             });
                        //         }
                        //     }
                        //     break;
                        case 'customer_creation_active_list':
                            processActiveCustomerList(digibiz.customer_creation_active_list, function () {
                            });
                            break;
                        case 'customer_creation_pending_list':
                            processPendingCustomerList(digibiz.customer_creation_pending_list, function () {
                            });
                            break;
                        case 'customer_contacts_identifiers_list':
                            processCustomerContactsIdentifiersList(digibiz.customer_contacts_identifiers_list, function () {
                            });
                            break;
                        case 'customer_contacts_items_list':
                            processCustomerContactsItemsList(digibiz.contacts_items_list, function () {
                            });
                            break;
                        case 'customer_contact_list':
                            processCustomerContactList(digibiz.contacts_list, function () {
                            });
                            break;
                        case 'customer_groups_identifiers_list':
                            if (sessionStorage.getItem('selected-customer-group-type-tab') == "standard") {
                                processStandardCustomerGroupsIdentifiersList(digibiz.standard_customer_groups_identifiers_list, function () {
                                });
                            } else {
                                processCustomerCustomGroupList(digibiz.custom_groups_list, function () {
                                });
                            }
                            break;
                        case 'customer_groups_list':
                            processCustomerGroupList(digibiz.groups_list, function () {
                            });
                            break;
                        case 'customer_access_identifiers':
                            processCustomerAccessIdentifiersList(digibiz.customer_access_identifiers_list, function () {
                            });
                            break;
                        case 'customer_access_identifiers_items':
                            processCustomerAccessIdentifierItemsList(digibiz.customer_access_identifier_items_list, function () {
                            });
                            break;
                        case 'communication_groups':
                            processCommunicationGroupsList(digibiz.communicationGroupsList, function () {
                            });
                            break;
                        case 'collaborator_contact_list':
                            if (sessionStorage.getItem('selected-collaborator-tab') == 'active_collaborator') {
                                processActiveCollaboratorContactList(digibiz.collaborator_contact_list, function () {
                                });
                            } else if (sessionStorage.getItem('selected-collaborator-tab') == 'pending_collaborator') {
                                processPendingCollaboratorContactList(digibiz.pending_collaborator_contact_list, function () {
                                });
                            }
                            break;
                        case 'collaborator_groups_list':
                            if (sessionStorage.getItem('selected-collaborator-tab') == "my_group_collaborator") {
                                processCollaboratorGroupsList(digibiz.collaborator_groups_list, function () {
                                });
                            } else {
                                processOtherCollaboratorGroupsList(digibiz.other_collaborator_groups_list, function () { });
                            }
                            break;
                        case 'digibiz_logs':
                            processSearchCloseLogsList(digibiz.logs_list, function () {
                            });
                            break;
                        case 'business_notifications':
                            processBusinessNotificationsList(digibiz.business_notifications, function () {
                            });
                            break;
                        default:
                            break;
                    }

                }
                // }
            });
        }
    }, 3000);

    $(document).on('click', '.search-member-button', function () {
        if ($(this).hasClass('employee-lists')) {
            var search_employee_list = true;
        } else if ($(this).hasClass('customer-lists')) {
            var search_customer_list = true;
        } else if ($(this).hasClass('collaborator-lists')) {
            var search_collaborator_list = true;
        } else {
            var search_employee_list = false;
            var search_collaborator_list = false;
            var search_customer_list = false;
            var search_employee_list = false;
        }
        addLoader();
        var customer_list = false;
        var employee_list = false;
        if (sessionStorage.getItem('group_id')) {
            if ($('body').attr('app') == "employee_group_create") {
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    group_id: sessionStorage.getItem('group_id')
                }
                // getCompleteList(reqParams)
                //     .then((response) => {
                var modal_data = {
                    modal_id: "group-member-search-modal",
                    modal_header: "Group Members",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="group-member-search-main-container">                                            
                                            <div class="search">
                                                <div class="expand-search-wrap search-wrapper" id="group-member-search-btn">
                                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                    <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                                </div>
                                            </div>
                                            <div id="group-member-search-wrapper"></div>
                                        </div>`,
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processGroupMemberSearch(null, function () {
                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        var element = $('#group-member-search-modal').find('.expand-search-input');
                        if (element) {
                            //console.log('element22', element);
                            //if element is there
                            $(document).on('input', element, function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                element.attr("socketid", timestamp);
                            });
                            // element.addEventListener("keyup", function (e) {
                            $(document).on('keyup', element, function () {
                                // if (!hasClass(e.target, 'filemanager-search')) {
                                //console.log("not has class")
                                // on keyup get attribute 
                                socketid = element.attr("socketid");
                                keyword = element.val();
                                if (socketid && keyword && keyword.length >= 3) {
                                    //if socketid attribute and keyword is there
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    currentroute = $("body").attr('app');
                                    data = {
                                        room: crossplat.device.uuid,
                                        socketid,
                                        app: 'digibiz',
                                        keyword
                                    };
                                    switch (currentroute) {
                                        case 'employee_group_create':
                                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                if ($('#group-member-search-modal').length > 0) {
                                                    //console.log("group-member-search-modal")
                                                    data['index'] = 'getDigibizGroupMembersListPage';
                                                    data['group_id'] = sessionStorage.getItem('group_id');
                                                }
                                            } else {
                                                if ($('#group-member-search-modal').length > 0) {
                                                    //console.log("group-member-search-modal")
                                                    data['index'] = 'getDigibizGroupMembersListPage';
                                                    data['group_id'] = sessionStorage.getItem('group_id');
                                                }
                                            }
                                            break;
                                        default:
                                            break;
                                    }
                                    addLoader();
                                    //console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                } else {
                                    //console.log("going to else part")
                                    //else show default list
                                    removeLoader();
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                    currentroute = $("body").attr('app');
                                    // element.removeAttribute("socketid");
                                    element.attr("socketid", "");
                                    switch (currentroute) {
                                        case 'employee_group_create':
                                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                    processCommunicationGroupActivateEmployeeGroupEmployeeList(response, groupResponse, function () { })
                                                }
                                                if ($('#group-member-search-modal').length > 0) {
                                                    processGroupMemberSearch(null, function () { })
                                                }
                                            } else {
                                                if ($('#group-member-search-modal').length > 0) {
                                                    processGroupMemberSearch(null, function () { })
                                                }
                                            }
                                            break;
                                        default:
                                            break;
                                    }

                                }
                            });
                            $(document).on('click', '.searchclosebtn', function () {
                                if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                    if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                        processCommunicationGroupActivateEmployeeGroupEmployeeList(null, groupResponse, function () { })
                                    }
                                    if ($('#group-member-search-modal').length > 0) {
                                        processGroupMemberSearch(null, function () { })
                                    }
                                } else {
                                    if ($('#group-member-search-modal').length > 0) {
                                        processGroupMemberSearch(null, function () { })
                                    }
                                }
                            })
                        }
                    });
                });
                // })
                // .catch((err) => {
                //     removeLoader();
                //     //console.log("no members found");
                // })
            } else if ($('body').attr('app') == "collaborator_group_details") {
                var reParams = {
                    device_id: crossplat.device.uuid,
                    group_id: sessionStorage.getItem('group_id')
                }
                // groupMemberList(reParams)
                //     .then((response) => {
                //console.log("response", response);
                var modal_data = {
                    modal_id: "group-member-search-modal",
                    modal_header: "Group Business Members",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="group-member-search-main-container">                                            
                                             <div class="search">
                                                <div class="expand-search-wrap search-wrapper" id="group-member-search-btn">
                                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                    <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                                </div>
                                            </div>
                                            <div id="group-member-search-wrapper"></div>
                                        </div>`,
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processGroupBusinessMemberSearch(null, function () {
                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        var element = $('#group-member-search-modal').find('.expand-search-input');
                        if (element) {
                            //console.log('element22', element);
                            //if element is there
                            $(document).on('input', element, function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                element.attr("socketid", timestamp);
                            });
                            // element.addEventListener("keyup", function (e) {
                            $(document).on('keyup', element, function () {
                                // if (!hasClass(e.target, 'filemanager-search')) {
                                //console.log("not has class")
                                // on keyup get attribute 
                                socketid = element.attr("socketid");
                                keyword = element.val();
                                if (socketid && keyword) {
                                    //if socketid attribute and keyword is there
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    currentroute = $("body").attr('app');
                                    data = {
                                        room: crossplat.device.uuid,
                                        socketid,
                                        app: 'digibiz',
                                        keyword
                                    };
                                    switch (currentroute) {
                                        case 'collaborator_group_details':
                                            if ($('#group-member-search-modal').length > 0) {
                                                data['index'] = 'getCollaboratorGroupBusinessMembersSearch';
                                                data['group_id'] = sessionStorage.getItem('group_id');
                                            }
                                            break;
                                        default:
                                            break;
                                    }
                                    addLoader();
                                    //console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                } else {
                                    //console.log("going to else part")
                                    //else show default list
                                    removeLoader();
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                    currentroute = $("body").attr('app');
                                    // element.removeAttribute("socketid");
                                    element.attr("socketid", "");
                                    switch (currentroute) {
                                        case 'collaborator_group_details':
                                            if ($('#group-member-search-modal').length > 0) {
                                                processGroupBusinessMemberSearch(null, function () { })
                                            }
                                            break;
                                        default:
                                            break;
                                    }

                                }
                            });
                            $(document).on('click', '.searchclosebtn', function () {
                                if ($('#group-member-search-modal').length > 0) {
                                    processGroupBusinessMemberSearch(null, function () { })
                                }
                            })
                        }
                    });
                });
                // })
                // .catch((err) => {
                //     removeLoader();
                //     //console.log("no members found");
                // })
            } else if ($('body').attr('app') == "communication_group_details") {
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    group_id: sessionStorage.getItem('group_id'),
                    count: 20,
                    offset: 0
                }
                // getCompleteList(reqParams)
                //     .then((response) => {
                // console.log("completeMembersList", response);
                digibiz.group_members_list = [];
                digibiz.group_members_list = response;
                var modal_data = {
                    modal_id: "group-member-search-modal",
                    modal_header: "Group Members",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="group-member-search-main-container">                                           
                                             <div class="search">
                                                 <div class="expand-search-wrap search-wrapper" id="group-member-search-btn">
                                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                    <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                                </div>
                                             </div>
                                            <div id="group-member-search-wrapper"></div>
                                        </div>`,
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    if (search_employee_list) {
                        $('#group-member-search-main-container').addClass('employee-member-serach');
                    } else if (search_customer_list) {
                        $('#group-member-search-main-container').addClass('customer-member-serach');
                    } else if (search_collaborator_list) {
                        $('#group-member-search-main-container').addClass('collaborator-member-serach');
                    }

                    // if (search_employee_list) {
                    //     var responses = response.filter(e => e.type == "employee");
                    // } else {
                    //     var responses = response.filter(e => e.type != "employee");
                    // }
                    processGroupMemberSearch(null, function () {
                        // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                        var element = $('#group-member-search-modal').find('.expand-search-input');
                        if (element) {
                            //console.log('element22', element);
                            //if element is there
                            $(document).on('input', element, function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                element.attr("socketid", timestamp);
                            });
                            // element.addEventListener("keyup", function (e) {
                            $(document).on('keyup', element, function () {
                                // if (!hasClass(e.target, 'filemanager-search')) {
                                //console.log("not has class")
                                // on keyup get attribute 
                                socketid = element.attr("socketid");
                                keyword = element.val();
                                if (socketid && keyword) {
                                    //if socketid attribute and keyword is there
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    currentroute = $("body").attr('app');
                                    data = {
                                        room: crossplat.device.uuid,
                                        socketid,
                                        app: 'digibiz',
                                        keyword
                                    };
                                    switch (currentroute) {
                                        case 'communication_group_details':
                                            if ($('#group-member-search-modal').length > 0) {
                                                data['index'] = 'getDigibizGroupMembersListPage';
                                                data['group_id'] = sessionStorage.getItem('group_id');
                                                if (search_employee_list) {
                                                    data['list_by'] = "employee_list";
                                                }
                                                if (search_customer_list) {
                                                    data['list_by'] = "customer_list";
                                                }
                                                if (search_collaborator_list) {
                                                    data['list_by'] = "collaborator_list";
                                                }
                                                console.log('data', data);

                                            }
                                            break;
                                        default:
                                            break;
                                    }
                                    addLoader();
                                    //console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                } else {
                                    //console.log("going to else part")
                                    //else show default list
                                    removeLoader();
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                    currentroute = $("body").attr('app');
                                    // element.removeAttribute("socketid");
                                    element.attr("socketid", "");
                                    switch (currentroute) {
                                        case 'communication_group_details':
                                            if ($('#group-member-search-modal').length > 0) {
                                                processGroupMemberSearch(null, function () { })
                                            }
                                            break;
                                        default:
                                            break;
                                    }

                                }
                            });
                            $(document).on('click', '.searchclosebtn', function () {
                                if ($('#group-member-search-modal').length > 0) {
                                    processGroupMemberSearch(null, function () { })
                                }
                            })
                        }
                    });
                });
                // })
                // .catch((err) => {
                //     removeLoader();
                //     //console.log("no members found");
                // })
            } else if ($('body').attr('app') == "customer_groups_details") {
                if (sessionStorage.getItem('selected-customer-group-type-tab') == "standard") {
                    if (sessionStorage.getItem('group_type') == "primary_associate_customers" || sessionStorage.getItem('group_type') == "primary_customers" || sessionStorage.getItem('group_type') == "standard") {
                        var reqParams = {
                            device_id: crossplat.device.uuid,
                            group_id: sessionStorage.getItem('group_id')
                        }
                        // getCompleteList(reqParams)
                        //     .then((response) => {
                        var modal_data = {
                            modal_id: "group-member-search-modal",
                            modal_header: "Group Members",
                            modal_platform: crossplat.device.platform,
                            modal_body: `<div id="group-member-search-main-container">                                                    
                                                     <div class="search">
                                                         <div class="expand-search-wrap search-wrapper" id="group-member-search-btn">
                                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                            <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                            <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                                         </div>
                                                     </div>
                                                    <div id="group-member-search-wrapper"></div>
                                                </div>`,
                        }
                        showModal(modal_data, function () {
                            removeLoader();
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            processGroupMemberSearch(response, function () {
                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                var element = $('#group-member-search-modal').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'customer_groups_details':
                                                    if ($('#group-member-search-modal').length > 0) {
                                                        //console.log("group-member-search-modal")
                                                        data['index'] = 'getDigibizGroupMembersListPage';
                                                        data['group_id'] = sessionStorage.getItem('group_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'customer_groups_details':
                                                    if ($('#group-member-search-modal').length > 0) {
                                                        processGroupMemberSearch(null, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#group-member-search-modal').length > 0) {
                                            processGroupMemberSearch(null, function () { })
                                        }
                                    })
                                }
                            });
                        });
                        // })
                        // .catch((err) => {
                        //     removeLoader();
                        //     //console.log("no members found");
                        // })
                    }
                } else if (sessionStorage.getItem('selected-customer-group-type-tab') == "custom") {
                    if (sessionStorage.getItem('group_type') == "custom") {
                        var reqParams = {
                            device_id: crossplat.device.uuid,
                            group_id: sessionStorage.getItem('group_id')
                        }
                        // getCompleteList(reqParams)
                        //     .then((response) => {
                        var modal_data = {
                            modal_id: "group-member-search-modal",
                            modal_header: "Group Members",
                            modal_platform: crossplat.device.platform,
                            modal_body: `<div id="group-member-search-main-container">                                                    
                                                     <div class="search">
                                                         <div class="expand-search-wrap search-wrapper" id="group-member-search-btn">
                                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                            <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                            <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                                         </div>
                                                     </div>
                                                    <div id="group-member-search-wrapper"></div>
                                                </div>`,
                        }
                        showModal(modal_data, function () {
                            removeLoader();
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            processGroupMemberSearch(null, function () {
                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                var element = $('#group-member-search-modal').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'customer_groups_details':
                                                    if ($('#group-member-search-modal').length > 0) {
                                                        //console.log("group-member-search-modal")
                                                        data['index'] = 'getDigibizGroupMembersListPage';
                                                        data['group_id'] = sessionStorage.getItem('group_id');
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part")
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'customer_groups_details':
                                                    if ($('#group-member-search-modal').length > 0) {
                                                        processGroupMemberSearch(null, function () { })
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        if ($('#group-member-search-modal').length > 0) {
                                            processGroupMemberSearch(null, function () { })
                                        }
                                    })
                                }
                            });
                        });
                        // })
                        // .catch((err) => {
                        //     removeLoader();
                        //     //console.log("no members found");
                        // })
                    }
                }
            }
        } else {
            if ($('body').attr('app') == "communication_group_details") {
                if ($(this).parents('.communication-group-creation-customer-members-contentbox').length > 0) {
                    var customer_list = true;
                    $('#group-member-search-confirm-data').removeClass('employee_list');
                    $('#group-member-search-confirm-data').addClass('customer_list');
                    if (digibiz.selectedMembers.length > 0) {
                        var response = digibiz.selectedMembers.filter(e => e.selected == true && (e.type == "customer" || e.type == "associate_customer"));
                    } else {
                        var response = null;
                    }
                } else {
                    $('#group-member-search-confirm-data').addClass('employee_list');
                    $('#group-member-search-confirm-data').removeClass('customer_list');
                    var employee_list = true;
                    if (digibiz.selectedMembers.length > 0) {
                        var response = digibiz.selectedMembers.filter(e => e.selected == true && e.type == "employee_list");
                    } else {
                        var response = null;
                    }
                }
            } else {
                if (digibiz.selectedMembers.length > 0) {
                    var response = digibiz.selectedMembers.filter(e => e.selected == true);
                } else {
                    var response = null;
                }
            }
            var modal_data = {
                modal_id: "group-member-search-modal",
                modal_header: "Group Members",
                modal_platform: crossplat.device.platform,
                modal_body: `<div id="group-member-search-main-container">                                
                                 <div class="search">
                                     <div class="expand-search-wrap search-wrapper" id="group-member-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                     </div>
                                 </div>
                            <div id="group-member-search-wrapper"></div>
                            </div>`,
                modal_action_buttons: [{
                    "name": "Confirm",
                    "id": "group-member-search-confirm-data",
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                processCreateGroupMemberSearch(response, function () {
                    // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                    var element = $('#group-member-search-modal').find('.expand-search-input');
                    if (element) {
                        //console.log('element22', element);
                        //if element is there
                        $(document).on('input', element, function () {
                            //on input set attribute socketid 
                            timestamp = (new Date()).getTime();
                            element.attr("socketid", timestamp);
                        });
                        // element.addEventListener("keyup", function (e) {
                        $(document).on('keyup', element, function () {
                            // if (!hasClass(e.target, 'filemanager-search')) {
                            //console.log("not has class")
                            // on keyup get attribute 
                            socketid = element.attr("socketid");
                            keyword = element.val();
                            if (socketid && keyword) {
                                //if socketid attribute and keyword is there
                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                currentroute = $("body").attr('app');
                                data = {
                                    room: crossplat.device.uuid,
                                    socketid,
                                    app: 'digibiz',
                                    keyword
                                };
                                switch (currentroute) {
                                    case 'employee_group_create':
                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                            if ($('#group-member-search-modal').length > 0) {
                                                //console.log("group-member-search-modal")
                                                data['index'] = 'getDigibizGroupMembersListPage';
                                                data['group_id'] = sessionStorage.getItem('group_id');
                                            }
                                        } else {
                                            if ($('#group-member-search-modal').length > 0) {
                                                console.log("group-member-search-modal")
                                                var list_data = {
                                                    contactList: digibiz.selectedMembers.filter((o) => {
                                                        var contactName = o.name.split(" ");
                                                        var name = o.name;
                                                        return (contactName[0].toLowerCase().startsWith(keyword.toLowerCase()) || (contactName[1] && contactName[1].toLowerCase().startsWith(keyword.toLowerCase())) || name.toLowerCase().startsWith(keyword.toLowerCase()));
                                                    })
                                                }
                                                // console.log('list_data', list_data);
                                                processCreateGroupMemberSearch(list_data.contactList, function () { });


                                                // data['index'] = 'getDigibizGroupMembersListPage';
                                                // data['group_id'] = sessionStorage.getItem('group_id');
                                            }
                                        }
                                        break;
                                    case 'collaborator_group_create':
                                        if ($('#group-member-search-modal').length > 0) {
                                            console.log("group-member-search-modal")
                                            var list_data = {
                                                contactList: digibiz.selectedMembers.filter((o) => {
                                                    var contactName = o.name.split(" ");
                                                    var name = o.name;
                                                    return (contactName[0].toLowerCase().startsWith(keyword.toLowerCase()) || (contactName[1] && contactName[1].toLowerCase().startsWith(keyword.toLowerCase())) || name.toLowerCase().startsWith(keyword.toLowerCase()));
                                                })
                                            }
                                            // console.log('list_data', list_data);
                                            processCreateGroupMemberSearch(list_data.contactList, function () { });


                                            // data['index'] = 'getDigibizGroupMembersListPage';
                                            // data['group_id'] = sessionStorage.getItem('group_id');
                                        }

                                        break;
                                    case 'communication_group_details':
                                        if ($('#group-member-search-modal').length > 0) {
                                            console.log("group-member-search-modal");
                                            if (employee_list) {
                                                var selectedData = digibiz.selectedMembers.filter(e => e.type == "employee_list");
                                            } else {
                                                var selectedData = digibiz.selectedMembers.filter(e => e.type != "employee_list");
                                            }
                                            var list_data = {
                                                contactList: selectedData.filter((o) => {
                                                    var contactName = o.name.split(" ");
                                                    var name = o.name;
                                                    return (contactName[0].toLowerCase().startsWith(keyword.toLowerCase()) || (contactName[1] && contactName[1].toLowerCase().startsWith(keyword.toLowerCase())) || name.toLowerCase().startsWith(keyword.toLowerCase()));
                                                })
                                            }
                                            // console.log('list_data', list_data);
                                            processCreateGroupMemberSearch(list_data.contactList, function () { });


                                            // data['index'] = 'getDigibizGroupMembersListPage';
                                            // data['group_id'] = sessionStorage.getItem('group_id');
                                        }

                                    default:
                                        break;
                                }
                                addLoader();
                                //console.log("search emit", data);
                                sockets.searchSocket.emit('search', data);
                                setTimeout(() => {
                                    removeLoader();
                                }, 300);
                            } else {
                                //console.log("going to else part")
                                //else show default list
                                removeLoader();
                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                currentroute = $("body").attr('app');
                                // element.removeAttribute("socketid");
                                element.attr("socketid", "");
                                switch (currentroute) {
                                    case 'employee_group_create':
                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(null, null, function () { })
                                            }
                                            if ($('#group-member-search-modal').length > 0) {
                                                processCreateGroupMemberSearch(response, function () { })
                                            }
                                        } else {
                                            if ($('#group-member-search-modal').length > 0) {
                                                processCreateGroupMemberSearch(response, function () { })
                                            }
                                        }
                                        break;
                                    case 'communication_group_details':
                                        if ($('#group-member-search-modal').length > 0) {
                                            console.log("group-member-search-modal");
                                            if (employee_list) {
                                                var selectedData = digibiz.selectedMembers.filter(e => e.type == "employee_list");
                                            } else {
                                                var selectedData = digibiz.selectedMembers.filter(e => e.type != "employee_list");
                                            }

                                            // console.log('list_data', list_data);
                                            processCreateGroupMemberSearch(selectedData, function () { });

                                        }
                                        break;
                                    case 'collaborator_group_create':
                                        if ($('#group-member-search-modal').length > 0) {
                                            console.log("group-member-search-modal");

                                            // console.log('list_data', list_data);
                                            processCreateGroupMemberSearch(response, function () { });

                                        }
                                        break;
                                    default:
                                        break;
                                }

                            }
                        });
                        $(document).on('click', '.searchclosebtn', function () {
                            if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                    processCommunicationGroupActivateEmployeeGroupEmployeeList(null, null, function () { })
                                }
                                if ($('#group-member-search-modal').length > 0) {
                                    processCreateGroupMemberSearch(response, function () { })
                                }
                            } else {
                                if ($('#group-member-search-modal').length > 0) {
                                    processCreateGroupMemberSearch(response, function () { })
                                }
                            }
                        })
                    }
                });
            });
        }
    });

    $(document).on('click', '.search-moderator-button', function () {
        if (sessionStorage.getItem('group_id')) {
            // if ($('body').attr('app') == "communication_group_details") {
            // var requestParams = {
            //     device_id: crossplat.device.uuid,
            //     id: sessionStorage.getItem('group_id')
            // }
            // groupGet(requestParams)
            //     .then((groupResponse) => {
            var modReqParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                count: 20,
                offset: 0
            }
            // getGroupModeratorList(modReqParams).then((moderatorResponse) => {
            //     digibiz.group_moderator_list = [];
            //     digibiz.group_moderator_list = moderatorResponse.moderator;
            // digibiz.group_moderator_list  = groupResponse.moderator
            var modal_data = {
                modal_id: "modal-communication-group-moderator-selection",
                modal_header: "Group Moderators",
                modal_platform: crossplat.device.platform,
                modal_body: `<div id="group-member-search-main-container">                                           
                                             <div class="search">
                                                 <div class="expand-search-wrap search-wrapper" id="group-moderator-search-btn">
                                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                    <span class="searchclosebtn"><i class="material-icons group-member-close-btn hide">close</i></span>
                                                </div>
                                             </div>
                                            <div id="group-moderator-search-wrapper"></div>
                                        </div>`,
            }
            showModal(modal_data, function () {
                removeLoader();
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                processSearchGroupModeratorData(null, function () {
                    // listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                    var element = $('#modal-communication-group-moderator-selection').find('.expand-search-input');
                    if (element) {
                        //console.log('element22', element);
                        //if element is there
                        $(document).on('input', element, function () {
                            //on input set attribute socketid 
                            timestamp = (new Date()).getTime();
                            element.attr("socketid", timestamp);
                        });
                        // element.addEventListener("keyup", function (e) {
                        $(document).on('keyup', element, function () {
                            // if (!hasClass(e.target, 'filemanager-search')) {
                            //console.log("not has class")
                            // on keyup get attribute 
                            socketid = element.attr("socketid");
                            keyword = element.val();
                            if (socketid && keyword) {
                                if (keyword.length >= 3) {
                                    //if socketid attribute and keyword is there
                                    document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    currentroute = $("body").attr('app');
                                    data = {
                                        room: crossplat.device.uuid,
                                        socketid,
                                        app: 'digibiz',
                                        keyword
                                    };
                                    switch (currentroute) {
                                        case 'communication_group_details':
                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                data['index'] = 'getDigibizGroupModeratorListPage';
                                                data['group_id'] = sessionStorage.getItem('group_id');

                                            }
                                            break;
                                        case 'employee_group_create':
                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                data['index'] = 'getGroupModeratorListPage';
                                                data['group_id'] = sessionStorage.getItem('group_id');

                                            }
                                            break;
                                        case 'collaborator_groups_list':
                                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                                data['index'] = 'getDigibizGroupModeratorListPage';
                                                data['group_id'] = sessionStorage.getItem('group_id');

                                            }
                                            break;
                                        default:
                                            break;
                                    }
                                    addLoader();
                                    console.log("search emit", data);
                                    sockets.searchSocket.emit('search', data);
                                    setTimeout(() => {
                                        removeLoader();
                                    }, 300);
                                } else {
                                    Materialize.toast(`Search keyword should be more than 3.`, 3000, "round error-alert");
                                }
                            } else {
                                //console.log("going to else part")
                                //else show default list
                                removeLoader();
                                document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                currentroute = $("body").attr('app');
                                // element.removeAttribute("socketid");
                                element.attr("socketid", "");
                                switch (currentroute) {
                                    case 'communication_group_details':
                                        if ($('#modal-communication-group-moderator-selection').length > 0) {
                                            processSearchGroupModeratorData(null, function () { })
                                        }
                                        break;
                                    case 'employee_group_create':
                                        if ($('#modal-communication-group-moderator-selection').length > 0) {
                                            processSearchGroupModeratorData(null, function () { })
                                        }
                                        break;
                                    case 'collaborator_groups_list':
                                        if ($('#modal-communication-group-moderator-selection').length > 0) {
                                            processSearchGroupModeratorData(null, function () { })
                                        }
                                        break;
                                    default:
                                        break;
                                }

                            }
                        });
                        $(document).on('click', '.searchclosebtn', function () {
                            if ($('#modal-communication-group-moderator-selection').length > 0) {
                                processSearchGroupModeratorData(groupResponse.moderator, function () { })
                            }
                        })
                    }
                })


            })
            // }).catch((err) => {
            //     console.log('err', err);
            // })
            // }
        } else {

        }
    })

    $(document).on('click', '#group-member-search-confirm-data', function () {
        addLoader();
        // digibiz.selectedMembers =[];
        if ($('#group-member-search-modal').find('.employee-select-btn-wrapper.selected-row').length > 0 && $('body').attr('app') == "customer_groups_details") {
            $('.search-member-button').removeClass('hide');
            // if (sessionStorage.getItem('group_from') == "contact_list") {
            //     $('.search-member-button').removeClass('hide');
            // } else {
            //     $('.search-member-button').addClass('hide');
            // }
            // $.each($('.employee-select-btn:checked'), function (index, element) {
            $(".customer-group-member-wrapper").remove();
            $.each($('.employee-select-btn-wrapper.selected-row'), function (index, element) {
                var getCustomerId = $(element).find('.contact-profile-container').attr('data-id');
                //console.log("getCustomerId", getCustomerId);
                var getCustomerName = $(element).find('.contact-name-wrapper').text();
                //console.log("getCustomerName", getCustomerName);
                var getCustomerNameImageLetter = $(element).find('.contact-name-wrapper').text().charAt(0);
                //console.log("getCustomerNameImageLetter", getCustomerNameImageLetter);
                var getCustomerType = $(element).find('.profile-pic-container').attr('data-type');
                //console.log("getCustomerType", getCustomerType);
                var getRoleId = $(element).find('.profile-pic-container').attr('data-role_id');
                //console.log("getRoleId", getRoleId);
                var getRoleType = $(element).find('.profile-pic-container').attr('data-role_type');
                //console.log("getRoleType", getRoleType);
                var getRoleBusinessID = $(element).find('.profile-pic-container').attr('data-role_business_id');
                //console.log("getRoleBusinessID", getRoleBusinessID);
                var getRoleBusinessName = $(element).find('.profile-pic-container').attr('data-role_business_name');
                //console.log("getRoleBusinessName", getRoleBusinessName);
                var getMainIdentifier = $(element).find('.profile-pic-container').attr('data-main_identifier');
                //console.log('getMainIdentifier', getMainIdentifier);
                if (getCustomerType == "associate_customer") {
                    var getParentCustomerId = $(element).find('.profile-pic-container').attr('data-parent_customer_id');
                    //console.log("getParentCustomerId", getParentCustomerId);
                    var getAssociateCustomerInfo = $(element).find('.profile-pic-container').attr('data-associate_customter_info');
                    //console.log("getAssociateCustomerInfo", getAssociateCustomerInfo);
                    if (getCustomerId != undefined) {
                        var members = {
                            id: getCustomerId,
                            name: getCustomerName,
                            imageLetter: getCustomerNameImageLetter,
                            customer_type: getCustomerType,
                            role_id: getRoleId,
                            role_type: getRoleType,
                            role_business_id: getRoleBusinessID,
                            role_business_name: getRoleBusinessName,
                            main_identifier: getMainIdentifier,
                            parent_customer_id: getParentCustomerId,
                            associate_customter_info: getAssociateCustomerInfo,
                            type: "associate_customer",
                            selected: true
                        }
                        console.log('members', members)
                        var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                        if (index == -1) {
                            digibiz.selectedMembers.push(members);
                            // }
                            if (getRoleType == "employee") {
                                var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}" data-parent-customer-id="${getParentCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                        <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                        <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                        <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getAssociateCustomerInfo}-${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                //console.log("template", template)
                                //console.log("123", $('#customer-group-members-list'))
                                $('#customer-group-members-list').append(template);
                                $('#modal-customer-group-contact-list-selection').remove();
                                $('#group-member-search-modal').remove();
                            } else {
                                //console.log("got")
                                var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}" data-parent-customer-id="${getParentCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                        <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                        <span class="truncate selected-member-info wrapper-secondary-heading">${getAssociateCustomerInfo}-${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                //console.log("template", template)
                                //console.log("123", $('#customer-group-members-list'))
                                $('#customer-group-members-list').append(template);
                            }
                            $('#modal-customer-group-contact-list-selection').remove();
                            $('#group-member-search-modal').remove();
                        }
                    } else {
                        removeLoader();
                        //console.log("customer id is undefined")
                    }
                } else {//customer type
                    if (getCustomerId != undefined) {
                        var members = {
                            id: getCustomerId,
                            name: getCustomerName,
                            imageLetter: getCustomerNameImageLetter,
                            customer_type: getCustomerType,
                            role_id: getRoleId,
                            role_type: getRoleType,
                            role_business_id: getRoleBusinessID,
                            role_business_name: getRoleBusinessName,
                            main_identifier: getMainIdentifier,
                            type: "customer",
                            // parent_customer_id: getParentCustomerId,
                            // associate_customter_info: getAssociateCustomerInfo,                             
                            selected: true
                        }
                        var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                        if (index == -1) {
                            digibiz.selectedMembers.push(members);
                            // }
                            if (getRoleType == "employee") {
                                var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                    <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                    <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                    <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                $('#customer-group-members-list').append(template);
                                $('#modal-customer-group-contact-list-selection').remove();
                                $('#group-member-search-modal').remove();
                            } else {
                                var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                    <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                    <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                $('#customer-group-members-list').append(template);
                            }
                            $('#modal-customer-group-contact-list-selection').remove();
                            $('#group-member-search-modal').remove();
                        }
                    } else {
                        removeLoader();
                        //console.log("customer id is undefined")
                    }
                }

            })
            removeLoader();
        } else if ($('#group-member-search-modal').find('.employee-select-btn-wrapper.selected-row').length > 0 && $('body').attr('app') == "communication_group_details") {
            $('.search-member-button').removeClass('hide');
            if ($(this).hasClass('employee_list')) {
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    $('.search-member-button').removeClass('hide');
                } else {
                    $('.search-member-button').addClass('hide');
                }
                // $.each($('.employee-select-btn:checked'), function (index, element) {
                $(".employee-group-member-wrapper").remove();
                $.each($('.employee-select-btn-wrapper.selected-row'), function (index, element) {
                    // digibiz.employee_group_selected_employee_members.push($(element).attr('data-dj-unique-employee-id'));
                    var getDJUniqueEmployeeId = $(element).find('.contact-profile-container').attr('data-dj-unique-employee-id');
                    var getEmployeeName = $(element).find('.contact-name-wrapper').text();
                    var getEmployeeNameImageLetter = $(element).find('.contact-name-wrapper').text().charAt(0);
                    //console.log("getEmployeeName", getEmployeeName);
                    if (getDJUniqueEmployeeId != undefined) {
                        var members = {
                            id: getDJUniqueEmployeeId,
                            name: getEmployeeName,
                            imageLetter: getEmployeeNameImageLetter,
                            dj_unique_employee_id: getDJUniqueEmployeeId,
                            selected: true,
                            type: "employee_list"
                        }
                        var index = digibiz.selectedMembers.findIndex(e => e.id == getDJUniqueEmployeeId);
                        if (index == -1) {
                            digibiz.selectedMembers.push(members);


                            var template = `<div class="tooltipped employee-group-member-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                        <span>${getEmployeeNameImageLetter}</span> 
                     </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span></div>
                </div>`;
                            $('#employee-group-members-list').append(template);
                        }
                        $('#group-member-search-modal').remove();
                    } else {
                        removeLoader();
                        //console.log("Dj unique employee id is undefined")
                    }
                })
                removeLoader();
            } else {
                $(".customer-group-member-wrapper").remove();
                $.each($('.employee-select-btn-wrapper.selected-row'), function (index, element) {
                    var getCustomerId = $(element).find('.contact-profile-container').attr('data-id');
                    //console.log("getCustomerId", getCustomerId);
                    var getCustomerName = $(element).find('.contact-name-wrapper').text();
                    //console.log("getCustomerName", getCustomerName);
                    var getCustomerNameImageLetter = $(element).find('.contact-name-wrapper').text().charAt(0);
                    //console.log("getCustomerNameImageLetter", getCustomerNameImageLetter);
                    var getCustomerType = $(element).find('.profile-pic-container').attr('data-type');
                    //console.log("getCustomerType", getCustomerType);
                    var getRoleId = $(element).find('.profile-pic-container').attr('data-role_id');
                    //console.log("getRoleId", getRoleId);
                    var getRoleType = $(element).find('.profile-pic-container').attr('data-role_type');
                    //console.log("getRoleType", getRoleType);
                    var getRoleBusinessID = $(element).find('.profile-pic-container').attr('data-role_business_id');
                    //console.log("getRoleBusinessID", getRoleBusinessID);
                    var getRoleBusinessName = $(element).find('.profile-pic-container').attr('data-role_business_name');
                    //console.log("getRoleBusinessName", getRoleBusinessName);
                    var getMainIdentifier = $(element).find('.profile-pic-container').attr('data-main_identifier');
                    //console.log('getMainIdentifier', getMainIdentifier);
                    if (getCustomerType == "associate_customer") {
                        var getParentCustomerId = $(element).find('.profile-pic-container').attr('data-parent_customer_id');
                        //console.log("getParentCustomerId", getParentCustomerId);
                        var getAssociateCustomerInfo = $(element).find('.profile-pic-container').attr('data-associate_customter_info');
                        //console.log("getAssociateCustomerInfo", getAssociateCustomerInfo);
                        if (getCustomerId != undefined) {
                            var members = {
                                id: getCustomerId,
                                name: getCustomerName,
                                imageLetter: getCustomerNameImageLetter,
                                customer_type: getCustomerType,
                                role_id: getRoleId,
                                role_type: getRoleType,
                                role_business_id: getRoleBusinessID,
                                role_business_name: getRoleBusinessName,
                                main_identifier: getMainIdentifier,
                                parent_customer_id: getParentCustomerId,
                                associate_customter_info: getAssociateCustomerInfo,
                                type: "associate_customer",
                                selected: true
                            }
                            console.log('members', members)
                            var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                            if (index == -1) {
                                digibiz.selectedMembers.push(members);
                                // }
                                if (getRoleType == "employee") {
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}" data-parent-customer-id="${getParentCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                        <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                        <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                        <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getAssociateCustomerInfo}-${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                    //console.log("template", template)
                                    //console.log("123", $('#customer-group-members-list'))
                                    $('#customer-group-members-list').append(template);
                                    $('#modal-customer-group-contact-list-selection').remove();
                                    $('#group-member-search-modal').remove();
                                } else {
                                    //console.log("got")
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}" data-parent-customer-id="${getParentCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                        <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                        <span class="truncate selected-member-info wrapper-secondary-heading">${getAssociateCustomerInfo}-${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                    //console.log("template", template)
                                    //console.log("123", $('#customer-group-members-list'))
                                    $('#customer-group-members-list').append(template);
                                }
                                $('#modal-customer-group-contact-list-selection').remove();
                                $('#group-member-search-modal').remove();
                            }
                        } else {
                            removeLoader();
                            //console.log("customer id is undefined")
                        }
                    } else {//customer type
                        if (getCustomerId != undefined) {
                            var members = {
                                id: getCustomerId,
                                name: getCustomerName,
                                imageLetter: getCustomerNameImageLetter,
                                customer_type: getCustomerType,
                                role_id: getRoleId,
                                role_type: getRoleType,
                                role_business_id: getRoleBusinessID,
                                role_business_name: getRoleBusinessName,
                                main_identifier: getMainIdentifier,
                                type: "customer",
                                // parent_customer_id: getParentCustomerId,
                                // associate_customter_info: getAssociateCustomerInfo,                             
                                selected: true
                            }
                            var index = digibiz.selectedMembers.findIndex(e => e.id == getCustomerId);
                            if (index == -1) {
                                digibiz.selectedMembers.push(members);
                                // }
                                if (getRoleType == "employee") {
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                    <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                    <span class="truncate selected-member-role-business-name wrapper-secondary-heading" for="selected-${getCustomerId}">${getRoleBusinessName}</span>
                                                    <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                    $('#customer-group-members-list').append(template);
                                    $('#modal-customer-group-contact-list-selection').remove();
                                    $('#group-member-search-modal').remove();
                                } else {
                                    var template = `<div class="tooltipped customer-group-member-wrapper" data-id="${getCustomerId}">
                                                <div class="file-select">
                                                    <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getCustomerId}" data-type="${getCustomerType}" id="selected-${getCustomerId}" checked="" data-role-id="${getRoleId}" data-role-type="${getRoleType}" data-role-business-id="${getRoleBusinessID}">
                                                    <i class="material-icons">done</i>
                                                    <div class="profile-text group-profile-text text-small-size">
                                                        <span>${getCustomerNameImageLetter}</span> 
                                                    </div>
                                                </div>
                                                <div class="filemanager-file-wrapper">
                                                    <div>
                                                    <span class="truncate selected-member-name" for="selected-${getCustomerId}">${getCustomerName}</span>
                                                    <span class="truncate selected-member-info wrapper-secondary-heading" for="selected-${getCustomerId}">${getMainIdentifier}</span>
                                                    </div>
                                                </div>
                                            </div>`;
                                    $('#customer-group-members-list').append(template);
                                }
                                $('#modal-customer-group-contact-list-selection').remove();
                                $('#group-member-search-modal').remove();
                            }
                        } else {
                            removeLoader();
                            //console.log("customer id is undefined")
                        }
                    }

                })
                removeLoader();
            }
        } else if ($('#group-member-search-modal').find('.employee-select-btn-wrapper.selected-row').length > 0 && $('body').attr('app') == "collaborator_group_create") {
            //first time adding            
            $(".collaborator-group-employee-member-wrapper").remove();
            $.each($('.employee-select-btn-wrapper.selected-row'), function (index, element) {
                // digibiz.employee_group_selected_employee_members.push($(element).attr('data-dj-unique-employee-id'));
                var getDJUniqueEmployeeId = $(element).find('.contact-profile-container').attr('data-dj-unique-employee-id');
                var getEmployeeName = $(element).find('.contact-name-wrapper').text();
                var getEmployeeNameImageLetter = $(element).find('.contact-name-wrapper').text().charAt(0);
                //console.log("getEmployeeName", getEmployeeName);
                if (getDJUniqueEmployeeId != undefined) {
                    var members = {
                        id: getDJUniqueEmployeeId,
                        name: getEmployeeName,
                        imageLetter: getEmployeeNameImageLetter,
                        dj_unique_employee_id: getDJUniqueEmployeeId,
                        selected: true,
                        type: "employee_list"
                    }
                    var index = digibiz.selectedMembers.findIndex(e => e.id == getDJUniqueEmployeeId && e.selected);
                    if (index == -1) {
                        digibiz.selectedMembers.push(members);
                        // }

                        var template = `<div class="tooltipped collaborator-group-employee-member-wrapper member-listing-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in collaborator-group-owner-business-employee-member" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getEmployeeNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span></div>
            </div>`;
                        $('#collaborator-group-owner-business-employees-list').append(template);
                    }
                    $('#group-member-search-modal').remove();
                } else {
                    removeLoader();
                    //console.log("Dj unique employee id is undefined")
                }
            })
            removeLoader();
        } else if ($('#group-member-search-modal').find('.employee-select-btn-wrapper.selected-row').length > 0 && $('body').attr('app') == "employee_group_create") {
            //first time adding
            if (sessionStorage.getItem('group_from') == "employee_list") {
                $('.search-member-button').removeClass('hide');
            } else {
                $('.search-member-button').addClass('hide');
            }
            // $.each($('.employee-select-btn:checked'), function (index, element) {
            $(".employee-group-member-wrapper").remove();
            $.each($('.employee-select-btn-wrapper.selected-row'), function (index, element) {
                // digibiz.employee_group_selected_employee_members.push($(element).attr('data-dj-unique-employee-id'));
                var getDJUniqueEmployeeId = $(element).find('.contact-profile-container').attr('data-dj-unique-employee-id');
                var getEmployeeName = $(element).find('.contact-name-wrapper').text();
                var getEmployeeNameImageLetter = $(element).find('.contact-name-wrapper').text().charAt(0);
                //console.log("getEmployeeName", getEmployeeName);
                if (getDJUniqueEmployeeId != undefined) {
                    var members = {
                        id: getDJUniqueEmployeeId,
                        name: getEmployeeName,
                        imageLetter: getEmployeeNameImageLetter,
                        dj_unique_employee_id: getDJUniqueEmployeeId,
                        selected: true,
                        type: "employee_list"
                    }
                    var index = digibiz.selectedMembers.findIndex(e => e.id == getDJUniqueEmployeeId);
                    if (index == -1) {
                        digibiz.selectedMembers.push(members);
                        // }

                        var template = `<div class="tooltipped employee-group-member-wrapper" data-dj-unique-employee-id="${getDJUniqueEmployeeId}"><div class="file-select">
                <input type="checkbox" name="selectedmembers[]" class="contactlists filled-in" value="${getDJUniqueEmployeeId}" id="selected-${getDJUniqueEmployeeId}" checked=""><i class="material-icons">done</i><div class="profile-text group-profile-text text-small-size">
                    <span>${getEmployeeNameImageLetter}</span> 
                 </div></div><div class="filemanager-file-wrapper"><span class="truncate" for="selected-${getDJUniqueEmployeeId}">${getEmployeeName}</span></div>
            </div>`;
                        $('#employee-group-members-list').append(template);
                    }
                    $('#group-member-search-modal').remove();
                } else {
                    removeLoader();
                    //console.log("Dj unique employee id is undefined")
                }
            })
            removeLoader();
        }
        else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 contacts.`, 3000, "round error-alert");
        }
    })



    //checkbox events 
    $(document).on('click', '.department-list-data-wrapper', function (e) {
        //console.log("checkbox events ")
        e.stopImmediatePropagation();
        var $this = $(this);
        var getId = $(this).attr('data-id');
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.department-list-data-wrapper').toggleClass('selected-row');
        }
        if ($('#assign-employee-department-modal').length > 0 || $('#department-wise-employees-list-modal').length > 0) {
            var index = digibiz.department_list_selection.findIndex(e => e.id == getId);
            if (index != -1) {
                if ($($checkbox).is(':checked')) {
                    digibiz.department_list_selection[index]['selected'] = true;
                } else {
                    digibiz.department_list_selection[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.checkbox-click-wrapper').toggleClass('selected-row');
        }
    });

    // on select of employess from the employee list(for both employee groups and collaborators group creation)
    // $(document).on('change', '.employee-select-btn', function () {
    //     var $this = $(this);
    //     var dj_unique_employee_id = $(this).attr('data-dj-unique-employee-id');
    //     if ($('body').attr('app') == "collaborator_group_create" || $('body').attr('app') == "collaborator_group_details") {
    //         var index = digibiz.collaborator_group_owner_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
    //         if (index != -1) {
    //             if ($($this).is(':checked')) {
    //                 digibiz.collaborator_group_owner_employee_members[index]['selected'] = true;
    //             } else {
    //                 digibiz.collaborator_group_owner_employee_members[index]['selected'] = false;
    //             }
    //         }
    //     } else {
    //         var index = digibiz.employee_group_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
    //         if (index != -1) {
    //             if ($(this).is(':checked')) {
    //                 digibiz.employee_group_employee_members[index]['selected'] = true;
    //             } else {
    //                 digibiz.employee_group_employee_members[index]['selected'] = false;
    //             }
    //         }
    //     }
    // });

    // on select of employess from the employee list(for both employee groups and collaborators group creation)
    $(document).on('click', '.employee-select-btn-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-select-btn-wrapper').toggleClass('selected-row');
        }
        var dj_unique_employee_id = $($this).find('.employee-select-btn').attr('data-dj-unique-employee-id');
        var employee_id = $($this).find('.contact-profile-container').attr('data-dj-unique-employee-id');
        var customer_id = $($this).find('.contact-profile-container').attr('data-id');
        console.log('dj_unique_employee_id', employee_id);
        if ($('body').attr('app') == "super_admin_management_hub") {
            if ($('.employee-select-btn-wrapper.selected-row').length > 1) {
                //show tick if checked
                if (!$(e.target).is('input:checkbox')) {
                    $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-select-btn-wrapper').toggleClass('selected-row');
                }
                Materialize.toast(`Can't select more than 1 employee.`, 3000, 'round success-alert');
            }
        } else if ($('body').attr('app') == "business_settings" || $('body').attr('app') == "module_admin_list") {
            if ($('.employee-select-btn-wrapper.selected-row').length > 1) {
                //show tick if checked
                if (!$(e.target).is('input:checkbox')) {
                    $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-select-btn-wrapper').toggleClass('selected-row');
                }
                Materialize.toast(`Can't select more than 1 employee.`, 3000, 'round success-alert');
            }
        } else if ($('body').attr('app') == "collaborator_group_create" || $('body').attr('app') == "collaborator_group_details") {
            if ($('#modal-collaborator-group-moderator-selection').length > 0) {
                if ($($this).hasClass('selected-row')) {
                    if ($('.employee-select-btn-wrapper.selected-row').length > 3) {
                        //show tick if checked
                        if (!$(e.target).is('input:checkbox')) {
                            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-select-btn-wrapper').toggleClass('selected-row');
                        }
                        Materialize.toast("Maximum 3 moderators.", 3000, 'round success-alert');
                    }
                } else {
                    if (sessionStorage.getItem('group_id')) {
                        if ($('.employee-select-btn-wrapper.selected-row').length == 0) {
                            //show tick if checked
                            if (!$(e.target).is('input:checkbox')) {
                                $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-select-btn-wrapper').toggleClass('selected-row');
                            }
                            Materialize.toast("Minimum 1 moderators is required.", 3000, 'round success-alert');
                        }
                    }
                }
            } else {
                var index = digibiz.collaborator_group_owner_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
                if (index != -1) {
                    if ($($this).hasClass('selected-row')) {
                        digibiz.collaborator_group_owner_employee_members[index]['selected'] = true;
                    } else {
                        digibiz.collaborator_group_owner_employee_members[index]['selected'] = false;
                    }
                }
            }
        } else if ($('body').attr('app') == "customer_groups_details") {
            var index1 = digibiz.selectedMembers.findIndex(e => e.id == customer_id);
            console.log('index1', index1);
            if (index1 != -1) {
                digibiz.selectedMembers[index1].selected = false;
            } else {
                if (digibiz.selectedMembers.length > 0 && digibiz.selectedMembers[index1]) {
                    digibiz.selectedMembers[index1].selected = true;
                }
            }
        } else {
            var index = digibiz.employee_group_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
            if (index != -1) {
                if ($(this).hasClass('selected-row')) {
                    digibiz.employee_group_employee_members[index]['selected'] = true;
                } else {
                    digibiz.employee_group_employee_members[index]['selected'] = false;
                }
            }
            var index1 = digibiz.selectedMembers.findIndex(e => e.id == employee_id);
            console.log('index1', index1);
            if (index1 != -1) {
                digibiz.selectedMembers[index1].selected = false;
            } else {
                if (digibiz.selectedMembers.length > 0 && digibiz.selectedMembers[index1]) {
                    digibiz.selectedMembers[index1].selected = true;
                }
            }
        }
    });


    // $(document).on('click', '.employee-selection-list-container', function (e) {
    //     e.stopImmediatePropagation();
    //     var $this = $(this);
    //     let $checkbox = $($this).find('input:checkbox');
    //     //show tick if checked
    //     if (!$(e.target).is('input:checkbox')) {
    //         $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-select-btn-wrapper').toggleClass('selected-row');
    //     }
    //     console.log('$($this)',$($this));
    //     var dj_unique_employee_id = $($this).find('.contact-profile-container').attr('data-employee-id');
    //     console.log('dj_unique_employee_id', dj_unique_employee_id);

    //     var index = digibiz.employee_group_employee_members.findIndex(e => e.dj_unique_employee_id == dj_unique_employee_id);
    //     if (index != -1) {
    //         if ($(this).hasClass('selected-row')) {
    //             digibiz.employee_group_employee_members[index]['selected'] = true;
    //         } else {
    //             digibiz.employee_group_employee_members[index]['selected'] = false;
    //         }
    //     }
    //     var index1 = digibiz.selectedMembers.findIndex(e => e.id == dj_unique_employee_id);
    //     console.log('index1', index1);
    //     if (index1 != -1) {
    //         if ($(this).hasClass('selected-row')) {
    //             digibiz.selectedMembers[index1].selected = true;
    //         } else {
    //             digibiz.selectedMembers[index1].selected = false;
    //         }          
    //     } 

    // });

    // $(document).on('change', '.communication-group-employee-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     var getid = $(this).attr('data-dj-unique-employee-id');
    //     if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
    //         var getGroupFrom = $(this).parents('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type');
    //         if (getGroupFrom == "employee_list") {
    //             var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.member.dj_unique_employee_id == getid);
    //             if (index != -1) {
    //                 if ($($this).is(':checked')) {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
    //                 } else {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
    //                     //filter from already selected
    //                     // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
    //                 }
    //             }
    //         } else if (getGroupFrom == "standard_group") {//standard group
    //             var getGroupId = $($this).parents('.accordion-content').attr('data-group-id');
    //             //console.log("getGroupId", getGroupId)
    //             // //check in the global array
    //             // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == getGroupId);
    //             // if (getIndex > -1) {
    //             //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == getGroupId);
    //             //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == getid);
    //             //     //console.log("getEmployeeIndex", getEmployeeIndex)
    //             //     if (getEmployeeIndex > -1) {
    //             //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
    //             //     }
    //             // }
    //             if ($($this).is(':checked')) {
    //                 var getRecord = digibiz.employeeSelectedContactList.find((e) => e.id == getid && e.group_id == getGroupId);
    //                 if (getRecord == undefined) {
    //                     digibiz.employeeSelectedContactList.push({
    //                         id: getid,
    //                         group_id: getGroupId,
    //                         selected: true
    //                     })
    //                 }
    //             } else {
    //                 digibiz.employeeSelectedContactList = digibiz.employeeSelectedContactList.filter((o) => {
    //                     return o.id != getid
    //                 })

    //             }
    //         } else {
    //             var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
    //             if (index != -1) {
    //                 if ($($this).is(':checked')) {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
    //                 } else {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
    //                     //filter from already selected
    //                     // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
    //                 }
    //             }
    //         }
    //         removeLoader();
    //     } else if ($('#modal-communication-group-employees-selection').length > 0) {
    //         var index = digibiz.communicationGroupEmployeeSelectionList.findIndex(e => e.dj_unique_employee_id == getid);
    //         if (index != -1) {
    //             if ($($this).is(':checked')) {
    //                 digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = true;
    //             } else {
    //                 digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = false;
    //             }
    //         }
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    // $(document).on('click', '.communication-group-employee-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     var getid = $(this).attr('data-dj-unique-employee-id');
    //     if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
    //         var getGroupFrom = $(this).parents('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type');
    //         if (getGroupFrom == "employee_list") {
    //             var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.member.dj_unique_employee_id == getid);
    //             if (index != -1) {
    //                 if ($($this).is(':checked')) {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
    //                 } else {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
    //                     //filter from already selected
    //                     // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
    //                 }
    //             }
    //         } else if (getGroupFrom == "standard_group") {//standard group
    //             var getGroupId = $($this).parents('.accordion-content').attr('data-group-id');
    //             //console.log("getGroupId", getGroupId)
    //             // //check in the global array
    //             // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == getGroupId);
    //             // if (getIndex > -1) {
    //             //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == getGroupId);
    //             //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == getid);
    //             //     //console.log("getEmployeeIndex", getEmployeeIndex)
    //             //     if (getEmployeeIndex > -1) {
    //             //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
    //             //     }
    //             // }
    //             if ($($this).is(':checked')) {
    //                 var getRecord = digibiz.employeeSelectedContactList.find((e) => e.id == getid && e.group_id == getGroupId);
    //                 if (getRecord == undefined) {
    //                     digibiz.employeeSelectedContactList.push({
    //                         id: getid,
    //                         group_id: getGroupId,
    //                         selected: true
    //                     })
    //                 }
    //             } else {
    //                 digibiz.employeeSelectedContactList = digibiz.employeeSelectedContactList.filter((o) => {
    //                     return o.id != getid
    //                 })

    //             }
    //         } else {
    //             var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
    //             if (index != -1) {
    //                 if ($($this).is(':checked')) {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
    //                 } else {
    //                     digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
    //                     //filter from already selected
    //                     // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
    //                 }
    //             }
    //         }
    //         removeLoader();
    //     } else if ($('#modal-communication-group-employees-selection').length > 0) {
    //         var index = digibiz.communicationGroupEmployeeSelectionList.findIndex(e => e.dj_unique_employee_id == getid);
    //         if (index != -1) {
    //             if ($($this).is(':checked')) {
    //                 digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = true;
    //             } else {
    //                 digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = false;
    //             }
    //         }
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    //(currently used)
    $(document).on('click', '.communication-group-employee-select-btn-checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').toggleClass('selected-row');
        }
        var getid = $(this).find('.communication-group-employee-select-btn').attr('data-dj-unique-employee-id');
        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
            var getGroupFrom = $(this).parents('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type');
            if (getGroupFrom == "employee_list") {
                var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.member.dj_unique_employee_id == getid);
                if (index != -1) {
                    if ($($this).hasClass('selected-row')) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
                    } else {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
                        //filter from already selected
                        // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
                    }
                }
            } else if (getGroupFrom == "standard_group") {//standard group
                var getGroupId = $($this).parents('.accordion-content').attr('data-group-id');
                //console.log("getGroupId", getGroupId)
                // //check in the global array
                // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == getGroupId);
                // if (getIndex > -1) {
                //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == getGroupId);
                //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == getid);
                //     //console.log("getEmployeeIndex", getEmployeeIndex)
                //     if (getEmployeeIndex > -1) {
                //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
                //     }
                // }
                if ($($this).hasClass('selected-row')) {
                    var getRecord = digibiz.employeeSelectedContactList.find((e) => e.id == getid && e.group_id == getGroupId);
                    if (getRecord == undefined) {
                        digibiz.employeeSelectedContactList.push({
                            id: getid,
                            group_id: getGroupId,
                            selected: true
                        })
                    }
                } else {
                    digibiz.employeeSelectedContactList = digibiz.employeeSelectedContactList.filter((o) => {
                        return o.id != getid
                    })

                }
            } else {
                var index = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex(e => e.dj_unique_employee_id == getid);
                if (index != -1) {
                    if ($($this).hasClass('selected-row')) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = true;
                    } else {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[index]['selected'] = false;
                        //filter from already selected
                        // digibiz.alreadySelected = digibiz.alreadySelected.filter((e) => e.id != getid);
                    }
                }
            }
            removeLoader();
        } else if ($('#modal-communication-group-employees-selection').length > 0) {
            var index = digibiz.communicationGroupEmployeeSelectionList.findIndex(e => e.dj_unique_employee_id == getid);
            if (index != -1) {
                if ($($this).hasClass('selected-row')) {
                    digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = true;
                } else {
                    digibiz.communicationGroupEmployeeSelectionList[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    //(currently used)    
    $(document).on('click', '.standard-employee-group-select-checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.standard-employee-group-select-checkbox-click-wrapper').toggleClass('selected-row');
        }
    });

    // $(document).on('change', '.customer-group-contact-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     var getid = $(this).attr('data-id');
    //     var getType = $(this).attr('data-type');
    //     var getContactItemId = $(this).parents('.accordion-content').attr('id');
    //     if ($('#modal-customer-group-contact-list-selection').length > 0) {
    //         if ($($this).is(':checked')) {
    //             var getRecord = digibiz.customerSelectedContactList.find((e) => e.id == getid && e.type == getType);
    //             if (getRecord == undefined) {
    //                 digibiz.customerSelectedContactList.push({
    //                     id: getid,
    //                     type: getType,
    //                     contact_item_id: getContactItemId,
    //                     selected: true
    //                 })
    //             }
    //         } else {
    //             digibiz.customerSelectedContactList = digibiz.customerSelectedContactList.filter((o) => o.id != getid)
    //         }
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    //(currently used)    
    $(document).on('click', '.customer-group-contact-select-btn-checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.customer-group-contact-select-btn-checkbox-click-wrapper').toggleClass('selected-row');
        }
        var getid = $(this).find('.customer-group-contact-select-btn').attr('data-id');
        var getType = $(this).find('.customer-group-contact-select-btn').attr('data-type');
        var getContactItemId = $(this).find('.accordion-content').attr('id');
        if ($('#modal-customer-group-contact-list-selection').length > 0) {
            if ($($this).hasClass('selected-row')) {
                var getRecord = digibiz.customerSelectedContactList.find((e) => e.id == getid && e.type == getType);
                if (getRecord == undefined) {
                    digibiz.customerSelectedContactList.push({
                        id: getid,
                        type: getType,
                        contact_item_id: getContactItemId,
                        selected: true
                    })
                }
            } else {
                digibiz.customerSelectedContactList = digibiz.customerSelectedContactList.filter((o) => o.id != getid)
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    // $(document).on('change', '.customer-group-custom-group-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     var getid = $(this).attr('data-id');
    //     if ($('#modal-customer-group-groups-list-selection').length > 0) {
    //         var index = digibiz.customerGroupCustomGroupsList.findIndex(e => e.id == getid);
    //         if (index != -1) {
    //             if ($($this).is(':checked')) {
    //                 digibiz.customerGroupCustomGroupsList[index]['selected'] = true;
    //             } else {
    //                 digibiz.customerGroupCustomGroupsList[index]['selected'] = false;
    //             }
    //         }
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    //(currently used)   
    $(document).on('click', '.customer-group-custom-group-select-btn-checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.customer-group-custom-group-select-btn-checkbox-click-wrapper').toggleClass('selected-row');
        }
        var getid = $(this).attr('data-id');
        if ($('#modal-customer-group-groups-list-selection').length > 0) {
            var index = digibiz.customerGroupCustomGroupsList.findIndex(e => e.id == getid);
            if (index != -1) {
                if ($($this).hasClass('selected-row')) {
                    digibiz.customerGroupCustomGroupsList[index]['selected'] = true;
                } else {
                    digibiz.customerGroupCustomGroupsList[index]['selected'] = false;
                }
            }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    //(currently used)
    $(document).on('click', '.department-list-data-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.department-list-data-wrapper').toggleClass('selected-row');
        }
    });

    //(currently used)
    $(document).on('click', '.customer-contact-access-employee-selected-checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.customer-contact-access-employee-selected-checkbox-click-wrapper').toggleClass('selected-row');
        }
    });

    // $(document).on('change', '.communication-group-customer-contact-select-btn', function () {
    //     addLoader();
    //     var $this = $(this);
    //     var getid = $(this).attr('data-id');
    //     var getType = $(this).attr('data-type');
    //     var getContactItemId = $(this).parents('.accordion-contenttt').attr('id');
    //     if ($('#modal-communication-group-customer-contact-list-selection').length > 0) {
    //         // var index = digibiz.communicationSelectedContactList.findIndex(e => e.id == getid);
    //         // if (index != -1) {
    //         if ($($this).is(':checked')) {
    //             var getRecord = digibiz.communicationSelectedContactList.find((e) => e.id == getid && e.type == getType);
    //             if (getRecord == undefined) {
    //                 digibiz.communicationSelectedContactList.push({
    //                     id: getid,
    //                     type: getType,
    //                     contact_item_id: getContactItemId,
    //                     selected: true
    //                 })
    //             }
    //         } else {
    //             digibiz.communicationSelectedContactList = digibiz.communicationSelectedContactList.filter((o) => o.id != getid)
    //         }

    //         // }
    //         removeLoader();
    //     } else {
    //         removeLoader();
    //     }
    // });

    //(currently used)
    $(document).on('click', '.communication-group-customer-contact-select-btn-checkbox-click-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.communication-group-customer-contact-select-btn-checkbox-click-wrapper').toggleClass('selected-row');
        }
        var getid = $(this).find('.communication-group-customer-contact-select-btn').attr('data-id');
        var getType = $(this).find('.communication-group-customer-contact-select-btn').attr('data-type');
        var getContactItemId = $(this).parents('.accordion-contenttt').attr('id');
        if ($('#modal-communication-group-customer-contact-list-selection').length > 0) {
            // var index = digibiz.communicationSelectedContactList.findIndex(e => e.id == getid);
            // if (index != -1) {
            if ($($this).hasClass('selected-row')) {
                var getRecord = digibiz.communicationSelectedContactList.find((e) => e.id == getid && e.type == getType);
                if (getRecord == undefined) {
                    digibiz.communicationSelectedContactList.push({
                        id: getid,
                        type: getType,
                        contact_item_id: getContactItemId,
                        selected: true
                    })
                }
            } else {
                digibiz.communicationSelectedContactList = digibiz.communicationSelectedContactList.filter((o) => o.id != getid)
            }

            // }
            removeLoader();
        } else {
            removeLoader();
        }
    });

    $(document).on('click', '.collaborator-contact-selection-list-container', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.collaborator-contact-selection-list-container').toggleClass('selected-row');
        }
    });



    //-----> end



    $(document).on('click', '.employee-contact-access-employee-wise-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        var getId = $(this).attr('data-type');
        //console.log("getId", getId);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if ($('#employee-access-show-modal').length > 0) {
            if ($(e.target).is('input:checkbox')) {
                $checkbox.prop('checked', $checkbox.prop('checked')).parents('.employee-contact-access-employee-wise-wrapper').removeClass('selected-row');
            }
        } else {
            if (!$(e.target).is('input:checkbox')) {
                $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-contact-access-employee-wise-wrapper').toggleClass('selected-row');
            }

        }
    });

    $(document).on('click', '.employee-show-access-btn-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        var id = $(this).attr('data-id');
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            console.log('123456');
            var index = digibiz.show_employee_access_list.findIndex(e => e.id == id);
            if (index != -1) {
                if (digibiz.show_employee_access_list[index].revoked) {
                    digibiz.show_employee_access_list[index].revoked = false;
                } else {
                    digibiz.show_employee_access_list[index].revoked = true;
                }
            }
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-show-access-btn-wrapper').toggleClass('selected-row');
        } else {
            console.log('09876tr');
        }
    })

    $(document).on('click', '#employee-access-remove-confirm-btn', function (e) {
        e.stopImmediatePropagation();
        $.each(digibiz.show_employee_access_list, function (index, element) {
            if (element.revoked) {
                var requesParam = {
                    device_id: crossplat.device.uuid,
                    id: element.id
                }
                if (element.access_data_type == "contact") {
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            // digibiz.access_list = [];
                            // $('#employee-contact-add-access-for-employee-contact-employee-wise-selection-modal').remove();
                            removeLoader();
                            $('#modal-close-btn').click();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                } else {
                    groupRevokeAccess(requesParam)
                        .then((resultData) => {
                            // digibiz.access_list = [];
                            // $('#employee-contact-add-access-for-employee-contact-employee-wise-selection-modal').remove();
                            removeLoader();
                            $('#modal-close-btn').click();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                }
            } else {
                $('#modal-close-btn').click();
            }
        })

    })

    $(document).on('click', '.customer-show-access-btn-wrapper', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        var id = $(this).attr('data-id');
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            console.log('123456');
            var index = digibiz.show_customer_access_list.findIndex(e => e.id == id);
            if (index != -1) {
                if (digibiz.show_customer_access_list[index].revoked) {
                    digibiz.show_customer_access_list[index].revoked = false;
                } else {
                    digibiz.show_customer_access_list[index].revoked = true;
                }
            }
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.customer-show-access-btn-wrapper').toggleClass('selected-row');
        } else {
            console.log('09876tr');
        }
    })

    $(document).on('click', '#customer-access-remove-confirm-btn', function (e) {
        e.stopImmediatePropagation();
        $.each(digibiz.show_customer_access_list, function (index, element) {
            if (element.revoked) {
                var requesParam = {
                    device_id: crossplat.device.uuid,
                    id: element.id
                }
                if (element.access_data_type == "contact") {
                    revokeAccess(requesParam)
                        .then((resultData) => {
                            // digibiz.access_list = [];
                            // $('#employee-contact-add-access-for-employee-contact-employee-wise-selection-modal').remove();
                            removeLoader();
                            $('#modal-close-btn').click();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                } else {
                    groupRevokeAccess(requesParam)
                        .then((resultData) => {
                            // digibiz.access_list = [];
                            // $('#employee-contact-add-access-for-employee-contact-employee-wise-selection-modal').remove();
                            removeLoader();
                            $('#modal-close-btn').click();
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(err.msg, 3000, "round error-alert");
                        })
                }
            } else {
                $('#modal-close-btn').click();
            }
        })

    })

    $(document).on('click', '.employee-contact-access-department-list-data', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        var getId = $(this).attr('data-id');
        //console.log("getId", getId);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-contact-access-department-list-data').toggleClass('selected-row');
        }
    });

    $(document).on('click', '.employee-contact-access-custom-group-list-data', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        var getId = $(this).attr('data-id');
        //console.log("getId", getId);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.employee-contact-access-custom-group-list-data').toggleClass('selected-row');
        }
    });

    $(document).on('click', '.identifier-items-list-data', function (e) {
        e.stopImmediatePropagation();
        var $this = $(this);
        var getId = $(this).attr('data-id');
        //console.log("getId", getId);
        let $checkbox = $($this).find('input:checkbox');
        //show tick if checked
        if (!$(e.target).is('input:checkbox')) {
            $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.identifier-items-list-data').toggleClass('selected-row');
        }
    });


    //super-admin add list of employees
    $(document).on('click', '#super_admin_add_button', function () {
        addLoader();
        var getAlreadySuperAdminsAccountIds = [], finalEmployeeList = [];
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "pending_super_admins"
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                //already present super admin + pending super-admins
                var getLength = $('.active-super-admin-list-contentbox').find('.employee-wrapper').length + response.length;
                //console.log("getLength", getLength);
                //put already present super-admin employee ids and pending super-admin employee ids in the array[getAlreadySuperAdminsAccountIds]
                $.each($('.active-super-admin-list-contentbox').find('.employee-wrapper'), function (index, value) {
                    getAlreadySuperAdminsAccountIds.push($(value).attr('data-account-id'));
                })
                $.each(response, function (ind, val) {
                    getAlreadySuperAdminsAccountIds.push(val.contact.user_id);
                })
                if (getLength < 3) {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        list_by: "list_only_active",
                        business_id: sessionStorage.getItem('business_id'),
                        count: 20,
                        offset: 0
                    }
                    employeeList(reqParam)
                        .then((result) => {
                            console.log("employee list", result)
                            $.each(result, function (ind, val) {
                                var getRecord = getAlreadySuperAdminsAccountIds.find((e) => e == val.account_id);
                                if (getRecord == undefined) {
                                    finalEmployeeList.push(val);
                                }
                                if (ind + 1 == result.length) {
                                    //console.log("FInal")
                                    var EmployeeList = {
                                        EmployeeList: finalEmployeeList.map(e => {
                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                    if (e.hasOwnProperty('display_name') && e.display_name) {
                                                        e['imageLetter'] = e.display_name.charAt(0);
                                                    } else {
                                                        e['imageLetter'] = e.name.first.charAt(0);
                                                    }
                                                } else {
                                                    if (e.hasOwnProperty('display_name') && e.display_name) {
                                                        e['imageLetter'] = e.display_name.charAt(0);
                                                    } else {
                                                        e['imageLetter'] = e.name.first.charAt(0);
                                                    }
                                                }
                                            } else {
                                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                                    e['imageLetter'] = e.display_name.charAt(0);
                                                } else {
                                                    e['imageLetter'] = e.name.first.charAt(0);
                                                }
                                            }
                                            return e;
                                        })
                                    }
                                    //console.log("EmployeeList", EmployeeList)
                                    fetch.getHtml(function (fetcherror, html) {
                                        var modal_data = {
                                            modal_id: "modal-super-admin-add-employee-selection",
                                            modal_header: "Employee List",
                                            modal_platform: crossplat.device.platform,
                                            modal_body: html,
                                            modal_action_buttons: [{
                                                "name": "Add",
                                                "id": "add-selected-employees-super-admin",
                                            }]
                                        }
                                        showModal(modal_data, function () {
                                            //console.log("123")
                                            //add search element                                            
                                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                if ($('.modal-popup-content').length > 0) {
                                                    appScroll.scrollBar('.modal-popup-content');
                                                }
                                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            } else {
                                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                                            }
                                            setTimeout(function () {
                                                //console.log("$$$$")
                                                $('.employee-selection-member-list').prepend(`<div class="search">
                                                        <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                            <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                            <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                                        </div>
                                                    </div>`);
                                                removeLoader();
                                                var element22 = $('#employee-list-selection-search-btn').find('.expand-search-input');
                                                if (element22) {
                                                    //console.log('element22', element22);
                                                    //if element is there
                                                    $(document).on('input', element22, function () {
                                                        //on input set attribute socketid 
                                                        timestamp = (new Date()).getTime();
                                                        element22.attr("socketid", timestamp);
                                                    });
                                                    // element.addEventListener("keyup", function (e) {
                                                    $(document).on('keyup', element22, function () {
                                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                                        //console.log("not has class")
                                                        // on keyup get attribute 
                                                        socketid = element22.attr("socketid");
                                                        keyword = element22.val();
                                                        if (socketid && keyword) {
                                                            //if socketid attribute and keyword is there
                                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                            currentroute = $("body").attr('app');
                                                            data = {
                                                                room: crossplat.device.uuid,
                                                                socketid,
                                                                app: 'digibiz',
                                                                keyword
                                                            };
                                                            switch (currentroute) {
                                                                case 'super_admin_management_hub':
                                                                    if ($('#modal-super-admin-add-employee-selection').length > 0) {
                                                                        data['index'] = 'getEmployeeContactListAllEmployees';
                                                                        data['business_id'] = sessionStorage.getItem('business_id')
                                                                    }
                                                                    break;
                                                                default:
                                                                    break;
                                                            }
                                                            addLoader();
                                                            //console.log("search emit", data);
                                                            sockets.searchSocket.emit('search', data);
                                                            setTimeout(() => {
                                                                removeLoader();
                                                            }, 300);
                                                        } else {
                                                            //console.log("going to else part111")
                                                            //else show default list
                                                            removeLoader();
                                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                            currentroute = $("body").attr('app');
                                                            // element.removeAttribute("socketid");
                                                            element22.attr("socketid", "");
                                                            switch (currentroute) {
                                                                case 'super_admin_management_hub':
                                                                    if ($('#modal-super-admin-add-employee-selection').length > 0) {
                                                                        processSearchedEmployeeSelectionList(finalEmployeeList, function () { })
                                                                    }
                                                                    break;
                                                                default:
                                                                    break;
                                                            }

                                                        }
                                                    });
                                                    $(document).on('click', '.searchclosebtn', function () {
                                                        if ($('#modal-super-admin-add-employee-selection').length > 0) {
                                                            processSearchedEmployeeSelectionList(finalEmployeeList, function () { })
                                                        }
                                                    })
                                                }
                                            }, 100);
                                            // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                            //     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            //     if ($('.modal-popup-content').length > 0) {
                                            //         //console.log("scroll initiated for modal pop-up class")
                                            //         appScroll.scrollBar('.modal-popup-content');
                                            //     }
                                            // } else {
                                            //     $('.custom-modal-popup').show().addClass('modal-slide-top');
                                            // }
                                            // removeLoader();
                                        });
                                    }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);
                                }
                            })
                        })
                        .catch((err) => {
                            console.log('1122', err);
                            removeLoader();
                            Materialize.toast(`No Employees found.`, 3000, 'round success-alert');
                        })
                } else {
                    removeLoader();
                    Materialize.toast(`Maximum super admins reached.`, 3000, 'round success-alert');
                }
            })
            .catch((err) => {
                //already present super admin
                var getLength = $('.active-super-admin-list-contentbox').find('.employee-wrapper').length;
                //console.log("getLength", getLength);
                $.each($('.active-super-admin-list-contentbox').find('.employee-wrapper'), function (index, value) {
                    getAlreadySuperAdminsAccountIds.push($(value).attr('data-account-id'));
                })
                if (getLength < 3) {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        list_by: "list_only_active",
                        business_id: sessionStorage.getItem('business_id'),
                        count: 20,
                        offset: 0
                    }
                    employeeList(reqParam)
                        .then((result) => {
                            console.log('emppp', result);
                            $.each(result, function (ind, val) {
                                var getRecord = getAlreadySuperAdminsAccountIds.find((e) => e == val.account_id);
                                if (getRecord == undefined) {
                                    finalEmployeeList.push(val);
                                }
                                if (ind + 1 == result.length) {
                                    var EmployeeList = {
                                        EmployeeList: finalEmployeeList.map(e => {
                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                    if (e.hasOwnProperty('display_name') && e.display_name) {
                                                        e['imageLetter'] = e.display_name.charAt(0);
                                                    } else {
                                                        e['imageLetter'] = e.name.first.charAt(0);
                                                    }
                                                } else {
                                                    if (e.hasOwnProperty('display_name') && e.display_name) {
                                                        e['imageLetter'] = e.display_name.charAt(0);
                                                    } else {
                                                        e['imageLetter'] = e.name.first.charAt(0);
                                                    }
                                                }
                                            } else {
                                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                                    e['imageLetter'] = e.display_name.charAt(0);
                                                } else {
                                                    e['imageLetter'] = e.name.first.charAt(0);
                                                }
                                            }
                                            return e;
                                        })
                                    }
                                    fetch.getHtml(function (fetcherror, html) {
                                        var modal_data = {
                                            modal_id: "modal-super-admin-add-employee-selection",
                                            modal_header: "Employee List",
                                            modal_platform: crossplat.device.platform,
                                            modal_body: html,
                                            modal_action_buttons: [{
                                                "name": "Add",
                                                "id": "add-selected-employees-super-admin",
                                            }]
                                        }
                                        showModal(modal_data, function () {
                                            //console.log("123")
                                            //add search element                                            
                                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                if ($('.modal-popup-content').length > 0) {
                                                    appScroll.scrollBar('.modal-popup-content');
                                                }
                                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            } else {
                                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                                            }
                                            setTimeout(function () {
                                                //console.log("$$$$")
                                                $('.employee-selection-member-list').prepend(`<div class="search">
                                                        <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                                            <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>    
                                                            <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                            <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                                        </div>
                                                    </div>`);
                                                removeLoader();
                                                var element22 = $('#employee-list-selection-search-btn').find('.expand-search-input');
                                                if (element22) {
                                                    //console.log('element22', element22);
                                                    //if element is there
                                                    $(document).on('input', element22, function () {
                                                        //on input set attribute socketid 
                                                        timestamp = (new Date()).getTime();
                                                        element22.attr("socketid", timestamp);
                                                    });
                                                    // element.addEventListener("keyup", function (e) {
                                                    $(document).on('keyup', element22, function () {
                                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                                        //console.log("not has class")
                                                        // on keyup get attribute 
                                                        socketid = element22.attr("socketid");
                                                        keyword = element22.val();
                                                        if (socketid && keyword) {
                                                            //if socketid attribute and keyword is there
                                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                            currentroute = $("body").attr('app');
                                                            data = {
                                                                room: crossplat.device.uuid,
                                                                socketid,
                                                                app: 'digibiz',
                                                                keyword
                                                            };
                                                            switch (currentroute) {
                                                                case 'super_admin_management_hub':
                                                                    if ($('#modal-super-admin-add-employee-selection').length > 0) {
                                                                        data['index'] = 'getEmployeeContactListAllEmployees';
                                                                        data['business_id'] = sessionStorage.getItem('business_id')
                                                                    }
                                                                    break;
                                                                default:
                                                                    break;
                                                            }
                                                            addLoader();
                                                            //console.log("search emit", data);
                                                            sockets.searchSocket.emit('search', data);
                                                            setTimeout(() => {
                                                                removeLoader();
                                                            }, 300);
                                                        } else {
                                                            //console.log("going to else part111")
                                                            //else show default list
                                                            removeLoader();
                                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                            currentroute = $("body").attr('app');
                                                            // element.removeAttribute("socketid");
                                                            element22.attr("socketid", "");
                                                            switch (currentroute) {
                                                                case 'super_admin_management_hub':
                                                                    if ($('#modal-super-admin-add-employee-selection').length > 0) {
                                                                        processSearchedEmployeeSelectionList(finalEmployeeList, function () { })
                                                                    }
                                                                    break;
                                                                default:
                                                                    break;
                                                            }

                                                        }
                                                    });
                                                    $(document).on('click', '.searchclosebtn', function () {
                                                        if ($('#modal-super-admin-add-employee-selection').length > 0) {
                                                            processSearchedEmployeeSelectionList(finalEmployeeList, function () { })
                                                        }
                                                    })
                                                }
                                            }, 100);
                                            // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                            //     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            //     if ($('.modal-popup-content').length > 0) {
                                            //         //console.log("scroll initiated for modal pop-up class")
                                            //         appScroll.scrollBar('.modal-popup-content');
                                            //     }
                                            // } else {
                                            //     $('.custom-modal-popup').show().addClass('modal-slide-top');
                                            // }
                                            // removeLoader();
                                        });
                                    }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);
                                }
                            })
                        })
                        .catch((err) => {
                            console.log('45678', err);
                            removeLoader();
                            Materialize.toast(`No Employees found.`, 3000, 'round success-alert');
                        })
                } else {
                    removeLoader();
                    Materialize.toast(`Maximum super admins reached.`, 3000, 'round success-alert');
                }
            })
    });

    //send notification to selected employees for super-admin
    $(document).on('click', '#add-selected-employees-super-admin', function () {
        addLoader();
        var data_type = "employee_list";
        var getSelectedAccountId = $('.employee-select-btn-wrapper.selected-row').find('.employee-select-btn').attr('data-account-id');
        //console.log("data_type", data_type);
        if ($('.employee-select-btn-wrapper.selected-row').length > 0) {
            if (data_type == null || data_type == undefined || data_type == "") {
                removeLoader();
                Materialize.toast(`Please enter data`, 3000, 'round success-alert');
            } else {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    data_type: data_type,
                    add_type: "add",
                    type: "super_admin",
                    business_id: sessionStorage.getItem('business_id'),
                    id: getSelectedAccountId,
                }
                notificationAdd(reqParam)
                    .then((response) => {
                        //console.log("notificationAdd response", response);
                        Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                        $('#modal-super-admin-add-employee-selection').remove();
                        removeLoader();
                    })
                    .catch((err) => {
                        //console.log("notificationAdd error", err);
                        Materialize.toast(err.msg, 3000, 'round success-alert');
                        removeLoader();
                    });
            }
        } else {
            removeLoader();
            Materialize.toast(`Please select a employee.`, 3000, 'round success-alert');
        }
    });

    $(document).on('click', '#employee-business-list-more-icon', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        var getBusinessId = $(this).parents('.employee-business-wrapper').attr('data-business-id');
        var getEmployeeId = $(this).parents('.employee-business-wrapper').attr('data-employee-id');
        var action_sheet_parms = {
            action_id: "employee_business_list_more_icon_action",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Business Profile",
                attr: [{ name: "class", value: "business_profile_slider_btn" }]
            },
            {
                name: "Employee Profile",
                attr: [{ name: "class", value: "employee_profile_slider_btn" }]
            },
                // {
                //     name: "Employee QR code",
                //     attr: [{ name: "id", value: "show-qr" }]
                // }
            ]
        }
        showAction(action_sheet_parms, function () {
            $('#employee_business_list_more_icon_action').attr('data-business-id', getBusinessId);
            $('#employee_business_list_more_icon_action').attr('data-employee-id', getEmployeeId);
            if ($('#employee_business_list_more_icon_action').length > 1) {
                $('#employee_business_list_more_icon_action:last').remove();
            }
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
        });
    });

    $(document).on('click', '#customer-business-list-more-icon', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        var getBusinessID = $(this).parents('.employee-business-wrapper').attr('data-business-id');
        var getType = $(this).parents('.employee-business-wrapper').attr('data-customer-type');
        var getId = $(this).parents('.employee-business-wrapper').attr('data-customer-id');
        var action_sheet_parms = {
            action_id: "employee_business_list_more_icon_action",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Business Profile",
                attr: [{ name: "class", value: "business_profile_slider_btn" }]
            },
            {
                name: "Customer Profile",
                attr: [{ name: "class", value: "customer_profile_slider_btn" }]
            },
            {
                name: "Exit",
                attr: [{ name: "id", value: "customer-exit-icon" }]
            }
            ]
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $('#employee_business_list_more_icon_action').attr('data-id', getId);
            $('#employee_business_list_more_icon_action').attr('data-type', getType);
            $('#employee_business_list_more_icon_action').attr('data-business-id', getBusinessID);
        });
    });

    $(document).on('click', '#hub_settings_btn', function () {
        location.hash = `prospect/settings`;
    });

    // $(document).on('click', '#hub_scanner_btn', function () {

    // });


    //JEEVI ACCOUNT
    $(document).on('click', '.jeevi-account-active-inactive-settings', function () {
        addLoader();
        var getAccountId = sessionStorage.getItem('account_id');
        // var getUUid = sessionStorage.getItem('uuid');
        var reqParam = {
            device_id: crossplat.device.uuid,
            get_by: "account_id",
            account_id: getAccountId
        }
        getJeeviAccount(reqParam)
            .then((response) => {
                //console.log("response", response)
                if (response.account_id == getAccountId) {
                    //console.log("match")
                    sessionStorage.setItem('jeevi_status', response.status.status);
                    var getData = {
                        jeevi_account_status: response.status.status,
                        account_settings: response.settings
                    }
                    //console.log("getData", getData);
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "jeevi-account-inactive-active-settings",
                            modal_header: "Active/Inactive",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Save",
                                "id": "add-jeevi-account-inactive-data",
                            }]
                        }
                        showModal(modal_data, function () {
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            if (getData.jeevi_account_status == "inactive" || getData.jeevi_account_status == "inactive_pending") {
                                $('.account-inactive-start-end-date-time').removeClass('hide');
                            }
                            settingCalenderInit('#start-date');
                            settingCalenderInit('#end-date');
                            timepickInit('#start-time');
                            timepickInit('#end-time');
                            removeLoader();
                        });
                    }, 'page/common/active_inactive_jeevi_account', '#active_inactive_jeevi_account-template', getData);
                } else {
                    //console.log("Jeevi account Id")
                }
            })
            .catch((err) => {
                removeLoader();
            });
    });

    //jeevi account inactivate
    $(document).on('click', '#checkbox-toggle-inactivate-jeevi-account', function (e) {
        let getData = $('#checkbox-toggle-inactivate-jeevi-account').is(':checked');
        if (getData == true) {
            var action_sheet_parms = {
                action_id: "inactivate-jeevi-account-at",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Inactivate Now",
                    attr: [{ name: "id", value: "jeevi_account_inactivate_now" }]
                },
                {
                    name: "Inactivate Schedule",
                    attr: [{ name: "id", value: "jeevi_account_inactivate_schedule" }]
                }
                ]
            }
            showAction(action_sheet_parms, function () {
                $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                $('#inactivate-jeevi-account-at').find('.action-sheet-cancel-btn').addClass('hide');
            });
        } else {
            $('#jeevi-account-inactive-active-settings').removeAttr('account_inactivate_at');
            $('#inactivate-jeevi-account-at').remove();
            $('.account-inactive-start-date-time').addClass('hide');
            $('.account-inactive-end-date-time').addClass('hide');
            $('.account-inactive-start-end-date-time').addClass('hide');
        }
    });

    //jeevi account inactivate now
    $(document).on('click', '#jeevi_account_inactivate_now', function (e) {
        $('#jeevi-account-inactive-active-settings').attr('account_inactivate_at', 'now')
        let getData = $('#checkbox-toggle-inactivate-jeevi-account').is(':checked');
        if (getData == true) {
            $('#inactivate-jeevi-account-at').remove();
            $('.account-inactive-start-end-date-time').removeClass('hide');
            $('.account-inactive-start-date-time').addClass('hide');
            $('.account-inactive-end-date-time').removeClass('hide');
            $('#start-date').val("");
            $('#start-time').val("");
            $('#end-date').val("");
            $('#end-time').val("");
            removeError($('#start-date'));
            removeError($('#start-time'));
            removeError($('#end-date'));
            removeError($('#end-time'));
        } else {
            $('#inactivate-jeevi-account-at').remove();
            $('.account-inactive-start-end-date-time').addClass('hide');
        }
    });

    //jeevi account inactivate schedule
    $(document).on('click', '#jeevi_account_inactivate_schedule', function (e) {
        $('#jeevi-account-inactive-active-settings').attr('account_inactivate_at', 'schedule')
        let getData = $('#checkbox-toggle-inactivate-jeevi-account').is(':checked');
        if (getData == true) {
            $('#inactivate-jeevi-account-at').remove();
            $('.account-inactive-start-end-date-time').removeClass('hide');
            $('.account-inactive-start-date-time').removeClass('hide');
            $('.account-inactive-end-date-time').removeClass('hide');
            $('#start-date').val("");
            $('#start-time').val("");
            $('#end-date').val("");
            $('#end-time').val("");
            removeError($('#start-date'));
            removeError($('#start-time'));
            removeError($('#end-date'));
            removeError($('#end-time'));
        } else {
            $('#inactivate-jeevi-account-at').remove();
            $('.account-inactive-start-end-date-time').addClass('hide');
        }
    });

    //jeevi account inactivate/activate modal save button click event
    $(document).on('click', '#add-jeevi-account-inactive-data', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        //console.log("click")
        if (sessionStorage.getItem('jeevi_status') == "active") {
            //console.log("active");
            let getData = $('#checkbox-toggle-inactivate-jeevi-account').is(':checked');
            if (getData == true) {
                var getType = $('#jeevi-account-inactive-active-settings').attr('account_inactivate_at');
                if (validateSettingData(getType)) {
                    //console.log("validation successfull");
                    var alert_parms = {
                        alert_id: "alert-confirm-transactional-password",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Transactional Password",
                        alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                        alert_btn: [{
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-jeevi-account-inactivate-activate-transaction-cancel" }]
                        },
                        {
                            name: "Confirm",
                            attr: [{ name: "id", value: "btn-jeevi-account-inactivate-activate-transaction-confirm" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-confirm-transactional-password').attr('account_inactivate_at', getType);
                        // if ($('#alert-confirm-transactional-password').length > 1) {
                        //     $('#alert-confirm-transactional-password:last').remove();
                        // }
                        if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                            $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                        }
                        removeLoader();
                    });
                } else {
                    removeLoader();
                    //console.log("error! please check the data entered");
                }
            } else {//activate
                Materialize.toast(`No data to save.`, 3000, 'round error-alert');
                //console.log("activate");
                removeLoader();
            }
        } else if (sessionStorage.getItem('jeevi_status') == "inactive_pending") {
            //console.log("123");
            let getActivateData = $('#checkbox-toggle-activate-jeevi-account').is(':checked');
            //console.log("getActivateData", getActivateData);
            if (getActivateData == true) {//changed to activated
                var alert_parms = {
                    alert_id: "alert-confirm-transactional-password",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Transactional Password",
                    alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                    alert_btn: [{
                        name: "Cancel",
                        attr: [{ name: "id", value: "btn-jeevi-account-inactivate-activate-transaction-cancel" }]
                    },
                    {
                        name: "Confirm",
                        attr: [{ name: "id", value: "btn-jeevi-account-inactivate-activate-transaction-confirm" }]
                    }
                    ]
                }
                showAlert(alert_parms, function () {
                    //console.log("$('#alert-confirm-transactional-password').length", $('#alert-confirm-transactional-password').length)
                    // if ($('#alert-confirm-transactional-password').length > 1) {
                    //     $('#alert-confirm-transactional-password:last').remove();
                    // }
                    if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                        $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                    }
                    removeLoader();
                });
            } else {//not-changed to active/not changed anything
                // $('#account-inactive-active-settings').remove();
                Materialize.toast(`No data to save.`, 3000, 'round error-alert');
                removeLoader();
            }
        } else if (sessionStorage.getItem('jeevi_status') == "inactive") {
            var alert_parms = {
                alert_id: "alert-confirm-transactional-password",
                alert_platform: crossplat.device.platform,
                alert_title: "Transactional Password",
                alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                alert_btn: [{
                    name: "Cancel",
                    attr: [{ name: "id", value: "btn-jeevi-account-inactivate-activate-transaction-cancel" }]
                },
                {
                    name: "Confirm",
                    attr: [{ name: "id", value: "btn-jeevi-account-inactivate-activate-transaction-confirm" }]
                }
                ]
            }
            showAlert(alert_parms, function () {
                //console.log("$('#alert-confirm-transactional-password').length", $('#alert-confirm-transactional-password').length)
                // if ($('#alert-confirm-transactional-password').length > 1) {
                //     $('#alert-confirm-transactional-password:last').remove();
                // }
                if ($(`.custom-modal[id="alert-confirm-transactional-password"]`).length > 1) {
                    $(`.custom-modal[id="alert-confirm-transactional-password"]:last`).remove();
                }
                removeLoader();
            });
        } else {
            //console.log("else");
            removeLoader();
        }
    });

    //cancel button in jeevi account inactivate/activate transactional alert pop-up
    $(document).on('click', '#btn-jeevi-account-inactivate-activate-transaction-cancel', function () {
        removeLoader();
        $('#alert-confirm-transactional-password').remove();
    });

    //confirm button in jeevi account inactivate/activate transactional alert pop-up
    $(document).on('click', '#btn-jeevi-account-inactivate-activate-transaction-confirm', function () {
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Jeevi Account inactivate"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    //console.log("account_status11", sessionStorage.getItem('jeevi_status'));
                    if (sessionStorage.getItem('jeevi_status') == "active") {
                        var account_inactivate_at = $('#alert-confirm-transactional-password').attr('account_inactivate_at');
                        // var startDate = $("#start-date").val();
                        // //console.log("startDate", startDate);
                        var getStartDate = $('#start-date').val();
                        var getStartDate1 = getStartDate.split('/')[0];
                        //console.log("getStartDate1", getStartDate1);
                        var getStartMonth2 = getStartDate.split('/')[1];
                        //console.log("getStartMonth2", getStartMonth2);
                        var getStartYear3 = getStartDate.split('/')[2];
                        //console.log("getStartYear3", getStartYear3);
                        let startDate = getStartYear3 + '/' + getStartMonth2 + '/' + getStartDate1;
                        let startDateForStorage = getStartDate1 + '/' + getStartMonth2 + '/' + getStartYear3;
                        //console.log("startDate", startDate);
                        var startTimeValue = $('#start-time').val();
                        //console.log("startTimeValue", startTimeValue);
                        var beginSurvey;
                        if (startTimeValue) {
                            var startTime = timeConvertor(startTimeValue);
                            beginSurvey = moment(startDate + ' ' + startTime, 'YYYY-MM-DDHH:mm:ss').unix();
                            //console.log("beginSurvey", beginSurvey);
                        }
                        var getEndDate = $('#end-date').val();
                        var getEndDate1 = getEndDate.split('/')[0];
                        //console.log("getEndDate1", getEndDate1);
                        var getEndMonth2 = getEndDate.split('/')[1];
                        //console.log("getEndMonth2", getEndMonth2);
                        var getEndYear3 = getEndDate.split('/')[2];
                        //console.log("getEndYear3", getEndYear3);
                        var endDate = getEndYear3 + '/' + getEndMonth2 + '/' + getEndDate1;
                        var endDateForStorage = getEndDate1 + '/' + getEndMonth2 + '/' + getEndYear3;
                        var endTimeValue = $('#end-time').val();
                        var endTime = timeConvertor(endTimeValue);
                        var endSurvey = moment(endDate + ' ' + endTime, 'YYYY-MM-DDHH:mm:ss').unix();
                        var status, data_object;
                        if (account_inactivate_at == "now") {
                            status = "inactive";
                            data_object = {
                                "status": status,
                                "settings": {
                                    "inactivate_at": account_inactivate_at,
                                    "end_date": endDateForStorage,
                                    "end_time": endTimeValue,
                                    "end": endSurvey
                                }
                            }
                        } else {
                            status = "inactive_pending";
                            data_object = {
                                "status": status,
                                "settings": {
                                    "inactivate_at": account_inactivate_at,
                                    "start_date": startDateForStorage,
                                    "start_time": startTimeValue,
                                    "start": beginSurvey,
                                    "end_date": endDateForStorage,
                                    "end_time": endTimeValue,
                                    "end": endSurvey
                                }
                            }
                        }
                        var reqparams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('account_id'),
                            data: data_object
                        }
                        jeeviAccountSettings(reqparams)
                            .then((response) => {
                                console.log('response', response, status);
                                sessionStorage.removeItem('jeevi_status');
                                $('#alert-confirm-transactional-password').remove();
                                $('#jeevi-account-inactive-active-settings').remove();
                                if (account_inactivate_at == "now") {
                                    // sessionStorage.clear();
                                    // setTimeout(function () {
                                    //     deviceHelper.navigateToAccounts('core');
                                    // }, 1000);
                                    // location.hash = `jeevi/app/hub`;
                                    console.log('fwefwef');
                                    sessionStorage.removeItem('jeevi_id');
                                    sessionStorage.removeItem('jeevi_status');
                                    var getAccountDetails = JSON.parse(sessionStorage.getItem('accountDetails'));
                                    //console.log("getAccountDetails", getAccountDetails);
                                    getAccountDetails.roles.prospect = "inactive";
                                    //console.log("final getAccountDetails", getAccountDetails);
                                    window.sessionStorage.setItem('accountDetails', JSON.stringify(getAccountDetails));
                                    // location.hash = `jeevi/app/hub`;
                                    console.log('fwefwef');
                                    if ($('body').attr('app') == "jeevi_app_hub_page") {
                                        //console.log("1")
                                        Materialize.toast(`Successfully Inactivated Jeevi Account.`, 3000, 'round success-alert');
                                        $('.prospect-app-hub-page-wrapper').remove();
                                        jeeviAppHubPage();
                                    } else if ($('body').attr('app') == "prospect_settings") {
                                        //console.log("2")
                                        location.hash = `jeevi/app/hub`;
                                        console.log('fwefwef');
                                    }
                                    Materialize.toast(`Successfully Inactivated Jeevi Account.`, 3000, 'round success-alert');
                                } else {
                                    Materialize.toast(`Successfully Scheduled Jeevi Inactivate.`, 3000, 'round success-alert');
                                }
                                removeLoader();
                            })
                            .catch((err) => {
                                $('#alert-confirm-transactional-password').remove();
                                $('#jeevi-account-inactive-active-settings').remove();
                                removeLoader();
                            })
                    } else if (sessionStorage.getItem('jeevi_status') == "inactive_pending") {
                        let getActivateData = $('#checkbox-toggle-activate-jeevi-account').is(':checked');
                        if (getActivateData == true) {//changed to activated
                            var reqparams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('account_id'),
                                data: {
                                    "status": "active",
                                }
                            }
                            jeeviAccountSettings(reqparams)
                                .then((response) => {
                                    $('#alert-confirm-transactional-password').remove();
                                    $('#jeevi-account-inactive-active-settings').remove();
                                    sessionStorage.removeItem('jeevi_id');
                                    sessionStorage.removeItem('jeevi_status');
                                    // sessionStorage.clear();
                                    // location.reload();
                                    if ($('body').attr('app') == "jeevi_app_hub_page") {
                                        var data = {
                                            jeevi_role_status: true
                                        };
                                        //console.log("data", data);
                                        fetch.replaceHtml(function () {
                                            var slider = new Swiper('.hubSwiper', {
                                                slidesPerView: 1,
                                                spaceBetween: 0,
                                                grabCursor: true,
                                                observer: true,
                                                pagination: {
                                                    el: '.swiper-pagination',
                                                    clickable: true,
                                                }
                                            });
                                            $(".swiper").removeClass("hubSwiper");
                                        }, "page/prospect/app_hub", "#prospect-app-hub-page-template", "#digibiz-home-page-middle-band-wrapper", data);
                                    } else {
                                        $('#jeevi-account-not-present').remove();
                                        $('#jeevi-account-inactive').remove();
                                        $('#jeevi-account-inactive-active-settings').remove();
                                        $('#alert-confirm-transactional-password').remove();
                                    }
                                    Materialize.toast(`Successfully Activated Jeevi Account.`, 3000, 'round success-alert');
                                    removeLoader();
                                })
                                .catch((err) => {
                                    //console.log("error");
                                    removeLoader();
                                })
                        } else {//not-changed to active/not changed anything
                            $('#alert-confirm-transactional-password').remove();
                            $('#jeevi-account-inactive-active-settings').remove();
                            removeLoader();
                        }
                    } else if (sessionStorage.getItem('jeevi_status') == "inactive") {
                        var reqparams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('account_id'),
                            data: {
                                "status": "active",
                            }
                        }
                        jeeviAccountSettings(reqparams)
                            .then((response) => {
                                $('#alert-confirm-transactional-password').remove();
                                $('#jeevi-account-inactive-active-settings').remove();
                                sessionStorage.removeItem('jeevi_id');
                                sessionStorage.removeItem('jeevi_status');
                                // sessionStorage.clear();
                                // location.reload();
                                var getAccountDetails = JSON.parse(sessionStorage.getItem('accountDetails'));
                                //console.log("getAccountDetails", getAccountDetails);
                                getAccountDetails.roles.prospect = "active";
                                //console.log("final getAccountDetails", getAccountDetails);
                                window.sessionStorage.setItem('accountDetails', JSON.stringify(getAccountDetails));
                                // location.hash = `jeevi/app/hub`;
                                console.log('fwefwef');
                                if ($('body').attr('app') == "jeevi_app_hub_page") {
                                    var data = {
                                        jeevi_role_status: true
                                    };
                                    //console.log("data", data);
                                    fetch.replaceHtml(function () {
                                        var slider = new Swiper('.hubSwiper', {
                                            slidesPerView: 1,
                                            spaceBetween: 0,
                                            grabCursor: true,
                                            observer: true,
                                            pagination: {
                                                el: '.swiper-pagination',
                                                clickable: true,
                                            }
                                        });
                                        $(".swiper").removeClass("hubSwiper");
                                    }, "page/prospect/app_hub", "#prospect-app-hub-page-template", "#digibiz-home-page-middle-band-wrapper", data);
                                } else {
                                    $('#jeevi-account-not-present').remove();
                                    $('#jeevi-account-inactive').remove();
                                    $('#jeevi-account-inactive-active-settings').remove();
                                    $('#alert-confirm-transactional-password').remove();
                                }
                                Materialize.toast(`Successfully activated Jeevi Account.`, 3000, 'round success-alert');
                                removeLoader();
                            })
                            .catch((err) => {
                                //console.log("error");
                                removeLoader();
                            })
                    } else {
                        removeLoader();
                        //console.log("else");
                    }
                })
                .catch((err) => {
                    // $(this).attr('disabled', false);
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    });

    $(document).on('click', '#prospect_settings_back_btn', function () {
        addLoader();
        // location.hash = `prospect/app/hub`;
        location.hash = `jeevi/app/hub`;
        console.log('fwefwef');
    });


    //jeevi account delete
    $(document).on('click', '.jeevi-account-delete', function () {
        addLoader();
        var getAccountId = sessionStorage.getItem('account_id');
        var alert_parms = {
            alert_id: "alert-jeevi-account-delete-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete account`,
            alert_body: `Are you sure you want to delete the jeevi account?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-jeevi-account-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-jeevi-account-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-jeevi-account-delete-confirm-cancel').attr('data-account-id', getAccountId); //set getBusinessId
        });
    });

    //Delete no
    $(document).on('click', '#btn-delete-jeevi-account-cancel-no', function () {
        $('#alert-jeevi-account-delete-confirm-cancel').remove();
    });

    //Delete yes
    $(document).on('click', '#btn-delete-jeevi-account-confirm-yes', function () {
        addLoader();
        var getAccountId = $('#alert-jeevi-account-delete-confirm-cancel').attr('data-account-id');
        var requestParam = {
            id: getAccountId
        }
        checkCanAccountDelete(requestParam)
            .then((response) => {
                // console.log("checkCanDeleteDigibizAccount Response", response);
                if (response.employee_role_status > 0 || response.customer_role_status > 0 || response.business_admin_role_status > 0) {//min 1 active role is present, so dont delete digibiz account
                    $('#alert-jeevi-account-delete-confirm-cancel').remove();
                    var alert_parms = {
                        alert_id: "alert-confirm-transactional-password",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Transactional Password",
                        alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
                        alert_btn: [{
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-jeevi-account-delete-transaction-cancel" }]
                        },
                        {
                            name: "Confirm",
                            attr: [{ name: "id", value: "btn-jeevi-account-delete-transaction-confirm" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-confirm-transactional-password').attr('data-account-id', getAccountId)
                        removeLoader();
                    });
                } else {//min 1 active role is not present, so delete digibiz account
                    var alert_parms = {
                        alert_id: "alert-no-role-active-delete-digibiz-account",
                        alert_platform: crossplat.device.platform,
                        alert_title: "Delete Digibiz Account",
                        alert_body: `Since no other role is active, digibiz account will be deleted. Are you sure you want to delete digibiz account?`,
                        alert_btn: [{
                            name: "Cancel",
                            attr: [{ name: "id", value: "btn-automatic-digibiz-account-delete-cancel" }]
                        },
                        {
                            name: "Confirm",
                            attr: [{ name: "id", value: "btn-automatic-digibiz-account-delete-confirm" }]
                        }
                        ]
                    }
                    showAlert(alert_parms, function () {
                        $('#alert-jeevi-account-delete-confirm-cancel').remove();
                        $('#alert-no-role-active-delete-digibiz-account').attr('data-account-id', getAccountId)
                        removeLoader();
                    });
                }
            })
            .catch((err) => {
                removeLoader();
                //console.log("account not got");
            })
    });
    // $(document).on('click', '#btn-delete-jeevi-account-confirm-yes', function () {
    //     addLoader();
    //     var getAccountId = $('#alert-jeevi-account-delete-confirm-cancel').attr('data-account-id');
    //     var requestParam = {
    //         device_id: crossplat.device.uuid,
    //         uuid: sessionStorage.getItem('uuid')
    //     }
    //     getDigibizAccount(requestParam)
    //         .then((response) => {
    //             if (response.hasOwnProperty('roles') && response.roles) {
    //                 var checkRole = validateMinOneRoleActiveJeeviDelete(response.roles);
    //                 //console.log("checkRole", checkRole);
    //                 if (checkRole) {//true ==> min 1 active role is present, so dont delete digibiz account
    //                     $('#alert-jeevi-account-delete-confirm-cancel').remove();
    //                     var alert_parms = {
    //                         alert_id: "alert-confirm-transactional-password",
    //                         alert_platform: crossplat.device.platform,
    //                         alert_title: "Transactional Password",
    //                         alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
    //                         alert_btn: [{
    //                             name: "Cancel",
    //                             attr: [{ name: "id", value: "btn-jeevi-account-delete-transaction-cancel" }]
    //                         },
    //                         {
    //                             name: "Confirm",
    //                             attr: [{ name: "id", value: "btn-jeevi-account-delete-transaction-confirm" }]
    //                         }
    //                         ]
    //                     }
    //                     showAlert(alert_parms, function () {
    //                         $('#alert-confirm-transactional-password').attr('data-account-id', getAccountId)
    //                         removeLoader();
    //                     });
    //                 } else {//false ==>  min 1 active role is not present, so delete digibiz account
    //                     $('#alert-jeevi-account-delete-confirm-cancel').remove();
    //                     var alert_parms = {
    //                         alert_id: "alert-no-role-active-delete-digibiz-account",
    //                         alert_platform: crossplat.device.platform,
    //                         alert_title: "Delete Digibiz Account",
    //                         alert_body: `Since no other role is active, digibiz account will be deleted. Are you sure you want to delete digibiz account?`,
    //                         alert_btn: [{
    //                             name: "Cancel",
    //                             attr: [{ name: "id", value: "btn-automatic-digibiz-account-delete-cancel" }]
    //                         },
    //                         {
    //                             name: "Confirm",
    //                             attr: [{ name: "id", value: "btn-automatic-digibiz-account-delete-confirm" }]
    //                         }
    //                         ]
    //                     }
    //                     showAlert(alert_parms, function () {
    //                         $('#alert-no-role-active-delete-digibiz-account').attr('data-account-id', getAccountId)
    //                         removeLoader();
    //                     });
    //                 }
    //             } else {
    //                 removeLoader();
    //                 //console.log("no roles object in the response");
    //             }
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("account not got");
    //         })
    // });
    // $(document).on('click', '#btn-delete-jeevi-account-confirm-yes', function () {
    //     addLoader();
    //     var getAccountId = $('#alert-jeevi-account-delete-confirm-cancel').attr('data-account-id');
    //     $('#alert-jeevi-account-delete-confirm-cancel').remove();
    //     var alert_parms = {
    //         alert_id: "alert-confirm-transactional-password",
    //         alert_platform: crossplat.device.platform,
    //         alert_title: "Transactional Password",
    //         alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
    //         alert_btn: [{
    //             name: "Cancel",
    //             attr: [{ name: "id", value: "btn-jeevi-account-delete-transaction-cancel" }]
    //         },
    //         {
    //             name: "Confirm",
    //             attr: [{ name: "id", value: "btn-jeevi-account-delete-transaction-confirm" }]
    //         }
    //         ]
    //     }
    //     showAlert(alert_parms, function () {
    //         //to remove the alert box if 2 times it gets added
    //         if ($('#alert-confirm-transactional-password').length > 1) {
    //             $('#alert-confirm-transactional-password:last').remove();
    //         }
    //         $('#alert-confirm-transactional-password').attr('data-account-id', getAccountId)
    //         removeLoader();
    //     });
    // });

    //cancel transaction password for deleting jeevi role
    $(document).on('click', '#btn-jeevi-account-delete-transaction-cancel', function () {
        $('#alert-confirm-transactional-password').remove();
    });

    //confirm transaction password for deleting jeevi role
    $(document).on('click', '#btn-jeevi-account-delete-transaction-confirm', function () {
        var getAccountId = $('#alert-confirm-transactional-password').attr('data-account-id');
        $('#alert-confirm-transactional-password').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getAccountId,
        }
        jeeviAccountDelete(requestParams)
            .then((response) => {
                //console.log("jeeviAccountDelete response", response);
                var getAccountDetails = JSON.parse(sessionStorage.getItem('accountDetails'));
                //console.log("getAccountDetails", getAccountDetails);
                getAccountDetails.roles.prospect = "pending";
                //console.log("final getAccountDetails", getAccountDetails);
                window.sessionStorage.setItem('accountDetails', JSON.stringify(getAccountDetails));
                removeLoader();
                Materialize.toast(`Successfully deleted jeevi account.`, 3000, 'round success-alert');
                location.hash = `jeevi/app/hub`;
                console.log('fwefwef');
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in account delete.`, 3000, 'round success-alert');
            })
    });

    //cancel for automatically deleting digibiz account
    $(document).on('click', '#btn-automatic-digibiz-account-delete-cancel', function (e) {
        $('#alert-no-role-active-delete-digibiz-account').remove();
    });

    //confirm for automatically deleting digibiz account
    $(document).on('click', '#btn-automatic-digibiz-account-delete-confirm', function (e) {
        var getAccountId = $('#alert-no-role-active-delete-digibiz-account').attr('data-account-id');
        $('#alert-no-role-active-delete-digibiz-account').remove();
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-digibiz-account-delete-transaction-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-digibiz-account-delete-transaction-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            $('#alert-confirm-transactional-password').attr('data-account-id', getAccountId)
            removeLoader();
        });
    });

    // //confirm transaction password
    // $(document).on('click', '#btn-jeevi-account-delete-transaction-confirm', function () {
    //     var getAccountId = $('#alert-confirm-transactional-password').attr('data-account-id');
    //     $('#alert-confirm-transactional-password').remove();
    //     var requestParams = {
    //         device_id: crossplat.device.uuid,
    //         id: getAccountId,
    //     }
    //     jeeviAccountDelete(requestParams)
    //         .then((response) => {
    //             //console.log("jeeviAccountDelete response", response);
    //             removeLoader();
    //             Materialize.toast(`Successfully deleted jeevi account.`, 3000, 'round success-alert');
    //             if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
    // setTimeout(function () {
    // deviceHelper.navigateToAccounts('core');
    // }, 1000);
    //             } else {
    // setTimeout(function () {
    // deviceHelper.navigateToAccounts('core');
    // }, 1000);
    //             }
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             Materialize.toast(`Error in account delete.`, 3000, 'round success-alert');
    //         })
    // });

    //digibiz-admin add list of employees
    $(document).on('click', '#digibiz_admin_add_button', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        employeeList(reqParam)
            .then((result) => {
                var EmployeeList = {
                    EmployeeList: result.map(e => {
                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                            if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                    e['imageLetter'] = e.display_name.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            } else {
                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                    e['imageLetter'] = e.display_name.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            }
                        } else {
                            if (e.hasOwnProperty('display_name') && e.display_name) {
                                e['imageLetter'] = e.display_name.charAt(0);
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                        }
                        return e;
                    })
                }
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "modal-digibiz-admin-add-employee-selection",
                        modal_header: "Employee List",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-selected-employees-digibiz-admin",
                        }]
                    }
                    showModal(modal_data, function () {
                        //console.log("123")
                        //add search element                                            
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        setTimeout(function () {
                            //console.log("$$$$")
                            $('.employee-selection-member-list').prepend(`<div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                    </div>
                                </div>`);
                            removeLoader();
                            var element33 = $('#employee-list-selection-search-btn').find('.expand-search-input');
                            if (element33) {
                                //console.log('element33', element33);
                                //if element is there
                                $(document).on('input', element33, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element33.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element33, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element33.attr("socketid");
                                    keyword = element33.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword,
                                            index: 'getEmployeeContactListAllEmployees',
                                            business_id: sessionStorage.getItem('business_id')
                                        };
                                        // switch (currentroute) {
                                        //     case 'super_admin_management_hub':
                                        //         if ($('#modal-digibiz-admin-add-employee-selection').length > 0) {
                                        //             data['index'] = 'getEmployeeContactListAllEmployees';
                                        //             data['business_id'] = sessionStorage.getItem('business_id')
                                        //         }
                                        //         break;
                                        //     default:
                                        //         break;
                                        // }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part111", result)
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element33.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'business_settings':
                                                if ($('#modal-digibiz-admin-add-employee-selection').length > 0) {
                                                    processSearchedEmployeeSelectionList(result, function () { })
                                                }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    //console.log("^^^^")
                                    if ($('#modal-digibiz-admin-add-employee-selection').length > 0) {
                                        processSearchedEmployeeSelectionList(result, function () { })
                                    }
                                })
                            }
                        }, 100);
                        // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        //     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        //     if ($('.modal-popup-content').length > 0) {
                        //         //console.log("scroll initiated for modal pop-up class")
                        //         appScroll.scrollBar('.modal-popup-content');
                        //     }
                        // } else {
                        //     $('.custom-modal-popup').show().addClass('modal-slide-top');
                        // }
                        // removeLoader();
                    });
                }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Employees found.`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#add-selected-employees-digibiz-admin', function () {
        addLoader();
        if ($('.employee-select-btn-wrapper.selected-row').length > 0) {
            var getSelectedEmployeeId = $('.employee-select-btn-wrapper.selected-row').find('.employee-select-btn').attr('data-dj-unique-employee-id');
            var reqparams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "digibiz_admin",
                employee_id: getSelectedEmployeeId,
            }
            businessOwnerAdd(reqparams)
                .then((response) => {
                    //console.log("businessOwnerAdd", response);
                    $('#modal-digibiz-admin-add-employee-selection').remove();
                    Materialize.toast(`Successfully added`, 3000, "round success-alert");
                    businessDigibizAdminsTab();
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    if (err.msg == "Cannot add! This employee is present as module_admin.") {
                        var alert_parms = {
                            alert_id: "alert-digibiz-module-admin-role-present-yes-no",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `This employee is present as module admin. Module admin access of this employee will removed if this employee is made digibiz admin. Are you sure you want to make him as digibiz-admin?`,
                            alert_btn: [{
                                name: "Yes",
                                attr: [{ name: "id", value: "btn-alert-lert-digibiz-module-admin-role-present-confirm-yes" }]
                            },
                            {
                                name: "No",
                                attr: [{ name: "id", value: "btn-lert-digibiz-module-admin-role-present-confirm-no" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            $('#alert-digibiz-module-admin-role-present-yes-no').attr('data-employee-id', getSelectedEmployeeId);
                            removeLoader();
                        });
                    } else if (err.msg == "This employee is already a digibiz_admin") {
                        var alert_parms = {
                            alert_id: "alert-already-digibiz-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `This employee is already a digibiz admin.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-already-digibiz-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else if (err.msg == "Maximum digibiz admins reached") {
                        var alert_parms = {
                            alert_id: "alert-maximum-digibiz-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Cannot add! Maximum digibiz admins reached.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-maximum-digibiz-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else if (err.msg == "Cannot add! This employee is present as super admin.") {
                        var alert_parms = {
                            alert_id: "alert-already-super-admin-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Cannot add! Maximum digibiz admins reached.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-already-super-admin-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else {
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    }
                })
        } else {
            removeLoader();
            Materialize.toast(`Please select a employee.`, 3000, 'round success-alert');
        }
    });

    $(document).on('click', '#btn-alert-already-digibiz-admin', function () {
        $('#alert-already-digibiz-admin').remove();
    });

    $(document).on('click', '#btn-alert-maximum-digibiz-admin', function () {
        $('#alert-maximum-digibiz-admin').remove();
    });

    $(document).on('click', '#btn-alert-already-super-admin-admin', function () {
        $('#alert-already-super-admin-admin').remove();
    });

    $(document).on('click', '#btn-alert-present-as-digibiz-admin', function () {
        $('#alert-present-as-digibiz-admin').remove();
    });

    $(document).on('click', '#btn-alert-already-module-admin', function () {
        $('#alert-already-module-admin').remove();
    });

    $(document).on('click', '#btn-alert-maximum-module-admin', function () {
        $('#alert-maximum-module-admin').remove();
    });

    //module-admin add list of employees
    $(document).on('click', '#module_admin_add_button', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        employeeList(reqParam)
            .then((result) => {
                var EmployeeList = {
                    EmployeeList: result.map(e => {
                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                            if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                    e['imageLetter'] = e.display_name.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            } else {
                                if (e.hasOwnProperty('display_name') && e.display_name) {
                                    e['imageLetter'] = e.display_name.charAt(0);
                                } else {
                                    e['imageLetter'] = e.name.first.charAt(0);
                                }
                            }
                        } else {
                            if (e.hasOwnProperty('display_name') && e.display_name) {
                                e['imageLetter'] = e.display_name.charAt(0);
                            } else {
                                e['imageLetter'] = e.name.first.charAt(0);
                            }
                        }
                        return e;
                    })
                }
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "modal-module-admin-add-employee-selection",
                        modal_header: "Employee List",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-selected-employees-module-admin",
                        }]
                    }
                    showModal(modal_data, function () {
                        //console.log("123")
                        //add search element                                            
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        setTimeout(function () {
                            //console.log("$$$$")
                            $('.employee-selection-member-list').prepend(`<div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="employee-list-selection-search-btn">
                                        <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                        <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                        <span class="searchclosebtn"><i class="material-icons employee-list-selection-close-btn hide">close</i></span>
                                    </div>
                                </div>`);
                            removeLoader();
                            var element44 = $('#employee-list-selection-search-btn').find('.expand-search-input');
                            if (element44) {
                                //console.log('element44', element44);
                                //if element is there
                                $(document).on('input', element44, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element44.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element44, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element44.attr("socketid");
                                    keyword = element44.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword,
                                            index: 'getEmployeeContactListAllEmployees',
                                            business_id: sessionStorage.getItem('business_id')
                                        };
                                        // switch (currentroute) {
                                        //     case 'super_admin_management_hub':
                                        //         if ($('#modal-digibiz-admin-add-employee-selection').length > 0) {
                                        //             data['index'] = 'getEmployeeContactListAllEmployees';
                                        //             data['business_id'] = sessionStorage.getItem('business_id')
                                        //         }
                                        //         break;
                                        //     default:
                                        //         break;
                                        // }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part111", result)
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element44.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'module_admin_list':
                                                if ($('#modal-module-admin-add-employee-selection').length > 0) {
                                                    processSearchedEmployeeSelectionList(result, function () { })
                                                }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    //console.log("^^^^")
                                    if ($('#modal-module-admin-add-employee-selection').length > 0) {
                                        processSearchedEmployeeSelectionList(result, function () { })
                                    }
                                })
                            }
                        }, 100);
                        // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        //     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        //     if ($('.modal-popup-content').length > 0) {
                        //         //console.log("scroll initiated for modal pop-up class")
                        //         appScroll.scrollBar('.modal-popup-content');
                        //     }
                        // } else {
                        //     $('.custom-modal-popup').show().addClass('modal-slide-top');
                        // }
                        // removeLoader();
                    });
                }, 'page/common/employee_list_selection', '#employee-selection-list-template', EmployeeList);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Employees found.`, 3000, 'round success-alert');
            })
    });

    $(document).on('click', '#add-selected-employees-module-admin', function () {
        addLoader();
        if ($('.employee-select-btn-wrapper.selected-row').length > 0 && $('.employee-select-btn-wrapper.selected-row').length == 1) {
            var getSelectedEmployeeId = $('.employee-select-btn-wrapper.selected-row').find('.employee-select-btn').attr('data-dj-unique-employee-id');
            var getModules = [{ name: sessionStorage.getItem('module_type') }]
            var reqparams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "module_admin",
                employee_id: getSelectedEmployeeId,
                modules: getModules,
                performer_id: sessionStorage.getItem('user_id'),
                performer_type: "individual"
            }
            businessOwnerAdd(reqparams)
                .then((response) => {
                    //console.log("businessOwnerAdd", response);
                    $('#modal-module-admin-add-employee-selection').remove();
                    Materialize.toast(`Successfully added`, 3000, "round success-alert");
                    moduleAdminListPage();
                    removeLoader();
                })
                .catch((err) => {
                    removeLoader();
                    if (err.msg == "Cannot add! This employee is a digibiz admin.") {
                        var alert_parms = {
                            alert_id: "alert-present-as-digibiz-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `This employee is a digibiz admin.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-present-as-digibiz-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else if (err.msg == `This employee is already a module admin for ${sessionStorage.getItem('module_type')}`) {
                        var alert_parms = {
                            alert_id: "alert-already-module-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `This employee is already a module admin for ${sessionStorage.getItem('module_type')}.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-already-module-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else if (err.msg == `Maximum module admins reached for ${sessionStorage.getItem('module_type')}`) {
                        var alert_parms = {
                            alert_id: "alert-maximum-module-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Cannot add! Maximum module admins reached for ${sessionStorage.getItem('module_type')}.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-maximum-module-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else if (err.msg == "Cannot add! This employee is present as super admin.") {
                        var alert_parms = {
                            alert_id: "alert-already-super-admin-admin",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Cannot add! Maximum digibiz admins reached.`,
                            alert_btn: [{
                                name: "OK",
                                attr: [{ name: "id", value: "btn-alert-already-super-admin-admin" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            removeLoader();
                        });
                    } else {
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    }
                })
        } else {
            removeLoader();
            if ($('.employee-select-btn-wrapper.selected-row').length > 1) {
                Materialize.toast(`Can select only 1 employee.`, 3000, 'round success-alert');
            } else {
                Materialize.toast(`Please select a employee.`, 3000, 'round success-alert');
            }
        }
    });

    $(document).on('click', '.business-profile-display-control-content', function (e) {
        e.stopImmediatePropagation();
        //console.log("clicked @@")
        // addLoader();
        var $this = $(this);
        if ($($this).hasClass('disabled')) {
            //console.log("this is disabled");
            // removeLoader();
        } else {
            let $checkbox = $($this).find('input:checkbox');
            //console.log("$checkbox", $checkbox)
            // var index = digibiz.businessDisplayControl.findIndex(e => e.id == getRecordId);
            // //console.log("index", index);
            //show tick if checked
            if (!$(e.target).is('input:checkbox')) {
                $checkbox.prop('checked', !$checkbox.prop('checked')).parents('.business-profile-display-control-content').toggleClass('selected-row');
            }
            // if (index != -1) {
            //     //console.log("no -1")
            //     if ($($this).hasClass('selected-row')) {
            //         //console.log("checked")
            //         digibiz.businessDisplayControlData[index]['selected'] = true;
            //         removeLoader();
            //     } else {
            //         //console.log("not-check")
            //         digibiz.businessDisplayControlData[index]['selected'] = false;
            //         removeLoader();
            //     }
            // } else {
            // removeLoader();
            // }
        }
    });

    $(document).on('click', '#business-profile-display-control-save', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            name: $('.business-name').parents('.business-profile-display-control-content').hasClass('selected-row'),
            tag_line: $('.tag-line').parents('.business-profile-display-control-content').hasClass('selected-row'),
            status_line: $('.status-line').parents('.business-profile-display-control-content').hasClass('selected-row'),
            display_name: $('.display-name').parents('.business-profile-display-control-content').hasClass('selected-row'),
            display_picture: $('.business-display-picture').parents('.business-profile-display-control-content').hasClass('selected-row'),
            display_video: $('.business-display-video').parents('.business-profile-display-control-content').hasClass('selected-row'),
            contact_name: $('.contact-name').parents('.business-profile-display-control-content').hasClass('selected-row'),
            contact_number: $('.contact-number').parents('.business-profile-display-control-content').hasClass('selected-row'),
            alternate_contact_number: $('.alternate-contact-number').parents('.business-profile-display-control-content').hasClass('selected-row'),
            e_mail: $('.e-mail').parents('.business-profile-display-control-content').hasClass('selected-row'),
            alternate_e_mail: $('.alternate-e-mail').parents('.business-profile-display-control-content').hasClass('selected-row'),
            address: $('.business-address').parents('.business-profile-display-control-content').hasClass('selected-row'),
            date_of_commencement: $('.date-of-commencement').parents('.business-profile-display-control-content').hasClass('selected-row'),
            date_of_incorporation: $('.date-of-incorporation').parents('.business-profile-display-control-content').hasClass('selected-row'),
            business_type_id: $('.business-type').parents('.business-profile-display-control-content').hasClass('selected-row'),
            id_proofs: $('.id-proof').parents('.business-profile-display-control-content').hasClass('selected-row'),
            pan_card_details: $('.pan-card').parents('.business-profile-display-control-content').hasClass('selected-row'),
            shop_established_license: $('.shop-established-licence').parents('.business-profile-display-control-content').hasClass('selected-row'),
            partnership_deed: $('.partnership-deed').parents('.business-profile-display-control-content').hasClass('selected-row'),
            partnership_registration_certificate: $('.partnership-registration-certificate').parents('.business-profile-display-control-content').hasClass('selected-row'),
            llp_registration_certificate: $('.limited-liability-partnership').parents('.business-profile-display-control-content').hasClass('selected-row'),
            transaction_person: $('.board-resolution-authorize').parents('.business-profile-display-control-content').hasClass('selected-row'),
            memorandum_of_association: $('.memorandum-of-association').parents('.business-profile-display-control-content').hasClass('selected-row'),
            article_of_association: $('.articles-of-association').parents('.business-profile-display-control-content').hasClass('selected-row'),
            gst_details: $('.gst').parents('.business-profile-display-control-content').hasClass('selected-row'),
            trust_foundation_established_licence: $('.trust-establishment-license').parents('.business-profile-display-control-content').hasClass('selected-row'),
        }
        addDisplayControl(reqParam)
            .then((response) => {
                //console.log("response", response);
                Materialize.toast(`Successfully updated.`, 3000, "round success-alert");
                location.hash = `business/profile/management`;
            })
            .catch((err) => {
                //console.log("err", err);
                removeLoader();
            })
    });

    $(document).on('click', '.dj_hub_btn', function () {
        // var alert_parms = {
        //     alert_id: "alert-navigate-dj-hub",
        //     alert_platform: crossplat.device.platform,
        //     alert_title: "DJ Hub",
        //     alert_body: `Are you sure you want to go to DJ hub?`,
        //     alert_btn: [{
        //         name: "NO",
        //         attr: [{ name: "id", value: "alert-navigate-dj-hub-no" }]
        //     },
        //     {
        //         name: "YES",
        //         attr: [{ name: "id", value: "alert-navigate-dj-hub-yes" }]
        //     }]
        // }
        // showAlert(alert_parms, function () {
        // });
        sessionStorage.clear();
        $('#alert-navigate-dj-hub').remove();
        setTimeout(function () {
            deviceHelper.navigateToAccounts('core');
        }, 1000);
    });

    $(document).on('click', '#alert-navigate-dj-hub-no', function () {
        $('#alert-navigate-dj-hub').remove();
    });

    $(document).on('click', '#alert-navigate-dj-hub-yes', function () {
        sessionStorage.clear();
        $('#alert-navigate-dj-hub').remove();
        setTimeout(function () {
            deviceHelper.navigateToAccounts('core');
        }, 1000);
    });


    $(document).on('click', '.jeevi_hub_btn', function () {
        // get all the required sessions and clear all and then set them again
        var userId = sessionStorage.getItem('user_id');
        var UUID = sessionStorage.getItem('uuid');
        var socketId = sessionStorage.getItem('socketID');
        var getAccountID = sessionStorage.getItem('account_id');
        var getAccountDetails = sessionStorage.getItem('accountDetails');
        var storageTokenDetails = sessionStorage.getItem('storage_token');
        var profileDetails = sessionStorage.getItem('profile_details');
        var DigibizRole = sessionStorage.getItem('digibiz_role');
        var getRoleBtn = sessionStorage.getItem('get_role_btn');
        sessionStorage.clear();
        sessionStorage.setItem('user_id', userId);
        sessionStorage.setItem('uuid', UUID);
        sessionStorage.setItem('socketID', socketId);
        sessionStorage.setItem('account_id', getAccountID);
        sessionStorage.setItem('accountDetails', getAccountDetails);
        sessionStorage.setItem('storage_token', storageTokenDetails);
        sessionStorage.setItem('profile_details', profileDetails);
        sessionStorage.setItem('digibiz_role', DigibizRole);
        sessionStorage.setItem('get_role_btn', getRoleBtn);
        location.hash = `jeevi/app/hub`;
        console.log('fwefwef');
    });

    $(document).on('click', '.bizadmin-business-list-page', function () {
        // var alert_parms = {
        //     alert_id: "alert-navigate-app-hub",
        //     alert_platform: crossplat.device.platform,
        //     alert_title: "Bizadmin Business List",
        //     alert_body: `Are you sure you want to go to business list?`,
        //     alert_btn: [{
        //         name: "NO",
        //         attr: [{ name: "id", value: "alert-navigate-app-hub-no" }]
        //     },
        //     {
        //         name: "YES",
        //         attr: [{ name: "id", value: "alert-navigate-app-hub-yes" }]
        //     }]
        // }
        // showAlert(alert_parms, function () {
        // });
        $('body').click();
        // location.hash = `business_owner/business/list`;
        location.hash = `business_owner/business/list`;
    });

    $(document).on('click', '#alert-navigate-app-hub-no', function () {
        $('#alert-navigate-app-hub').remove();
    });

    $(document).on('click', '#alert-navigate-app-hub-yes', function () {
        $('#alert-navigate-app-hub').remove();
        // location.hash = `business_owner/business/list`;
        location.hash = `business_owner/business/list`;
    });


    $(document).on('click', '.close-preview', function (e) {
        //console.log("close preview")
        // e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;        
        $(".upload-preview-common-layout#upload-preview-wrapper").addClass('slide-bottom');
        $(".upload-preview-common-layout #upload-preview-container-text-box").text("");
        setTimeout(function () {
            $(".upload-preview-common-layout#upload-preview-wrapper").addClass('hide');
            $(".upload-preview-common-layout #upload-footer-attached-files-list").empty();
            $(".upload-preview-common-layout #upload-footer-attatched-new-file").removeClass("hide");
            $(".upload-preview-common-layout#upload-preview-wrapper").removeClass('slide-bottom');
        }, 200);
        $("#upload-permission-btn").removeClass('hide');
        $('.selected-multimedia-files').remove();
        if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
            $('.header-band').removeClass('hide');
        }
        //revoke Object URLs
        digibiz.objectURLS = [];
        digibiz.uploadingFiles = [];
        uploader._files = {};
        // digibiz.uploadingFiles = [];    
        Object.keys(sessionStorage).forEach(function (val) {
            if (val.includes('ObjectURL_')) {
                URL.revokeObjectURL(sessionStorage.getItem(val));
                sessionStorage.removeItem(val);
            }
        });

        //revoke stream(stop device)
        if (window.camerastream) {
            window.camerastream.getTracks()[0].stop();
        }
        if (window.videocamerastream) {
            window.videocamerastream.getTracks()[0].stop();
            window.videocamerastream.getTracks()[1].stop();
        }

        //stop recorder
        if (window.recorder && recorder.state != 'inactive') {
            recorder.stop();
            clearInterval(interval);
            clearInterval(indicator_interval);
        }

        //stop video or audio media
        stopMedia();
    });


    $(document).on('click', '#upload-permission-btn', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var alert_parms = {
            alert_id: "set-file-permission",
            alert_platform: crossplat.device.platform,
            alert_title: "File Permission",
            alert_body: `<div class="share-filter forward-toggle share-card-approval-btn">Download
                        <label class="toggle-switch" for="download-permission">
                            <input type="checkbox" id="download-permission">
                            <div class="toggle-slider round"></div>
                        </label>
                    </div>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "upload-permission-cancel" }]
            },
            {
                name: "Set",
                attr: [{ name: "id", value: "upload-permission-set" }]
            }]
        }
        showAlert(alert_parms, function () {
            //console.log("shown alert box")
        });
    });

    $(document).on('click', '#upload-permission-cancel', function () {
        $('#set-file-permission').remove();
    });

    $(document).on('click', '#upload-permission-set', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var download_permission = $('#download-permission').is(':checked');
        //console.log("download_permission", download_permission);
        $('#upload-footer-send-btn-common').attr('data-download', download_permission);
        $('#set-file-permission').remove();
    });

    $(document).on('click', '#more_vert_option_business_documents', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var getID = $(this).siblings('.file-details').attr('data-image-id');
        var getFileName = $(this).siblings('.file-details').find('.file-name').find('.thumb-title').text();
        var action_sheet_parms = {
            action_id: "more_vert_option_business_documents_action_sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Download",
                attr: [{ name: "id", value: "download-to-device" }]
            },
                // {
                //     name: "Cloud Download",
                //     attr: [{ name: "id", value: "download-to-cloud" }]
                // }
            ]
        }
        showAction(action_sheet_parms, function () {
            removeLoader();
            $('#more_vert_option_business_documents_action_sheet').attr('data-id', getID);
            $('#more_vert_option_business_documents_action_sheet').attr('data-name', getFileName);
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
        });
    });

    /**
    * Download To Device
    */

    $(document).on('click', '#download-to-device', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var image_id = $('#more_vert_option_business_documents_action_sheet').attr('data-id');
        //console.log("image_id", image_id);
        var fileName = $('#more_vert_option_business_documents_action_sheet').attr('data-name');
        //console.log("fileName", fileName);
        // $('.action-sheet-cancel-btn').trigger('click');
        $('#more_vert_option_business_documents_action_sheet').remove();
        downloadToDevice(image_id, fileName, function () {
            //console.log("completed callback");
        });
    });

    /**
    * Download To Cloud
    */

    $(document).on('click', '#download-to-cloud', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('.action-sheet-cancel-btn').trigger('click');
        var image_id = $(this).attr('data-id');
        checkToken().then((response) => {
            if (response) {
                getAssetDetails(image_id).then((assetDetails) => {
                    if (assetDetails) {
                        if (sessionStorage.getItem('bizchat_role') == "employee") {
                            var user_id = sessionStorage.getItem('employee_id');
                            var userid = sessionStorage.getItem('employee_id');
                            var user_type = "employee";
                        } else if (sessionStorage.getItem('bizchat_role') == "individual") {
                            var user_id = sessionStorage.getItem('digibiz_individual_id');
                            var userid = sessionStorage.getItem('digibiz_individual_id'); var user_type = "individual";

                        } else if (sessionStorage.getItem('bizchat_role') == "customer") {
                            if (sessionStorage.getItem('customer_type') == "customer") {
                                var user_type = "customer";
                                var userid = sessionStorage.getItem('customer_id');
                            } else if (sessionStorage.getItem('customer_type') == "associate_customer") {
                                var user_type = "associate_customer";
                                var userid = sessionStorage.getItem('customer_id');
                            }
                        }

                        var requestParams = {
                            "location": assetDetails.location,
                            "parent": assetDetails.parent,
                            "real_name": assetDetails.file_attributes.name.real,
                            "fileName": assetDetails.file_attributes.name.relative + ' ' + moment().format('D MMMM hh:mm:ss'),
                            "owner": {
                                "id": assetDetails.owner.id,
                                "type": assetDetails.owner.type
                            },
                            "userid": userid,
                            "usertype": user_type,
                            "filemanager": {
                                "device_id": crossplat.device.uuid,
                                "owner": {
                                    "type": user_type,
                                    "id": userid
                                },
                                "location": "downloads_folder",
                                "type": "file",
                                "access_type": "user",
                                "file": {
                                    "permission": "",
                                    "keywords": "bizchat download"
                                },
                                source: {
                                    "app": "Bizchat",
                                    "data": {
                                        user_id: user_id,
                                        user_type: user_type
                                    }
                                }
                            }
                        };

                        cloudDownload(requestParams).then((result) => {
                            if (result.Messsage == "Success") {
                                Materialize.toast("Successfully download to cloud", 4000, 'round success-alert');
                            } else {
                                Materialize.toast("Error occured while dounload to cloud", 4000, 'round error-alert');
                            } ``

                        }).catch((err) => {
                            Materialize.toast("Error occured while dounload to cloud", 4000, 'round error-alert');
                        })
                    }
                }).catch((err) => {
                    if (err.Data[0].data == "No such file found") {
                        removeLoader();
                        Materialize.toast('Original file is deleted please contact sender', 2000, 'round error - alert');

                    }
                })


            }
        }).catch((err) => {
            if (err.responseJSON.Data.tokenStatus) {
                Materialize.toast(err.responseJSON.message.error_description, 4000, 'round error-alert');
            }
        })
    });

    $(document).on('click', '.business-app-permissions-settings', function (e) {
        location.hash = `business/app_permission/settings`;
    });

    //on click on more vert button in app permission settings page
    $(document).on('click', '.app_permission_settings_app_actions', function () {
        var getApp = $(this).parents('.apps-choose-business').attr('data-value');
        //console.log("getApp", getApp);
        var getStatus = $(this).parents('.apps-choose-business').attr('data-status');
        //console.log("getStatus", getStatus);
        if (getStatus == "active") {
            var action_parms = {
                action_id: "action-app-permission-page-more-vert",
                action_platform: crossplat.device.platform,
                action_title: "Actions",
                action_btn: [
                    {
                        name: "Inactivate",
                        attr: [{ name: "id", value: "app-permission-inactivate-btn" }]
                    },
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "app-permission-delete-btn" }]
                    }
                ]
            }
            showAction(action_parms, function () {
                $('#action-app-permission-page-more-vert').attr('data-app', getApp);
            });
        } else if (getStatus == "inactive") {
            var action_parms = {
                action_id: "action-app-permission-page-more-vert",
                action_platform: crossplat.device.platform,
                action_title: "Actions",
                action_btn: [
                    {
                        name: "Activate",
                        attr: [{ name: "id", value: "app-permission-activate-btn" }]
                    },
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "app-permission-delete-btn" }]
                    }
                ]
            }
            showAction(action_parms, function () {
                $('#action-app-permission-page-more-vert').attr('data-app', getApp);
            });
        } else {
            var action_parms = {
                action_id: "action-app-permission-page-more-vert",
                action_platform: crossplat.device.platform,
                action_title: "Actions",
                action_btn: [
                    {
                        name: "Give Access",
                        attr: [{ name: "id", value: "app-permission-give-access-btn" }]
                    }
                ]
            }
            showAction(action_parms, function () {
                $('#action-app-permission-page-more-vert').attr('data-app', getApp);
            });
        }
    });

    //give access
    $(document).on('click', '#app-permission-give-access-btn', function (e) {
        e.stopImmediatePropagation();
        var getApp = $('#action-app-permission-page-more-vert').attr('data-app');
        var reqParam = {
            device_id: crossplat.device.uuid,
            owner: {
                id: sessionStorage.getItem('account_id'),
                type: "individual"
            },
            business_id: sessionStorage.getItem('business_id'),
            apps: [getApp]
        }
        //console.log("reqParam", reqParam);
        addAppPermissions(reqParam)
            .then((response) => {
                $('#action-app-permission-page-more-vert').remove();
                Materialize.toast("Sucessfully added.", 3000, 'round success-alert');
                $(`.apps-choose-business[data-value="${getApp}"]`).attr('data-status', 'active');
                $(`.apps-choose-business[data-value="${getApp}"]`).append(`<div class="checkbox-conatiner">
                <input type="checkbox" class="filled-in app-choice-business-selected disabled" id="filled-in-box" checked="checked" disabled="disabled" />
                <label for="filled-in-box"></label>
                </div>`);
                // $(`<div class="checkbox-conatiner">
                // <input type="checkbox" class="filled-in app-choice-business-selected disabled" id="filled-in-box" checked="checked" disabled="disabled" />
                // <label for="filled-in-box"></label>
                // </div>`).insertAfter(`.apps-choose-business[data-value="${getApp}"] .app_permission_settings_app_actions`);
            })
            .catch((err) => {
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    $(document).on('click', '#access-denied-app-permission-not-present', function () {
        $('#app-permission-not-present-alert').remove();
    });

    //inactive app --> alert box
    $(document).on('click', '#app-permission-inactivate-btn', function (e) {
        e.stopImmediatePropagation();
        var getApp = $('#action-app-permission-page-more-vert').attr('data-app');
        var alert_parms = {
            alert_id: "alert-app-permission-inactive-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Inactive App",
            alert_body: `<div>Are you sure you want inactivate ${getApp}?</div>`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-app-permission-inactive-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-app-permission-inactive-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#action-app-permission-page-more-vert').remove();
            $('#alert-app-permission-inactive-confirm-cancel').attr('data-app', getApp);
        });

    });

    //inactive app --> alert box --> yes
    $(document).on('click', '#btn-app-permission-inactive-confirm-yes', function () {
        var getApp = $('#alert-app-permission-inactive-confirm-cancel').attr('data-app');
        var reqParam = {
            device_id: crossplat.device.uuid,
            owner: {
                id: sessionStorage.getItem('account_id'),
                type: "individual"
            },
            business_id: sessionStorage.getItem('business_id'),
            app: getApp,
            action: "inactive"
        }
        changeStatusAppPermissions(reqParam)
            .then((response) => {
                //console.log("response", response);
                $('#alert-app-permission-inactive-confirm-cancel').remove();
                Materialize.toast("Sucessfully inactivated.", 3000, 'round success-alert');
                $(`.apps-choose-business[data-value="${getApp}"]`).attr('data-status', 'inactive');
                $(`.apps-choose-business[data-value="${getApp}"]`).find('.checkbox-conatiner').remove();
            })
            .catch((err) => {
                //console.log("err", err);
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    //inactive app --> alert box --> no
    $(document).on('click', '#btn-app-permission-inactive-confirm-no', function (e) {
        $('#alert-app-permission-inactive-confirm-cancel').remove();
    })

    //active app --> alert box
    $(document).on('click', '#app-permission-activate-btn', function (e) {
        e.stopImmediatePropagation();
        var getApp = $('#action-app-permission-page-more-vert').attr('data-app');
        var alert_parms = {
            alert_id: "alert-app-permission-active-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Activate App",
            alert_body: `<div>Are you sure you want activate ${getApp}?</div>`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-app-permission-active-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-app-permission-active-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#action-app-permission-page-more-vert').remove();
            $('#alert-app-permission-active-confirm-cancel').attr('data-app', getApp);
        });
    });

    //active app --> alert box --> yes
    $(document).on('click', '#btn-app-permission-active-confirm-yes', function (e) {
        e.stopImmediatePropagation();
        var getApp = $('#alert-app-permission-active-confirm-cancel').attr('data-app');
        var reqParam = {
            device_id: crossplat.device.uuid,
            owner: {
                id: sessionStorage.getItem('account_id'),
                type: "individual"
            },
            business_id: sessionStorage.getItem('business_id'),
            app: getApp,
            action: "active"
        }
        changeStatusAppPermissions(reqParam)
            .then((response) => {
                //console.log("response", response);
                $('#alert-app-permission-active-confirm-cancel').remove();
                Materialize.toast("Sucessfully activated.", 3000, 'round success-alert');
                $(`.apps-choose-business[data-value="${getApp}"]`).attr('data-status', 'active');
                $(`.apps-choose-business[data-value="${getApp}"]`).append(`<div class="checkbox-conatiner">
                <input type="checkbox" class="filled-in app-choice-business-selected disabled" id="filled-in-box" checked="checked" disabled="disabled" />
                <label for="filled-in-box"></label>
                </div>`);
                // $(`<div class="checkbox-conatiner">
                // <input type="checkbox" class="filled-in app-choice-business-selected disabled" id="filled-in-box" checked="checked" disabled="disabled" />
                // <label for="filled-in-box"></label>
                // </div>`).insertAfter(`.apps-choose-business[data-value="${getApp}"] .app_permission_settings_app_actions`);
            })
            .catch((err) => {
                //console.log("err", err);
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    //active app --> alert box --> no
    $(document).on('click', '#btn-app-permission-active-confirm-no', function (e) {
        $('#alert-app-permission-active-confirm-cancel').remove();
    });

    //delete app --> alert box
    $(document).on('click', '#app-permission-delete-btn', function (e) {
        e.stopImmediatePropagation();
        var getApp = $('#action-app-permission-page-more-vert').attr('data-app');
        var alert_parms = {
            alert_id: "alert-app-permission-delete-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: "Delete App",
            alert_body: `<div>Are you sure you want delete ${getApp}?</div>`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-app-permission-delete-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-app-permission-delete-confirm-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            $('#action-app-permission-page-more-vert').remove();
            $('#alert-app-permission-delete-confirm-cancel').attr('data-app', getApp);
        });
    });

    //delete app --> alert box --> yes
    $(document).on('click', '#btn-app-permission-delete-confirm-yes', function (e) {
        e.stopImmediatePropagation();
        var getApp = $('#alert-app-permission-delete-confirm-cancel').attr('data-app');
        var reqParam = {
            device_id: crossplat.device.uuid,
            owner: {
                id: sessionStorage.getItem('account_id'),
                type: "individual"
            },
            business_id: sessionStorage.getItem('business_id'),
            app: getApp,
            action: "delete"
        }
        changeStatusAppPermissions(reqParam)
            .then((response) => {
                //console.log("response", response);
                $('#alert-app-permission-delete-confirm-cancel').remove();
                Materialize.toast("Sucessfully deleted.", 3000, 'round success-alert');
                $(`.apps-choose-business[data-value="${getApp}"]`).attr('data-status', 'deleted');
                $(`.apps-choose-business[data-value="${getApp}"]`).find('.checkbox-conatiner').remove();
            })
            .catch((err) => {
                //console.log("err", err);
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    });

    //delete app --> alert box --> no
    $(document).on('click', '#btn-app-permission-delete-confirm-no', function (e) {
        $('#alert-app-permission-delete-confirm-cancel').remove();
    });

    $(document).on('click', '#notify-role-btn', function (e) {
        addLoader();
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getForData = $('#get-roles-list-modal').attr('data-for');
        var $this = $(this);
        var getType = $($this).parents('.user-conatiner-roles-list').find('.contact-profile-container').attr('data-user-type');
        var getID = $($this).parents('.user-conatiner-roles-list').find('.contact-profile-container').attr('data-user-id');
        var getMobileNumber = $($this).parents('.user-conatiner-roles-list').find('.contact-profile-container').attr('data-mobile-number');
        var getBusinessId = $($this).parents('.user-conatiner-roles-list').find('.contact-profile-container').attr('data-business-id');
        var getRoleType, getRoleBusinessId;
        if (getType == "individual" || getType == "jeevi") {
            getRoleType = "individual";
            getRoleBusinessId = sessionStorage.getItem('business_id');
        } else {
            getRole = getType;
            getRoleBusinessId = getBusinessId;
        }
        if (getForData == "customer") {
            var params = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                role: {
                    id: getID,
                    type: getType,
                    business_id: getRoleBusinessId
                }
            }
            if (getRoleType == "individual") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    data_type: "mobile_number",
                    add_type: "add",
                    type: "customer",
                    business_id: sessionStorage.getItem('business_id'),
                    identifier_id: sessionStorage.getItem('identifier_id'),
                    mobile_number: getMobileNumber,
                    role: {
                        id: getID,
                        type: getType,
                        business_id: getRoleBusinessId
                    }
                }
                notificationAdd(reqParam)
                    .then((response) => {
                        //console.log("notificationAdd response", response);
                        Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                        $('#get-roles-list-modal').remove();
                        location.hash = `customer_creation`;
                        // var getActiveTab = sessionStorage.getItem('selected-customer-tab');
                        // if (getActiveTab == "customer_active") {
                        //     location.hash = `customer_creation/active/list`;
                        // } else if (getActiveTab == "customer_pending") {
                        //     location.hash = `customer_creation/pending/list`;
                        // }
                    })
                    .catch((err) => {
                        //console.log("notificationAdd error", err);
                        Materialize.toast(err.msg, 3000, 'round success-alert');
                        removeLoader();
                    });
            } else {
                var empReqParam = {
                    device_id: crossplat.device.uuid,
                    get_by: "id",
                    business_id: getRoleBusinessId,
                    id: getID,
                }
                employeeGet(empReqParam).then((employeeresult) => {
                    console.log('employeeresult', employeeresult)
                    if (employeeresult.customer_control) {
                        removeLoader();
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            data_type: "mobile_number",
                            add_type: "add",
                            type: "customer",
                            business_id: sessionStorage.getItem('business_id'),
                            identifier_id: sessionStorage.getItem('identifier_id'),
                            mobile_number: getMobileNumber,
                            role: {
                                id: getID,
                                type: getType,
                                business_id: getRoleBusinessId
                            }
                        }
                        notificationAdd(reqParam)
                            .then((response) => {
                                //console.log("notificationAdd response", response);
                                Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                                $('#get-roles-list-modal').remove();
                                location.hash = `customer_creation`;
                                // var getActiveTab = sessionStorage.getItem('selected-customer-tab');
                                // if (getActiveTab == "customer_active") {
                                //     location.hash = `customer_creation/active/list`;
                                // } else if (getActiveTab == "customer_pending") {
                                //     location.hash = `customer_creation/pending/list`;
                                // }
                            })
                            .catch((err) => {
                                //console.log("notificationAdd error", err);
                                Materialize.toast(err.msg, 3000, 'round success-alert');
                                removeLoader();
                            });
                    } else {
                        removeLoader();
                        Materialize.toast(`You are not authorized to add customer`, 3000, 'round error-alert');
                    }
                }).catch((err) => {
                    console.log('err', err);
                })
            }


        } else if (getForData == "associate_customer") {
            if (getRoleType == "individual") {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    data_type: "mobile_number",
                    add_type: "add",
                    type: "associate_customer",
                    business_id: sessionStorage.getItem('business_id'),
                    customer_id: sessionStorage.getItem('customer_id'),
                    mobile_number: getMobileNumber,
                    role: {
                        id: getID,
                        type: getType,
                        business_id: getRoleBusinessId
                    }
                }
                notificationAdd(reqParam)
                    .then((response) => {
                        $('#get-roles-list-modal').remove();
                        //console.log("notificationAdd response", response);
                        var value = getMobileNumber;
                        var jeeviParam = {
                            device_id: crossplat.device.uuid,
                            type: "mobile_number",
                            value: value,
                            data: {
                                jeevi: ["name", "id", "profile_display", "user_name"]
                            }
                        }
                        getJeeviContactDetail(jeeviParam)
                            .then((result) => {
                                //console.log("result", result.Data);
                                var template;
                                if (response.data.type == "employee") {
                                    template = `<div class="customer-associate-customer-assignment-box pending-associate-customer-wrapper" data-notification-id="${response.id}" data-customer-id="${response.customer_id}" data-contact-uuid="${response.contact.uuid}" data-account-id="${response.contact.user_id}" data-role-id="${response.data.id}" data-role-type="${response.data.type}">
                                    <div class="customer-associate-customer-assignment-wrapper">
                                    <div class="customer-associate-customer-assignment-name-container">                      
                                    <div class="customer-associate-customer-assignment-name-wrapper">                      
                                        <div class="customer-associate-customer-assignment-name">${result.Data.jeevi.name.first} ${result.Data.jeevi.name.last}</div> 
                                        <div class="customer-associate-customer-assignment-role">Employee: ${response.data.business_name}</div> 
                                        <div class="customer-associate-customer-status">Status: ${response.contact.status.status}</div>                     
                                        </div>                      
                                    </div>             
                                    </div>              
                                </div>`;
                                } else {
                                    template = `<div class="customer-associate-customer-assignment-box pending-associate-customer-wrapper" data-notification-id="${response.id}" data-customer-id="${response.customer_id}" data-contact-uuid="${response.contact.uuid}" data-account-id="${response.contact.user_id}" data-role-id="${response.data.id}" data-role-type="${response.data.type}">
                                    <div class="customer-associate-customer-assignment-wrapper">
                                    <div class="customer-associate-customer-assignment-name-container">                      
                                    <div class="customer-associate-customer-assignment-name-wrapper">                      
                                        <div class="customer-associate-customer-assignment-name">${result.Data.jeevi.name.first} ${result.Data.jeevi.name.last}</div> 
                                        <div class="customer-associate-customer-status">Status: ${response.contact.status.status}</div>                     
                                        </div>                      
                                    </div>             
                                    </div>              
                                </div>`;
                                }
                                //console.log("template", template);
                                //check if already this persons row is present if present remove that and add new
                                $(`.customer-associate-customer-assignment-box[data-account-id="${response.contact.user_id}"][data-role-id="${response.data.id}"][data-role-type="${response.data.type}"]`).remove();
                                $('.customer-associate-customer-assignment-list-main-container').append(template);
                                $('#add-associate-customer').remove();
                                Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                                //console.log("error in getting user detisl");
                            });
                    })
                    .catch((err) => {
                        //console.log("notificationAdd error", err);
                        Materialize.toast(err.msg, 3000, 'round success-alert');
                        removeLoader();
                    });
            } else {
                var empReqParam = {
                    device_id: crossplat.device.uuid,
                    get_by: "id",
                    business_id: getRoleBusinessId,
                    id: getID,
                }
                employeeGet(empReqParam).then((employeeresult) => {
                    if (employeeresult.customer_control) {
                        var reqParam = {
                            device_id: crossplat.device.uuid,
                            data_type: "mobile_number",
                            add_type: "add",
                            type: "associate_customer",
                            business_id: sessionStorage.getItem('business_id'),
                            customer_id: sessionStorage.getItem('customer_id'),
                            mobile_number: getMobileNumber,
                            role: {
                                id: getID,
                                type: getType,
                                business_id: getRoleBusinessId
                            }
                        }
                        notificationAdd(reqParam)
                            .then((response) => {
                                $('#get-roles-list-modal').remove();
                                //console.log("notificationAdd response", response);
                                var value = getMobileNumber;
                                var jeeviParam = {
                                    device_id: crossplat.device.uuid,
                                    type: "mobile_number",
                                    value: value,
                                    data: {
                                        jeevi: ["name", "id", "profile_display", "user_name"]
                                    }
                                }
                                getJeeviContactDetail(jeeviParam)
                                    .then((result) => {
                                        //console.log("result", result.Data);
                                        var template;
                                        if (response.data.type == "employee") {
                                            template = `<div class="customer-associate-customer-assignment-box pending-associate-customer-wrapper" data-notification-id="${response.id}" data-customer-id="${response.customer_id}" data-contact-uuid="${response.contact.uuid}" data-account-id="${response.contact.user_id}" data-role-id="${response.data.id}" data-role-type="${response.data.type}">
                                                <div class="customer-associate-customer-assignment-wrapper">
                                                <div class="customer-associate-customer-assignment-name-container">                      
                                                <div class="customer-associate-customer-assignment-name-wrapper">                      
                                                    <div class="customer-associate-customer-assignment-name">${result.Data.jeevi.name.first} ${result.Data.jeevi.name.last}</div> 
                                                    <div class="customer-associate-customer-assignment-role">Employee: ${response.data.business_name}</div> 
                                                    <div class="customer-associate-customer-status">Status: ${response.contact.status.status}</div>                     
                                                    </div>                      
                                                </div>             
                                                </div>              
                                            </div>`;
                                        } else {
                                            template = `<div class="customer-associate-customer-assignment-box pending-associate-customer-wrapper" data-notification-id="${response.id}" data-customer-id="${response.customer_id}" data-contact-uuid="${response.contact.uuid}" data-account-id="${response.contact.user_id}" data-role-id="${response.data.id}" data-role-type="${response.data.type}">
                                                <div class="customer-associate-customer-assignment-wrapper">
                                                <div class="customer-associate-customer-assignment-name-container">                      
                                                <div class="customer-associate-customer-assignment-name-wrapper">                      
                                                    <div class="customer-associate-customer-assignment-name">${result.Data.jeevi.name.first} ${result.Data.jeevi.name.last}</div> 
                                                    <div class="customer-associate-customer-status">Status: ${response.contact.status.status}</div>                     
                                                    </div>                      
                                                </div>             
                                                </div>              
                                            </div>`;
                                        }
                                        //console.log("template", template);
                                        //check if already this persons row is present if present remove that and add new
                                        $(`.customer-associate-customer-assignment-box[data-account-id="${response.contact.user_id}"][data-role-id="${response.data.id}"][data-role-type="${response.data.type}"]`).remove();
                                        $('.customer-associate-customer-assignment-list-main-container').append(template);
                                        $('#add-associate-customer').remove();
                                        Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        //console.log("error in getting user detisl");
                                    });
                            })
                            .catch((err) => {
                                //console.log("notificationAdd error", err);
                                Materialize.toast(err.msg, 3000, 'round success-alert');
                                removeLoader();
                            });
                    } else {
                        removeLoader();
                        Materialize.toast(`You are not authorized to add customer`, 3000, 'round error-alert');
                    }
                })
            }
        }
    });

    $(document).on('click', '.employee-get-profile-information', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getEmployeeID = $(this).parents('.employee-wrapper').attr('data-employee-id');
        var getEmployeeStatus = $(this).parents('.employee-wrapper').attr('data-status');
        var getEmployeeSocketStatus = $(this).parents('.employee-wrapper').attr('data-socket-status');
        var reqParams = {
            device_id: crossplat.device.uuid,
            id: getEmployeeID,
            get_by: "id"
        }
        employeeGet(reqParams)
            .then((response) => {
                if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                    if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${getEmployeeID}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                        response.identity_picture['avtarUrl'] = avtarUrl;
                    }
                }
                if (response.hasOwnProperty('identity_video') && response.identity_video) {
                    if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${getEmployeeID}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.video_id}`;
                        response.identity_video['avtarUrl'] = avtarUrl;
                    }
                }
                var EmployeeData = {
                    EmployeeData: response
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (getEmployeeStatus == "deleted") {
                        var modal_data = {
                            modal_id: "employee-profile-view-modal",
                            modal_header: "Employee Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            // modal_action_buttons: [{
                            //     "name": "Close",
                            //     "id": "employee-profile-view-modal-close-btn",
                            // },
                            // {
                            //     "name": "Edit",
                            //     "id": "employee-profile-view-modal-edit-btn",
                            // }]
                        }
                        showModal(modal_data, function () {
                            $('#employee-profile-view-modal').attr('employee_id', getEmployeeID);
                            $('#employee-profile-view-modal').attr('employee_socket_status', getEmployeeSocketStatus);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    } else if (getEmployeeStatus == "exited") {
                        var modal_data = {
                            modal_id: "employee-profile-view-modal",
                            modal_header: "Employee Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Close",
                                "id": "employee-profile-view-modal-close-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#employee-profile-view-modal').attr('employee_id', getEmployeeID);
                            $('#employee-profile-view-modal').attr('employee_socket_status', getEmployeeSocketStatus);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    } else {
                        var modal_data = {
                            modal_id: "employee-profile-view-modal",
                            modal_header: "Employee Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Close",
                                "id": "employee-profile-view-modal-close-btn",
                            },
                            {
                                "name": "Edit",
                                "id": "employee-profile-view-modal-edit-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#employee-profile-view-modal').attr('employee_id', getEmployeeID);
                            $('#employee-profile-view-modal').attr('employee_socket_status', getEmployeeSocketStatus);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    }
                }, 'page/employee/employee_profile', '#employee-profile-template', EmployeeData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in employee get API");
            })
    });

    $(document).on('click', '#employee-profile-view-modal-close-btn', function () {
        $('#employee-profile-view-modal').remove();
    });

    $(document).on('click', '#employee-profile-view-modal-edit-btn', function () {
        addLoader();
        var getEmployeeId = $('#employee-profile-view-modal').attr('employee_id');
        var getSocketStatus = $("#employee-profile-view-modal").attr('employee_socket_status');
        if (getSocketStatus == "true") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: getEmployeeId,
                data: {
                    socket_enable_status: "false",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeUpdate(reqParam)
                .then((response) => {
                    //console.log("employeeUpdate", response);
                    if (response.employee_role == "super_admin") {
                        var getReqParams = {
                            device_id: crossplat.device.uuid,
                            business_id: sessionStorage.getItem('business_id'),
                            list_by: "type",
                            type: "super_admin"
                        }
                        departmentGet(getReqParams)
                            .then((result) => {
                                removeLoader();
                                sessionStorage.setItem('department_id', result.id)
                                sessionStorage.setItem('employee_id', getEmployeeId);
                                sessionStorage.setItem('employee_name', `${response.name.first} ${response.name.last}`);
                                $('#employee-profile-view-modal').remove();
                                location.hash = `employee/create`;
                            })
                            .catch((err) => {
                                removeLoader();
                            })
                    } else {
                        removeLoader();
                        sessionStorage.setItem('employee_id', getEmployeeId);
                        sessionStorage.setItem('employee_name', `${response.name.first} ${response.name.last}`);
                        $('#employee-profile-view-modal').remove();
                        location.hash = `employee/create`;
                    }
                })
                .catch((err) => {
                    //console.log("error in update employee update api", err);
                    if (err.msg == "no updated data found") {
                        removeLoader();
                        sessionStorage.setItem('employee_id', getEmployeeId);
                        $('#employee-profile-view-modal').remove();
                        location.hash = `employee/create`;
                    }
                })
        } else {//getSocketStatus is false
            $('#employee-profile-view-modal').remove();
            Materialize.toast(`Access Denied! You or other administrator is editing this employee at other place.`, 3000, "round error-alert");
            var alert_parms = {
                alert_id: "alert-employee-device-change-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Access Denied! You or other administrator is editing this employee at other place. Would to like to cancel there and continue here?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-employee-device-change-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-employee-device-change-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-employee-device-change-confirm-cancel').attr('data-employee-id', getEmployeeId); //set getEmployeeId
            });
        }
    });

    $(document).on('click', '.customer-get-profile-information', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getCustomerID = $(this).parents('.active-customer-wrapper').attr('data-customer-id');
        var getCustomerStatus = $(this).parents('.active-customer-wrapper').attr('data-status');
        var getCustomerSocketStatus = $(this).parents('.active-customer-wrapper').attr('data-socket-status');
        var reqParams = {
            device_id: crossplat.device.uuid,
            get_by: "id",
            id: getCustomerID
        }
        //get customer details
        customerGet(reqParams)
            .then((result) => {
                //console.log("customerGet result", result);
                if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                    if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_customer_identity_picture}?id=${getCustomerID}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                        result.identity_picture['avtarUrl'] = avtarUrl;
                    }
                }
                if (result.hasOwnProperty('identity_video') && result.identity_video) {
                    if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                        var avtarUrl = `${api.get_customer_identity_picture}?id=${getCustomerID}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.video_id}`;
                        result.identity_video['avtarUrl'] = avtarUrl;
                    }
                }
                var customerData = {
                    customerData: result,
                    customer_type: "customer"
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (getCustomerStatus == "exited") {
                        var modal_data = {
                            modal_id: "customer-profile-view-modal",
                            modal_header: "Customer Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Close",
                                "id": "customer-profile-view-modal-close-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#customer-profile-view-modal').attr('customer_id', getCustomerID);
                            $('#customer-profile-view-modal').attr('customer_socket_status', getCustomerSocketStatus);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    } else {
                        var modal_data = {
                            modal_id: "customer-profile-view-modal",
                            modal_header: "Customer Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Close",
                                "id": "customer-profile-view-modal-close-btn",
                            },
                            {
                                "name": "Edit",
                                "id": "customer-profile-view-modal-edit-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#customer-profile-view-modal').attr('customer_id', getCustomerID);
                            $('#customer-profile-view-modal').attr('customer_socket_status', getCustomerSocketStatus);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    }
                }, "page/customer/customer_profile", "#customer-profile-template", customerData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in customer get API");
            })
    });

    $(document).on('click', '#customer-profile-view-modal-close-btn', function () {
        $('#customer-profile-view-modal').remove();
    });

    $(document).on('click', '#customer-profile-view-modal-edit-btn', function () {
        addLoader();
        var getCustomerId = $('#customer-profile-view-modal').attr('customer_id');
        var getSocketStatus = $("#customer-profile-view-modal").attr('customer_socket_status');
        if (getSocketStatus == "true") {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: getCustomerId,
                data: {
                    socket_enable_status: "false",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            customerUpdate(reqParam)
                .then((response) => {
                    //console.log("customerUpdate", response);
                    sessionStorage.setItem('customer_id', getCustomerId);
                    sessionStorage.setItem('customer_name', `${response.name.first} ${response.name.first}`);
                    $('#customer-profile-view-modal').remove();
                    location.hash = `customer/create`;
                })
                .catch((err) => {
                    //console.log("error in update customer update api", err);
                    if (err.msg == "no updated data found") {
                        sessionStorage.setItem('customer_id', getCustomerId);
                        $('#customer-profile-view-modal').remove();
                        location.hash = `customer/create`;
                    }
                })
        } else {//getSocketStatus is false
            $('#customer-profile-view-modal').remove();
            Materialize.toast(`Access Denied! You or other administrator is editing this customer at other place.`, 3000, "round error-alert");
            var alert_parms = {
                alert_id: "alert-customer-device-change-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Access Denied! You or other administrator is editing this customer at other place. Would to like to cancel there and continue here?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-customer-device-change-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-customer-device-change-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-customer-device-change-confirm-cancel').attr('data-customer-id', getCustomerId); //set getCustomerId
            });
        }
    });

    $(document).on('click', '.associate-customer-get-profile-information', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getAssociateCustomerID = $(this).parents('.customer-associate-customer-assignment-box').attr('data-id');
        var getAssociateCustomerStatus = $(this).parents('.customer-associate-customer-assignment-box').attr('data-status');
        var reqParams = {
            device_id: crossplat.device.uuid,
            get_by: "id",
            id: getAssociateCustomerID
        }
        //get customer details
        associateCustomerGet(reqParams)
            .then((result) => {
                //console.log("associateCustomerGet result", result);
                if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                    if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${getAssociateCustomerID}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                        result.identity_picture['avtarUrl'] = avtarUrl;
                    }
                }
                if (result.hasOwnProperty('identity_video') && result.identity_video) {
                    if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${getAssociateCustomerID}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.video_id}`;
                        result.identity_video['avtarUrl'] = avtarUrl;
                    }
                }
                var customerData = {
                    customerData: result,
                    customer_type: "associate_customer"
                }
                fetch.getHtml(function (fetcherror, html) {
                    if (getAssociateCustomerStatus == "exited") {
                        var modal_data = {
                            modal_id: "associate-customer-profile-view-modal",
                            modal_header: "Associate Customer Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Close",
                                "id": "associate-customer-profile-view-modal-close-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#associate-customer-profile-view-modal').attr('associate_customer_id', getAssociateCustomerID);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    } else {
                        var modal_data = {
                            modal_id: "associate-customer-profile-view-modal",
                            modal_header: "Associate Customer Profile Information",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Close",
                                "id": "associate-customer-profile-view-modal-close-btn",
                            },
                            {
                                "name": "Edit",
                                "id": "associate-customer-profile-view-modal-edit-btn",
                            }]
                        }
                        showModal(modal_data, function () {
                            $('#associate-customer-profile-view-modal').attr('associate_customer_id', getAssociateCustomerID);
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            commonExecutables();
                            removeLoader();
                        });
                    }
                }, "page/customer/customer_profile", "#customer-profile-template", customerData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in customer get API");
            })
    });

    $(document).on('click', '#associate-customer-profile-view-modal-close-btn', function () {
        $('#associate-customer-profile-view-modal').remove();
    });

    $(document).on('click', '#associate-customer-profile-view-modal-edit-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getAssociateCustomerId = $('#associate-customer-profile-view-modal').attr('associate_customer_id');
        $('#associate-customer-profile-view-modal').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "associate_customer_only"
        }
        //get the associate customer identifiers list(for the sake of dropdown)
        customerIdentifierList(reqParam)
            .then((response) => {
                var requestParms = {
                    device_id: crossplat.device.uuid,
                    get_by: "id",
                    id: getAssociateCustomerId
                }
                //get the associate customer data
                associateCustomerGet(requestParms)
                    .then((result) => {
                        if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                            if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${result.id}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                                result.identity_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (result.hasOwnProperty('identity_video') && result.identity_video) {
                            if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${result.id}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                                result.identity_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        var associateCustomerData = {
                            associateCustomerData: result,
                            associateCustomerIdentifierList: response,
                        }
                        //console.log("associateCustomerData", associateCustomerData);
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "edit-associate-customer-modal",
                                modal_header: "Edit Associate Customer",
                                modal_body: html,
                                modal_action_buttons: [{
                                    name: "Save",
                                    attr: [{ name: "id", value: "save-associate-customer-btn" }]
                                }]
                            }
                            showModal(modal_data, function () {
                                removeLoader();
                                mobileFlaginit();
                                calenderInit('#associate_customer_date_of_birth');
                                calenderInit('#associate_customer_wedding_anniversary');
                                //update associate customer identifier dropdown                                
                                if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                    var getIdentifier = response.find((e) => e.id == result.identifier_id);
                                    $('#associate-customer-identifier-choose-select-dropdown').val(getIdentifier.identifier);
                                }
                                $('#edit-associate-customer-modal').attr('data-associate-customer-id', getAssociateCustomerId);
                                $('#edit-associate-customer-modal').attr('data-associate-customer-name', `${result.name.first} ${result.name.last}`);
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/customer/edit_associate_customer', '#edit-associate-customer-template', associateCustomerData);
                    })
                    .catch((err) => {
                        var associateCustomerData = {
                            associateCustomerIdentifierList: response,
                        }
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_platform: crossplat.device.platform,
                                modal_id: "edit-associate-customer-modal",
                                modal_header: "Edit Associate Customer",
                                modal_body: html,
                                modal_action_buttons: [{
                                    name: "Save",
                                    attr: [{ name: "id", value: "save-associate-customer-btn" }]
                                }]
                            }
                            showModal(modal_data, function () {
                                removeLoader();
                                mobileFlaginit();
                                calenderInit('#associate_customer_date_of_birth');
                                calenderInit('#associate_customer_wedding_anniversary');
                                $('#edit-associate-customer-modal').attr('data-associate-customer-id', getAssociateCustomerId);
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/customer/edit_associate_customer', '#edit-associate-customer-template', associateCustomerData);
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No associate customer identifiers found.`, 3000, "round error-alert");
                //console.log("Error in getting associate customer identifiers");
            })
    });

    //on click of filter button in employee list active tab/ on click on filter icon at the bottom of the employee filter page
    $(document).on('click', '.filterbtn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        if ($('body').attr('app') == "employee_creation_list" || $('body').attr('app') == "employee_filter") {
            if ($('body').attr('app') == "employee_creation_list") {
                digibiz.employeeFilterData = {
                    type: [],
                    category: [],
                    designation: [],
                    department: [],
                    status: []
                };
            }
            var reqParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "department"
            }
            departmentList(reqParams)
                .then((response) => {
                    fetch.getHtml(function (fetcherror, html) {
                        var modal_data = {
                            modal_id: "employee-filter-option-modal",
                            modal_header: "Employee Filter - Department",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [
                                {
                                    "name": "Filter By",
                                    "id": "employee-filter-filter-by-btn",
                                },
                                {
                                    "name": "Apply",
                                    "id": "employee-filter-apply-btn",
                                }]
                        }
                        showModal(modal_data, function () {
                            $('.employee-filter-wrapper').attr('id', 'department-list-wrapper');
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                if ($('.modal-popup-content').length > 0) {
                                    //console.log("scroll initiated for modal pop-up class")
                                    appScroll.scrollBar('.modal-popup-content');
                                }
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            processDepartmentList(response, function () {
                                //remove 3 dots button for all designation in the list
                                $('.show-action-department').remove();
                                $('.department-wrapper').addClass('employee-department-filter-btn');
                                if (digibiz.employeeFilterData.department.length > 0) {
                                    $.each(digibiz.employeeFilterData.department, function (index, eachDepartment) {
                                        $(`.employee-department-filter-btn[data-id="${eachDepartment}"]`).addClass('selected-filter');
                                        var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                        $(`.employee-department-filter-btn[data-id="${eachDepartment}"]`).append(checkMark);
                                    })
                                }
                                commonExecutables();
                                setTimeout(function () {
                                    removeLoader();
                                }, 1000);
                            });
                        });
                    }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`Please complete employee configurations.`, 3000, "round error-alert");
                    //console.log("Error in employee type list api");
                })
        }

        if ($('body').attr('app') == "customer_creation_active_list") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                identifier_id: sessionStorage.getItem('identifier_id'),
                list_by: "business_identifier_active_accepted",
                count: 20,
                offset: 0
            }

            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "customer-filter-option-modal",
                    modal_header: "Customer Filter",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [
                        {
                            "name": "Apply",
                            "id": "customer-filter-apply-btn",
                        }]
                }
                showModal(modal_data, function () {
                    $('.employee-filter-wrapper').attr('id', 'customer-list-wrapper');
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    var response = [
                        {
                            "status": "active"
                        },
                        {
                            "status": "inactive"
                        },
                        {
                            "status": "exited"
                        },
                        {
                            "status": "accepted"
                        },
                        {
                            "status": "deleted"
                        }
                    ]

                    processCustomerStatusList(response, function () {
                        $('.employee-type-wrapper').addClass('customer-status-filter-btn');
                        if (digibiz.customerFilterData.status.length > 0) {
                            $.each(digibiz.customerFilterData.status, function (index, eachStatus) {
                                $(`.customer-status-filter-btn[data-customer-status="${eachStatus}"]`).addClass('selected-filter');
                                var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                $(`.customer-status-filter-btn[data-customer-status="${eachStatus}"]`).append(checkMark);
                            })
                        }
                        commonExecutables();
                        setTimeout(function () {
                            removeLoader();
                        }, 1000);
                    });
                });
            }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);

        }

        if ($('body').attr('app') == "employee_group_creation_list") {
            digibiz.groupFilterData = {
                status: []
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "group-filter-option-modal",
                    modal_header: "Group Filter",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [
                        {
                            "name": "Apply",
                            "id": "group-filter-apply-btn",
                        }]
                }
                showModal(modal_data, function () {
                    $('.employee-filter-wrapper').attr('id', 'group-filter-wrapper');
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    var response = [
                        {
                            "status": "active"
                        },
                        {
                            "status": "inactive"
                        },
                        {
                            "status": "draft"
                        },
                        {
                            "status": "pending"
                        }
                    ]

                    processGroupStatusList(response, function () {
                        $('.group-status-wrapper').addClass('group-status-filter-btn');
                        if (digibiz.groupFilterData.status.length > 0) {
                            $.each(digibiz.groupFilterData.status, function (index, eachStatus) {
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).addClass('selected-filter');
                                var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).append(checkMark);
                            })
                        }
                        commonExecutables();
                        setTimeout(function () {
                            removeLoader();
                        }, 1000);
                    });
                });
            }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);

        }
        if ($('body').attr('app') == "team_group_creation_list") {
            digibiz.groupFilterData = {
                status: []
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "group-filter-option-modal",
                    modal_header: "Group Filter",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [
                        {
                            "name": "Apply",
                            "id": "group-filter-apply-btn",
                        }]
                }
                showModal(modal_data, function () {
                    $('.employee-filter-wrapper').attr('id', 'group-filter-wrapper');
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    var response = [
                        {
                            "status": "active"
                        },
                        {
                            "status": "inactive"
                        },
                        {
                            "status": "draft"
                        }

                    ]

                    processGroupStatusList(response, function () {
                        $('.group-status-wrapper').addClass('group-status-filter-btn');
                        if (digibiz.groupFilterData.status.length > 0) {
                            $.each(digibiz.groupFilterData.status, function (index, eachStatus) {
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).addClass('selected-filter');
                                var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).append(checkMark);
                            })
                        }
                        commonExecutables();
                        setTimeout(function () {
                            removeLoader();
                        }, 1000);
                    });
                });
            }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);

        }

        if ($('body').attr('app') == "collaborator_groups_list") {
            digibiz.groupFilterData = {
                status: []
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "group-filter-option-modal",
                    modal_header: "Group Filter",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [
                        {
                            "name": "Apply",
                            "id": "group-filter-apply-btn",
                        }]
                }
                showModal(modal_data, function () {
                    $('.employee-filter-wrapper').attr('id', 'group-filter-wrapper');
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    var response = [
                        {
                            "status": "active"
                        },
                        {
                            "status": "inactive"
                        },
                        {
                            "status": "draft"
                        }

                    ]

                    processGroupStatusList(response, function () {
                        $('.group-status-wrapper').addClass('group-status-filter-btn');
                        if (digibiz.groupFilterData.status.length > 0) {
                            $.each(digibiz.groupFilterData.status, function (index, eachStatus) {
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).addClass('selected-filter');
                                var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).append(checkMark);
                            })
                        }
                        commonExecutables();
                        setTimeout(function () {
                            removeLoader();
                        }, 1000);
                    });
                });
            }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);

        }

        if ($('body').attr('app') == "communication_groups") {
            digibiz.groupFilterData = {
                status: []
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "group-filter-option-modal",
                    modal_header: "Group Filter",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [
                        {
                            "name": "Apply",
                            "id": "group-filter-apply-btn",
                        }]
                }
                showModal(modal_data, function () {
                    $('.employee-filter-wrapper').attr('id', 'group-filter-wrapper');
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    var response = [
                        {
                            "status": "active"
                        },
                        {
                            "status": "inactive"
                        },
                        {
                            "status": "draft"
                        }
                    ]

                    processGroupStatusList(response, function () {
                        $('.group-status-wrapper').addClass('group-status-filter-btn');
                        if (digibiz.groupFilterData.status.length > 0) {
                            $.each(digibiz.groupFilterData.status, function (index, eachStatus) {
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).addClass('selected-filter');
                                var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).append(checkMark);
                            })
                        }
                        commonExecutables();
                        setTimeout(function () {
                            removeLoader();
                        }, 1000);
                    });
                });
            }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);

        }

        if ($('body').attr('app') == "customer_groups_identifiers_list") {
            digibiz.groupFilterData = {
                status: []
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "group-filter-option-modal",
                    modal_header: "Group Filter",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [
                        {
                            "name": "Apply",
                            "id": "group-filter-apply-btn",
                        }]
                }
                showModal(modal_data, function () {
                    $('.employee-filter-wrapper').attr('id', 'group-filter-wrapper');
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    var response = [
                        {
                            "status": "draft"
                        },
                        {
                            "status": "pending"
                        }
                    ]

                    processGroupStatusList(response, function () {
                        $('.group-status-wrapper').addClass('group-status-filter-btn');
                        if (digibiz.groupFilterData.status.length > 0) {
                            $.each(digibiz.groupFilterData.status, function (index, eachStatus) {
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).addClass('selected-filter');
                                var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                                $(`.group-status-filter-btn[data-group-status="${eachStatus}"]`).append(checkMark);
                            })
                        }
                        commonExecutables();
                        setTimeout(function () {
                            removeLoader();
                        }, 1000);
                    });
                });
            }, 'page/employee/employee_filter_options', '#employee-filter-options-template', null);

        }

    });
    //employee filter---> action sheet
    $(document).on('click', '#employee-filter-filter-by-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var action_sheet_parms = {
            action_id: "employee-filter-by-options-action-sheet",
            action_platform: crossplat.device.platform,
            action_title: "Options",
            action_btn: [{
                name: "Type",
                attr: [{ name: "id", value: "employee_filter_by_type" }]
            },
            {
                name: "Category",
                attr: [{ name: "id", value: "employee_filter_by_category" }]
            },
            {
                name: "Designation",
                attr: [{ name: "id", value: "employee_filter_by_designation" }]
            },
            {
                name: "Department",
                attr: [{ name: "id", value: "employee_filter_by_department" }]
            },
            {
                name: "Status",
                attr: [{ name: "id", value: "employee_filter_by_status" }]
            }
            ]
        }
        showAction(action_sheet_parms, function () {
            removeLoader();
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
        });
    });
    //employee filter---> apply button
    $(document).on('click', '#employee-filter-apply-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        if ($('body').attr('app') == "employee_creation_list") {
            if (digibiz.employeeFilterData.category.length > 0 || digibiz.employeeFilterData.designation.length > 0 || digibiz.employeeFilterData.department.length > 0 || digibiz.employeeFilterData.type.length > 0 || digibiz.employeeFilterData.status.length > 0) {
                location.hash = `employee_filter`;
            } else {
                removeLoader();
                Materialize.toast(`Error! Please select atleast one option to filter`, 2000, "round error-alert");
            }
        } else {
            if (digibiz.employeeFilterData.category.length > 0 || digibiz.employeeFilterData.designation.length > 0 || digibiz.employeeFilterData.department.length > 0 || digibiz.employeeFilterData.type.length > 0 || digibiz.employeeFilterData.status.length > 0) {
                fetch.replaceHtml(function () {
                    departmentWiseEmployessListPage()
                        .then(() => {
                            commonExecutables();
                            removeLoader();
                        })
                        .catch((err) => {
                            removeLoader();
                        });
                }, "page/employee/department_wise_employees_list_wrapper", "#department-wise-employees-list-wrapper-template", "#main-content-wrapper", null);
            } else {
                removeLoader();
                Materialize.toast(`Error! Please select atleast one option to filter`, 2000, "round error-alert");
            }

        }
        // var reqParams = {
        //     device_id: crossplat.device.uuid,
        //     type: digibiz.employeeFilterData.type,
        //     category: digibiz.employeeFilterData.category,
        //     designation: digibiz.employeeFilterData.designation,
        //     departments: digibiz.employeeFilterData.department,
        // }
        // employeeFilter(reqParams)
        //     .then((response) => {
        //         //console.log("response", response);
        //         $('#employee-filter-option-modal').remove();                
        //     })
        //     .catch((err) => {
        //         $('#employee-filter-option-modal').remove();
        //         removeLoader();
        //         Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
        //         //console.log("Error in employee filter api");
        //     })
    });


    //employee filter--> filter by category
    $(document).on('click', '#employee_filter_by_category', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#employee-filter-by-options-action-sheet').remove();
        $('.employee-filter-wrapper').attr('id', 'employee-category-list-wrapper');
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
        }
        employeeCategoryList(reqParams)
            .then((response) => {
                processEmployeeCategoryList(response, function () {
                    $('#add-employee-category').remove();
                    //remove 3 dots button for all category in the list
                    $('.show-action-employee-category-data').remove();
                    $('.employee-category-wrapper').addClass('employee-category-filter-btn');
                    if (digibiz.employeeFilterData.category.length > 0) {
                        $.each(digibiz.employeeFilterData.category, function (index, eachCategory) {
                            $(`.employee-category-filter-btn[data-employee-category-id="${eachCategory}"]`).addClass('selected-filter');
                            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                            $(`.employee-category-filter-btn[data-employee-category-id="${eachCategory}"]`).append(checkMark);
                        })
                    }
                    commonExecutables();
                    setTimeout(function () {
                        removeLoader();
                    }, 1000);
                });
            })
            .catch((err) => {
                removeLoader();
                $('#add-employee-category').remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in employee category list api");
            })
    });
    //employee filter--> filter by type
    $(document).on('click', '#employee_filter_by_type', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#employee-filter-by-options-action-sheet').remove();
        $('.employee-filter-wrapper').attr('id', 'employee-types-list-wrapper');
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
        }
        employeeTypeList(reqParams)
            .then((response) => {
                processEmployeeTypesList(response, function () {
                    $('#add-employee-type').remove();
                    $('.show-action-employee-type-data').remove();
                    $('.employee-type-wrapper').addClass('employee-type-filter-btn');
                    if (digibiz.employeeFilterData.type.length > 0) {
                        $.each(digibiz.employeeFilterData.type, function (index, eachType) {
                            $(`.employee-type-filter-btn[data-employee-type-id="${eachType}"]`).addClass('selected-filter');
                            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                            $(`.employee-type-filter-btn[data-employee-type-id="${eachType}"]`).append(checkMark);
                        })
                    }
                    commonExecutables();
                    setTimeout(function () {
                        removeLoader();
                    }, 1000);
                });
            })
            .catch(() => {
                removeLoader();
                $('#add-employee-type').remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in employee category list api");
            })
    });

    //employee filter--> filter by designation
    $(document).on('click', '#employee_filter_by_designation', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#employee-filter-by-options-action-sheet').remove();
        $('.employee-filter-wrapper').attr('id', 'employee-designation-list-wrapper');
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
        }
        employeeDesignationList(reqParams)
            .then((response) => {
                processEmployeeDesignationList(response, function () {
                    $('#add-employee-designation').remove();
                    //remove 3 dots button for all designation in the list
                    $('.show-action-employee-designation-data').remove();
                    $('.employee-designation-wrapper').addClass('employee-designation-filter-btn');
                    if (digibiz.employeeFilterData.designation.length > 0) {
                        $.each(digibiz.employeeFilterData.designation, function (_i, eachDesignation) {
                            $(`.employee-designation-filter-btn[data-employee-designation-id="${eachDesignation}"]`).addClass('selected-filter');
                            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                            $(`.employee-designation-filter-btn[data-employee-designation-id="${eachDesignation}"]`).append(checkMark);
                        })
                    }
                    commonExecutables();
                    setTimeout(function () {
                        removeLoader();
                    }, 1000);
                });
            })
            .catch(function () {
                removeLoader();
                $('#add-employee-designation').remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in employee designation list api");
            })
    });
    //employee filter--> filter by department
    $(document).on('click', '#employee_filter_by_department', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#employee-filter-by-options-action-sheet').remove();
        $('.employee-filter-wrapper').attr('id', 'department-list-wrapper');
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "department"
        }
        departmentList(reqParams)
            .then((response) => {
                processDepartmentList(response, function () {
                    $('#add-department').remove();
                    //remove 3 dots button for all designation in the list
                    $('.show-action-department').remove();
                    $('.department-wrapper').addClass('employee-department-filter-btn');
                    if (digibiz.employeeFilterData.department.length > 0) {
                        $.each(digibiz.employeeFilterData.department, (_index, eachDesignation) => {
                            $(`.employee-department-filter-btn[data-id="${eachDesignation}"]`).addClass('selected-filter');
                            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                            $(`.employee-department-filter-btn[data-id="${eachDesignation}"]`).append(checkMark);
                        })
                    }
                    commonExecutables();
                    setTimeout(function () {
                        removeLoader();
                    }, 1000);
                });
            })
            .catch((err) => {
                removeLoader();
                $('#add-department').remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in department list api");
            })
    });


    //employee type--> selection filter
    $(document).on('click', '.employee-type-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getEmployeeTypeId = $(this).attr('data-employee-type-id');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.employeeFilterData.type.push(getEmployeeTypeId);
            digibiz.employeeFilterData.type = digibiz.employeeFilterData.type.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.employeeFilterData.type = digibiz.employeeFilterData.type.filter(function (element) {
                return element != getEmployeeTypeId;
            });
        }
    });
    //employee category--> selection filter
    $(document).on('click', '.employee-category-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getEmployeeCategoryId = $(this).attr('data-employee-category-id');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.employeeFilterData.category.push(getEmployeeCategoryId);
            digibiz.employeeFilterData.category = digibiz.employeeFilterData.category.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.employeeFilterData.category = digibiz.employeeFilterData.category.filter(function (element) {
                return element != getEmployeeCategoryId;
            });
        }
    });
    //employee designation--> selection filter
    $(document).on('click', '.employee-designation-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getEmployeeDesignationId = $(this).attr('data-employee-designation-id');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.employeeFilterData.designation.push(getEmployeeDesignationId);
            digibiz.employeeFilterData.designation = digibiz.employeeFilterData.designation.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.employeeFilterData.designation = digibiz.employeeFilterData.designation.filter(function (element) {
                return element != getEmployeeDesignationId;
            });
        }
    });
    //employee department--> selection filter
    $(document).on('click', '.employee-department-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getEmployeeDepartmentId = $(this).attr('data-id');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.employeeFilterData.department.push(getEmployeeDepartmentId);
            digibiz.employeeFilterData.department = digibiz.employeeFilterData.department.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.employeeFilterData.department = digibiz.employeeFilterData.department.filter(function (element) {
                return element != getEmployeeDepartmentId;
            });
        }
    });

    //employee type--> selection filter
    $(document).on('click', '.employee-status-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getEmployeeTypeId = $(this).attr('data-employee-status');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.employeeFilterData.status.push(getEmployeeTypeId);
            digibiz.employeeFilterData.status = digibiz.employeeFilterData.status.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.employeeFilterData.status = digibiz.employeeFilterData.status.filter(function (element) {
                return element != getEmployeeTypeId;
            });
        }
    });


    //employee filter--> filter by type
    $(document).on('click', '#employee_filter_by_status', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('#employee-filter-by-options-action-sheet').remove();
        $('.employee-filter-wrapper').attr('id', 'employee-status-list-wrapper');
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
        }
        // employeeTypeList(reqParams)
        //     .then((response) => {
        var response = [
            {
                "status": "active"
            },
            {
                "status": "inactive"
            },
            {
                "status": "unassigned"
            },
            {
                "status": "exited"
            },
            {
                "status": "accepted"
            }
        ]
        processEmployeeStatusList(response, function () {
            $('#add-employee-type').remove();
            $('.show-action-employee-type-data').remove();
            $('.employee-type-wrapper').addClass('employee-status-filter-btn');
            if (digibiz.employeeFilterData.status.length > 0) {
                $.each(digibiz.employeeFilterData.status, function (index, eachStatus) {
                    $(`.employee-status-filter-btn[data-employee-status="${eachStatus}"]`).addClass('selected-filter');
                    var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
                    $(`.employee-status-filter-btn[data-employee-status="${eachStatus}"]`).append(checkMark);
                })
            }
            commonExecutables();
            setTimeout(function () {
                removeLoader();
            }, 1000);
        });
        // })
        // .catch(() => {
        //     removeLoader();
        //     $('#add-employee-type').remove();
        //     Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
        //     //console.log("Error in employee category list api");
        // })
    });

    $(document).on('click', '#new_landing_page', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        location.hash = `digibiz/home`;
    });



    //new staging app changes required

    $(document).on('click', '.role-btn', function (event) {
        console.log("role-btn clicked")
        event.stopImmediatePropagation();
        // if (isDoubleClicked($(this))) return;
        addLoader();
        var $this = $(this);
        var currentid = $($this).attr('id');
        $($this).addClass('active').siblings('.role-btn').removeClass('active');
        sessionStorage.setItem('get_role_btn', currentid)
        console.log("currentid", currentid);
        switch (currentid) {
            case 'jeevi-role-btn':
                console.log("switch --> jeevi-role-btn")
                removeLoader();
                if (isDoubleClicked($(this))) return;
                sessionStorage.setItem('digibiz_role', 'prospect');
                // if ($('body').attr('app') == "jeevi_app_hub_page") {
                //     removeLoader();
                // } else {
                console.log("switch -->yes")

                location.hash = `jeevi/app/hub`;
                console.log('fwefwef');
                // }
                break;
            case 'business-role-btn':
                console.log("switch --> business-role-btn")
                removeLoader();
                if (isDoubleClicked($(this))) return;
                sessionStorage.setItem('digibiz_role', 'business_owner');
                // if ($('body').attr('app') == "business_owner_business_list") {
                //     removeLoader();
                // } else {
                console.log("switch -->yes")

                location.hash = `business_owner/business/list`;
                // }
                break;
            case 'employee-role-btn':
                console.log("switch --> employee-role-btn")
                removeLoader();
                if (isDoubleClicked($(this))) return;
                sessionStorage.setItem('digibiz_role', 'employee');
                // if ($('body').attr('app') == "employee_business_list") {
                //     removeLoader();
                // } else {
                console.log("switch -->yes")

                location.hash = `employee/business/list`;
                // }
                break;
            case 'customer-role-btn':
                console.log("switch --> customer-role-btn")
                removeLoader();
                if (isDoubleClicked($(this))) return;
                sessionStorage.setItem('digibiz_role', 'customer');
                // if ($('body').attr('app') == "customer_business_list") {
                //     removeLoader();
                // } else {
                console.log("switch -->yes")

                location.hash = `customer/business/list`;
            // }
            case 'profile-btn':
                console.log("switch --> profile-role-btn")
                removeLoader();
                if (isDoubleClicked($(this))) return;
                // if ($('body').attr('app') == "digibiz_profile") {
                //     removeLoader();
                // } else {
                console.log("switch -->yes")

                location.hash = `digibiz/profile`;
            // }
        }
    });

    //logout button click event
    $(document).on('click', '#logout-btn', function () {
        console.log("clicked on logout-btn")
        addLoader();
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            var alert_parms = {
                alert_id: "alert-logout-btn",
                alert_platform: crossplat.device.platform,
                alert_title: "LOGOUT",
                alert_body: `Are you sure you want to logout?`,
                alert_btn: [{
                    name: "Cancel",
                    attr: [{ name: "id", value: "alert-logout-btn-no" }]
                },
                {
                    name: "Logout",
                    attr: [{ name: "id", value: "alert-logout-btn-yes" }]
                }]
            }
            showAlert(alert_parms, function () {
                //console.log("check", sessionStorage.getItem("is_mobile"))
                removeLoader();
            });
        } else {
            var alert_parms = {
                alert_id: "alert-logout-btn",
                alert_platform: crossplat.device.platform,
                alert_title: "LOGOUT",
                alert_body: `Are you sure?`,
                alert_btn: [{
                    name: "Cancel",
                    attr: [{ name: "id", value: "alert-logout-btn-no" }]
                },
                {
                    name: "Logout",
                    attr: [{ name: "id", value: "alert-logout-btn-yes" }]
                }]
            }
            showAlert(alert_parms, function () {
                //console.log("check", sessionStorage.getItem("is_mobile"))
                removeLoader();
            });
        }
    });

    $(document).on('click', '#alert-logout-btn-no', function () {
        $('#alert-logout-btn').remove();
    });

    $(document).on('click', '#alert-logout-btn-yes', function () {
        addLoader();
        $('#alert-logout-btn').remove();
        var requestParams = {
            device_id: crossplat.device.uuid,
            app: "business"
        }
        fetch.apiCall(function (response, status, xhr) {
            removeLoader();
            if (status === "success") {
                sockets.coreSocket.emit('joinroom', crossplat.device.uuid);
                sockets.coreSocket.emit('leaveroom', sessionStorage.getItem('socketID'));
                sessionStorage.clear();
                // location.hash = '#login';
                setTimeout(function () {
                    deviceHelper.navigateToAccounts('core');
                }, 1000);
            } else {
                var jsonResponse = JSON.parse(response.responseText);
                Materialize.toast(jsonResponse.message, 3000, 'round error-alert');
            }
        }, api.logout, "POST", "JSON", requestParams);
    });

    //request button click event
    $(document).on('click', '#request-btn', function () {
        addLoader();
        location.hash = `digibiz/notifications`;
    });

    //qr scanner click event(only in mobile)
    $(document).on('click', '#qrcode-icon', function () {
        addLoader();
        console.log("clicked scanner", config['apps']['accounts'] + "#jeevi/authorize_device");
        deviceHelper.navigateToAccounts('core', { purpose: 'authorize_device', ref_app: 'business' });
        // location.hash = '#jeevi/authorize_device';
        // localStorage.setItem('purpose', 'device_scan');
        // setTimeout(function () {
        //     console.log("clicked scanner 111")
        //     deviceHelper.navigateToAccounts('core');
        // }, 1000);
        // location.href = config['apps']['accounts'] + "#jeevi/authorize_device"
    });

    //prfile page back button click event
    // $(document).on('click', '#profile-page-back-btn', function () {
    //     window.history.back();
    // });

    //profile data page click event
    $(document).on('click', '#profile-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        deviceHelper.navigateToAccounts('core', { purpose: 'jeevi_profile', ref_app: 'business' });
        // sessionStorage.setItem('__APPSTATUS', 'NAVIGATE');
        // sessionStorage.setItem('__NAVIGATE_FROM', from);
        // sessionStorage.setItem('__NAVIGATE_PARMS', JSON.stringify(params));
        // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //     location.href = `https://apps.digitaljeevi.com/#profile/jeevi`;
        // } else {
        //     location.href = config['apps']['accounts'] + "#profile/jeevi"
        // }
    });

    //devices page click event
    $(document).on('click', '#devices-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        deviceHelper.navigateToAccounts('core', { purpose: 'devices', ref_app: 'business' });
        // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //     location.href = `https://apps.digitaljeevi.com/#devices`;
        // } else {
        //     //console.log("check", config['apps']['accounts'] + "#devices")
        //     location.href = config['apps']['accounts'] + "#devices"
        // }
    });

    //password page click event
    $(document).on('click', '#password-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        deviceHelper.navigateToAccounts('core', { purpose: 'settings_security', ref_app: 'business' });
        // if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //     location.href = `https://apps.digitaljeevi.com/#settings/security`;
        // } else {
        //     location.href = config['apps']['accounts'] + "#settings/security"
        // }
    });

    //accounts page click event
    $(document).on('click', '#accounts-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/accounts`;
    });

    //accounts page back button click event
    $(document).on('click', '#digibiz_accounts_settings_back_btn', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/profile`;
    });

    //storage page click event
    $(document).on('click', '#storage-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/account/storage`;
    });

    //my credentials page click event
    $(document).on('click', '#credentials-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/credentials`;
    });

    //activity page click event
    $(document).on('click', '#activity-page-data', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/activity`;
    });

    //activity page back button click
    $(document).on('click', '#digibiz_activity_hub_back_btn', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/profile`;
    });

    // $(document).on('click', '#close-jeevi-account-inactive', function (e) {
    //     $('#jeevi-account-inactive').remove();
    // });

    // $(document).on('click', '#activate-jeevi-account', function (e) {
    //     addLoader();
    //     var getAccountDetails = JSON.parse(sessionStorage.getItem('accountDetails'));
    //     //console.log("getAccountDetails", getAccountDetails);
    //     var getData = {
    //         jeevi_account_status: getAccountDetails.roles.prospect,
    //         account_settings: result.Data.settings
    //     }
    //     //console.log("getData", getData);
    //     fetch.getHtml(function (fetcherror, html) {
    //         var modal_data = {
    //             modal_id: "jeevi-account-inactive-active-settings",
    //             modal_header: "Active/Inactive",
    //             modal_platform: crossplat.device.platform,
    //             modal_body: html,
    //             modal_action_buttons: [{
    //                 "name": "Activate",
    //                 "id": "add-jeevi-account-inactive-data",
    //             }]
    //         }
    //         showModal(modal_data, function () {
    //             $('#jeevi-account-inactive').remove();
    //             if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                 $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                 if ($('.modal-popup-content').length > 0) {
    //                     //console.log("scroll initiated for modal pop-up class")
    //                     appScroll.scrollBar('.modal-popup-content');
    //                 }
    //             } else {
    //                 $('.custom-modal-popup').show().addClass('modal-slide-top');
    //             }
    //             if (getData.account_status == "inactive" || getData.account_status == "inactive_pending") {
    //                 $('.account-inactive-start-end-date-time').removeClass('hide');
    //             }
    //             if ($(`.custom-modal-popup[id="jeevi-account-inactive-active-settings"]`).length > 1) {
    //                 $(`.custom-modal-popup[id="jeevi-account-inactive-active-settings"]:last`).remove();
    //             }
    //             commonExecutables();
    //             removeLoader();
    //         });
    //     }, 'page/common/active_inactive_jeevi_account', '#active_inactive_jeevi_account-template', getData);
    // });

    $(document).on('click', '.customer_identifier_radio_btn', function () {
        var getIdentifier = $(this).parents('.choose-customer-identifier-box').attr('data-identifier-id');
        sessionStorage.setItem('identifier_id', getIdentifier);
        console.log('chaange', getIdentifier);
    });

    $(document).on('click', '#choose-customer-identifier-confirm-button', function (e) {
        if (sessionStorage.getItem('identifier_id') == null || sessionStorage.getItem('identifier_id') == undefined || sessionStorage.getItem('identifier_id') == "") {
            //console.log("empty");
            removeLoader();
            Materialize.toast("Please select a identifier", 3000, 'round error-alert');
        } else {
            $(`#choose-customer-identifier-modal`).remove();
            removeLoader();
            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                location.hash = `customer/create`;
            } else {//android/ios
                var action_sheet_parms = {
                    action_id: "customer_creation_by_selection_modal",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "By Notification",
                        attr: [{ name: "id", value: "customer_by_notification" }]
                    },
                    {
                        name: "By QR-code",
                        attr: [{ name: "id", value: "customer_by_qr_code" }]
                    }
                    ]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                });
            }
        }
    });

    $(document).on('click', '#btn-invalid-qr-code-ok', function (e) {
        $('#alert-invalid-qr-code-cancel').remove();
    });

    $(document).on('click', '#continue-account-confirmation', function () {
        console.log("clicked continue as button")
        addLoader();
        var data = {};
        data[config.build_name] = {
            user_id: sessionStorage.getItem('user_id'),
            role: config.build_name
        };
        setServerSession(crossplat.device.uuid, data, function (session) {
            removeLoader();
            // if (location.hash == "digibiz/account/storage") {
            //     location.hash = `digibiz/account/storage`;
            // } else {
            router.navigateUri(app.indexRoute);
            // }
        });
    });


    //my credentials page click events
    $(document).on('click', '#transaction_picture_add_btn', function (e) {
        console.log("clicked + button for transaction")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('.credentials-pictures-container').removeClass('active');
        var validateData = validateTransactionPictureData();
        console.log("validateData", validateData);
        if (validateData) {
            var action_parms = {
                action_id: "action-credentials-pictures-upload-attachments-options",
                action_platform: crossplat.device.platform,
                action_title: "Attachment Types",
                action_btn: [
                    {
                        name: "Device Upload",
                        attr: [{ name: "class", value: "action-credentials-pictures-upload-attachment-device-upload-btn" }]
                    },
                    {
                        name: "Cloud Upload",
                        attr: [{ name: "class", value: "digibiz-filemanager" }, { name: "class", value: "action-credentials-pictures-upload-attachment-cloud-upload-btn" }]
                    },
                    {
                        name: "Camera",
                        attr: [{ name: "class", value: "action-credentials-pictures-upload-attachment-camera-btn" }]
                    }]
            };
            showAction(action_parms, function () {
                $('#action-credentials-pictures-upload-attachments-options').attr('upload-for', 'transaction_picture')
                removeLoader();
            });
        } else {
            var alert_parms = {
                alert_id: "modal-reached-maximum-credential-pictures",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `Failed! You have reached a maximum of ${config.transactionPictureMaxLength} transaction pictures.`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "alert-reached-maximum-credential-pictures-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
            });
        }
    });

    $(document).on('click', '#signature_picture_add_btn', function (e) {
        console.log("clicked + button for signature")
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $('.credentials-pictures-container').removeClass('active');
        var validateData = validateSignaturePictureData();
        console.log("validateData", validateData);
        if (validateData) {
            var action_parms = {
                action_id: "action-credentials-pictures-upload-attachments-options",
                action_platform: crossplat.device.platform,
                action_title: "Attachment Types",
                action_btn: [
                    {
                        name: "Device Upload",
                        attr: [{ name: "class", value: "action-credentials-pictures-upload-attachment-device-upload-btn" }]
                    },
                    {
                        name: "Cloud Upload",
                        attr: [{ name: "class", value: "digibiz-filemanager" }, { name: "class", value: "action-credentials-pictures-upload-attachment-cloud-upload-btn" }]
                    },
                    {
                        name: "Camera",
                        attr: [{ name: "class", value: "action-credentials-pictures-upload-attachment-camera-btn" }]
                    }]
            };
            showAction(action_parms, function () {
                $('#action-credentials-pictures-upload-attachments-options').attr('upload-for', 'signature_picture')
                removeLoader();
            });
        } else {
            var alert_parms = {
                alert_id: "modal-reached-maximum-credential-pictures",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `Failed! You have reached a maximum of ${config.signaturePictureMaxLength} transaction pictures.`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "alert-reached-maximum-credential-pictures-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
            });
        }
    });

    $(document).on('click', '#alert-reached-maximum-credential-pictures-ok', function () {
        $('#modal-reached-maximum-credential-pictures').remove();
    });

    //device upload for credentials picture both transaction and signature
    $(document).on('click', '.action-credentials-pictures-upload-attachment-device-upload-btn', function () {
        $('#credentials_pictures_device_upload').val("");
        $('#credentials_pictures_device_upload').trigger('click');
        var getUploadFor = $('#action-credentials-pictures-upload-attachments-options').attr('upload-for');
        if (getUploadFor == "transaction_picture") {
            $('#transaction_pictures_main_container').addClass('active');
        } else if (getUploadFor == "signature_picture") {
            $('#signature_pictures_main_container').addClass('active');
        }
        $('#action-credentials-pictures-upload-attachments-options').remove();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "business-credential-picture-modal",
            modal_header: "Crop Image",
            modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
            modal_action_buttons: [{
                id: "business-credential-picture-crop-button",
                name: `crop`,
                attr: [{
                    name: "data-id",
                    value: ''
                }]
            }]
        }
        showModal(modal_data, function () {
            removeLoader();
            if ($('.modal-popup-content').length > 0) {
                if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                    // //console.log("scroll initiated for modal pop-up class")
                    // appScroll.scrollBar('.modal-popup-content');
                }
            }
            $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
            $('#business-credential-picture-modal').attr('picture-type', getUploadFor);
        });
    });

    //on change business device upload button multimedia
    $(document).on('change', '#credentials_pictures_device_upload', function () {
        var files = this.files;
        //console.log("files", files);
        if (files[0]) {
            //console.log("files[0]", files[0]);
            var fileExtension = files[0].name.split(".").pop();
            //console.log("fileExtension", fileExtension)
            var fileType = files[0].type.split("/")[0];
            //console.log("fileType", fileType);
            var fileExtension2 = files[0].type.split("/")[1];
            //console.log("fileExtension2", fileExtension2)
            //validation file format
            if (!(config.identityPictureFileFormat.includes(fileExtension.toLowerCase()))) {
                var alert_body_template = `<div class="alert-invalid-attachment-container">This files is an invalid file type..try uploading other file</div>`;
                var alert_parms = {
                    alert_id: "alert-invalid-attachment",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Invalid Attachment",
                    alert_body: alert_body_template,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "btn-invalid-attachment-ok" }]
                    },
                    ]
                }
                showAlert(alert_parms, function () {
                })
            }
            //validation total size            
            else if (files[0].size > config.maxSizeAllowMultiMediaFiles) {
                var alert_body_template = `<div class="alert-exceeded-size-attachment-container">This file is exceeding max size allowed..Try uploading file less than 20MB </div>`;
                var alert_parms = {
                    alert_id: "alert-exceeded-size-attachment",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Invalid Attachment",
                    alert_body: alert_body_template,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "btn-exceeded-size-attachment-ok" }]
                    },
                    ]
                }
                showAlert(alert_parms, function () {
                })
            } else {
                //console.log("files[0]", files[0])
                var file_name = files[0].name;
                //console.log("file_name", file_name)
                var photo = files[0];
                //console.log("photo", photo);
                var reader = new FileReader();
                //console.log("reader", reader);
                reader.onload = function (event) {
                    var image = $('#image_cropper')[0];
                    image.src = event.target.result;
                    $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    digibiz.cropper = new Cropper(image, {
                        viewMode: 2,
                        aspectRatio: 1 / 1,
                        minContainerWidth: 72,
                        minContainerHeight: 72,
                        minCropBoxWidth: 72,
                        minCropBoxHeight: 72,
                        maxWidth: 100,
                        maxHeight: 400,
                        zoomable: true,
                        rotatable: true,
                        responsive: true,
                        movable: true,
                        ready: function () {
                            //cropper.zoom(-0.6);
                        }
                    });
                };
                reader.readAsDataURL(photo);
            }
        }
    });

    //on click of save button in the cropper, it should create a thumbnail and then the original and the thumbnail should be written to the common dj cloud
    $(document).on('click', '#business-credential-picture-crop-button', function () {
        addLoader();
        var getType = $('#business-credential-picture-modal').attr('picture-type');
        console.log("getType", getType);
        digibiz.cropper.getCroppedCanvas().toBlob((blob) => {
            var reader = new FileReader();
            reader.onloadend = function (event) {
                var result = event.target.result;
                savebusinessCredentialPicture(reader.result, getType, function (err, businessDisplayPictureResponse) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        console.log("businessDisplayPictureResponse", businessDisplayPictureResponse);
                        //add picture in the container
                        var getPictureContainer = `<div class="transaction_signature_picture_contentbox">
                                                        <div class="multimedia-container">        
                                                            <div class="multimedia_wrapper">
                                                                <div class="identity-picture-wrapper view">   
                                                                    <img class="attached-img transaction_signature_container" id="${businessDisplayPictureResponse.id}" thumbnail_id="${businessDisplayPictureResponse.picture_details.thumbnail}" data-status="${businessDisplayPictureResponse.status.status}" type="${getType}" src="${reader.result}"/>                             
                                                                </div>
                                                            </div>    
                                                        </div>
                                                    </div>`;
                        console.log("getPictureContainer", getPictureContainer);
                        if (getType == "transaction_picture") {
                            $('#transaction_pictures_main_container').append(getPictureContainer);
                        } else if (getType == "signature_picture") {
                            $('#signature_pictures_main_container').append(getPictureContainer);
                        }
                        $('#business-credential-picture-modal').remove();
                        removeLoader();
                        digibiz.cropper.destroy();
                    }
                });
            }
            reader.readAsDataURL(blob);
        })
    });

    //camera option for transaction and signature picture for jeevi role
    $(document).on('click', '.action-credentials-pictures-upload-attachment-camera-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        $('#credentials_pictures_device_upload').val("");
        var getUploadFor = $('#action-credentials-pictures-upload-attachments-options').attr('upload-for');
        if (getUploadFor == "transaction_picture") {
            $('#transaction_pictures_main_container').addClass('active');
        } else if (getUploadFor == "signature_picture") {
            $('#signature_pictures_main_container').addClass('active');
        }
        $('#action-credentials-pictures-upload-attachments-options').remove();

        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_id: "camera-modal",
                    modal_header: "Camera",
                    modal_platform: crossplat.device.platform,
                    modal_body: html
                }
                showModal(modal_data, function () {
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    // if ($('.modal-popup-content').length > 0) {
                    //     //console.log("scroll initiated for modal pop-up class")
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }     
                    $('#camera-modal').attr('camera-for', getUploadFor);
                    $('#modal-close-btn').addClass('hide');
                    const vgaConstraints = { video: true };
                    navigator.mediaDevices.getUserMedia(vgaConstraints).then(function (stream) {
                        //global stream
                        window.camerastream = stream;
                        //remove Hide class from upload preview
                        //console.log("check", $(`.upload-preview-wrapper[data-for="camera_modal"]`));
                        if ($(`.upload-preview-wrapper[data-for="camera_modal"]`).hasClass('hide')) {
                            $(`.upload-preview-wrapper[data-for="camera_modal"]`).removeClass('hide').addClass('slide-top');
                        }
                        //Change Title
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-header span").text("Capture Photo");
                        // $("#file-manager-container").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container").removeClass('hide');
                        // $(".file-manager-footer").addClass('hide');
                        //hide send button, caption & add button
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-container-file-caption").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find(".upload-preview-footer").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-permission-btn").addClass('hide');
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find('#upload-preview-container-text-box').text("");
                        $(`.upload-preview-wrapper[data-for="camera_modal"]`).find("#upload-file-preview").html(`<video id="capture-video" class="preview-file" autoplay></video><button id="camera-capture" class="btn-floating btn-large waves-effect waves-light blue cursor-pointer"><i class="material-icons">photo_camera</i></button>`);
                        //show preview
                        var videoElement = document.querySelector('#capture-video');
                        // var videoElement = $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).find("#capture-video");
                        //console.log("videoElement", videoElement);
                        videoElement.srcObject = stream;
                        videoElement.play();
                    });
                    removeLoader();
                });
            }, 'page/common/camera', '#camera-template', null);
        } else {
            //andriod
            // capture callback
            var captureSuccess = function (mediaFiles) {
                addLoader();
                var i, path, viewPath, len;
                for (i = 0, len = mediaFiles.length; i < len; i += 1) {
                    path = mediaFiles[i].localURL;
                    // viewPath = window.Ionic.WebView.convertFileSrc(mediaFiles[i].fullPath);
                    window.cameraMediaFile = path;
                    //revoke stream(stop device)
                    if (window.camerastream) {
                        window.camerastream.getTracks()[0].stop();
                    }

                    //CROPPER MODAL
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "business-credential-picture-modal",
                        modal_header: "Crop Image",
                        modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                        modal_action_buttons: [{
                            id: "business-credential-picture-crop-button",
                            name: `crop`,
                            attr: [{
                                name: "data-id",
                                value: ''
                            }]
                        }]
                    }
                    showModal(modal_data, function () {
                        removeLoader();
                        if ($('.modal-popup-content').length > 0) {
                            if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                                // //console.log("scroll initiated for modal pop-up class")
                                // appScroll.scrollBar('.modal-popup-content');
                            }
                        }
                        $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                        $('#business-credential-picture-modal').attr('picture-type', getUploadFor);
                    });

                    setTimeout(function () {
                        var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                        //console.log("123 check", window.cameraMediaFile);
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            //console.log("entry", entry)
                            entry.file(function (file) {
                                //console.log("file", file);
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    //console.log("readerEvent", readerEvent)
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            //console.log("image", image);
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            //console.log("complete")
                                            removeLoader();
                                        } else {
                                            //console.log("12345")
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }, 500);
                };
            };
            // capture error callback
            var captureError = function (error) {
                navigator.notification.alert('Error code: ' + error.code, null, 'Capture Error');
                removeLoader();
            };
            // start image capture            
            navigator.device.capture.captureImage(captureSuccess, captureError, { quality: 0.5 });
            removeLoader();
        }
    });

    $(document).on('click', '#digibiz_credentials_back_btn', function (e) {
        console.log("back button clciked for credentials")
        e.stopImmediatePropagation();
        addLoader();
        location.hash = `digibiz/profile`;
    });

    $(document).on('click', '.view-transaction-signature-picture', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var $this = $(this);
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: $($this).attr('id'),
        }
        getRecordTransactionSignaturePicture(requestParams)
            .then((response) => {
                console.log("response", response);
                if (response.picture_used == "yes") {
                    if (response.status.status == "active") {
                        var action_sheet_parms = {
                            action_id: "transaction_signature_picture_options",
                            action_platform: crossplat.device.platform,
                            action_title: "Options",
                            action_btn: [{
                                name: "View",
                                attr: [{ name: "id", value: "transaction_signature_picture_view" }]
                            },
                            {
                                name: "Inactivate",
                                attr: [{ name: "id", value: "transaction_signature_picture_inactivate" }]
                            },
                            {
                                name: "Logs",
                                attr: [{ name: "id", value: "transaction_signature_picture_logs" }]
                            }]
                        }
                        showAction(action_sheet_parms, function () {
                            removeLoader();
                            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                            $("#transaction_signature_picture_options").attr('data-id', $($this).attr('id'));
                            $("#transaction_signature_picture_options").attr('image_id', response.picture_details.picture_id);//picture_id(original pic) because record got
                        });
                    } else {
                        var action_sheet_parms = {
                            action_id: "transaction_signature_picture_options",
                            action_platform: crossplat.device.platform,
                            action_title: "Options",
                            action_btn: [{
                                name: "View",
                                attr: [{ name: "id", value: "transaction_signature_picture_view" }]
                            },
                            {
                                name: "Logs",
                                attr: [{ name: "id", value: "transaction_signature_picture_logs" }]
                            }]
                        }
                        showAction(action_sheet_parms, function () {
                            removeLoader();
                            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                            $("#transaction_signature_picture_options").attr('data-id', $($this).attr('id'));
                            $("#transaction_signature_picture_options").attr('image_id', response.picture_details.picture_id);//picture_id(original pic) because record got
                        });
                    }
                } else if (response.picture_used == "no") {
                    var action_sheet_parms = {
                        action_id: "transaction_signature_picture_options",
                        action_platform: crossplat.device.platform,
                        action_title: "Options",
                        action_btn: [{
                            name: "View",
                            attr: [{ name: "id", value: "transaction_signature_picture_view" }]
                        },
                        {
                            name: "Delete",
                            attr: [{ name: "id", value: "transaction_signature_picture_delete" }]
                        }]
                    }
                    showAction(action_sheet_parms, function () {
                        removeLoader();
                        $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                        $("#transaction_signature_picture_options").attr('data-id', $($this).attr('id'));
                        $("#transaction_signature_picture_options").attr('image_id', response.picture_details.picture_id);//picture_id(original pic) because record got
                    });
                } else {
                    var action_sheet_parms = {
                        action_id: "transaction_signature_picture_options",
                        action_platform: crossplat.device.platform,
                        action_title: "Options",
                        action_btn: [{
                            name: "View",
                            attr: [{ name: "id", value: "transaction_signature_picture_view" }]
                        }]
                    }
                    showAction(action_sheet_parms, function () {
                        removeLoader();
                        $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                        $("#transaction_signature_picture_options").attr('data-id', $($this).attr('id'));
                        $("#transaction_signature_picture_options").attr('image_id', response.picture_details.picture_id);//picture_id(original pic) because record got
                    });
                }
            })
            .catch((err) => {
                var action_sheet_parms = {
                    action_id: "transaction_signature_picture_options",
                    action_platform: crossplat.device.platform,
                    action_title: "Options",
                    action_btn: [{
                        name: "View",
                        attr: [{ name: "id", value: "transaction_signature_picture_view" }]
                    }]
                }
                showAction(action_sheet_parms, function () {
                    removeLoader();
                    $(".action-sheet-container").removeClass('hide').addClass('slide-top');
                    $("#transaction_signature_picture_options").attr('data-id', $($this).attr('id'));
                    $("#transaction_signature_picture_options").attr('image_id', $($this).attr('thumbnail_id'));//thumbnail_id because record not got
                });
            })
    });

    //view transaction and signature picture of the jeevi
    $(document).on('click', '#transaction_signature_picture_view', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getRecordId = $("#transaction_signature_picture_options").attr('data-id');
        var getImageId = $("#transaction_signature_picture_options").attr('image_id');
        $("#transaction_signature_picture_options").remove();
        var avtarUrl = `${api.get_transaction_signature_picture}?id=${getRecordId}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;
        var data = {
            getAvatarUrl: avtarUrl
        }
        fetch.getHtml(function (fetcherror, html) {
            //console.log("got html")
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "transaction-signature-picture-preview-modal",
                modal_header: "",
                modal_body: html
            }
            showModal(modal_data, function () {
                //console.log("modal added");
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    if ($('.modal-popup-content').length > 0) {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                removeLoader();
            });

        }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
    });

    //delete transaction and signature picture of the jeevi
    $(document).on('click', '#transaction_signature_picture_delete', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getRecordId = $("#transaction_signature_picture_options").attr('data-id');
        var getImageId = $("#transaction_signature_picture_options").attr('image_id');
        $("#transaction_signature_picture_options").remove();
        var alert_parms = {
            alert_id: "alert-delete-transaction-signature-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Delete?`,
            alert_body: `Are you sure you want to delete this picture?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-delete-transaction-signature-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-delete-transaction-signature-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-delete-transaction-signature-confirm-cancel').attr('data-id', getRecordId); //set getEmployeeCategoryId
        });
    });

    $(document).on('click', '#btn-delete-transaction-signature-cancel-no', function (e) {
        $('#alert-delete-transaction-signature-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-delete-transaction-signature-confirm-yes', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getRecordID = $('#alert-delete-transaction-signature-confirm-cancel').attr('data-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getRecordID
        }
        deleteRecordTransactionSignaturePicture(reqParam)
            .then((response) => {
                console.log("delete response", response);
                $('#alert-delete-transaction-signature-confirm-cancel').remove();
                $(`.view-transaction-signature-picture[id="${getRecordID}"]`).parents('.transaction_signature_picture_contentbox').remove();
                Materialize.toast(`Successfully deleted.`, 3000, "round success-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                $('#alert-delete-transaction-signature-confirm-cancel').remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })

    });

    //inactivate transaction signature picture
    $(document).on('click', '#transaction_signature_picture_inactivate', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getRecordID = $("#transaction_signature_picture_options").attr('data-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getRecordID,
            data: {
                status: 'inactive'
            }
        }
        updateRecordTransactionSignaturePicture(reqParam)
            .then((response) => {
                console.log("update response", response);
                $('#transaction_signature_picture_options').remove();
                $(`.view-transaction-signature-picture[id="${getRecordID}"]`).addClass('inactivated');
                Materialize.toast(`Successfully inactivated.`, 3000, "round success-alert");
                removeLoader();
            })
            .catch((err) => {
                removeLoader();
                $('#transaction_signature_picture_options').remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    //logs transaction signature picture
    $(document).on('click', '#transaction_signature_picture_logs', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getRecordID = $("#transaction_signature_picture_options").attr('data-id');
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: getRecordID
        }
        getRecordTransactionSignaturePicture(reqParam)
            .then((response) => {
                console.log("get record response", response);
                var logsData = [];
                $.each(response.picture_used_details, function (index, log) {
                    var actionData = {
                        action: {
                            activity: log.message,
                            date: moment.unix(log.used_time).format('MMM D YYYY hh:mm:ss A')
                        }
                    };
                    logsData.push(actionData);
                    if ((index + 1) == response.picture_used_details.length) {
                        console.log("logsData", logsData);
                        var logsList = {
                            log_list_data: logsData
                        };
                        console.log("logsList", logsList);
                        $("#transaction_signature_picture_options").remove();
                        fetch.getHtml(function (fetcherror, html) {
                            var modal_data = {
                                modal_id: "credentials-used-logs-modal",
                                modal_header: "Logs",
                                modal_platform: crossplat.device.platform,
                                modal_body: html
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    if ($('.modal-popup-content').length > 0) {
                                        //console.log("scroll initiated for modal pop-up class")
                                        appScroll.scrollBar('.modal-popup-content');
                                    }
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                            });
                        }, 'page/profile/credentials_used_logs', '#credentials-logs-list-data-template', logsList);
                        $("#transaction_signature_picture_options").remove();
                        removeLoader();
                    } else {
                        $("#transaction_signature_picture_options").remove();
                        removeLoader();
                    }
                })
            })
            .catch((err) => {
                removeLoader();
                $("#transaction_signature_picture_options").remove();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            })
    });

    $(document).on('click', '.business-display-name-info', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        var modal_data = {
            modal_platform: crossplat.device.platform,
            modal_id: "business-display-name-information-modal",
            modal_header: "Info",
            modal_body: `<div class="business-display-name-info-main-container"><div class="business-display-name-info-header-container"><div class="business-display-name-info-header">Business Display Name Info:</div></div><div class="business-display-name-info-body-container"<div class="business-display-name-info-body"><div class="business-display-name-info-point">1) String should be of 5-16 length characters.</div><div class="business-display-name-info-point">2) Only aplhanumeric and special characters are allowed.</div><div class="business-display-name-info-point">3) First character can't be a special character.</div><div class="business-display-name-info-point">4) No space character allowed.</div><div class="business-display-name-info-point">5) Can't edit the display name once the business is active.</div></div></div></div>`,
        }
        showModal(modal_data, function () {
            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                if ($('.modal-popup-content').length > 0) {
                    //console.log("scroll initiated for modal pop-up class")
                    appScroll.scrollBar('.modal-popup-content');
                }
            } else {
                $('.custom-modal-popup').show().addClass('modal-slide-top');
            }
            removeLoader();
        });
    });

    $(document).on('click', '.edit-employee-profile', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        var getRecord = digibiz.employee_business_list.find((e) => e.id == sessionStorage.getItem('business_id'));
        if (getRecord) {
            var getBusinessStatus = getRecord.status.status;
            if (getBusinessStatus == "self-verified" || getBusinessStatus == "inactive_pending") {
                sessionStorage.setItem('edit_from', 'profile_page');
                var getEmployeeId = sessionStorage.getItem('employee_id');
                location.hash = `edit/employee/profile`;
            } else {
                var alert_parms = {
                    alert_id: "alert-business-not-active-box",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Alert",
                    alert_body: `<div>Business is inactive. Please contact your business administrators.</div>`,
                    alert_btn: [{
                        name: "OK",
                        attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        } else {
            var alert_parms = {
                alert_id: "alert-business-not-active-box",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `<div>Business not found! Please try again later.</div>`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });

    $(document).on('click', '.save-employee-btn', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        if (validateEmployeeProfileEdit()) {
            var getAlternateEmail = $('#employee_alternate_email').text().trim();
            if ($('#add-employee-display-phone-number').val().trim().length > 0) {
                var getDisplayphoneNumber = $('#add-employee-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
            } else {
                var getDisplayphoneNumber;
            }
            var getDateOfBirth = $('#employee_date_of_birth').val().trim();
            var weddingAnniversary = $('#employee_wedding_anniversary').val().trim();
            var requestParams;
            requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('employee_id'),
                data: {
                    alternate_email: getAlternateEmail,
                    date_of_birth: getDateOfBirth,
                    wedding_anniversary: weddingAnniversary,
                    display_phone_number: getDisplayphoneNumber,
                }
            }
            employeeProfileUpdate(requestParams)
                .then((response) => {
                    //console.log("response", response);
                    removeLoader();
                    sessionStorage.removeItem('edit_from')
                    location.hash = `employee/profile`;
                })
                .catch((err) => {
                    if (err.msg == "no updated data found") {
                        removeLoader();
                        sessionStorage.removeItem('edit_from')
                        location.hash = `employee/profile`;
                    }
                })
        } else {
            removeLoader();
        }
    });


    $(document).on('click', '.edit-customer-profile', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        var getRecord = digibiz.employee_business_list.find((e) => e.id == sessionStorage.getItem('business_id'));
        if (getRecord) {
            var getBusinessStatus = getRecord.status.status;
            if (getBusinessStatus == "self-verified" || getBusinessStatus == "inactive_pending") {
                sessionStorage.setItem('edit_from', 'profile_page');
                var getCustomerId = sessionStorage.getItem('customer_id');
                // location.hash = `customer/create`;
                location.hash = `edit/customer/profile`;
            } else {
                var alert_parms = {
                    alert_id: "alert-business-not-active-box",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Alert",
                    alert_body: `<div>Business is inactive. Please contact your business administrators.</div>`,
                    alert_btn: [{
                        name: "OK",
                        attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        } else {
            var alert_parms = {
                alert_id: "alert-business-not-active-box",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `<div>Business not found! Please try again later.</div>`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }
    });

    $(document).on('click', '.save-customer-btn', function (e) {
        e.stopImmediatePropagation();
        addLoader();
        if (validateCustomerProfileEdit()) {
            var getAlternateEmail = $('#customer_alternate_email').text().trim();
            var getDateOfBirth = $('#customer_date_of_birth').val().trim();
            var weddingAnniversary = $('#customer_wedding_anniversary').val().trim();
            if ($('#add-customer-display-phone-number').val().length > 0) {
                var getDisplayphoneNumber = $('#add-customer-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
            } else {
                var getDisplayphoneNumber;
            }
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('customer_id'),
                data: {
                    alternate_email: getAlternateEmail,
                    display_phone_number: getDisplayphoneNumber,
                    date_of_birth: getDateOfBirth,
                    wedding_anniversary: weddingAnniversary,
                }
            }
            customerProfileUpdate(requestParams)
                .then((response) => {
                    removeLoader();
                    sessionStorage.removeItem('edit_from')
                    location.hash = `customer/profile`;
                })
                .catch((err) => {
                    if (err.msg == "no updated data found") {
                        sessionStorage.removeItem('edit_from')
                        location.hash = `customer/profile`;
                    }
                })
        } else {
            removeLoader();
        }
    });


    $(document).on('click', '.edit-associate-customer-profile', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var getRecord = digibiz.employee_business_list.find((e) => e.id == sessionStorage.getItem('business_id'));
        if (getRecord) {
            var getBusinessStatus = getRecord.status.status;
            if (getBusinessStatus == "self-verified" || getBusinessStatus == "inactive_pending") {
                sessionStorage.setItem('edit_from', 'profile_page');
                var getAssociateCustomerId = sessionStorage.getItem('customer_id');
                location.hash = `edit/associate_customer/profile`;
            } else {
                var alert_parms = {
                    alert_id: "alert-business-not-active-box",
                    alert_platform: crossplat.device.platform,
                    alert_title: "Alert",
                    alert_body: `<div>Business is inactive. Please contact your business administrators.</div>`,
                    alert_btn: [{
                        name: "OK",
                        attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    removeLoader();
                });
            }
        } else {
            var alert_parms = {
                alert_id: "alert-business-not-active-box",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `<div>Business not found! Please try again later.</div>`,
                alert_btn: [{
                    name: "OK",
                    attr: [{ name: "id", value: "btn-business-not-active-ok" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
            });
        }

        // var requestParms = {
        //     device_id: crossplat.device.uuid,
        //     get_by: "id",
        //     id: getAssociateCustomerId
        // }
        // //get the associate customer data
        // associateCustomerGet(requestParms)
        //     .then((result) => {
        //         if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
        //             if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
        //                 var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${result.id}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
        //                 result.identity_picture['avtarUrl'] = avtarUrl;
        //             }
        //         }
        //         if (result.hasOwnProperty('identity_video') && result.identity_video) {
        //             if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
        //                 var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${result.id}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
        //                 result.identity_video['avtarUrl'] = avtarUrl;
        //             }
        //         }
        //         var associateCustomerData = {
        //             associateCustomerData: result,
        //         }
        //         //console.log("associateCustomerData", associateCustomerData);
        //         fetch.getHtml(function (fetcherror, html) {
        //             var modal_data = {
        //                 modal_platform: crossplat.device.platform,
        //                 modal_id: "edit-associate-customer-modal",
        //                 modal_header: "Associate Customer Details",
        //                 modal_body: html,
        //                 modal_action_buttons: [{
        //                     name: "Save",
        //                     attr: [{ name: "id", value: "save-associate-customer-btn-profile" }]
        //                 }]
        //             }
        //             showModal(modal_data, function () {
        //                 removeLoader();
        //                 mobileFlaginit();
        //                 calenderInit('#associate_customer_date_of_birth');
        //                 calenderInit('#associate_customer_wedding_anniversary');
        //                 //hide all the fields not to be shown
        //                 $('.associate-customer-add-display-name-container').remove();
        //                 $('.associate-customer-add-email-container').remove();
        //                 $('.associate-customer-add-identifier-container').remove();
        //                 $('#edit-associate-customer-modal').attr('data-associate-customer-id', getAssociateCustomerId);
        //                 $('#edit-associate-customer-modal').attr('data-associate-customer-name', `${result.name.first} ${result.name.last}`);
        //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
        //                     if ($('.modal-popup-content').length > 0) {
        //                         //console.log("scroll initiated for modal pop-up class")
        //                         appScroll.scrollBar('.modal-popup-content');
        //                     }
        //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
        //                 } else {
        //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
        //                 }
        //             });
        //         }, 'page/customer/edit_associate_customer', '#edit-associate-customer-template', associateCustomerData);
        //     })
        //     .catch((err) => {
        //         console.log("err", err);
        //         removeLoader();
        //         Materialize.toast(err.msg, 3000, 'round error-alert');
        //     })
    });

    //save the associate customer details
    $(document).on('click', '#save-associate-customer-btn-profile', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        // var getAssociateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
        var getAssociateCustomerId = sessionStorage.getItem('customer_id');
        if (validateAssociateCustomerProfile()) {
            var getAlternateEmail = $('#associate_customer_alternate_email').text().trim();
            var getDateOfBirth = $('#associate_customer_date_of_birth').val().trim();
            var weddingAnniversary = $('#associate_customer_wedding_anniversary').val().trim();
            if ($('#add-associate-customer-display-phone-number').val().length > 0) {
                var getDisplayphoneNumber = $('#add-associate-customer-display-phone-number').intlTelInput("getNumber").replace(/\s/g, '');
            } else {
                var getDisplayphoneNumber;
            }
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: getAssociateCustomerId,
                data: {
                    alternate_email: getAlternateEmail,
                    display_phone_number: getDisplayphoneNumber,
                    date_of_birth: getDateOfBirth,
                    wedding_anniversary: weddingAnniversary,
                }
            }
            associateCustomerProfileUpdate(requestParams)
                .then((response) => {
                    //console.log("response", response);
                    removeLoader();
                    location.hash = `customer/profile`;
                })
                .catch((err) => {
                    if (err.msg == "no updated data found") {
                        removeLoader();
                        location.hash = `customer/profile`;
                    }
                })
        } else {
            removeLoader();
        }
    });

    //cancel button in associate customer edit flow
    $(document).on('click', '.cancel-associate-customer-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        if (sessionStorage.getItem('customer_id')) {
            if (sessionStorage.getItem('digibiz_role') == "customer") {
                sessionStorage.removeItem('edit_from');
                location.hash = `customer/profile`;
            }
        }
    });

    //view business profile picture
    $(document).on('click', '.view-business-profile-pic', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var $this = $(this);
        if ($($this).find('img').attr('src') == "" || $($this).find('img').attr('src') == null || $($this).find('img').attr('src') == undefined) {
            console.log("no picture");
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "business-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', null);
        } else {
            //image is present
            var getBusinessId;
            if ($('body').attr('app') == "business_owner_business_list") {
                getBusinessId = $($this).parents('.business-wrapper').attr('data-business-id');
            } else if ($('body').attr('app') == "employee_business_list") {
                getBusinessId = $($this).parents('.employee-business-wrapper').attr('data-business-id');
            } else if ($('body').attr('app') == "customer_business_list") {
                getBusinessId = $($this).parents('.employee-business-wrapper').attr('data-business-id');
            } else if ($('body').attr('app') == "view_business_profile") {
                getBusinessId = sessionStorage.getItem('business_id')
            } else {
                getBusinessId = $($this).find('img').attr('data-business-id')
            }
            var getImageId = $($this).find('img').attr('data-id');
            var avtarUrl = `${api.get_business_multimedia}?business_id=${getBusinessId}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;
            var data = {
                getAvatarUrl: avtarUrl
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "business-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        }
    });

    //view employee profile picture
    $(document).on('click', '.view-employee-profile-pic', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var $this = $(this);
        if ($($this).find('img').attr('src') == "" || $($this).find('img').attr('src') == null || $($this).find('img').attr('src') == undefined) {
            console.log("no picture");
            $($this).find('.persona').text();
            var data = {
                imageLetter: $($this).find('.persona').text()
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "employee-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        } else {
            //image is present
            var getEmployeeId;
            if ($('body').attr('app') == "employee_profile") {
                getEmployeeId = sessionStorage.getItem('employee_id')
            } else {
                getEmployeeId = $($this).find('img').attr('data-employee-id')
            }
            var getImageId = $($this).find('img').attr('data-id');
            var avtarUrl = `${api.get_employee_identity_picture}?id=${getEmployeeId}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;

            // getImageUrl(avtarUrl).then((res) => {
            // }).catch((err) => {
            //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
            //         var data = {
            //             file_error: err
            //         }
            //         fetch.getHtml(function (fetcherror, html) {
            //             var modal_data = {
            //                 modal_platform: crossplat.device.platform,
            //                 modal_id: "employee-display-picture-preview-modal",
            //                 modal_header: "",
            //                 modal_body: html
            //             }
            //             showModal(modal_data, function () {
            //                 //console.log("modal added");
            //                 if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            //                     if ($('.modal-popup-content').length > 0) {
            //                         //console.log("scroll initiated for modal pop-up class")
            //                         appScroll.scrollBar('.modal-popup-content');
            //                     }
            //                     $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
            //                 } else {
            //                     $('.custom-modal-popup').show().addClass('modal-slide-top');
            //                 }
            //                 removeLoader();
            //             });

            //         }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
            //     } else {
            var data = {
                getAvatarUrl: avtarUrl
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "employee-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
            //     }
            // })

        }
    });

    //view customer profile picture
    $(document).on('click', '.view-customer-profile-pic', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var $this = $(this);
        if ($($this).find('img').attr('src') == "" || $($this).find('img').attr('src') == null || $($this).find('img').attr('src') == undefined) {
            console.log("no picture");
            var data = {
                imageLetter: $($this).find('.persona').text()
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "customer-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        } else {
            //image is present
            var getCustomerId, customerType;
            if ($('body').attr('app') == "customer_profile") {
                getCustomerId = sessionStorage.getItem('customer_id');
                customerType = sessionStorage.getItem('customer_type');
            } else {
                getCustomerId = $($this).find('img').attr('data-customer-id');
                customerType = $($this).find('img').attr('data-customer-type');
            }
            var getImageId = $($this).find('img').attr('data-id');
            if (customerType == "customer") {
                var avtarUrl = `${api.get_customer_identity_picture}?id=${getCustomerId}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;
            } else {
                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${getCustomerId}&device_id=${crossplat.device.uuid}&image_id=${getImageId}`;
            }
            // getImageUrl(avtarUrl).then((res) => {
            // }).catch((err) => {
            //     if (err == "Cloud storage token revoked/expired ! Please try again later" || err == "Cloud storage not authenticated") {
            //         var data = {
            //             file_error: err
            //         }
            //           fetch.getHtml(function (fetcherror, html) {
            //     var modal_data = {
            //         modal_platform: crossplat.device.platform,
            //         modal_id: "customer-display-picture-preview-modal",
            //         modal_header: "",
            //         modal_body: html
            //     }
            //     showModal(modal_data, function () {
            //         //console.log("modal added");
            //         if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            //             if ($('.modal-popup-content').length > 0) {
            //                 //console.log("scroll initiated for modal pop-up class")
            //                 appScroll.scrollBar('.modal-popup-content');
            //             }
            //             $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
            //         } else {
            //             $('.custom-modal-popup').show().addClass('modal-slide-top');
            //         }
            //         removeLoader();
            //     });

            // }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
            //     } else {
            var data = {
                getAvatarUrl: avtarUrl
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "customer-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
            // }
            // })


        }
    });


    $(document).on('click', '#reregister', function () {
        addLoader();
        var alert_parms = {
            alert_id: "alert-reregister-btn",
            alert_platform: crossplat.device.platform,
            alert_title: "Re-register",
            alert_body: `Are you sure, You want to Re-register?`,
            alert_btn: [{
                name: "NO",
                attr: [{ name: "id", value: "reregister-cancel" }]
            },
            {
                name: "YES",
                attr: [{ name: "id", value: "reregister-confirm" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
        });
    });

    $(document).on('click', '#reregister-cancel', function () {
        $('#alert-reregister-btn').remove();
    });

    $(document).on('click', '#reregister-confirm', function () {
        addLoader();
        var requestParams = {
            device_id: crossplat.device.uuid,
            details: {
                re_register: true,
                re_register_app: 'business'
            }
        };
        fetch.apiCall(function (response, status, xhr) {
            removeLoader();
            $('#alert-reregister-btn').remove();
            if (status === "success") {
                window.register_confirmation = false;
                router.navigateUri(app.indexRoute);
            } else {
                var jsonResponse = JSON.parse(response.responseText);
                window.plugins.toast.showLongBottom(jsonResponse.message);
            }
        }, api.set_profile, "POST", "JSON", requestParams);
    });


    $(document).on('click', '.wrapper-dropdown .custom-dropdown li', function (e) {
        if ($('body').attr('app') == "digibiz_logs") {
            e.stopPropagation();
            var log_type = sessionStorage.getItem('log_type');
            $(this).parents('.wrapper-dropdown').removeClass('active');
            console.log('123', $(this).attr('data-value'));
            if ($(this).attr('data-value')) {
                digibiz.logs_list = [];
                $(this).parents(".custom-dropdown").siblings(".selected-dropdown").text($(this).text()).removeClass('disabled');
                $(this).parents(".custom-dropdown").siblings(".selected-dropdown").attr('data-value', $(this).attr('data-value'));
                $(this).hasClass('disabled') ? $(this).parents(".custom-dropdown").siblings(".selected-dropdown").addClass('disabled') : $(this).parents(".custom-dropdown").siblings(".selected-dropdown").removeClass('disabled');
                if ($(this).attr('data-value') == "all") {
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        user_id: sessionStorage.getItem('account_id'),
                        account_id: sessionStorage.getItem('account_id')
                    }
                } else {
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        user_id: sessionStorage.getItem('account_id'),
                        account_id: sessionStorage.getItem('account_id'),
                        filter_value: $(this).attr('data-value'),
                        offset: 0,
                        count: 20
                    }
                }

                if (log_type && log_type == "jeevi_hub_page") {
                    requestParams.list_by = "jeevi_hub_page";
                } else if (log_type && log_type == "digibiz_login_logs") {
                    requestParams.list_by = "digibiz_login_logs";
                } else if (log_type && log_type == "digibiz_hub_page") {
                    requestParams.list_by = "digibiz_account";
                } else if (log_type && log_type == "digibiz_roles_logs") {
                    requestParams.list_by = "digibiz_roles";
                } else if (log_type && log_type == "notification_role_page") {
                    requestParams.list_by = "notification_roles_page";
                } else if (log_type && log_type == "digibiz_business_logs") {
                    requestParams.list_by = "digibiz_business_logs";
                } else if (log_type && log_type == "business_owner_business_list_page") {
                    requestParams.list_by = "business_owner_roles_page";
                } else if (log_type && log_type == "business_app_hub_page") {
                    requestParams.list_by = "business_app_hub_page";
                    requestParams.business_id = sessionStorage.getItem('business_id');
                } else if (log_type && log_type == "app_permission_logs") {
                    requestParams.list_by = "app_permissions_page";
                    requestParams.business_id = sessionStorage.getItem('business_id');
                } else if (sessionStorage.getItem('log_type') == "employee") {
                    requestParams.list_by = "business_module";
                    requestParams.business_id = sessionStorage.getItem('business_id');
                    requestParams.type = "employee";
                } else if (sessionStorage.getItem('log_type') == "customer_logs") {
                    requestParams.list_by = "customer_logs";
                    requestParams.business_id = sessionStorage.getItem('business_id');
                    requestParams.type = "customer";
                } else if (sessionStorage.getItem('log_type') == "teams_group_logs") {
                    requestParams.list_by = "business_teams";
                    requestParams.business_id = sessionStorage.getItem('business_id');
                } else if (sessionStorage.getItem('log_type') == "collaborator_group_logs") {
                    requestParams.list_by = "collaborator";
                    requestParams.business_id = sessionStorage.getItem('business_id');
                }
                addLoader();
                if ($(this).attr('data-value') == "all") {
                    fetch.apiCall(function (response, status, xhr) {
                        if (status === "success") {
                            processLogsList(response.data, function (res) {
                                removeLoader();
                                appScroll.scrollBar('.digibiz-logs-list-contentbox');
                                listenForDigibizLogsListScrollEvent($('.digibiz-logs-list-contentbox'))
                                if (res) {
                                }
                            });
                        } else {
                            console.log("error fetching activity");
                        }
                    }, api.list_digibiz_logs, "POST", "JSON", requestParams);
                } else {
                    fetch.apiCall(function (response, status, xhr) {
                        if (status === "success") {
                            processLogsList(response.data, function (res) {
                                appScroll.scrollBar('.digibiz-logs-list-contentbox');
                                listenForDigibizLogsListScrollEvent($('.digibiz-logs-list-contentbox'));
                                removeLoader();
                            });
                        } else {
                            console.log("error fetching activity");
                        }
                    }, api.get_digibiz_logs_by_filters, "POST", "JSON", requestParams);
                }

            } else {
                console.log('23456');
            }
            if ($(this).parents(".custom-dropdown").siblings('.selected-dropdown').attr('data-value')) {
                removeError('.selected-dropdown');
            }
        } else {
            if ($(this).attr('data-value')) {
                $(this).parents(".custom-dropdown").siblings(".selected-dropdown").text($(this).text()).removeClass('disabled');
                $(this).parents(".custom-dropdown").siblings(".selected-dropdown").attr('data-value', $(this).attr('data-value'));
                $(this).hasClass('disabled') ? $(this).parents(".custom-dropdown").siblings(".selected-dropdown").addClass('disabled') : $(this).parents(".custom-dropdown").siblings(".selected-dropdown").removeClass('disabled');
            }
            if ($(this).attr('data-id')) {
                $(this).parents(".custom-dropdown").siblings(".selected-dropdown").attr('data-id', $(this).attr('data-id'));
            }
            if ($(this).parents(".custom-dropdown").siblings('.selected-dropdown').attr('data-value')) {
                removeError('.selected-dropdown');
            }
        }
    });


    $(document).on('click', '.teams-management', function () {
        addLoader();
        location.hash = `teams/management/hub`;
    });

    //employee groups(from employee management hub)
    $(document).on('click', '.team-group-creation', function () {
        addLoader();
        location.hash = `team_group_creation/list`;
    });


    $(document).on('click', '.view-team-group', function () {
        addLoader();
        var getGroupId = $(this).parents('.employee-group-wrapper').attr('data-group-id');
        var getGroupType = $(this).parents('.employee-group-wrapper').attr('data-type');
        var socket_enable_status = $(this).parents('.employee-group-wrapper').attr('data-socket_enable_status');
        if (getGroupType == "custom") {
            var getCustomGroupFrom = $(this).parents('.employee-group-wrapper').attr('data-group-from');
            sessionStorage.setItem('group_from', getCustomGroupFrom);
        }
        if (socket_enable_status == "true") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                id: getGroupId,
                data: {
                    socket_enable_status: "false",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeGroupUpdate(reqParam)
                .then((response) => {
                    console.log('response', response);
                }).catch((err) => {
                    console.log('err', err);
                })

            sessionStorage.setItem('group_type', getGroupType);
            sessionStorage.removeItem('group_id');
            sessionStorage.setItem('group_id', getGroupId);
            location.hash = `teams/group/create`;
        } else {
            Materialize.toast(`Access Denied! You or other administrator is updating this group at other place.`, 3000, "round error-alert");
            var alert_parms = {
                alert_id: "alert-group-device-change-confirm-cancel",
                alert_platform: crossplat.device.platform,
                alert_title: `Alert`,
                alert_body: `Access Denied! You or other administrator is updating this group at other place. Would to like to cancel there and continue here?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "btn-group-device-change-confirm-yes" }]
                },
                {
                    name: "No",
                    attr: [{ name: "id", value: "btn-group-device-change-cancel-no" }]
                }]
            }
            showAlert(alert_parms, function () {
                removeLoader();
                $('#alert-group-device-change-confirm-cancel').attr('data-group-id', getGroupId); //set getEmployeeId
                $('#alert-group-device-change-confirm-cancel').attr('data-group-type', getGroupType); //set getEmployeeId           
            });
        }
    });



    $(document).on('click', '#add_teams_group_moderator', function () {
        addLoader();
        digibiz.employeeSelectedContactList = [];
        digibiz.teamGroupEmployeeSelectionList = [];
        var getGroupId, group_from;

        if ($('body').attr('app') == "teams_group_create") {
            getGroupId = sessionStorage.getItem('group_id');
            group_from = sessionStorage.getItem('group_from');
        } else {
            getGroupId = $(this).parents('.employee-group-wrapper').attr('data-group-id');
            group_from = $(this).parents('.employee-group-wrapper').attr('data-group-from');
        }
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: getGroupId
        }
        groupGet(requestParams)
            .then((groupResponse) => {
                console.log("groupResponse", groupResponse);
                if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator) {
                    digibiz.alreadySelected = groupResponse.moderator;
                    console.log("digibiz.alreadySelected", digibiz.alreadySelected);
                }
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    group_id: getGroupId
                }
                groupMemberList(reqParam)
                    .then((memberResponse) => {
                        if (memberResponse && memberResponse.length > 0) {
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                list_by: "list_only_active",
                                business_id: sessionStorage.getItem('business_id'),
                                count: 20,
                                offset: 0
                            }
                            employeeList(reqParam)
                                .then((response) => {
                                    console.log("getCompleteGroupMembers", response);
                                    digibiz.employee_list = [];
                                    digibiz.employee_list = response;
                                    var modal_data = {
                                        modal_platform: crossplat.device.platform,
                                        modal_id: "modal-communication-group-activate-employee-group-employee-list-selection",
                                        modal_header: "Group Members",
                                        modal_body: `<div id="communication-group-activate-employee-group-employee-list-main-container">
                                            <div class="search">
                                                <div class="expand-search-wrap search-wrapper" id="communication-group-activate-employee-group-employee-list-search-btn">
                                                    <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                    <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                    <span class="searchclosebtn"><i class="material-icons communication-group-activate-employee-group-employee-list-close-btn hide">close</i></span>
                                                </div>
                                            </div>
                                        <div id="communication-group-activate-employee-group-employee-list-wrapper"></div>
                                        </div>`,
                                        modal_action_buttons: [{
                                            "name": "Save",
                                            "id": "team-group-activate-save-btn",
                                        }]
                                    }
                                    showModal(modal_data, function () {
                                        $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id', getGroupId);
                                        $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-type', group_from);
                                        removeLoader();
                                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                            if ($('.modal-popup-content').length > 0) {
                                                //console.log("scroll initiated for modal pop-up class")
                                                appScroll.scrollBar('.modal-popup-content');
                                            }
                                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        } else {
                                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                                        }
                                        processTeamGroupCreateEmployeeSelectionList(response, groupResponse, function () {
                                            setTimeout(function () {
                                                listenForEmployeeList($('.modal-popup-content'));
                                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                                var element = $('#modal-communication-group-activate-employee-group-employee-list-selection').find('.expand-search-input');
                                                if (element) {
                                                    //console.log('element22', element);
                                                    //if element is there
                                                    $(document).on('input', element, function () {
                                                        //on input set attribute socketid 
                                                        timestamp = (new Date()).getTime();
                                                        element.attr("socketid", timestamp);
                                                    });
                                                    // element.addEventListener("keyup", function (e) {
                                                    $(document).on('keyup', element, function () {
                                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                                        //console.log("not has class")
                                                        // on keyup get attribute 
                                                        socketid = element.attr("socketid");
                                                        keyword = element.val();
                                                        if (socketid && keyword) {
                                                            //if socketid attribute and keyword is there
                                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                                            currentroute = $("body").attr('app');
                                                            data = {
                                                                room: crossplat.device.uuid,
                                                                socketid,
                                                                app: 'digibiz',
                                                                keyword
                                                            };
                                                            switch (currentroute) {
                                                                case 'employee_group_creation_list':
                                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            data['index'] = 'getEmployeeStandardGroupModeratorList';
                                                                            data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                        }
                                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            if (group_from == "standard_group") {
                                                                                data['index'] = 'getEmployeeCustomStandardGroupModeratorList';
                                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                            } else {
                                                                                data['index'] = 'getDigibizGroupMembersListPage';
                                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                            }
                                                                        }
                                                                    }
                                                                    break;
                                                                case 'employee_group_create':
                                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            data['index'] = 'getEmployeeStandardGroupModeratorList';
                                                                            data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                        }
                                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            if (group_from == "standard_group") {
                                                                                data['index'] = 'getEmployeeCustomStandardGroupModeratorList';
                                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                            } else {
                                                                                data['index'] = 'getDigibizGroupMembersListPage';
                                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                                            }
                                                                        }
                                                                    }
                                                                    break;
                                                                default:
                                                                    break;
                                                            }
                                                            addLoader();
                                                            //console.log("search emit", data);
                                                            sockets.searchSocket.emit('search', data);
                                                            setTimeout(() => {
                                                                removeLoader();
                                                            }, 300);
                                                        } else {
                                                            //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                                            //else show default list
                                                            removeLoader();
                                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                                            currentroute = $("body").attr('app');
                                                            // element.removeAttribute("socketid");
                                                            element.attr("socketid", "");
                                                            switch (currentroute) {
                                                                case 'employee_group_creation_list':
                                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                                        }
                                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                                        }
                                                                    }
                                                                    break;
                                                                case 'employee_group_create':
                                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                                        }
                                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                                        }
                                                                    }
                                                                    break;
                                                                default:
                                                                    break;
                                                            }

                                                        }
                                                    });
                                                    $(document).on('click', '.searchclosebtn', function () {
                                                        //console.log("1234", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                //console.log("1111")
                                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                            }
                                                        } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                            }
                                                        }
                                                    })
                                                }
                                            }, 0);
                                        });
                                    });

                                })
                                .catch((err) => {
                                    removeLoader();
                                    //console.log("error in group get");
                                })
                        } else {
                            removeLoader();
                            Materialize.toast(`Atleast one member in the group to add moderator.`, 3000, "round error-alert");
                        }
                    })
                    .catch((err) => {
                        removeLoader();
                        //console.log("error in group get");
                    })
            })
            .catch((err) => {
                removeLoader();
                //console.log("error in getting the group")
            })
    });


    $(document).on('click', '#team-group-activate-save-btn', function () {
        addLoader();
        // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
        var groupID = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
        var moderator_data = [];
        var revoked_data = [];
        //get all checkbox
        var getCheckboxes = $('.communication-group-employee-select-btn');
        $.each(getCheckboxes, function (index, element) {
            // if ($(element).is(':checked')) {
            if ($(element).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row')) {
                moderator_data.push({
                    "id": $(element).attr('data-dj-unique-employee-id'),
                    "type": "employee",
                    "user_id": $(element).attr('data-dj-unique-employee-id'),
                    "group_id": $(element).parents('.accordion-content').attr('data-group-id')
                })
            }
        });
        //check unchecked one's
        //console.log("digibiz.alreadySelected", digibiz.alreadySelected)
        // var alreadySelected = digibiz.communicationActivateEmployeeGroupEmployeeList
        $.each(digibiz.alreadySelected, function (index, element) {
            if (element.hasOwnProperty('group_id') && element.group_id) {
                // var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
                var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
                if (check == false) {
                    revoked_data.push(element);
                }
                //console.log("moderator_data", moderator_data);
                var getModerator = moderator_data.findIndex(e => e.id == element.id && e.group_id == element.group_id);
                //console.log("getModerator", getModerator);
                if (getModerator > -1) {
                    // delete moderator_data[getModerator];
                    moderator_data.splice(getModerator, 1);
                }
                // moderator_data = moderator_data.filter(function (e) {
                //     return (e.id != element.id && e.group_id != element.group_id);
                // });
            } else {
                // var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
                var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
                if (check == false) {
                    revoked_data.push(element);
                }
                moderator_data = moderator_data.filter(function (e) {
                    return e.id != element.id;
                });
            }
        });
        //console.log("moderator_data", moderator_data);
        //console.log("revoked_data", revoked_data);
        if (moderator_data.length > 0 || revoked_data.length > 0) {
            if (moderator_data.length > 0) {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    id: groupID,
                    moderator_data: moderator_data
                }
                groupModeratorAdd(requestParams)
                    .then((response) => {
                        if (revoked_data.length > 0) {
                            $.each(revoked_data, function (index, element) {
                                var requesParam = {
                                    device_id: crossplat.device.uuid,
                                    id: groupID,
                                    moderator_id: element.id,
                                }
                                if (element.hasOwnProperty('group_id') && element.group_id) {
                                    requesParam.moderator_group_id = element.group_id;
                                }
                                groupModeratorDelete(requesParam)
                                    .then((resultData) => {
                                        //console.log("groupModeratorDelete", resultData);
                                        digibiz.alreadySelected = [];
                                        digibiz.teamGroupEmployeeSelectionList = [];
                                        teamGroupCreationPage();
                                        $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                                        Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            })
                        } else {
                            //console.log("groupModeratorAdd", response);
                            digibiz.alreadySelected = [];
                            digibiz.teamGroupEmployeeSelectionList = [];
                            teamGroupCreationPage();
                            $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        }
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            }
            if (moderator_data.length == 0) {
                if (revoked_data.length > 0) {
                    $.each(revoked_data, function (index, element) {
                        var requesParam = {
                            device_id: crossplat.device.uuid,
                            id: groupID,
                            moderator_id: element.id,
                        }
                        if (element.hasOwnProperty('group_id') && element.group_id) {
                            requesParam.moderator_group_id = element.group_id;
                        }
                        groupModeratorDelete(requesParam)
                            .then((resultData) => {
                                //console.log("groupModeratorDelete", resultData);
                                digibiz.alreadySelected = [];
                                digibiz.teamGroupEmployeeSelectionList = [];
                                teamGroupCreationPage();
                                $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                                Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(err.msg, 3000, "round error-alert");
                            })
                    })
                }
            }
        } else {
            // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            removeLoader();
            // } else {
            //     Materialize.toast(`Please select atleast 1 member.`, 3000, "round error-alert");
            // }
        }

    });

    $(document).on('click', '#team_group_cancel_button', function () {
        addLoader();
        if (sessionStorage.getItem('group_id')) {
            reqParam = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                data: {
                    socket_enable_status: "true",
                    update_for: "socket_enable_status"
                }
            }
            //console.log("reqParam", reqParam);
            employeeGroupUpdate(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('group_id');
                    sessionStorage.removeItem('group_from');
                    sessionStorage.removeItem('group_type');
                    digibiz.standard_employees_groups_list_page = [];
                    digibiz.custom_employees_groups_list_page = [];
                    digibiz.selectedMembers = [];
                    location.hash = `team_group_creation/list`;
                }).catch((err) => {
                    console.log('err', err);
                })
        } else {
            sessionStorage.removeItem('group_id');
            sessionStorage.removeItem('group_from');
            sessionStorage.removeItem('group_type');
            digibiz.standard_employees_groups_list_page = [];
            digibiz.custom_employees_groups_list_page = [];
            digibiz.selectedMembers = [];
            location.hash = `team_group_creation/list`;
        }


    });



    //save group data
    $(document).on('click', '#team_group_add_button', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        $(this).prop('disabled', true);
        addLoader();
        if (validateGroupData()) {
            if (sessionStorage.getItem('group_id')) {
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('group_id'),
                    data: {
                        name: firstLetterUpperCase($('#employeeGroupName').val()),
                        description: firstLetterUpperCase($('#employee_group_desc').val()),
                        // visibility: $('#select-visibility-type').val(),
                        visibility: $('.selected-value-group-visbility').attr('data-value'),
                        conversation_setting: $('.selected-value-group-conversation-setting').attr('data-value'),
                        post_setting: $('.selected-value-group-post-setting').attr('data-value'),
                    }
                }
                employeeGroupUpdate(reqparams)
                    .then((response) => {
                        $(this).prop('disabled', false);
                        //console.log("employee group updated", response);
                        sessionStorage.removeItem('group_id');
                        sessionStorage.removeItem('group_type');
                        location.hash = `team_group_creation/list`;
                    })
                    .catch((err) => {
                        $(this).prop('disabled', false);
                        if (err.msg == 'no updated data found') {
                            sessionStorage.removeItem('group_id');
                            sessionStorage.removeItem('group_type');
                            location.hash = `team_group_creation/list`;
                        } else {
                            removeLoader();
                            //console.log("err in group update", err);
                        }
                    })
                //     }
                // })

                //     })
                // }
            }
        } else {
            $(this).prop('disabled', false);
            //console.log("fail")
            removeLoader();
        }
    });

    $(document).on('click', '.teams-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "teams_group_logs");
        location.hash = "digibiz/logs";
    });


    //delete employee group
    $(document).on('click', '#inactive_teams_group', function () {
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            status: "inactive",
            id: sessionStorage.getItem('group_id')
        }
        teamsGroupInactive(reqparams)
            .then((response) => {
                sessionStorage.removeItem('group_from');
                sessionStorage.removeItem('group_id');
                sessionStorage.removeItem('group_type');
                location.hash = `team_group_creation/list`;
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`Error in inactivating the group.`, 3000, "round error-alert");
            })
    })

    $(document).on('click', '#active_teams_group', function () {
        addLoader();
        var requestParams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        groupGet(requestParams)
            .then((groupResponse) => {
                if (groupResponse.hasOwnProperty('moderator') && groupResponse.moderator && groupResponse.moderator.length > 0) {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: sessionStorage.getItem('group_id')
                    }
                    groupMemberList(reqParam)
                        .then((memberResponse) => {
                            if (memberResponse && memberResponse.length > 0) {
                                var reqparams = {
                                    device_id: crossplat.device.uuid,
                                    status: "active",
                                    id: sessionStorage.getItem('group_id')
                                }
                                teamsGroupInactive(reqparams)
                                    .then((response) => {
                                        sessionStorage.removeItem('group_from');
                                        sessionStorage.removeItem('group_id');
                                        sessionStorage.removeItem('group_type');
                                        location.hash = `team_group_creation/list`;
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(`Error in inactivating the group.`, 3000, "round error-alert");
                                    })
                            } else {
                                removeLoader();
                                Materialize.toast(`Atleast one member should be there to make it as active.`, 3000, "round error-alert");
                            }
                        }).catch((err) => {
                            removeLoader();
                            Materialize.toast(`Error in activating the group.`, 3000, "round error-alert");
                        })
                } else {
                    removeLoader();
                    Materialize.toast(`Please add moderator to activate the group.`, 3000, "round error-alert");
                }
            }).catch((err) => {
                removeLoader();
                Materialize.toast(`Error in activating the group.`, 3000, "round error-alert");
            })


    })

    $(document).on('click', '.profile-pic-container', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var $this = $(this);
        if ($($this).find('img').attr('src') == "" || $($this).find('img').attr('src') == null || $($this).find('img').attr('src') == undefined) {
            console.log("no picture");
            $($this).find('.persona').text();
            var data = {
                imageLetter: $($this).find('.persona').text()
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "employee-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        } else {
            var avtarUrl = $($this).find('img').attr('src');
            var data = {
                getAvatarUrl: avtarUrl
            }
            fetch.getHtml(function (fetcherror, html) {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "employee-display-picture-preview-modal",
                    modal_header: "",
                    modal_body: html
                }
                showModal(modal_data, function () {
                    //console.log("modal added");
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        if ($('.modal-popup-content').length > 0) {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });

            }, 'page/common/identity_picture_preview', '#identity-picture-preview-template', data);
        }
    });

    $(document).on('click', '#collaborator-business-list', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        var reqparams = {
            device_id: crossplat.device.uuid,
            employee_id: sessionStorage.getItem('employee_id'),
            business_id: sessionStorage.getItem('business_id')
        }
        getCollaboratorBusinessList(reqparams)
            .then((response) => {
                console.log("businessList response", response);
                fetch.replaceHtml(function () {
                    processCollaboratorCustomerBusinessList(response, function () {
                        removeLoader();
                    });
                }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", null);
                }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#main-content-wrapper", null);
            })

    })


    $(document).on('click', '#add_collaborator_customer_business_btn', function () {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "my_collaborators",
            business_id: sessionStorage.getItem('business_id')
        }
        collaboratorList(reqParam)
            .then((response) => {
                console.log("collaboratorList response", response);
                let unique_collaborator_contact_list = [];
                $.each(response, function (index, value) {
                    unique_collaborator_contact_list.push(value);
                });
                // //console.log("unique_collaborator_contact_list", unique_collaborator_contact_list);
                digibiz.collaborator_contact_list = response;
                $.each($("input[name='selectedcollaboratorcontact[]']"), function (index, element) {
                    // //console.log("checkvalue", $(element).val())
                    unique_collaborator_contact_list = unique_collaborator_contact_list.filter(function (e) {
                        return e.id != $(element).val();
                    });
                });
                $.each($('.collaborator-group-business-member-wrapper'), function (index, elem) {
                    // //console.log("elem", elem)
                    unique_collaborator_contact_list = unique_collaborator_contact_list.filter(function (e) {
                        return e.business_id != $(elem).attr('data-business-id');
                    });
                })
                var collaboratorContactList = {
                    collaboratorContactList: unique_collaborator_contact_list.map(e => {
                        if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                            if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                                // //console.log("1234");
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                                e.business_display_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.business_name.charAt(0);
                            } else {
                                e['imageLetter'] = e.business_name.charAt(0);
                            }
                        } else {
                            e['imageLetter'] = e.business_name.charAt(0);
                        }
                        return e;
                    })
                }
                //console.log("collaboratorContactList", collaboratorContactList);
                fetch.getHtml(function (fetcherror, html) {
                    var modal_data = {
                        modal_id: "modal-collaborator-group-contact-list-selection",
                        modal_header: "Collaborator Contact List",
                        modal_platform: crossplat.device.platform,
                        modal_body: html,
                        modal_action_buttons: [{
                            "name": "Add",
                            "id": "add-collaborator-customer-contact-list-selected",
                        }]
                    }
                    showModal(modal_data, function () {
                        //add search element
                        $('.collaborator-contact-selection-list-main-container').prepend(`<div class="search">
                         <div class="expand-search-wrap search-wrapper" id="collaborator-contact-selection-list-search-btn">
                         <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                             <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                             <span class="searchclosebtn"><i class="material-icons collaborator-contact-selection-list-close-btn hide">close</i></span>
                         </div></div>`);
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        removeLoader();
                        setTimeout(function () {
                            // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                            var element = $('#collaborator-contact-selection-list-search-btn').find('.expand-search-input');
                            if (element) {
                                //console.log('element22', element);
                                //if element is there
                                $(document).on('input', element, function () {
                                    //on input set attribute socketid 
                                    timestamp = (new Date()).getTime();
                                    element.attr("socketid", timestamp);
                                });
                                // element.addEventListener("keyup", function (e) {
                                $(document).on('keyup', element, function () {
                                    // if (!hasClass(e.target, 'filemanager-search')) {
                                    //console.log("not has class")
                                    // on keyup get attribute 
                                    socketid = element.attr("socketid");
                                    keyword = element.val();
                                    if (socketid && keyword) {
                                        //if socketid attribute and keyword is there
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                        currentroute = $("body").attr('app');
                                        data = {
                                            room: crossplat.device.uuid,
                                            socketid,
                                            app: 'digibiz',
                                            keyword
                                        };
                                        switch (currentroute) {
                                            case 'collaborator_group_create':
                                                // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-collaborator-group-contact-list-selection').length > 0) {
                                                    // if (sessionStorage.getItem('group_from') == "employee_list") {
                                                    data['index'] = 'getActiveCollaboratorListPage';
                                                    data['business_id'] = sessionStorage.getItem('business_id')
                                                    // }
                                                }
                                                // }
                                                break;
                                            default:
                                                break;
                                        }
                                        addLoader();
                                        //console.log("search emit", data);
                                        sockets.searchSocket.emit('search', data);
                                        setTimeout(() => {
                                            removeLoader();
                                        }, 300);
                                    } else {
                                        //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                        //else show default list
                                        removeLoader();
                                        document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                        currentroute = $("body").attr('app');
                                        // element.removeAttribute("socketid");
                                        element.attr("socketid", "");
                                        switch (currentroute) {
                                            case 'collaborator_group_create':
                                                // if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                if ($('#modal-collaborator-group-contact-list-selection').length > 0) {
                                                    //console.log("ERROR", unique_member)
                                                    processActiveCollaboratorContactList(unique_collaborator_contact_list, function () { })
                                                }
                                                // }
                                                break;
                                            default:
                                                break;
                                        }

                                    }
                                });
                                $(document).on('click', '.searchclosebtn', function () {
                                    if ($('#modal-collaborator-group-contact-list-selection').length > 0) {
                                        //console.log("CLOSED", unique_member)
                                        processActiveCollaboratorContactList(unique_collaborator_contact_list, function () {
                                        });
                                    }
                                })
                            }
                        }, 0);
                    });
                }, 'page/collaborator/contact_list_selection', '#collaborator-contact-selection-list-template', collaboratorContactList);

            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No Contacts Found`, 3000, 'round success-alert');
            })
    });


    //add collaborator contact list selected
    $(document).on('click', '#add-collaborator-customer-contact-list-selected', function () {
        addLoader();
        //first time group creation
        if ($('.contact-select-btn:checked').length > 0) {
            // $.each($('.contact-select-btn:checked'), function (index, element) {
            // var getContactId = $(element).attr('data-id');
            // var getBusinessId = $(element).attr('data-business-id');
            // var getContactName = $(element).parents('.collaborator-contact-selection-list-container').find('.contact-name-wrapper').text();
            // var getContactNameImageLetter = $(element).parents('.collaborator-contact-selection-list-container').find('.contact-name-wrapper').text().charAt(0);
            // var getContactImage = $(element).parents('.collaborator-contact-selection-list-container').find('img').attr('src');
            // if (getContactId != undefined) {
            let selectedmembers = [];
            $.each($('.contact-select-btn:checked'), function (index, element) {
                selectedmembers.push({
                    id: $(element).attr('data-business-id')
                });
            });
            var contactlist = uniqueArray(selectedmembers);

            // } else {
            //     removeLoader();
            //     //console.log("collaborator contact id is undefined")
            // }
            // })
            var reqparams = {
                device_id: crossplat.device.uuid,
                type: "collaborator_customer_contact_list",
                requestor_business_id: sessionStorage.getItem('business_id'),
                add_type: "add",
                data_type: "business_name",
                // business_id: contactlist[0].id,
                business_ids: contactlist,
                identifier_id: sessionStorage.getItem('identifier_id')
                // business_id: digibiz.collboratorContactAdd.business_id
            }
            businessNotificationAdd(reqparams)
                .then((response) => {
                    //console.log("businessNotificationAdd response", response);
                    removeLoader();
                    Materialize.toast(`Successfully sent notification`, 3000, 'round success-alert');
                    // location.hash = `collaborator/contact/list`;
                    $('#modal-collaborator-group-contact-list-selection').remove();

                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(`${err.msg}`, 3000, "round error-alert");
                })
            removeLoader();
        } else {
            removeLoader();
            Materialize.toast(`Please select atleast 1 business.`, 3000, 'round success-alert');
        }
    });


    $(document).on('click', '#add-collaborator-customer-selected-employees', function () {
        addLoader();
        var getGroupID = $('#modal-collaborator-group-employees-selection').attr('data-group-id');
        var getNotificationId = $('#modal-collaborator-group-employees-selection').attr('data-notification-id');
        var getReceiverBusinessId = $('#modal-collaborator-group-employees-selection').attr('data-receiver-business-id');
        var getSenderBusinessId = $('#modal-collaborator-group-employees-selection').attr('data-sender-business-id');
        var getCustomerIdentifierId = $('#modal-collaborator-group-employees-selection').attr('data-customer-identifier-id');
        let selectedmembers = [];
        $.each($('.collaborator-group-employee-select-btn:checked'), function (index, element) {
            selectedmembers.push({
                id: $(element).attr('data-dj-unique-employee-id'),
                business_id: sessionStorage.getItem('business_id')
            });
        });
        var contactlist = removeDuplicates(selectedmembers, 'id');
        console.log("contactlist", contactlist);
        if (selectedmembers.length > 0) {
            var requestParams = {
                device_id: crossplat.device.uuid,
                identifier_id: getCustomerIdentifierId,
                notification_id: getNotificationId,
                business_id: sessionStorage.getItem('business_id'),
                collaborator_business_id: getSenderBusinessId,
                members: contactlist
            }
            collaboratorCustomerAdd(requestParams)
                .then((result) => {
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        notification_id: getNotificationId,
                        business_id: getReceiverBusinessId,
                        identifier_id: getCustomerIdentifierId,
                        action: "accepted"
                    }
                    businessNotificationChangeStatus(reqparams)
                        .then((response) => {
                            // Materialize.toast("Members Added Successfully", 3000, 'round success-alert');                
                            Materialize.toast(`Successfully Accepted Notification.`, 3000, "round error-alert");
                            $('#modal-collaborator-group-employees-selection').remove();
                            $(`.accept_reject_wrap[data-notification-id="${getNotificationId}"]`).parents(`.business-notification-list-wrapper`).remove();
                            removeLoader();
                        })
                        .catch((err) => {
                            //console.log("error in accepting the notification");
                            Materialize.toast("Error in accepting the business.", 3000, 'round success-alert');
                            removeLoader();
                        })
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast("Error in members adding", 3000, 'round success-alert');
                })
        } else {
            removeLoader();
            Materialize.toast("Please add employees.", 3000, 'round success-alert');
        }
    });


    //collaborator contact list icon click
    $(document).on('click', '.collaborator-customers', function () {
        addLoader();
        location.hash = `collaborator/customer/list`;
    });


    $(document).on('click', '#collaborator-customer-business-list-more-icon', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        var getBusinessID = $(this).parents('.employee-business-wrapper').attr('data-business-id');
        var getCustomerIdentifierID = $(this).parents('.employee-business-wrapper').attr('data-customer-identifier-id');
        var collaboratorBusinessCustomersId = $(this).parents('.employee-business-wrapper').attr('data-collaborator_business_customers_id');
        var getType = $(this).parents('.employee-business-wrapper').attr('data-customer-type');
        var getId = $(this).parents('.employee-business-wrapper').attr('data-customer-id');
        var current_url = location.href.split('#').pop();
        if (current_url == "customer/collaborators") {
            var action_sheet_parms = {
                action_id: "employee_business_list_more_icon_action",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [
                    {
                        name: "Complete Profile",
                        attr: [{ name: "class", value: "customers_complete_profile_slider_btn" }]
                    },
                    // {
                    //     name: "Employess",
                    //     attr: [{ name: "class", value: "collaborator_employee_list_slider_btn" }]
                    // },
                    {
                        name: "Delete",
                        attr: [{ name: "id", value: "collaborator-business-customer-delete-icon" }]
                    }
                ]
            }
        } else {
            var action_sheet_parms = {
                action_id: "employee_business_list_more_icon_action",
                action_platform: crossplat.device.platform,
                action_title: "Options",
                action_btn: [{
                    name: "Business Profile",
                    attr: [{ name: "class", value: "business_profile_slider_btn" }]
                },
                {
                    name: "Employess",
                    attr: [{ name: "class", value: "collaborator_employee_list_slider_btn" }]
                },
                {
                    name: "Exit",
                    attr: [{ name: "id", value: "collaborator-customer-exit-icon" }]
                }
                ]
            }
        }
        showAction(action_sheet_parms, function () {
            $(".action-sheet-container").removeClass('hide').addClass('slide-top');
            $('#employee_business_list_more_icon_action').attr('data-id', getId);
            $('#employee_business_list_more_icon_action').attr('data-type', getType);
            $('#employee_business_list_more_icon_action').attr('data-business-id', getBusinessID);
            $('#employee_business_list_more_icon_action').attr('data-customer-identifier-id', getCustomerIdentifierID);
            $('#employee_business_list_more_icon_action').attr('data-collaborator-business-customers-id', collaboratorBusinessCustomersId);
        });
    });

    $(document).on('click', '.customers_complete_profile_slider_btn', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        var getCustomerIdentifierID = $('#employee_business_list_more_icon_action').attr('data-customer-identifier-id');
        var collaboratorBusinessCustomersId = $('#employee_business_list_more_icon_action').attr('data-collaborator-business-customers-id');
        sessionStorage.removeItem('collaborator_business_customers_id');
        sessionStorage.removeItem('collaborator_business_identifier_id');
        sessionStorage.setItem('collaborator_business_customers_id', collaboratorBusinessCustomersId);
        sessionStorage.setItem('collaborator_business_identifier_id', getCustomerIdentifierID);
        $('.action-sheet-cancel-btn').trigger('click');
        location.hash = `collaborator/customer/create`;


    })

    // $(document).on('click', '.collaborator_employee_list_slider_btn', function (e) {
    //     e.stopPropagation();
    //     if (isDoubleClicked($(this))) return;
    //     var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
    //     var getCustomerIdentifierID = $('#employee_business_list_more_icon_action').attr('data-customer-identifier-id');
    //     var id = $('#employee_business_list_more_icon_action').attr('data-id');
    //     var type = $('#employee_business_list_more_icon_action').attr('data-type');
    //     // var getGroupId = $(this).parents('.accept_reject_wrap').attr('data-group-id');
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         list_by: "list_only_active",
    //         business_id: sessionStorage.getItem('business_id')
    //     }

    //     var collaborator_customer_data = [];
    //     var revoked_data = [];
    //     //get all checkbox
    //     var getCheckboxes = $('.communication-group-employee-select-btn');
    //     $.each(getCheckboxes, function (index, element) {
    //         // if ($(element).is(':checked')) {
    //         if ($(element).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row')) {
    //             collaborator_customer_data.push({
    //                 "id": $(element).attr('data-dj-unique-employee-id'),
    //                 "type": "employee",
    //                 "user_id": $(element).attr('data-dj-unique-employee-id'),
    //                 "group_id": $(element).parents('.accordion-content').attr('data-group-id')
    //             })
    //         }
    //     });
    //     //check unchecked one's
    //     //console.log("digibiz.alreadySelected", digibiz.alreadySelected)
    //     // var alreadySelected = digibiz.communicationActivateEmployeeGroupEmployeeList
    //     $.each(digibiz.alreadySelected, function (index, element) {
    //         if (element.hasOwnProperty('group_id') && element.group_id) {
    //             // var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
    //             var check = $(`.accordion-content[data-group-id="${element.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
    //             if (check == false) {
    //                 revoked_data.push(element);
    //             }
    //             //console.log("moderator_data", moderator_data);
    //             var getModerator = moderator_data.findIndex(e => e.id == element.id && e.group_id == element.group_id);
    //             //console.log("getModerator", getModerator);
    //             if (getModerator > -1) {
    //                 // delete moderator_data[getModerator];
    //                 moderator_data.splice(getModerator, 1);
    //             }
    //             // moderator_data = moderator_data.filter(function (e) {
    //             //     return (e.id != element.id && e.group_id != element.group_id);
    //             // });
    //         } else {
    //             // var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
    //             var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
    //             if (check == false) {
    //                 revoked_data.push(element);
    //             }
    //             moderator_data = moderator_data.filter(function (e) {
    //                 return e.id != element.id;
    //             });
    //         }
    //     });

    //     employeeList(reqParam)
    //         .then((employeeResponse) => {
    //             console.log("employeeList response", employeeResponse);
    //             var EmployeeList = {
    //                 EmployeeList: employeeResponse.map(async (e) => {
    //                     if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
    //                         if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
    //                             var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
    //                             e.identity_picture['avtarUrl'] = avtarUrl;
    //                         } else {
    //                             e['imageLetter'] = e.name.first.charAt(0);
    //                         }
    //                     } else {
    //                         e['imageLetter'] = e.name.first.charAt(0);
    //                     }
    //                     return e;

    //                 }),
    //                 from: "direct"

    //             }
    //             //     employeeResponse.map(async (el) => {
    //             //     var params = {
    //             //         employee_id: el.dj_unique_employee_id,
    //             //         type: "employee",
    //             //         business_id: sessionStorage.getItem('business_id'),
    //             //         collaborator_business_id: getBusinessID,
    //             //         identifier_id: getCustomerIdentifierID,
    //             //         device_id: crossplat.device.uuid
    //             //     }
    //             //     await getCollaboratorCustomerList(params).then((customerResponse) => {
    //             //         console.log('customerResponse', customerResponse);
    //             //         if (customerResponse && customerResponse.role) {
    //             //             if (customerResponse[0].role.id == el.dj_unique_employee_id) {
    //             //                 el['checked'] = true;
    //             //             }
    //             //         }

    //             //     }).catch((err) => {
    //             //         console.log('err', err);
    //             //     })
    //             // })
    //             //console.log("EmployeeList", EmployeeList);
    //             fetch.getHtml(function (fetcherror, html) {
    //                 var modal_data = {
    //                     modal_id: "modal-collaborator-customers-selection",
    //                     modal_header: "Employee List",
    //                     modal_platform: crossplat.device.platform,
    //                     modal_body: html,
    //                     modal_action_buttons: [{
    //                         "name": "Add",
    //                         "id": "add-collaborator-customer-selected-employees",
    //                     }]
    //                 }
    //                 showModal(modal_data, function () {
    //                     //hide the modal close btn
    //                     // $('#modal-close-btn').addClass('hide');
    //                     if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
    //                         $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
    //                         if ($('.modal-popup-content').length > 0) {
    //                             //console.log("scroll initiated for modal pop-up class")
    //                             appScroll.scrollBar('.modal-popup-content');
    //                         }
    //                     } else {
    //                         $('.custom-modal-popup').show().addClass('modal-slide-top');
    //                     }
    //                     // $('#modal-collaborator-customers-selection').attr('data-group-id', getGroupId);
    //                     // $('#modal-collaborator-group-employees-selection').attr('data-notification-id', getNotificationId);
    //                     // $('#modal-collaborator-group-employees-selection').attr('data-receiver-business-id', getReceiverBusinessId)
    //                     // $('#modal-collaborator-group-employees-selection').attr('data-customer-identifier-id', customerIdentifierId);
    //                     // Materialize.toast(`Successfully Accepted`, 3000, "round error-alert");
    //                     // $(this).parents(`.business-notification-list-wrapper`).remove();
    //                     removeLoader();
    //                 });
    //             }, 'page/collaborator/employee_selection_list', '#employee-selection-list-template', EmployeeList);

    //         }).catch((err) => {
    //             removeLoader();
    //             Materialize.toast(`Cannot accept the business if there is no employees in your business.`, 3000, 'round success-alert');
    //         })
    // })


    $(document).on('click', '.collaborator_employee_list_slider_btn', function () {
        addLoader();
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        var getCustomerIdentifierID = $('#employee_business_list_more_icon_action').attr('data-customer-identifier-id');
        var getCollaboratorBusinessCustomersId = $('#employee_business_list_more_icon_action').attr('data-collaborator-business-customers-id');

        $('.action-sheet-cancel-btn').trigger('click');
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",
            business_id: sessionStorage.getItem('business_id'),
            count: 20,
            offset: 0
        }
        var params = {
            business_id: sessionStorage.getItem('business_id'),
            collaborator_business_id: getBusinessID,
            identifier_id: getCustomerIdentifierID,
            collaborator_business_customers_id: getCollaboratorBusinessCustomersId,
            device_id: crossplat.device.uuid
        }
        getCollaboratorCustomerList(params).then((customerResponse) => {
            console.log('customerResponse', customerResponse);
            digibiz.alreadySelected = customerResponse;
            employeeList(reqParam)
                .then((employeeResponse) => {
                    var modal_data = {
                        modal_platform: crossplat.device.platform,
                        modal_id: "modal-communication-group-activate-employee-group-employee-list-selection",
                        modal_header: "Group Members",
                        modal_body: `<div id="communication-group-activate-employee-group-employee-list-main-container">
                                        <div class="search">
                                            <div class="expand-search-wrap" id="communication-group-activate-employee-group-employee-list-search-btn">
                                                <span class="searchbtn waves-effect cursor-pointer"><i class="material-icons">search</i></span>
                                                <input class="expand-search-input" type="search" placeholder="Search" autocomplete="off"/>
                                                <span class="searchclosebtn"><i class="material-icons communication-group-activate-employee-group-employee-list-close-btn hide">close</i></span>
                                            </div>
                                        </div>
                                        <div id="communication-group-activate-employee-group-employee-list-wrapper"></div>
                                        </div>`,
                        modal_action_buttons: [{
                            "name": "Save",
                            "id": "collaborator-add-customer-employee-select-save-btn",
                        }]
                    }
                    showModal(modal_data, function () {
                        $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-business-id', getBusinessID);
                        $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-customer-identifier-id', getCustomerIdentifierID);
                        $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-collaborator-business-customers-id', getCollaboratorBusinessCustomersId);
                        removeLoader();
                        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                            if ($('.modal-popup-content').length > 0) {
                                //console.log("scroll initiated for modal pop-up class")
                                appScroll.scrollBar('.modal-popup-content');
                            }
                            $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        } else {
                            $('.custom-modal-popup').show().addClass('modal-slide-top');
                        }
                        processCollaboratorEmployeeSectionList(employeeResponse, customerResponse, function () {
                            setTimeout(function () {
                                // listenForSurveyViewersUserScrollEvent($(".modal-popup-content"));
                                var element = $('#modal-communication-group-activate-employee-group-employee-list-selection').find('.expand-search-input');
                                if (element) {
                                    //console.log('element22', element);
                                    //if element is there
                                    $(document).on('input', element, function () {
                                        //on input set attribute socketid 
                                        timestamp = (new Date()).getTime();
                                        element.attr("socketid", timestamp);
                                    });
                                    // element.addEventListener("keyup", function (e) {
                                    $(document).on('keyup', element, function () {
                                        // if (!hasClass(e.target, 'filemanager-search')) {
                                        //console.log("not has class")
                                        // on keyup get attribute 
                                        socketid = element.attr("socketid");
                                        keyword = element.val();
                                        if (socketid && keyword) {
                                            //if socketid attribute and keyword is there
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                            currentroute = $("body").attr('app');
                                            data = {
                                                room: crossplat.device.uuid,
                                                socketid,
                                                app: 'digibiz',
                                                keyword
                                            };
                                            switch (currentroute) {
                                                case 'employee_group_creation_list':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            data['index'] = 'getEmployeeStandardGroupModeratorList';
                                                            data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                        }
                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            if (group_from == "standard_group") {
                                                                data['index'] = 'getEmployeeCustomStandardGroupModeratorList';
                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                            } else {
                                                                data['index'] = 'getDigibizGroupMembersListPage';
                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                            }
                                                        }
                                                    }
                                                    break;
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            data['index'] = 'getEmployeeStandardGroupModeratorList';
                                                            data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                        }
                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            if (group_from == "standard_group") {
                                                                data['index'] = 'getEmployeeCustomStandardGroupModeratorList';
                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                            } else {
                                                                data['index'] = 'getDigibizGroupMembersListPage';
                                                                data['group_id'] = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-group-id');
                                                            }
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                            addLoader();
                                            //console.log("search emit", data);
                                            sockets.searchSocket.emit('search', data);
                                            setTimeout(() => {
                                                removeLoader();
                                            }, 300);
                                        } else {
                                            //console.log("going to else part111", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                            //else show default list
                                            removeLoader();
                                            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
                                            currentroute = $("body").attr('app');
                                            // element.removeAttribute("socketid");
                                            element.attr("socketid", "");
                                            switch (currentroute) {
                                                case 'employee_group_creation_list':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                        }
                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                        }
                                                    }
                                                    break;
                                                case 'employee_group_create':
                                                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                        }
                                                    } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                                        if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                            processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                                        }
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }

                                        }
                                    });
                                    $(document).on('click', '.searchclosebtn', function () {
                                        //console.log("1234", digibiz.communicationActivateEmployeeGroupEmployeeList)
                                        if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "standard") {
                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                //console.log("1111")
                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                            }
                                        } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                                            if ($('#modal-communication-group-activate-employee-group-employee-list-selection').length > 0) {
                                                processCommunicationGroupActivateEmployeeGroupEmployeeList(digibiz.communicationActivateEmployeeGroupEmployeeList, groupResponse, function () { })
                                            }
                                        }
                                    })
                                }
                            }, 0);
                        });
                    });


                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting the group")
                })
        }).catch((err) => {
            console.log('err', err);
        })
    });


    //save employee group moderator
    $(document).on('click', '#collaborator-add-customer-employee-select-save-btn', function () {
        addLoader();
        // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
        var businessId = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-business-id');
        var customerIdentifierId = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-customer-identifier-id');
        var collaboratorBusinessCustomersId = $('#modal-communication-group-activate-employee-group-employee-list-selection').attr('data-collaborator-business-customers-id');
        var revoked_data = [];
        var customer_data = [];
        //get all checkbox
        var getCheckboxes = $('.communication-group-employee-select-btn');
        $.each(getCheckboxes, function (index, element) {
            // if ($(element).is(':checked')) {
            if ($(element).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row')) {
                customer_data.push({
                    "id": $(element).attr('data-dj-unique-employee-id'),
                    "type": "employee",
                    "user_id": $(element).attr('data-dj-unique-employee-id'),
                    "business_id": $(element).attr('data-employee-business-id'),
                })
            }
        });
        //check unchecked one's
        //console.log("digibiz.alreadySelected", digibiz.alreadySelected)
        // var alreadySelected = digibiz.communicationActivateEmployeeGroupEmployeeList
        $.each(digibiz.alreadySelected, function (index, element) {
            // var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.id}"]`).is(':checked');
            var check = $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${element.role.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').hasClass('selected-row');
            console.log('check', check);
            if (check == false) {
                revoked_data.push(element);
            }
            customer_data = customer_data.filter(function (e) {
                return e.id != element.role.id;
            });
        });
        console.log("customer_data", customer_data);
        console.log("revoked_data", revoked_data);
        if (customer_data.length > 0 || revoked_data.length > 0) {
            if (customer_data.length > 0) {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    identifier_id: customerIdentifierId,
                    collaborator_business_id: businessId,
                    business_id: sessionStorage.getItem('business_id'),
                    collaborator_business_customers_id: collaboratorBusinessCustomersId,
                    members: customer_data,
                }
                collaboratorCustomerAdd(requestParams)
                    .then((response) => {
                        console.log('response', response.label);
                        if (response.label) {
                            var reqParams = {
                                device_id: crossplat.device.uuid,
                                id: response.id,
                                data: {
                                    identifier_id: response.identifier_id,
                                    // email: response.email,
                                    // alternate_email: response.alternate_email,
                                    label: response.label,
                                    // display_name: response.display_name,
                                    // display_phone_number: response.display_phone_number,
                                    status: 'active',
                                    // date_of_birth: response.date_of_birth,
                                    // wedding_anniversary: response.wedding_anniversary,
                                    // identity_picture: response.identity_picture
                                }
                            }
                            if (response.email) {
                                reqParams.data.email = response.email;
                            }
                            if (response.alternate_email) {
                                reqParams.data.alternate_email = response.alternate_email;
                            }
                            if (response.display_name) {
                                reqParams.data.display_name = response.display_name;
                            }
                            if (response.display_phone_number) {
                                reqParams.data.display_phone_number = response.display_phone_number;
                            }
                            if (response.date_of_birth) {
                                reqParams.data.date_of_birth = response.date_of_birth;
                            }
                            if (response.wedding_anniversary) {
                                reqParams.data.wedding_anniversary = response.wedding_anniversary;
                            }
                            if (response.identity_picture) {
                                reqParams.data.identity_picture = response.identity_picture;
                            }
                            console.log('reqParams', reqParams);
                            collaboratorCustomerBusinessUpdate(reqParams)
                                .then((response) => {
                                }).catch((err) => {
                                    console.log('err', err);
                                })
                        }
                        if (revoked_data.length > 0) {
                            $.each(revoked_data, function (index, element) {
                                var requesParam = {
                                    device_id: crossplat.device.uuid,
                                    id: element.id,
                                    identifier_id: customerIdentifierId,
                                    business_id: sessionStorage.getItem('business_id'),
                                    collaborator_business_id: element.role.business_id,
                                    collaborator_business_customers_id: collaboratorBusinessCustomersId,
                                    employee_id: element.role.id,
                                    status: "deleted"
                                }
                                // if (element.hasOwnProperty('group_id') && element.group_id) {
                                //     requesParam.moderator_group_id = element.group_id;
                                // }
                                collaboratorCustomerDelete(requesParam)
                                    .then((resultData) => {
                                        //console.log("groupModeratorDelete", resultData);
                                        digibiz.alreadySelected = [];
                                        digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                                        $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                                        Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        removeLoader();
                                        Materialize.toast(err.msg, 3000, "round error-alert");
                                    })
                            })
                        } else {
                            //console.log("groupModeratorAdd", response);
                            digibiz.alreadySelected = [];
                            digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                            $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                            Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                            removeLoader();
                        }
                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast(err.msg, 3000, "round error-alert");
                    })
            }
            if (customer_data.length == 0) {
                if (revoked_data.length > 0) {
                    $.each(revoked_data, function (index, element) {
                        var requesParam = {
                            device_id: crossplat.device.uuid,
                            id: element.id,
                            identifier_id: customerIdentifierId,
                            business_id: sessionStorage.getItem('business_id'),
                            collaborator_business_id: element.role.business_id,
                            collaborator_business_customers_id: collaboratorBusinessCustomersId,
                            employee_id: element.role.id,
                            status: "deleted"
                        }
                        collaboratorCustomerDelete(requesParam)
                            .then((resultData) => {
                                //console.log("groupModeratorDelete", resultData);
                                digibiz.alreadySelected = [];
                                digibiz.communicationActivateEmployeeGroupEmployeeList = [];
                                $('#modal-communication-group-activate-employee-group-employee-list-selection').remove();
                                Materialize.toast(`Successfully updated.`, 3000, "round error-alert");
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                                Materialize.toast(err.msg, 3000, "round error-alert");
                            })
                    })
                }
            }
        } else {
            // if ($('.communication-group-activate-employee-select-btn:checked').length > 0) {
            Materialize.toast(`No data changed to save.`, 3000, "round error-alert");
            removeLoader();
            // } else {
            //     Materialize.toast(`Please select atleast 1 member.`, 3000, "round error-alert");
            // }
        }

    });


    $(document).on('click', '#collaborator-customer-exit-icon', function () {
        addLoader();
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        var getCustomerIdentifierID = $('#employee_business_list_more_icon_action').attr('data-customer-identifier-id');
        var getCollaboratorBusinessCustomersId = $('#employee_business_list_more_icon_action').attr('data-collaborator-business-customers-id');
        $('#employee_business_list_more_icon_action').remove();
        var getDisplayType = "customer";
        // if (getType == "associate_customer") {
        //     getDisplayType = "associate customer"
        // }
        var alert_parms = {
            alert_id: "alert-collaborator-customer-exit-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Exit`,
            alert_body: `Are you sure you want to exit as ${getDisplayType}?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-collaborator-customer-exit-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-collaborator-customer-exit-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-collaborator-customer-exit-confirm-cancel').attr('data-business-id', getBusinessID);
            $('#alert-collaborator-customer-exit-confirm-cancel').attr('data-customer-identifier-id', getCustomerIdentifierID);
            $('#alert-collaborator-customer-exit-confirm-cancel').attr('data-collaborator-business-customers-id', getCollaboratorBusinessCustomersId);
        });
    });


    $(document).on('click', '#btn-collaborator-customer-exit-cancel-no', function () {
        $('#alert-customer-exit-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-collaborator-customer-exit-confirm-yes', function () {
        var getCustomerIdentifierID = $('#alert-collaborator-customer-exit-confirm-cancel').attr('data-customer-identifier-id');
        var getCollaboratorBusinessCustomersId = $('#alert-collaborator-customer-exit-confirm-cancel').attr('data-collaborator-business-customers-id');
        var getBusinessID = $('#alert-collaborator-customer-exit-confirm-cancel').attr('data-business-id');
        $('#alert-customer-exit-confirm-cancel').remove();
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-collaborator-customer-exit-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-collaborator-customer-exit-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            $('#alert-confirm-transactional-password').attr('data-business-id', getBusinessID);
            $('#alert-confirm-transactional-password').attr('data-customer-identifier-id', getCustomerIdentifierID);
            $('#alert-confirm-transactional-password').attr('data-collaborator-business-customers-id', getCollaboratorBusinessCustomersId);
            removeLoader();
        });
    });

    $(document).on('click', '#btn-collaborator-customer-exit-cancel', function () {
        $('#alert-confirm-transactional-password').remove();
    });

    $(document).on('click', '#btn-collaborator-customer-exit-confirm', function () {
        var getBusinessID = $('#alert-confirm-transactional-password').attr('data-business-id');
        var getCustomerIdentifierID = $('#alert-confirm-transactional-password').attr('data-customer-identifier-id');
        var getCollaboratorBusinessCustomersId = $('#alert-confirm-transactional-password').attr('data-collaborator-business-customers-id');
        // $('#alert-confirm-transactional-password').remove();
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Collaborator Customer Exit"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    $('#alert-confirm-transactional-password').remove();
                    // if (getType == "customer") {                   
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        identifier_id: getCustomerIdentifierID,
                        collaborator_business_id: getBusinessID,
                        collaborator_business_customer_id: getCollaboratorBusinessCustomersId,
                        business_id: sessionStorage.getItem('business_id'),
                        folder_delete: true,
                        status: "exited"
                    };
                    collaboratorIdentifierCustomerDelete(reqParam)
                        .then((response) => {
                            removeLoader();
                            Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
                            if (digibiz.customer_business_list.length > 0) {
                                console.log("business is there")
                            } else {
                                location.hash = `jeevi/app/hub`;
                                console.log('fwefwef');
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(`Error in exiting.`, 3000, "round error-alert");
                        })
                    // } else if (getType == "associate_customer") {
                    //     var reqParams = {
                    //         device_id: crossplat.device.uuid,
                    //         id: getId,
                    //         status: "exited"
                    //     }
                    //     associateCustomerDelete(reqParams)
                    //         .then((response) => {
                    //             Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
                    //             removeLoader();
                    //         })
                    //         .catch((err) => {
                    //             removeLoader();
                    //             //console.log("error in exited.");
                    //         })
                    // }
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    });

    // delete collb customer


    $(document).on('click', '#collaborator-business-customer-delete-icon', function () {
        addLoader();
        var getBusinessID = $('#employee_business_list_more_icon_action').attr('data-business-id');
        var getCustomerIdentifierID = $('#employee_business_list_more_icon_action').attr('data-customer-identifier-id');
        var collaboratorBusinessCustomersId = $('#employee_business_list_more_icon_action').attr('data-collaborator-business-customers-id');
        $('#employee_business_list_more_icon_action').remove();
        var getDisplayType = "customer";
        // if (getType == "associate_customer") {
        //     getDisplayType = "associate customer"
        // }
        var alert_parms = {
            alert_id: "alert-collaborator-customer-delete-confirm-cancel",
            alert_platform: crossplat.device.platform,
            alert_title: `Exit`,
            alert_body: `Are you sure you want to delete as ${getDisplayType}?`,
            alert_btn: [{
                name: "Yes",
                attr: [{ name: "id", value: "btn-collaborator-customer-delete-confirm-yes" }]
            },
            {
                name: "No",
                attr: [{ name: "id", value: "btn-collaborator-customer-delete-cancel-no" }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
            $('#alert-collaborator-customer-delete-confirm-cancel').attr('data-business-id', getBusinessID);
            $('#alert-collaborator-customer-delete-confirm-cancel').attr('data-customer-identifier-id', getCustomerIdentifierID);
            $('#alert-collaborator-customer-delete-confirm-cancel').attr('data-collaborator-business-customers-id', collaboratorBusinessCustomersId);
        });
    });


    $(document).on('click', '#btn-collaborator-customer-delete-cancel-no', function () {
        $('#alert-collaborator-customer-delete-confirm-cancel').remove();
    });

    $(document).on('click', '#btn-collaborator-customer-delete-confirm-yes', function () {
        var getCustomerIdentifierID = $('#alert-collaborator-customer-delete-confirm-cancel').attr('data-customer-identifier-id');
        var getCollaboratorBusinessCustomersId = $('#alert-collaborator-customer-delete-confirm-cancel').attr('data-collaborator-business-customers-id');
        var getBusinessID = $('#alert-collaborator-customer-delete-confirm-cancel').attr('data-business-id');
        $('#alert-customer-delete-confirm-cancel').remove();
        var alert_parms = {
            alert_id: "alert-confirm-transactional-password",
            alert_platform: crossplat.device.platform,
            alert_title: "Transactional Password",
            alert_body: `<input type="password" id="transaction_password_field" placeholder="Enter Transactional Password"/>`,
            alert_btn: [{
                name: "Cancel",
                attr: [{ name: "id", value: "btn-collaborator-customer-delete-cancel" }]
            },
            {
                name: "Confirm",
                attr: [{ name: "id", value: "btn-collaborator-customer-delete-confirm" }]
            }
            ]
        }
        showAlert(alert_parms, function () {
            $('#alert-confirm-transactional-password').attr('data-business-id', getBusinessID);
            $('#alert-confirm-transactional-password').attr('data-customer-identifier-id', getCustomerIdentifierID);
            $('#alert-confirm-transactional-password').attr('data-collaborator-business-customers-id', getCollaboratorBusinessCustomersId);
            removeLoader();
        });
    });

    $(document).on('click', '#btn-collaborator-customer-delete-cancel', function () {
        $('#alert-confirm-transactional-password').remove();
    });

    $(document).on('click', '#btn-collaborator-customer-delete-confirm', function () {
        var getBusinessID = $('#alert-confirm-transactional-password').attr('data-business-id');
        var getCustomerIdentifierID = $('#alert-confirm-transactional-password').attr('data-customer-identifier-id');
        var getCollaboratorBusinessCustomersId = $('#alert-confirm-transactional-password').attr('data-collaborator-business-customers-id');
        // $('#alert-confirm-transactional-password').remove();
        addLoader();
        //validation 
        if ($('#transaction_password_field').val().length == 0) {
            showError($('#transaction_password_field'), "Password is required.")
            removeLoader();
        } else {
            let requestParms = {
                device_id: crossplat.device.uuid,
                password: $('#transaction_password_field').val(),
                purpose: "Collaborator Customer delete"
            };
            checkTransactionalPassword(requestParms)
                .then((response) => {
                    $('#alert-confirm-transactional-password').remove();
                    $('#alert-collaborator-customer-delete-confirm-cancel').remove();
                    // if (getType == "customer") {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        identifier_id: getCustomerIdentifierID,
                        collaborator_business_id: getBusinessID,
                        collaborator_business_customer_id: getCollaboratorBusinessCustomersId,
                        business_id: sessionStorage.getItem('business_id'),
                        folder_delete: true,
                        status: "deleted"
                    };
                    collaboratorIdentifierCustomerDelete(reqParam)
                        .then((response) => {
                            removeLoader();
                            Materialize.toast(`Successfully deleted.`, 3000, "round error-alert");
                            $(`.employee-business-wrapper [data-collaborator_business_customers_id="${getCollaboratorBusinessCustomersId}"]`).remove();
                            if (digibiz.customer_business_list.length > 0) {
                                console.log("business is there")
                            } else {
                                location.hash = `jeevi/app/hub`;
                                console.log('fwefwef');
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                            Materialize.toast(`Error in exiting.`, 3000, "round error-alert");
                        })
                    // } else if (getType == "associate_customer") {
                    //     var reqParams = {
                    //         device_id: crossplat.device.uuid,
                    //         id: getId,
                    //         status: "exited"
                    //     }
                    //     associateCustomerDelete(reqParams)
                    //         .then((response) => {
                    //             Materialize.toast(`Successfully exited.`, 3000, "round error-alert");
                    //             removeLoader();
                    //         })
                    //         .catch((err) => {
                    //             removeLoader();
                    //             //console.log("error in exited.");
                    //         })
                    // }
                })
                .catch((err) => {
                    removeLoader();
                    Materialize.toast(err.message, 3000, 'round error-alert');
                    if (err.Data && err.Data == 'locked') {
                        deviceHelper.logOutApp('core'); //account locked on entering wrong transaction password
                    }
                })
        }
    });

    $(document).on('click', '.employee-control-creation', function () {
        addLoader();
        location.hash = `employee/controls`;

    })

    $(document).on('click', '.employee-contact-add-settings', function () {
        addLoader();
        var params = {
            business_id: sessionStorage.getItem('business_id'),
            user_id: sessionStorage.getItem('user_id'),
            device_id: crossplat.device.uuid
        }
        checkEmployeeControlSetting(params).then((response) => {
            if (response) {
                digibiz.employeeControlSettings = response;
                var getDta = {
                    setting_type: "employee_control",
                    contact_control_type: response.employee_add_type,
                    employee_contacts: response.add_employee_contacts
                }
            } else {
                var getDta = {
                    setting_type: "employee_control"
                }
            }
            fetch.getHtml(function (fetchror, html) {
                var modal_data = {
                    modal_id: "contacts-settings-modal",
                    modal_header: "Settings",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "contacts-settings-modal-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });
            }, 'page/employee/contact_settings', '#contact-settings-template', getDta);
        }).catch((err) => {
            var getDta = {
                setting_type: "employee_control"
            }
            fetch.getHtml(function (fetchror, html) {
                var modal_data = {
                    modal_id: "contacts-settings-modal",
                    modal_header: "Settings",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "contacts-settings-modal-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });
            }, 'page/employee/contact_settings', '#contact-settings-template', getDta);
            console.log('err', err);
        })
    })

    $(document).on('click', '.employee-customer-add-settings', function () {
        addLoader();
        var params = {
            business_id: sessionStorage.getItem('business_id'),
            user_id: sessionStorage.getItem('user_id'),
            device_id: crossplat.device.uuid
        }
        checkEmployeeControlSetting(params).then((response) => {
            if (response) {
                digibiz.employeeControlSettings = response;
                var getDta = {
                    setting_type: "customer_control",
                    customer_control_type: response.employee_customer_type,
                    employee_contacts: response.employee_customer_contacts
                }
            } else {
                var getDta = {
                    setting_type: "customer_control"
                }
            }
            fetch.getHtml(function (fetchror, html) {
                var modal_data = {
                    modal_id: "contacts-settings-modal",
                    modal_header: "Settings",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "employee-customer-control-settings-modal-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });
            }, 'page/employee/contact_settings', '#contact-settings-template', getDta);
        }).catch((err) => {
            console.log('err');
            var getDta = {
                setting_type: "customer_control"
            }
            fetch.getHtml(function (fetchror, html) {
                var modal_data = {
                    modal_id: "contacts-settings-modal",
                    modal_header: "Settings",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "employee-customer-control-settings-modal-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });
            }, 'page/employee/contact_settings', '#contact-settings-template', getDta);
        })
    })

    $(document).on('click', '.employee-trusted-add-settings', function () {
        addLoader();
        var params = {
            business_id: sessionStorage.getItem('business_id'),
            user_id: sessionStorage.getItem('user_id'),
            device_id: crossplat.device.uuid
        }
        checkEmployeeControlSetting(params).then((response) => {
            if (response) {
                digibiz.employeeControlSettings = response;
                var getDta = {
                    setting_type: "trusted_control",
                    trusted_control_type: response.employee_trusted_type,
                    employee_contacts: response.employee_trusted_contacts
                }
            } else {
                var getDta = {
                    setting_type: "trusted_control"
                }
            }
            fetch.getHtml(function (fetchror, html) {
                var modal_data = {
                    modal_id: "contacts-settings-modal",
                    modal_header: "Settings",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "employee-trusted-control-settings-modal-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });
            }, 'page/employee/contact_settings', '#contact-settings-template', getDta);
        }).catch((err) => {
            console.log('err');
            var getDta = {
                setting_type: "trusted_control"
            }
            fetch.getHtml(function (fetchror, html) {
                var modal_data = {
                    modal_id: "contacts-settings-modal",
                    modal_header: "Settings",
                    modal_platform: crossplat.device.platform,
                    modal_body: html,
                    modal_action_buttons: [{
                        "name": "Confirm",
                        "id": "employee-trusted-control-settings-modal-confirm",
                    }]
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    removeLoader();
                });
            }, 'page/employee/contact_settings', '#contact-settings-template', getDta);
        })
    })

    $(document).on('click', '#contacts-settings-modal-confirm', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getViewedData = $('.view-settings').find('.viewed-settings:checked').attr('value');
        sessionStorage.setItem('employee_add_type', getViewedData);
        // contacts.contactList.forEach(v => { v.selected = false; });
        if (getViewedData == "contacts" || getViewedData == "none") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                user_id: sessionStorage.getItem("user_id"),
                user_type: "individual",
                business_id: sessionStorage.getItem('business_id'),
                employee_add_type: getViewedData,
                add_employee_contacts: []
            };
            console.log("reqParam", reqParam);
            updateSettingPageInfo(reqParam)
                .then((response) => {
                    console.log("updateSettingPageInfo response", response);
                    $('#contacts-settings-modal').remove();
                    sessionStorage.removeItem('employee_add_type');
                    digibiz.employeeControlSettings = response;
                    Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                })
                .catch((err) => {
                    console.log("updateSettingPageInfo err", err);
                })
        } else {
            var getData = {};
            digibiz.all_employee_active_list = []
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_all_active",
                count: 20,
                offset: 0
            }
            employeeCount(reqParam).then((employeesCount) => {

                employeeList(reqParam)
                    .then((response) => {
                        digibiz.all_employee_active_list = response;
                        if (digibiz.employeeControlSettings != {} || digibiz.employeeControlSettings != null || digibiz.employeeControlSettings != undefined) {
                            $.each(digibiz.employeeControlSettings.add_employee_contacts, function (ind, elem) {
                                // console.log('2w3e',contacts.contactSettings.show_number_type,getViewedData);
                                if (digibiz.employeeControlSettings.employee_add_type == getViewedData) {
                                    var index = response.findIndex(e => e.dj_unique_employee_id == elem.id);
                                    console.log("index", index);
                                    if (index != -1) {
                                        response[index]['selected'] = true;
                                    }
                                }
                            })
                        }
                        getData = {
                            contactList: response,
                            device_id: crossplat.device.uuid
                        }
                        fetch.getHtml(function (fetchror, html) {
                            var modal_data = {
                                modal_id: "modal-show-mobile-number-contact-selection",
                                modal_header: `Select Contacts (${employeesCount})`,
                                modal_platform: crossplat.device.platform,
                                modal_body: html,
                                modal_action_buttons: [{
                                    "name": "Confirm",
                                    "id": "contacts-settings-choose-contacts-confirm",
                                }]
                            }
                            showModal(modal_data, function () {
                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                } else {
                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                }
                                appScroll.scrollBar('.contact-recommend-to-members-selection-list');
                                listenForAllEmployeeActiveListScrollEvent($('.contact-recommend-to-members-selection-list'));
                                removeLoader();
                            });
                        }, 'page/employee/contacts_add_settings', '#contact-add-selection-list-template', getData);
                    }).catch((err) => {
                        console.log('err', err);
                    })
            }).catch((err) => {
                console.log('err', err);
            })

            // }

        }
    });

    $(document).on('click', '#employee-customer-control-settings-modal-confirm', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getViewedData = $('.view-settings').find('.viewed-settings:checked').attr('value');
        sessionStorage.setItem('employee_customer_type', getViewedData);
        // contacts.contactList.forEach(v => { v.selected = false; });
        if (getViewedData == "contacts" || getViewedData == "none") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                user_id: sessionStorage.getItem("user_id"),
                user_type: "individual",
                business_id: sessionStorage.getItem('business_id'),
                employee_customer_type: getViewedData,
                employee_customer_contacts: []
            };
            console.log("reqParam", reqParam);
            updateSettingPageInfo(reqParam)
                .then((response) => {
                    console.log("updateSettingPageInfo response", response);
                    $('#contacts-settings-modal').remove();
                    sessionStorage.removeItem('employee_customer_type');
                    digibiz.employeeControlSettings = response;
                    Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                })
                .catch((err) => {
                    console.log("updateSettingPageInfo err", err);
                })
        } else {
            var getData = {};
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_all_active",
                count: 20,
                offset: 0
            }
            employeeList(reqParam)
                .then((response) => {
                    if (digibiz.employeeControlSettings != {} || digibiz.employeeControlSettings != null || digibiz.employeeControlSettings != undefined) {
                        $.each(digibiz.employeeControlSettings.employee_customer_contacts, function (ind, elem) {
                            // console.log('2w3e',contacts.contactSettings.show_number_type,getViewedData);
                            if (digibiz.employeeControlSettings.employee_customer_type == getViewedData) {
                                var index = response.findIndex(e => e.dj_unique_employee_id == elem.id);
                                console.log("index", index);
                                if (index != -1) {
                                    response[index]['selected'] = true;
                                }
                            }
                        })
                    }
                    getData = {
                        contactList: response,
                        device_id: crossplat.device.uuid
                    }
                    fetch.getHtml(function (fetchror, html) {
                        var modal_data = {
                            modal_id: "modal-show-mobile-number-contact-selection",
                            modal_header: "Select Contacts",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Confirm",
                                "id": "employee-customer-control-settings-choose-contacts-confirm",
                            }]
                        }
                        showModal(modal_data, function () {
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            removeLoader();
                            appScroll.scrollBar('.contact-recommend-to-members-selection-list');
                        });
                    }, 'page/employee/contacts_add_settings', '#contact-add-selection-list-template', getData);
                }).catch((err) => {
                    console.log('err', err);
                })

            // }

        }
    });

    $(document).on('click', '#employee-trusted-control-settings-modal-confirm', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getViewedData = $('.view-settings').find('.viewed-settings:checked').attr('value');
        sessionStorage.setItem('employee_trusted_type', getViewedData);
        // contacts.contactList.forEach(v => { v.selected = false; });
        if (getViewedData == "contacts" || getViewedData == "none") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                user_id: sessionStorage.getItem("user_id"),
                user_type: "individual",
                business_id: sessionStorage.getItem('business_id'),
                employee_trusted_type: getViewedData,
                add_employee_contacts: []
            };
            console.log("reqParam", reqParam);
            updateSettingPageInfo(reqParam)
                .then((response) => {
                    console.log("updateSettingPageInfo response", response);
                    $('#contacts-settings-modal').remove();
                    sessionStorage.removeItem('employee_trusted_type');
                    digibiz.employeeControlSettings = response;
                    Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                })
                .catch((err) => {
                    console.log("updateSettingPageInfo err", err);
                })
        } else {
            var getData = {};

            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_all_active",
                count: 20,
                offset: 0
            }
            employeeList(reqParam)
                .then((response) => {
                    if (digibiz.employeeControlSettings != {} || digibiz.employeeControlSettings != null || digibiz.employeeControlSettings != undefined) {
                        $.each(digibiz.employeeControlSettings.employee_trusted_contacts, function (ind, elem) {
                            // console.log('2w3e',contacts.contactSettings.show_number_type,getViewedData);
                            if (digibiz.employeeControlSettings.employee_trusted_type == getViewedData) {
                                var index = response.findIndex(e => e.dj_unique_employee_id == elem.id);
                                console.log("index", index);
                                if (index != -1) {
                                    response[index]['selected'] = true;
                                }
                            }
                        })
                    }
                    getData = {
                        contactList: response,
                        device_id: crossplat.device.uuid
                    }
                    fetch.getHtml(function (fetchror, html) {
                        var modal_data = {
                            modal_id: "modal-show-mobile-number-contact-selection",
                            modal_header: "Select Contacts",
                            modal_platform: crossplat.device.platform,
                            modal_body: html,
                            modal_action_buttons: [{
                                "name": "Confirm",
                                "id": "employee-trusted-control-settings-choose-contacts-confirm",
                            }]
                        }
                        showModal(modal_data, function () {
                            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                            } else {
                                $('.custom-modal-popup').show().addClass('modal-slide-top');
                            }
                            removeLoader();
                            appScroll.scrollBar('.contact-recommend-to-members-selection-list');
                        });
                    }, 'page/employee/contacts_add_settings', '#contact-add-selection-list-template', getData);
                }).catch((err) => {
                    console.log('err', err);
                })

            // }

        }
    });

    $(document).on('click', '#contacts-settings-choose-contacts-confirm', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getMembers = [];
        if ($('.contact-recommend-to-member-select-btn:checked').length > 0) {
            $.each($('.contact-recommend-to-member-select-btn:checked'), function (index, element) {
                getMembers.push({
                    'id': $(element).attr('data-member-id'),
                    'type': $(element).attr('data-member-type'),
                })
            })
            var reqParam = {
                device_id: crossplat.device.uuid,
                user_id: sessionStorage.getItem("user_id"),
                user_type: "individual",
                business_id: sessionStorage.getItem('business_id'),
                employee_add_type: sessionStorage.getItem('employee_add_type'),
                add_employee_contacts: getMembers
            };
            if (sessionStorage.getItem('business_id')) {
                reqParam.business_id = sessionStorage.getItem('business_id');
            }
            updateSettingPageInfo(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('employee_add_type');
                    $('#modal-show-mobile-number-contact-selection').remove();
                    digibiz.employeeControlSettings = response;
                    Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                    console.log("updateSettingPageInfo response", response);
                })
                .catch((err) => {
                    console.log("updateSettingPageInfo err", err);
                })
        } else {
            removeLoader();
            Materialize.toast('Please choose a contact.', 2000, 'round error-alert');
            // var alert_parms = {
            //     alert_id: "alert-no-contacts-choosen-settings",
            //     alert_platform: crossplat.device.platform,
            //     alert_title: "Alert",
            //     alert_body: `'My contacts' will be the default settings since there are no contacts choosen. Are you sure?`,
            //     alert_btn: [{
            //         name: "Yes",
            //         attr: [{ name: "id", value: "alert-yes-default-contacts-settings" }]
            //     },
            //     {
            //         name: "NO",
            //         attr: [{ name: "id", value: "alert-no-default-contacts-settings" }]
            //     }]
            // }
            // showAlert(alert_parms, function () { });
        }
    });

    $(document).on('click', '#employee-customer-control-settings-choose-contacts-confirm', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getMembers = [];
        if ($('.contact-recommend-to-member-select-btn:checked').length > 0) {
            $.each($('.contact-recommend-to-member-select-btn:checked'), function (index, element) {
                getMembers.push({
                    'id': $(element).attr('data-member-id'),
                    'type': $(element).attr('data-member-type'),
                })
            })
            var reqParam = {
                device_id: crossplat.device.uuid,
                user_id: sessionStorage.getItem("user_id"),
                user_type: "individual",
                business_id: sessionStorage.getItem('business_id'),
                employee_customer_type: sessionStorage.getItem('employee_customer_type'),
                employee_customer_contacts: getMembers
            };
            if (sessionStorage.getItem('business_id')) {
                reqParam.business_id = sessionStorage.getItem('business_id');
            }
            updateSettingPageInfo(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('employee_customer_type');
                    $('#modal-show-mobile-number-contact-selection').remove();
                    digibiz.employeeControlSettings = response;
                    Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                    console.log("updateSettingPageInfo response", response);
                })
                .catch((err) => {
                    console.log("updateSettingPageInfo err", err);
                })
        } else {
            removeLoader();
            // Materialize.toast('Please choose a contact.', 2000, 'round error-alert');
            var alert_parms = {
                alert_id: "alert-no-contacts-choosen-settings",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `'My contacts' will be the default settings since there are no contacts choosen. Are you sure?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "alert-yes-default-contacts-settings" }]
                },
                {
                    name: "NO",
                    attr: [{ name: "id", value: "alert-no-default-contacts-settings" }]
                }]
            }
            showAlert(alert_parms, function () { });
        }
    });

    $(document).on('click', '#employee-trusted-control-settings-choose-contacts-confirm', function (e) {
        e.stopImmediatePropagation(); if (isDoubleClicked($(this))) return;
        var getMembers = [];
        if ($('.contact-recommend-to-member-select-btn:checked').length > 0) {
            $.each($('.contact-recommend-to-member-select-btn:checked'), function (index, element) {
                getMembers.push({
                    'id': $(element).attr('data-member-id'),
                    'type': $(element).attr('data-member-type'),
                })
            })
            var reqParam = {
                device_id: crossplat.device.uuid,
                user_id: sessionStorage.getItem("user_id"),
                user_type: "individual",
                business_id: sessionStorage.getItem('business_id'),
                employee_trusted_type: sessionStorage.getItem('employee_trusted_type'),
                employee_trusted_contacts: getMembers
            };
            if (sessionStorage.getItem('business_id')) {
                reqParam.business_id = sessionStorage.getItem('business_id');
            }
            updateSettingPageInfo(reqParam)
                .then((response) => {
                    sessionStorage.removeItem('employee_trusted_type');
                    $('#modal-show-mobile-number-contact-selection').remove();
                    digibiz.employeeControlSettings = response;
                    Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                    console.log("updateSettingPageInfo response", response);
                })
                .catch((err) => {
                    console.log("updateSettingPageInfo err", err);
                })
        } else {
            removeLoader();
            // Materialize.toast('Please choose a contact.', 2000, 'round error-alert');
            var alert_parms = {
                alert_id: "alert-no-contacts-choosen-settings",
                alert_platform: crossplat.device.platform,
                alert_title: "Alert",
                alert_body: `'My contacts' will be the default settings since there are no contacts choosen. Are you sure?`,
                alert_btn: [{
                    name: "Yes",
                    attr: [{ name: "id", value: "alert-yes-default-contacts-settings" }]
                },
                {
                    name: "NO",
                    attr: [{ name: "id", value: "alert-no-default-contacts-settings" }]
                }]
            }
            showAlert(alert_parms, function () { });
        }
    });


    $(document).on('click', '#alert-no-default-contacts-settings', function () {
        $('#alert-no-contacts-choosen-settings').remove();
    });

    $(document).on('click', '#alert-yes-default-contacts-settings', function (e) {
        e.stopPropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        $('#alert-no-contacts-choosen-settings').remove();
        var reqParam = {
            device_id: crossplat.device.uuid,
            user_id: sessionStorage.getItem('session_owner_id'),
            user_type: sessionStorage.getItem('session_owner_type'),
            show_number_type: "contacts",
            show_number_contacts: []
        };
        if (sessionStorage.getItem('business_id')) {
            reqParam.business_id = sessionStorage.getItem('business_id');
        }
        console.log("reqParam", reqParam);
        updateSettingPageInfo(reqParam)
            .then((response) => {
                console.log("updateSettingPageInfo response", response);
                $('#modal-show-mobile-number-contact-selection').remove();
                sessionStorage.removeItem('show_number_type');
                contacts.contactSettings = response;
                Materialize.toast(`Successfully updated settings`, 3000, 'rounded error-alert');
                removeLoader();
            })
            .catch((err) => {
                console.log("updateSettingPageInfo err", err);
            })
    })


    //collaborator pending tab
    $(document).on('click', '.other-collaborator-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-collaborator-tab', 'other_group_collaborator');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
        digibiz.other_collaborator_groups_list = [];
        getOtherCollaboratorGroupsListPage();
    });

    //collaborator alumini tab
    $(document).on('click', '.alumini-collaborator-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-collaborator-tab', 'alumini_group_collaborator');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
        digibiz.alumini_collaborator_groups_list = [];
        getAluminiCollaboratorGroupsListPage();
    });

    //collaborator active tab
    $(document).on('click', '.my-collaborator-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-collaborator-tab', 'my_group_collaborator');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
        digibiz.collaborator_groups_list = [];
        getCollaboratorGroupsListPage();
    });

    $(document).on('click', '.floating-tab-btn .tabs-container .tab', function () {
        var $this = $(this);
        var currentTab = $($this).attr('data-id');
        console.log('currentTab', currentTab);
        $($this).addClass('active').siblings().removeClass('active');
        $('#' + currentTab).addClass('active').siblings().removeClass('active');
        if (currentTab == "customer-business-list") {
            addLoader();
            customersBusinessListPage()
                .then(() => {
                    removeLoader();
                }).catch((err) => {
                    console.log('err', err);
                })
        } else if (currentTab == "associate-customer-business-list") {
            addLoader();
            associateCustomersBusinessListPage()
                .then(() => {
                    removeLoader();
                }).catch((err) => {
                    console.log('err', err);
                })
        }
    });


    //collaborator pending tab
    $(document).on('click', '.collaborator-communication-group-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-communication-tab', 'collaborator-communication-group-list');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-communication-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-communication-tab')}"]`).addClass('active');
        digibiz.collaboratorCommunicationGroupsList = [];
        getCollaboratorCommunicationGroupsPage();
    });

    //collaborator active tab
    $(document).on('click', '.communication-group-tab', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        sessionStorage.setItem('selected-communication-tab', 'communication-group-list');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-communication-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-communication-tab')}"]`).addClass('active');
        digibiz.communicationGroupsList = [];
        getCommunicationGroupsPage();
    });


    $(document).on('click', '#contact-control-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "contact_control_logs");
        location.hash = "digibiz/logs";
        $('#modal-close-btn').click();
    });
    $(document).on('click', '#customer-control-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "customer_control_logs");
        location.hash = "digibiz/logs";
        $('#modal-close-btn').click();
    });
    $(document).on('click', '#trusted-control-activity-logs', function () {
        addLoader();
        sessionStorage.setItem('log_type', "trusted_control_logs");
        location.hash = "digibiz/logs";
        $('#modal-close-btn').click();
    });


    //employee type--> selection filter
    $(document).on('click', '.customer-status-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getEmployeeTypeId = $(this).attr('data-customer-status');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.customerFilterData.status.push(getEmployeeTypeId);
            digibiz.customerFilterData.status = digibiz.customerFilterData.status.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.customerFilterData.status = digibiz.customerFilterData.status.filter(function (element) {
                return element != getEmployeeTypeId;
            });
        }
    });


    //employee filter---> apply button
    $(document).on('click', '#customer-filter-apply-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();
        digibiz.customer_creation_active_list = [];
        if (digibiz.customerFilterData.status.length > 0) {
            fetch.replaceHtml(function () {
                statusWiseCustomerListPage()
                    .then(() => {
                        commonExecutables();
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                    });
            }, "page/employee/department_wise_employees_list_wrapper", "#department-wise-employees-list-wrapper-template", "#main-content-wrapper", null);
        } else {
            removeLoader();
            Materialize.toast(`Error! Please select atleast one option to filter`, 2000, "round error-alert");
        }

    });

    $(document).on('click', '.informationbtn', function (e) {
        e.stopPropagation(); if (isDoubleClicked($(this))) return;
        var $this = $(this);
        let information_btn = $($this).attr('data-information');
        console.log(information_btn);
        if (information_btn === "employee-information-list") {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "information-modal",
                modal_header: "Information",
                modal_body: `<div class="information-wrapper" id="information-wrapper"></div>`,
            }
            showModal(modal_data, function () {
                // showChatPollCreation(function () { });
                let info_content = `<div class="information-data">
                <div class="accepted-wrapper"><div class="status--accepted">Accepted</div><div>Employee request is accepted by the person</div></div>
                <div class="inactive-wrapper"><div class="status--inactive">Inactive</div><div>Employee is inactivated</div></div>
                <div class="unassigned-wrapper"><div class="status--unassigned">Unassigned</div><div>employee is not assigned to any department.Assign the employee to any department to make him active</div></div>
                <div class="exited-wrapper"><div class="status--exited">Exited</div><div>Person has deleted his digibizz account</div></div>
                </div>`
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').css({ 'display': 'flex', 'background': 'rgba(0,0,0,0.6)' }).addClass('modal-slide-top');
                }
                $('.information-wrapper').append(info_content);
            })
        }
        if (information_btn === "employee-group-information-list") {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "information-modal",
                modal_header: "Information",
                modal_body: `<div class="information-wrapper" id="information-wrapper"></div>`,
            }
            showModal(modal_data, function () {
                let info_content = `<div class="information-data">
                <div class="draft-wrapper"><div class="status--draft">Draft</div><div>Only Members are  added to the group.Please activate the group by adding moderators to make active</div></div>
                <div class="inactive-wrapper"><div class="status--inactive">Inactive</div><div>No Moderators in the group.Please add moderators to make group active</div></div>
                <div class="pending-wrapper"><div class="status--pending">Pending</div><div>Employees are pending to be added to the department</div></div>
                </div>`
                // showChatPollCreation(function () { });
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').css({ 'display': 'flex', 'background': 'rgba(0,0,0,0.6)' }).addClass('modal-slide-top');
                }
                $('.information-wrapper').append(info_content);
            })
        }
        if (information_btn === "custom-information-list") {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "information-modal",
                modal_header: "Information",
                modal_body: `<div class="information-wrapper" id="information-wrapper"></div>`,
            }
            showModal(modal_data, function () {
                let info_content = `<div class="information-data">
                <div class="accepted-wrapper"><div class="status--accepted">Accepted</div><div>Customer request is accepted by the person</div></div>
                <div class="inactive-wrapper"><div class="status--inactive">Inactive</div><div>Customer is inactivated</div></div>
                <div class="unassigned-wrapper"><div class="status--unassigned">Unassigned</div><div>employee is not assigned to any department.Assign the employee to any department to make him active</div></div>
                <div class="exited-wrapper"><div class="status--exited">Exited</div><div>Person has deleted his digibizz account/Exited as customer from the business</div></div>
                </div>`
                // showChatPollCreation(function () { });
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').css({ 'display': 'flex', 'background': 'rgba(0,0,0,0.6)' }).addClass('modal-slide-top');
                }
                $('.information-wrapper').append(info_content);
            })
        }
        if (information_btn === "custom-group-information-list") {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "information-modal",
                modal_header: "Information",
                modal_body: `<div class="information-wrapper" id="information-wrapper"></div>`,
            }
            showModal(modal_data, function () {
                let info_content = `<div class="information-data">
                <div class="draft-wrapper"><div class="status--draft">Draft</div><div>Only Members are  added to the group.Please activate the group by adding moderators to make active</div></div>
                <div class="inactive-wrapper"><div class="status--inactive">Inactive</div><div>No Moderators in the group.Please add moderators to make group active (same in case of  collabarator)</div></div>
                </div>`
                // showChatPollCreation(function () { });
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').css({ 'display': 'flex', 'background': 'rgba(0,0,0,0.6)' }).addClass('modal-slide-top');
                }
                $('.information-wrapper').append(info_content);
            })
        }
        if (information_btn === "communication-group-information-list") {
            console.log(information_btn);
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "information-modal",
                modal_header: "Information",
                modal_body: `<div class="information-wrapper" id="information-wrapper"></div>`,
            }
            showModal(modal_data, function () {
                let info_content = `<div class="information-data">                
                <div class="inactive-wrapper"><div class="status--inactive">Inactive</div><div>No Moderators in the group.Please add moderators to make group active</div></div>
                </div>`
                // showChatPollCreation(function () { });
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').css({ 'display': 'flex', 'background': 'rgba(0,0,0,0.6)' }).addClass('modal-slide-top');
                }
                $('.information-wrapper').append(info_content);
            })
        }
        if (information_btn === "team-information-list") {
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "information-modal",
                modal_header: "Information",
                modal_body: `<div class="information-wrapper" id="information-wrapper"></div>`,
            }
            showModal(modal_data, function () {
                let info_content = `<div class="information-data">
                <div class="draft-wrapper"><div class="status--draft">Draft</div><div>Only Members are  added to the group.Please activate the group by adding moderators to make active</div></div>
                <div class="inactive-wrapper"><div class="status--inactive">Inactive</div><div>No Moderators in the group.Please add moderators to make group active</div></div>
                </div>`
                // showChatPollCreation(function () { });
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                } else {
                    $('.custom-modal-popup').css({ 'display': 'flex', 'background': 'rgba(0,0,0,0.6)' }).addClass('modal-slide-top');
                }
                $('.information-wrapper').append(info_content);
            })
        }
    })


    $(document).on('click', '.group-status-filter-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        var $this = $(this);
        var getGroupStatus = $(this).attr('data-group-status');
        $($this).toggleClass('selected-filter');
        if ($($this).hasClass('selected-filter')) {
            var checkMark = `<div class="more-menu-wrapper selected-symbol"><i class="material-icons">check_box</i></div>`;
            $($this).append(checkMark);
            digibiz.groupFilterData.status.push(getGroupStatus);
            digibiz.groupFilterData.status = digibiz.groupFilterData.status.filter(function (elem, index, self) {
                return index === self.indexOf(elem);
            })
        } else {
            $($this).find('.selected-symbol').remove();
            digibiz.groupFilterData.status = digibiz.groupFilterData.status.filter(function (element) {
                return element != getGroupStatus;
            });
        }
    });


    //employee filter---> apply button
    $(document).on('click', '#group-filter-apply-btn', function (e) {
        e.stopImmediatePropagation();
        if (isDoubleClicked($(this))) return;
        addLoader();

        if (digibiz.groupFilterData.status.length > 0) {
            if ($('body').attr('app') == "team_group_creation_list") {
                statusWiseGroupListPage()
                    .then(() => {
                        commonExecutables();
                        removeLoader();
                    })
                    .catch((err) => {
                        removeLoader();
                    });
            } else if ($('body').attr('app') == "collaborator_groups_list") {
                if (sessionStorage.getItem('selected-collaborator-tab') == 'my_group_collaborator') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/collaborator/collaborator_group_tabs", "#collaborator-group-tabs-template", "#main-content-wrapper", null);
                } else if (sessionStorage.getItem('selected-collaborator-tab') == 'other_group_collaborator') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/collaborator/collaborator_group_tabs", "#collaborator-group-tabs-template", "#main-content-wrapper", null);
                }
            } else if ($('body').attr('app') == "communication_groups") {
                if (sessionStorage.getItem('selected-communication-tab') == 'communication-group-list') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/communication/communication_group_list_wrapper", "#communication-groups-list-wrapper-template", "#main-content-wrapper", null);
                } else if (sessionStorage.getItem('selected-communication-tab') == 'collaborator-communication-group-list') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/communication/communication_group_list_wrapper", "#communication-groups-list-wrapper-template", "#main-content-wrapper", null);
                }
            } else if ($('body').attr('app') == "customer_groups_identifiers_list") {
                if (sessionStorage.getItem('selected-customer-group-type-tab') == 'standard') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/customer/customer_contacts_groups_types_page", "#customer-contacts-groups-type-page-template", "#main-content-wrapper", null);
                } else if (sessionStorage.getItem('selected-customer-group-type-tab') == 'custom') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/customer/customer_contacts_groups_types_page", "#customer-contacts-groups-type-page-template", "#main-content-wrapper", null);
                }
            } else {
                if (sessionStorage.getItem('selected-employee-group-list-type-tab') == 'standard') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/employee/employee_group_list_tab", "#employees-group-list-tab-template", "#main-content-wrapper", null);
                } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == 'custom') {
                    fetch.replaceHtml(function () {
                        statusWiseGroupListPage()
                            .then(() => {
                                commonExecutables();
                                removeLoader();
                            })
                            .catch((err) => {
                                removeLoader();
                            });
                    }, "page/employee/employee_group_list_tab", "#employees-group-list-tab-template", "#main-content-wrapper", null);
                }
            }
        } else {
            removeLoader();
            Materialize.toast(`Error! Please select atleast one option to filter`, 2000, "round error-alert");
        }

    });


    //collaborator pending tab
    $(document).on('click', '.group-business-notification-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-business-notification-tab', 'group_business_notification');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-business-notification-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-business-notification-tab')}"]`).addClass('active');
        digibiz.group_business_notifications = [];
        getGroupBusinessNotificationsPage();
    });

    //collaborator active tab
    $(document).on('click', '.business-notification-tab', function () {
        addLoader();
        sessionStorage.setItem('selected-business-notification-tab', 'business_notification');
        $('.tab-content').removeClass('active');
        $(`.tab-content[id="${sessionStorage.getItem('selected-business-notification-tab')}"`).addClass('active');
        $('.tab').removeClass('active');
        $(`.tab[data-id="${sessionStorage.getItem('selected-business-notification-tab')}"]`).addClass('active');
        digibiz.business_notifications = [];
        getBusinessNotificationsPage();
    });

}
//end of executables
