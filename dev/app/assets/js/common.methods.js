// double click prevent
function isDoubleClicked(element) {
    //if already clicked return TRUE to indicate this click is not allowed
    if (element.data("isclicked")) return true;

    //mark as clicked for 1 second
    element.data("isclicked", true);
    setTimeout(function () {
        element.removeData("isclicked");
    }, 500);

    //return FALSE to indicate this click was allowed
    return false;
}

var appScroll = {
    scrollBar: function (element) {
        $(element).overlayScrollbars({
            className: "os-theme-dark",
            // resize          : "both",
            sizeAutoCapable: true,
            // paddingAbsolute : true,
            autoUpdate: true,
            scrollbars: {
                clickScrolling: true,
                dragScrolling: true,
                touchSupport: true
            },

            callbacks: {
                onScroll: function (e) {
                    var target = e.target;
                    const targetElem = target.querySelector(".os-content");
                    const targetParents = targetElem.parentElement.parentElement.parentElement;
                    targetParents.dispatchEvent(new CustomEvent('el_scroll', { detail: { scrollTop: target.scrollTop, scrollHeight: target.scrollHeight, offsetHeight: target.offsetHeight } }));
                }
            }
        });
    }
};


function joinRoom(room) {
    console.log("room", room);
    sockets.digibizSocket.emit("joinroom", room);
}

function getInputText(element) {
    return $(element).html()
        .replace(/&#10;/g, '\n')
        .replace(/&#09;/g, '\t')
        .replace(/<img[^>]*alt="([^"]+)"[^>]*>/ig, '$1')
        .replace(/\n|\r/g, '')
        .replace(/<br[^>]*>/ig, '\n')
        .replace(/(?:<(?:div|p|ol|ul|li|pre|code|object)[^>]*>)+/ig, '<div>')
        .replace(/(?:<\/(?:div|p|ol|ul|li|pre|code|object)>)+/ig, '</div>')
        .replace(/\n<div><\/div>/ig, '\n')
        .replace(/<div><\/div>\n/ig, '\n')
        .replace(/(?:<div>)+<\/div>/ig, '\n')
        .replace(/([^\n])<\/div><div>/ig, '$1\n')
        .replace(/(?:<\/div>)+/ig, '</div>')
        .replace(/([^\n])<\/div>([^\n])/ig, '$1\n$2')
        .replace(/<\/div>/ig, '')
        .replace(/([^\n])<div>/ig, '$1\n')
        .replace(/\n<div>/ig, '\n')
        .replace(/<div>\n/ig, '\n\n')
        .replace(/<(?:[^>]+)?>/g, '')
        .replace(/&nbsp;/g, ' ')
        .replace(/&lt;/g, '<')
        .replace(/&gt;/g, '>')
        .replace(/&quot;/g, '"')
        .replace(/&#x27;/g, "'")
        .replace(/&#x60;/g, '`')
        .replace(/&#60;/g, '<')
        .replace(/&#62;/g, '>')
        .replace(/&amp;/g, '&');
}

/**
 * Route Name : checkTransactionalPassword
 * Description:
 * Request Parms: device_id,password
 */
function checkTransactionalPassword(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response);
                } else {
                    reject(JSON.parse(response.responseText));
                }
            },
            api.verify_transaction_password,
            "POST",
            "JSON",
            requestParms
        );
    });
}

function clearGlobalArrays() {
    digibiz.department_list_selection = [],
        digibiz.active_super_admins_list = [],
        digibiz.pending_super_admins_list = [],
        digibiz.groupPictureblob = {},
        digibiz.storages = [],
        digibiz.digibiz_storages = [],
        digibiz.access_list = [],
        digibiz.employee_group_image = {},
        digibiz.collaborator_employee_list = [],
        digibiz.employee_group_employee_members = [],
        digibiz.employee_group_standard_group_members = [],
        digibiz.employee_group_department_members = [],//check used or not
        digibiz.standard_employees_groups_list_page = [],
        digibiz.custom_employees_groups_list_page = [],
        digibiz.business_owner_business_list = [],
        digibiz.employee_notification_details_list = [],
        digibiz.customer_notification_details_list = [],
        digibiz.associate_customer_notification_details_list = [],
        digibiz.employee_business_list = [],
        digibiz.customer_business_list = [],
        // digibiz.customer_business_list = [],
        digibiz.customer_collaborator_business_list = [],
        digibiz.digibiz_notifications = [],
        digibiz.business_notifications = [],
        digibiz.active_employee_creation_employee_list = [],
        digibiz.pending_employee_creation_employee_list = [],
        digibiz.customer_identifiers = [],
        digibiz.associate_customer_identifiers = [],
        digibiz.customer_identifiers_active_customers_list = [],
        digibiz.customer_identifiers_pending_customers_list = [],
        digibiz.customer_creation_active_list = [],
        digibiz.customer_creation_pending_list = [],
        digibiz.standard_customer_groups_identifiers_list = [],
        digibiz.customer_contacts_identifiers_list = [],
        digibiz.customer_access_identifiers_list = [],
        digibiz.contacts_items_list = [],
        digibiz.customer_access_identifier_items_list = [],
        digibiz.contacts_list = [],
        digibiz.groups_list = [],
        digibiz.custom_groups_list = [],
        digibiz.all_employees_list = [],
        digibiz.department_wise_employees_list = [],
        digibiz.collaborator_contact_list = [],
        digibiz.pending_collaborator_contact_list = [],
        digibiz.collaborator_contact_list_notification_details = [],
        digibiz.collaborator_groups_list = [],
        digibiz.collaborator_group_owner_employee_members = [],
        digibiz.cropper = {},
        digibiz.declarationVideo = {},
        digibiz.isDeclarationTransactionPictureSelected = false,
        digibiz.isDeclarationSignaturePictureSelected = false,
        digibiz.isDeclarationVideoPictureSelected = false,
        digibiz.isAssociateCustomerIdentityPictureSelected = false,
        digibiz.isCustomerIdentityPictureSelected = false,
        digibiz.isEmployeeIdentityPictureSelected = false,
        digibiz.isBusinessDisplayPictureSelected = false,
        digibiz.isGroupPictureSelected = false,
        digibiz.homePageList = [],
        digibiz.file_type = "",
        digibiz.selectedShareDocument = [],
        digibiz.filemanager_breadcrumb_path = [],
        digibiz.cloudAssets = [],
        digibiz.uploadingFiles = [],
        digibiz.cameraUploadingFiles = [],
        digibiz.transactional_picture = {},
        digibiz.signature_picture = {},
        digibiz.device_multimedia_selected_files = [],
        digibiz.cloud_uploading_files = [],
        digibiz.cloud_multimedia_selected_files = [],
        digibiz.camera_multimedia_selected_files = [],
        digibiz.device_multimedia_uploaded_files = [],
        digibiz.cloud_multimedia_uploaded_files = [],
        digibiz.camera_multimedia_uploaded_files = [],
        digibiz.assets = [],
        digibiz.department_list = [],
        digibiz.role_management_employee_list = [],
        digibiz.role_management_employee_apps_access_list = [],
        digibiz.role_assignment = {},
        digibiz.logs_list = [],
        digibiz.customerGroupsContactsList = [],
        digibiz.customerGroupCustomGroupsList = [],
        digibiz.communicationGroupsList = [],
        digibiz.communicationEmployeeGroupsList = [],
        digibiz.communicationCustomerGroupsList = [],
        digibiz.communicationGroupsCustomerContactsList = [],
        digibiz.communicationActivateEmployeeGroupsList = [],
        digibiz.communicationActivateCustomersGroupsList = [],
        digibiz.communicationActivateEmployeeGroupEmployeeList = [],
        digibiz.communicationCreateEmployeeGroupEmployeeList = [],
        digibiz.communicationActivateCustomerGroupCustomersList = [],
        digibiz.communicationCreateEmployeeGroupsList = [],
        digibiz.communicationCreateCustomersGroupsList = [],
        digibiz.communicationCreateCollaboratorGroupsList = [],
        digibiz.communicationGroupActivate = [],
        digibiz.alreadySelected = [],
        digibiz.alreadySelectedDepartment = [],
        digibiz.alreadyModuleAdmin = [];
        sessionStorage.removeItem('group_creation_running');
        sessionStorage.removeItem('group_id');
}

// function ucfirst(str, force) {
//     //console.log("str", str);
//     str = force ? str.toLowerCase() : str;
//     return str.replace(/(\b)([a-zA-Z])/,
//         function (firstLetter) {
//             return firstLetter.toUpperCase();
//         });
// }

function firstLetterUpperCase(word) {
    return word.charAt(0).toUpperCase() + word.slice(1);
}

function getDigibizAccountPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        getUserProfile(function (err, data) {
            if (!err && data) {
                //console.log("getUserProfile data response", data);
                var getData = {
                    device_id: crossplat.device.uuid,
                    user_profile: data
                }
                fetch.replaceHtml(function () {
                    resolve();
                }, "page/landPage/digibiz_account", "#digibiz-account-page-template", "#app-root", getData);
            } else {
                resolve();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            }
        })
    })
}

function getDigibizAccountRoleUpdatePage() {
    return new Promise((resolve, reject) => {
        addLoader();
        getUserProfile(function (err, data) {
            if (!err && data) {
                //console.log("getUserProfile data response", data);
                var getData = {
                    device_id: crossplat.device.uuid,
                    user_profile: data
                }
                fetch.replaceHtml(function () {
                    resolve();
                }, "page/landPage/digibiz_account_role_update", "#digibiz-account-role-update-page-template", "#app-root", getData);
            } else {
                resolve();
                Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
            }
        })
    })
}

function getDigibizAccountStoragePage() {
    return new Promise((resolve, reject) => {
        addLoader();
        reqParam = {
            device_id: crossplat.device.uuid,
            uuid: sessionStorage.getItem('uuid')
        }
        getDigibizAccount(reqParam)
            .then((result) => {
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    selected: true,
                    id: sessionStorage.getItem('account_id'),
                    type: "individual"
                }
                console.log("requestParams", requestParams)
                fetch.apiCall(function (response, status, xhr) {
                    if (status === "success") {
                        window.sessionStorage.setItem('storage_token', JSON.stringify(response.Data));
                        //put storage data in an array
                        if (result.hasOwnProperty('storage') && result.storage) {
                            digibiz.digibiz_storages = [];
                            //console.log("storage is present");
                            if (result.storage.hasOwnProperty('GoogleDrive') && result.storage.GoogleDrive) {
                                digibiz.digibiz_storages.push({
                                    "name": "GoogleDrive",
                                    "account": result.storage.GoogleDrive.account
                                })
                            }
                            if (result.storage.hasOwnProperty('OneDrive') && result.storage.OneDrive) {
                                digibiz.digibiz_storages.push({
                                    "name": "OneDrive",
                                    "account": result.storage.OneDrive.account
                                })
                            }
                            if (result.storage.hasOwnProperty('DropBox') && result.storage.DropBox) {
                                digibiz.digibiz_storages.push({
                                    "name": "DropBox",
                                    "account": result.storage.DropBox.account
                                })
                            }
                            if (result.storage.hasOwnProperty('DJ') && result.storage.DJ) {
                                digibiz.digibiz_storages.push({
                                    "name": "DJ",
                                    "account": result.storage.DJ
                                })
                            }
                        } else {
                            console.log("storage not present");
                            console.log("setting_digibiz_storage_selection")
                            sessionStorage.setItem('digibiz_storage_selection', 'first');
                        }
                        if (sessionStorage.getItem('digibiz_storage_selection') == "first") {
                            if (result.hasOwnProperty('storage') && result.storage) {
                                if (result.storage.length >= 4) {
                                    var getData = {
                                        storage_list: digibiz.digibiz_storages,
                                        active_storage: result.active_storage,
                                    }
                                } else {
                                    var getData = {
                                        storage_list: digibiz.digibiz_storages,
                                        active_storage: result.active_storage,
                                        addStorage: true
                                    }
                                }
                            } else {
                                var getData = {
                                    storage_list: digibiz.digibiz_storages,
                                    active_storage: result.active_storage,
                                    addStorage: true
                                }
                            }
                            fetch.replaceHtml(function () {
                                removeLoader();
                                resolve();
                            }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
                        } else {
                            console.log("123");
                            var getData = {
                                storage_list: digibiz.digibiz_storages,
                                active_storage: result.active_storage,
                                addStorage: true,
                                storage_token: JSON.parse(window.sessionStorage.getItem('storage_token'))
                            }
                            console.log("getData", getData);
                            console.log("checc", getData.storage_token.tokenStatus)
                            fetch.replaceHtml(function () {
                                if (getData.storage_token.tokenStatus == 'inactive') {
                                    showReauthenticateStorage();
                                    if (sessionStorage.getItem('authErrorCode')) {
                                        Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
                                    } else {
                                        Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
                                    }
                                } else {
                                    console.log("4566")
                                }
                                removeLoader();
                                resolve();
                            }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
                        }
                    } else {
                        console.log("error", response)
                        if (response.status == 400) {
                            window.sessionStorage.setItem('storage_token', JSON.stringify(response.responseJSON.Data));
                            //put storage data in an array
                            if (result.hasOwnProperty('storage') && result.storage) {
                                digibiz.digibiz_storages = [];
                                console.log("storage is present");
                                if (result.storage.hasOwnProperty('GoogleDrive') && result.storage.GoogleDrive) {
                                    digibiz.digibiz_storages.push({
                                        "name": "GoogleDrive",
                                        "account": result.storage.GoogleDrive.account
                                    })
                                }
                                if (result.storage.hasOwnProperty('OneDrive') && result.storage.OneDrive) {
                                    digibiz.digibiz_storages.push({
                                        "name": "OneDrive",
                                        "account": result.storage.OneDrive.account
                                    })
                                }
                                if (result.storage.hasOwnProperty('DropBox') && result.storage.DropBox) {
                                    digibiz.digibiz_storages.push({
                                        "name": "DropBox",
                                        "account": result.storage.DropBox.account
                                    })
                                }
                                if (result.storage.hasOwnProperty('DJ') && result.storage.DJ) {
                                    digibiz.digibiz_storages.push({
                                        "name": "DJ",
                                        "account": result.storage.DJ
                                    })
                                }
                            } else {
                                console.log("storage not present");
                                console.log("setting_digibiz_storage_selection")
                                sessionStorage.setItem('digibiz_storage_selection', 'first');
                            }
                            if (sessionStorage.getItem('digibiz_storage_selection') == "first") {
                                if (result.hasOwnProperty('storage') && result.storage) {
                                    if (result.storage.length >= 4) {
                                        var getData = {
                                            storage_list: digibiz.digibiz_storages,
                                            active_storage: result.active_storage,
                                        }
                                    } else {
                                        var getData = {
                                            storage_list: digibiz.digibiz_storages,
                                            active_storage: result.active_storage,
                                            addStorage: true
                                        }
                                    }
                                } else {
                                    var getData = {
                                        storage_list: digibiz.digibiz_storages,
                                        active_storage: result.active_storage,
                                        addStorage: true
                                    }
                                }
                                fetch.replaceHtml(function () {
                                    removeLoader();
                                    resolve();
                                }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
                            } else {
                                console.log("123");
                                var getData = {
                                    storage_list: digibiz.digibiz_storages,
                                    active_storage: result.active_storage,
                                    addStorage: true,
                                    storage_token: JSON.parse(window.sessionStorage.getItem('storage_token'))
                                }
                                //console.log("getData", getData);
                                //console.log("checc", getData.storage_token.tokenStatus)
                                fetch.replaceHtml(function () {
                                    if (getData.storage_token.tokenStatus == 'inactive') {
                                        showReauthenticateStorage();
                                        if (sessionStorage.getItem('authErrorCode')) {
                                            Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
                                        } else {
                                            Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
                                        }
                                    } else {
                                        //console.log("4566")
                                    }
                                    removeLoader();
                                    resolve();
                                }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
                            }
                        } else {
                            console.log("!@#$!@#$ checkkkkkkk in middleware")
                        }
                    }
                }, api.check_token, "POST", "JSON", requestParams);
            })
            .catch((err) => {
                var getData = {
                    addStorage: true
                }
                //console.log("getData", getData);
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
            })
    })
}

// function getDigibizAccountStorageCheckHelperMethod() {
//     fetch.apiCall(function (response, status, xhr) {
//         if (status === "success") {
//             window.sessionStorage.setItem('storage_token', JSON.stringify(response.Data));
//             //put storage data in an array
//             if (result.hasOwnProperty('storage') && result.storage) {
//                 digibiz.digibiz_storages = [];
//                 //console.log("storage is present");
//                 if (result.storage.hasOwnProperty('GoogleDrive') && result.storage.GoogleDrive) {
//                     digibiz.digibiz_storages.push({
//                         "name": "GoogleDrive",
//                         "account": result.storage.GoogleDrive.account
//                     })
//                 }
//                 if (result.storage.hasOwnProperty('OneDrive') && result.storage.OneDrive) {
//                     digibiz.digibiz_storages.push({
//                         "name": "OneDrive",
//                         "account": result.storage.OneDrive.account
//                     })
//                 }
//                 if (result.storage.hasOwnProperty('DropBox') && result.storage.DropBox) {
//                     digibiz.digibiz_storages.push({
//                         "name": "DropBox",
//                         "account": result.storage.DropBox.account
//                     })
//                 }
//                 if (result.storage.hasOwnProperty('DJ') && result.storage.DJ) {
//                     digibiz.digibiz_storages.push({
//                         "name": "DJ",
//                         "account": result.storage.DJ
//                     })
//                 }
//             } else {
//                 console.log("storage not present");
//                 console.log("setting_digibiz_storage_selection")
//                 sessionStorage.setItem('digibiz_storage_selection', 'first');
//             }
//             if (sessionStorage.getItem('digibiz_storage_selection') == "first") {
//                 if (result.hasOwnProperty('storage') && result.storage) {
//                     if (result.storage.length >= 4) {
//                         var getData = {
//                             storage_list: digibiz.digibiz_storages,
//                             active_storage: result.active_storage,
//                         }
//                     } else {
//                         var getData = {
//                             storage_list: digibiz.digibiz_storages,
//                             active_storage: result.active_storage,
//                             addStorage: true
//                         }
//                     }
//                 } else {
//                     var getData = {
//                         storage_list: digibiz.digibiz_storages,
//                         active_storage: result.active_storage,
//                         addStorage: true
//                     }
//                 }
//                 // fetch.replaceHtml(function () {
//                 removeLoader();
//                 // resolve();
//                 // }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
//             } else {
//                 console.log("123");
//                 var getData = {
//                     storage_list: digibiz.digibiz_storages,
//                     active_storage: result.active_storage,
//                     addStorage: true,
//                     storage_token: JSON.parse(window.sessionStorage.getItem('storage_token'))
//                 }
//                 console.log("getData", getData);
//                 console.log("checc", getData.storage_token.tokenStatus)
//                 // fetch.replaceHtml(function () {
//                 if (getData.storage_token.tokenStatus == 'inactive') {
//                     showReauthenticateStorage();
//                     if (sessionStorage.getItem('authErrorCode')) {
//                         Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
//                     } else {
//                         Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
//                     }
//                 } else {
//                     console.log("4566")
//                 }
//                 removeLoader();
//                 // resolve();
//                 // }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
//             }
//         } else {
//             console.log("error", response)
//             if (response.status == 400) {
//                 window.sessionStorage.setItem('storage_token', JSON.stringify(response.responseJSON.Data));
//                 //put storage data in an array
//                 if (result.hasOwnProperty('storage') && result.storage) {
//                     digibiz.digibiz_storages = [];
//                     console.log("storage is present");
//                     if (result.storage.hasOwnProperty('GoogleDrive') && result.storage.GoogleDrive) {
//                         digibiz.digibiz_storages.push({
//                             "name": "GoogleDrive",
//                             "account": result.storage.GoogleDrive.account
//                         })
//                     }
//                     if (result.storage.hasOwnProperty('OneDrive') && result.storage.OneDrive) {
//                         digibiz.digibiz_storages.push({
//                             "name": "OneDrive",
//                             "account": result.storage.OneDrive.account
//                         })
//                     }
//                     if (result.storage.hasOwnProperty('DropBox') && result.storage.DropBox) {
//                         digibiz.digibiz_storages.push({
//                             "name": "DropBox",
//                             "account": result.storage.DropBox.account
//                         })
//                     }
//                     if (result.storage.hasOwnProperty('DJ') && result.storage.DJ) {
//                         digibiz.digibiz_storages.push({
//                             "name": "DJ",
//                             "account": result.storage.DJ
//                         })
//                     }
//                 } else {
//                     console.log("storage not present");
//                     console.log("setting_digibiz_storage_selection")
//                     sessionStorage.setItem('digibiz_storage_selection', 'first');
//                 }
//                 if (sessionStorage.getItem('digibiz_storage_selection') == "first") {
//                     if (result.hasOwnProperty('storage') && result.storage) {
//                         if (result.storage.length >= 4) {
//                             var getData = {
//                                 storage_list: digibiz.digibiz_storages,
//                                 active_storage: result.active_storage,
//                             }
//                         } else {
//                             var getData = {
//                                 storage_list: digibiz.digibiz_storages,
//                                 active_storage: result.active_storage,
//                                 addStorage: true
//                             }
//                         }
//                     } else {
//                         var getData = {
//                             storage_list: digibiz.digibiz_storages,
//                             active_storage: result.active_storage,
//                             addStorage: true
//                         }
//                     }
//                     // fetch.replaceHtml(function () {
//                     removeLoader();
//                     // resolve();
//                     // }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
//                 } else {
//                     console.log("123");
//                     var getData = {
//                         storage_list: digibiz.digibiz_storages,
//                         active_storage: result.active_storage,
//                         addStorage: true,
//                         storage_token: JSON.parse(window.sessionStorage.getItem('storage_token'))
//                     }
//                     //console.log("getData", getData);
//                     //console.log("checc", getData.storage_token.tokenStatus)
//                     // fetch.replaceHtml(function () {
//                     if (getData.storage_token.tokenStatus == 'inactive') {
//                         showReauthenticateStorage();
//                         if (sessionStorage.getItem('authErrorCode')) {
//                             Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
//                         } else {
//                             Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
//                         }
//                     } else {
//                         //console.log("4566")
//                     }
//                     removeLoader();
//                     // resolve();
//                     // }, "page/landPage/digibiz_account_storage", "#digibiz-account-storage-page-template", "#app-root", getData);
//                 }
//             } else {
//                 console.log("!@#$!@#$ checkkkkkkk in middleware")
//             }
//         }
//     }, api.check_token, "POST", "JSON", requestParams);
// }


function getBusinessStoragePage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('business_id')
        }
        businessGet(reqParam)
            .then((response) => {
                digibiz.storages = [];
                //put storage data in an array
                if (response.hasOwnProperty('storage') && response.storage) {
                    //console.log("storage is present");
                    if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                        digibiz.storages.push({
                            "name": "GoogleDrive",
                            "account": response.storage.GoogleDrive.account
                        })
                    }
                    if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                        digibiz.storages.push({
                            "name": "OneDrive",
                            "account": response.storage.OneDrive.account
                        })
                    }
                    if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                        digibiz.storages.push({
                            "name": "DropBox",
                            "account": response.storage.DropBox.account
                        })
                    }
                    if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                        digibiz.storages.push({
                            "name": "DJ",
                            "account": response.storage.DJ
                        })
                    }
                }
                var getBusiness = {
                    storage_list: digibiz.storages,
                    active_storage: response.active_storage
                }
                if (digibiz.storages.length < 4) {
                    getBusiness.addStorage = true;
                }
                fetch.replaceHtml(function () {
                    console.log("checkSession in storage", sessionStorage);

                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        selected: true,
                        id: sessionStorage.getItem('business_id'),
                        type: "business"
                    }
                    fetch.apiCall(function (response, status, xhr) {
                        if (status === "success") {
                            console.log("success")
                            resolve();
                        } else {
                            window.sessionStorage.setItem('business_storage_token', JSON.stringify(response.responseJSON.Data));
                            if (sessionStorage.getItem('business_storage_token') && JSON.parse(sessionStorage.getItem('business_storage_token')).tokenStatus == 'inactive') {
                                if (sessionStorage.getItem('authErrorCode')) {
                                    showReauthenticateBusinessStorage();
                                    resolve();
                                    Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
                                } else {
                                    Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
                                    showReauthenticateBusinessStorage();
                                    resolve();
                                }
                            } else {
                                resolve();
                                console.log("4566", sessionStorage.getItem('business_storage_token'))
                            }
                        }
                    }, api.check_token, "POST", "JSON", requestParams);

                    // if (sessionStorage.getItem('business_storage_token') && JSON.parse(sessionStorage.getItem('business_storage_token')).tokenStatus == 'inactive') {

                    //     if (sessionStorage.getItem('authErrorCode')) {
                    //         showReauthenticateBusinessStorage();
                    //         Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
                    //     } else {
                    //         //console.log("1234")
                    //         Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
                    //         showReauthenticateBusinessStorage();
                    //         // activateStorage("DJ", function (e) {
                    //         // })
                    //     }
                    // } else {
                    //     console.log("4566", sessionStorage.getItem('business_storage_token'))
                    // }
                    // resolve();
                }, "page/business/business_storage", "#business-storage-template", "#main-content-wrapper", getBusiness);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Business not found.", 10000, 'error-alert');
            })
    })
}

function checkBusinessActiveStorage(callback) {
    var reqParam = {
        device_id: crossplat.device.uuid,
        id: sessionStorage.getItem('business_id')
    }
    businessGet(reqParam)
        .then((response) => {
            digibiz.storages = [];
            //put storage data in an array
            if (response.hasOwnProperty('storage') && response.storage) {
                //console.log("storage is present");
                if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                    digibiz.storages.push({
                        "name": "GoogleDrive",
                        "account": response.storage.GoogleDrive.account
                    })
                }
                if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                    digibiz.storages.push({
                        "name": "OneDrive",
                        "account": response.storage.OneDrive.account
                    })
                }
                if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                    digibiz.storages.push({
                        "name": "DropBox",
                        "account": response.storage.DropBox.account
                    })
                }
                if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                    digibiz.storages.push({
                        "name": "DJ",
                        "account": response.storage.DJ
                    })
                }
            }
            var getBusiness = {
                storage_list: digibiz.storages,
                active_storage: response.active_storage
            }
            if (digibiz.storages.length < 4) {
                getBusiness.addStorage = true;
            }
            console.log("checkSession in storage", sessionStorage);

            var requestParams = {
                device_id: crossplat.device.uuid,
                selected: true,
                id: sessionStorage.getItem('business_id'),
                type: "business"
            }
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    console.log("success")
                    callback();
                } else {
                    window.sessionStorage.setItem('business_storage_token', JSON.stringify(response.responseJSON.Data));
                    if (sessionStorage.getItem('business_storage_token') && JSON.parse(sessionStorage.getItem('business_storage_token')).tokenStatus == 'inactive') {
                        if (sessionStorage.getItem('authErrorCode')) {
                            showReauthenticateBusinessStorage();
                            callback();
                            Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
                        } else {
                            Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
                            showReauthenticateBusinessStorage();
                            callback();
                        }
                    } else {
                        callback();
                        console.log("4566", sessionStorage.getItem('business_storage_token'))
                    }
                }
            }, api.check_token, "POST", "JSON", requestParams);
        })
        .catch((err) => {
            removeLoader();
            Materialize.toast("Business not found.", 10000, 'error-alert');
        })
}

function showReauthenticateStorage() {
    $('.alert-wrapper').remove();
    var token_status = JSON.parse(window.sessionStorage.getItem('storage_token'));
    var storage_token = digibiz.digibiz_storages.find(e => e.name == token_status.selectedStorage);
    var msgBody = ``;
    if (storage_token) {
        var alert_parms = {
            alert_id: "Reauthenticate-account",
            alert_platform: crossplat.device.platform,
            alert_title: `Reauthenticate ${token_status.selectedStorage.toLowerCase()} account`,
            alert_body: `<div class="storage-active-account">
            <div class="profile-picture-wrapper"><img src="${storage_token.account.picture}"/></div>
            <div class="profile-details-wrapper"><div class="profile-name">${storage_token.account.name}</div><div class="profile-email">${storage_token.account.email}</div></div>
            </div>`,
            alert_btn: [{
                name: "Choose other storage",
                attr: [{ name: "id", value: "change-drive-button" },
                { name: "data-storage", value: token_status.selectedStorage }]
            }, {
                name: "Reauthenticate to Same Drive",
                attr: [{ name: "id", value: "logout-add-new-storage" },
                { name: "data-storage", value: token_status.selectedStorage }]
            }]
        }
    } else {
        var alert_parms = {
            alert_id: "Reauthenticate-account",
            alert_platform: crossplat.device.platform,
            alert_title: `Authenticate to ${token_status.selectedStorage.toLowerCase()} account`,
            alert_body: `Login to ${token_status.selectedStorage.toLowerCase()} account or enable other storage.`,
            alert_btn: [{
                name: "Choose other storage",
                attr: [
                    {
                        name: "id", value: "change-drive-button"
                    },
                    {
                        name: "data-storage", value: token_status.selectedStorage
                    }
                ]
            },
            {
                name: "Login",
                attr: [
                    {
                        name: "id", value: "reauthenticate-storage"
                    },
                    {
                        name: "data-storage", value: token_status.selectedStorage
                    }
                ]
            }]
        }
    }
    showAlert(alert_parms, function () {
        removeLoader();
    });
}

function showReauthenticateBusinessStorage() {
    //console.log("showReauthenticateBusinessStorage")
    $('.alert-wrapper').remove();
    var token_status = JSON.parse(window.sessionStorage.getItem('business_storage_token'));
    console.log("token_status", token_status)
    var storage_token = digibiz.storages.find(e => e.name == token_status.selectedStorage);
    console.log("storage_token", storage_token)
    var msgBody = ``;
    if (storage_token) {
        //console.log("if")
        var alert_parms = {
            alert_id: "Reauthenticate-account",
            alert_platform: crossplat.device.platform,
            alert_title: `Reauthenticate ${token_status.selectedStorage.toLowerCase()} account`,
            alert_body: `<div class="storage-active-account">
            <div class="profile-picture-wrapper"><img src="${storage_token.account.picture}"/></div>
            <div class="profile-details-wrapper"><div class="profile-name">${storage_token.account.name}</div><div class="profile-email">${storage_token.account.email}</div></div>
            </div>`,
            alert_btn: [{
                name: "Choose other storage",
                attr: [{ name: "id", value: "change-business-drive-button" },
                { name: "data-storage", value: token_status.selectedStorage }]
            }, {
                name: "Reauthenticate to Same Drive",
                attr: [{ name: "id", value: "logout-add-new-business-storage" },
                { name: "data-storage", value: token_status.selectedStorage }]
            }]
        }
        showAlert(alert_parms, function () { removeLoader(); });
    }
    else {
        //console.log("else")
        var alert_parms = {
            alert_id: "Reauthenticate-account",
            alert_platform: crossplat.device.platform,
            alert_title: `Authenticate to ${token_status.selectedStorage.toLowerCase()} account`,
            alert_body: `Login to ${token_status.selectedStorage.toLowerCase()} account or enable other storage.`,
            alert_btn: [{
                name: "Choose other storage",
                attr: [{ name: "id", value: "change-business-drive-button" },
                { name: "data-storage", value: token_status.selectedStorage }]
            },
            {
                name: "Login",
                attr: [{
                    name: "id", value: "reauthenticate-storage"
                },
                { name: "data-storage", value: token_status.selectedStorage }]
            }]
        }
        showAlert(alert_parms, function () {
            removeLoader();
        });
    }

}

function addDigibizAccount(requestParms) {
    // //console.log("add account api call")
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_account, "POST", "JSON", requestParms);
    });
}

function updateDigibizAccount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_digibiz_record, "POST", "JSON", requestParms);
    });
}

function accountGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_digibiz_record, "POST", "JSON", requestParms);
    });
}

function accountSettings(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.account_settings, "POST", "JSON", requestParms);
    });
}

function accountUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.account_update, "POST", "JSON", requestParms);
    });
}

function accountDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.account_delete, "POST", "JSON", requestParms);
    });
}

function checkCanAccountDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.check_can_account_delete, "POST", "JSON", requestParms);
    });
}

function getDigibizAccount(requestParms) {
    //console.log("get account api call")
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_account, "POST", "JSON", requestParms);
    });
}

function addJeeviAccount(requestParms) {
    // //console.log("add account api call")
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_jeevi, "POST", "JSON", requestParms);
    });
}

function getJeeviAccount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            console.log('response', response);
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_jeevi, "POST", "JSON", requestParms);
    });
}

function jeeviAccountSettings(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.jeevi_account_settings, "POST", "JSON", requestParms);
    });
}

function jeeviAccountDelete(requestParms) {
    //console.log("1234")
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.jeevi_account_delete, "POST", "JSON", requestParms);
    });
}

function addDisplayControl(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_display_control, "POST", "JSON", requestParms);
    });
}

function getDisplayControl(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_display_control, "POST", "JSON", requestParms);
    });
}

function deleteDisplayControl(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_display_control, "POST", "JSON", requestParms);
    });
}


function addTheme(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_theme, "POST", "JSON", requestParms);
    });
}

function getTheme(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_theme, "POST", "JSON", requestParms);
    });
}

function deleteTheme(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_theme, "POST", "JSON", requestParms);
    });
}


function listTransactionSignaturePicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.list_transaction_signature_picture, "POST", "JSON", requestParms);
    });
}

function getRecordTransactionSignaturePicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_record_transaction_signature_picture, "POST", "JSON", requestParms);
    });
}

function deleteRecordTransactionSignaturePicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_record_transaction_signature_picture, "POST", "JSON", requestParms);
    });
}

function updateRecordTransactionSignaturePicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_transaction_signature_picture, "POST", "JSON", requestParms);
    });
}


function getLandingPageList() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "for_me_count",
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                var notificationCountData = {
                    notification_count: response.length
                }
                fetch.replaceHtml(function () {
                    //remove notification count hide
                    $('.digibiz_notification_count').removeClass('hide');
                    removeLoader();
                    resolve();
                }, "page/landPage/land_page", "#digibiz-land-page", "#main-content-wrapper", notificationCountData);
            })
            .catch((err) => {
                //console.log("error in notification list");
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/landPage/land_page", "#digibiz-land-page", "#main-content-wrapper", null);
            })
    })
}

function getDigibizNotificationsPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "for_me",
            count: 20,
            offset: 0
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                fetch.replaceHtml(function () {
                    processDigibizNotificationsList(response, function () {
                        appScroll.scrollBar('#digibiz-notifications-list-wrapper');
                        listenForDigibizNotificationsListScrollEvent($("#digibiz-notifications-list-wrapper"));

                        removeLoader();
                        resolve();
                    });
                }, "page/business/digibiz_notifications_wrapper", "#digibiz-notifications-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/digibiz_notifications_data", "#digibiz-notifications-data-list-template", "#digibiz-notifications-list-wrapper", null);
                }, "page/business/digibiz_notifications_wrapper", "#digibiz-notifications-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processDigibizNotificationsList(data, callback) {
    digibiz.digibiz_notifications = removeDuplicates(digibiz.digibiz_notifications.concat(data), "id");//changed from contact.user_id
    var notificationList = {
        digibiz_notification_list_data: digibiz.digibiz_notifications.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/digibiz_notifications_data", "#digibiz-notifications-data-list-template", "#digibiz-notifications-list-wrapper", notificationList);
}

function listenForDigibizNotificationsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "for_me",
                count: 20,
                offset: digibiz.digibiz_notifications.length
            }

            notificationList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessDigibizNotificationsList(response, function () {
                        listenForDigibizNotificationsListScrollEvent($('#digibiz-notifications-list-wrapper'));

                    });
                }).catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/business/scroll_digibiz_notifications_data", "#scroll-digibiz-notifications-data-list-template", ".digibiz-notifications-list-contentbox", null);

                });

        }
    });
}

function scrollProcessDigibizNotificationsList(data, callback) {
    digibiz.digibiz_notifications = removeDuplicates(digibiz.digibiz_notifications.concat(data), "id");//changed from contact.user_id
    var notificationList = {
        digibiz_notification_list_data: data.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/scroll_digibiz_notifications_data", "#scroll-digibiz-notifications-data-list-template", ".digibiz-notifications-list-contentbox", notificationList);
}

function getEmployeeNotificationDetailsPage() {
    //console.log("entered");
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "contact_logs",
            business_id: sessionStorage.getItem('business_id'),
            contact_uuid: sessionStorage.getItem('contact_uuid')
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                fetch.replaceHtml(function () {
                    processEmployeeNotificationDetails(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/business/employee_notification_details_list_wrapper", "#employee-notification-details-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/employee_notification_details_list_data", "#employee-notification-details-data-list-template", "#employee-notification-details-list-wrapper", null);
                }, "page/business/employee_notification_details_list_wrapper", "#employee-notification-details-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processEmployeeNotificationDetails(data, callback) {
    digibiz.employee_notification_details_list = removeDuplicates(digibiz.employee_notification_details_list.concat(data.log_data), "id");
    var notificationList = {
        employee_notification_details: digibiz.employee_notification_details_list.map(e => {
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (data.last_notification.status.status == "active") {
                if (data.last_notification.contact.status.status == "rejected" || data.last_notification.contact.status.status == "expired") {
                    $('.fixed-action-btn').removeClass('hide');
                }
            }
            callback();
        }
    }, "page/business/employee_notification_details_list_data", "#employee-notification-details-data-list-template", "#employee-notification-details-list-wrapper", notificationList);
}



function getSuperAdminNotificationDetailsPage() {
    //console.log("entered");
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "super_admin_contact_logs",
            business_id: sessionStorage.getItem('business_id'),
            contact_uuid: sessionStorage.getItem('contact_uuid')
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                fetch.replaceHtml(function () {
                    processSuperAdminNotificationDetails(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/business/super_admin_notification_details_list_wrapper", "#super-admin-notification-details-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/super_admin_notification_details_list_data", "#super-admin-notification-details-data-list-template", "#super-admin-notification-details-list-wrapper", null);
                }, "page/business/super_admin_notification_details_list_wrapper", "#super-admin-notification-details-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processSuperAdminNotificationDetails(data, callback) {
    digibiz.super_admin_notification_details_list = removeDuplicates(digibiz.super_admin_notification_details_list.concat(data.log_data), "id");
    var notificationList = {
        super_admin_notification_details: digibiz.super_admin_notification_details_list.map(e => {
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (data.last_notification.status.status == "active") {
                if (data.last_notification.contact.status.status == "rejected" || data.last_notification.contact.status.status == "expired") {
                    $('.fixed-action-btn').removeClass('hide');
                }
            }
            callback();
        }
    }, "page/business/super_admin_notification_details_list_data", "#super-admin-notification-details-data-list-template", "#super-admin-notification-details-list-wrapper", notificationList);
}



function businessOwnerBusinessListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        //TODO (or business in which i am digibiz-admin)(should be done after role assignment)
        digibiz.business_owner_business_list = [];
        var reqParam = {
            device_id: crossplat.device.uuid,
            // list_by: "my_created"
            list_by: "my_business"
        }
        businessList(reqParam)
            .then((response) => {
                //console.log("businessList response", response);
                fetch.replaceHtml(function () {
                    processBusinessOwnerBusinessList(response, function () {
                        addLoader();
                        removeLoader();
                        resolve();
                    });
                }, "page/business/business_list_wrapper", "#business-owner-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/business_list_data", "#business-owner-business-data-list-template", "#business-owner-business-list-wrapper", null);
                }, "page/business/business_list_wrapper", "#business-owner-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
            })
    });
}

function businessAdminBusinessListPage() {
    //console.log("businessAdminBusinessListPage", digibiz.checkAccountFlag);
    return new Promise((resolve, reject) => {
        if (digibiz.checkAccountFlag == false) {
            digibiz.business_owner_business_list = [];
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "my_business",
                count: 20,
                offset: 0
            }
            businessList(reqParam)
                .then((response) => {
                    //console.log("businessList APi response", response);
                    fetch.replaceHtml(function () {
                        processBusinessOwnerBusinessList(response, function () {
                            appScroll.scrollBar('.business-owner-business-list-main-container');
                            listenForBusinessOwnerBusinessListScrollEvent($(".business-owner-business-list-main-container"));
                            removeLoader();
                            resolve();
                        });
                    }, "page/business/business_list_wrapper", "#business-owner-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/business/business_list_data", "#business-owner-business-data-list-template", "#business-owner-business-list-wrapper", null);
                    }, "page/business/business_list_wrapper", "#business-owner-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
        } else {
            fetch.replaceHtml(function () {
                processBusinessOwnerBusinessList(digibiz.business_owner_business_list, function () {
                    appScroll.scrollBar('.business-owner-business-list-main-container');
                    listenForBusinessOwnerBusinessListScrollEvent($(".business-owner-business-list-main-container"));

                    removeLoader();
                    resolve();
                });
            }, "page/business/business_list_wrapper", "#business-owner-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);

        }
    });
}

function businessAdminBusinessListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "my_business",
        count: 20,
        offset: 0
    }
    businessList(reqParam)
        .then((response) => {
            digibiz.business_owner_business_list = response;
            if (digibiz.business_owner_business_list.length > 0) {
                $('#business-role-btn').removeClass('hide');
            }
        })
        .catch((err) => {
            //console.log("err in businessAdminBusinessListHelperMethod", err);
        })
}

function processBusinessOwnerBusinessList(data, callback) {
    digibiz.business_owner_business_list = removeDuplicates(digibiz.business_owner_business_list.concat(data), "id");
    var businessList = {
        business_owner_business_list_data: digibiz.business_owner_business_list.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    e['imageLetter'] = e.name.charAt(0);
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/business_list_data", "#business-owner-business-data-list-template", "#business-owner-business-list-wrapper", businessList);
}

function listenForBusinessOwnerBusinessListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "my_business",
                count: 20,
                offset: digibiz.business_owner_business_list.length
            }
            businessList(reqParam)
                .then((response) => {
                    //console.log("businessList APi response", response);                       
                    scrollProcessBusinessOwnerBusinessList(response, function () {
                        listenForBusinessOwnerBusinessListScrollEvent($(".business-owner-business-list-main-container"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                })

        }

    });
}


function scrollProcessBusinessOwnerBusinessList(data, callback) {
    digibiz.business_owner_business_list = removeDuplicates(digibiz.business_owner_business_list.concat(data), "id");
    var businessList = {
        business_owner_business_list_data: digibiz.business_owner_business_list.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    e['imageLetter'] = e.name.charAt(0);
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/business_list_data", "#business-owner-business-data-list-template", "#business-owner-business-list-wrapper", businessList);
}

function businessAddPage() {
    return new Promise((resolve, reject) => {
        // addLoader();
        if (sessionStorage.getItem('business_id') && sessionStorage.getItem('business_id') != undefined && sessionStorage.getItem('business_id') != null) { //business_id is present            
            var businessTypesReqParams = {
                device_id: crossplat.device.uuid,
            }
            businessTypeList(businessTypesReqParams)
                .then((result) => {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('business_id')
                    }
                    businessGet(reqParam)
                        .then((response) => {
                            if (response.status.status == "pending" || response.status.status == "draft") {
                                console.log("pending")
                                if (response.socket_enable_status == "true") {
                                    console.log("true");
                                    reqParams = {
                                        device_id: crossplat.device.uuid,
                                        id: sessionStorage.getItem('business_id'),
                                        data: {
                                            socket_enable_status: "false",
                                        }
                                    }
                                    //console.log("reqParam", reqParam);
                                    businessUpdate(reqParams)
                                        .then((businessUpdateResponse) => {
                                            //console.log("businessUpdate", response);
                                            removeLoader();
                                            if (response.hasOwnProperty('display_picture') && response.display_picture) {
                                                if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                                    var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                                    response.display_picture['avtarUrl'] = avtarUrl;
                                                }
                                            }
                                            if (response.hasOwnProperty('display_video') && response.display_video) {
                                                if (response.display_video.hasOwnProperty('thumbnail') && response.display_video.thumbnail) {
                                                    var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.thumbnail}`;
                                                    response.display_video['avtarUrl'] = avtarUrl;
                                                }
                                            }
                                            if (response.hasOwnProperty('declaration_transaction_pictures') && response.declaration_transaction_pictures) {
                                                if (response.declaration_transaction_pictures.hasOwnProperty('thumbnail') && response.declaration_transaction_pictures.thumbnail) {
                                                    var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_transaction_pictures.thumbnail}`;
                                                    // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=transaction`;
                                                    response.declaration_transaction_pictures['avtarUrl'] = avtarUrl;
                                                } else if (response.declaration_transaction_pictures.hasOwnProperty('image_id') && response.declaration_transaction_pictures.image_id) {
                                                    response.declaration_transaction_pictures['avtarUrl'] = response.declaration_transaction_pictures.image_url;
                                                }
                                            }
                                            if (response.hasOwnProperty('declaration_signature_pictures') && response.declaration_signature_pictures) {
                                                if (response.declaration_signature_pictures.hasOwnProperty('thumbnail') && response.declaration_signature_pictures.thumbnail) {
                                                    var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_signature_pictures.thumbnail}`;
                                                    // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=signature`;
                                                    response.declaration_signature_pictures['avtarUrl'] = avtarUrl;
                                                } else if (response.declaration_signature_pictures.hasOwnProperty('image_id') && response.declaration_signature_pictures.image_id) {
                                                    response.declaration_signature_pictures['avtarUrl'] = response.declaration_signature_pictures.image_url;
                                                }
                                            }
                                            if (response.hasOwnProperty('declaration_video') && response.declaration_video) {
                                                if (response.declaration_video.hasOwnProperty('thumbnail') && response.declaration_video.thumbnail) {
                                                    var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_video.thumbnail}`;
                                                    response.declaration_video['avtarUrl'] = avtarUrl;
                                                }
                                            }
                                            //put storage data in an array
                                            if (response.hasOwnProperty('storage') && response.storage) {
                                                //console.log("storage is present");
                                                if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                                                    digibiz.storages.push({
                                                        "name": "GoogleDrive",
                                                        "account": response.storage.GoogleDrive.account
                                                    })
                                                }
                                                if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                                                    digibiz.storages.push({
                                                        "name": "OneDrive",
                                                        "account": response.storage.OneDrive.account
                                                    })
                                                }
                                                if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                                                    digibiz.storages.push({
                                                        "name": "DropBox",
                                                        "account": response.storage.DropBox.account
                                                    })
                                                }
                                                if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                                                    digibiz.storages.push({
                                                        "name": "DJ",
                                                        "account": response.storage.DJ
                                                    })
                                                }
                                            }
                                            var getBusiness = {
                                                businessTypes: result,
                                                getBusiness: response,
                                                getBusinessTypeId: response.business_type_id,
                                                storage_list: digibiz.storages,
                                                active_storage: response.active_storage
                                            }
                                            if (digibiz.storages.length < 4) {
                                                getBusiness.addStorage = true;
                                            }
                                            //console.log("getBusiness", getBusiness);
                                            fetch.replaceHtml(function () {
                                                //dropdown show(common)
                                                var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                                                $('#business-type-choose-select-dropdown').val(getDropdownValue);
                                                mobileFlaginit();
                                                calenderInit('#business_date_of_commencement');
                                                calenderInit('#business_date_of_incorporation');
                                                $('.new-business-delete-btn').removeClass('hide');
                                                removeLoader();
                                                resolve();
                                            }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", getBusiness);
                                        })
                                        .catch((err) => {
                                            //console.log("error in update business api", err);
                                            if (err.msg == "no updated data found") {
                                                removeLoader();
                                                if (response.hasOwnProperty('display_picture') && response.display_picture) {
                                                    if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                                        response.display_picture['avtarUrl'] = avtarUrl;
                                                    }
                                                }
                                                if (response.hasOwnProperty('display_video') && response.display_video) {
                                                    if (response.display_video.hasOwnProperty('thumbnail') && response.display_video.thumbnail) {
                                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.thumbnail}`;
                                                        response.display_video['avtarUrl'] = avtarUrl;
                                                    }
                                                }
                                                if (response.hasOwnProperty('declaration_transaction_pictures') && response.declaration_transaction_pictures) {
                                                    if (response.declaration_transaction_pictures.hasOwnProperty('thumbnail') && response.declaration_transaction_pictures.thumbnail) {
                                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_transaction_pictures.thumbnail}`;
                                                        // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=transaction`;
                                                        response.declaration_transaction_pictures['avtarUrl'] = avtarUrl;
                                                    } else if (response.declaration_transaction_pictures.hasOwnProperty('image_id') && response.declaration_transaction_pictures.image_id) {
                                                        response.declaration_transaction_pictures['avtarUrl'] = response.declaration_transaction_pictures.image_url;
                                                    }
                                                }
                                                if (response.hasOwnProperty('declaration_signature_pictures') && response.declaration_signature_pictures) {
                                                    if (response.declaration_signature_pictures.hasOwnProperty('thumbnail') && response.declaration_signature_pictures.thumbnail) {
                                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_signature_pictures.thumbnail}`;
                                                        // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=signature`;
                                                        response.declaration_signature_pictures['avtarUrl'] = avtarUrl;
                                                    } else if (response.declaration_signature_pictures.hasOwnProperty('image_id') && response.declaration_signature_pictures.image_id) {
                                                        response.declaration_signature_pictures['avtarUrl'] = response.declaration_signature_pictures.image_url;
                                                    }
                                                }
                                                if (response.hasOwnProperty('declaration_video') && response.declaration_video) {
                                                    if (response.declaration_video.hasOwnProperty('thumbnail') && response.declaration_video.thumbnail) {
                                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_video.thumbnail}`;
                                                        response.declaration_video['avtarUrl'] = avtarUrl;
                                                    }
                                                }
                                                //put storage data in an array
                                                if (response.hasOwnProperty('storage') && response.storage) {
                                                    //console.log("storage is present");
                                                    if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                                                        digibiz.storages.push({
                                                            "name": "GoogleDrive",
                                                            "account": response.storage.GoogleDrive.account
                                                        })
                                                    }
                                                    if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                                                        digibiz.storages.push({
                                                            "name": "OneDrive",
                                                            "account": response.storage.OneDrive.account
                                                        })
                                                    }
                                                    if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                                                        digibiz.storages.push({
                                                            "name": "DropBox",
                                                            "account": response.storage.DropBox.account
                                                        })
                                                    }
                                                    if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                                                        digibiz.storages.push({
                                                            "name": "DJ",
                                                            "account": response.storage.DJ
                                                        })
                                                    }
                                                }
                                                var getBusiness = {
                                                    businessTypes: result,
                                                    getBusiness: response,
                                                    getBusinessTypeId: response.business_type_id,
                                                    storage_list: digibiz.storages,
                                                    active_storage: response.active_storage
                                                }
                                                if (digibiz.storages.length < 4) {
                                                    getBusiness.addStorage = true;
                                                }
                                                //console.log("getBusiness", getBusiness);
                                                fetch.replaceHtml(function () {
                                                    //dropdown show(common)
                                                    var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                                                    $('#business-type-choose-select-dropdown').val(getDropdownValue);
                                                    mobileFlaginit();
                                                    calenderInit('#business_date_of_commencement');
                                                    calenderInit('#business_date_of_incorporation');
                                                    $('.new-business-delete-btn').removeClass('hide');
                                                    removeLoader();
                                                    resolve();
                                                }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", getBusiness);
                                            }
                                        })
                                } else {//getSocketStatus is false
                                    console.log("false else part")
                                    Materialize.toast(`Access Denied! You or other administrator is creating this business at other place.`, 3000, "round error-alert");
                                    var alert_parms = {
                                        alert_id: "alert-business-device-change-confirm-cancel",
                                        alert_platform: crossplat.device.platform,
                                        alert_title: `Business Alert`,
                                        alert_body: `Access Denied! You or other administrator is creating this business at other place. Would to like to cancel there and continue here?`,
                                        alert_btn: [{
                                            name: "Yes",
                                            attr: [{ name: "id", value: "btn-business-device-change-confirm-yes" }]
                                        },
                                        {
                                            name: "No",
                                            attr: [{ name: "id", value: "btn-business-device-change-cancel-no" }]
                                        }]
                                    }
                                    showAlert(alert_parms, function () {
                                        removeLoader();
                                        resolve();
                                        $('#alert-business-device-change-confirm-cancel').attr('data-business-id', sessionStorage.getItem('business_id')); //set getBusinessId
                                    });
                                }
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                            resolve();
                            Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
                        })
                })
                .catch((err) => {
                    removeLoader();
                    resolve();
                    Materialize.toast("Error in getting business types", 3000, 'rounded error-alert');
                })
        } else {
            var businessTypesReqParams = {
                device_id: crossplat.device.uuid
            }
            businessTypeList(businessTypesReqParams)
                .then((response) => {
                    //console.log("businessTypeList response", response);
                    var getBusinessType = {
                        // getBusinessType: sessionStorage.getItem('business_type'),
                        // getBusinessTypeId: sessionStorage.getItem('business_type_id'),
                        businessTypes: response,
                        addStorage: true
                    }
                    fetch.replaceHtml(function () {
                        calenderInit('#business_date_of_commencement');
                        calenderInit('#business_date_of_incorporation');
                        mobileFlaginit();
                        removeLoader();
                        resolve();
                    }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", getBusinessType);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        Materialize.toast("Error in listing the business type", 3000, 'round success-alert');
                        calenderInit('#business_date_of_commencement');
                        calenderInit('#business_date_of_incorporation');
                        mobileFlaginit();
                        removeLoader();
                        resolve();
                    }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", null);
                })
        }
    })
}

//used
function businessAddEditReload() {
    // addLoader();
    if (sessionStorage.getItem('business_id') && sessionStorage.getItem('business_id') != undefined && sessionStorage.getItem('business_id') != null) { //business_id is present            
        var businessTypesReqParams = {
            device_id: crossplat.device.uuid,
        }
        businessTypeList(businessTypesReqParams)
            .then((result) => {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        if (response.hasOwnProperty('display_picture') && response.display_picture) {
                            if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                response.display_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (response.hasOwnProperty('display_video') && response.display_video) {
                            if (response.display_video.hasOwnProperty('thumbnail') && response.display_video.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.thumbnail}`;
                                response.display_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (response.hasOwnProperty('declaration_transaction_pictures') && response.declaration_transaction_pictures) {
                            if (response.declaration_transaction_pictures.hasOwnProperty('thumbnail') && response.declaration_transaction_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_transaction_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=transaction`;
                                response.declaration_transaction_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_transaction_pictures.hasOwnProperty('image_id') && response.declaration_transaction_pictures.image_id) {
                                response.declaration_transaction_pictures['avtarUrl'] = response.declaration_transaction_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_signature_pictures') && response.declaration_signature_pictures) {
                            if (response.declaration_signature_pictures.hasOwnProperty('thumbnail') && response.declaration_signature_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_signature_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=signature`;
                                response.declaration_signature_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_signature_pictures.hasOwnProperty('image_id') && response.declaration_signature_pictures.image_id) {
                                response.declaration_signature_pictures['avtarUrl'] = response.declaration_signature_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_video') && response.declaration_video) {
                            if (response.declaration_video.hasOwnProperty('thumbnail') && response.declaration_video.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_video.thumbnail}`;
                                response.declaration_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        //put storage data in an array
                        if (response.hasOwnProperty('storage') && response.storage) {
                            //console.log("storage is present");
                            if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                                digibiz.storages.push({
                                    "name": "GoogleDrive",
                                    "account": response.storage.GoogleDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                                digibiz.storages.push({
                                    "name": "OneDrive",
                                    "account": response.storage.OneDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                                digibiz.storages.push({
                                    "name": "DropBox",
                                    "account": response.storage.DropBox.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                                digibiz.storages.push({
                                    "name": "DJ",
                                    "account": response.storage.DJ
                                })
                            }
                        }
                        var getBusiness = {
                            businessTypes: result,
                            getBusiness: response,
                            getBusinessTypeId: response.business_type_id,
                            storage_list: digibiz.storages,
                            active_storage: response.active_storage
                        }
                        if (digibiz.storages.length < 4) {
                            getBusiness.addStorage = true;
                        }
                        //console.log("getBusiness", getBusiness);
                        fetch.replaceHtml(function () {
                            //dropdown show(common)
                            var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                            $('#business-type-choose-select-dropdown').val(getDropdownValue);
                            mobileFlaginit();
                            calenderInit('#business_date_of_commencement');
                            calenderInit('#business_date_of_incorporation');
                            $('.new-business-delete-btn').removeClass('hide');
                            removeLoader();
                        }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", getBusiness);


                    })
                    .catch((err) => {
                        removeLoader();
                        Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast("Error in getting business types", 3000, 'rounded error-alert');
            })
    } else {
        var businessTypesReqParams = {
            device_id: crossplat.device.uuid
        }
        businessTypeList(businessTypesReqParams)
            .then((response) => {
                //console.log("businessTypeList response", response);
                var getBusinessType = {
                    // getBusinessType: sessionStorage.getItem('business_type'),
                    // getBusinessTypeId: sessionStorage.getItem('business_type_id'),
                    businessTypes: response,
                    addStorage: true
                }
                fetch.replaceHtml(function () {
                    calenderInit('#business_date_of_commencement');
                    calenderInit('#business_date_of_incorporation');
                    mobileFlaginit();
                    removeLoader();
                }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", getBusinessType);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    Materialize.toast("Error in listing the business type", 3000, 'round success-alert');
                    calenderInit('#business_date_of_commencement');
                    calenderInit('#business_date_of_incorporation');
                    mobileFlaginit();
                    removeLoader();
                }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", null);
            })
    }
}

function businessProfileManagementPage() {
    return new Promise((resolve, reject) => {
        //check role, super-admin, digibiz-admin, module-admin
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            account_id: sessionStorage.getItem('account_id')
        }
        viewBusinessCheckRole(reqParam)
            .then((result) => {
                var getData = {
                    type: result.type
                }
                fetch.replaceHtml(function () {
                    if (sessionStorage.getItem('business_status') == "inactive") {
                        var alert_parms = {
                            alert_id: "alert-business-owner-inactive-ok",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Business is inactive. Activate the business to work on the business.`,
                            alert_btn: [{
                                name: "Ok",
                                attr: [{ name: "id", value: "btn-business-owner-inactivate-ok" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                        });
                    }
                    removeLoader();
                    var slider = new Swiper('.hubSwiper', {
                        slidesPerView: 1,
                        spaceBetween: 0,
                        grabCursor: true,
                        observer: true,
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true,
                        }
                    });
                    $(".swiper").removeClass("hubSwiper");
                    resolve();
                }, "page/business/view_business_profile_hub", "#view-business-profile-land-page", "#main-content-wrapper", getData);
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No access to business.`, 3000, 'round success-alert');
            })
    })
}

function businessManagementPage() {
    return new Promise((resolve, reject) => {
        //check role, super-admin, digibiz-admin, module-admin
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            account_id: sessionStorage.getItem('account_id')
        }
        viewBusinessCheckRole(reqParam)
            .then((result) => {
                sessionStorage.setItem('business_role', result.type)
                // var requestParams = {
                //     device_id: crossplat.device.uuid,
                //     business_id: sessionStorage.getItem('business_id'),
                //     list_by: "my_business_notification_count"
                // }
                // businessNotificationList(requestParams)
                //     .then((notifiResult) => {
                //console.log("businessNotificationList response", notifiResult);
                var getData = {
                    // business_notification_count: notifiResult.length,
                    type: result.type,
                }
                if (result.type == "module_admin") {
                    var employeeModule;
                    var customerModule;
                    var communicationModule;
                    var collaboratorModule;
                    //employee module check
                    var getEmployeeModuleResult = result.modules_data.indexOf('employee_management');
                    if (getEmployeeModuleResult >= 0) {
                        employeeModule = "true";
                    } else {
                        employeeModule = "false";
                    }
                    //customer module check
                    var getCustomerModuleResult = result.modules_data.indexOf('customer_management');
                    if (getCustomerModuleResult >= 0) {
                        customerModule = "true";
                    } else {
                        customerModule = "false";
                    }
                    //communication module check
                    var getCommunicationModuleResult = result.modules_data.indexOf('communication_management');
                    if (getCommunicationModuleResult >= 0) {
                        communicationModule = "true";
                    } else {
                        communicationModule = "false";
                    }
                    //collaborator module check
                    var getCollaboratorModuleResult = result.modules_data.indexOf('collaborator_management');
                    if (getCollaboratorModuleResult >= 0) {
                        collaboratorModule = "true";
                    } else {
                        collaboratorModule = "false";
                    }
                    getData.employee_module = employeeModule;
                    getData.customer_module = customerModule;
                    getData.communication_module = communicationModule;
                    getData.collaborator_module = collaboratorModule;
                }
                //console.log("getData", getData);
                fetch.replaceHtml(function () {
                    //remove notification count hide
                    // $('.business_notification_count').removeClass('hide');
                    if (sessionStorage.getItem('business_status') == "inactive") {
                        $('.view-business-app-btn-icon-wrapper').addClass('hide');
                        // $('.view-business-app-btn.digibiz-active-inactive-settings').removeClass('hide');
                        // sessionStorage.removeItem('business_status');
                        var alert_parms = {
                            alert_id: "alert-business-owner-inactive-ok",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Business is inactive. Activate the business to work on the business.`,
                            alert_btn: [{
                                name: "Ok",
                                attr: [{ name: "id", value: "btn-business-owner-inactivate-ok" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                        });
                    }
                    removeLoader();
                    resolve();
                    var slider = new Swiper('.hubSwiper', {
                        slidesPerView: 1,
                        spaceBetween: 0,
                        grabCursor: true,
                        observer: true,
                        pagination: {
                            el: '.swiper-pagination',
                            clickable: true,
                        },
                        on: {
                            beforeInit: function () {
                                $(".swiper-slide .part-buttons:not(:has(.view-business-app-btn-icon-wrapper))").parents('.swiper-slide').remove();
                            },
                            observerUpdate: function () {
                                $(".swiper-slide .part-buttons:not(:has(.view-business-app-btn-icon-wrapper))").parents('.swiper-slide').remove();
                            }
                        }
                    });
                    $(".swiper").removeClass("hubSwiper");
                }, "page/business/view_business_hub", "#view-business-land-page", "#main-content-wrapper", getData);
                // })
                // .catch((err) => {
                //     var getData = {
                //         type: result.type
                //     }
                //     if (result.type == "module_admin") {
                //         var employeeModule;
                //         var customerModule;
                //         var communicationModule;
                //         var collaboratorModule;
                //         //employee module check
                //         var getEmployeeModuleResult = result.modules_data.indexOf('employee_management');
                //         if (getEmployeeModuleResult >= 0) {
                //             employeeModule = "true";
                //         } else {
                //             employeeModule = "false";
                //         }
                //         //customer module check
                //         var getCustomerModuleResult = result.modules_data.indexOf('customer_management');
                //         if (getCustomerModuleResult >= 0) {
                //             customerModule = "true";
                //         } else {
                //             customerModule = "false";
                //         }
                //         //communication module check
                //         var getCommunicationModuleResult = result.modules_data.indexOf('communication_management');
                //         if (getCommunicationModuleResult >= 0) {
                //             communicationModule = "true";
                //         } else {
                //             communicationModule = "false";
                //         }
                //         //collaborator module check
                //         var getCollaboratorModuleResult = result.modules_data.indexOf('collaborator_management');
                //         if (getCollaboratorModuleResult >= 0) {
                //             collaboratorModule = "true";
                //         } else {
                //             collaboratorModule = "false";
                //         }
                //         getData.employee_module = employeeModule;
                //         getData.customer_module = customerModule;
                //         getData.communication_module = communicationModule;
                //         getData.collaborator_module = collaboratorModule;
                //     }
                //     //console.log("getData", getData);
                //     fetch.replaceHtml(function () {
                //         if (sessionStorage.getItem('business_status') == "inactive") {
                //             $('.view-business-app-btn-icon-wrapper').addClass('hide');
                //             // $('.view-business-app-btn').addClass('hide');
                //             // $('.view-business-app-btn.digibiz-active-inactive-settings').removeClass('hide');
                //             // sessionStorage.removeItem('business_status');
                //             var alert_parms = {
                //                 alert_id: "alert-business-owner-inactive-ok",
                //                 alert_platform: crossplat.device.platform,
                //                 alert_title: `Alert`,
                //                 alert_body: `Business is inactive. Activate the business to work on the business.`,
                //                 alert_btn: [{
                //                     name: "Ok",
                //                     attr: [{ name: "id", value: "btn-business-owner-inactivate-ok" }]
                //                 }]
                //             }
                //             showAlert(alert_parms, function () {
                //             });
                //         }
                //         removeLoader();
                //         resolve();
                //     }, "page/business/view_business_hub", "#view-business-land-page", "#main-content-wrapper", getData);
                // })            
            })
            .catch((err) => {
                removeLoader();
                Materialize.toast(`No access to business.`, 3000, 'round success-alert');
            })
    })
}

function employeeConfigurationsPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            $('.view-digibiz-back-button').removeClass('hide');
            removeLoader();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/business/employee_configurations_hub", "#employee-configurations-land-page", "#main-content-wrapper", null);
    })
}

function employeeManagementHubPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            $('.view-digibiz-back-button').removeClass('hide');
            removeLoader();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/business/employee_management_hub", "#employee-management-land-page", "#main-content-wrapper", null);
    })
}

function employeeControlsPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            $('.view-digibiz-back-button').removeClass('hide');
            removeLoader();

            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/business/employee_controls_hub", "#employee-controls-land-page", "#main-content-wrapper", null);
    })
}


/*******************************EMPLOYEE CREATION MANAGEMENT(starts)****************************/
function activeEmployeeListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        if (digibiz.active_employee_creation_employee_list && digibiz.active_employee_creation_employee_list.length > 0) {
            fetch.replaceHtml(function () {
                processActiveEmployeeCreationEmployeeList(digibiz.active_employee_creation_employee_list, function () {
                    appScroll.scrollBar('.employee-creation-list-contentbox');
                    listenForActiveEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                    removeLoader();
                    resolve();
                });
            }, "page/common/active_employee_creation_list_wrapper", "#active-employee-creation-list-wrapper-template", "#active-employee-list-data-container", null);
        } else {
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_all_active",
                count: 20,
                offset: 0
            }
            employeeCount(reqParam).then((employeesCount) => {
                $('.active-employee-count').text(employeesCount);
                employeeList(reqParam)
                    .then((response) => {
                        //console.log("employeeList response", response);
                        fetch.replaceHtml(function () {
                            processActiveEmployeeCreationEmployeeList(response, function () {

                                appScroll.scrollBar('.employee-creation-list-contentbox');
                                listenForActiveEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                                removeLoader();
                                resolve();
                            });
                        }, "page/common/active_employee_creation_list_wrapper", "#active-employee-creation-list-wrapper-template", "#active-employee-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/common/active_employee_creation_list_data", "#active-employee-creation-data-list-template", "#active-employee-creation-list-wrapper", null);
                        }, "page/common/active_employee_creation_list_wrapper", "#active-employee-creation-list-wrapper-template", "#active-employee-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }
    });
}

async function processActiveEmployeeCreationEmployeeList(data, callback) {
    digibiz.active_employee_creation_employee_list = removeDuplicates(digibiz.active_employee_creation_employee_list.concat(data), "dj_unique_employee_id");
    var employeeList = {
        employee_creation_employee_list_data: digibiz.active_employee_creation_employee_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     if (err == "File not found-deleted or moved from cloud storage") {
                    //         e['imageLetter'] = e.name.first.charAt(0);
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                    //         e['imageLetter'] = e.name.first.charAt(0);
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    //     } else if (err == "Cloud storage not authenticated") {
                    //         e['imageLetter'] = e.name.first.charAt(0);
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    //     }
                    // })

                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    console.log("employeeList", employeeList);
    // setTimeout(function () {


    fetch.replaceHtml(function (err) {
        if (!err) {
            //close search box
            // appScroll.scrollBar('.employee-creation-list-contentbox');
            $(document).find('.expand-search-wrap').removeClass('active').children('.expand-search-input').val('').removeClass('searchexpand');
            removeLoader();
            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';
            callback();
        }
    }, "page/common/active_employee_creation_list_data", "#active-employee-creation-data-list-template", "#active-employee-creation-list-wrapper", employeeList);
    // }, 1000)
}

function aluminiEmployeeListPage() {
    if (digibiz.alumini_employee_list && digibiz.alumini_employee_list.length > 0) {
        fetch.replaceHtml(function () {
            processAluminiEmployeeList(digibiz.alumini_employee_list, function () {
                appScroll.scrollBar('.employee-creation-list-contentbox');
                listenForAluminiEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                removeLoader();
            });
        }, "page/common/alumini_employee_creation_list_wrapper", "#alumini-employee-creation-list-wrapper-template", "#alumini-employee-list-data-container", null);
    } else {
        addLoader();
        return new Promise((resolve, reject) => {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "alumini",
                count: 15,
                offset: 0
            }
            employeeCount(reqParam).then((employeesCount) => {
                $('.alumini-employee-count').text(employeesCount);
                employeeList(reqParam)
                    .then((response) => {
                        //console.log("employeeList response", response);
                        fetch.replaceHtml(function () {
                            processAluminiEmployeeList(response, function () {
                                appScroll.scrollBar('.employee-creation-list-contentbox');
                                listenForAluminiEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                                removeLoader();
                                resolve();
                            });
                        }, "page/common/alumini_employee_creation_list_wrapper", "#alumini-employee-creation-list-wrapper-template", "#alumini-employee-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    appScroll.scrollBar('.employee-creation-list-contentbox');
                                    resolve();
                                }
                            }, "page/common/alumini_employee_creation_list_data", "#alumini-employee-creation-data-list-template", "#alumini-employee-creation-list-wrapper", null);
                        }, "page/common/alumini_employee_creation_list_wrapper", "#alumini-employee-creation-list-wrapper-template", "#alumini-employee-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        });
    }
}

function processAluminiEmployeeList(data, callback) {
    digibiz.alumini_employee_list = removeDuplicates(digibiz.alumini_employee_list.concat(data), "dj_unique_employee_id");
    var employeeList = {
        employee_creation_employee_list_data: digibiz.alumini_employee_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("employeeList", employeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/alumini_employee_creation_list_data", "#alumini-employee-creation-data-list-template", "#alumini-employee-creation-list-wrapper", employeeList);
}

function pendingEmployeeListPage() {
    // 
    if (digibiz.pending_employee_creation_employee_list && digibiz.pending_employee_creation_employee_list.length > 0) {
        fetch.replaceHtml(function () {
            processPendingEmployeeCreationEmployeeList(digibiz.pending_employee_creation_employee_list, function () {
                appScroll.scrollBar('.employee-creation-list-contentbox');
                listenForPendingeEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                removeLoader();
            });
        }, "page/common/pending_employee_creation_list_wrapper", "#pending-employee-creation-list-wrapper-template", "#pending-employee-list-data-container", null);
    } else {
        addLoader();
        return new Promise((resolve, reject) => {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "pending_employees",
                count: 15,
                offset: 0
            }
            pendingNotificationCount(reqParam).then((employeesCount) => {
                $('.pending-employee-count').text(employeesCount);
                notificationList(reqParam)
                    .then((response) => {
                        //console.log("notificationList response", response);
                        fetch.replaceHtml(function () {
                            processPendingEmployeeCreationEmployeeList(response, function () {
                                appScroll.scrollBar('.employee-creation-list-contentbox');
                                listenForPendingeEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                                removeLoader();
                                resolve();
                            });
                        }, "page/common/pending_employee_creation_list_wrapper", "#pending-employee-creation-list-wrapper-template", "#pending-employee-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    appScroll.scrollBar('.employee-creation-list-contentbox');
                                    resolve();
                                }
                            }, "page/common/pending_employee_creation_list_data", "#pending-employee-creation-data-list-template", "#pending-employee-creation-list-wrapper", null);
                        }, "page/common/pending_employee_creation_list_wrapper", "#pending-employee-creation-list-wrapper-template", "#pending-employee-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })

        });
    }
}

function processPendingEmployeeCreationEmployeeList(data, callback) {
    // //console.log("data", data);
    digibiz.pending_employee_creation_employee_list = removeDuplicates(digibiz.pending_employee_creation_employee_list.concat(data), "id");
    // //console.log("check 1", digibiz.pending_employee_creation_employee_list)
    var employeeList = {
        employee_creation_employee_list_data: digibiz.pending_employee_creation_employee_list
        // .map((e, index) => {
        //     e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
        //     e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
        //     e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
        //     return e;
        // })
    };
    //console.log("employeeList", employeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/pending_employee_creation_list_data", "#pending-employee-creation-data-list-template", "#pending-employee-creation-list-wrapper", employeeList);
}

function employeeCreatePage() {
    addLoader();
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('digibiz_role') == "employee" && sessionStorage.getItem('edit_from') == "profile_page") {
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('employee_id'),
                get_by: "id"
            }
            employeeGet(reqParams)
                .then((response) => {
                    console.log('response', response);
                    if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                        if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                            //console.log("gotttttt")
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                            response.identity_picture['avtarUrl'] = avtarUrl;

                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     console.log('err11', err);
                            //     if (err == "File not found-deleted or moved from cloud storage") {
                            //         e['imageLetter'] = response.name.first.charAt(0);
                            //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                            //         e['imageLetter'] = response.name.first.charAt(0);
                            //     } else if (err == "Cloud storage not authenticated") {
                            //         e['imageLetter'] = response.name.first.charAt(0);
                            //     }
                            // })
                        }
                    }
                    if (response.hasOwnProperty('identity_video') && response.identity_video) {
                        if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                            //console.log("gotttttt")
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                            response.identity_video['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     if (err == "File not found-deleted or moved from cloud storage") {
                            //         response['imageLetter'] = response.name.first.charAt(0);
                            //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                            //         response['imageLetter'] = response.name.first.charAt(0);
                            //     } else if (err == "Cloud storage not authenticated") {
                            //         response['imageLetter'] = response.name.first.charAt(0);
                            //     }
                            // })
                        }
                    }
                    var EmployeeData = {
                        EmployeeData: response
                    }
                    fetch.replaceHtml(function () {
                        mobileFlaginit();
                        //change heading content
                        $('.employee-create-heading-name').text('Employee Details');
                        //hide main header
                        $('.header-band').addClass('hide');
                        //hide fields which are not to be shown
                        $('.employee-add-company_employee-id-container').remove();
                        $('.employee-add-type-container').remove();
                        $('.employee-add-category-container').remove();
                        $('.employee-add-designation-container').remove();
                        $('.employee-add-date-of-joining-container').remove();
                        $('.employee-add-display-name-container').remove();
                        $('.employee-add-email-container').remove();
                        $('.employee-back-btn').remove();
                        $('.employee-forward-btn').remove();
                        $('.notify-employee-btn').remove();
                        $('.wizard-progress-container').remove();
                        $(`.employee-creation-parts-container[data-step="1"]`).remove();
                        $(`.employee-creation-parts-container[data-step="3"]`).remove();
                        $(`.employee-creation-parts-container[data-step="4"]`).remove();
                        //show the 2nd page content
                        $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                        //show save button
                        $('.save-employee-btn').removeClass('hide');
                        calenderInit('#employee_date_of_birth');
                        calenderInit('#employee_wedding_anniversary');
                        removeLoader();
                        resolve();
                    }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                })
                .catch((err) => {
                    console.log("err", err);
                    removeLoader();
                    Materialize.toast(err.msg, 3000, 'round error-alert');
                })
        } else {
            var RequestTypeParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id')
            }
            employeeTypeList(RequestTypeParams)
                .then((typeResponse) => {
                    var RequestCategoryParams = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id')
                    }
                    employeeCategoryList(RequestCategoryParams)
                        .then((categoryResponse) => {
                            var RequestDesignationParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id')
                            }
                            employeeDesignationList(RequestDesignationParams)
                                .then((designationResponse) => {
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                                //         getImageUrl(avtarUrl).then((res) => {
                                                                //         }).catch((err) => {
                                                                //             console.log('45678', err);
                                                                //             if (err == "File not found-deleted or moved from cloud storage") {
                                                                //                 delete response.identity_picture['avtarUrl'];
                                                                //                 $('.employee-identity-picture-multimedia-load-btn').remove();
                                                                //                 //remove delete
                                                                //                 $('#employee-identity-picture-delete').remove();
                                                                //                 $('.employee-add-identity-picture-container').find('.mask').removeClass('hide');

                                                                //                 //append photo_camera first and then delete
                                                                //                 $('#employee_identity_picture').siblings('.mask').find('.employee_identity_pic_preview').remove();
                                                                //                 $('#employee_identity_picture').siblings('.mask').find('.employee-identity-picture-multimedia-load-btn').remove();
                                                                //                 $('#employee_identity_picture').remove();
                                                                //                 $('.identity-picture-wrapper').find('.mask').append(`<a class="info employee-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="employee-identity-picture-load-btn">add</i></a>`);
                                                                //             } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                                                                //                 delete response.identity_picture['avtarUrl'];
                                                                //                 $('.employee-identity-picture-multimedia-load-btn').remove();
                                                                //                 // //remove delete
                                                                //                 $('#employee-identity-picture-delete').remove();
                                                                //                 $('.employee-add-identity-picture-container').find('.mask').removeClass('hide');

                                                                //                 // //append photo_camera first and then delete
                                                                //                 // $('#employee_identity_picture').siblings('.mask').find('.employee_identity_pic_preview').remove();
                                                                //                 // $('#employee_identity_picture').siblings('.mask').find('.employee-identity-picture-multimedia-load-btn').remove();
                                                                //                 $('#employee_identity_picture').remove();
                                                                //                 $('.identity-picture-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                                                                //             } else if (err == "Cloud storage not authenticated") {
                                                                //                 delete response.identity_picture['avtarUrl'];
                                                                //                 $('.employee-identity-picture-multimedia-load-btn').remove();
                                                                //                 // //remove delete
                                                                //                 $('#employee-identity-picture-delete').remove();
                                                                //                 $('.employee-add-identity-picture-container').find('.mask').removeClass('hide');

                                                                //                 // //append photo_camera first and then delete
                                                                //                 // $('#employee_identity_picture').siblings('.mask').find('.employee_identity_pic_preview').remove();
                                                                //                 // $('#employee_identity_picture').siblings('.mask').find('.employee-identity-picture-multimedia-load-btn').remove();
                                                                //                 $('#employee_identity_picture').remove();
                                                                //                 $('.identity-picture-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                                                                //             }
                                                                //         })
                                                                //     }
                                                                // }
                                                                // if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                                //     if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //         //console.log("gotttttt")
                                                                //         var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                //         response.identity_video['avtarUrl'] = avtarUrl;
                                                                //         getImageUrl(avtarUrl).then((res) => {
                                                                //         }).catch((err) => {
                                                                //             if (err == "File not found-deleted or moved from cloud storage") {
                                                                //                 // response['imageLetter'] = response.name.first.charAt(0);                                   
                                                                //                 delete response.identity_video['avtarUrl'];
                                                                //                 $('.employee-identity-video-multimedia-load-btn').remove();
                                                                //                 //remove delete
                                                                //                 $('#employee-identity-video-delete').remove();
                                                                //                 $('.employee-add-identity-video-container').find('.mask').removeClass('hide');
                                                                //                 //append photo_camera first and then delete
                                                                //                 $('#employee_identity_video').siblings('.mask').find('.employee_identity_video_preview').remove();
                                                                //                 $('#employee_identity_video').siblings('.mask').find('.employee-identity-video-multimedia-load-btn').remove();
                                                                //                 $('#employee_identity_video').remove();
                                                                //                 $('.identity-video-wrapper').find('.mask').append(`<a class="info employee-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="employee-identity-video-load-btn">add</i></a>`);

                                                                //             } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                                                                //                 // response['imageLetter'] = response.name.first.charAt(0);                                   
                                                                //                 delete response.identity_video['avtarUrl'];
                                                                //                 $('.employee-identity-video-multimedia-load-btn').remove();
                                                                //                 //remove delete
                                                                //                 $('#employee-identity-video-delete').remove();
                                                                //                 $('.employee-add-identity-video-container').find('.mask').removeClass('hide');
                                                                //                 //append photo_camera first and then delete
                                                                //                 // $('#employee_identity_video').siblings('.mask').find('.employee_identity_video_preview').remove();
                                                                //                 // $('#employee_identity_video').siblings('.mask').find('.employee-identity-video-multimedia-load-btn').remove();
                                                                //                 $('#employee_identity_video').remove();
                                                                //                 $('.identity-video-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);

                                                                //             } else if (err == "Cloud storage not authenticated") {
                                                                //                 // response['imageLetter'] = response.name.first.charAt(0);                                   
                                                                //                 delete response.identity_video['avtarUrl'];
                                                                //                 $('.employee-identity-video-multimedia-load-btn').remove();
                                                                //                 //remove delete
                                                                //                 $('#employee-identity-video-delete').remove();
                                                                //                 $('.employee-add-identity-video-container').find('.mask').removeClass('hide');
                                                                //                 //append photo_camera first and then delete
                                                                //                 // $('#employee_identity_video').siblings('.mask').find('.employee_identity_video_preview').remove();
                                                                //                 // $('#employee_identity_video').siblings('.mask').find('.employee-identity-video-multimedia-load-btn').remove();
                                                                //                 $('#employee_identity_video').remove();
                                                                //                 $('.identity-video-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);

                                                                //             }
                                                                //         })
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                console.log('EmployeeData', EmployeeData);
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee" && sessionStorage.getItem('edit_from') == "profile_page") {
                                                                        // $('.mask').addClass('hide');
                                                                        // $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        // $('div[type="text"]').prop('disabled', true);
                                                                        // $('input[type="text"]').prop('disabled', true);
                                                                        // $('input[type="tel"]').prop('disabled', true);
                                                                        // $('select').prop('disabled', true);
                                                                        // $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        // $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        // $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        // $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    appScroll.scrollBar('#main-container');
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            EmployeeTypeList: typeResponse,
                                            EmployeeCategoryList: categoryResponse,
                                            EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                                .catch((err) => {
                                    //console.log("Error in employee designation list", err);
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            EmployeeTypeList: typeResponse,
                                            EmployeeCategoryList: categoryResponse,
                                            // EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                        })
                        .catch((err) => {
                            //console.log("Error in employee category list", err);
                            var RequestDesignationParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id')
                            }
                            employeeDesignationList(RequestDesignationParams)
                                .then((designationResponse) => {
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            EmployeeTypeList: typeResponse,
                                            // EmployeeCategoryList: categoryResponse,
                                            EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                                .catch((err) => {
                                    //console.log("Error in employee designation list", err);
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            EmployeeTypeList: typeResponse,
                                            // EmployeeCategoryList: categoryResponse,
                                            // EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                        })
                })

                .catch((err) => {
                    //console.log("Error in employee type list", err);
                    var RequestCategoryParams = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id')
                    }
                    employeeCategoryList(RequestCategoryParams)
                        .then((categoryResponse) => {
                            var RequestDesignationParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id')
                            }
                            employeeDesignationList(RequestDesignationParams)
                                .then((designationResponse) => {
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            // EmployeeTypeList: typeResponse,
                                            EmployeeCategoryList: categoryResponse,
                                            EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                                .catch((err) => {
                                    //console.log("Error in employee designation list", err);
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            // EmployeeTypeList: typeResponse,
                                            EmployeeCategoryList: categoryResponse,
                                            // EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                        })
                        .catch((err) => {
                            //console.log("Error in employee category list", err);
                            var RequestDesignationParams = {
                                device_id: crossplat.device.uuid,
                                business_id: sessionStorage.getItem('business_id')
                            }
                            employeeDesignationList(RequestDesignationParams)
                                .then((designationResponse) => {
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                            // EmployeeTypeList: typeResponse,
                                            // EmployeeCategoryList: categoryResponse,
                                            EmployeeDesignationList: designationResponse,
                                            // departments: departmentResponse
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                                .catch((err) => {
                                    //console.log("Error in employee designation list", err);
                                    if (sessionStorage.getItem('employee_id')) {
                                        var reqParams = {
                                            device_id: crossplat.device.uuid,
                                            id: sessionStorage.getItem('employee_id'),
                                            get_by: "id"
                                        }
                                        employeeGet(reqParams)
                                            .then((response) => {
                                                var requestParameter = {
                                                    device_id: crossplat.device.uuid,
                                                    business_id: sessionStorage.getItem('business_id'),
                                                    dj_unique_employee_id: sessionStorage.getItem('employee_id'),
                                                    list_by: "employee_active"
                                                }
                                                employeeDepartmentAssignmentList(requestParameter)
                                                    .then((departmentResponse) => {
                                                        //console.log("departmentResponse", departmentResponse);
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        //console.log("type is present")
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    employeeDepartmentAssignment: departmentResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    digibiz.alreadySelectedDepartment = departmentResponse;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                                    .catch((err) => {//no employee department assignment
                                                        if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                                                            if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                                                                response.identity_picture['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        if (response.hasOwnProperty('identity_video') && response.identity_video) {
                                                            if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                                                                //console.log("gotttttt")
                                                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                                                                response.identity_video['avtarUrl'] = avtarUrl;
                                                            }
                                                        }
                                                        var requestParam = {
                                                            device_id: crossplat.device.uuid,
                                                            list_by: "member",
                                                            member_id: sessionStorage.getItem('employee_id')
                                                        }
                                                        roleManagementList(requestParam)
                                                            .then((roleresponse) => {
                                                                //console.log("roleManagementList response", roleresponse);
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                    role_assignment: roleresponse.map(e => {
                                                                        e['imageLetter'] = e.app_name.charAt(0);
                                                                        return e;
                                                                    })
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                            .catch((err) => {
                                                                var EmployeeData = {
                                                                    EmployeeData: response,
                                                                    // EmployeeTypeList: typeResponse,
                                                                    // EmployeeCategoryList: categoryResponse,
                                                                    // EmployeeDesignationList: designationResponse,
                                                                }
                                                                fetch.replaceHtml(function () {
                                                                    mobileFlaginit();
                                                                    // update mobile number
                                                                    // var getNumber = response.mobile_number;
                                                                    // //console.log("getNumber", getNumber);
                                                                    // var Final = getNumber.
                                                                    // $("#add-employee-mobile-number").val(getNumber).replace(/^\s+|\s+$/g, "")
                                                                    //hide delete button for super-admin department, if this employee is a super-admin
                                                                    if (response.employee_role == "super_admin") {
                                                                        $(`.employee-department-assignment-box[data-id="${sessionStorage.getItem('department_id')}"]`).find('#employee_department_assignment_remove').remove();
                                                                    }
                                                                    //update employee type
                                                                    if (response.hasOwnProperty('type') && response.type) {
                                                                        $('#employee-type-choose-select-dropdown').val(response.type);
                                                                    }
                                                                    //update employee category
                                                                    if (response.hasOwnProperty('category') && response.category) {
                                                                        $('#employee-category-choose-select-dropdown').val(response.category);
                                                                    }
                                                                    //update employee designation
                                                                    if (response.hasOwnProperty('designation') && response.designation) {
                                                                        $('#employee-designation-choose-select-dropdown').val(response.designation);
                                                                    }
                                                                    // digibiz.alreadySelectedDepartment = response.department_assignment;
                                                                    //update the next and back button with step 2
                                                                    $('.employee-back-btn').attr('data-present-step', '2');
                                                                    $('.employee-forward-btn').attr('data-present-step', '2');
                                                                    //update the stepper
                                                                    $('.employee-create-stepper').removeClass('is-active');
                                                                    $(`.employee-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                                    //show the next content
                                                                    $(`.employee-creation-parts-container[data-step="1"]`).addClass('hide');
                                                                    $(`.employee-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                                    //hide the notify button and show the next button
                                                                    $('.notify-employee-btn').addClass('hide');
                                                                    $('.employee-forward-btn').removeClass('hide');
                                                                    calenderInit('#employee_date_of_joining');
                                                                    calenderInit('#employee_date_of_birth');
                                                                    calenderInit('#employee_wedding_anniversary');
                                                                    if (sessionStorage.getItem('digibiz_role') == "employee") {
                                                                        $('.mask').addClass('hide');
                                                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                        $('div[type="text"]').prop('disabled', true);
                                                                        $('input[type="text"]').prop('disabled', true);
                                                                        $('input[type="tel"]').prop('disabled', true);
                                                                        $('select').prop('disabled', true);
                                                                        $('#employee_department_assignment_btn').prop('disabled', true);
                                                                        $('#employee_department_assignment_remove').prop('disabled', true);
                                                                        $('#employee_contact_access_assignment_btn').prop('disabled', true);
                                                                        $('#employee_access_show_btn').prop('disabled', true);
                                                                    }
                                                                    removeLoader();
                                                                    resolve();
                                                                }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                                            })
                                                    })
                                            })
                                            .catch((err) => {
                                                //console.log("error in employeeGet")
                                            })
                                    } else {//employee_id is not present
                                        digibiz.alreadySelectedDepartment = [];
                                        var EmployeeData = {
                                        }
                                        fetch.replaceHtml(function () {
                                            mobileFlaginit();

                                            calenderInit('#employee_date_of_joining');
                                            calenderInit('#employee_date_of_birth');
                                            calenderInit('#employee_wedding_anniversary');
                                            removeLoader();
                                            resolve();
                                        }, "page/common/employee_create", "#employee-create-template", "#main-content-wrapper", EmployeeData);
                                    }
                                })
                        })
                })
        }
    });
}

function employeeProfilePage() {
    addLoader();
    return new Promise((resolve, reject) => {
        // var RequestDesignationParams = {
        //     device_id: crossplat.device.uuid,
        //     business_id: sessionStorage.getItem('business_id')
        // }
        // employeeDesignationList(RequestDesignationParams)
        //     .then((designationResponse) => {
        console.log('wefrwf');
        if (sessionStorage.getItem('employee_id')) {
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('employee_id'),
                get_by: "id"
            }
            employeeGet(reqParams)
                .then((response) => {
                    if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                        if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                            //console.log("gotttttt")
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                            response.identity_picture['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     response['imageLetter'] = response.name.first.charAt(0);
                            //     // $(`.active-customer-wrapper[data-customer-id="${response.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                            // })
                        }
                    }
                    if (response.hasOwnProperty('identity_video') && response.identity_video) {
                        if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                            //console.log("gotttttt")
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.video_id}`;
                            response.identity_video['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     response['imageLetter'] = response.name.first.charAt(0);
                            //     // $(`.active-customer-wrapper[data-customer-id="${response.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                            // })
                        }
                    }
                    if (response.hasOwnProperty('date_of_birth') && response.date_of_birth) {
                        var dateString = response.date_of_birth;
                        var dateMomentObject = moment(dateString, "DD/MM/YYYY"); // 1st argument - string, 2nd argument - format
                        console.log("dateMomentObject", dateMomentObject);
                        var dateObject = dateMomentObject.toDate(); // convert moment.js object to Date object
                        console.log("dateObject", dateObject);
                        var UTCDate = new Date(dateObject).toUTCString();
                        console.log("UTCDate", UTCDate);
                        var finalDate = UTCDate.split(' ').slice(1, 3).join(' ');
                        response['date_of_birth'] = finalDate;
                    }
                    if (response.hasOwnProperty('wedding_anniversary') && response.wedding_anniversary) {
                        var dateString = response.wedding_anniversary;
                        var dateMomentObject = moment(dateString, "DD/MM/YYYY"); // 1st argument - string, 2nd argument - format
                        console.log("dateMomentObject", dateMomentObject);
                        var dateObject = dateMomentObject.toDate(); // convert moment.js object to Date object
                        console.log("dateObject", dateObject);
                        var UTCDate = new Date(dateObject).toUTCString();
                        console.log("UTCDate", UTCDate);
                        var finalDate = UTCDate.split(' ').slice(1, 3).join(' ');
                        response['wedding_anniversary'] = finalDate;
                    }
                    var EmployeeData = {
                        EmployeeData: response,
                        // EmployeeDesignationList: designationResponse,
                    }
                    //console.log("EmployeeData", EmployeeData);
                    fetch.replaceHtml(function () {
                        // if (sessionStorage.getItem('digibiz_role') == "employee") {
                        //     $('.mask').addClass('hide');
                        //     $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                        //     $('div[type="text"]').prop('disabled', true);
                        //     $('input[type="text"]').prop('disabled', true);
                        //     $('input[type="tel"]').prop('disabled', true);
                        //     $('select').prop('disabled', true);
                        //     $('#employee_department_assignment_btn').prop('disabled', true);
                        //     $('#employee_department_assignment_remove').prop('disabled', true);
                        //     $('#employee_contact_access_assignment_btn').prop('disabled', true);
                        //     $('#employee_access_show_btn').prop('disabled', true);
                        // }
                        removeLoader();
                        if ($('.employee-create-main-container').length > 0) {
                            appScroll.scrollBar('.employee-create-main-container');
                        }
                        resolve();
                    }, "page/employee/employee_profile", "#employee-profile-template", "#main-content-wrapper", EmployeeData);
                })
                .catch((err) => {
                    //console.log("error in employeeGet")
                })
        } else {
            //console.log("NO EMPLOYEE ID FOUND")
        }
        // })
        // .catch((err) => {
        //     //console.log("Error in employee designation list");
        // })
    });
}

function customerProfilePage() {
    addLoader();
    return new Promise((resolve, reject) => {
        //check for customer_id presence
        if (sessionStorage.getItem('customer_id') && sessionStorage.getItem('customer_type')) {
            if (sessionStorage.getItem('customer_type') == "customer") {
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    get_by: "id",
                    id: sessionStorage.getItem('customer_id')
                }
                //get customer details
                customerGet(reqParams)
                    .then((result) => {
                        console.log("customerGet result", result);
                        if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                            console.log("1")
                            if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                                result.identity_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (result.hasOwnProperty('identity_video') && result.identity_video) {
                            console.log("2")
                            if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                                console.log("2a");
                                var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.video_id}`;
                                result.identity_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (result.hasOwnProperty('date_of_birth') && result.date_of_birth) {
                            console.log("3")
                            var dateString = result.date_of_birth;
                            var dateMomentObject = moment(dateString, "DD/MM/YYYY"); // 1st argument - string, 2nd argument - format
                            console.log("dateMomentObject", dateMomentObject);
                            var dateObject = dateMomentObject.toDate(); // convert moment.js object to Date object
                            console.log("dateObject", dateObject);
                            var UTCDate = new Date(dateObject).toUTCString();
                            console.log("UTCDate", UTCDate);
                            var finalDate = UTCDate.split(' ').slice(1, 3).join(' ');
                            result['date_of_birth'] = finalDate;
                        }
                        if (result.hasOwnProperty('wedding_anniversary') && result.wedding_anniversary) {
                            console.log("4")
                            var dateString = result.wedding_anniversary;
                            var dateMomentObject = moment(dateString, "DD/MM/YYYY"); // 1st argument - string, 2nd argument - format
                            console.log("dateMomentObject", dateMomentObject);
                            var dateObject = dateMomentObject.toDate(); // convert moment.js object to Date object
                            console.log("dateObject", dateObject);
                            var UTCDate = new Date(dateObject).toUTCString();
                            console.log("UTCDate", UTCDate);
                            var finalDate = UTCDate.split(' ').slice(1, 3).join(' ');
                            result['wedding_anniversary'] = finalDate;
                        }
                        var customerData = {
                            customerData: result,
                            customer_type: "customer"
                        }
                        console.log("customerData", customerData);
                        fetch.replaceHtml(function () {
                            // if (sessionStorage.getItem('digibiz_role') == "customer") {
                            //     $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                            //     $('div[type="text"]').prop('disabled', true);
                            //     $('input[type="text"]').prop('disabled', true);
                            //     $('.mask').addClass('hide');
                            //     $('input[type="tel"]').prop('disabled', true);
                            //     $('.reassign-customer-btn').prop('disabled', true);
                            //     $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                            //     $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                            // }
                            removeLoader();
                            appScroll.scrollBar('.customer-create-main-container');
                            resolve();
                        }, "page/customer/customer_profile", "#customer-profile-template", "#main-content-wrapper", customerData);
                    })
                    .catch((err) => {
                        //console.log("error in customer")
                    })
            } else if (sessionStorage.getItem('customer_type') == "associate_customer") {
                var reqParams = {
                    device_id: crossplat.device.uuid,
                    get_by: "id",
                    id: sessionStorage.getItem('customer_id')
                }
                //get customer details
                associateCustomerGet(reqParams)
                    .then((result) => {
                        //console.log("associateCustomerGet result", result);
                        if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                            if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                                result.identity_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (result.hasOwnProperty('identity_video') && result.identity_video) {
                            if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.video_id}`;
                                result.identity_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (result.hasOwnProperty('date_of_birth') && result.date_of_birth) {
                            var dateString = result.date_of_birth;
                            var dateMomentObject = moment(dateString, "DD/MM/YYYY"); // 1st argument - string, 2nd argument - format
                            console.log("dateMomentObject", dateMomentObject);
                            var dateObject = dateMomentObject.toDate(); // convert moment.js object to Date object
                            console.log("dateObject", dateObject);
                            var UTCDate = new Date(dateObject).toUTCString();
                            console.log("UTCDate", UTCDate);
                            var finalDate = UTCDate.split(' ').slice(1, 3).join(' ');
                            result['date_of_birth'] = finalDate;
                        }
                        if (result.hasOwnProperty('wedding_anniversary') && result.wedding_anniversary) {
                            var dateString = result.wedding_anniversary;
                            var dateMomentObject = moment(dateString, "DD/MM/YYYY"); // 1st argument - string, 2nd argument - format
                            console.log("dateMomentObject", dateMomentObject);
                            var dateObject = dateMomentObject.toDate(); // convert moment.js object to Date object
                            console.log("dateObject", dateObject);
                            var UTCDate = new Date(dateObject).toUTCString();
                            console.log("UTCDate", UTCDate);
                            var finalDate = UTCDate.split(' ').slice(1, 3).join(' ');
                            result['wedding_anniversary'] = finalDate;
                        }
                        var customerData = {
                            customerData: result,
                            customer_type: "associate_customer"
                        }
                        fetch.replaceHtml(function () {
                            // if (sessionStorage.getItem('digibiz_role') == "customer") {
                            //     $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                            //     $('div[type="text"]').prop('disabled', true);
                            //     $('input[type="text"]').prop('disabled', true);
                            //     $('.mask').addClass('hide');
                            //     $('input[type="tel"]').prop('disabled', true);
                            //     $('.reassign-customer-btn').prop('disabled', true);
                            //     $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                            //     $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                            // }
                            removeLoader();
                            resolve();
                        }, "page/customer/customer_profile", "#customer-profile-template", "#main-content-wrapper", customerData);
                    })
                    .catch((err) => {
                        //console.log("error in customer")
                    })
            }
        }
    });
}

function calenderInit(element) {
    var $input = $(element).pickadate({
        selectMonths: true, // Creates a dropdown to control month
        selectYears: 100, // Creates a dropdown of 15 years to control year,
        // formatSubmit: 'yyyy/mm/dd',
        // format: 'yyyy/mm/dd',
        formatSubmit: 'dd/mm/yyyy',
        format: 'dd/mm/yyyy',
        today: false,
        clear: 'Clear',
        close: false,
        // max: new Date(new Date().getTime() - 365 * 24 * 60 * 60 * 1000 * -1),
        // min: new Date(new Date().getTime() - 365 * 24 * 60 * 60 * 1000 * 0),
        // maxDate: new Date(),
        closeOnSelect: true // Close upon selecting a date,
    });
    if ($(element)[0]) {
        let picker = $($input).pickadate('picker');
        //console.log("picker", picker);
        $input.on('click', function (e) {
            e.stopPropagation();
            $(picker).data('stay_open', true);
            picker.open();
        });
        picker.on('open', function () {
            if (!$(picker).data('stay_open')) {
                picker.close();
            }
        });
        picker.on('close', function () {
            $(picker).data('stay_open', false);
        });
    }
}

function settingCalenderInit(element) {
    var $input = $(element).pickadate({
        selectMonths: true, // Creates a dropdown to control month
        selectYears: 100, // Creates a dropdown of 15 years to control year,
        formatSubmit: 'dd/mm/yyyy',
        format: 'dd/mm/yyyy',
        today: false,
        clear: 'Clear',
        close: false,
        max: new Date(new Date().getTime() - 365 * 24 * 60 * 60 * 1000 * -1),
        min: new Date(new Date().getTime() - 365 * 24 * 60 * 60 * 1000 * 0),
        closeOnSelect: true // Close upon selecting a date,
    });
    if ($(element)[0]) {
        let picker = $($input).pickadate('picker');
        //console.log("picker", picker);
        $input.on('click', function (e) {
            e.stopPropagation();
            $(picker).data('stay_open', true);
            picker.open();
        });
        picker.on('open', function () {
            if (!$(picker).data('stay_open')) {
                picker.close();
            }
        });
        picker.on('close', function () {
            $(picker).data('stay_open', false);
        });
    }
}

//can't select future date from today
function calenderInitDOB(element) {
    var $input = $(element).pickadate({
        selectMonths: true, // Creates a dropdown to control month
        selectYears: 100, // Creates a dropdown of 15 years to control year,
        // formatSubmit: 'yyyy/mm/dd',
        // format: 'yyyy/mm/dd',
        formatSubmit: 'dd/mm/yyyy',
        format: 'dd/mm/yyyy',
        today: false,
        clear: 'Clear',
        close: false,
        // max: new Date(new Date().getTime() - 365 * 24 * 60 * 60 * 1000 * -1),
        // min: new Date(new Date().getTime() - 365 * 24 * 60 * 60 * 1000 * 0),
        max: '0',
        closeOnSelect: true // Close upon selecting a date,
    });
    if ($(element)[0]) {
        let picker = $($input).pickadate('picker');
        //console.log("picker", picker);
        $input.on('click', function (e) {
            e.stopPropagation();
            $(picker).data('stay_open', true);
            picker.open();
        });
        picker.on('open', function () {
            if (!$(picker).data('stay_open')) {
                picker.close();
            }
        });
        picker.on('close', function () {
            $(picker).data('stay_open', false);
        });
    }
}

function timepickInit(element) {
    var $timepick = $(element).pickatime({
        default: 'now', // Set default time: 'now', '1:30AM', '16:30'
        fromnow: 0,       // set default time to * milliseconds from now (using with default = 'now')
        twelvehour: true, // Use AM/PM or 24-hour format
        donetext: 'OK', // text for done-button
        cleartext: 'Clear', // text for clear-button
        canceltext: 'Cancel', // Text for cancel-button,
        container: undefined, // ex. 'body' will append picker to body
        autoclose: false, // automatic close timepicker
        ampmclickable: true, // make AM PM clickable
        aftershow: function () { } //Function for after opening timepicker
    });
    $(element).on('mousedown', function (event) {
        event.preventDefault();
    });
    // if ($(element)[0]) {
    //   let picker = $($timepick).pickatime('picker');
    //   $timepick.on('click', function (e) {
    //     e.stopPropagation();
    //     $(picker).data('stay_open', true);
    //     picker.open();
    //   });
    //   picker.on('open', function () {
    //     if (!$(picker).data('stay_open')) {
    //       picker.close();
    //     }
    //   });
    //   picker.on('close', function () {
    //     $(picker).data('stay_open', false);
    //   });
    // }
}

//adding country code for mobile number
function mobileFlaginit() {
    //console.log("mobileFlaginit initialized", $(".mobile-flag").length);
    $(".mobile-flag").intlTelInput({
        allowtrueExtensions: true,
        autoFormat: true,
        separateDialCode: true,
        autoHideDialCode: false,
        autoPlaceholder: false,
        defaultCountry: "in",
        ipinfoToken: "yolo",
        nationalMode: false,
        numberType: "MOBILE",
        preferredCountries: ["in", "us"],
        preventInvalidNumbers: true
    });
}

function validateAddNewEmployee() {
    let validateMobileNumber = false;
    let validateUniqueName = false;
    var user = JSON.parse(sessionStorage.getItem('profile_details'));
    //validate unique name
    if ($('#jeevi_member_field').val().length > 0) {
        //check if owner's unique name
        if (user.login.user_name == $('.unique-name').val()) {
            showError($('#jeevi_member_field'), `Can't select your own contact`);
            validateUniqueName = true;
        }
    }
    //validate mobile number     
    if ($('#add-employee-mobile-number').val().length == 0) {
        showError($('#add-employee-mobile-number'), "Field is required.");
        validateMobileNumber = true;
    } else if ($('#add-employee-mobile-number').intlTelInput("getNumber").length > 3) {
        if (!validate.checkIfIntelValidPhoneNumber($('#add-employee-mobile-number'))) {
            showError($('#add-employee-mobile-number'), `Invalid Phone number.`);
            validateMobileNumber = true;
        }
        //check if owner's mobile number 
        if (user.login.mobile_number == $('#add-employee-mobile-number').intlTelInput("getNumber")) {
            showError($('#add-employee-mobile-number'), `Can't select your own mobile number`);
            validateMobileNumber = true;
        }
    }
    if (validateUniqueName && validateMobileNumber) {
        Materialize.toast(`Please fill any one field`, 3000, 'round success-alert');
        return false;
    } else {
        return true;
    }

}

//validate employee step 2
function validateEmployeeStepTwo() {
    let validateIdentityPicture = false;
    let validateEmail = false;//optional
    let validateDateOfJoining = false;
    let validateEmployeeType = false;
    let validateEmployeeCategory = false;
    let validateEmployeeDesignation = false;
    let validateDisplayName = false;//optional
    let validateDisplayMobileNumber = false;//optional
    var user = JSON.parse(sessionStorage.getItem('profile_details'));
    //validate display mobile number
    if ($('#add-employee-display-phone-number').val().trim().length > 0) {
        if ($('#add-employee-display-phone-number').val().trim().length == 0) {
            showError($('#add-employee-display-phone-number'), "Field is required.");
            validateDisplayMobileNumber = true;
        } else if ($('#add-employee-display-phone-number').intlTelInput("getNumber").length > 3) {
            if (!validate.checkIfIntelValidPhoneNumber($('#add-employee-display-phone-number'))) {
                showError($('#add-employee-display-phone-number'), `Invalid Phone number.`);
                validateDisplayMobileNumber = true;
            }
            //check if owner's mobile number 
            // if (user.login.mobile_number == $('#add-employee-display-phone-number').intlTelInput("getNumber")) {
            //     showError($('#add-employee-display-phone-number'), `Can't select your own mobile number`);
            //     validateDisplayMobileNumber = true;
            // }
        }
    }

    // validate display name
    // var displayNameValue = getInputText($('#employee_display_name')).trim();
    // var displayNameLength = Array.from(displayNameValue).length;
    var displayNameLength = $('#employee_display_name').text().trim().length;
    if (displayNameLength > 0) {
        if (displayNameLength < config.employeeMinNameLength) {
            showError($('#employee_display_name'), `This field should contain atleast ${config.employeeMinNameLength} characters.`);
            validateDisplayName = true;
        }
        if (displayNameLength > config.employeeMaxNameLength) {
            showError($('#employee_display_name'), `This field can't have more than  ${config.employeeMaxNameLength} characters.`);
            validateDisplayName = true;
        }
        if (displayNameLength >= config.employeeMinNameLength && displayNameLength <= config.employeeMaxNameLength) {
            validateDisplayName = false;
        }
    }

    //validate email(optional)
    if ($('#employee_email').text().trim().length > 0) {
        if (!validate.checkIfValidEmail($('#employee_email').text().trim())) {
            showError($('#employee_email'), "Invalid Email");
            validateEmail = true;
        }
    }
    //validate Date of joining
    if ($('#employee_date_of_joining').val().trim().length > 0) {
        validateDateOfJoining = false;
    } else {
        validateDateOfJoining = true;
        showError($('#employee_date_of_joining'), `This field is required`);
    }
    //validate employee type
    // if ($('#employee-type-choose-select-dropdown').val().length > 0) {
    //     validateEmployeeType = false;
    // } else {
    //     validateEmployeeType = true;
    //     showError($('#employee-type-choose-select-dropdown'), `This field is required`);
    // }
    if ($('.selected-value-employee-type').attr('data-value').length > 0) {
        validateEmployeeType = false;
    }
    else {
        validateEmployeeType = true;
        showError($('.selected-value-employee-type'), `This field is required`);
    }
    //validate employee category
    // if ($('#employee-category-choose-select-dropdown').val().length > 0) {
    //     validateEmployeeCategory = false;
    // } else {
    //     validateEmployeeCategory = true;
    //     showError($('#employee-category-choose-select-dropdown'), `This field is required`);
    // }
    if ($('.selected-value-employee-category').attr('data-value').length > 0) {
        validateEmployeeCategory = false;
    }
    else {
        validateEmployeeCategory = true;
        showError($('.selected-value-employee-category'), `This field is required`);
    }
    //validate employee designation
    // if ($('#employee-designation-choose-select-dropdown').val().length > 0) {
    //     validateEmployeeDesignation = false;
    // } else {
    //     validateEmployeeDesignation = true;
    //     showError($('#employee-designation-choose-select-dropdown'), `This field is required`);
    // }
    if ($('.selected-value-employee-designation').attr('data-value').length > 0) {
        validateEmployeeDesignation = false;
    }
    else {
        validateEmployeeDesignation = true;
        showError($('.selected-value-employee-designation'), `This field is required`);
    }

    if (validateIdentityPicture || validateEmail || validateDateOfJoining || validateEmployeeType || validateEmployeeCategory || validateEmployeeDesignation || validateDisplayName || validateDisplayMobileNumber) {
        return false;
    } else {
        return true;
    }

}

function validateEmployeeProfileEdit() {
    let validateEmail = false;//optional
    let validateDisplayMobileNumber = false;//optional
    //validate display mobile number
    if ($('#add-employee-display-phone-number').val().trim().length > 0) {
        if ($('#add-employee-display-phone-number').val().trim().length == 0) {
            showError($('#add-employee-display-phone-number'), "Field is required.");
            validateDisplayMobileNumber = true;
        } else if ($('#add-employee-display-phone-number').intlTelInput("getNumber").length > 3) {
            if (!validate.checkIfIntelValidPhoneNumber($('#add-employee-display-phone-number'))) {
                showError($('#add-employee-display-phone-number'), `Invalid Phone number.`);
                validateDisplayMobileNumber = true;
            }
        }
    }
    //validate email(optional)
    if ($('#employee_alternate_email').text().trim().length > 0) {
        if (!validate.checkIfValidEmail($('#employee_alternate_email').text().trim())) {
            showError($('#employee_alternate_email'), "Invalid Email");
            validateEmail = true;
        }
    }

    if (validateEmail || validateDisplayMobileNumber) {
        return false;
    } else {
        return true;
    }
}
/*******************************EMPLOYEE CREATION MANAGEMENT(ends)****************************/

//********************EMPLOYEE BUTTON LANDING PAGE(starts)**************************//
function employeeBusinessListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "employee"
        }
        businessList(reqParam)
            .then((response) => {
                //console.log("businessList response", response);
                fetch.replaceHtml(function () {
                    processEmployeeBusinessList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/business/employee_business_list_wrapper", "#employee-business-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/employee_business_list_data", "#employee-business-data-list-template", "#employee-business-list-wrapper", null);
                }, "page/business/employee_business_list_wrapper", "#employee-business-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function employeesBusinessListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        if (digibiz.checkAccountFlag == false) {
            digibiz.employee_business_list = [];
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "employee_module",
                count: 8,
                offset: 0
            }
            businessList(reqParam)
                .then((response) => {
                    fetch.replaceHtml(function () {
                        processEmployeeBusinessList(response, function () {
                            appScroll.scrollBar('.employee-business-list-main-container');
                            listenForEmployeeBusinessListScrollEvent($('.employee-business-list-main-container'));
                            removeLoader();
                            resolve();
                        });
                    }, "page/business/employee_business_list_wrapper", "#employee-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/business/employee_business_list_data", "#employee-business-data-list-template", "#employee-business-list-wrapper", null);
                    }, "page/business/employee_business_list_wrapper", "#employee-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
        } else {
            fetch.replaceHtml(function () {
                processEmployeeBusinessList(digibiz.employee_business_list, function () {
                    appScroll.scrollBar('.employee-business-list-main-container');
                    listenForEmployeeBusinessListScrollEvent($('.employee-business-list-main-container'));
                    removeLoader();
                    resolve();
                });
            }, "page/business/employee_business_list_wrapper", "#employee-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
        }
    });
}


function listenForEmployeeBusinessListScrollEvent(el) {
    addLoader();
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "employee_module",
                count: 5,
                offset: digibiz.employee_business_list.length
            }
            businessList(reqParam)
                .then((response) => {
                    scrollProcessEmployeeBusinessList(response, function () {
                        // if(response.length > 0) {
                        listenForEmployeeBusinessListScrollEvent($('.employee-business-list-main-container'));
                        // }
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessEmployeeBusinessList(data, callback) {
    digibiz.employee_business_list = removeDuplicates(digibiz.employee_business_list.concat(data), "id");
    // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
    var businessList = {
        employee_business_list_data: data.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            // if (e.owner.id == sessionStorage.getItem('account_id') && e.owner.type == "individual") {
            //     e['is_business_owner'] = true;
            // } else {
            //     e['is_business_owner'] = false;
            // }
            return e;
        })
    };
    if (digibiz.employee_business_list.length > 0) {
        console.log("business is there")
    } else {
        location.hash = `jeevi/app/hub`;
        console.log('5555555');
    }
    //console.log("businessList", businessList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/scroll_employee_business_list_data", "#scroll-employee-business-data-list-template", "#employee-business-list-wrapper .employee-business-list-contentbox", businessList);
}

function employeeBusinessListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "employee"
    }
    businessList(reqParam)
        .then((response) => {
            digibiz.employee_business_list = response;
            if (digibiz.employee_business_list.length > 0) {
                $('#employee-role-btn').removeClass('hide');
            }
        })
        .catch((err) => {
            //console.log("error in employeeBusinessListHelperMethod", err)
        })
}

function employeeModuleListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "employee_module",
        count: 20,
        offset: 0
    }
    businessList(reqParam)
        .then((response) => {
            digibiz.employee_business_list = response;
            if (digibiz.employee_business_list.length > 0) {
                $('#employee-role-btn').removeClass('hide');
            }
        })
        .catch((err) => {
            //console.log("error in employeeBusinessListHelperMethod", err)
        })
}

function processEmployeeBusinessList(data, callback) {
    digibiz.employee_business_list = removeDuplicates(digibiz.employee_business_list.concat(data), "id");
    var businessList = {
        employee_business_list_data: digibiz.employee_business_list.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            // if (e.owner.id == sessionStorage.getItem('account_id') && e.owner.type == "individual") {
            //     e['is_business_owner'] = true;
            // } else {
            //     e['is_business_owner'] = false;
            // }
            return e;
        })
    };
    if (digibiz.employee_business_list.length > 0) {
        console.log("business is there")
    } else {
        location.hash = `jeevi/app/hub`;
        console.log('5555555');
    }
    //console.log("businessList", businessList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/employee_business_list_data", "#employee-business-data-list-template", "#employee-business-list-wrapper", businessList);
}

function employeeBusinessAppsHubPage() {
    return new Promise((resolve, reject) => {
        // var reqparams = {
        //     device_id: crossplat.device.uuid,
        //     list_by: "member",
        //     member_id: sessionStorage.getItem('employee_id')
        // }
        // roleManagementList(reqparams)
        //     .then((response) => {
        //         //console.log("roleManagementList", response);
        // var rolesData = {
        //     roles_data: response
        // }
        var rolesData = {
            business_name: sessionStorage.getItem('business_name')
        };
        fetch.replaceHtml(function () {
            // if(sessionStorage.getItem('digibiz_role') == "employee") {
            //     $('.business_profile_slider_btn').parent().removeClass('hide');
            //     $('.employee_profile_slider_btn').parent().removeClass('hide');
            var reqparams = {
                device_id: crossplat.device.uuid,
                employee_id: sessionStorage.getItem('employee_id'),
                business_id: sessionStorage.getItem('business_id')
            }
            getCollaboratorBusinessList(reqparams)
                .then((response) => {
                    console.log("businessList response", response);
                    if (response && response.length == 0) {
                        $('#collaborator-business-list').addClass('hide');
                    }
                }).catch((err) => {
                    console.log('err', err);
                })
            // }
            removeLoader();
            resolve();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
        }, "page/business/view_employee_business_apps_hub", "#view-employee-business-apps-land-page", "#main-content-wrapper", rolesData);
    })
    // .catch((err) => {

    // })

    // })
}
//********************EMPLOYEE BUTTON LANDING PAGE(ends)****************************//


function customerBusinessAppsHub() {
    return new Promise((resolve, reject) => {
        // var reqparams = {
        //     device_id: crossplat.device.uuid,
        //     list_by: "member",
        //     member_id: sessionStorage.getItem('employee_id')
        // }
        // roleManagementList(reqparams)
        //     .then((response) => {
        //         //console.log("roleManagementList", response);
        // var rolesData = {
        //     roles_data: response
        // }
        var rolesData = {
            customer_cloud_folder: sessionStorage.getItem('customer_cloud_folder'),
            business_name: sessionStorage.getItem('business_name')
        };
        //console.log("rolesData", rolesData)
        fetch.replaceHtml(function () {
            removeLoader();
            resolve();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
        }, "page/business/view_customer_business_apps_hub", "#view-customer-business-apps-land-page", "#main-content-wrapper", rolesData);
    })
    // .catch((err) => {

    // })

    // })
}









function getProfileManagerPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        fetch.replaceHtml(function () {
            //console.log("yess")
            removeLoader();
            resolve();
        }, "page/landPage/profile_manager_page", "#digibiz-profile-manager-page", "#main-content-wrapper", null);

    })
}

function departmentAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_department_data, "POST", "JSON", requestParms);
    });
}

function departmentGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_department_data, "POST", "JSON", requestParms);
    });
}

function departmentList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_department_data, "POST", "JSON", requestParms);
    });
}

function departmentUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_department_data, "POST", "JSON", requestParms);
    });
}

function departmentDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_department_data, "POST", "JSON", requestParms);
    });
}

function employeeTypeAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_employee_type, "POST", "JSON", requestParms);
    });
}

function employeeTypeGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee_type, "POST", "JSON", requestParms);
    });
}

function employeeTypeList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_employee_type, "POST", "JSON", requestParms);
    });
}

function employeeTypeUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_employee_type, "POST", "JSON", requestParms);
    });
}

function employeeTypeDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_employee_type, "POST", "JSON", requestParms);
    });
}


function employeeCategoryAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_employee_category, "POST", "JSON", requestParms);
    });
}

function employeeCategoryGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee_category, "POST", "JSON", requestParms);
    });
}

function employeeCategoryList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_employee_category, "POST", "JSON", requestParms);
    });
}

function employeeCategoryUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_employee_category, "POST", "JSON", requestParms);
    });
}

function employeeCategoryDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_employee_category, "POST", "JSON", requestParms);
    });
}


function employeeDesignationAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_employee_designation, "POST", "JSON", requestParms);
    });
}

function employeeDesignationGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee_designation, "POST", "JSON", requestParms);
    });
}

function employeeDesignationList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_employee_designation, "POST", "JSON", requestParms);
    });
}

function employeeDesignationUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_employee_designation, "POST", "JSON", requestParms);
    });
}

function employeeDesignationDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_employee_designation, "POST", "JSON", requestParms);
    });
}

function employeeDepartmentAssignmentAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_employee_department, "POST", "JSON", requestParms);
    });
}

function employeeDepartmentAssignmentGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee_department, "POST", "JSON", requestParms);
    });
}

function employeeDepartmentAssignmentList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.list_employee_department, "POST", "JSON", requestParms);
    });
}

function employeeDepartmentAssignmentDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_employee_department, "POST", "JSON", requestParms);
    });
}

function employeeAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_employee, "POST", "JSON", requestParms);
    });
}

function employeeGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee, "POST", "JSON", requestParms);
    });
}

function employeeList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_employee, "POST", "JSON", requestParms);
    });
}

function employeeCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.count_employee, "POST", "JSON", requestParms);
    });
}

function pendingNotificationCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.count_notification, "POST", "JSON", requestParms);
    });
}

function employeeFilter(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.filter_employee, "POST", "JSON", requestParms);
    });
}

function employeeUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_employee, "POST", "JSON", requestParms);
    });
}

function employeeProfileUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_employee_profile, "POST", "JSON", requestParms);
    });
}

function employeeDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_employee, "POST", "JSON", requestParms);
    });
}

function employeeDepartmentDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.employee_delete_department, "POST", "JSON", requestParms);
    });
}

function employeeDeviceChange(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.device_change_employee, "POST", "JSON", requestParms);
    });
}

function employeeDeleteAsset(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_employee_asset, "POST", "JSON", requestParms);
    });
}

//customer identifier api calls
function customerIdentifierAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_customer_identifiers, "POST", "JSON", requestParms);
    });
}

function customerIdentifierGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_customer_identifiers, "POST", "JSON", requestParms);
    });
}

function customerIdentifierList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_customer_identifiers, "POST", "JSON", requestParms);
    });
}

function customerIdentifierCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.count_customer_identifiers, "POST", "JSON", requestParms);
    });
}

function customerIdentifierUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_customer_identifiers, "POST", "JSON", requestParms);
    });
}

function customerIdentifierDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_customer_identifiers, "POST", "JSON", requestParms);
    });
}

//customer api calls
function customerAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_customer, "POST", "JSON", requestParms);
    });
}

function digibizCustomerAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_digibiz_customer, "POST", "JSON", requestParms);
    });
}

function customerGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_customer, "POST", "JSON", requestParms);
    });
}

function customerList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_customer, "POST", "JSON", requestParms);
    });
}


function customerCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.count_customer, "POST", "JSON", requestParms);
    });
}



function customerUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_customer, "POST", "JSON", requestParms);
    });
}

function customerProfileUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_customer_profile, "POST", "JSON", requestParms);
    });
}

function customerDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_customer, "POST", "JSON", requestParms);
    });
}

function customerReassign(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.reassign_customer, "POST", "JSON", requestParms);
    });
}

function customerDeviceChange(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.device_change_customer, "POST", "JSON", requestParms);
    });
}

function customerDeleteAsset(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_customer_asset, "POST", "JSON", requestParms);
    });
}

//associate customer api calls
function associateCustomerAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_associate_customers, "POST", "JSON", requestParms);
    });
}

function digibizAssociateCustomerAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_digibiz_associate_customers, "POST", "JSON", requestParms);
    });
}

function associateCustomerGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_associate_customers, "POST", "JSON", requestParms);
    });
}

function associateCustomerList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_associate_customers, "POST", "JSON", requestParms);
    });
}

function associateCustomerProfileUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_associate_customer_profile, "POST", "JSON", requestParms);
    });
}

function associateCustomerUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_associate_customers, "POST", "JSON", requestParms);
    });
}

function associateCustomerDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_associate_customers, "POST", "JSON", requestParms);
    });
}

function associateCustomerDeleteAsset(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_associate_customer_asset, "POST", "JSON", requestParms);
    });
}

//collaborator api's
function collaboratorAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_collaborator, "POST", "JSON", requestParms);
    });
}

function collaboratorGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_collaborator, "POST", "JSON", requestParms);
    });
}

function collaboratorList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_collaborator, "POST", "JSON", requestParms);
    });
}

function collaboratorCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.count_collaborator, "POST", "JSON", requestParms);
    });
}


function collaboratorUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_collaborator, "POST", "JSON", requestParms);
    });
}

function collaboratorDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_collaborator, "POST", "JSON", requestParms);
    });
}


function collaboratorCustomerList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_collaborator_business_customer, "POST", "JSON", requestParms);
    });
}

function collaboratorCustomerCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.count_collaborator_business_customer, "POST", "JSON", requestParms);
    });
}

function getCollaboratorCustomerList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_collaborator_customer, "POST", "JSON", requestParms);
    });
}

//collaborator groups api's
// function collaboratorGroupAdd(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.add_collaborator_group, "POST", "JSON", requestParms);
//     });
// }

// function collaboratorGroupGet(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.Data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.get_collaborator_group, "POST", "JSON", requestParms);
//     });
// }

// function collaboratorGroupList(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 reject(JSON.parse(response.responseText));
//             }
//         }, api.list_collaborator_group, "POST", "JSON", requestParms);
//     });
// }

// function collaboratorGroupUpdate(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.Data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.update_collaborator_group, "POST", "JSON", requestParms);
//     });
// }

// function collaboratorGroupDelete(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.msg);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.delete_collaborator_group, "POST", "JSON", requestParms);
//     });
// }

//role management api's
function roleManagementAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_role_management, "POST", "JSON", requestParms);
    });
}

function roleManagementGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_role_management, "POST", "JSON", requestParms);
    });
}

function roleManagementList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_role_management, "POST", "JSON", requestParms);
    });
}

function roleManagementUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_role_management, "POST", "JSON", requestParms);
    });
}

function roleManagementDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_role_management, "POST", "JSON", requestParms);
    });
}

//business owner api's
function businessOwnerAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_business_owner, "POST", "JSON", requestParms);
    });
}

function businessOwnerGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business_owner, "POST", "JSON", requestParms);
    });
}

function businessOwnerList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_business_owner, "POST", "JSON", requestParms);
    });
}

function businessOwnerUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_business_owner, "POST", "JSON", requestParms);
    });
}

function businessOwnerDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_business_owner, "POST", "JSON", requestParms);
    });
}

//notifications api's
function notificationAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_notification, "POST", "JSON", requestParms);
    });
}


function notificationGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_notification, "POST", "JSON", requestParms);
    });
}

function notificationList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.list_notification, "POST", "JSON", requestParms);
    });
}


function notificationChangeStatus(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.change_status_notification, "POST", "JSON", requestParms);
    });
}

function notificationDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_notification, "POST", "JSON", requestParms);
    });
}

//business notifications api's
function businessNotificationAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_business_notification, "POST", "JSON", requestParms);
    });
}


function businessNotificationGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business_notification, "POST", "JSON", requestParms);
    });
}

function businessNotificationList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.list_business_notification, "POST", "JSON", requestParms);
    });
}

function pendingCollaboratorCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.count_business_notification, "POST", "JSON", requestParms);
    });
}




function businessNotificationChangeStatus(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.change_status_business_notification, "POST", "JSON", requestParms);
    });
}

function businessNotificationDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_business_notification, "POST", "JSON", requestParms);
    });
}


//notifications api's
function checkEmployeeControlSetting(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee_control_setting, "POST", "JSON", requestParms);
    });
}

//contact list api calls
function listContactsList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_contacts_lists, "POST", "JSON", requestParms);
    });
}
function getContactList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_contacts_list, "POST", "JSON", requestParms);
    });
}

function getCustomerGroupContactList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_contact_group_contact_list, "POST", "JSON", requestParms);
    });
}

function getIdentifierItem(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_identifier_item_customer, "POST", "JSON", requestParms);
    });
}

//groups
function groupAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_group, "POST", "JSON", requestParms);
    });
}

function groupGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_group, "POST", "JSON", requestParms);
    });
}
function getGroupModeratorList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.moderator_list_group, "POST", "JSON", requestParms);
    });
}
function getGroupMembersCount(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.group_members_count, "POST", "JSON", requestParms);
    });
}

function groupsList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_group, "POST", "JSON", requestParms);
    });
}

function communicationGroupsList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_group_communication, "POST", "JSON", requestParms);
    });
}

function collaboratorGroupsList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_groups_collaborator, "POST", "JSON", requestParms);
    });
}

function employeeGroupUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_employee_group, "POST", "JSON", requestParms);
    });
}

function employeeGroupDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_group, "POST", "JSON", requestParms);
    });
}

function groupImageDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_group_image, "POST", "JSON", requestParms);
    });
}

function employeeGroupDepartmentUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_department_employee_group, "POST", "JSON", requestParms);
    });
}


function employeeGroupDepartmentDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_department_employee_group, "POST", "JSON", requestParms);
    });
}

function groupModeratorAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_moderator_group, "POST", "JSON", requestParms);
    });
}


function groupModeratorDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_moderator_group, "POST", "JSON", requestParms);
    });
}

function customerGroupMemberGroupUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_member_group_customer_group, "POST", "JSON", requestParms);
    });
}

function customerGroupMemberGroupDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_member_group_customer_group, "POST", "JSON", requestParms);
    });
}




//employee group members
function groupMemberAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_group_member, "POST", "JSON", requestParms);
    });
}

function employeeGroupMemberGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_employee_group_member, "POST", "JSON", requestParms);
    });
}

function groupMemberList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_group_member, "POST", "JSON", requestParms);
    });
}

function getCompleteList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_complete_list, "POST", "JSON", requestParms);
    });
}

function getGroupMembers(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_group_members, "POST", "JSON", requestParms);
    });
}

function getCompleteGroupMembers(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_complete_group_members, "POST", "JSON", requestParms);
    });
}

function getCompleteGroupMembersList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_complete_members_list, "POST", "JSON", requestParms);
    });
}

function getCollaboratorBusinessEmployeeMembers(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_collaborator_business_employees, "POST", "JSON", requestParms);
    });
}

function getCollaboratorBusinessList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_collaborator_business_list, "POST", "JSON", requestParms);
    });
}

// function employeeGroupMemberUpdate(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.Data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.update_employee, "POST", "JSON", requestParms);
//     });
// }

function groupMemberDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_group_member, "POST", "JSON", requestParms);
    });
}

function checkGroupMemberDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.check_delete_group_member, "POST", "JSON", requestParms);
    });
}


/****COMMUNICATION GROUPS AND GROUP MEMBERS API CALLS(starts)*************/
// function communicationGroupAdd(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.add_communication_group, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupGet(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.Data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.get_communication_group, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupList(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 reject(JSON.parse(response.responseText));
//             }
//         }, api.list_communication_group, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupUpdate(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.Data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.update_communication_group, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupDelete(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.msg);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.delete_communication_group, "POST", "JSON", requestParms);
//     });
// }


// function communicationGroupMemberAdd(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.add_communication_group_members, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupMemberGet(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.Data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.get_communication_group_member, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupMemberList(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 reject(JSON.parse(response.responseText));
//             }
//         }, api.list_communication_group_members, "POST", "JSON", requestParms);
//     });
// }

// function communicationGroupMemberDelete(requestParms) {
//     return new Promise((resolve, reject) => {
//         fetch.apiCall(function (response, status, xhr) {
//             if (status == "success") {
//                 resolve(response.data);
//             } else {
//                 var err = JSON.parse(response.responseText);
//                 reject(err);
//             }
//         }, api.delete_communication_group_member, "POST", "JSON", requestParms);
//     });
// }
/****COMMUNICATION GROUPS API CALLS(ends)*************/



function getUserID() {
    return sessionStorage.getItem('user_id');
}

function removeLoader() {
    // if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
    //     //console.log("removed loader")
    //     SpinnerDialog.hide();
    // } else {
    $(".global-loader-wrapper").remove();
    //}
}

function addLoader() {
    // if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
    //     console.log("added loader")
    //     SpinnerDialog.show(null, null, true);
    // } else {
    $('body').append(`<div class="global-loader-wrapper"><svg width="50px" height="50px" class="material-loader">
  <circle cx="25" cy="25" r="20" class="material-loader__circle" />
  </svg></div>`);
    // }
}

//DESCRIPTION: Show validation error
function showError(element, msg) {
    if ($(element).siblings('.error_note').length > 0) {
        $(element).siblings('.error_note').text(msg);
    } else {
        $(element).after(`<span class="error_note">${msg}</span>`);
    }
}

//DESCRIPTION: Remove validation error
function removeError(element) {
    $(element).siblings('.error_note').remove();
}

//DESCRIPTION: Shows alert pop-up layout
function showAlert(data, callback) {
    fetch.appendHtml(function (err) {
        callback();
    }, "components/alert", "#alert-layout-template", "#app-root", data)
}

//DESCRIPTION: Shows action sheet layout
function showAction(data, callback) {
    fetch.appendHtml(function (err) {
        callback();
    }, "components/action_sheet", "#action-sheet-layout-template", "#app-root", data)
}



//DESCRIPTION: Shows modal layout
function showModal(data, callback) {
    //$(".custom-modal-popup").remove();
    fetch.appendHtml(function (err) {
        callback();
    }, "components/modal", "#modal-layout-template", "#app-root", data)
}

//general asyncEach function
async function asyncEach(array, callback) {
    for (let index = 0; index < array.length; index++) {
        await callback(array[index], index, array);
    }
}

//general remove duplicates from an array function
function removeDuplicates(myArr, prop) {
    return myArr.filter((obj, pos, arr) => {
        return arr.map(mapObj => mapObj[prop]).indexOf(obj[prop]) === pos;
    });
}

function removeDuplicatesFromMultipleProperties(array, prop1, prop2) {
    return array.filter((e, i) => {
        return array.findIndex((x) => {
            return x[prop1] == e[prop1] && x[prop2] == e[prop2]
        }) == i;
    });
}

function getUserID() {
    return sessionStorage.getItem('user_id');
}

// function removeLoader() {
//     if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
//         // SpinnerDialog.hide();
//     } else {
//         $(".global-loader-wrapper").remove();
//     }
// }

// function addLoader() {
//     if (crossplat.device.platform == "Android" || crossplat.device.platform == "iOS") {
//         // SpinnerDialog.show(null, null, true);
//     } else {
//         $('body').append(`<div class="global-loader-wrapper"><svg width="50px" height="50px" class="material-loader">
//   <circle cx="25" cy="25" r="20" class="material-loader__circle" />
//   </svg></div>`);
//     }
// }


//change
function showBackButton() {
    var current_url = location.href.split("#").pop();
    if (current_url && current_url.includes("home/create_card")) {
        $("#sidebar-left").hide();
        $(".hamburg-menu-btn").hide();
        // $('.hamburg-menu-btn').hide().siblings('.activity-back-btn').removeClass('hide');
    } else if (current_url && current_url.includes("home/edit_card")) {
        $("#sidebar-left").hide();
    } else if (current_url && current_url.includes("home/share_card")) {
        $("#sidebar-left").hide();
        $(".hamburg-menu-btn")
            .hide()
            .siblings(".activity-back-btn")
            .removeClass("hide");
    } else if (current_url && current_url.includes("home/view_card")) {
        $("#sidebar-left").hide();

        $(".hamburg-menu-btn")
            .hide()
            .siblings(".activity-back-btn")
            .removeClass("hide");
    } else if (current_url && current_url.includes("home/preview_card")) {
        $("#sidebar-left").hide();
        $(".hamburg-menu-btn")
            .hide()
            .siblings(".activity-back-btn")
            .removeClass("hide");
    } else if (current_url && current_url.includes("home/complete_basic_card")) {
        $("#sidebar-left").hide();
        $(".hamburg-menu-btn").hide();
    } else if (current_url && current_url.includes("home/view_basic_card")) {
        $("#sidebar-left").hide();
        $(".hamburg-menu-btn")
            .hide()
            .siblings(".activity-back-btn")
            .removeClass("hide");
    } else {
        $("#sidebar-left").show();
        $(".hamburg-menu-btn")
            .show()
            .siblings(".activity-back-btn")
            .addClass("hide");
    }
}

/**
* Method Name : getUserProfile
* Description: get user information from core
* Request Parms: 
*/
function getUserProfile(callback) {
    console.log("getUserProfile");
    if (sessionStorage.getItem("profile_details")) {
        console.log("got");
        var getData = JSON.parse(sessionStorage.getItem("profile_details"));
        console.log("getData", getData);
        if (getData.hasOwnProperty('individual')) {
            console.log("got individual")
            callback(null, JSON.parse(sessionStorage.getItem("profile_details")));
        } else {
            console.log("else")
            let requestParams = {
                device_id: crossplat.device.uuid,
                data: {
                    individual: ["id", "salutation", "ssn", "status_message", "good_to_know_status_message", "address", "dob", "adhaar", "nominee", "name", "spam_count"],
                    login: ["mobile_number", "status", "user_name", "email", "secondary_number"],
                    pictures: {
                        profile_display: ["image_id"]
                    }
                }
            };
            fetch.apiCall(
                function (response, status, xhr) {
                    if (status === "success") {
                        console.log("1")
                        sessionStorage.setItem("profile_details", JSON.stringify(response.Data));
                        callback(null, response.Data);
                    } else {
                        console.log("2")
                        callback(response.responseText);
                    }
                },
                api.get_profile,
                "POST",
                "JSON",
                requestParams
            );
        }
    } else {
        console.log("else-else");
        let requestParams = {
            device_id: crossplat.device.uuid,
            data: {
                individual: ["id", "salutation", "ssn", "status_message", "good_to_know_status_message", "address", "dob", "adhaar", "nominee", "name", "spam_count"],
                login: ["mobile_number", "status", "user_name", "email", "secondary_number"],
                pictures: {
                    profile_display: ["image_id"]
                }
            }
        };
        fetch.apiCall(
            function (response, status, xhr) {
                if (status === "success") {
                    console.log("3")
                    sessionStorage.setItem("profile_details", JSON.stringify(response.Data));
                    callback(null, response.Data);
                } else {
                    console.log("4")
                    callback(response.responseText);
                }
            },
            api.get_profile,
            "POST",
            "JSON",
            requestParams
        );
    }
}

/**
 * Route Name : getJeeviContact
 * Description:
 * Request Parms: device_id,user_type,user_id
 */
function getJeeviContactDetail(requestParms) {
    //console.log("requestParms", requestParms);
    return new Promise((resolve, reject) => {
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response);
                } else {
                    reject(JSON.parse(response.responseText));
                }
            },
            api.get_jeevi_contact,
            "POST",
            "JSON",
            requestParms
        );
    });
}

function getDepartmentManagementPage() {
    return new Promise((resolve, reject) => {
        var reqparams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "department",
            count: 20,
            offset: 0
        }
        departmentList(reqparams)
            .then((response) => {
                //console.log("success in department list", response);
                fetch.replaceHtml(function () {
                    processDepartmentList(response, function () {
                        appScroll.scrollBar('.department-list-wrapper');
                        listenForDepartmentListScrollEvent($('.department-list-wrapper'));
                        removeLoader();
                        resolve();
                    });
                }, "page/common/department_list_wrapper", "#department-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/common/department_list_data", "#department-data-list-template", "#department-list-wrapper", null);
                }, "page/common/department_list_wrapper", "#department-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processDepartmentList(data, callback) {
    digibiz.department_list = removeDuplicates(digibiz.department_list.concat(data), "id");
    var getData = {
        department_list_data: digibiz.department_list
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/department_list_data", "#department-data-list-template", "#department-list-wrapper", getData);
}

function listenForDepartmentListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqparams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "department",
                count: 20,
                offset: digibiz.department_list.length
            }
            departmentList(reqparams)
                .then((response) => {
                    //console.log("success in department list", response);
                    // fetch.replaceHtml(function () {
                    processScrollDepartmentList(response, function () {
                        listenForDepartmentListScrollEvent($('.department-list-wrapper'));
                        removeLoader();
                    });
                    // }, "page/common/department_list_wrapper", "#department-list-wrapper-template", "#main-content-wrapper", null);
                })
                .catch((err) => {
                    // fetch.replaceHtml(function () {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_department_list_data", "#scroll-department-data-list-template", "#department-list-wrapper .os-content", null);
                    // }, "page/common/department_list_wrapper", "#department-list-wrapper-template", "#main-content-wrapper", null);
                })
        }
    });
}

function processScrollDepartmentList(data, callback) {
    digibiz.department_list = removeDuplicates(digibiz.department_list.concat(data), "id");
    var getData = {
        department_list_data: data
    };
    //console.log("getData", getData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_department_list_data", "#scroll-department-data-list-template", "#department-list-wrapper .os-content", getData);
}

function departmentCreatePage() {
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('department_id') != null) {
            //get department
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('department_id'),
                list_by: "id",
                business_id: sessionStorage.getItem('business_id')
            }
            departmentGet(requestParams)
                .then((result) => {
                    //console.log("result", result);
                    var reqParams = {
                        device_id: crossplat.device.uuid,
                        id: result.id,
                        list_by: "sub-department",
                        business_id: sessionStorage.getItem('business_id')
                    }
                    departmentList(reqParams)
                        .then((response) => {
                            //console.log("response", response);
                            var getData = {
                                departments: response,
                                department_name: result.name,
                                department_id: result.id
                            }
                            //console.log("getData", getData);
                            fetch.replaceHtml(function () {
                                removeLoader();
                                resolve();
                            }, "page/common/department_create", "#department-create-template", "#main-content-wrapper", getData);
                        })
                        .catch((err) => {
                            // removeLoader();
                            // resolve();
                            // Materialize.toast("Error in listing departments", 3000, 'round success-alert');
                            var getData = {
                                department_name: result.name,
                                department_id: result.id
                            }
                            fetch.replaceHtml(function () {
                                removeLoader();
                                resolve();
                            }, "page/common/department_create", "#department-create-template", "#main-content-wrapper", getData);
                        })
                })
                .catch((err) => {
                    removeLoader();
                    resolve();
                    Materialize.toast("Error in getting departments", 3000, 'round success-alert');
                })
        } else {
            fetch.replaceHtml(function () {
                removeLoader();
                resolve();
            }, "page/common/department_create", "#department-create-template", "#main-content-wrapper", null);
        }
    });
}

function employeeTypesPage() {
    return new Promise((resolve, reject) => {
        var reqPArams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        employeeTypeList(reqPArams)
            .then((response) => {
                //console.log("response", response);
                // var getEmployeeTypesData = {
                //     employee_types: response
                // }
                fetch.replaceHtml(function () {
                    processEmployeeTypesList(response, function () {
                        appScroll.scrollBar('.employee-types-list-wrapper');
                        listenForEmployeeTypesListScrollEvent($('.employee-types-list-wrapper'));
                        removeLoader();
                        resolve();
                    });
                    // fetch.replaceHtml(function () {
                    //     removeLoader();
                    //     resolve();
                    // }, "page/common/employee_types", "#employee-types-template", "#employee-types-list-wrapper", getEmployeeTypesData);
                }, "page/common/employee_types_wrapper", "#employee-types-wrapper-template", "#main-content-wrapper", null);

            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function () {
                        //console.log("8888")
                        removeLoader();
                        resolve();
                    }, "page/common/employee_types", "#employee-types-template", "#employee-types-list-wrapper", null);
                }, "page/common/employee_types_wrapper", "#employee-types-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processEmployeeTypesList(data, callback) {
    digibiz.employee_types_list = removeDuplicates(digibiz.employee_types_list.concat(data), "id");
    var getEmployeeTypesData = {
        employee_types: digibiz.employee_types_list
    };
    //console.log("getEmployeeTypesData", getEmployeeTypesData)
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/common/employee_types", "#employee-types-template", "#employee-types-list-wrapper", getEmployeeTypesData);
}


function listenForEmployeeTypesListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqPArams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                count: 15,
                offset: digibiz.employee_types_list.length
            }
            let identifier = '#employee-types-list-wrapper .os-content .employee-types-content-box';
            employeeTypeList(reqPArams)
                .then((response) => {
                    removeLoader();
                    scrollProcessEmployeeTypesList(response, function () {
                        listenForEmployeeTypesListScrollEvent($('.employee-types-list-wrapper'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_employee_types", "#scroll-employee-types-template", identifier, null);

                })

        }
    });
}

function scrollProcessEmployeeTypesList(data, callback) {
    digibiz.employee_types_list = removeDuplicates(digibiz.employee_types_list.concat(data), "id");
    let identifier = '#employee-types-list-wrapper .os-content .employee-types-content-box';
    var getEmployeeTypesData = {
        employee_types: data
    };
    //console.log("getEmployeeTypesData", getEmployeeTypesData)
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_employee_types", "#scroll-employee-types-template", identifier, getEmployeeTypesData);
}


function processEmployeeStatusList(data, callback) {
    // digibiz.employee_status_list = removeDuplicates(digibiz.employee_status_list.concat(data), "id");
    var getEmployeeStatusData = {
        employee_status: data
    };
    //console.log("getEmployeeTypesData", getEmployeeTypesData)
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/employee_status", "#employee-status-template", "#employee-status-list-wrapper", getEmployeeStatusData);
}

function employeeCategoryPage() {
    return new Promise((resolve, reject) => {
        var reqPArams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        employeeCategoryList(reqPArams)
            .then((response) => {
                removeLoader();
                //console.log("employeeCategoryList", response);
                fetch.replaceHtml(function () {
                    processEmployeeCategoryList(response, function () {
                        appScroll.scrollBar('.employee-category-list-wrapper');
                        listenForEmployeeCategoryListScrollEvent($('.employee-category-list-wrapper'));
                        removeLoader();
                        resolve();
                    });
                }, "page/common/employee_category_wrapper", "#employee-category-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/common/employee_category", "#employee-category-template", "#employee-category-list-wrapper", null);
                }, "page/common/employee_category_wrapper", "#employee-category-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processEmployeeCategoryList(data, callback) {
    digibiz.employee_category_list = removeDuplicates(digibiz.employee_category_list.concat(data), "id");
    var getEmployeeCategoryData = {
        employee_category: digibiz.employee_category_list
    }
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/employee_category", "#employee-category-template", "#employee-category-list-wrapper", getEmployeeCategoryData);
}

function listenForEmployeeCategoryListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqPArams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.employee_category_list.length
            }
            let identifier = "#employee-category-list-wrapper .os-content .employee-category-content-box";
            employeeCategoryList(reqPArams)
                .then((response) => {
                    removeLoader();
                    scrollProcessEmployeeCategoryList(response, function () {
                        listenForEmployeeCategoryListScrollEvent($('.employee-category-list-wrapper'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_employee_category", "#scroll-employee-category-template", identifier, null);
                })

        }
    });
}

function scrollProcessEmployeeCategoryList(data, callback) {
    digibiz.employee_category_list = removeDuplicates(digibiz.employee_category_list.concat(data), "id");
    let identifier = "#employee-category-list-wrapper .os-content .employee-category-content-box";
    var getEmployeeCategoryData = {
        employee_category: data
    }
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_employee_category", "#scroll-employee-category-template", identifier, getEmployeeCategoryData);
}

function employeeDesignationPage() {
    return new Promise((resolve, reject) => {
        var reqPArams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            count: 13,
            offset: 0
        }
        employeeDesignationList(reqPArams)
            .then((response) => {
                //console.log("employeeDesignationList", response);
                fetch.replaceHtml(function () {
                    processEmployeeDesignationList(response, function () {
                        appScroll.scrollBar('.employee-designation-list-wrapper');
                        listenForEmployeeDesignationListScrollEvent($('.employee-designation-list-wrapper'));
                        removeLoader();
                        resolve();
                    });
                }, "page/common/employee_designation_wrapper", "#employee-designation-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();

                            resolve();
                        }
                    }, "page/common/employee_designation", "#employee-designation-template", "#employee-designation-list-wrapper", null);
                }, "page/common/employee_designation_wrapper", "#employee-designation-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processEmployeeDesignationList(data, callback) {
    digibiz.employee_designation_list = removeDuplicates(digibiz.employee_designation_list.concat(data), "id");
    var getEmployeeDesignationData = {
        employee_designation: digibiz.employee_designation_list
    }
    //console.log("getEmployeeDesignationData", getEmployeeDesignationData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/employee_designation", "#employee-designation-template", "#employee-designation-list-wrapper", getEmployeeDesignationData);
}


function listenForEmployeeDesignationListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqPArams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.employee_designation_list.length
            }
            let identifier = "#employee-designation-list-wrapper .os-content .employee-designation-content-box";
            employeeDesignationList(reqPArams)
                .then((response) => {
                    removeLoader();
                    scrollProcessEmployeeDesignationList(response, function () {
                        listenForEmployeeDesignationListScrollEvent($('.employee-designation-list-wrapper'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_employee_designation", "#scroll-employee-designation-template", identifier, null);
                })
        }
    });
}


function scrollProcessEmployeeDesignationList(data, callback) {
    digibiz.employee_designation_list = removeDuplicates(digibiz.employee_designation_list.concat(data), "id");
    var getEmployeeDesignationData = {
        employee_designation: data
    }
    let identifier = "#employee-designation-list-wrapper .os-content .employee-designation-content-box";
    //console.log("getEmployeeDesignationData", getEmployeeDesignationData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_employee_designation", "#scroll-employee-designation-template", identifier, getEmployeeDesignationData);
}




/*******************************BUSINESS MANAGEMENT(starts)****************************/
//api calls

function businessTagAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_business_tag, "POST", "JSON", requestParms);
    });
}

function businessTagGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business_tag, "POST", "JSON", requestParms);
    });
}

function businessTagList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_business_tags, "POST", "JSON", requestParms);
    });
}

function businessTagUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_business_tag, "POST", "JSON", requestParms);
    });
}

function businessTagDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_business_tag, "POST", "JSON", requestParms);
    });
}

function businessTypeAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_business_type, "POST", "JSON", requestParms);
    });
}

function businessTypeGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business_type, "POST", "JSON", requestParms);
    });
}

function businessTypeList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_business_type, "POST", "JSON", requestParms);
    });
}

function businessTypeUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_business_type, "POST", "JSON", requestParms);
    });
}

function businessTypeDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_business_type, "POST", "JSON", requestParms);
    });
}

function businessAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_business, "POST", "JSON", requestParms);
    });
}

function businessGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business, "POST", "JSON", requestParms);
    });
}

function businessList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_business, "POST", "JSON", requestParms);
    });
}

function businessUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_business, "POST", "JSON", requestParms);
    });
}

function businessSettings(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.business_settings, "POST", "JSON", requestParms);
    });
}

function businessDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_business, "POST", "JSON", requestParms);
    });
}

function businessSuperAdminAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_super_admin, "POST", "JSON", requestParms);
    });
}

function businessSuperAdminRevoke(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.revoke_super_admin, "POST", "JSON", requestParms);
    });
}

function viewBusinessCheckRole(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.view_business_check_role, "POST", "JSON", requestParms);
    });
}

function businessDeviceChange(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.device_change_business, "POST", "JSON", requestParms);
    });
}

function businessDeleteAsset(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_business_asset, "POST", "JSON", requestParms);
    });
}

function businessDeleteDisplayPicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_business_display_picture, "POST", "JSON", requestParms);
    });
}

function businessDeleteDisplayVideo(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_business_display_video, "POST", "JSON", requestParms);
    });
}

function employeeDeleteIdentityPicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_employee_identity_picture, "POST", "JSON", requestParms);
    });
}

function employeeDeleteIdentityVideo(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_employee_identity_video, "POST", "JSON", requestParms);
    });
}

function customerDeleteIdentityPicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_customer_identity_picture, "POST", "JSON", requestParms);
    });
}

function customerDeleteIdentityVideo(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_customer_identity_video, "POST", "JSON", requestParms);
    });
}

function associateCustomerDeleteIdentityPicture(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_associate_customer_identity_picture, "POST", "JSON", requestParms);
    });
}

function associateCustomerDeleteIdentityVideo(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.remove_associate_customer_identity_video, "POST", "JSON", requestParms);
    });
}

function individualCloudFileRead(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.individual_cloud_file_read, "GET", "JSON", requestParms);
    });
}

function digibizCloudFileRead(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business_multimedia, "GET", "JSON", requestParms);
    });
}

//navigate logs
function navigateLogsAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_navigate_logs, "POST", "JSON", requestParms);
    });
}

function navigateLogsGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_navigate_logs, "POST", "JSON", requestParms);
    });
}

function navigateLogsList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_navigate_logs, "POST", "JSON", requestParms);
    });
}

function navigateLogsUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_navigate_logs, "POST", "JSON", requestParms);
    });
}

function navigateLogsDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_navigate_logs, "POST", "JSON", requestParms);
    });
}

//Digibiz logs

function digibizLogsList(requestParms) {
    console.log('requestParms', requestParms);
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_digibiz_logs, "POST", "JSON", requestParms);
    });
}

function digibizFilterLogsList(requestParms) {
    console.log('requestParms', requestParms);
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_digibiz_logs_by_filters, "POST", "JSON", requestParms);
    });
}

function digibizLoginLogsList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_digibiz_login_logs, "POST", "JSON", requestParms);
    });
}

function digibizLogsUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_digibiz_logs, "POST", "JSON", requestParms);
    });
}

function digibizLogsDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_digibiz_logs, "POST", "JSON", requestParms);
    });
}

function getBusinessMultimediaDownload(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_business_multimedia_download, "POST", "JSON", requestParms);
    });
}



//method calls
function businessTagsPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid
        }
        businessTagList(reqParam)
            .then((response) => {
                //console.log("businessTagList response", response);
                var businessTags = {
                    businessTags: response
                }
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/business_tags", "#business-tags-template", "#main-content-wrapper", businessTags);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/business_tags", "#business-tags-template", "#main-content-wrapper", null);
            })
    });
}

function validateBusinessTagName(getTagName) {
    let validateTagName = false;
    //validate tag name
    if (getTagName.length > 0) {
        if (getTagName.length < config.businessTagMinLength) {
            showError($('#business_tag'), `This field should contain atleast ${config.businessTagMinLength} characters.`);
            validateTagName = true;
        }
        if (getTagName.length > config.businessTagMaxLength) {
            showError($('#business_tag'), `This field can't have more than  ${config.businessTagMaxLength} characters.`);
            validateTagName = true;
        }
        if (getTagName.length >= config.businessTagMinLength && getTagName.length <= config.businessTagMaxLength) {
            validateTagName = false;
        }
    } else {
        showError($('#business_tag'), `This field is required.`);
        validateTagName = true;
    }
    if (validateTagName) {
        return false;
    } else {
        return true;
    }
}

function validateBusinessTypeName(businessTypeName) {
    let validateTypeName = false;
    //validate tag name
    if (businessTypeName.length > 0) {
        if (businessTypeName.length < config.businessTypeMinLength) {
            showError($('#business_type'), `This field should contain atleast ${config.businessTypeMinLength} characters.`);
            validateTypeName = true;
        }
        if (businessTypeName.length > config.businessTypeMaxLength) {
            showError($('#business_type'), `This field can't have more than  ${config.businessTypeMaxLength} characters.`);
            validateTypeName = true;
        }
        if (businessTypeName.length >= config.businessTypeMinLength && businessTypeName.length <= config.businessTypeMaxLength) {
            validateTypeName = false;
        }
    } else {
        showError($('#business_type'), `This field is required.`);
        validateTypeName = true;
    }
    if (validateTypeName) {
        return false;
    } else {
        return true;
    }
}


function businessTypesPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid
        }
        businessTypeList(reqParam)
            .then((response) => {
                //console.log("businessTypeList response", response);
                var businessTypes = {
                    businessTypes: response
                }
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/business_types", "#business-types-template", "#main-content-wrapper", businessTypes);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/business_types", "#business-types-template", "#main-content-wrapper", null);
            })
    });
}

function businessCreatePage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "all"
        }
        businessList(reqParam)
            .then((response) => {
                //console.log("businessList response", response);
                var businessList = {
                    businessList: response
                }
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/business", "#business-template", "#main-content-wrapper", businessList);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/business", "#business-template", "#main-content-wrapper", null);
            })
    });
}



function businessEditPage() {
    return new Promise((resolve, reject) => {
        var businessTypesReqParams = {
            device_id: crossplat.device.uuid,
        }
        businessTypeList(businessTypesReqParams)
            .then((result) => {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        digibiz.storages = [];
                        if (response.hasOwnProperty('display_picture') && response.display_picture) {
                            if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                response.display_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (response.hasOwnProperty('display_video') && response.display_video) {
                            if (response.display_video.hasOwnProperty('thumbnail') && response.display_video.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.thumbnail}`;
                                response.display_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (response.hasOwnProperty('declaration_transaction_pictures') && response.declaration_transaction_pictures) {
                            if (response.declaration_transaction_pictures.hasOwnProperty('thumbnail') && response.declaration_transaction_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_transaction_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=transaction`;
                                response.declaration_transaction_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_transaction_pictures.hasOwnProperty('image_id') && response.declaration_transaction_pictures.image_id) {
                                response.declaration_transaction_pictures['avtarUrl'] = response.declaration_transaction_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_signature_pictures') && response.declaration_signature_pictures) {
                            if (response.declaration_signature_pictures.hasOwnProperty('thumbnail') && response.declaration_signature_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_signature_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=signature`;
                                response.declaration_signature_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_signature_pictures.hasOwnProperty('image_id') && response.declaration_signature_pictures.image_id) {
                                response.declaration_signature_pictures['avtarUrl'] = response.declaration_signature_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_video') && response.declaration_video) {
                            if (response.declaration_video.hasOwnProperty('thumbnail') && response.declaration_video.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_video.thumbnail}`;
                                response.declaration_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        //put storage data in an array
                        if (response.hasOwnProperty('storage') && response.storage) {
                            //console.log("storage is present");
                            if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                                digibiz.storages.push({
                                    "name": "GoogleDrive",
                                    "account": response.storage.GoogleDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                                digibiz.storages.push({
                                    "name": "OneDrive",
                                    "account": response.storage.OneDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                                digibiz.storages.push({
                                    "name": "DropBox",
                                    "account": response.storage.DropBox.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                                digibiz.storages.push({
                                    "name": "DJ",
                                    "account": response.storage.DJ
                                })
                            }
                        }
                        var getBusiness = {
                            businessTypes: result,
                            getBusiness: response,
                            getBusinessTypeId: response.business_type_id,
                            storage_list: digibiz.storages,
                            active_storage: response.active_storage
                        }
                        if (digibiz.storages.length < 4) {
                            getBusiness.addStorage = true;
                        }
                        //console.log("getBusiness", getBusiness);
                        fetch.replaceHtml(function () {
                            if (sessionStorage.getItem('business_storage_token') && JSON.parse(sessionStorage.getItem('business_storage_token')).tokenStatus == 'inactive') {
                                showReauthenticateBusinessStorage();
                                if (sessionStorage.getItem('authErrorCode')) {
                                    Materialize.toast(JSON.parse(sessionStorage.getItem('authErrorCode')), 10000, 'error-alert');
                                } else {
                                    Materialize.toast("Access is revoked, please reauthenticate the selected drive", 10000, 'error-alert');
                                }
                            } else {
                                //console.log("4566")
                            }
                            //dropdown show(common)
                            var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                            $('#business-type-choose-select-dropdown').val(getDropdownValue);
                            calenderInit('#business_date_of_commencement');
                            calenderInit('#business_date_of_incorporation');
                            //check
                            if (sessionStorage.getItem('digibiz_role') == "employee" || sessionStorage.getItem('digibiz_role') == "customer") {
                                //console.log("11");
                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                $('div[type="text"]').prop('disabled', true);
                                $('input[type="text"]').prop('disabled', true);
                                $('.business-add-address-btn').prop('disabled', true);
                                $('#business-add-address-type-select-dropdown').prop('disabled', true);
                                $('.mask').addClass('hide');
                                $('input[type="tel"]').prop('disabled', true);
                                $('.multimedia-upload').prop('disabled', true);
                                $('.multimedia-save').prop('disabled', true);
                                $('.add-identity-proof-btn').prop('disabled', true);
                                $('.show-account-btn').prop('disabled', true);
                                $('.setdefault-account-btn').prop('disabled', true);
                                $('.add-storage-account').prop('disabled', true);
                            }
                            mobileFlaginit();
                            removeLoader();
                            resolve();
                        }, "page/business/business_edit", "#business-edit-template", "#main-content-wrapper", getBusiness);
                    })
                    .catch((err) => {
                        removeLoader();
                        resolve();
                        Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                resolve();
                Materialize.toast("Error in getting business types", 3000, 'rounded error-alert');
            })
        // addLoader();
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     id: sessionStorage.getItem('business_id')
        // }
        // businessGet(reqParam)
        //     .then((response) => {
        //         //console.log("businessGet", response);
        //         var getBusiness = {
        //             getBusiness: response,
        //             getBusinessTypeId: response.business_type_id
        //         }
        //         //console.log("getBusiness", getBusiness);
        //         fetch.replaceHtml(function () {
        //             //dropdown show(common)
        //             var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
        //             $('#business-type-choose-select-dropdown').val(getDropdownValue);
        //             //based on the type of the business show and display the required fields
        //             if (getDropdownValue == "Sole Proprietorship") {
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-shop-established-license-container').removeClass('hide');
        //                 $('.business-add-gst-container').removeClass('hide');
        //                 $('.business-add-declaration-container').removeClass('hide');
        //             } else if (getDropdownValue == "Partnership") {
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-gst-container').removeClass('hide');
        //                 $('.business-add-partnership-deed-container').removeClass('hide');
        //                 $('.business-add-partnership-registration-certificate-container').removeClass('hide');
        //                 $('.business-add-declaration-container').removeClass('hide');
        //             } else if (getDropdownValue == "Private Limited Company") {
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-gst-container').removeClass('hide');
        //                 $('.business-add-transaction-person-container').removeClass('hide');
        //                 $('.business-add-memorandum-of-association-container').removeClass('hide');
        //                 $('.business-add-articles-of-association-container').removeClass('hide');
        //                 $('.business-add-declaration-container').removeClass('hide');
        //             } else if (getDropdownValue == "Public Limited Company") {
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-gst-container').removeClass('hide');
        //                 $('.business-add-memorandum-of-association-container').removeClass('hide');
        //                 $('.business-add-declaration-container').removeClass('hide');
        //             } else if (getDropdownValue == "Trusts/Foundations") {
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-gst-container').removeClass('hide');
        //                 $('.business-add-transaction-person-container').removeClass('hide');
        //                 $('.business-add-trust-establishment-license-container').removeClass('hide');
        //                 $('.business-add-declaration-container').removeClass('hide');
        //             } else if (getDropdownValue == "Co-operative Society/Associations") {
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-email-container').removeClass('hide');
        //                 $('.business-add-address-container').removeClass('hide');
        //                 $('.business-add-identity-proof-container').removeClass('hide');
        //                 $('.business-add-pancard-container').removeClass('hide');
        //                 $('.business-add-gst-container').removeClass('hide');
        //                 $('.business-add-llp-registration-certificate-container').removeClass('hide');
        //                 $('.business-add-transaction-person-container').removeClass('hide');
        //                 $('.business-add-declaration-container').removeClass('hide');
        //             }
        //             removeLoader();
        //             resolve();
        //             $(".action-sheet-container").remove();
        //         }, "page/business/business_edit", "#business-edit-template", "#main-content-wrapper", getBusiness);
        //     })
        //     .catch((err) => {
        //         resolve();
        //         Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
        //     })
    })
}

function viewBusinessProfilePage() {
    return new Promise((resolve, reject) => {
        var businessTypesReqParams = {
            device_id: crossplat.device.uuid,
        }
        businessTypeList(businessTypesReqParams)
            .then((result) => {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        getDisplayControl(reqParam)
                            .then((ResponseResult) => {
                                //console.log("ResponseResult", ResponseResult);
                                if (response.alternate_contact_number == "+91") {
                                    delete response.alternate_contact_number;
                                }
                                if (response.hasOwnProperty('date_of_commencement') && response.date_of_commencement) {
                                    var parts = response.date_of_commencement.split('/');
                                    var mydate = new Date(parts[2], parts[1] - 1, parts[0]);
                                    var getDateOfCommencement = mydate.toDateString();
                                    response.date_of_commencement = getDateOfCommencement;
                                }
                                if (response.hasOwnProperty('date_of_incorporation') && response.date_of_incorporation) {
                                    var parts = response.date_of_incorporation.split('/');
                                    var mydate = new Date(parts[2], parts[1] - 1, parts[0]);
                                    var getDateOfIncorporation = mydate.toDateString();
                                    response.date_of_incorporation = getDateOfIncorporation;
                                }
                                if (response.hasOwnProperty('display_picture') && response.display_picture) {
                                    if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                        response.display_picture['avtarUrl'] = avtarUrl;
                                    }
                                }
                                if (response.hasOwnProperty('display_video') && response.display_video) {
                                    if (response.display_video.hasOwnProperty('thumbnail') && response.display_video.thumbnail) {
                                        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.thumbnail}`;
                                        // response.display_video['avtarUrl'] = avtarUrl;
                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.video_id}`;
                                        //console.log("avtarUrl", avtarUrl);
                                        response.display_video['avtarUrl'] = avtarUrl;
                                    }
                                }
                                var getBusiness = {
                                    businessTypes: result,
                                    getBusiness: response,
                                    getBusinessTypeId: response.business_type_id,
                                    display_control: ResponseResult
                                }
                                //console.log("getBusiness", getBusiness);
                                fetch.replaceHtml(function () {
                                    //dropdown show(common)
                                    // var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                                    // $('#business-type-choose-select-dropdown').val(getDropdownValue);
                                    // calenderInit('#business_date_of_commencement');
                                    // calenderInit('#business_date_of_incorporation');
                                    //check
                                    if (sessionStorage.getItem('digibiz_role') == "employee" || sessionStorage.getItem('digibiz_role') == "customer") {
                                        //console.log("11");
                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                        $('div[type="text"]').prop('disabled', true);
                                        $('input[type="text"]').prop('disabled', true);
                                        $('.business-add-address-btn').prop('disabled', true);
                                        $('#business-add-address-type-select-dropdown').prop('disabled', true);
                                        $('.mask').addClass('hide');
                                        $('input[type="tel"]').prop('disabled', true);
                                        $('.multimedia-upload').prop('disabled', true);
                                        $('.multimedia-save').prop('disabled', true);
                                        $('.add-identity-proof-btn').prop('disabled', true);
                                        $('.show-account-btn').prop('disabled', true);
                                        $('.setdefault-account-btn').prop('disabled', true);
                                        $('.add-storage-account').prop('disabled', true);
                                        // var businessType = $('.selected-value-business-type').attr('data-value');
                                        var businessType = response.business_type;
                                        //console.log("businessType", businessType);
                                        if (businessType == "sole_proprietorship") {
                                            //console.log("sole");
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-shop-established-license-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "partnership") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-partnership-deed-container').removeClass('hide');
                                            $('.business-add-partnership-registration-certificate-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "limited_liability_partnership") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-llp-registration-certificate-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "private_limited_company") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                                            $('.business-add-articles-of-association-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "public_limited_company") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                                            $('.business-add-articles-of-association-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "government_department") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                                            $('.business-add-articles-of-association-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "trusts_foundations") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            $('.business-add-trust-establishment-license-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "co_operative_society_associations") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-email-container').removeClass('hide');
                                            $('.business-add-address-container').removeClass('hide');
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-llp-registration-certificate-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else {
                                            //console.log("none is found");
                                        }
                                        //remove feild which dont have display permission
                                        if (ResponseResult.display_name == false) {
                                            $('.business-add-display-name-container').remove();
                                        }
                                        if (ResponseResult.tag_line == false) {
                                            $('.business-add-tag-line-container').remove();
                                        }
                                        if (ResponseResult.status_line == false) {
                                            $('.business-add-status-line-container').remove();
                                        }
                                        if (ResponseResult.business_type == false) {
                                            $('.business-type-container').remove();
                                        }
                                        if (ResponseResult.date_of_commencement == false) {
                                            $('.business-add-date-of-commencement-container').remove();
                                        }
                                        if (ResponseResult.date_of_incorporation == false) {
                                            $('.business-add-date-of-incorporation-container').remove();
                                        }
                                        if (ResponseResult.contact_name == false) {
                                            $('.business-add-contact-name-container').remove();
                                        }
                                        if (ResponseResult.alternate_contact_number == false) {
                                            $('.business-add-alternate-contact-number-container').remove();
                                        }
                                        if (ResponseResult.alternate_e_mail == false) {
                                            $('.business-add-alternate-email-container').remove();
                                        }
                                        if (ResponseResult.id_proofs == false) {
                                            $('.business-add-identity-proof-container').remove();
                                        }
                                        if (ResponseResult.pan_card_details == false) {
                                            $('.business-add-pancard-container').remove();
                                        }
                                        if (ResponseResult.shop_established_license == false) {
                                            $('.business-add-shop-established-license-container').remove();
                                        }
                                        if (ResponseResult.gst_details == false) {
                                            $('.business-add-gst-container').remove();
                                        }
                                        if (ResponseResult.partnership_deed == false) {
                                            $('.business-add-partnership-deed-container').remove();
                                        }
                                        if (ResponseResult.partnership_registration_certificate == false) {
                                            $('.business-add-partnership-registration-certificate-container').remove();
                                        }
                                        if (ResponseResult.llp_registration_certificate == false) {
                                            $('.business-add-llp-registration-certificate-container').remove();
                                        }
                                        if (ResponseResult.transaction_person == false) {
                                            $('.business-add-transaction-person-container').remove();
                                        }
                                        if (ResponseResult.memorandum_of_association == false) {
                                            $('.business-add-memorandum-of-association-container').remove();
                                        }
                                        if (ResponseResult.article_of_association == false) {
                                            $('.business-add-articles-of-association-container').remove();
                                        }
                                        if (ResponseResult.trust_foundation_established_licence == false) {
                                            $('.business-add-trust-establishment-license-container').remove();
                                        }
                                        //add all multimedia
                                        const IDProofstart = async () => {
                                            if (ResponseResult.id_proofs == true) {
                                                if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                                                    await asyncEach(response['id_proofs'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "identity-proof-load-btn");
                                                        $('.add-identity-proof-btn').remove();
                                                    });
                                                } else {
                                                    $('.business-add-identity-proof-wrapper').removeClass('hide');
                                                }
                                            }
                                        }
                                        IDProofstart();
                                        const PanCardstart = async () => {
                                            if (ResponseResult.pan_card_details == true) {
                                                if (response.pan_card_details !== undefined && response['pan_card_details']['pan_card_multimedia'].length > 0) {
                                                    $(`.multimedia-append-container[data-id="pancard-load-btn"]`).find(`.grid`).remove();
                                                    await asyncEach(response['pan_card_details']['pan_card_multimedia'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "pancard-load-btn");
                                                    });
                                                }
                                            }
                                        }
                                        PanCardstart();
                                        const ShopEstablishedLicencestart = async () => {
                                            if (ResponseResult.shop_established_license == true) {
                                                if (response.hasOwnProperty('shop_established_license') && response['shop_established_license'].length > 0) {
                                                    await asyncEach(response['shop_established_license'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "shop-established-license-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        ShopEstablishedLicencestart();
                                        const GSTstart = async () => {
                                            if (ResponseResult.gst_details == true) {
                                                if (response.gst_details !== undefined && response['gst_details']['gst_multimedia'].length > 0) {
                                                    $(`.multimedia-append-container[data-id="gst-license-load-btn"]`).find(`.grid`).remove();
                                                    await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "gst-license-load-btn");
                                                    });
                                                }
                                            }
                                        }
                                        GSTstart();
                                        const PartnershipDeedstart = async () => {
                                            if (ResponseResult.partnership_deed == true) {
                                                if (response.hasOwnProperty('partnership_deed') && response['partnership_deed'].length > 0) {
                                                    await asyncEach(response['partnership_deed'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "partnership-deed-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        PartnershipDeedstart();
                                        const PartnershipRegistrationCertificatestart = async () => {
                                            if (ResponseResult.partnership_registration_certificate == true) {
                                                if (response.hasOwnProperty('partnership_registration_certificate') && response['partnership_registration_certificate'].length > 0) {
                                                    await asyncEach(response['partnership_registration_certificate'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "partnership-registration-certificate-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        PartnershipRegistrationCertificatestart();
                                        const LLPRegistrationCertificatestart = async () => {
                                            if (ResponseResult.llp_registration_certificate == true) {
                                                if (response.hasOwnProperty('llp_registration_certificate') && response['llp_registration_certificate'].length > 0) {
                                                    await asyncEach(response['llp_registration_certificate'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "llp-registration-certificate-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        LLPRegistrationCertificatestart();
                                        const TransactionPersonstart = async () => {
                                            if (ResponseResult.transaction_person == true) {
                                                if (response.hasOwnProperty('transaction_person') && response['transaction_person'].length > 0) {
                                                    await asyncEach(response['transaction_person'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "transaction-person-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        TransactionPersonstart();
                                        const Memorandumstart = async () => {
                                            if (ResponseResult.memorandum_of_association == true) {
                                                if (response.hasOwnProperty('memorandum_of_association') && response['memorandum_of_association'].length > 0) {
                                                    await asyncEach(response['memorandum_of_association'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "memorandum-of-association-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        Memorandumstart();
                                        const articlesstart = async () => {
                                            if (ResponseResult.article_of_association == true) {
                                                if (response.hasOwnProperty('article_of_association') && response['article_of_association'].length > 0) {
                                                    await asyncEach(response['article_of_association'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "articles-of-association-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        articlesstart();
                                        const TrustLicencestart = async () => {
                                            if (ResponseResult.trust_foundation_established_licence == true) {
                                                if (response.hasOwnProperty('trust_foundation_established_licence') && response['trust_foundation_established_licence'].length > 0) {
                                                    await asyncEach(response['trust_foundation_established_licence'], async (e, index) => {
                                                        await getUploadedBusinessMultimedia(e, "trust-establishment-license-load-btn");
                                                    });
                                                } else {
                                                    //console.log("no length")
                                                }
                                            }
                                        }
                                        TrustLicencestart();
                                    }
                                    $('.add-identity-proof-btn').remove();
                                    $('.file-size').remove();//remove all multimedia files size
                                    removeLoader();
                                    resolve();
                                }, "page/business/view_business_profile", "#view-business-profile-template", "#main-content-wrapper", getBusiness);
                            })
                            .catch((err) => {
                                if (response.alternate_contact_number == "+91") {
                                    delete response.alternate_contact_number;
                                }
                                if (response.hasOwnProperty('date_of_commencement') && response.date_of_commencement) {
                                    var parts = response.date_of_commencement.split('/');
                                    var mydate = new Date(parts[2], parts[1] - 1, parts[0]);
                                    var getDateOfCommencement = mydate.toDateString();
                                    response.date_of_commencement = getDateOfCommencement;
                                }
                                if (response.hasOwnProperty('date_of_incorporation') && response.date_of_incorporation) {
                                    var parts = response.date_of_incorporation.split('/');
                                    var mydate = new Date(parts[2], parts[1] - 1, parts[0]);
                                    var getDateOfIncorporation = mydate.toDateString();
                                    response.date_of_incorporation = getDateOfIncorporation;
                                }
                                if (response.hasOwnProperty('display_picture') && response.display_picture) {
                                    if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                        response.display_picture['avtarUrl'] = avtarUrl;
                                    }
                                }
                                if (response.hasOwnProperty('display_video') && response.display_video) {
                                    if (response.display_video.hasOwnProperty('thumbnail') && response.display_video.thumbnail) {
                                        // var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.thumbnail}`;
                                        // response.display_video['avtarUrl'] = avtarUrl;
                                        var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_video.video_id}`;
                                        //console.log("avtarUrl", avtarUrl);
                                        response.display_video['avtarUrl'] = avtarUrl;
                                    }
                                }
                                var getBusiness = {
                                    businessTypes: result,
                                    getBusiness: response,
                                    getBusinessTypeId: response.business_type_id,
                                }
                                //console.log("getBusiness", getBusiness);
                                fetch.replaceHtml(function () {
                                    //dropdown show(common)
                                    // var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                                    // $('#business-type-choose-select-dropdown').val(getDropdownValue);
                                    // calenderInit('#business_date_of_commencement');
                                    // calenderInit('#business_date_of_incorporation');
                                    //check
                                    if (sessionStorage.getItem('digibiz_role') == "employee" || sessionStorage.getItem('digibiz_role') == "customer") {
                                        //console.log("11");
                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                        $('div[type="text"]').prop('disabled', true);
                                        $('input[type="text"]').prop('disabled', true);
                                        $('.business-add-address-btn').prop('disabled', true);
                                        $('#business-add-address-type-select-dropdown').prop('disabled', true);
                                        $('.mask').addClass('hide');
                                        $('input[type="tel"]').prop('disabled', true);
                                        $('.multimedia-upload').prop('disabled', true);
                                        $('.multimedia-save').prop('disabled', true);
                                        $('.add-identity-proof-btn').prop('disabled', true);
                                        $('.show-account-btn').prop('disabled', true);
                                        $('.setdefault-account-btn').prop('disabled', true);
                                        $('.add-storage-account').prop('disabled', true);
                                        // var businessType = $('.selected-value-business-type').attr('data-value');
                                        var businessType = response.business_type;
                                        //console.log("businessType", businessType);
                                        if (businessType == "sole_proprietorship") {
                                            //console.log("sole");
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-shop-established-license-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "partnership") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-partnership-deed-container').removeClass('hide');
                                            $('.business-add-partnership-registration-certificate-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "limited_liability_partnership") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-llp-registration-certificate-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "private_limited_company") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                                            $('.business-add-articles-of-association-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "public_limited_company") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                                            $('.business-add-articles-of-association-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "government_department") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-memorandum-of-association-container').removeClass('hide');
                                            $('.business-add-articles-of-association-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "trusts_foundations") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            $('.business-add-trust-establishment-license-container').removeClass('hide');
                                            removeLoader();
                                        } else if (businessType == "co_operative_society_associations") {
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-email-container').removeClass('hide');
                                            $('.business-add-address-container').removeClass('hide');
                                            $('.business-add-identity-proof-container').removeClass('hide');
                                            $('.business-add-pancard-container').removeClass('hide');
                                            $('.business-add-gst-container').removeClass('hide');
                                            $('.business-add-llp-registration-certificate-container').removeClass('hide');
                                            $('.business-add-transaction-person-container').removeClass('hide');
                                            removeLoader();
                                        } else {
                                            //console.log("none is found");
                                        }
                                        //remove feild which dont have display permission
                                        $('.business-add-display-name-container').remove();
                                        $('.business-type-container').remove();
                                        $('.business-add-tag-line-container').remove();
                                        $('.business-add-status-line-container').remove();
                                        $('.business-add-date-of-commencement-container').remove();

                                        $('.business-add-date-of-incorporation-container').remove();

                                        $('.business-add-contact-name-container').remove();

                                        $('.business-add-alternate-contact-number-container').remove();

                                        $('.business-add-alternate-email-container').remove();

                                        $('.business-add-identity-proof-container').remove();

                                        $('.business-add-pancard-container').remove();

                                        $('.business-add-shop-established-license-container').remove();

                                        $('.business-add-gst-container').remove();

                                        $('.business-add-partnership-deed-container').remove();

                                        $('.business-add-partnership-registration-certificate-container').remove();

                                        $('.business-add-llp-registration-certificate-container').remove();

                                        $('.business-add-transaction-person-container').remove();

                                        $('.business-add-memorandum-of-association-container').remove();

                                        $('.business-add-articles-of-association-container').remove();

                                        $('.business-add-trust-establishment-license-container').remove();
                                        //add all multimedia
                                        const IDProofstart = async () => {
                                            if (response.hasOwnProperty('id_proofs') && response['id_proofs'].length > 0) {
                                                await asyncEach(response['id_proofs'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "identity-proof-load-btn");
                                                    $('.add-identity-proof-btn').remove();
                                                });
                                            } else {
                                                $('.business-add-identity-proof-wrapper').removeClass('hide');
                                            }
                                        }
                                        IDProofstart();
                                        const PanCardstart = async () => {
                                            if (response.pan_card_details !== undefined && response['pan_card_details']['pan_card_multimedia'].length > 0) {
                                                $(`.multimedia-append-container[data-id="pancard-load-btn"]`).find(`.grid`).remove();
                                                await asyncEach(response['pan_card_details']['pan_card_multimedia'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "pancard-load-btn");
                                                });
                                            }
                                        }
                                        PanCardstart();
                                        const ShopEstablishedLicencestart = async () => {
                                            if (response.hasOwnProperty('shop_established_license') && response['shop_established_license'].length > 0) {
                                                await asyncEach(response['shop_established_license'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "shop-established-license-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        ShopEstablishedLicencestart();
                                        const GSTstart = async () => {
                                            if (response.gst_details !== undefined && response['gst_details']['gst_multimedia'].length > 0) {
                                                $(`.multimedia-append-container[data-id="gst-license-load-btn"]`).find(`.grid`).remove();
                                                await asyncEach(response['gst_details']['gst_multimedia'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "gst-license-load-btn");
                                                });
                                            }
                                        }
                                        GSTstart();
                                        const PartnershipDeedstart = async () => {
                                            if (response.hasOwnProperty('partnership_deed') && response['partnership_deed'].length > 0) {
                                                await asyncEach(response['partnership_deed'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "partnership-deed-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        PartnershipDeedstart();
                                        const PartnershipRegistrationCertificatestart = async () => {
                                            if (response.hasOwnProperty('partnership_registration_certificate') && response['partnership_registration_certificate'].length > 0) {
                                                await asyncEach(response['partnership_registration_certificate'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "partnership-registration-certificate-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        PartnershipRegistrationCertificatestart();
                                        const LLPRegistrationCertificatestart = async () => {
                                            if (response.hasOwnProperty('llp_registration_certificate') && response['llp_registration_certificate'].length > 0) {
                                                await asyncEach(response['llp_registration_certificate'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "llp-registration-certificate-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        LLPRegistrationCertificatestart();
                                        const TransactionPersonstart = async () => {
                                            if (response.hasOwnProperty('transaction_person') && response['transaction_person'].length > 0) {
                                                await asyncEach(response['transaction_person'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "transaction-person-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        TransactionPersonstart();
                                        const Memorandumstart = async () => {
                                            if (response.hasOwnProperty('memorandum_of_association') && response['memorandum_of_association'].length > 0) {
                                                await asyncEach(response['memorandum_of_association'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "memorandum-of-association-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        Memorandumstart();
                                        const articlesstart = async () => {
                                            if (response.hasOwnProperty('article_of_association') && response['article_of_association'].length > 0) {
                                                await asyncEach(response['article_of_association'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "articles-of-association-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        articlesstart();
                                        const TrustLicencestart = async () => {
                                            if (response.hasOwnProperty('trust_foundation_established_licence') && response['trust_foundation_established_licence'].length > 0) {
                                                await asyncEach(response['trust_foundation_established_licence'], async (e, index) => {
                                                    await getUploadedBusinessMultimedia(e, "trust-establishment-license-load-btn");
                                                });
                                            } else {
                                                //console.log("no length")
                                            }
                                        }
                                        TrustLicencestart();
                                    }
                                    $('.add-identity-proof-btn').remove();
                                    $('.file-size').remove();//remove all multimedia files size
                                    removeLoader();
                                    if ($('.business-main-container').length > 0) {
                                        appScroll.scrollBar('.business-main-container');
                                    }
                                    resolve();
                                }, "page/business/view_business_profile", "#view-business-profile-template", "#main-content-wrapper", getBusiness);
                            })
                    })
                    .catch((err) => {
                        removeLoader();
                        resolve();
                        Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                resolve();
                Materialize.toast("Error in getting business types", 3000, 'rounded error-alert');
            })
    })
}



function getFilemanagerAssets(parent = null, location) {
    return new Promise((resolve, reject) => {
        var requestParams = {
            device_id: crossplat.device.uuid,
            owner: {
                type: "individual",
                id: sessionStorage.getItem('user_id')
            },
            location: location,
            parent: parent,
            first_request: 'true',
            offset: 0,
            count: ''
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response);
            } else {
                reject(response);
            }
        }, api.core_get_assets, "POST", "JSON", requestParams);
    });
}

function showFilemanagerAssetsFilesList(data = null, callback) {
    if (data != null) {
        digibiz.cloudAssets = removeDuplicates(digibiz.cloudAssets.concat(data), 'id');
        sorteddata = sortData(digibiz.cloudAssets, 'name', 'asc');
        var parms = {
            assets: sorteddata
        }
    } else {
        var parms = null;
    }
    fetch.replaceHtml(function (error) {
        if (!error) {
            callback();
        }
    }, 'filemanager/cloud_files_list', '#filemanager-assets-list-template', '#filemanger-assets-list-wrapper', parms);
}

function sortData(data, attribute, order) {
    var sorted_files = [];
    var sorted_folders = [];
    $.each(data, function (index, value) {
        if (value.type === 'folder') {
            sorted_folders.push(value);
        } else if (value.type === 'file') {
            sorted_files.push(value);
        }
    });

    sorted_folders = sorted_folders.sort((a, b) => {
        return (a['file_attributes'][attribute]['relative'].localeCompare(b['file_attributes'][attribute]['relative']));
    });

    sorted_files = sorted_files.sort((a, b) => {
        return (a['file_attributes'][attribute]['relative'].localeCompare(b['file_attributes'][attribute]['relative']));
    });

    sorted_assets = sorted_folders.concat(sorted_files);
    return sorted_assets;
}

// function filemanagerNavigateToLocation(parent, location, callback) {
//     digibiz.cloudAssets = [];
//     getAssets(parent, location).then((response) => {
//         digibiz.cloudAssets = response.Data.assets;
//         showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
//             callback();
//         });
//     }).catch((err) => {
//         removeLoader();
//         Materialize.toast("No Assets found", 3000, 'error-alert');
//         showFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
//             callback();
//         });
//     })
// }


function filemanagerNavigateToLocation(parent, location, callback) {
    digibiz.cloudAssets = [];
    var requestParams = {
        device_id: crossplat.device.uuid,
        owner: {
            type: "individual",
            id: window.sessionStorage.getItem('user_id')
        },
        location: location,
        parent: parent,
        first_request: 'true',
        offset: 0,
        count: 20
    };
    getIndividualAssets(requestParams).then((assetsDetails) => {
        digibiz.cloudAssets = assetsDetails.Data.assets;
        showIndividualFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
            callback();
        })
    }).catch((err) => {
        //console.log('err', err);
        let res = JSON.parse(err.responseText);
        //console.log('res', res);
        if (res.message == "No assets found") {
            showIndividualFilemanagerAssetsFilesList(null, function () {
                callback();
            })
        }
    });
}


function digibizFilemanagerNavigateToLocation(parent, location, callback) {
    digibiz.cloudAssets = [];
    getDigibizAssets(parent, location).then((assetsDetails) => {
        digibiz.cloudAssets = assetsDetails.Data.assets;
        showDigibizFilemanagerAssetsFilesList(digibiz.cloudAssets, function () {
            callback();
        })
    }).catch((err) => {
        let res = JSON.parse(err.responseText);
        if (res.message == "No assets found") {
            showDigibizFilemanagerAssetsFilesList(null, function () {
                callback();
            })
        }
    });
}

// function getAssets(parent, location) {
//     return new Promise((resolve, reject) => {
//         var requestParams = {
//             device_id: crossplat.device.uuid,
//             owner: {
//                 type: "individual",
//                 id: sessionStorage.getItem("user_id")
//             },
//             location: 'personal_workspace',
//             parent: parent,
//             first_request: 'true',
//             offset: 0,
//             count: ''
//         };
//         fetch.apiCall(function (response, status, xhr) {
//             if (status === "success") {
//                 //console.log("response getAssets", response);
//                 resolve(response);
//             } else {
//                 reject();
//             }
//         }, api.core_get_assets, "POST", "JSON", requestParams);
//     });
// }

function setFilemanagerBreadcrumb(navigate) {
    let breadcrumb_path = JSON.parse(sessionStorage.getItem('filemanager_breadcrumb_path'));
    let temp_path = JSON.parse(sessionStorage.getItem('filemanager_breadcrumb_path'));
    let present = false;
    let index = 0;
    if (navigate.relative_name && navigate.real_name) {
        $.each(temp_path, function (i, val) {
            if (val.real_name == navigate.real_name) {
                present = true;
                index = i;
            }
        });
        if (present) {
            let arrlen = temp_path.length - 1;
            for (let j = arrlen; j > 0; j--) {
                if (j > index) {
                    breadcrumb_path.pop();
                }
            }
            sessionStorage.setItem('filemanager_breadcrumb_path', JSON.stringify(breadcrumb_path));
            digibiz.filemanager_breadcrumb_path = breadcrumb_path;
        } else {
            digibiz.filemanager_breadcrumb_path.push(navigate);
            sessionStorage.setItem('filemanager_breadcrumb_path', JSON.stringify(digibiz.filemanager_breadcrumb_path));
        }
    } else {
        sessionStorage.removeItem('filemanager_breadcrumb_path');
        digibiz.filemanager_breadcrumb_path = [];
    }
}

function getAssetDetailsCloud(asset_id) {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            owner: {
                type: "individual",
                id: sessionStorage.getItem('user_id')
            },
            asset_id: asset_id
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response.Data[0].data);
            } else {
                reject();
            }
        }, api.get_multi_media_info, "POST", "JSON", reqParams);
    });
}

/**
 * File Write APi
 */
function callWriteStorage(fileobj, data) {
    //console.log("callWriteStorage", fileobj);
    return new Promise((resolve, reject) => {
        var readerArrayBuffer = new FileReader;
        readerArrayBuffer.onloadend = function (evt) {
            var blob = new Blob([evt.target.result], { type: fileobj.type });

            //prepare form data
            var formData = new FormData();
            formData.append("file", blob);
            formData.append("userid", data.user_id);
            formData.append("business_id", sessionStorage.getItem('business_id'));
            formData.append("options", JSON.stringify(data.options));
            formData.append("type", blob.type);
            formData.append("totalSize", blob.size);

            formData.append("fileName", data.fileName);

            //TODO
            // if (blob.type == 'image/svg+xml') {
            //   formData.append("type", 'image/svg');
            // } else {
            //   formData.append("type", blob.type);
            // }

            //call api
            var xhr = new XMLHttpRequest();
            xhr.addEventListener('load', function (event) {
                if (event.target.status == 200) {
                    var response = JSON.parse(event.target.responseText);
                    resolve(response);
                } else if (event.target.status >= 400) {
                    reject(response);
                }
            }, false);
            xhr.open("POST", api.file_write, true);
            xhr.send(formData);
        }
        readerArrayBuffer.readAsArrayBuffer(fileobj);
    });
}

//getAssetDetails
async function getAssetDetails(requesParam) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response);
                } else {
                    reject("cannot get asset details");
                }
            },
            api.get_multi_media_info,
            "POST",
            "JSON",
            requesParam
        );
    });
}

function callStorageCopy(requestParams) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status === 'success') {
                resolve(response.Data);
            } else {
                // //console.log('response',response);
                reject(JSON.parse(response.responseText));
            }
        }, api.copy_multimedia, "POST", "JSON", requestParams);
    });
}

function storageRead(requestParams) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status === 'success') {
                resolve(response.Data);
            } else {
                // //console.log('response',response);
                reject(JSON.parse(response.responseText));
            }
        }, api.file_read, "POST", "JSON", requestParams);
    });
}

function getUploadedMultimedia(asset_id, getDataId) {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            owner: {
                type: "individual",
                id: getUserID()
            },
            asset_id: asset_id
        };
        getAssetDetails(reqParam)
            .then(async (asset_details) => {
                //console.log("asset_details", asset_details);
                var loadedfile = `<div class="grid uploaded-multimedia-files" data-type="file">
                                <div class="thumbnail-wrapper">
                                   <a class="">
                                      <div class="thumbnail"></div>
                                   </a>                     
                                </div>
                                <div class="file-details ellipsify" data-asset-id="${asset_id}">
                                   <div class="file-name">
                                      <a class="thumb-title">${asset_details.Data[0].data.file_attributes.name.relative}</a>
                                   </div>  
                                   <div class="file-size">
                                   <div class="thumb-meta">
                                      <span class="thumb-info">${asset_details.Data[0].data.file_attributes.size.filesize}</span>
                                   </div>
                                </div>                    
                                </div>
                                <div class="file-selected-remove-btn hide">
                                <i class="material-icons">cancel</i>
                            </div>
                             </div>`;
                //console.log("loadedfile", loadedfile);
                if (getDataId == "identity-proof-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "pancard-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "shop-established-license-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "gst-license-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "partnership-deed-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "partnership-registration-certificate-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "llp-registration-certificate-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "transaction-person-load-btn") {
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "memorandum-of-association-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "articles-of-association-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                } else if (getDataId == "trust-establishment-license-load-btn") {
                    //remove the selected multimedia file
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
                    $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
                }

                resolve(asset_details["Data"][0]["data"]);
            })
            .catch(err => {
                removeLoader();
                reject(err);
            });
    });
}

function getUploadedBusinessMultimedia(data, getDataId) {
    //console.log("getUploadedBusinessMultimedia", data)
    if (getDataId == "identity-proof-load-btn") {
        // var loadedfile = `<div class="business-add-identity-proof-wrapper">
        //                                     <div class="business-add-identity-proof-type-container">
        //                                         <div class="business-add-identity-proof-type-sub-container">
        //                                             <label for="business-add-identity-proof-type-select-dropdown">Select ID Type</label>
        //                                             <select id="business-add-identity-proof-type-select-dropdown" class="browser-default" disabled>
        //                                                 <option value="">--Select Type--</option>                                                    
        //                                                 <option value="aadhar-card">Aadhar Card</option>
        //                                                 <option value="driving-license">Driving License</option>
        //                                                 <option value="election-card">Election Card</option>
        //                                             </select>
        //                                         </div>
        //                                         <a class="waves-effect waves-light btn add-identity-proof-btn"><i class="material-icons">add</i></a>
        //                                     </div>                                            
        //                                     <div class="business-add-identity-proof-multimedia-wrapper multimedia-append-container" data-id="identity-proof-load-btn">
        //                                     <div class="grid uploaded-multimedia-files" data-type="file">
        //                         <div class="thumbnail-wrapper">
        //                            <a class="">
        //                               <div class="thumbnail"></div>
        //                            </a>                     
        //                         </div>
        //                         <div class="file-details ellipsify" data-image-id="${data.id_proof_multimedia.thumbnail}">
        //                            <div class="file-name">
        //                               <a class="thumb-title">${data.id_proof_multimedia.name}</a>
        //                            </div>  
        //                            <div class="file-size">
        //                            <div class="thumb-meta">
        //                               <span class="thumb-info">${data.id_proof_multimedia.size}</span>
        //                            </div>
        //                         </div>                    
        //                         </div>
        //                         <div class="file-selected-remove-btn hide">
        //                         <i class="material-icons">cancel</i>
        //                     </div>
        //                      </div>`;
        // $('.business-identity-proof-content-box').append(loadedfile);
        var getData = {
            id_proof: data
        };
        //console.log("getData", getData);
        // //console.log("$('body').attr('app')", $('body').attr('app'))
        // if ($('body').attr('app') == "view_business_profile") {
        if (sessionStorage.getItem('digibiz_role') == "employee" || sessionStorage.getItem('digibiz_role') == "customer") {
            //console.log("1234")
            fetch.appendHtml(function (err) {
                //console.log("***completed***")
                $('.add-identity-proof-btn').remove();
            }, 'layouts/popup/profile_identity_proof', '#profile-identity-proof-template', `.multimedia-append-container[data-id="${getDataId}"]`, getData);
        } else {
            fetch.appendHtml(function (err) {
                //console.log("completed***")
                $('.add-identity-proof-btn').remove();
            }, 'layouts/popup/added_identity_proof', '#added-identity-proof-template', '.business-identity-proof-content-box', getData);
        }
        $(`.file-details[data-image-id="${data.id_proof_multimedia.thumbnail}"]`).parents('.business-add-identity-proof-wrapper').find('#business-add-identity-proof-type-select-dropdown').find(`option[value="${data.id_proof_type}"]`).prop("selected", "selected");
    } else if (getDataId == "pancard-load-btn" || getDataId == "shop-established-license-load-btn" || getDataId == "gst-license-load-btn"
        || getDataId == "partnership-deed-load-btn" || getDataId == "partnership-registration-certificate-load-btn" || getDataId == "llp-registration-certificate-load-btn"
        || getDataId == "transaction-person-load-btn" || getDataId == "articles-of-association-load-btn" || getDataId == "memorandum-of-association-load-btn"
        || getDataId == "trust-establishment-license-load-btn") {

        if (data.download == "true" || data.download == true) {
            var loadedfile = `<div class="grid uploaded-multimedia-files" data-type="file">
                                <div class="thumbnail-wrapper">
                                   <a class="">
                                      <div class="thumbnail"></div>
                                   </a>                     
                                </div>
                                <div class="file-details ellipsify" data-image-id="${data.thumbnail}">
                                   <div class="file-name">
                                      <a class="thumb-title">${data.name}</a>
                                   </div>  
                                   <div class="file-size">
                                   <div class="thumb-meta">
                                      <span class="thumb-info">${bytesToSize(data.size)}</span>
                                   </div>                                   
                                    </div>  
                                    <div class="file-caption">
                                      <a class="thumb-caption">${data.caption}</a>
                                   </div>                  
                                </div>
                                <div class="file-selected-remove-btn hide">
                                <i class="material-icons">cancel</i>
                                </div>
                                <div class="more_vert_option_business_documents" id="more_vert_option_business_documents">
                                <i class="material-icons">more_vert</i>
                                </div>
                             </div>`;
            //remove the selected multimedia file        
            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
            $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
        } else {
            var loadedfile = `<div class="grid uploaded-multimedia-files" data-type="file">
                                <div class="thumbnail-wrapper">
                                   <a class="">
                                      <div class="thumbnail"></div>
                                   </a>                     
                                </div>
                                <div class="file-details ellipsify" data-image-id="${data.thumbnail}">
                                   <div class="file-name">
                                      <a class="thumb-title">${data.name}</a>
                                   </div>  
                                   <div class="file-size">
                                   <div class="thumb-meta">
                                      <span class="thumb-info">${bytesToSize(data.size)}</span>
                                   </div>                                   
                                    </div>  
                                    <div class="file-caption">
                                      <a class="thumb-caption">${data.caption}</a>
                                   </div>                  
                                </div>
                                <div class="file-selected-remove-btn hide">
                                <i class="material-icons">cancel</i>
                                </div>                                
                             </div>`;
            //remove the selected multimedia file        
            $(`.multimedia-append-container[data-id="${getDataId}"]`).find(`.selected-multimedia-files`).remove();
            $(`.multimedia-append-container[data-id="${getDataId}"]`).append(loadedfile);
        }

    }
}

function validateBusinessStepTwo() {
    let validateContactName = false;
    let validateContactNumber = false;
    let validateEmail = false;
    let validateBusinessAddress = false;
    let validateMinOneAddress = false;
    let validateDateOfCommencement = false;
    let validateDateOfIncorporation = false;
    //validate Date of commencement
    if ($('#business_date_of_commencement').val().trim().length > 0) {
        validateDateOfCommencement = false;
    } else {
        validateDateOfCommencement = true;
        showError($('#business_date_of_commencement'), `This field is required`);
    }
    //validate Date of incorporation
    if ($('#business_date_of_incorporation').val().trim().length > 0) {
        validateDateOfIncorporation = false;
    } else {
        validateDateOfIncorporation = true;
        showError($('#business_date_of_incorporation'), `This field is required`);
    }
    //validate contact name
    if ($('#business_contact_name').text().trim().length > 0) {
        if ($('#business_contact_name').text().trim().length < config.businessContactNameMinLength) {
            showError($('#business_contact_name'), `This field should contain atleast ${config.businessContactNameMinLength} characters.`);
            validateContactName = true;
        }
        if ($('#business_contact_name').text().trim().length > config.businessContactNameMaxLength) {
            showError($('#business_contact_name'), `This field can't have more than  ${config.businessContactNameMaxLength} characters.`);
            validateContactName = true;
        }
        if ($('#business_contact_name').text().trim().length >= config.businessContactNameMinLength && $('#business_contact_name').text().trim().length <= config.businessContactNameMaxLength) {
            validateContactName = false;
        }
    } else {
        showError($('#business_contact_name'), "This field is required");
        validateContactName = true;
    }
    //validate contact number
    if ($('#business_contact_number').val().length > 0) {
        if (!validate.checkIfIntelValidPhoneNumber($('#business_contact_number'))) {
            showError($('#business_contact_number'), "Invalid Number");
            validateContactNumber = true;
        }
    } else {
        showError($('#business_contact_number'), "This field is required");
        validateContactNumber = true;
    }
    //validate email(optional)
    if ($('#business_email').text().trim().length > 0) {
        if (!validate.checkIfValidEmail($('#business_email').text())) {
            showError($('#business_email'), "Invalid Email");
            validateEmail = true;
        }
    }
    // else {
    //     showError($('#business_email'), "");
    //     validateEmail = true;
    // }
    //validate business address(one address is mandatory)
    if ($('.address_text_box').length > 0) {
        var addressArray = [];
        var addressMinOneArray = [];
        var getAddressBoxes = $('.address_text_box');
        $.each(getAddressBoxes, function (index, address) {
            //check if address type and address box 
            if ($(address).parents('.business-add-address-wrapper').find('.selected-value-business-address').attr('data-value') == "" && $(address).text().trim().length == 0) {//both are empty
                addressArray.push(false);
                showError($(address), `This field is required`);
                showError($(address).parents('.business-add-address-wrapper').find('.selected-value-business-address'), `This field is required`)
            } else if ($(address).parents('.business-add-address-wrapper').find('.selected-value-business-address').attr('data-value') != "" && $(address).text().trim().length == 0) {//dropdown is present and address box is empty
                addressArray.push(true);
                showError($(address), `This field is required`);
            } else if ($(address).parents('.business-add-address-wrapper').find('.selected-value-business-address').attr('data-value') == "" && $(address).text().trim().length != 0) {//dropdown is empty and address box present
                addressArray.push(true);
                showError($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown'), `This field is required`)
            } else if ($(address).parents('.business-add-address-wrapper').find('.selected-value-business-address').attr('data-value') != "" && $(address).text().trim().length != 0) {//both are present
                if ($(address).text().trim().length < config.businessAddressLengthMin) {
                    showError($(address), `This field should contain atleast ${config.businessAddressLengthMin} characters.`);
                    addressArray.push(true);
                }
                if ($(address).text().trim().length > config.businessAddressLengthMax) {
                    showError($(address), `This field can't have more than  ${config.businessAddressLengthMax} characters.`);
                    addressArray.push(true);
                }
                if ($(address).text().trim().length >= config.businessAddressLengthMin && $(address).text().trim().length <= config.businessAddressLengthMax) {
                    addressArray.push(false);
                    addressMinOneArray.push(false);
                }
            }
        })
        let checker = addressArray.every(v => v === false);
        //console.log("checker", checker);
        if (checker == true) {
            validateBusinessAddress = false;
        } else {
            validateBusinessAddress = true;
        }
        if (addressMinOneArray.length > 0) {
            validateMinOneAddress = false;
        } else {
            Materialize.toast(`Minimum 1 address is required`, 3000, 'round success-alert');
            validateMinOneAddress = true;
        }
    }
    // if ($('.address_text_box').length > 0) {
    //     var addressArray = [];
    //     var addressMinOneArray = [];
    //     var getAddressBoxes = $('.address_text_box');
    //     $.each(getAddressBoxes, function (index, address) {
    //         //check if address type and address box 
    //         if ($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown').val() == "" && $(address).text().trim().length == 0) {//both are empty
    //             addressArray.push(false);
    //             showError($(address), `This field is required`);
    //             showError($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown'), `This field is required`)
    //         } else if ($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown').val() != "" && $(address).text().trim().length == 0) {//dropdown is present and address box is empty
    //             addressArray.push(true);
    //             showError($(address), `This field is required`);
    //         } else if ($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown').val() == "" && $(address).text().trim().length != 0) {//dropdown is empty and address box present
    //             addressArray.push(true);
    //             showError($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown'), `This field is required`)
    //         } else if ($(address).parents('.business-add-address-wrapper').find('#business-add-address-type-select-dropdown').val() != "" && $(address).text().trim().length != 0) {//both are present
    //             if ($(address).text().trim().length < config.businessAddressLengthMin) {
    //                 showError($(address), `This field should contain atleast ${config.businessAddressLengthMin} characters.`);
    //                 addressArray.push(true);
    //             }
    //             if ($(address).text().trim().length > config.businessAddressLengthMax) {
    //                 showError($(address), `This field can't have more than  ${config.businessAddressLengthMax} characters.`);
    //                 addressArray.push(true);
    //             }
    //             if ($(address).text().trim().length >= config.businessAddressLengthMin && $(address).text().trim().length <= config.businessAddressLengthMax) {
    //                 addressArray.push(false);
    //                 addressMinOneArray.push(false);
    //             }
    //         }
    //     })
    //     let checker = addressArray.every(v => v === false);
    //     //console.log("checker", checker);
    //     if (checker == true) {
    //         validateBusinessAddress = false;
    //     } else {
    //         validateBusinessAddress = true;
    //     }
    //     if (addressMinOneArray.length > 0) {
    //         validateMinOneAddress = false;
    //     } else {
    //         Materialize.toast(`Minimum 1 address is required`, 3000, 'round success-alert');
    //         validateMinOneAddress = true;
    //     }
    // }
    //console.log("check", validateEmail, validateBusinessAddress);
    if (validateContactName || validateContactNumber || validateEmail || validateBusinessAddress || validateMinOneAddress || validateDateOfCommencement || validateDateOfIncorporation) {
        return false;
    } else {
        return true;
    }
}

function validateBusinessStepOne() {
    let validateBusinessName = false;
    let validateBusinessDisplayName = false;
    let validateBusinessType = false;
    let validateBusinessTagLine = false;
    let validateBusinessStatusLine = false;
    // var businessType = $('#business-type-choose-select-dropdown');
    var businessName = $('#business_name');
    var businessDisplayName = $('#business_display_name');
    var businessTagLine = $('#business_tag_line');
    var businessStatusLine = $('#business_status_line');
    //validate business name
    if ($(businessName).text().trim().length > 0) {
        if ($(businessName).text().trim().length < config.businessNameMinLength) {
            showError($(businessName), `This field should contain atleast ${config.businessNameMinLength} characters.`);
            validateBusinessName = true;
        }
        if ($(businessName).text().trim().length > config.busniessNameMaxLength) {
            showError($(businessName), `This field can't have more than  ${config.busniessNameMaxLength} characters.`);
            validateBusinessName = true;
        }
        if ($(businessName).text().trim().length >= config.businessNameMinLength && $(businessName).text().trim().length <= config.busniessNameMaxLength) {
            validateBusinessName = false;
        }
    } else {
        showError($(businessName), `This field is required.`);
        validateBusinessName = true;
    }
    //validate business display name
    if ($(businessDisplayName).text().trim().length > 0) {
        if ($(businessDisplayName).text().trim().length < config.businessDisplayNameMinLength) {
            showError($(businessDisplayName), `This field should contain atleast ${config.businessDisplayNameMinLength} characters.`);
            validateBusinessDisplayName = true;
        }
        if ($(businessDisplayName).text().trim().length > config.busniessDisplayNameMaxLength) {
            showError($(businessDisplayName), `This field can't have more than  ${config.busniessDisplayNameMaxLength} characters.`);
            validateBusinessDisplayName = true;
        }
        if ($(businessDisplayName).text().trim().length >= config.businessDisplayNameMinLength && $(businessDisplayName).text().trim().length <= config.busniessDisplayNameMaxLength) {
            //check if the string has space character
            if (/\s/.test($(businessDisplayName).text().trim())) {
                //console.log("Space is there");
                showError($(businessDisplayName), `This field can't have space between characters.`);
                validateBusinessDisplayName = true;
            } else {
                //console.log("Space is not there");
                //check if all characters are alphanumeric and special characters only
                if (/^[A-Za-z0-9_!$^*()@./#&%+-]+$/.test($(businessDisplayName).text().trim())) {
                    //console.log("Correct");
                    //check if the first character of the string is not a special character
                    var getString = $(businessDisplayName).text().trim();
                    //console.log("getString", getString);
                    var getFirstLetter = getString.charAt(0);
                    //console.log("getFirstLetter", getFirstLetter);
                    //console.log("type of getFirstLetter", typeof getFirstLetter)
                    if (/^[a-zA-Z0-9]+$/.test(getFirstLetter)) {
                        //console.log("letter,number")
                        validateBusinessDisplayName = false;
                    } else {
                        //console.log("first character is a speacial character");
                        showError($(businessDisplayName), `First character can't be a special character.`);
                        validateBusinessDisplayName = true;
                    }
                } else {
                    //console.log("Wrong");
                    showError($(businessDisplayName), `This field can contain only letters, numbers and special characters.`);
                    validateBusinessDisplayName = true;
                }
            }
        }
    } else {
        showError($(businessDisplayName), `This field is required.`);
        validateBusinessDisplayName = true;
    }
    //validate business tag line
    if ($(businessTagLine).text().trim().length > 0) {
        if ($(businessTagLine).text().trim().length < config.businessTagMinLength) {
            showError($(businessTagLine), `This field should contain atleast ${config.businessTagMinLength} characters.`);
            validateBusinessTagLine = true;
        }
        if ($(businessTagLine).text().trim().length > config.businessTagMaxLength) {
            showError($(businessTagLine), `This field can't have more than  ${config.businessTagMaxLength} characters.`);
            validateBusinessTagLine = true;
        }
        if ($(businessTagLine).text().trim().length >= config.businessTagMinLength && $(businessStatusLine).text().trim().length <= config.businessTagMaxLength) {
            validateBusinessTagLine = false;
        }
    }
    //validate business status line
    if ($(businessStatusLine).text().trim().length > 0) {
        if ($(businessStatusLine).text().trim().length < config.businessStatusLineMinLength) {
            showError($(businessStatusLine), `This field should contain atleast ${config.businessStatusLineMinLength} characters.`);
            validateBusinessStatusLine = true;
        }
        if ($(businessStatusLine).text().trim().length > config.businessStatusLineMaxLength) {
            showError($(businessStatusLine), `This field can't have more than  ${config.businessStatusLineMaxLength} characters.`);
            validateBusinessStatusLine = true;
        }
        if ($(businessStatusLine).text().trim().length >= config.businessStatusLineMinLength && $(businessStatusLine).text().trim().length <= config.businessStatusLineMaxLength) {
            validateBusinessStatusLine = false;
        }
    }
    //validate business type
    // if ($(businessType).val().length > 0) {
    //     validateBusinessType = false;
    // } else {
    //     showError($(businessType), `This field is required.`);
    //     validateBusinessType = true;
    // }
    if ($('.selected-value-business-type').attr('data-value').length > 0) {
        validateBusinessType = false;
    } else {
        showError($('.selected-value-business-type'), `This field is required.`);
        validateBusinessType = true;
    }
    if (validateBusinessName || validateBusinessDisplayName || validateBusinessType || validateBusinessTagLine || validateBusinessStatusLine) {
        return false;
    } else {
        return true;
    }

}

function validateBusinessStepThree(response) {
    //console.log("validateBusinessStepThree", response);
    let validateIdProof = false;
    let validatePanCard = false;
    let validateGst = false;
    let validateShopEstablishedLicence = false;
    let validatePartnershipDeed = false;
    let validatePartnershipRegistrationCertificate = false;
    let validateLLPRegistrationCertificate = false;
    let validateTransactionPerson = false;
    let validateMemorandum = false;
    let validateArticles = false;
    let validateTrustLicence = false;

    // var reqParam = {
    //     device_id: crossplat.device.uuid,
    //     id: sessionStorage.getItem('business_id')
    // }
    // businessGet(reqParam)
    //     .then((response) => {
    //         //console.log("businessGet", response);
    // var businessType = $('#business-type-choose-select-dropdown').val();
    var businessType = $('.selected-value-business-type').attr('data-value');
    //console.log("businessType", businessType);
    if (businessType == "sole_proprietorship") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //shop established lience
        if (response.shop_established_license !== undefined) {
            if (response.shop_established_license.length > 0) {
                validateShopEstablishedLicence = false;
            } else {
                validateShopEstablishedLicence = true;
                Materialize.toast("Please attach Shop Established Licence", 3000, 'rounded error-alert');
            }
        } else {
            validateShopEstablishedLicence = true;
            Materialize.toast("Please check Shop Established Licence field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "partnership") {
        //id proof
        if (response.id_proofs !== undefined) {
            // //console.log("11");
            if (response.id_proofs.length > 0) {
                // //console.log("22");
                validateIdProof = false;
            } else {
                // //console.log("33");
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            // //console.log("44");
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            // //console.log("55");
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                // //console.log("77s");
                validatePanCard = false;
            } else {
                // //console.log("88");
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            // //console.log("66");
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            // //console.log("99");
            if (response.gst_details.gst_multimedia.length > 0) {
                // //console.log("1010");
                validateGst = false;
            } else {
                // //console.log("1111");
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            // //console.log("1212");
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        //partnership deed
        if (response.partnership_deed !== undefined) {
            // //console.log("1313");
            // if (Object.keys(response['partnership_deed']['partnership_deed_multimedia']).length > 0) {
            //     //console.log("1515");
            //     validatePartnershipDeed = false;
            // } else {
            //     //console.log("1616");
            //     validatePartnershipDeed = true;
            //     Materialize.toast("Please attach Partnership deed", 3000, 'rounded error-alert');
            // }
            if (response.partnership_deed.length > 0) {
                // //console.log("1515");
                validatePartnershipDeed = false;
            } else {
                // //console.log("1616");
                validatePartnershipDeed = true;
                Materialize.toast("Please attach Partnership deed", 3000, 'rounded error-alert');
            }
        } else {
            // //console.log("1414");
            validatePartnershipDeed = true;
            Materialize.toast("Please check partnership deed field", 3000, 'rounded error-alert');
        }
        //partnership registration certificate
        if (response.hasOwnProperty('partnership_registration_certificate')) {
            // //console.log("1717");
            // if (Object.keys(response['partnership_registration_certificate']['partnership_registration_certificate_multimedia']).length > 0) {
            //     //console.log("1818");
            //     validatePartnershipRegistrationCertificate = false;
            // } else {
            //     //console.log("1919");
            //     validatePartnershipRegistrationCertificate = true;
            //     Materialize.toast("Please attach Partnership Registration certificate", 3000, 'rounded error-alert');
            // }
            if (response.partnership_registration_certificate.length > 0) {
                // //console.log("1818");
                validatePartnershipRegistrationCertificate = false;
            } else {
                // //console.log("1919");
                validatePartnershipRegistrationCertificate = true;
                Materialize.toast("Please attach Partnership Registration certificate", 3000, 'rounded error-alert');
            }
        } else {
            // //console.log("2020");
            validatePartnershipRegistrationCertificate = true;
            Materialize.toast("Please check Partnership Registration certificate field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "limited_liability_partnership") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        //LLP
        if (response.hasOwnProperty('llp_registration_certificate')) {
            // if (Object.keys(response['llp_registration_certificate']['llp_registration_certificate_multimedia']).length > 0) {
            //     validateLLPRegistrationCertificate = false;
            // } else {
            //     validateLLPRegistrationCertificate = true;
            //     Materialize.toast("Please attach LLP registration certificate", 3000, 'rounded error-alert');
            // }
            if (response.llp_registration_certificate.length > 0) {
                validateLLPRegistrationCertificate = false;
            } else {
                validateLLPRegistrationCertificate = true;
                Materialize.toast("Please attach LLP registration certificate", 3000, 'rounded error-alert');
            }
        } else {
            validateLLPRegistrationCertificate = true;
            Materialize.toast("Please check LLP registration certigicate field", 3000, 'rounded error-alert');
        }
        //transaction person
        if (response.hasOwnProperty('transaction_person')) {
            // if (Object.keys(response['transaction_person']['transaction_person_multimedia']).length > 0) {
            //     validateTransactionPerson = false;
            // } else {
            //     validateTransactionPerson = true;
            //     Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            // }
            if (response.transaction_person.length > 0) {
                validateTransactionPerson = false;
            } else {
                validateTransactionPerson = true;
                Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            }
        } else {
            validateTransactionPerson = true;
            Materialize.toast("Please check Transaction person field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "private_limited_company") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        //transaction person
        if (response.hasOwnProperty('transaction_person')) {
            if (response.transaction_person.length > 0) {
                validateTransactionPerson = false;
            } else {
                validateTransactionPerson = true;
                Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            }
        } else {
            validateTransactionPerson = true;
            Materialize.toast("Please check Transaction person field", 3000, 'rounded error-alert');
        }
        //memorandum
        if (response.hasOwnProperty('memorandum_of_association')) {
            // if (Object.keys(response['memorandum_of_association']['memorandum_of_association_multimedia']).length > 0) {
            //     validateMemorandum = false;
            // } else {
            //     validateMemorandum = true;
            //     Materialize.toast("Please attach memorandum of association", 3000, 'rounded error-alert');
            // }
            if (response.memorandum_of_association.length > 0) {
                validateMemorandum = false;
            } else {
                validateMemorandum = true;
                Materialize.toast("Please attach memorandum of association", 3000, 'rounded error-alert');
            }
        } else {
            validateMemorandum = true;
            Materialize.toast("Please check memorandum of association field", 3000, 'rounded error-alert');
        }
        //articles
        if (response.hasOwnProperty('article_of_association')) {
            // if (Object.keys(response['article_of_association']['article_of_association_multimedia']).length > 0) {
            //     validateArticles = false;
            // } else {
            //     validateArticles = true;
            //     Materialize.toast("Please attach articles of association", 3000, 'rounded error-alert');
            // }
            if (response.article_of_association.length > 0) {
                validateArticles = false;
            } else {
                validateArticles = true;
                Materialize.toast("Please attach articles of association", 3000, 'rounded error-alert');
            }
        } else {
            validateArticles = true;
            Materialize.toast("Please check articles of association field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "public_limited_company") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        //transaction person
        if (response.hasOwnProperty('transaction_person')) {
            if (response.transaction_person.length > 0) {
                validateTransactionPerson = false;
            } else {
                validateTransactionPerson = true;
                Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            }
        } else {
            validateTransactionPerson = true;
            Materialize.toast("Please check Transaction person field", 3000, 'rounded error-alert');
        }
        //memorandum
        if (response.hasOwnProperty('memorandum_of_association')) {
            // if (Object.keys(response['memorandum_of_association']['memorandum_of_association_multimedia']).length > 0) {
            //     validateMemorandum = false;
            // } else {
            //     validateMemorandum = true;
            //     Materialize.toast("Please attach memorandum of association", 3000, 'rounded error-alert');
            // }
            if (response.memorandum_of_association.length > 0) {
                validateMemorandum = false;
            } else {
                validateMemorandum = true;
                Materialize.toast("Please attach memorandum of association", 3000, 'rounded error-alert');
            }
        } else {
            validateMemorandum = true;
            Materialize.toast("Please check memorandum of association field", 3000, 'rounded error-alert');
        }
        //articles
        if (response.hasOwnProperty('article_of_association')) {
            // if (Object.keys(response['article_of_association']['article_of_association_multimedia']).length > 0) {
            //     validateArticles = false;
            // } else {
            //     validateArticles = true;
            //     Materialize.toast("Please attach articles of association", 3000, 'rounded error-alert');
            // }
            if (response.article_of_association.length > 0) {
                validateArticles = false;
            } else {
                validateArticles = true;
                Materialize.toast("Please attach articles of association", 3000, 'rounded error-alert');
            }
        } else {
            validateArticles = true;
            Materialize.toast("Please check articles of association field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "government_department") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        //transaction person
        if (response.hasOwnProperty('transaction_person')) {
            if (response.transaction_person.length > 0) {
                validateTransactionPerson = false;
            } else {
                validateTransactionPerson = true;
                Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            }
        } else {
            validateTransactionPerson = true;
            Materialize.toast("Please check Transaction person field", 3000, 'rounded error-alert');
        }
        //memorandum
        if (response.hasOwnProperty('memorandum_of_association')) {
            // if (Object.keys(response['memorandum_of_association']['memorandum_of_association_multimedia']).length > 0) {
            //     validateMemorandum = false;
            // } else {
            //     validateMemorandum = true;
            //     Materialize.toast("Please attach memorandum of association", 3000, 'rounded error-alert');
            // }
            if (response.memorandum_of_association.length > 0) {
                validateMemorandum = false;
            } else {
                validateMemorandum = true;
                Materialize.toast("Please attach memorandum of association", 3000, 'rounded error-alert');
            }
        } else {
            validateMemorandum = true;
            Materialize.toast("Please check memorandum of association field", 3000, 'rounded error-alert');
        }
        //articles
        if (response.hasOwnProperty('article_of_association')) {
            // if (Object.keys(response['article_of_association']['article_of_association_multimedia']).length > 0) {
            //     validateArticles = false;
            // } else {
            //     validateArticles = true;
            //     Materialize.toast("Please attach articles of association", 3000, 'rounded error-alert');
            // }
            if (response.article_of_association.length > 0) {
                validateArticles = false;
            } else {
                validateArticles = true;
                Materialize.toast("Please attach articles of association", 3000, 'rounded error-alert');
            }
        } else {
            validateArticles = true;
            Materialize.toast("Please check articles of association field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "trusts_foundations") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        //transaction person
        if (response.hasOwnProperty('transaction_person')) {
            if (response.transaction_person.length > 0) {
                validateTransactionPerson = false;
            } else {
                validateTransactionPerson = true;
                Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            }
        } else {
            validateTransactionPerson = true;
            Materialize.toast("Please check Transaction person field", 3000, 'rounded error-alert');
        }
        //trust
        if (response.hasOwnProperty('trust_foundation_established_licence')) {
            // if (Object.keys(response['trust_foundation_established_licence']['trust_foundation_established_licence_multimedia']).length > 0) {
            //     validateTrustLicence = false;
            // } else {
            //     validateTrustLicence = true;
            //     Materialize.toast("Please attach Trust Establishment License person", 3000, 'rounded error-alert');
            // }
            if (response.trust_foundation_established_licence.length > 0) {
                validateTrustLicence = false;
            } else {
                validateTrustLicence = true;
                Materialize.toast("Please attach Trust Establishment License person", 3000, 'rounded error-alert');
            }
        } else {
            validateTrustLicence = true;
            Materialize.toast("Please check Establishment License field", 3000, 'rounded error-alert');
        }
    } else if (businessType == "co_operative_society_associations") {
        //id proof
        if (response.id_proofs !== undefined) {
            if (response.id_proofs.length > 0) {
                validateIdProof = false;
            } else {
                validateIdProof = true;
                Materialize.toast("Please attach ID proof", 3000, 'rounded error-alert');
            }
        } else {
            validateIdProof = true;
            Materialize.toast("Please check ID proof field", 3000, 'rounded error-alert');
        }
        //pan card
        if (response.pan_card_details !== undefined) {
            if (response.pan_card_details.pan_card_multimedia.length > 0) {
                validatePanCard = false;
            } else {
                validatePanCard = true;
                Materialize.toast("Please attach Pan card", 3000, 'rounded error-alert');
            }
        } else {
            validatePanCard = true;
            Materialize.toast("Please check Pan Card field", 3000, 'rounded error-alert');
        }
        //GST
        if (response.gst_details !== undefined) {
            if (response.gst_details.gst_multimedia.length > 0) {
                validateGst = false;
            } else {
                validateGst = true;
                Materialize.toast("Please attach GST", 3000, 'rounded error-alert');
            }
        } else {
            validateGst = true;
            Materialize.toast("Please check GST field", 3000, 'rounded error-alert');
        }
        if (response.hasOwnProperty('transaction_person')) {
            if (response.transaction_person.length > 0) {
                validateTransactionPerson = false;
            } else {
                validateTransactionPerson = true;
                Materialize.toast("Please attach Transaction person", 3000, 'rounded error-alert');
            }
        } else {
            validateTransactionPerson = true;
            Materialize.toast("Please check Transaction person field", 3000, 'rounded error-alert');
        }
    }
    if ($('#business_pancard').length > 0) {
        if ($('#business_pancard').text().trim().length <= 0) {
            validatePanCard = true;
            showError($('#business_pancard'), `This field is required`);
        } else if ($('#business_pancard').text().trim().length <= 2) {
            validatePanCard = true;
            showError($('#business_pancard'), `This field should contain atleast 3 characters`);
        }
    }
    if ($('#business_gst_license').length > 0) {
        if ($('#business_gst_license').text().trim().length <= 0) {
            validateGst = true;
            showError($('#business_gst_license'), `This field is required`);
        } else if ($('#business_gst_license').text().trim().length <= 2) {
            validateGst = true;
            showError($('#business_gst_license'), `This field should contain atleast 3 characters`);
        }
    }
    //console.log("123456", validateIdProof, validatePanCard, validateGst, validateShopEstablishedLicence, validatePartnershipDeed, validatePartnershipRegistrationCertificate, validateLLPRegistrationCertificate, validateTransactionPerson, validateMemorandum, validateArticles, validateTrustLicence);
    if (validateIdProof || validatePanCard || validateGst || validateShopEstablishedLicence || validatePartnershipDeed || validatePartnershipRegistrationCertificate || validateLLPRegistrationCertificate || validateTransactionPerson || validateMemorandum || validateArticles || validateTrustLicence) {
        //console.log("returning false");
        return false;
    } else {
        //console.log("returning true");
        return true;
    }
}

function validateBusinessStepFour(response) {
    //console.log("validateBusinessStepFour", response);
    let validateTransactionPicture = false;
    let validateSignaturePicture = false;
    let validateVideo = false;
    if (response.declaration_transaction_pictures !== undefined) {
        validateTransactionPicture = false;
    } else {
        validateTransactionPicture = true;
        Materialize.toast("Please add transaction picture.", 3000, 'rounded error-alert');
    }
    if (response.declaration_signature_pictures !== undefined) {
        validateSignaturePicture = false;
    } else {
        validateSignaturePicture = true;
        Materialize.toast("Please add signature picture.", 3000, 'rounded error-alert');
    }
    if (response.declaration_video !== undefined) {
        validateVideo = false;
    } else {
        validateVideo = true;
        Materialize.toast("Please add video.", 3000, 'rounded error-alert');
    }
    if (validateTransactionPicture || validateSignaturePicture || validateVideo) {
        return false;
    } else {
        return true;
    }
}

function validateBeforeAttachement() {
    let validateFieldNumber = false;
    let validateDropdown = false; //used in id_proof
    var getField = sessionStorage.getItem('multimedia_upload_data_id');
    if (getField == "identity-proof-load-btn") {
        // if ($('#identity_proof_text_box').text().length <= 0) {
        //     validateFieldNumber = true;
        //     showError($('#identity_proof_text_box'), `This field is required`);
        // }
        if ($('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find('.selected-value-business-identity-proof-type').attr('data-value').length <= 0) {
            validateDropdown = true;
            showError($('.multimedia-upload.active').parents('.business-add-identity-proof-wrapper').find('#business-add-identity-proof-type-select-dropdown'), `This field is required`);
        }
    } else if (getField == "pancard-load-btn") {
        if ($('#business_pancard').text().trim().length <= 0) {
            validateFieldNumber = true;
            showError($('#business_pancard'), `This field is required`);
        } else if ($('#business_pancard').text().trim().length <= 2) {
            validateFieldNumber = true;
            showError($('#business_pancard'), `This field should contain atleast 3 characters`);
        }
    } else if (getField == "gst-license-load-btn") {
        if ($('#business_gst_license').text().trim().length <= 0) {
            validateFieldNumber = true;
            showError($('#business_gst_license'), `This field is required`);
        } else if ($('#business_gst_license').text().trim().length <= 2) {
            validateFieldNumber = true;
            showError($('#business_gst_license'), `This field should contain atleast 3 characters`);
        }
    }

    if (validateFieldNumber || validateDropdown) {
        return false;
    } else {
        return true;
    }
}

function validateBeforeSave(getField) {
    let validateFieldNumber = false;
    let validateDropdown = false; //used in id_proof
    let validateMultimediaUpload = false;
    let validateMmCaption = false;
    var caption = $('#upload-preview-container-text-box');
    //validate caption
    if ($(caption).text().trim().length > 0) {
        if ($(caption).text().trim().length < config.multimediaCaptionMinLength) {
            showError($(caption), `This field should contain atleast ${config.multimediaCaptionMinLength} characters.`);
            validateMmCaption = true;
        }
        if ($(caption).text().trim().length > config.multimediaCaptionMaxLength) {
            showError($(caption), `This field can't have more than  ${config.multimediaCaptionMaxLength} characters.`);
            validateMmCaption = true;
        }
        if ($(caption).text().trim().length >= config.multimediaCaptionMinLength && $(caption).text().trim().length <= config.multimediaCaptionMaxLength) {
            validateMmCaption = false;
        }
    }
    if (getField == "identity-proof-load-btn") {
        // if ($('#identity_proof_text_box').text().length <= 0) {
        //     validateFieldNumber = true;
        //     showError($('#identity_proof_text_box'), `This field is required`);
        // }
        if ($('.selected-value-business-identity-proof-type').attr('data-value').length <= 0) {
            validateDropdown = true;
            showError($('#business-add-identity-proof-type-select-dropdown'), `This field is required`);
        }
        //console.log("!@#", digibiz.cloud_multimedia_selected_files.length, digibiz.device_multimedia_selected_files.length)
        if (digibiz.cloud_multimedia_selected_files.length > 0 || digibiz.device_multimedia_selected_files.length > 0) {
            //console.log("11");
            validateMultimediaUpload = false;
        } else {
            //console.log("2");
            Materialize.toast(`Please attach ID Proof`, 3000, 'round success-alert');
            validateMultimediaUpload = true;
        }
    } else if (getField == "pancard-load-btn") {
        if ($('#business_pancard').text().length <= 0) {
            validateFieldNumber = true;
            showError($('#business_pancard'), `This field is required`);
        }
        if (digibiz.cloud_multimedia_selected_files.length > 0 || digibiz.device_multimedia_selected_files.length > 0) {
            validateMultimediaUpload = false;
        } else {
            Materialize.toast(`Please attach PanCard`, 3000, 'round success-alert');
            validateMultimediaUpload = true;
        }
    } else if (getField == "shop-established-license-load-btn") {
        if (digibiz.cloud_multimedia_selected_files.length > 0 || digibiz.device_multimedia_selected_files.length > 0) {
            validateMultimediaUpload = false;
        } else {
            Materialize.toast(`Please attach Shop Established Licence`, 3000, 'round success-alert');
            validateMultimediaUpload = true;
        }
    } else if (getField == "gst-license-load-btn") {
        if ($('#business_gst_license').text().length <= 0) {
            validateFieldNumber = true;
            showError($('#business_gst_license'), `This field is required`);
        }
        if (digibiz.cloud_multimedia_selected_files.length > 0 || digibiz.device_multimedia_selected_files.length > 0) {
            validateMultimediaUpload = false;
        } else {
            Materialize.toast(`Please attach PanCard`, 3000, 'round success-alert');
            validateMultimediaUpload = true;
        }
    }
    //console.log("!@#$%^&*()", validateFieldNumber, validateDropdown, validateMultimediaUpload)
    if (validateFieldNumber || validateDropdown || validateMultimediaUpload || validateMmCaption) {
        //console.log("returning false");
        return false;
    } else {
        //console.log("returning true");
        return true;
    }

}


/*******************************BUSINESS MANAGEMENT(ends)******************************/

function startSession(asset_id, type, callback) {
    file_info(asset_id, function (file) {
        let requestParams = {
            device_id: crossplat.device.uuid,
            location: file.location,
            parent: file.parent,
            owner: {
                type: "individual",
                id: file.owner.id
            },
            real_name: file.file_attributes.name.real
        }
        // if (issue_id != null) {
        //     requestParams.source = {
        //         "app": "Digipal",
        //         "data": {
        //             id: issue_id,
        //             user_id: sessionStorage.getItem('individual_id')
        //         }
        //     }
        // } else {
        requestParams.source = {
            "app": "Digibiz",
            "data": {
                id: (!sessionStorage.getItem('current_share_id')) ? null : sessionStorage.getItem('current_share_id'),
                user_id: sessionStorage.getItem('user_id')
            }
        }
        // }
        var API_URL = (type == 'download') ? api.core_chunk_download : api.core_chunk_view_by_file
        fetch.apiCall(function (response, status, xhr) {
            if (status === 'success') {
                response.Data['fileType'] = file.file_attributes.file_type;
                callback(null, response.Data);
            } else {
                var errorRes = JSON.parse(response.responseText);
                if (type == 'download') {
                    Materialize.toast(errorRes.error, 3000, 'error-alert');
                    callback(errorRes.error);
                } else {
                    Materialize.toast(errorRes.error.msg, 3000, 'error-alert');
                    callback(errorRes.error.msg);
                }
            }
        }, API_URL, "POST", "JSON", requestParams);
    });
}

/**
 * Get File info
 */
function file_info(asset_id, callback) {
    // if (digibiz.viewerAssets.find(e => e.id == asset_id)) {
    //     callback(digibiz.viewerAssets.find(e => e.id == asset_id));
    // } else {
    let requestParams = {
        device_id: crossplat.device.uuid,
        asset_id: asset_id
    }
    fetch.apiCall(function (response, status, xhr) {
        if (status === 'success') {
            callback(response.Data[0].data);
        } else {
            var errorRes = JSON.parse(xhr.responseText);
        }
    }, api.core_asset_details, "POST", "JSON", requestParams);
    // }
}

function dataURLToBlob(dataURL) {
    var BASE64_MARKER = ';base64,';

    if (dataURL.indexOf(BASE64_MARKER) == -1) {
        var parts = dataURL.split(',');
        var contentType = parts[0].split(':')[1];
        var raw = decodeURIComponent(parts[1]);

        return new Blob([raw], { type: contentType });
    }

    var parts = dataURL.split(BASE64_MARKER);
    var contentType = parts[0].split(':')[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;

    var uInt8Array = new Uint8Array(rawLength);

    for (var i = 0; i < rawLength; ++i) {
        uInt8Array[i] = raw.charCodeAt(i);
    }

    return new Blob([uInt8Array], { type: contentType });
}

function getTransaction_Signature_Pictures(reqParam) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response);
                //console.log("direct response.data", response);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_profile, "POST", "JSON", reqParam);
    });
}

function validateTransactionPictures() {
    let validate_transactional_picture_flag = false;
    if (digibiz.transactional_picture.hasOwnProperty('image_id')) {
        validate_transactional_picture_flag = false;
    } else {
        validate_transactional_picture_flag = true;
    }
    if (validate_transactional_picture_flag) {
        return false;
    } else {
        return true;
    }
}

function validateSignaturePictures() {
    let validate_signature_picture_flag = false;
    if (digibiz.signature_picture.hasOwnProperty('image_id')) {
        validate_signature_picture_flag = false;
    } else {
        validate_signature_picture_flag = true;
    }
    if (validate_signature_picture_flag) {
        return false;
    } else {
        return true;
    }
}

/**
* Route Name : storeIdentityPic
* Description: stores the identity pic savebusinessDisplayPicture
*/
function storeIdentityPic(fileSrc, type) {
    return new Promise((resolve, reject) => {
        var fileContent = fileSrc;
        var fileSize = Math.round((fileContent.length * 6) / 8);
        var fileType = "image/png";
        var fileData = {};
        if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create") {
            if ($('#customerGroupName').length > 0) {
                fileData = {
                    name: `${$('#customerGroupName').val()}_${sessionStorage.getItem('group_id')}`,
                    size: fileSize,
                    type: fileType
                    //  location: "DJ"
                };
            } else if ($('#employeeGroupName').length > 0) {
                fileData = {
                    name: `${$('#employeeGroupName').val()}`,
                    size: fileSize,
                    type: fileType
                    //  location: "DJ"
                };
            }
        } else if (sessionStorage.getItem('customer_id')) {
            if ($('#edit-associate-customer-modal').length > 0) {
                fileData = {
                    name: $('#edit-associate-customer-modal').attr('data-associate-customer-id'),
                    size: fileSize,
                    type: fileType
                    //  location: "DJ"
                };
            } else {
                fileData = {
                    name: `${sessionStorage.getItem('customer_id')}`,
                    size: fileSize,
                    type: fileType
                    //  location: "DJ"
                };
            }
        } else if (sessionStorage.getItem('business_id')) {
            var getStep = $('.bussines-forward-btn').attr('data-present-step');
            if (getStep == "2" || getStep == 2) {
                fileData = {
                    name: `${sessionStorage.getItem('business_id')}`,
                    size: fileSize,
                    type: fileType
                    //  location: "DJ"
                };
            } else {
                fileData = {
                    name: `${sessionStorage.getItem('business_id')}_declaration_${type}`,
                    size: fileSize,
                    type: fileType
                    //  location: "DJ"
                };
            }
        } else if (sessionStorage.getItem('employee_id')) { //employee identity picture
            fileData = {
                name: `${sessionStorage.getItem('employee_id')}`,
                size: fileSize,
                type: fileType
                //  location: "DJ"
            };
        }
        checkDriveStatus()
            .then(() => {
                (async function () {
                    data = callWriteStorageFrontEnd(fileData, fileContent, getUserID());
                })();
                data
                    .then(response => {
                        resolve(response);
                    })
                    .catch(err => {
                        reject(err);
                    });
            })
            .catch(err => {
                reject(err);
            });
    });
}

/**
 * Route Name : checkDriveStatus
 * Description: check wheather the drive is active
 */
function checkDriveStatus() {
    return new Promise((resolve, reject) => {
        let requestParms = {
            device_id: crossplat.device.uuid,
            selected: true
        };
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response);
                } else {
                    reject(JSON.parse(response.responseText));
                }
            },
            api.check_drive_status,
            "POST",
            "JSON",
            requestParms
        );
    });
}

//IMAGE type file storing in storage /write API
async function callWriteStorageFrontEnd(filedata, content, userid) {
    return new Promise((resolve, reject) => {
        // var cardInfoFromSession = JSON.parse(sessionStorage.getItem("cardInfo"));
        var ext = '';
        if (filedata.name.includes('.')) {
            ext = filedata.name.split('.').pop();
        } else {
            ext = filedata.type.split("/").pop();
            if (ext == 'svg+xml') {
                ext = 'svg';
            }
        }
        var requestParams = {};
        if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create") {
            requestParams = {
                content: content,
                options: {
                    encryption: "true",
                    level: "1",
                    filemanager: {
                        device_id: crossplat.device.uuid,
                        owner: {
                            type: "individual",
                            id: getUserID()
                        },
                        app: "digibiz",
                        type: "file",
                        extension: ext,
                        file_data: {
                            name: filedata.name,
                            size: filedata.size,
                            type: filedata.type
                        },
                        access_type: "system",
                        file: {
                            permission: "read",
                            keywords: "group image upload"
                        }
                    }
                },
                userid: userid
            };
        } else if (sessionStorage.getItem('customer_id')) {
            if ($('#edit-associate-customer-modal').length > 0) {
                requestParams = {
                    content: content,
                    options: {
                        encryption: "true",
                        level: "1",
                        filemanager: {
                            device_id: crossplat.device.uuid,
                            owner: {
                                type: "individual",
                                id: getUserID()
                            },
                            app: "digibiz",
                            type: "file",
                            extension: ext,
                            file_data: {
                                name: filedata.name,
                                size: filedata.size,
                                type: filedata.type
                            },
                            access_type: "system",
                            file: {
                                permission: "read",
                                keywords: "customer identity picture upload"
                            }
                        }
                    },
                    userid: userid
                };
            } else {
                requestParams = {
                    content: content,
                    options: {
                        encryption: "true",
                        level: "1",
                        filemanager: {
                            device_id: crossplat.device.uuid,
                            owner: {
                                type: "individual",
                                id: getUserID()
                            },
                            app: "digibiz",
                            type: "file",
                            extension: ext,
                            file_data: {
                                name: filedata.name,
                                size: filedata.size,
                                type: filedata.type
                            },
                            access_type: "system",
                            file: {
                                permission: "read",
                                keywords: "customer identity picture upload"
                            }
                        }
                    },
                    userid: userid
                };
            }
        } else if (sessionStorage.getItem('business_id')) {
            var getStep = $('.bussines-forward-btn').attr('data-present-step');
            if (getStep == "2" || getStep == 2) {
                requestParams = {
                    content: content,
                    options: {
                        encryption: "true",
                        level: "1",
                        filemanager: {
                            device_id: crossplat.device.uuid,
                            owner: {
                                type: "individual",
                                id: getUserID()
                            },
                            app: "digibiz",
                            type: "file",
                            extension: ext,
                            file_data: {
                                name: filedata.name,
                                size: filedata.size,
                                type: filedata.type
                            },
                            access_type: "system",
                            file: {
                                permission: "read",
                                keywords: "digibiz business declaration multimedia upload"
                            }
                        }
                    },
                    userid: userid
                };
            } else {
                requestParams = {
                    content: content,
                    options: {
                        encryption: "true",
                        level: "1",
                        filemanager: {
                            device_id: crossplat.device.uuid,
                            owner: {
                                type: "individual",
                                id: getUserID()
                            },
                            app: "digibiz",
                            type: "file",
                            extension: ext,
                            file_data: {
                                name: filedata.name,
                                size: filedata.size,
                                type: filedata.type
                            },
                            access_type: "system",
                            file: {
                                permission: "read",
                                keywords: "digibiz business display picture multimedia upload"
                            }
                        }
                    },
                    userid: userid
                };
            }
        } else if (sessionStorage.getItem('employee_id')) {//employee identity picture
            requestParams = {
                content: content,
                options: {
                    encryption: "true",
                    level: "1",
                    filemanager: {
                        device_id: crossplat.device.uuid,
                        owner: {
                            type: "individual",
                            id: getUserID()
                        },
                        app: "digibiz",
                        type: "file",
                        extension: ext,
                        file_data: {
                            name: filedata.name,
                            size: filedata.size,
                            type: filedata.type
                        },
                        access_type: "system",
                        file: {
                            permission: "read",
                            keywords: "employee identity picture upload"
                        }
                    }
                },
                userid: userid
            };
        }
        //adding "DJ" location for identity Pic,card thumbnail and identity video
        if (filedata.hasOwnProperty("location") && filedata.location) {
            requestParams["location"] = filedata.location;
        }
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response);
                } else {
                    reject(JSON.parse(response.responseText));
                }
            },
            api.store_file,//writes to core asset
            "POST",
            "JSON",
            requestParams
        );
    });
}

/**
 * Route Name : getIdentityPicInfo
 * Description: get identity video info from assets
 */
function getIdentityPicInfo(asset_id) {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            owner: {
                type: "individual",
                id: getUserID()
            },
            asset_id: asset_id
        };
        getAssetDetails(reqParam)
            .then(asset_details => {
                resolve(asset_details["Data"][0]["data"]);
            })
            .catch(err => {
                reject(err);
            });
    });
}

//getAssetDetails
async function getAssetDetails(requesParam) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response);
                } else {
                    reject(JSON.parse(response.responseText));
                }
            },
            api.get_multi_media_info,
            "POST",
            "JSON",
            requesParam
        );
    });
}

/**
 * Route Name : getViewMultimediaUrl
 * Description: get details to view multimedia
 */
function getViewMultimediaUrl(assetParams) {
    return new Promise((resolve, reject) => {
        checkDriveStatus()
            .then(() => {
                fetch.apiCall(
                    function (response, status, xhr) {
                        if (status == "success") {
                            resolve(response);
                        } else {
                            var err = JSON.parse(response.responseText);
                            reject(err);
                        }
                    },
                    api.view_multimedia_asset,
                    "POST",
                    "JSON",
                    assetParams
                );
            })
            .catch(err => {
                reject(err);
            });
    });
}

// function viewFile(file_name, data, callback) {
//     supported_types = ["mpeg", "webm", "mp4", "png", "jpeg", "jpg", "pdf", "mp3", "gif", "svg", "tif", "tiff", "bmp", "ogg", "apng", "bmp", "svg+xml", "ogv"];
//     if (supported_types.includes(data.extension.toLowerCase())) {
//         let content;
//         if (data.file_type == "image") {
//             content = '<img src= "' + data.url + '">';
//         } else if (data.file_type == "video") {
//             content = '<video id="video_control" width="700" height="400" controls controlsList="nodownload" autoplay><source src="' + data.url + '" ></video>';
//         } else if (data.file_type == "audio") {
//             content = '<audio id="audio_control" autoplay controls controlsList="nodownload" src="' + data.url + '"';
//         } else if (data.file_type == "application") {
//             if (data.extension == "pdf") {
//                 //content = '<object width="700" height="400" download=false data="' + data + '"></object>';
//                 urlParms = data.url.split("/").pop();
//                 content = `<iframe src="https://pdfviewer.digitaljeevi.com/#/${urlParms}/true" width="100%" height="100%" frameborder="0">`;
//             } else {
//                 content = '<div>Viewer does not support this file format. Please download the file and use appropriate viewer to read the file. <div class="message-save-icn"></div> </div>';
//             }
//         }
//         var viewer_data = {
//             viewer_id: "file-preview-popup",
//             viewer_file_id: null,
//             viewer_mime_type: data.file_type,
//             asset_content: content
//         };
//         if (file_name == "identity_audio" || file_name == "identity_picture" || file_name == "identity_video" || file_name == "brand_asset") {
//             viewer_data["viewer_title"] = "";
//         } else {
//             viewer_data["viewer_title"] = file_name;
//         }
//         showFileViewer(viewer_data, function () {
//             removeLoader();
//             callback();
//         });
//     } else {
//         removeLoader();
//         Materialize.toast("Unsupported File", 3000, "rounded error-alert");
//         callback();
//     }
// }

//preview multimedia popup window

/**
 * View File
 */
// function viewFile(file_type, extension, data) {
//     return new Promise((resolve, reject) => {
//         supported_types = ['webm', 'mp4', 'png', 'jpeg', 'jpg', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx'];
//         if (extension != undefined) {
//             if (supported_types.includes(extension.toLowerCase())) {
//                 let content;
//                 if (file_type == 'image') {
//                     content = '<img class="preview-file" src= "' + data + '">';
//                 } else if (file_type == 'video') {
//                     content = '<video class="preview-file" id="video_control" width="700" height="400" controls controlsList="nodownload"><source src="' + data + '" ></video>';
//                 } else if (file_type == 'audio') {
//                     content = '<audio id="audio_control" controls controlsList="nodownload" src="' + data + '"></audio>';
//                 } else if (file_type == 'application') {
//                     if (extension == "pdf") {
//                         if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
//                             urlParms = data.split('/').pop();
//                             content = `<iframe src="https://pdfviewer.digitaljeevi.com/#/${urlParms}/true" width="100%" height="100%" frameborder="0">`;
//                         } else {
//                             content = '<object width="700" height="400" download=false data="' + data + '">No Preview</object>';
//                         }

//                     } else {
//                         content = '<div class="unsupported_file_message">Viewer does not support this file format. Please download the file and use appropriate viewer to read the file. <div class="message-save-icn">Download</div> </div>';
//                     }
//                 }
//                 resolve(content);
//             } else {
//                 var index = digibiz.uploadingFiles.findIndex(e => e.fileURI == data);
//                 if (digibiz.uploadingFiles[index].file.file_attributes) {
//                     // $('#upload-preview-close-btn').click();
//                     Materialize.toast("Unsupported File " + digibiz.uploadingFiles[index].file.file_attributes.name.relative, 3000, 'rounded error-alert');
//                 } else {
//                     Materialize.toast("Unsupported File " + digibiz.uploadingFiles[index].file.name, 3000, 'rounded error-alert');
//                 }
//                 if (data) {
//                     if (index != -1) {
//                         if ($('.upload-footer-attached-files-list').find(`[data-identifier = "${digibiz.uploadingFiles[index].identifier}"]`).length > 0) {
//                             $('.upload-footer-attached-files-list').find(`[data-identifier = "${digibiz.uploadingFiles[index].identifier}"]`).remove();
//                             delete uploader._files[digibiz.uploadingFiles[index].identifier];
//                             digibiz.uploadingFiles = digibiz.uploadingFiles.filter(e => e.fileURI != data);

//                         }

//                     }
//                 }
//                 reject();
//             }
//         } else {
//             Materialize.toast("There is no file from your assets", 3000, 'rounded error-alert');
//             reject();
//         }

//     });
// }


/**
 * View File
 */
function viewFile(file_type, extension, data) {
    //console.log('view', file_type, extension);
    //console.log('data', data);
    return new Promise((resolve, reject) => {
        // var uploadType = $('#upload-footer-send-btn').attr('data-uploadtype');
        var uploadType = $(".upload-preview-common-layout#upload-preview-wrapper").find('#upload-footer-send-btn-common').attr('data-uploadtype');
        supported_types = ['webm', 'mp4', 'quicktime', 'png', 'jpeg', 'jpg', 'PDF', 'pdf', 'mp3', 'gif', 'svg', 'tif', 'tiff', 'bmp', 'ogg', 'apng', 'bmp', 'svg+xml', 'ogv', 'aac', '3gpp', 'odt', 'doc', 'docx', 'xls', 'xlsx', 'ppt', 'pptx', 'txt', 'text'];
        if (extension != undefined) {
            //console.log("1")
            if (supported_types.includes(extension.toLowerCase())) {
                //console.log("2")
                let content;
                if (file_type == 'image') {
                    content = '<img class="preview-file" src= "' + data + '">';
                } else if (file_type == 'video') {
                    content = '<video class="preview-file" id="video_control" width="700" height="400" controls controlsList="nodownload"><source src="' + data + '" ></video>';
                } else if (file_type == 'audio') {
                    content = '<audio id="audio_control" controls controlsList="nodownload" src="' + data + '"></audio>';
                } else if (file_type == 'application') {
                    //console.log("application")
                    if (extension == "pdf" || extension == "PDF") {
                        //console.log("pdf")
                        if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                            urlParms = data.split('/').pop();
                            if (uploadType && uploadType == "filemanager") {
                                $('.pdf-view').addClass('hide');
                                $('#upload-file-preview').removeClass('hide');
                                // content = `<iframe src="https://pdfviewer.staging.digitaljeevi.com/#/${urlParms}/true" width="100%" height="100%" frameborder="0">`;
                                content = `<iframe src="${config['web']['pdfviewer']}/#/${urlParms}/true/digibiz/${app.env}" width="100%" height="100%" frameborder="0">`;
                            } else {
                                //PDF JS
                                if (uploadType && uploadType == "device") {
                                    var canvas = document.getElementById('the-canvas');
                                    const context = canvas.getContext('2d');
                                    context.clearRect(0, 0, canvas.width, canvas.height);
                                    let loadingTask = pdfjsLib.getDocument(data);
                                    loadingTask.promise.then(async function (pdf) {
                                        pdfPreViewer(data, 'abc', function () { });
                                    }).catch((err) => {
                                        if (err) {
                                            removeLoader();
                                            if (err.name == "PasswordException") {
                                                Materialize.toast(`${ele.name} is password protected`, 3000, 'rounded error-alert');
                                            }
                                        }
                                    })

                                    // content = '<object width="700" height="400" download=false data="' + data + '">No Preview</object>';
                                    // content = '<div class="unsupported_file_message">Viewer does not support this file.</div>';
                                } else {
                                    $('.pdf-view').addClass('hide');
                                    $('#upload-file-preview').removeClass('hide');
                                    urlParms = data.split('/').pop();
                                    // content = `<iframe src="https://pdfviewer.digitaljeevi.com/#/${urlParms}/true" width="100%" height="100%" frameborder="0">`;
                                    content = `<iframe src="${config['web']['pdfviewer']}/#/${urlParms}/true/digibiz/${app.env}" width="100%" height="100%" frameborder="0">`;
                                    // content = '<object width="700" height="400" download=false data="' + data + '">No Preview</object>';
                                }
                            }
                        } else {
                            //console.log("not android and ios");
                            //PDF JS
                            if (uploadType && uploadType == "device") {
                                //console.log("it is device");
                                var canvas = document.getElementById('the-canvas');
                                //console.log("canvas");
                                const context = canvas.getContext('2d');
                                context.clearRect(0, 0, canvas.width, canvas.height);
                                let loadingTask = pdfjsLib.getDocument(data);
                                loadingTask.promise.then(async function (pdf) {
                                    pdfPreViewer(data, 'abc', function () {
                                        //console.log("YASS");
                                    });
                                }).catch((err) => {
                                    if (err) {
                                        removeLoader();
                                        if (err.name == "PasswordException") {
                                            Materialize.toast(`${ele.name} is password protected`, 3000, 'rounded error-alert');
                                        }
                                    }
                                })
                            } else {
                                //console.log("it is cloud");
                                $('.pdf-view').addClass('hide');
                                $('#upload-file-preview').removeClass('hide');
                                urlParms = data.split('/').pop();
                                // content = `<iframe src="https://pdfviewer.staging.digitaljeevi.com/#/${urlParms}/true" width="100%" height="100%" frameborder="0">`;
                                content = `<iframe src="${config['web']['pdfviewer']}/#/${urlParms}/true/digibiz/${app.env}" width="100%" height="100%" frameborder="0">`;
                                // content = '<object width="700" height="400" download=false data="' + data + '">No Preview</object>';
                            }
                        }
                    } else {
                        content = '<div class="unsupported_file_message">Viewer does not support this file format. Please download the file and use appropriate viewer to read the file. <div class="message-save-icn">Download</div> </div>';
                    }
                }
                resolve(content);
            } else {
                var index = digibiz.uploadingFiles.findIndex(e => e.fileURI == data);
                if (digibiz.uploadingFiles[index].file.file_attributes) {
                    // $('#upload-preview-close-btn').click();
                    Materialize.toast("Unsupported File " + digibiz.uploadingFiles[index].file.file_attributes.name.relative, 3000, 'rounded error-alert');
                } else {
                    Materialize.toast("Unsupported File " + digibiz.uploadingFiles[index].file.name, 3000, 'rounded error-alert');
                }
                if (data) {
                    if (index != -1) {
                        if ($('.upload-footer-attached-files-list').find(`[data-identifier = "${digibiz.uploadingFiles[index].identifier}"]`).length > 0) {
                            $('.upload-footer-attached-files-list').find(`[data-identifier = "${digibiz.uploadingFiles[index].identifier}"]`).remove();
                            delete uploader._files[digibiz.uploadingFiles[index].identifier];
                            digibiz.uploadingFiles = digibiz.uploadingFiles.filter(e => e.fileURI != data);

                        }

                    }
                }
                reject();
            }
        } else {
            Materialize.toast("There is no file from your assets", 3000, 'rounded error-alert');
            reject();
        }

    });
}

async function pdfPreViewer(url, filename, callback) {
    //console.log("pdfPreViewer", url, filename)
    // fetch.appendHtml(function (error) {
    pdfViewerData.pdfDoc = null;
    pdfViewerData.pageNum = 1;
    pdfViewerData.pageRendering = false;
    pdfViewerData.pageNumPending = null;
    pdfViewerData.scale = 1.2;
    pdfViewerData.canvas = document.getElementById('the-canvas');
    pdfViewerData.ctx = pdfViewerData.canvas.getContext('2d');


    document.getElementById('prev').addEventListener('click', onPrevPage);
    document.getElementById('next').addEventListener('click', onNextPage);
    loadPdf(url, function () { });
    removeLoader();
    callback();
    // }, 'page/pdf_previewer', '#pdf-previewer-template', '.create-pdf-container', null);
}


/**
 * Asynchronously downloads PDF.
 */
function loadPdf(url) {
    //console.log("loadPdf", url);
    pdfjsLib.getDocument(url).promise.then(function (pdfDoc_) {
        pdfViewerData.pdfDoc = pdfDoc_;
        document.getElementById('page_count').textContent = pdfViewerData.pdfDoc.numPages;

        // Initial/first page rendering
        renderPage(pdfViewerData.pageNum);
    });
}


function renderPage(num) {
    //console.log("renderPage", num);
    pageRendering = true;
    // Using promise to fetch the page
    pdfViewerData.pdfDoc.getPage(num).then(function (page) {
        //console.log("page", page);
        var viewport = page.getViewport({ scale: pdfViewerData.scale });
        pdfViewerData.canvas.height = viewport.height;
        pdfViewerData.canvas.width = viewport.width;
        pdfViewerData.canvas.font = "16px";
        // Render PDF page into canvas context
        var renderContext = {
            canvasContext: pdfViewerData.ctx,
            viewport: viewport
        };
        //console.log("renderContext", renderContext);
        var renderTask = page.render(renderContext);

        // Wait for rendering to finish
        renderTask.promise.then(function () {
            pdfViewerData.pageRendering = false;
            if (pdfViewerData.pageNumPending !== null) {
                // New page rendering is pending
                renderPage(pdfViewerData.pageNumPending);
                pdfViewerData.pageNumPending = null;
            }
        });
    });

    // Update page counters
    document.getElementById('page_num').textContent = num;



}

/**
 * If another page rendering in progress, waits until the rendering is
 * finised. Otherwise, executes rendering immediately.
 */
function queueRenderPage(num) {
    if (pdfViewerData.pageRendering) {
        pdfViewerData.pageNumPending = num;
    } else {
        renderPage(num);
    }
}

/**
 * Displays previous page.
 */
function onPrevPage() {
    if (pdfViewerData.pageNum <= 1) {
        return;
    }
    pdfViewerData.pageNum--;
    queueRenderPage(pdfViewerData.pageNum);
}

/**
 * Displays next page.
 */
function onNextPage() {
    if (pdfViewerData.pageNum >= pdfViewerData.pdfDoc.numPages) {
        return;
    }
    pdfViewerData.pageNum++;
    queueRenderPage(pdfViewerData.pageNum);
}

function showFileViewer(data, callback) {
    $(".asset-viewer-container").remove();
    fetch.appendHtml(
        function (err) {
            callback();
        },
        "components/file_viewer",
        "#file-viewer-template",
        "#app-root",
        data
    );
}

function callApi(readerEvent, blob) {
    // console.log("inside callApi", readerEvent.target.result, "blobbb", blob)
    // var profileDetails = JSON.parse(sessionStorage.getItem('profile_details'));
    // var name = profileDetails.individual.name.first + ' ' + profileDetails.individual.name.last;
    generateThubnail(readerEvent.target.result, 'base64').then(async function (thubnailContent) {
        console.log("got thumbail contant", thubnailContent);
        if (sessionStorage.getItem('customer_id')) {
            if ($('#edit-associate-customer-modal').length > 0) {
                var fileObj = {
                    // file: files[0],
                    identifier: (new Date()).getTime(),
                    fileURI: URL.createObjectURL(blob),
                    file_type: "video",
                    // file_name: files[0].name,
                    file_content_base64: readerEvent.target.result,
                    thubnail: thubnailContent
                }
                digibiz.fileObject = fileObj;
                console.log("digibiz.fileObject", digibiz.fileObject);
                saveAssociateCustomerIdentityVideoThumbnail(digibiz.fileObject.thubnail, function (err, associateCustomerIdentityVideoThumbnail) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        //passing base 64 content
                        saveAssociateCustomerIdentityVideo(digibiz.fileObject.file_content_base64, associateCustomerIdentityVideoThumbnail, function (err, associateCustomerIdentityVideo) {
                            if (err) {
                                removeLoader();
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            } else {
                                //console.log("associateCustomerIdentityVideo", associateCustomerIdentityVideo);
                                if (associateCustomerIdentityVideo.hasOwnProperty('thumbnail') && associateCustomerIdentityVideo.thumbnail) {
                                    var associateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id')
                                    var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${associateCustomerId}&device_id=${crossplat.device.uuid}&image_id=${associateCustomerIdentityVideo.thumbnail}`;
                                    $('#associate_customer_identity_video').attr("src", avtarUrl);
                                    //remove +
                                    $('.associate-customer-identity-video-multimedia-load-btn').remove();
                                    //remove delete
                                    $('#associate-customer-identity-video-delete').remove();
                                    $('.associate-customer-add-identity-video-container').find('.mask').removeClass('hide');
                                    //append photo_camera first and then delete
                                    $('#associate_customer_identity_video').siblings('.mask').append(`<a class="associate_customer_identity_video_preview" data-thumbnail-id="${associateCustomerIdentityVideo.thumbnail}" data-video-id="${associateCustomerIdentityVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                    $('#associate_customer_identity_video').siblings('.mask').append(`<a class="info associate-customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="associate-customer-identity-video-load-btn" data-thumbnail-id="${associateCustomerIdentityVideo.thumbnail}" data-video-id="${associateCustomerIdentityVideo.video_id}">photo_camera</i></a>`);
                                    $('#associate_customer_identity_video').siblings('.mask').append(`<a class="info associate_customer-identity-video-delete-btn cursor_pointer"><i class="material-icons" id="associate_customer-identity-video-delete" data-thumbnail-id="${associateCustomerIdentityVideo.thumbnail}" data-video-id="${associateCustomerIdentityVideo.video_id}">delete</i></a>`);
                                    $('#identity-video-modal').remove();
                                    digibiz.fileObject = {};
                                    digibiz.objectURLS = [];
                                    removeLoader();
                                }
                            }
                        })
                    }
                });
            } else {
                var fileObj = {
                    // file: files[0],
                    identifier: (new Date()).getTime(),
                    fileURI: URL.createObjectURL(blob),
                    file_type: "video",
                    // file_name: files[0].name,
                    file_content_base64: readerEvent.target.result,
                    thubnail: thubnailContent
                }
                digibiz.fileObject = fileObj;
                console.log("digibiz.fileObject", digibiz.fileObject);
                saveCustomerIdentityVideoThumbnail(digibiz.fileObject.thubnail, function (err, customerIdentityVideoThumbnail) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        //passing base 64 content
                        saveCustomerIdentityVideo(digibiz.fileObject.file_content_base64, customerIdentityVideoThumbnail, function (err, customerIdentityVideo) {
                            if (err) {
                                removeLoader();
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            } else {
                                //console.log("customerIdentityVideo", customerIdentityVideo);
                                if (customerIdentityVideo.hasOwnProperty('thumbnail') && customerIdentityVideo.thumbnail) {
                                    var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${customerIdentityVideo.thumbnail}`;
                                    $('#customer_identity_video').attr("src", avtarUrl);
                                    //remove +
                                    $('.customer-identity-video-multimedia-load-btn').remove();
                                    //remove delete
                                    $('#customer-identity-video-delete').remove();
                                    $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                                    //append photo_camera first and then delete
                                    $('#customer_identity_video').siblings('.mask').append(`<a class="customer_identity_video_preview" data-thumbnail-id="${customerIdentityVideo.thumbnail}" data-video-id="${customerIdentityVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                    $('#customer_identity_video').siblings('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn" data-thumbnail-id="${customerIdentityVideo.thumbnail}" data-video-id="${customerIdentityVideo.video_id}">photo_camera</i></a>`);
                                    $('#customer_identity_video').siblings('.mask').append(`<a class="info customer-identity-video-delete-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-delete" data-thumbnail-id="${customerIdentityVideo.thumbnail}" data-video-id="${customerIdentityVideo.video_id}">delete</i></a>`);
                                    $('#identity-video-modal').remove();
                                    digibiz.fileObject = {};
                                    digibiz.objectURLS = [];
                                    removeLoader();
                                }
                            }
                        })
                    }
                });
            }
        } else if (sessionStorage.getItem('employee_id')) {
            var fileObj = {
                // file: files[0],
                identifier: (new Date()).getTime(),
                fileURI: URL.createObjectURL(blob),
                file_type: "video",
                // file_name: files[0].name,
                file_content_base64: readerEvent.target.result,
                thubnail: thubnailContent
            }
            digibiz.fileObject = fileObj;
            console.log("digibiz.fileObject", digibiz.fileObject);
            saveEmployeeIdentityVideoThumbnail(digibiz.fileObject.thubnail, function (err, employeeIdentityVideoThumbnail) {
                if (err) {
                    removeLoader();
                    Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                } else {
                    //passing base 64 content
                    saveEmployeeIdentityVideo(digibiz.fileObject.file_content_base64, employeeIdentityVideoThumbnail, function (err, employeeIdentityVideo) {
                        if (err) {
                            removeLoader();
                            Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                        } else {
                            //console.log("employeeIdentityVideo", employeeIdentityVideo);
                            if (employeeIdentityVideo.hasOwnProperty('thumbnail') && employeeIdentityVideo.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${employeeIdentityVideo.thumbnail}`;
                                // $('#employee_identity_video').attr("src", digibiz.fileObject.fileURI);
                                $('#employee_identity_video').attr("src", avtarUrl);
                                //remove +
                                $('.employee-identity-video-multimedia-load-btn').remove();
                                //remove delete
                                $('#employee-identity-video-delete').remove();
                                $('.employee-add-identity-video-container').find('.mask').removeClass('hide');
                                //append photo_camera first and then delete
                                $('#employee_identity_video').siblings('.mask').append(`<a class="employee_identity_video_preview" data-thumbnail-id="${employeeIdentityVideo.thumbnail}" data-video-id="${employeeIdentityVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                $('#employee_identity_video').siblings('.mask').append(`<a class="info employee-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="employee-identity-video-load-btn" data-thumbnail-id="${employeeIdentityVideo.thumbnail}" data-video-id="${employeeIdentityVideo.video_id}">photo_camera</i></a>`);
                                $('#employee_identity_video').siblings('.mask').append(`<a class="info employee-identity-video-delete-btn cursor_pointer"><i class="material-icons" id="employee-identity-video-delete" data-thumbnail-id="${employeeIdentityVideo.thumbnail}" data-video-id="${employeeIdentityVideo.video_id}">delete</i></a>`);
                                $('#identity-video-modal').remove();
                                sessionStorage.removeItem('employee_upload_for')
                                digibiz.fileObject = {};
                                digibiz.objectURLS = [];
                                removeLoader();
                            }
                        }
                    })
                }
            });
        } else if (sessionStorage.getItem('business_id')) {
            if ($('.business-create-stepper.is-active').attr('data-stepper') == "2") {
                var fileObj = {
                    // file: files[0],
                    identifier: (new Date()).getTime(),
                    fileURI: URL.createObjectURL(blob),
                    file_type: "video",
                    // file_name: files[0].name,
                    file_content_base64: readerEvent.target.result,
                    thubnail: thubnailContent
                }
                digibiz.fileObject = fileObj;
                console.log("digibiz.fileObject", digibiz.fileObject);
                savebusinessDisplayVideoThumbnail(digibiz.fileObject.thubnail, function (err, businessDisplayVideoThumbnail) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        //passing base 64 content
                        savebusinessDisplayVideo(digibiz.fileObject.file_content_base64, businessDisplayVideoThumbnail, function (err, businessDisplayVideo) {
                            if (err) {
                                removeLoader();
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            } else {
                                //console.log("businessDisplayVideo", businessDisplayVideo);
                                $('#business_display_video').attr("src", digibiz.fileObject.fileURI);
                                //remove +
                                $('.business-display-video-multimedia-load-btn').remove();
                                //remove delete
                                $('#business-display-video-delete').remove();
                                $('.business-display-video-wrapper').find('.mask').removeClass('hide');
                                //append photo_camera first and then delete
                                $('#business_display_video').siblings('.mask').append(`<a class="business_display_video_preview" data-thumbnail-id="${businessDisplayVideo.thumbnail}" data-video-id="${businessDisplayVideo.video_id}"><i class="material-icons">play_circle_filled</i></a>`);
                                $('#business_display_video').siblings('.mask').append(`<a class="info business-display-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="business-display-video-mutimedia-add" data-thumbnail-id="${businessDisplayVideo.thumbnail}" data-video-id="${businessDisplayVideo.video_id}">photo_camera</i></a>`);
                                $('#business_display_video').siblings('.mask').append(`<a class="info business-display-video-delete-btn cursor_pointer remove-pic"><i class="material-icons" id="business-display-video-delete" data-thumbnail-id="${businessDisplayVideo.thumbnail}" data-video-id="${businessDisplayVideo.video_id}">cancel</i></a>`);
                                $('#identity-video-modal').remove();
                                sessionStorage.removeItem('business_upload_for');
                                digibiz.fileObject = {};
                                digibiz.objectURLS = [];
                                removeLoader();
                            }
                        });
                    }
                })
            } else {
                savebusinessMultimedia(thubnailContent, "declaration_video_thumbnail", function (err, thumbnailResponse) {
                    if (err) {
                        removeLoader();
                        Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                    } else {
                        saveVideoDeclartionVideo(readerEvent.target.result, function (err, videoResponse) {
                            if (err) {
                                removeLoader();
                                Materialize.toast(`${err} ! Please try again later`, 3000, "round error-alert");
                            } else {
                                var reqParam = {
                                    device_id: crossplat.device.uuid,
                                    id: sessionStorage.getItem('business_id'),
                                    data: {
                                        declaration_video: {
                                            video_id: videoResponse.Data.file,
                                            thumbnail: thumbnailResponse.Data.file
                                        },
                                    }
                                }
                                businessUpdate(reqParam)
                                    .then((response) => {
                                        //console.log("businessUpdate", response);
                                        $('#camera-video-modal').remove();
                                        var videoElement = document.createElement('video');
                                        videoElement.controls = true;
                                        videoElement.classList.add('preview-file');
                                        videoElement.src = URL.createObjectURL(blob);
                                        videoElement.width = 250;
                                        videoElement.height = 200;
                                        $(`.upload-preview-wrapper[data-for="video"]`).addClass('hide');

                                        $('#video_picture').attr("src", thubnailContent);
                                        //remove +
                                        $('#video-declaration-mutimedia-add').remove();
                                        //remove delete
                                        $('#video-declaration-delete').remove();
                                        //append photo_camera first and then delete                        
                                        //append photo_camera first and then delete                        
                                        //append photo_camera first and then delete                        
                                        $(`.add-picture-main-wrapper[data-for="video"]`).find('.mask').find('.video-declaration-multimedia-load-btn').remove();
                                        var template = `<a class="video_declaration_preview" data-thumbnail-id="${response.declaration_video.thumbnail}" data-video-id="${response.declaration_video.video_id}"><i class="material-icons">play_circle_filled</i></a>`;
                                        $(`.add-picture-main-wrapper[data-for="video"]`).find('.mask').append(template);


                                        // $('.append-declaration-video').html('');
                                        // var removeElement = '<span class="mask"><i class="material-icons remove-attached-uploading-file video-cancel">delete</i></span>';
                                        // $('.append-declaration-video').append(videoElement);
                                        // $('.append-declaration-video').append(removeElement);
                                        // var declaration_video = config.api.core + "/api/individual/get_image?image_id=" + response.file + "&device_id=" + crossplat.device.uuid;
                                        // //console.log("declaration_video", declaration_video);
                                        // $('#video_picture').attr('src', declaration_video);
                                        // $('#video-declaration-mutimedia-add').replaceWith(`<i class="material-icons" id="video-declaration-delete">delete</i>`)
                                        // $('#video-declaration-delete').parent().removeClass('video-declaration-multimedia-load-btn');
                                        // $('#modal-close-btn').trigger('click');
                                        digibiz.isDeclarationVideoPictureSelected = true;
                                        Materialize.toast("Successfully uploaded video", 4000, 'round error-alert');
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        //console.log("error in update business api", err);
                                        if (err.msg == "no updated data found") {
                                            removeLoader();
                                        }
                                    })
                            }
                        })
                    }
                })
            }
        }
    })
    // var reqParams = {
    //     content: thubnailContent,
    //     user_id: sessionStorage.getItem('user_id'),
    //     user_type: "individual",
    //     device_id: crossplat.device.uuid,
    //     type: "business_declaration"
    // }
    // callStorageWriteApi(reqParams).then((response) => {
    //     digibiz.declarationVideo = {
    //         image_id: response.file
    //     }
    //     var reqParam = {
    //         device_id: crossplat.device.uuid,
    //         id: sessionStorage.getItem('business_id'),
    //         data: {
    //             declaration_video: digibiz.declarationVideo,
    //         }
    //     }
    //     businessUpdate(reqParam)
    //         .then((result) => {
    //             var videoElement = document.createElement('video');
    //             videoElement.controls = true;
    //             videoElement.classList.add('preview-file');
    //             videoElement.src = URL.createObjectURL(blob);
    //             videoElement.width = 250;
    //             videoElement.height = 200;
    //             $('.append-declaration-video').html('');
    //             var removeElement = '<span class="mask"><i class="material-icons remove-attached-uploading-file video-cancel">delete</i></span>';
    //             $('.append-declaration-video').append(videoElement);
    //             $('.append-declaration-video').append(removeElement);
    //             var declaration_video = config.api.core + "/api/individual/get_image?image_id=" + response.file + "&device_id=" + crossplat.device.uuid;
    //             //console.log("declaration_video", declaration_video);
    //             $('#video_picture').attr('src', declaration_video);
    //             $('#video-declaration-mutimedia-add').replaceWith(`<i class="material-icons" id="video-declaration-delete">delete</i>`)
    //             $('#video-declaration-delete').parent().removeClass('video-declaration-multimedia-load-btn');
    //             $('#modal-close-btn').trigger('click');
    //             digibiz.isDeclarationVideoPictureSelected = true;
    //             removeLoader();
    //         })
    //         .catch((err) => {
    //             removeLoader();
    //             //console.log("error in call write api storage");
    //         });
    // }).catch((err) => {
    //     //console.log('err', err);
    // })
}


function generateThubnail(file, contentType = 'file') {
    //console.log("inside generateThubnail", contentType);
    //console.log("inside generateThubnail file", file);
    return new Promise(async (resolve) => {
        var maxWidth = 400, maxHeight = 400;
        if (contentType == 'file') {
            //console.log("content type file!!")
            await ShotCapture.readFile(file).then(async function (content) {
                if (file.type.split('/')[0] == 'image') {
                    //console.log("image");
                    var { width: srcWidth, height: srcHeight } = await calculateImageSize(content);
                    await ShotCapture.getThumbnails(content, calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight)).then((res) => {
                        resolve(res);
                    }).catch((err) => {
                        //console.log(err);
                    })
                } else if (file.type.split('/')[0] == 'video') {
                    //console.log("getting file video")
                    if (file.size > 52428800) {
                        //console.log("direct return")
                        resolve(content);
                    } else {
                        //console.log("direct to image/jpg")
                        var canvas = document.createElement('canvas');
                        var context = canvas.getContext("2d");
                        var video = document.createElement('video');
                        video.src = content;
                        video.muted = true;
                        video.playsInline = true;
                        video.play();
                        video.onloadeddata = function () {
                            canvas.setAttribute('width', maxWidth);
                            canvas.setAttribute('height', maxWidth);
                            window.vidcanvas = canvas;
                            context.drawImage(video, 0, 0, maxWidth, maxWidth);
                            video.remove();
                            resolve(canvas.toDataURL('image/jpg'));
                            // resolve(canvas.toDataURL());
                        }
                    }
                } else {
                    resolve();
                }
            });
        } else {
            //console.log("else")
            var properties = file.match(/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).*,.*/);
            //console.log("properties", properties);
            if (properties[1].split('/')[0] == 'image') {
                var { width: srcWidth, height: srcHeight } = await calculateImageSize(file);
                ShotCapture.getThumbnails(file, calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight)).then((res) => {
                    resolve(res);
                }).catch((err) => {
                    //console.log(err);
                })
            } else if (properties[1].split('/')[0] == 'video') {
                var canvas = document.createElement('canvas');
                var context = canvas.getContext("2d");
                var video = document.createElement('video');
                video.src = file;
                video.muted = true;
                video.playsInline = true;
                video.play();
                video.onloadeddata = function () {
                    canvas.setAttribute('width', video.videoWidth);
                    canvas.setAttribute('height', video.videoHeight);
                    window.vidcanvas = canvas;
                    context.drawImage(video, 0, 0, video.videoWidth, video.videoHeight);
                    video.remove();
                    resolve(canvas.toDataURL());
                }
            } else {
                resolve(file);
            }
        }
    });
}

/**
 * generate Thumbnails
 */

function calculateImageSize(fileContent) {
    return new Promise((resolve) => {
        var image = new Image();
        image.src = fileContent;
        image.onload = function () {
            var height = this.height;
            var width = this.width;
            resolve({ width, height });
        };
    });
}

function calculateAspectRatioFit(srcWidth, srcHeight, maxWidth, maxHeight) {
    var ratio = Math.min(maxWidth / srcWidth, maxHeight / srcHeight);
    return { width: srcWidth * ratio, height: srcHeight * ratio };
}

function callStorageWriteApi(reqParams) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == 'success') {
                resolve(response.Data);
            } else {
                reject();
            }
        }, api.storage_video_declaration, "POST", "JSON", reqParams);
    });
}

function base64GetCore(reqParams) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == 'success') {
                resolve(response.data);
            } else {
                reject();
            }
        }, api.get_base64, "POST", "JSON", reqParams);
    });
}

function base64GetDigibiz(reqParams) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == 'success') {
                resolve(response.data);
            } else {
                reject();
            }
        }, api.get_base64_transaction_signature_picture, "POST", "JSON", reqParams);
    });
}

/**
 * Route Name : saveIdentityPicture(employee)
 * Description: saves the identity pic
 */
function saveIdentityPicture(callback) {
    if (digibiz.isEmployeeIdentityPictureSelected) {
        // $("#loader-message").text(`Uploading identity picture`);
        addLoader();
        var identityPictureContent = $("#employee_identity_picture").attr("src");
        if (identityPictureContent) {
            storeIdentityPic(identityPictureContent)
                .then(response => {
                    // $("#file-loader").addClass("hide");
                    removeLoader();
                    // //adding value to global var 
                    // cards.cardDataFields["identityPic"] = response.Data.asset_id;
                    callback(null, response);
                })
                .catch(err => {
                    // $("#file-loader").addClass("hide");
                    // $("#preview-card-layout-wrapper").removeClass("hide");
                    // $("#loader-message").empty();
                    callback(err);
                });
        } else {
            callback("Failed to upload identity-picture");
        }
    } else if (digibiz.isBusinessDisplayPictureSelected) {
        // $("#loader-message").text(`Uploading identity picture`);
        addLoader();
        var businessDisplayPictureContent = $("#business_display_picture").attr("src");
        if (businessDisplayPictureContent) {
            storeIdentityPic(businessDisplayPictureContent)
                .then(response => {
                    // $("#file-loader").addClass("hide");
                    removeLoader();
                    // //adding value to global var 
                    // cards.cardDataFields["identityPic"] = response.Data.asset_id;
                    callback(null, response);
                })
                .catch(err => {
                    // $("#file-loader").addClass("hide");
                    // $("#preview-card-layout-wrapper").removeClass("hide");
                    // $("#loader-message").empty();
                    callback(err);
                });
        } else {
            callback("Failed to upload identity-picture");
        }
    } else if (digibiz.isCustomerIdentityPictureSelected) {
        // $("#loader-message").text(`Uploading identity picture`);
        addLoader();
        var identityPictureContent = $("#customer_identity_picture").attr("src");
        if (identityPictureContent) {
            storeIdentityPic(identityPictureContent)
                .then(response => {
                    // $("#file-loader").addClass("hide");
                    removeLoader();
                    // //adding value to global var 
                    // cards.cardDataFields["identityPic"] = response.Data.asset_id;
                    callback(null, response);
                })
                .catch(err => {
                    // $("#file-loader").addClass("hide");
                    // $("#preview-card-layout-wrapper").removeClass("hide");
                    // $("#loader-message").empty();
                    callback(err);
                });
        } else {
            callback("Failed to upload identity-picture");
        }
    } else if (digibiz.isAssociateCustomerIdentityPictureSelected) {
        // $("#loader-message").text(`Uploading identity picture`);
        addLoader();
        var identityPictureContent = $("#associate_customer_identity_picture").attr("src");
        //console.log("identityPictureContent", identityPictureContent);
        if (identityPictureContent) {
            storeIdentityPic(identityPictureContent)
                .then(response => {
                    // $("#file-loader").addClass("hide");
                    removeLoader();
                    // //adding value to global var 
                    // cards.cardDataFields["identityPic"] = response.Data.asset_id;
                    callback(null, response);
                })
                .catch(err => {
                    // $("#file-loader").addClass("hide");
                    // $("#preview-card-layout-wrapper").removeClass("hide");
                    // $("#loader-message").empty();
                    callback(err);
                });
        } else {
            callback("Failed to upload identity-picture");
        }
    } else if (digibiz.isGroupPictureSelected) {
        // $("#loader-message").text(`Uploading identity picture`);
        addLoader();
        var identityPictureContent = $("#group_image").attr("src");
        if (identityPictureContent) {
            storeIdentityPic(identityPictureContent)
                .then(response => {
                    // $("#file-loader").addClass("hide");
                    removeLoader();
                    // //adding value to global var 
                    // cards.cardDataFields["identityPic"] = response.Data.asset_id;
                    callback(null, response);
                })
                .catch(err => {
                    // $("#file-loader").addClass("hide");
                    // $("#preview-card-layout-wrapper").removeClass("hide");
                    // $("#loader-message").empty();
                    callback(err);
                });
        } else {
            callback("Failed to upload identity-picture");
        }
    } else {
        callback();
    }
}

/**
 * Route Name : saveGroupPicture(groups)
 * Description: saves the group pic
 */
// function saveGroupPicture(callback) {
//     if (digibiz.isGroupPictureSelected) {
//         addLoader();
//         var groupName;
//         if ($('body').attr('app') == "customer_groups_details") {
//             groupName = $('#customerGroupName').val().trim()
//         } else if ($('body').attr('app') == "employee_group_create") {
//             groupName = $('#employeeGroupName').val().trim()
//         }
//         var senderID = sessionStorage.getItem('account_id');
//         var user_type = "individual";
//         var individual_id = sessionStorage.getItem('account_id')
//         var userid = sessionStorage.getItem('account_id');
//         var blob = digibiz.groupPictureblob;
//         var groupPictureContent = $("#group_image").attr("src");
//         var API_URL = api.file_write;
//         generateThubnail(groupPictureContent, 'base64').then(async function (thubnailContent) {
//             //console.log("thubnailContent", thubnailContent);
//             //store the content
//             // //console.log(thubnailContent);
//             var formData = new FormData();
//             formData.append("file", blob);
//             formData.append("userid", userid);
//             formData.append("usertype", user_type);
//             formData.append("options", JSON.stringify({ "encryption": "true", "level": "1", "filemanager": { "device_id": crossplat.device.uuid, "owner": { "type": user_type, "id": individual_id }, "app": "Bizchat", "type": "file", "access_type": "system", "file": { "permission": "read", "keywords": "Digibiz multimedia upload" } } }));
//             formData.append("totalSize", blob.size);
//             formData.append("type", blob.type);
//             formData.append("fileName", `${groupName}-${moment().format('D MMMM hh:mm:ss')}`);
//             //console.log("formData", formData);
//             var xhr = new XMLHttpRequest();
//             xhr.addEventListener('load', function (event) {
//                 if (event.target.status == 200) {
//                     var response = JSON.parse(event.target.responseText);
//                     callback(null, response);
//                 } else if (event.target.status >= 400) {
//                     //console.log(event.target.responseText);
//                 }
//             }, false);
//             xhr.open("POST", API_URL, true);
//             xhr.send(formData);
//         });
//     } else {
//         callback();
//     }
// }

//first-time
function saveGroupPictureFirstTime(callback) {
    if (digibiz.isGroupPictureSelected) {
        //console.log("pic is present");
        addLoader();
        var groupPictureContent = $("#group_image").attr("src");
        generateThubnail(groupPictureContent, 'base64').then(async function (thubnailContent) {
            //console.log("thubnailContent", thubnailContent);
            callback(null, thubnailContent)
            //     var requestParams = {
            //         device_id: crossplat.device.uuid,
            //         group_id: $('#edit-associate-customer-modal').attr('data-associate-customer-id'),
            //         data: {
            //             thumbnail_content: thubnailContent,
            //             size: blob.size
            //         }
            //     };
            //     fetch.apiCall(function (response, status, xhr) {
            //         if (status === "success") {
            //             callback(null, response.Data.identity_picture.thumbnail)
            //         } else {
            //             callback("failed")
            //         }
            //     }, api.store_associate_customer_identity_picture, "POST", "JSON", requestParams);
        })
    } else {
        //console.log("pic is not present");
        callback();
    }
}

//second time
function saveGroupPictureSecondTime(base64Image, blob, callback) {
    //console.log("saveEmployeeIdentityPicture", base64Image);
    generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
        //console.log("thubnailContent", thubnailContent);
        var requestParams = {
            device_id: crossplat.device.uuid,
            group_id: sessionStorage.getItem('group_id'),
            data: {
                thumbnail_content: thubnailContent,
                size: blob.size
            }
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                callback(null, response.Data.group_image.thumbnail)
            } else {
                callback("failed")
            }
        }, api.store_group_image, "POST", "JSON", requestParams);
    })
}

/**************EMPLOYEE CREATION GROUP LIST(starts)**************************/
function standardEmployeesGroupsListPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "employee",
            list_by: "all_standard_employee_groups",
            business_id: sessionStorage.getItem('business_id'),
            offset: 0,
            count: 15
        }
        getGroupsCount(reqParam).then((groupsCount) => {
            $('.standard-employee-groups-count').text(groupsCount);
            var reqParamss = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "all_custom_employee_groups",
                business_id: sessionStorage.getItem('business_id')
            }
            getGroupsCount(reqParamss).then((groupsCount) => {
                $('.custom-employee-groups-count').text(groupsCount);
                groupsList(reqParam)
                    .then((response) => {
                        console.log("employeeGroupList response", response);
                        fetch.replaceHtml(function () {
                            digibiz.standard_employees_groups_list_page = [];
                            processStandardEmployeeGroupsList(response, function () {
                                appScroll.scrollBar('.standard-employees-groups-list-contentbox');
                                listenForStandardEmployeeGroupsListScrollEvent($('.standard-employees-groups-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/employee/standard_employees_groups_list_wrapper", "#standard-employees-groups-list-wrapper-template", "#standard-employees-groups-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/employee/standard_employees_groups_list_data", "#standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper", null);
                        }, "page/employee/standard_employees_groups_list_wrapper", "#standard-employees-groups-list-wrapper-template", "#standard-employees-groups-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processStandardEmployeeGroupsList(data, callback) {
    digibiz.standard_employees_groups_list_page = removeDuplicates(digibiz.standard_employees_groups_list_page.concat(data), "id");
    var standardEmployeesGroupsList = {
        standard_employees_groups_list_data: digibiz.standard_employees_groups_list_page.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.charAt(0);
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.charAt(0));
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    // })
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("standardEmployeesGroupsList", standardEmployeesGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/standard_employees_groups_list_data", "#standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper", standardEmployeesGroupsList);
}

function listenForStandardEmployeeGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "all_standard_employee_groups",
                business_id: sessionStorage.getItem('business_id'),
                offset: digibiz.standard_employees_groups_list_page.length,
                count: 5
            }
            addLoader();
            groupsList(reqParam)
                .then((response) => {
                    scrollProcessStandardEmployeeGroupsList(response, function () {
                        listenForStandardEmployeeGroupsListScrollEvent($('.standard-employees-groups-list-contentbox'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, "page/employee/scroll_standard_employees_groups_list_data", "#scroll-standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper .os-content", null);
                })

        }
    });
}

function scrollProcessStandardEmployeeGroupsList(data, callback) {
    digibiz.standard_employees_groups_list_page = removeDuplicates(digibiz.standard_employees_groups_list_page.concat(data), "id");
    var standardEmployeesGroupsList = {
        standard_employees_groups_list_data: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.charAt(0);
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.charAt(0));
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    // })
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("standardEmployeesGroupsList", standardEmployeesGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/scroll_standard_employees_groups_list_data", "#scroll-standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper .os-content", standardEmployeesGroupsList);
}


function customEmployeesGroupsListPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "employee",
            list_by: "all_custom_employee_groups",
            business_id: sessionStorage.getItem('business_id'),
            offset: 0,
            count: 15
        }
        getGroupsCount(reqParam).then((groupsCount) => {
            $('.custom-employee-groups-count').text(groupsCount);
            var reqParamCount = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "all_standard_employee_groups",
                business_id: sessionStorage.getItem('business_id')
            }
            getGroupsCount(reqParamCount).then((groupsCount) => {
                $('.standard-employee-groups-count').text(groupsCount);
                groupsList(reqParam)
                    .then((response) => {
                        //console.log("employeeGroupList response", response);
                        fetch.replaceHtml(function () {
                            digibiz.custom_employees_groups_list_page = [];
                            processCustomEmployeeGroupsList(response, function () {
                                appScroll.scrollBar(".custom-employees-groups-list-contentbox");
                                listenForCustomEmployeeGroupsListScrollEvent($(".custom-employees-groups-list-contentbox"));
                                removeLoader();
                                resolve();
                            });
                        }, "page/employee/custom_employees_groups_list_wrapper", "#custom-employees-groups-list-wrapper-template", "#custom-employees-groups-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                    appScroll.scrollBar(".custom-employees-groups-list-contentbox");
                                }
                            }, "page/employee/custom_employees_groups_list_data", "#custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper", null);
                        }, "page/employee/custom_employees_groups_list_wrapper", "#custom-employees-groups-list-wrapper-template", "#custom-employees-groups-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processCustomEmployeeGroupsList(data, callback) {
    digibiz.custom_employees_groups_list_page = removeDuplicates(digibiz.custom_employees_groups_list_page.concat(data), "id");
    var customEmployeesGroupsList = {
        custom_employees_groups_list_data: digibiz.custom_employees_groups_list_page.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.charAt(0);
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.charAt(0));
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    // })
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("customEmployeesGroupsList", customEmployeesGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/custom_employees_groups_list_data", "#custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper", customEmployeesGroupsList);
}

function listenForCustomEmployeeGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "all_custom_employee_groups",
                business_id: sessionStorage.getItem('business_id'),
                offset: digibiz.custom_employees_groups_list_page.length,
                count: 5
            }
            addLoader()
            groupsList(reqParam)
                .then((response) => {
                    scrollProcessCustomEmployeeGroupsList(response, function () {
                        listenForCustomEmployeeGroupsListScrollEvent($(".custom-employees-groups-list-contentbox"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, "page/employee/scroll_custom_employees_groups_list_data", "#scroll-custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper .os-content", null);
                })

        }
    });
}

function scrollProcessCustomEmployeeGroupsList(data, callback) {
    digibiz.custom_employees_groups_list_page = removeDuplicates(digibiz.custom_employees_groups_list_page.concat(data), "id");
    var customEmployeesGroupsList = {
        custom_employees_groups_list_data: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.charAt(0);
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.charAt(0));
                    //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    // })
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("customEmployeesGroupsList", customEmployeesGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/scroll_custom_employees_groups_list_data", "#scroll-custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper .os-content", customEmployeesGroupsList);
}

// function employeeCreationGroupsListPage() {
//     return new Promise((resolve, reject) => {
//         addLoader();
//         var reqParam = {
//             device_id: crossplat.device.uuid,
//             list_by: "business",
//             business_id: sessionStorage.getItem('business_id')
//         }
//         groupsList(reqParam)
//             .then((response) => {
//                 //console.log("employeeGroupList response", response);
//                 fetch.replaceHtml(function () {
//                     processEmployeeCreationGroupsList(response, function () {
//                         removeLoader();
//                         resolve();
//                     });
//                 }, "page/common/employee_creation_groups_list_wrapper", "#employee-creation-groups-list-wrapper-template", "#main-content-wrapper", null);
//             })
//             .catch((err) => {
//                 fetch.replaceHtml(function () {
//                     fetch.replaceHtml(function (err) {
//                         if (!err) {
//                             removeLoader();
//                             resolve();
//                         }
//                     }, "page/common/employee_creation_groups_list_data", "#employee-creation-group-data-list-template", "#employee-creation-groups-list", null);
//                 }, "page/common/employee_creation_groups_list_wrapper", "#employee-creation-groups-list-wrapper-template", "#main-content-wrapper", null);
//             })
//     })
// }

// function processEmployeeCreationGroupsList(data, callback) {
//     digibiz.employee_creation_groups_list_page = removeDuplicates(digibiz.employee_creation_groups_list_page.concat(data), "id");
//     var employeeCreationGroupsList = {
//         employee_creation_group_list_data: digibiz.employee_creation_groups_list_page.map(e => {
//             if (e.hasOwnProperty('group_image') && e.group_image) {
//                 if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
//                     var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
//                     e.group_image['avtarUrl'] = avtarUrl;
//                 } else {
//                     e['imageLetter'] = e.name.charAt(0);
//                 }
//             } else {
//                 e['imageLetter'] = e.name.charAt(0);
//             }
//             return e;
//         })
//     };
//     //console.log("employeeCreationGroupsList", employeeCreationGroupsList);
//     fetch.replaceHtml(function (err) {
//         if (!err) {
//             callback();
//         }
//     }, "page/common/employee_creation_groups_list_data", "#employee-creation-group-data-list-template", "#employee-creation-groups-list", employeeCreationGroupsList);
// }

function employeeGroupCreationPage() {
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('group_id')) {
            $('#add_employee_group_moderator').removeClass('hide');
            if (sessionStorage.getItem('group_type') == "standard") {
                var reqparams = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('group_id')
                }
                groupGet(reqparams)
                    .then((response) => {
                        var moderatorData = [];
                        var modReqParams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('group_id'),
                            count: 5,
                            offset: 0
                        }
                        getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                            digibiz.group_moderator_list = [];
                            digibiz.group_moderator_list = moderatorResponse.moderator;
                            //console.log("employeeGroupGet response", response);
                            if (response.hasOwnProperty('group_image') && response.group_image) {
                                if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                    response.group_image['avtarUrl'] = avtarUrl;
                                    response['imageLetter'] = response.name.charAt(0);
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                            } else {
                                response['imageLetter'] = response.name.charAt(0);
                            }
                            // if (response.hasOwnProperty('moderator') && response.moderator) {
                            //     moderatorData = response.moderator.map(e => {
                            //         if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                            //             if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                            //                 var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                            //                 e.data.identity_picture['avtarUrl'] = avtarUrl;
                            //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                            //             } else {
                            //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                            //             }
                            //         } else {
                            //             e.data['imageLetter'] = e.data.name.first.charAt(0);
                            //         }
                            //         return e;
                            //     })
                            // }
                            var groupData = {
                                group_data: response,
                                // group_moderator_data: moderatorData
                            }
                            //console.log("groupData", groupData);
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    appScroll.scrollBar("#main-container");
                                    appScroll.scrollBar("#employee-group-members-list");
                                    processGroupModeratorList(digibiz.group_moderator_list, function () {
                                        appScroll.scrollBar('#employee-group-moderator-members-list');
                                        listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                                    });
                                    resolve();
                                }
                            }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", groupData);

                        }).catch((err) => {
                            console.log('err', err);
                        })
                    })
                    .catch((err) => {
                        //console.log("error in employee group get");
                        removeLoader();
                        resolve();
                    })
            } else if (sessionStorage.getItem('group_type') == "custom") {
                digibiz.group_moderator_list = [];
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    var moderatorData = [];
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id')
                    }
                    groupGet(reqparams)
                        .then((response) => {
                            var modReqParams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('group_id'),
                                count: 5,
                                offset: 0
                            }
                            getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                                digibiz.group_moderator_list = [];
                                digibiz.group_moderator_list = moderatorResponse.moderator;

                                //console.log("employeeGroupGet response", response);
                                if (response.hasOwnProperty('group_image') && response.group_image) {
                                    if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                        response.group_image['avtarUrl'] = avtarUrl;
                                        response['imageLetter'] = response.name.charAt(0);

                                    } else {
                                        response['imageLetter'] = response.name.charAt(0);
                                    }
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                                // if (response.hasOwnProperty('moderator') && response.moderator) {
                                //     moderatorData = response.moderator.map(e => {
                                //         if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                                //             if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                                //                 var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                                //                 e.data.identity_picture['avtarUrl'] = avtarUrl;
                                //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                                //             } else {
                                //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                                //             }
                                //         } else {
                                //             e.data['imageLetter'] = e.data.name.first.charAt(0);
                                //         }
                                //         return e;
                                //     })
                                // }
                                var requestParams = {
                                    device_id: crossplat.device.uuid,
                                    group_id: sessionStorage.getItem('group_id'),
                                    offset: 0,
                                    count: 5
                                }
                                getGroupMembers(requestParams)
                                    .then((responses) => {
                                        var membersResponse = responses.membersList;
                                        digibiz.group_employee_members_list = [];
                                        digibiz.group_employee_members_list = membersResponse;
                                        //console.log("employeeGroupMemberList response", membersResponse);
                                        var groupData = {
                                            group_data: response,
                                            membersCount: responses.membersCount,
                                            group_members_data: membersResponse.map(p => {
                                                if (p.hasOwnProperty('identity_picture') && p.identity_picture) {
                                                    if (p.identity_picture.hasOwnProperty('thumbnail') && p.identity_picture.thumbnail) {
                                                        var avtarUrl = `${api.get_employee_identity_picture}?id=${p.member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${p.identity_picture.thumbnail}`;
                                                        p.identity_picture['avtarUrl'] = avtarUrl;
                                                        p['imageLetter'] = p.member_name.first.charAt(0);
                                                    } else {
                                                        p['imageLetter'] = p.member_name.first.charAt(0);
                                                    }
                                                } else {
                                                    p['imageLetter'] = p.member_name.first.charAt(0);
                                                }
                                                return p;
                                            }),
                                            // group_moderator_data: moderatorData
                                        }
                                        console.log("groupData", groupData);
                                        fetch.replaceHtml(function (err) {
                                            if (!err) {
                                                // $('#modal-employee-selection').remove();
                                                removeLoader();
                                                appScroll.scrollBar("#main-container");
                                                appScroll.scrollBar("#employee-group-members-list");

                                                listenForEmployeeGroupMembersList($("#employee-group-members-list"));
                                                processGroupModeratorList(digibiz.group_moderator_list, function () {
                                                    appScroll.scrollBar('#employee-group-moderator-members-list');
                                                    listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                                                });

                                                resolve();
                                            }
                                        }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", groupData);
                                    })
                                    .catch((err) => {
                                        //console.log("error in employee group members data");
                                        var groupData = {
                                            group_data: response
                                        }
                                        //console.log("groupData", groupData);
                                        fetch.replaceHtml(function (err) {
                                            if (!err) {
                                                // $('#modal-employee-selection').remove();
                                                removeLoader();
                                                console.log('Guru 3');
                                                resolve();
                                            }
                                        }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", groupData);
                                    })
                            })
                        }).catch((err) => {
                            console.log('err', err);
                        })
                        .catch((err) => {
                            //console.log("error in employee group get");
                            removeLoader();
                            resolve();
                        })
                } else if (sessionStorage.getItem('group_from') == "department_list") {
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id')
                    }
                    groupGet(reqparams)
                        .then((response) => {
                            //console.log("employeeGroupGet response", response);
                            var modReqParams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('group_id'),
                                count: 5,
                                offset: 0
                            }
                            getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                                digibiz.group_moderator_list = [];
                                digibiz.group_moderator_list = moderatorResponse.moderator;
                                if (response.hasOwnProperty('group_image') && response.group_image) {
                                    if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                        response.group_image['avtarUrl'] = avtarUrl;
                                        response['imageLetter'] = response.name.charAt(0);
                                    } else {
                                        response['imageLetter'] = response.name.charAt(0);
                                    }
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                                var groupData = {
                                    group_data: response,
                                    department_list_data: response.department_data.map(e => {
                                        e['imageLetter'] = e.name.charAt(0);
                                        return e;
                                    })
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        $('#custom-employee-group-department-list-modal').remove();
                                        appScroll.scrollBar('#main-container');
                                        removeLoader();
                                        processGroupModeratorList(digibiz.group_moderator_list, function () {
                                            appScroll.scrollBar('#employee-group-moderator-members-list');
                                            listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                                        });
                                        resolve();
                                    }
                                }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", groupData);
                            })
                                .catch((err) => {
                                    //console.log("error in employee group get");
                                    removeLoader();
                                    resolve();
                                })
                        }).catch((err) => {
                            console.log('err', err);
                        })
                } else if (sessionStorage.getItem('group_from') == "standard_group") {
                    var moderatorData = [];
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id')
                    }
                    groupGet(reqparams)
                        .then((response) => {
                            console.log("employeeGroupGet response", response);
                            if (response.status.status != "deleted") {
                                if (response.hasOwnProperty('group_image') && response.group_image) {
                                    if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                        response.group_image['avtarUrl'] = avtarUrl;
                                        response['imageLetter'] = response.name.charAt(0);
                                    } else {
                                        response['imageLetter'] = response.name.charAt(0);
                                    }
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                                var modReqParams = {
                                    device_id: crossplat.device.uuid,
                                    id: sessionStorage.getItem('group_id'),
                                    count: 5,
                                    offset: 0
                                }
                                getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                                    digibiz.group_moderator_list = [];
                                    digibiz.group_moderator_list = moderatorResponse.moderator;
                                    // if (response.hasOwnProperty('moderator') && response.moderator) {
                                    //     moderatorData = response.moderator.map(e => {
                                    //         if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                                    //             if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                                    //                 var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                                    //                 e.data.identity_picture['avtarUrl'] = avtarUrl;
                                    //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                                    //             } else {
                                    //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                                    //             }
                                    //         } else {
                                    //             e.data['imageLetter'] = e.data.name.first.charAt(0);
                                    //         }
                                    //         return e;
                                    //     })
                                    // }
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: sessionStorage.getItem('group_id'),
                                        count: 5,
                                        offset: 0
                                    }
                                    getGroupMembers(requestParams)
                                        .then((mebresponse) => {
                                            var membersResponse = mebresponse.membersList;
                                            //console.log("employeeGroupMemberList response", membersResponse);
                                            digibiz.group_employee_members_list = [];
                                            digibiz.group_employee_members_list = membersResponse;
                                            var groupData = {
                                                group_data: response,
                                                membersCount: mebresponse.membersCount,
                                                group_members_data: membersResponse.map(p => {
                                                    if (p.hasOwnProperty('group_image') && p.group_image) {
                                                        // if (p.identity_picture.hasOwnProperty('asset_id') && p.identity_picture.asset_id) {
                                                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${p.member.id}&image_id=${p.group_image.thumbnail}`;
                                                        //   console.log('avtarUrl',avtarUrl);
                                                        p.group_image['avtarUrl'] = avtarUrl;
                                                        p['imageLetter'] = p.member_name.charAt(0);
                                                        // } else {
                                                        //     p['imageLetter'] = p.member_name.charAt(0);
                                                        // }
                                                    } else {
                                                        p['imageLetter'] = p.member_name.charAt(0);
                                                    }
                                                    return p;
                                                }),
                                                // group_moderator_data: moderatorData
                                            }
                                            //console.log("groupData", groupData);
                                            fetch.replaceHtml(function (err) {
                                                if (!err) {
                                                    removeLoader();
                                                    appScroll.scrollBar('#main-container');
                                                    processGroupModeratorList(digibiz.group_moderator_list, function () {
                                                        appScroll.scrollBar('#employee-group-moderator-members-list');
                                                        listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                                                    });
                                                    appScroll.scrollBar('#employee-group-members-list');
                                                    listenForEmployeeGroupMembersList($('#employee-group-members-list'));
                                                    // listenForCustomerGroupGroupMembersList
                                                    resolve();
                                                }
                                            }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", groupData);
                                        })
                                        .catch((err) => {
                                            //console.log("error in employee group members data");
                                            var groupData = {
                                                group_data: response
                                            }
                                            //console.log("groupData", groupData);
                                            fetch.replaceHtml(function (err) {
                                                if (!err) {
                                                    removeLoader();
                                                    console.log('Guru 6');
                                                    resolve();
                                                }
                                            }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", groupData);
                                        })
                                }).catch((err) => {
                                    console.log('err', err);
                                })
                            } else {
                                Materialize.toast(`Group Deleted.`, 3000, 'round success-alert');
                                location.hash = `employee_group_creation/list`;
                                // removeLoader();
                            }
                        })
                        .catch((err) => {
                            //console.log("error in employee group get");
                            removeLoader();
                            resolve();
                        })
                }
            }
        } else {
            fetch.replaceHtml(function (err) {
                if (!err) {
                    $('#add_employee_group_moderator').addClass('hide');
                    appScroll.scrollBar("#main-container");
                    console.log('Guru 7');
                    removeLoader();
                    resolve();
                }
            }, "page/common/employee_group_creation", "#employee-group-creation-template", "#main-content-wrapper", null);
        }
    })
}
/**************EMPLOYEE CREATION GROUP LIST(ends)**************************/

/*****************EMPLOYEE GROUP CREATE(starts)**************************/
function validateGroupData() {
    let validateGroupName = false;
    let validateGroupDescription = false;
    let validateGroupVisibility = false;
    let validateGroupMembers = false;
    //validate group name
    if ($('#employeeGroupName').val().trim().length > 0) {
        if ($('#employeeGroupName').val().trim().length < config.EmployeeGroupNameMinLength) {
            showError($('#employeeGroupName'), `This field should contain atleast ${config.EmployeeGroupNameMinLength} characters.`);
            validateGroupName = true;
        }
        if ($('#employeeGroupName').val().trim().length > config.EmployeeGroupNameMaxLength) {
            showError($('#employeeGroupName'), `This field can't have more than  ${config.EmployeeGroupNameMaxLength} characters.`);
            validateGroupName = true;
        }
        if ($('#employeeGroupName').val().trim().length >= config.EmployeeGroupNameMinLength && $('#employeeGroupName').val().trim().length <= config.EmployeeGroupNameMaxLength) {
            validateGroupName = false;
        }
    } else {
        showError($('#employeeGroupName'), `This field is required.`);
        validateGroupName = true;
    }
    //validate group description
    if ($('#employee_group_desc').val().trim().length > 0) {
        if ($('#employee_group_desc').val().trim().length < config.EmployeeGroupDescriptionMinLength) {
            showError($('#employee_group_desc'), `This field should contain atleast ${config.EmployeeGroupDescriptionMinLength} characters.`);
            validateGroupDescription = true;
        }
        if ($('#employee_group_desc').val().trim().length > config.EmployeeGroupDescriptionMaxLength) {
            showError($('#employee_group_desc'), `This field can't have more than  ${config.EmployeeGroupDescriptionMaxLength} characters.`);
            validateGroupDescription = true;
        }
        if ($('#employee_group_desc').val().trim().length >= config.EmployeeGroupDescriptionMinLength && $('#employee_group_desc').val().trim().length <= config.EmployeeGroupDescriptionMaxLength) {
            validateGroupDescription = false;
        }
    } else {
        validateGroupDescription = false;
    }
    //validate visibility
    // if ($('#select-visibility-type').val() == "") {
    //     showError($('#select-visibility-type'), `This field is required.`);
    //     validateGroupVisibility = true;
    // } else {
    //     validateGroupVisibility = false;
    // }
    if ($('.selected-value-group-visbility').attr('data-value').length > 0) {
        validateGroupVisibility = false;
    } else {
        showError($('#select-visibility-type'), `This field is required.`);
        validateGroupVisibility = true;
    }
    // validate group members
    if (sessionStorage.getItem('group_type') == "custom") {
        if (sessionStorage.getItem('group_id')) {

        } else {
            if (sessionStorage.getItem('group_from')) {
                if (sessionStorage.getItem('group_from') == "employee_list") {
                    // if (digibiz.employee_group_employee_members.filter(e => e.hasOwnProperty('selected') && e.selected).length > 0) {
                    //     validateGroupMembers = false;
                    // } else {
                    //     Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                    //     validateGroupMembers = true;
                    // }
                    if ($("input[name='selectedmembers[]']:checked").length > 0) {
                        if ($("input[name='selectedmembers[]']:checked").length > 1) {//min 2 members in the group
                            validateGroupMembers = false;
                        } else {
                            Materialize.toast(`Minimum 2 group members are required.`, 3000, 'round success-alert');
                            validateGroupMembers = true;
                        }
                    } else {
                        Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                        validateGroupMembers = true;
                    }
                } else if (sessionStorage.getItem('group_from') == "department_list") {
                    if (digibiz.employee_group_department_members.length > 0) {
                        validateGroupMembers = false;
                    } else {
                        Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                        validateGroupMembers = true;
                    }
                } else if (sessionStorage.getItem('group_from') == "standard_group") {
                    if ($("input[name='selectedmembers[]']:checked").length > 0) {
                        if ($("input[name='selectedmembers[]']:checked").length > 1) {//min 2 members in the group
                            validateGroupMembers = false;
                        } else {
                            Materialize.toast(`Minimum 2 group members are required.`, 3000, 'round success-alert');
                            validateGroupMembers = true;
                        }
                    } else {
                        Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                        validateGroupMembers = true;
                    }
                }
            } else {
                Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                validateGroupMembers = true;
            }
        }
    } else {
        validateGroupMembers = false;
    }
    if (validateGroupMembers || validateGroupDescription || validateGroupName || validateGroupVisibility) {
        return false;
    } else {
        return true;
    }
}

function getAddedEmployeeMembers(callback) {
    if (digibiz.employee_group_employee_members.filter(e => e.hasOwnProperty('selected') && e.selected).length > 0) {
        let contactlist = [];
        $.each(digibiz.employee_group_employee_members.filter(e => e.hasOwnProperty('selected') && e.selected), function (index, ele) {
            contactlist.push(ele.id);
            if (digibiz.employee_group_employee_members.filter(e => e.hasOwnProperty('selected') && e.selected).length == index + 1) {
                callback(contactlist);
            }
        });
    } else {
        callback([]);
    }
}

function uniqueArray(list) {
    var result = [];
    $.each(list, function (i, e) {
        if ($.inArray(e, result) == -1) result.push(e);
    });
    return result;
}
/*****************EMPLOYEE GROUP CREATE(ends)**************************/
/**********EMPLOYEE MANAGEMENT(starts) **************/
function allEmployessListPage() {
    //console.log("came");
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "list_only_active"
        }
        employeeList(reqParam)
            .then((response) => {
                //console.log("employeeList response", response);
                fetch.replaceHtml(function () {
                    processEmployeeList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/employee/all_employees_list_wrapper", "#all-employees-list-wrapper-template", "#all-employees-contact-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/employee/all_employees_list_data", "#all-employees-list-data-template", "#all-employees-list-wrapper", null);
                }, "page/employee/all_employees_list_wrapper", "#all-employees-list-wrapper-template", "#all-employees-contact-list-data-container", null);
            })
    })
}

function processEmployeeList(data, callback) {
    digibiz.all_employees_list = removeDuplicates(digibiz.all_employees_list.concat(data), "dj_unique_employee_id");
    var employeeList = {
        all_employees_list_data: digibiz.all_employees_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("employeeList", employeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/all_employees_list_data", "#all-employees-list-data-template", "#all-employees-list-wrapper", employeeList);
}


// function departmentWiseEmployessListPage() {
//     return new Promise((resolve, reject) => {
//         fetch.replaceHtml(function () {
//             fetch.replaceHtml(function (err) {
//                 if (!err) {
//                     removeLoader();
//                     resolve();
//                 }
//             }, "page/employee/department_wise_employees_list_data", "#department-wise-employees-list-data-template", "#department-wise-employees-list-wrapper", null);
//         }, "page/employee/department_wise_employees_list_wrapper", "#department-wise-employees-list-wrapper-template", "#department-wise-employees-list-data-container", null);
//     })
// }

function processDepartmentWiseEmployeeList(data, callback) {
    digibiz.department_wise_employees_list = removeDuplicates(digibiz.department_wise_employees_list.concat(data), "dj_unique_employee_id");
    var departmentWiseEmployeeList = {
        department_wise_employees_list_data: digibiz.department_wise_employees_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("departmentWiseEmployeeList", departmentWiseEmployeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/department_wise_employees_list_data", "#department-wise-employees-list-data-template", "#department-wise-employees-list-wrapper", departmentWiseEmployeeList);
}

function departmentWiseEmployessListPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: digibiz.employeeFilterData.type,
            category: digibiz.employeeFilterData.category,
            designation: digibiz.employeeFilterData.designation,
            departments: digibiz.employeeFilterData.department,
            status: digibiz.employeeFilterData.status,
        }
        employeeFilter(reqParams)
            .then((response) => {
                console.log("response", response);
                // fetch.replaceHtml(function () {
                processDepartmentWiseEmployeeList(response, function () {
                    $('#employee-filter-option-modal').remove();
                    removeLoader();
                    resolve();
                });
                // }, "page/employee/department_wise_employees_list_wrapper", "#department-wise-employees-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                $('#employee-filter-option-modal').remove();
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in employee filter api");
                // fetch.replaceHtml(function () {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/employee/department_wise_employees_list_data", "#department-wise-employees-list-data-template", "#department-wise-employees-list-wrapper", null);
                // }, "page/employee/department_wise_employees_list_wrapper", "#department-wise-employees-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}
/**********EMPLOYEE MANAGEMENT(ends) **************/

/******************CUSTOMER MANAGEMENT(starts)************************/
function customerManagementHubPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            $('.view-digibiz-back-button').removeClass('hide');
            removeLoader();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/customer/customer_management_hub", "#customer-management-land-page", "#main-content-wrapper", null);
    })
}

function customerIdentifierListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer",
            offset: 0,
            count: 15
        }
        customerIdentifierCount(reqParam).then((countResult) => {
            $('.customer-identifiers-tab').text(`Identifiers (#${countResult.totalIdentifiers})`);
            customerIdentifierList(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierList response", response);
                    fetch.replaceHtml(function () {
                        processCustomerIdentifiersList(response, function () {
                            appScroll.scrollBar('.customer-identifiers-list-contentbox');
                            listenForCustomerIdentifiersScrollEvent($(".customer-identifiers-list-contentbox"));
                            removeLoader();
                            resolve();
                        });
                    }, "page/customer/customer_identifiers_list_wrapper", "#customer-identifiers-list-wrapper-template", "#customer-identifiers-list-data-container", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/customer/customer_identifiers_list_data", "#customer-identifiers-data-list-template", "#customer-identifiers-list-wrapper", null);
                    }, "page/customer/customer_identifiers_list_wrapper", "#customer-identifiers-list-wrapper-template", "#customer-identifiers-list-data-container", null);
                })
        }).catch((err) => {
            console.log('err', err);
        })

    });
}

function processCustomerIdentifiersList(data, callback) {
    digibiz.customer_identifiers = removeDuplicates(digibiz.customer_identifiers.concat(data), "id");
    var customerIdentifiersList = {
        customer_identifiers_list_data: digibiz.customer_identifiers
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_identifiers_list_data", "#customer-identifiers-data-list-template", "#customer-identifiers-list-wrapper", customerIdentifiersList);
}

function associateCustomerIdentifierListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "associate_customer",
            count: 15,
            offset: 0
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                fetch.replaceHtml(function () {
                    processAssociateCustomerIdentifiersList(response, function () {
                        appScroll.scrollBar('.associate-customer-identifiers-list-contentbox');
                        listenForAssociateCustomerIdentifiersListScrollEvent($('.associate-customer-identifiers-list-contentbox'));
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/associate_customers_list_wrapper", "#associate-customer-identifiers-list-wrapper-template", "#associate-customer-identifiers-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            console.log('entry 1')
                            resolve();
                        }
                    }, "page/customer/associate_customers_list_data", "#associate-customer-identifiers-data-list-template", "#associate-customer-identifiers-list-wrapper", null);
                }, "page/customer/associate_customers_list_wrapper", "#associate-customer-identifiers-list-wrapper-template", "#associate-customer-identifiers-list-data-container", null);
            })

    });
}

function processAssociateCustomerIdentifiersList(data, callback) {
    digibiz.associate_customer_identifiers = removeDuplicates(digibiz.associate_customer_identifiers.concat(data), "id");
    var customerIdentifiersList = {
        associate_customer_identifiers_list_data: digibiz.associate_customer_identifiers
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/customer/associate_customers_list_data", "#associate-customer-identifiers-data-list-template", "#associate-customer-identifiers-list-wrapper", customerIdentifiersList);
}

function primaryCustomerLabelListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "primary_customer"
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                fetch.replaceHtml(function () {
                    processPrimaryCustomerLabelList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/primary_customer_label_list_wrapper", "#primary-customer-label-list-wrapper-template", "#primary-customer-label-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            //console.log("456")
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/primary_customer_label_list_data", "#primary-customer-label-data-list-template", "#primary-customer-label-list-wrapper", null);
                }, "page/customer/primary_customer_label_list_wrapper", "#primary-customer-label-list-wrapper-template", "#primary-customer-label-list-data-container", null);
            })

    });
}

function processPrimaryCustomerLabelList(data, callback) {
    //console.log("processPrimaryCustomerLabelList", data);
    var getData = {
        customer_label_list_data: data
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/primary_customer_label_list_data", "#primary-customer-label-data-list-template", "#primary-customer-label-list-wrapper", getData);
}

function validateIdentifierData(type) {
    let validateIdentifierName = false;
    if (type == "associate_customer_identifier") {
        //validate identifier name
        var identifierValue = getInputText($('#associate_customer_identifier_name')).trim();
        var identifierValueLength = Array.from(identifierValue).length;
        if (identifierValueLength > 0) {
            if (identifierValueLength < config.CustomerIdentifierNameMinLength) {
                showError($('#associate_customer_identifier_name'), `This field should contain atleast ${config.CustomerIdentifierNameMinLength} characters.`);
                validateIdentifierName = true;
            }
            if (identifierValueLength > config.CustomerIdentifierNameMaxLength) {
                showError($('#associate_customer_identifier_name'), `This field can't have more than  ${config.CustomerIdentifierNameMaxLength} characters.`);
                validateIdentifierName = true;
            }
            if (identifierValueLength >= config.CustomerIdentifierNameMinLength && identifierValueLength <= config.CustomerIdentifierNameMaxLength) {
                validateIdentifierName = false;
            }
        } else {
            showError($('#associate_customer_identifier_name'), `This field is required.`);
            validateIdentifierName = true;
        }
    } else if (type == "customer_identifier") {
        //validate identifier name
        var identifierValue = getInputText($('#customer_identifier_name')).trim();
        var identifierValueLength = Array.from(identifierValue).length;
        if (identifierValueLength > 0) {
            if (identifierValueLength < config.CustomerIdentifierNameMinLength) {
                showError($('#customer_identifier_name'), `This field should contain atleast ${config.CustomerIdentifierNameMinLength} characters.`);
                validateIdentifierName = true;
            }
            if (identifierValueLength > config.CustomerIdentifierNameMaxLength) {
                showError($('#customer_identifier_name'), `This field can't have more than  ${config.CustomerIdentifierNameMaxLength} characters.`);
                validateIdentifierName = true;
            }
            if (identifierValueLength >= config.CustomerIdentifierNameMinLength && identifierValueLength <= config.CustomerIdentifierNameMaxLength) {
                validateIdentifierName = false;
            }
        } else {
            showError($('#customer_identifier_name'), `This field is required.`);
            validateIdentifierName = true;
        }

    } else {
        //validate label name
        var identifierValue = getInputText($('#primary_customer_label_name')).trim();
        var identifierValueLength = Array.from(identifierValue).length;
        if (identifierValueLength > 0) {
            if (identifierValueLength < config.CustomerIdentifierNameMinLength) {
                showError($('#primary_customer_label_name'), `This field should contain atleast ${config.CustomerIdentifierNameMinLength} characters.`);
                validateIdentifierName = true;
            }
            if (identifierValueLength > config.CustomerIdentifierNameMaxLength) {
                showError($('#primary_customer_label_name'), `This field can't have more than  ${config.CustomerIdentifierNameMaxLength} characters.`);
                validateIdentifierName = true;
            }
            if (identifierValueLength >= config.CustomerIdentifierNameMinLength && identifierValueLength <= config.CustomerIdentifierNameMaxLength) {
                validateIdentifierName = false;
            }
        } else {
            showError($('#primary_customer_label_name'), `This field is required.`);
            validateIdentifierName = true;
        }
    }
    if (validateIdentifierName) {
        return false;
    } else {
        return true;
    }
}


//customer creation(active and pending)
function activeCustomerListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        digibiz.customer_identifiers_active_customers_list = [];
        var getDataType = {
            type: "active_customers"
        }
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer",
            offset: 0,
            count: 15
        }
        customerIdentifierCount(reqParam).then((countResults) => {
            $('.header_primary').text(`Identifiers (#${countResults.totalIdentifiers})`);
            $('.customer_count_header_primary').text(`Total Customers (#${countResults.totalCustomers})`)
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                fetch.replaceHtml(function () {
                    processCustomerIdentifiersActiveCustomerCreationList(response, function () {
                        appScroll.scrollBar('.active-customer-identifiers-list-contentbox');
                        listenForCustomerIdentifiersActiveCustomerCreationListScrollEvent($('.active-customer-identifiers-list-contentbox'));
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/customer_creation_identifiers_list_wrapper", "#customer-creation-identifiers-list-wrapper-template", "#main-content-wrapper", getDataType);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#active-customer-creation-identifiers-list-wrapper", getDataType);
                }, "page/customer/customer_creation_identifiers_list_wrapper", "#customer-creation-identifiers-list-wrapper-template", "#main-content-wrapper", getDataType);
            })
        }).catch((err) => {
            console.log('err',err);
        })
    });
}

function processCustomerIdentifiersActiveCustomerCreationList(data, callback) {
    digibiz.customer_identifiers_active_customers_list = removeDuplicates(digibiz.customer_identifiers_active_customers_list.concat(data), "id");
    var customerIdentifiersList = {
        customer_identifiers_list_data: digibiz.customer_identifiers_active_customers_list,
        type: "active_customers"
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#active-customer-creation-identifiers-list-wrapper", customerIdentifiersList);
}

function pendingCustomerListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        digibiz.customer_identifiers_pending_customers_list = [];
        var getDataType = {
            type: "pending_customers"
        }
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer",
            offset: 0,
            count: 15
        }
        customerIdentifierCount(reqParam).then((identifierCount) => {
            $('.customer-pending-count').text(identifierCount);
            customerIdentifierList(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierList response", response);
                    fetch.replaceHtml(function () {
                        processCustomerIdentifiersPendingCustomerCreationList(response, function () {
                            appScroll.scrollBar('.pending-customer-identifiers-list-contentbox');
                            listenForCustomerIdentifiersPendingCustomerScrollEvent($(".pending-customer-identifiers-list-contentbox"));
                            removeLoader();
                            resolve();
                        });
                    }, "page/customer/customer_creation_identifiers_list_wrapper", "#customer-creation-identifiers-list-wrapper-template", "#pending-customer-list-data-container", getDataType);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#pending-customer-creation-identifiers-list-wrapper", getDataType);
                    }, "page/customer/customer_creation_identifiers_list_wrapper", "#customer-creation-identifiers-list-wrapper-template", "#pending-customer-list-data-container", getDataType);
                })
        }).catch((err) => {
            console.log('err', err);
        })
    });
}

function processCustomerIdentifiersPendingCustomerCreationList(data, callback) {
    digibiz.customer_identifiers_pending_customers_list = removeDuplicates(digibiz.customer_identifiers_pending_customers_list.concat(data), "id");
    var customerIdentifiersList = {
        customer_identifiers_list_data: digibiz.customer_identifiers_pending_customers_list,
        type: "pending_customers"
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#pending-customer-creation-identifiers-list-wrapper", customerIdentifiersList);
}

function aluminiCustomerListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        digibiz.alumini_customer_list = [];
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            identifier_id: sessionStorage.getItem('identifier_id'),
            list_by: "alumini",
            offset: 0,
            count: 5
        }
        customerCount(reqParam).then((aluminiCount) => {
            $('.customer-alumini-count').text(`${aluminiCount}`);
            customerList(reqParam)
                .then((response) => {
                    //console.log("customerList response", response);
                    fetch.replaceHtml(function () {
                        processAluminiCustomerList(response, function () {
                            appScroll.scrollBar('.alumini-customers-list-contentbox');
                            listenForAluminiCustomerListScrollEvent($('.alumini-customers-list-contentbox'));
                            removeLoader();
                            resolve();
                        });
                    }, "page/customer/alumini_customers_list_wrapper", "#alumini-customers-list-wrapper-template", "#alumini-customer-list-data-container", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/customer/alumini_customers_list_data", "#alumini-customers-list-data-template", "#alumini-customers-list-wrapper", null);
                    }, "page/customer/alumini_customers_list_wrapper", "#alumini-customers-list-wrapper-template", "#alumini-customer-list-data-container", null);
                })
        }).catch((err) => {
            console.log('err', err);
        })
    });
}


//get all the customers of this identifier who are active/accepted
function activeCustomerCreationListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            identifier_id: sessionStorage.getItem('identifier_id'),
            list_by: "business_identifier_active_accepted",
            count: 20,
            offset: 0
        }
        customerCount(reqParam).then((count) => {
        customerList(reqParam)
            .then((response) => {
                $('.customer-active-count').text(`${count}`);
                //console.log("customerList response", response);
                fetch.replaceHtml(function () {
                    processActiveCustomerList(response, function () {
                        appScroll.scrollBar('.active-customers-list-contentbox');
                        listenForActiveCustomerListScrollEvent($(".active-customers-list-contentbox"));
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/active_customers_list_wrapper", "#active-customers-list-wrapper-template", "#active-customer-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/active_customers_list_data", "#active-customers-list-data-template", "#active-customers-list-wrapper", null);
                }, "page/customer/active_customers_list_wrapper", "#active-customers-list-wrapper-template", "#active-customer-list-data-container", null);
            })
        }).catch((err)=> {
            console.log('err',err);
        })

    });
}

function processActiveCustomerList(data, callback) {
    digibiz.customer_creation_active_list = removeDuplicates(digibiz.customer_creation_active_list.concat(data), "id");
    var customerList = {
        active_customers_list_data: digibiz.customer_creation_active_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.first.charAt(0);
                    //     $(`.active-customer-wrapper[data-customer-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    // })
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("customerList", customerList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/active_customers_list_data", "#active-customers-list-data-template", "#active-customers-list-wrapper", customerList);
}

function processAluminiCustomerList(data, callback) {
    digibiz.alumini_customer_list = removeDuplicates(digibiz.alumini_customer_list.concat(data), "id");
    var customerList = {
        alumini_customers_list_data: digibiz.alumini_customer_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("customerList", customerList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/alumini_customers_list_data", "#alumini-customers-list-data-template", "#alumini-customers-list-wrapper", customerList);
}

//get all the customers of this identifier who are having status pending
function pendingCustomerCreationListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     business_id: sessionStorage.getItem('business_id'),
        //     identifier_id: sessionStorage.getItem('identifier_id'),
        //     list_by: "business_identifier_pending"
        // }
        // customerList(reqParam)
        //     .then((response) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            identifier_id: sessionStorage.getItem('identifier_id'),
            list_by: "pending_customers"
        }
        pendingNotificationCount(reqParam).then((count) => {
            $('.customer-pending-count').text(`${count}`);
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                //console.log("customerList response", response);
                fetch.replaceHtml(function () {
                    processPendingCustomerList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/pending_customers_list_wrapper", "#pending-customers-list-wrapper-template", "#pending-customer-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/pending_customers_list_data", "#pending-customers-list-data-template", "#pending-customers-list-wrapper", null);
                }, "page/customer/pending_customers_list_wrapper", "#pending-customers-list-wrapper-template", "#pending-customer-list-data-container", null);
            })
        }).catch((err) => {
            console.log('err',err);
        })
    });
}

function processPendingCustomerList(data, callback) {
    digibiz.customer_creation_pending_list = removeDuplicates(digibiz.customer_creation_pending_list.concat(data), "id");
    var customerList = {
        pending_customers_list_data: digibiz.customer_creation_pending_list,
    };
    //console.log("customerList", customerList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/pending_customers_list_data", "#pending-customers-list-data-template", "#pending-customers-list-wrapper", customerList);
}


//customer create page
function customerCreatePage() {
    addLoader();
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('digibiz_role') == "customer" && sessionStorage.getItem('edit_from') == "profile_page") {
            var reqParams = {
                device_id: crossplat.device.uuid,
                get_by: "id",
                id: sessionStorage.getItem('customer_id')
            }
            //get customer details
            customerGet(reqParams)
                .then((result) => {
                    if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                        if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                            result.identity_picture['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     if (err == "File not found-deleted or moved from cloud storage") {
                            //         delete result.identity_picture['avtarUrl'];
                            //         $('.customer-identity-picture-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-picture-delete').remove();
                            //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                            //         //append photo_camera first and then delete
                            //         $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                            //         $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                            //         $('#customer_identity_picture').remove();
                            //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                            //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                            //         delete result.identity_picture['avtarUrl'];
                            //         $('.customer-identity-picture-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-picture-delete').remove();
                            //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                            //         $('#customer_identity_picture').remove();
                            //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                            //     } else if (err == "Cloud storage not authenticated") {
                            //         delete result.identity_picture['avtarUrl'];
                            //         $('.customer-identity-picture-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-picture-delete').remove();
                            //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                            //         $('#customer_identity_picture').remove();
                            //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                            //     }
                            // })
                        }
                    }
                    if (result.hasOwnProperty('identity_video') && result.identity_video) {
                        if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                            result.identity_video['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     if (err == "File not found-deleted or moved from cloud storage") {
                            //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                            //         delete result.identity_video['avtarUrl'];
                            //         $('.customer-identity-video-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-video-delete').remove();
                            //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                            //         //append photo_camera first and then delete
                            //         $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                            //         $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                            //         $('#customer_identity_video').remove();
                            //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);

                            //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                            //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                            //         delete result.identity_video['avtarUrl'];
                            //         $('.customer-identity-video-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-video-delete').remove();
                            //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                            //         $('#customer_identity_video').remove();
                            //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);
                            //         $('.identity-picture-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                            //     } else if (err == "Cloud storage not authenticated") {
                            //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                            //         delete result.identity_video['avtarUrl'];
                            //         $('.customer-identity-video-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-video-delete').remove();
                            //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                            //         $('#customer_identity_video').remove();
                            //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);

                            //     }
                            // })
                        }
                    }
                    var customerData = {
                        customerData: result
                    }
                    fetch.replaceHtml(function () {
                        mobileFlaginit();
                        //change heading content
                        $('.customer-create-heading-name').text('Customer Details');
                        //hide main header
                        $('.header-band').addClass('hide');
                        //hide fields which are not to be shown
                        $('.customer-add-label-container').remove();
                        $('.customer-add-display-name-container').remove();
                        $('.customer-add-email-container').remove();
                        $('.customer-add-identifier-container').remove();
                        $('.employee-add-date-of-joining-container').remove();
                        $('.customer-back-btn').remove();
                        $('.customer-forward-btn').remove();
                        $('.register-customer-btn').remove();
                        $('.notify-customer-btn').remove();
                        $('.wizard-progress-container').remove();
                        $(`.customer-creation-parts-container[data-step="1"]`).remove();
                        $(`.customer-creation-parts-container[data-step="3"]`).remove();
                        $(`.customer-creation-parts-container[data-step="4"]`).remove();
                        //show the 2nd page content
                        $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                        //show save button
                        $('.save-customer-btn').removeClass('hide');
                        calenderInit('#customer_date_of_birth');
                        calenderInit('#customer_wedding_anniversary');
                        removeLoader();
                        resolve();
                    }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                })
                .catch((err) => {
                    console.log("err", err);
                    removeLoader();
                    Materialize.toast(err.msg, 3000, 'round error-alert');
                })
        } else {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "customer"
            }
            //get the primary customer identifiers list(for the sake of dropdown)
            customerIdentifierList(reqParam)
                .then((response) => {
                    //check for customer_id presence
                    if (sessionStorage.getItem('customer_id')) {
                        var reqParams = {
                            device_id: crossplat.device.uuid,
                            get_by: "id",
                            id: sessionStorage.getItem('customer_id')
                        }
                        //get customer details
                        customerGet(reqParams)
                            .then((result) => {
                                //console.log("result", result);
                                if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                                    if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                                        var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                                        result.identity_picture['avtarUrl'] = avtarUrl;
                                        // getImageUrl(avtarUrl).then((res) => {
                                        // }).catch((err) => {
                                        //     if (err == "File not found-deleted or moved from cloud storage") {
                                        //         delete result.identity_picture['avtarUrl'];
                                        //         $('.customer-identity-picture-multimedia-load-btn').remove();
                                        //         //remove delete
                                        //         $('#customer-identity-picture-delete').remove();
                                        //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                                        //         //append photo_camera first and then delete
                                        //         $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                                        //         $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                                        //         $('#customer_identity_picture').remove();
                                        //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                                        //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                                        //         delete result.identity_picture['avtarUrl'];
                                        //         $('.customer-identity-picture-multimedia-load-btn').remove();
                                        //         //remove delete
                                        //         $('#customer-identity-picture-delete').remove();
                                        //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                                        //         //append photo_camera first and then delete
                                        //         // $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                                        //         // $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                                        //         $('#customer_identity_picture').remove();
                                        //         // $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                                        //         $('.identity-picture-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);



                                        //     } else if (err == "Cloud storage not authenticated") {
                                        //         delete result.identity_picture['avtarUrl'];
                                        //         $('.customer-identity-picture-multimedia-load-btn').remove();
                                        //         //remove delete
                                        //         $('#customer-identity-picture-delete').remove();
                                        //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                                        //         //append photo_camera first and then delete
                                        //         // $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                                        //         // $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                                        //         $('#customer_identity_picture').remove();
                                        //         // $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                                        //         $('.identity-picture-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                                        //     }
                                        // })

                                    }
                                }
                                if (result.hasOwnProperty('identity_video') && result.identity_video) {
                                    if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                                        var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                                        result.identity_video['avtarUrl'] = avtarUrl;
                                        // getImageUrl(avtarUrl).then((res) => {
                                        // }).catch((err) => {
                                        //     if (err == "File not found-deleted or moved from cloud storage") {
                                        //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                                        //         result.identity_video['avtarUrl'] = avtarUrl;
                                        //         $('.customer-identity-video-multimedia-load-btn').remove();
                                        //         //remove delete
                                        //         $('#customer-identity-video-delete').remove();
                                        //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                                        //         //append photo_camera first and then delete
                                        //         $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                                        //         $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                                        //         $('#customer_identity_video').remove();
                                        //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);

                                        //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                                        //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                                        //         result.identity_video['avtarUrl'] = avtarUrl;
                                        //         $('.customer-identity-video-multimedia-load-btn').remove();
                                        //         //remove delete
                                        //         $('#customer-identity-video-delete').remove();
                                        //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                                        //         //append photo_camera first and then delete
                                        //         // $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                                        //         // $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                                        //         $('#customer_identity_video').remove();
                                        //         $('.identity-video-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                                        //     } else if (err == "Cloud storage not authenticated") {
                                        //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                                        //         result.identity_video['avtarUrl'] = avtarUrl;
                                        //         $('.customer-identity-video-multimedia-load-btn').remove();
                                        //         //remove delete
                                        //         $('#customer-identity-video-delete').remove();
                                        //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                                        //         //append photo_camera first and then delete
                                        //         // $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                                        //         // $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                                        //         $('#customer_identity_video').remove();
                                        //         $('.identity-video-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                                        //     }
                                        // })
                                    }
                                }
                                //first api call to customers collection to get all accepted and active associate customers
                                var reqParam = {
                                    device_id: crossplat.device.uuid,
                                    list_by: "business_customer",
                                    business_id: sessionStorage.getItem('business_id'),
                                    customer_id: sessionStorage.getItem('customer_id')
                                }
                                associateCustomerList(reqParam)
                                    .then((activeAssociateCustomerResponse) => {
                                        //console.log("activeAssociateCustomerResponse", activeAssociateCustomerResponse);
                                        //success, second api call to notification collection to get all pending associate customers for this particular primary customer
                                        var requestParms = {
                                            device_id: crossplat.device.uuid,
                                            list_by: "pending_associate_customer",
                                            business_id: sessionStorage.getItem('business_id'),
                                            customer_id: sessionStorage.getItem('customer_id')
                                        }
                                        notificationList(requestParms)
                                            .then((notifyresult) => {
                                                //console.log("notifyresult", notifyresult);
                                                //third, get roles
                                                var requestParam = {
                                                    device_id: crossplat.device.uuid,
                                                    list_by: "member",
                                                    member_id: sessionStorage.getItem('customer_id')
                                                }
                                                roleManagementList(requestParam)
                                                    .then((roleresponse) => {
                                                        //console.log("roleManagementList response", roleresponse);
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            activeAcceptedAssociateCustomers: activeAssociateCustomerResponse.map(p => {
                                                                if (p.hasOwnProperty('identity_picture') && p.identity_picture) {
                                                                    if (p.identity_picture.hasOwnProperty('thumbnail') && p.identity_picture.thumbnail) {
                                                                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${p.id}&device_id=${crossplat.device.uuid}&image_id=${p.identity_picture.thumbnail}`;
                                                                        p.identity_picture['avtarUrl'] = avtarUrl;
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    } else {
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    }
                                                                } else {
                                                                    p['imageLetter'] = p.name.first.charAt(0);
                                                                }
                                                                return p;
                                                            }),
                                                            pendingAssociateCustomers: notifyresult,
                                                            role_assignment: roleresponse
                                                        }
                                                        //console.log("customerData", customerData);
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                                    .catch((err) => {
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            activeAcceptedAssociateCustomers: activeAssociateCustomerResponse.map(p => {
                                                                if (p.hasOwnProperty('identity_picture') && p.identity_picture) {
                                                                    if (p.identity_picture.hasOwnProperty('thumbnail') && p.identity_picture.thumbnail) {
                                                                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${p.id}&device_id=${crossplat.device.uuid}&image_id=${p.identity_picture.thumbnail}`;
                                                                        p.identity_picture['avtarUrl'] = avtarUrl;
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    } else {
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    }
                                                                } else {
                                                                    p['imageLetter'] = p.name.first.charAt(0);
                                                                }
                                                                return p;
                                                            }),
                                                            pendingAssociateCustomers: notifyresult,
                                                        }
                                                        //console.log("customerData", customerData);
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                            })
                                            .catch((err) => {
                                                //third, get roles
                                                var requestParam = {
                                                    device_id: crossplat.device.uuid,
                                                    list_by: "member",
                                                    member_id: sessionStorage.getItem('customer_id')
                                                }
                                                roleManagementList(requestParam)
                                                    .then((roleresponse) => {
                                                        //console.log("roleManagementList response", roleresponse);
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            activeAcceptedAssociateCustomers: activeAssociateCustomerResponse.map(p => {
                                                                if (p.hasOwnProperty('identity_picture') && p.identity_picture) {
                                                                    if (p.identity_picture.hasOwnProperty('thumbnail') && p.identity_picture.thumbnail) {
                                                                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${p.id}&device_id=${crossplat.device.uuid}&image_id=${p.identity_picture.thumbnail}`;
                                                                        p.identity_picture['avtarUrl'] = avtarUrl;
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    } else {
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    }
                                                                } else {
                                                                    p['imageLetter'] = p.name.first.charAt(0);
                                                                }
                                                                return p;
                                                            }),
                                                            role_assignment: roleresponse
                                                        }
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                                    .catch((err) => {
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            activeAcceptedAssociateCustomers: activeAssociateCustomerResponse.map(p => {
                                                                if (p.hasOwnProperty('identity_picture') && p.identity_picture) {
                                                                    if (p.identity_picture.hasOwnProperty('thumbnail') && p.identity_picture.thumbnail) {
                                                                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${p.id}&device_id=${crossplat.device.uuid}&image_id=${p.identity_picture.thumbnail}`;
                                                                        p.identity_picture['avtarUrl'] = avtarUrl;
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    } else {
                                                                        p['imageLetter'] = p.name.first.charAt(0);
                                                                    }
                                                                } else {
                                                                    p['imageLetter'] = p.name.first.charAt(0);
                                                                }
                                                                return p;
                                                            }),
                                                        }
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                            })
                                    })
                                    .catch((err) => {
                                        //failure, second api call to notification collection to get all pending associate customers for this particular primary customer
                                        var requestParms = {
                                            device_id: crossplat.device.uuid,
                                            list_by: "pending_associate_customer",
                                            business_id: sessionStorage.getItem('business_id'),
                                            customer_id: sessionStorage.getItem('customer_id')
                                        }
                                        notificationList(requestParms)
                                            .then((notifyresult) => {
                                                //console.log("notifyresult", notifyresult);
                                                //third, get roles
                                                var requestParam = {
                                                    device_id: crossplat.device.uuid,
                                                    list_by: "member",
                                                    member_id: sessionStorage.getItem('customer_id')
                                                }
                                                roleManagementList(requestParam)
                                                    .then((roleresponse) => {
                                                        //console.log("roleManagementList response", roleresponse);
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            pendingAssociateCustomers: notifyresult,
                                                            role_assignment: roleresponse
                                                        }
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                                    .catch((err) => {
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            pendingAssociateCustomers: notifyresult,
                                                        }
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                            })
                                            .catch((err) => {
                                                //third, get roles
                                                var requestParam = {
                                                    device_id: crossplat.device.uuid,
                                                    list_by: "member",
                                                    member_id: sessionStorage.getItem('customer_id')
                                                }
                                                roleManagementList(requestParam)
                                                    .then((roleresponse) => {
                                                        //console.log("roleManagementList response", roleresponse);
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                            role_assignment: roleresponse
                                                        }
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            appScroll.scrollBar('#main-container');
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                                    .catch((err) => {
                                                        var customerData = {
                                                            customerData: result,
                                                            customerIdentifierList: response,
                                                        }
                                                        fetch.replaceHtml(function () {
                                                            mobileFlaginit();
                                                            calenderInit('#customer_date_of_birth');
                                                            calenderInit('#customer_wedding_anniversary');
                                                            //update customer identifier
                                                            if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                                                // var getValue = $('#customer-identifier-choose-select-dropdown').find(`option[data-id="${result.identifier_id}"]`).attr('value');
                                                                // $('#customer-identifier-choose-select-dropdown').val(getValue);
                                                                $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                                            }

                                                            //update the next and back button with step 2
                                                            $('.customer-back-btn').attr('data-present-step', '2');
                                                            $('.customer-forward-btn').attr('data-present-step', '2');
                                                            //update the stepper
                                                            $('.customer-create-stepper').removeClass('is-active');
                                                            $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                                            //show the next content
                                                            $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                                            $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                                            //hide the notify button and show the next button
                                                            $('.notify-customer-btn').addClass('hide');
                                                            $('.customer-forward-btn').removeClass('hide');
                                                            if (sessionStorage.getItem('digibiz_role') == "customer") {
                                                                $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                                                $('div[type="text"]').prop('disabled', true);
                                                                $('input[type="text"]').prop('disabled', true);
                                                                $('.mask').addClass('hide');
                                                                $('input[type="tel"]').prop('disabled', true);
                                                                $('.reassign-customer-btn').prop('disabled', true);
                                                                $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                                                $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                                            }
                                                            removeLoader();
                                                            resolve();
                                                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                                                    })
                                            })

                                    })
                            })
                            .catch((err) => {
                                //console.log("error in employeeGet")
                            })
                    } else {//not customer_id
                        var customerData = {
                            customerIdentifierList: response,
                        }
                        fetch.replaceHtml(function () {
                            mobileFlaginit();
                            calenderInit('#customer_date_of_birth');
                            calenderInit('#customer_wedding_anniversary');
                            removeLoader();
                            resolve();
                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                    }
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting customer identifiers list");
                })
        }
    });
}


function getCustomerNotificationDetailsPage() {
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('customer_notification_type') == "customer") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "customer_contact_logs",
                business_id: sessionStorage.getItem('business_id'),
                identifier_id: sessionStorage.getItem('identifier_id'),
                // contact_user_id: sessionStorage.getItem('contact_user_id')
                contact_uuid: sessionStorage.getItem('contact_uuid')
            }
        } else {
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "collaborator_customer_contact_logs",
                business_id: sessionStorage.getItem('business_id'),
                identifier_id: sessionStorage.getItem('identifier_id'),
                collaborator_business_id: sessionStorage.getItem('collaborator_business_id'),
            }
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                fetch.replaceHtml(function () {
                    processCustomerNotificationDetails(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/pending_customer_notification_details_list_wrapper", "#customer-notification-details-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/pending_customer_notification_details_list_data", "#customer-notification-details-data-list-template", "#customer-notification-details-list-wrapper", null);
                }, "page/customer/pending_customer_notification_details_list_wrapper", "#customer-notification-details-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}


function processCustomerNotificationDetails(data, callback) {
    digibiz.customer_notification_details_list = removeDuplicates(digibiz.customer_notification_details_list.concat(data.log_data), "id");
    var notificationList = {
        customer_notification_details: digibiz.customer_notification_details_list.map(e => {
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (data.last_notification.status.status == "active") {
                if (data.last_notification.contact.status.status == "rejected" || data.last_notification.contact.status.status == "expired") {
                    $('.fixed-action-btn').removeClass('hide');
                }
            }
            callback();
        }
    }, "page/customer/pending_customer_notification_details_list_data", "#customer-notification-details-data-list-template", "#customer-notification-details-list-wrapper", notificationList);
}

function validateCustomerStepTwo() {
    let validateIdentityPicture = false;
    let validateLabel = false;
    let validateDisplayName = false;
    let validateDisplayMobileNumber = false;
    let validateEmail = false;
    let validateCustomerIdentifier = false;
    var user = JSON.parse(sessionStorage.getItem('profile_details'));
    //validate display mobile number
    if ($('#add-customer-display-phone-number').val().length > 0) {
        if ($('#add-customer-display-phone-number').val().length == 0) {
            showError($('#add-customer-display-phone-number'), "Field is required.");
            validateDisplayMobileNumber = true;
        } else if ($('#add-customer-display-phone-number').intlTelInput("getNumber").length > 3) {
            if (!validate.checkIfIntelValidPhoneNumber($('#add-customer-display-phone-number'))) {
                showError($('#add-customer-display-phone-number'), `Invalid Phone number.`);
                validateDisplayMobileNumber = true;
            }
            //check if owner's mobile number 
            // if (user.login.mobile_number == $('#add-customer-display-phone-number').intlTelInput("getNumber")) {
            //     showError($('#add-customer-display-phone-number'), `Can't select your own mobile number`);
            //     validateDisplayMobileNumber = true;
            // }
        }
    }

    // validate label
    var labelValue = getInputText($('#customer_label_name')).trim();
    var labelLength = Array.from(labelValue).length;
    if (labelLength > 0) {
        if (labelLength < config.employeeMinNameLength) {
            showError($('#customer_label_name'), `This field should contain atleast ${config.employeeMinNameLength} characters.`);
            validateLabel = true;
        }
        if (labelLength > config.employeeMaxNameLength) {
            showError($('#customer_label_name'), `This field can't have more than  ${config.employeeMaxNameLength} characters.`);
            validateLabel = true;
        }
        if (labelLength >= config.employeeMinNameLength && labelLength <= config.employeeMaxNameLength) {
            validateLabel = false;
        }
    } else {
        showError($('#customer_label_name'), `This field is required.`);
        validateLabel = true;
    }

    // validate display name
    var displayNameValue = getInputText($('#customer_display_name')).trim();
    var displayNameLength = Array.from(displayNameValue).length;
    if (displayNameLength > 0) {
        if (displayNameLength < config.employeeMinNameLength) {
            showError($('#customer_display_name'), `This field should contain atleast ${config.employeeMinNameLength} characters.`);
            validateDisplayName = true;
        }
        if (displayNameLength > config.employeeMaxNameLength) {
            showError($('#customer_display_name'), `This field can't have more than  ${config.employeeMaxNameLength} characters.`);
            validateDisplayName = true;
        }
        if (displayNameLength >= config.employeeMinNameLength && displayNameLength <= config.employeeMaxNameLength) {
            validateDisplayName = false;
        }
    }

    //validate email(optional)
    if ($('#customer_email').text().length > 0) {
        if (!validate.checkIfValidEmail($('#customer_email').text())) {
            showError($('#customer_email'), "Invalid Email");
            validateEmail = true;
        }
    }

    //validate customer Identifier
    // if ($('#customer-identifier-choose-select-dropdown').val().length > 0) {
    //     validateCustomerIdentifier = false;
    // } else {
    //     validateCustomerIdentifier = true;
    //     showError($('#customer-identifier-choose-select-dropdown'), `This field is required`);
    // }
    if ($(`.customer-creation-parts-container[data-step="2"]`).find('.selected-value-customer-identifier').attr('data-value').length > 0) {
        validateCustomerIdentifier = false;
    } else {
        validateCustomerIdentifier = true;
        showError($(`.customer-creation-parts-container[data-step="2"]`).find('#customer-identifier-choose-select-dropdown'), `This field is required`);
    }

    if (validateIdentityPicture || validateEmail || validateCustomerIdentifier || validateDisplayName || validateDisplayMobileNumber || validateLabel) {
        return false;
    } else {
        return true;
    }

}

function validateCustomerProfileEdit() {
    let validateDisplayMobileNumber = false;
    let validateEmail = false;
    //validate display mobile number
    if ($('#add-customer-display-phone-number').val().length > 0) {
        if ($('#add-customer-display-phone-number').val().length == 0) {
            showError($('#add-customer-display-phone-number'), "Field is required.");
            validateDisplayMobileNumber = true;
        } else if ($('#add-customer-display-phone-number').intlTelInput("getNumber").length > 3) {
            if (!validate.checkIfIntelValidPhoneNumber($('#add-customer-display-phone-number'))) {
                showError($('#add-customer-display-phone-number'), `Invalid Phone number.`);
                validateDisplayMobileNumber = true;
            }
        }
    }

    //validate email(optional)
    if ($('#customer_alternate_email').text().length > 0) {
        if (!validate.checkIfValidEmail($('#customer_alternate_email').text())) {
            showError($('#customer_alternate_email'), "Invalid Email");
            validateEmail = true;
        }
    }

    if (validateEmail || validateDisplayMobileNumber) {
        return false;
    } else {
        return true;
    }
}

function processPendingAssociateCustomerNotificationDetailsList(data, callback) {
    //console.log("data", data);
    digibiz.associate_customer_notification_details_list = removeDuplicates(digibiz.associate_customer_notification_details_list.concat(data.log_data), 'id');

    var notificationList = {
        associate_customer_notification_details: digibiz.associate_customer_notification_details_list.map(e => {
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (data.last_notification.status.status == "active") {
                if (data.last_notification.contact.status.status == "rejected" || data.last_notification.contact.status.status == "expired") {
                    $('.fixed-action-btn').removeClass('hide');
                }
            }
            callback();
        }
    }, "page/customer/pending_associate_customer_notification_details_list_data", "#associate-customer-notification-details-data-list-template", "#associate-customer-notification-details-list", notificationList);

}

function validateAssociateCustomer() {
    let validateDisplayName = false;
    let validateDisplayMobileNumber = false;
    let validateEmail = false;
    let validateAssociateCustomerIdentifier = false;
    var user = JSON.parse(sessionStorage.getItem('profile_details'));
    //validate display mobile number
    if ($('#add-associate-customer-display-phone-number').val().length > 0) {
        if ($('#add-associate-customer-display-phone-number').val().length == 0) {
            showError($('#add-associate-customer-display-phone-number'), "Field is required.");
            validateDisplayMobileNumber = true;
        } else if ($('#add-associate-customer-display-phone-number').intlTelInput("getNumber").length > 3) {
            if (!validate.checkIfIntelValidPhoneNumber($('#add-associate-customer-display-phone-number'))) {
                showError($('#add-associate-customer-display-phone-number'), `Invalid Phone number.`);
                validateDisplayMobileNumber = true;
            }
            //check if owner's mobile number 
            if (user.login.mobile_number == $('#add-associate-customer-display-phone-number').intlTelInput("getNumber")) {
                showError($('#add-associate-customer-display-phone-number'), `Can't select your own mobile number`);
                validateDisplayMobileNumber = true;
            }
        }
    }

    // validate display name
    var displayNameValue = getInputText($('#associate_customer_display_name')).trim();
    var displayNameLength = Array.from(displayNameValue).length;
    if (displayNameLength > 0) {
        if (displayNameLength < config.employeeMinNameLength) {
            showError($('#associate_customer_display_name'), `This field should contain atleast ${config.employeeMinNameLength} characters.`);
            validateDisplayName = true;
        }
        if (displayNameLength > config.employeeMaxNameLength) {
            showError($('#associate_customer_display_name'), `This field can't have more than  ${config.employeeMaxNameLength} characters.`);
            validateDisplayName = true;
        }
        if (displayNameLength >= config.employeeMinNameLength && displayNameLength <= config.employeeMaxNameLength) {
            validateDisplayName = false;
        }
    }

    //validate email(optional)
    if ($('#associate_customer_email').text().length > 0) {
        if (!validate.checkIfValidEmail($('#associate_customer_email').text())) {
            showError($('#associate_customer_email'), "Invalid Email");
            validateEmail = true;
        }
    }

    //validate customer Identifier
    // if ($('#associate-customer-identifier-choose-select-dropdown').val().length > 0) {
    //     validateAssociateCustomerIdentifier = false;
    // } else {
    //     validateAssociateCustomerIdentifier = true;
    //     showError($('#associate-customer-identifier-choose-select-dropdown'), `This field is required`);
    // }

    if ($('.selected-value-associate-customer-identifier').attr('data-value').length > 0) {
        validateAssociateCustomerIdentifier = false;
    } else {
        validateAssociateCustomerIdentifier = true;
        showError($('.selected-value-associate-customer-identifier'), `This field is required`);
    }


    if (validateEmail || validateAssociateCustomerIdentifier || validateDisplayName || validateDisplayMobileNumber) {
        return false;
    } else {
        return true;
    }
}

function validateAssociateCustomerProfile() {
    let validateDisplayMobileNumber = false;
    let validateEmail = false;
    //validate display mobile number
    if ($('#add-associate-customer-display-phone-number').val().length > 0) {
        if ($('#add-associate-customer-display-phone-number').val().length == 0) {
            showError($('#add-associate-customer-display-phone-number'), "Field is required.");
            validateDisplayMobileNumber = true;
        } else if ($('#add-associate-customer-display-phone-number').intlTelInput("getNumber").length > 3) {
            if (!validate.checkIfIntelValidPhoneNumber($('#add-associate-customer-display-phone-number'))) {
                showError($('#add-associate-customer-display-phone-number'), `Invalid Phone number.`);
                validateDisplayMobileNumber = true;
            }
        }
    }

    //validate email(optional)
    if ($('#associate_customer_alternate_email').text().length > 0) {
        if (!validate.checkIfValidEmail($('#associate_customer_alternate_email').text())) {
            showError($('#associate_customer_alternate_email'), "Invalid Email");
            validateEmail = true;
        }
    }

    if (validateEmail || validateDisplayMobileNumber) {
        return false;
    } else {
        return true;
    }

}

function getCustomerContactsIdentifiersListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer"
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                fetch.replaceHtml(function () {
                    processCustomerContactsIdentifiersList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/customer_contacts_identifiers_list_wrapper", "#customer-contacts-identifiers-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/customer_contacts_identifiers_list_data", "#customer-contacts-identifiers-list-data-template", "#customer-contacts-identifiers-list-wrapper", null);
                }, "page/customer/customer_contacts_identifiers_list_wrapper", "#customer-contacts-identifiers-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processCustomerContactsIdentifiersList(data, callback) {
    digibiz.customer_contacts_identifiers_list = removeDuplicates(digibiz.customer_contacts_identifiers_list.concat(data), "id");
    var getData = {
        customer_contacts_identifiers_list_data: digibiz.customer_contacts_identifiers_list,
        list_for: "customer_contacts_module"
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_contacts_identifiers_list_data", "#customer-contacts-identifiers-list-data-template", "#customer-contacts-identifiers-list-wrapper", getData);
}

function standardCustomerGroupsIdentifierListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer",
            limit: 15,
            offset: 0
        }
        var countParam = {
            device_id: crossplat.device.uuid,
            type: "customer",
            business_id: sessionStorage.getItem('business_id'),
            list_by: "basic_customer_groups",
        }
        getGroupsCount(countParam).then((groupsCount) => {
            $('.standard-customer-groups-count').text(groupsCount);
            var countParamss = {
                device_id: crossplat.device.uuid,
                type: "customer",
                business_id: sessionStorage.getItem('business_id'),
                list_by: "custom_groups",
                group_for: "customer",
                customer_group_type: "custom"
            }
            getGroupsCount(countParamss).then((groupsCount) => {
                $('.custom-customer-groups-count').text(groupsCount);
                customerIdentifierList(reqParam)
                    .then((response) => {
                        var FinalData = [];
                        //console.log("customerIdentifierList response", response);
                        $.each(response, function (index, data) {
                            FinalData.push(data);
                        })
                        var requesParam = {
                            device_id: crossplat.device.uuid,
                            type: "customer",
                            business_id: sessionStorage.getItem('business_id'),
                            list_by: "basic_customer_groups",
                        }
                        groupsList(requesParam)
                            .then((result) => {
                                //console.log("success", result);
                                $.each(result, function (index, data) {
                                    FinalData.push(data);
                                })
                                fetch.replaceHtml(function () {
                                    processStandardCustomerGroupsIdentifiersList(FinalData, function () {
                                        // listenForStandardCustomerGroupsIdentifiersListScrollEvent($('.standard-customer-groups-identifiers-list-data-contentbox'));
                                        removeLoader();
                                        resolve();
                                    });
                                }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
                            })
                            .catch((err) => {
                                fetch.replaceHtml(function () {
                                    fetch.replaceHtml(function (err) {
                                        if (!err) {
                                            removeLoader();
                                            resolve();
                                        }
                                    }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", null);
                                }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
                            })
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", null);
                        }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
                    })

            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    });
}

function processStandardCustomerGroupsIdentifiersList(data, callback) {
    digibiz.standard_customer_groups_identifiers_list = removeDuplicates(digibiz.standard_customer_groups_identifiers_list.concat(data), "id");
    // digibiz.standard_customer_groups_identifiers_list.sort(function (a, b) {
    //     var nameA = a.identifier.toLowerCase(), nameB = b.identifier.toLowerCase();
    //     if (nameA < nameB) //sort string ascending
    //         return -1;
    //     if (nameA > nameB)
    //         return 1;
    //     return 0; //default return value (no sorting)
    // });
    var getData = {
        standard_customer_groups_identifiers_list_data: digibiz.standard_customer_groups_identifiers_list,
        // data_for: sessionStorage.getItem('customer_module')
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
            appScroll.scrollBar('.standard-customer-groups-identifiers-list-data-contentbox');
        }
    }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", getData);
}

// function listenForStandardCustomerGroupsIdentifiersListScrollEvent(el) {
//     $(el).off('el_scroll');
//     el.on("el_scroll", function (event) {
//         if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
//             $(this).off('el_scroll');
//             var reqParam = {
//                 device_id: crossplat.device.uuid,
//                 business_id: sessionStorage.getItem('business_id'),
//                 list_by: "customer",
//                 limit:15,
//                 offset:0
//             }
//             customerIdentifierList(reqParam)
//                 .then((response) => {
//                     var FinalData = [];
//                     //console.log("customerIdentifierList response", response);
//                     $.each(response, function (index, data) {
//                         FinalData.push(data);
//                     })
//                     var requesParam = {
//                         device_id: crossplat.device.uuid,
//                         type: "customer",
//                         business_id: sessionStorage.getItem('business_id'),
//                         list_by: "basic_customer_groups",
//                         limit:15,
//                         offset:0
//                     }
//                     groupsList(requesParam)
//                         .then((result) => {
//                             //console.log("success", result);
//                             $.each(result, function (index, data) {
//                                 FinalData.push(data);
//                             })
//                             // fetch.replaceHtml(function () {
//                                 processStandardCustomerGroupsIdentifiersList(FinalData, function () {
//                                     listenForStandardCustomerGroupsIdentifiersListScrollEvent($('.standard-customer-groups-identifiers-list-data-contentbox'));
//                                     removeLoader();
//                                     resolve();
//                                 });
//                             // }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
//                         })
//                         .catch((err) => {

//                         })
//                 })
//                 .catch((err) => {

//                 })

//         }
//     });
// }


// function scrollProcessStandardCustomerGroupsIdentifiersList(data, callback) {
//     digibiz.standard_customer_groups_identifiers_list = removeDuplicates(digibiz.standard_customer_groups_identifiers_list.concat(data), "id");
//     // digibiz.standard_customer_groups_identifiers_list.sort(function (a, b) {
//     //     var nameA = a.identifier.toLowerCase(), nameB = b.identifier.toLowerCase();
//     //     if (nameA < nameB) //sort string ascending
//     //         return -1;
//     //     if (nameA > nameB)
//     //         return 1;
//     //     return 0; //default return value (no sorting)
//     // });
//     var getData = {
//         standard_customer_groups_identifiers_list_data: digibiz.standard_customer_groups_identifiers_list,
//         // data_for: sessionStorage.getItem('customer_module')
//     };
//     //console.log("getData", getData);
//     fetch.replaceHtml(function (err) {
//         if (!err) {
//             callback();
//             appScroll.scrollBar('.standard-customer-groups-identifiers-list-data-contentbox');
//         }
//     }, "page/customer/scroll_standard_customer_groups_identifiers_list_data", "#scroll-standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper .os-content", getData);
// }


function getCustomerContactsItemsListPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            list_by: "primary_customer_identifier",
            primary_customer_identifier_id: sessionStorage.getItem('identifier_id')
        }
        listContactsList(reqParams)
            .then((response) => {
                //console.log("listContactsList response", response);
                fetch.replaceHtml(function () {
                    processCustomerContactsItemsList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/contacts_items_list_wrapper", "#contacts-items-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/contacts_items_list_data", "#contact-items-list-data-template", "#contacts-items-list-wrapper", null);
                }, "page/customer/contacts_items_list_wrapper", "#contacts-items-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processCustomerContactsItemsList(data, callback) {
    digibiz.contacts_items_list = removeDuplicates(digibiz.contacts_items_list.concat(data), "id");
    var getData = {
        contacts_items_list_data: digibiz.contacts_items_list,
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/contacts_items_list_data", "#contact-items-list-data-template", "#contacts-items-list-wrapper", getData);
}

function getCustomerContactListPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('item_id')
        }
        getContactList(reqParams)
            .then((response) => {
                //console.log("getContactList response", response);
                fetch.replaceHtml(function () {
                    processCustomerContactList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/customer_contact_list_wrapper", "#customer-contact-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/customer_contact_list_data", "#customer-contact-list-data-template", "#customer-contact-list-wrapper", null);
                }, "page/customer/customer_contact_list_wrapper", "#customer-contact-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processCustomerContactList(data, callback) {
    digibiz.contacts_list = removeDuplicates(digibiz.contacts_list.concat(data), "id");
    var getData = {
        customer_contact_list_data: digibiz.contacts_list,
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_contact_list_data", "#customer-contact-list-data-template", "#customer-contact-list-wrapper", getData);
}

//customer groups
function getCustomerGroupsListPage() {
    return new Promise((resolve, reject) => {
        //get session storage to check standard groups or custom groups
        if (sessionStorage.getItem('selected-customer-group-type-tab') == 'custom') {
            //get all custom groups
            var reqParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                group_for: "customer",
                customer_group_type: "custom"
            }
            groupsList(reqParams)
                .then((response) => {
                    //console.log("employeeGroupList response", response);
                    fetch.replaceHtml(function () {
                        processCustomerCustomGroupList(response, function () {
                            removeLoader();
                            resolve();
                        });
                    }, "page/customer/customer_custom_groups_list_wrapper", "#customer-custom-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/customer/customer_custom_groups_list_data", "#customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper", null);
                    }, "page/customer/customer_custom_groups_list_wrapper", "#customer-custom-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
        } else if (sessionStorage.getItem('selected-customer-group-type-tab') == 'standard') {
            //get all groups of this identifier
            var getPrimaryIdentifierId = sessionStorage.getItem('identifier_id');
            var reqParams = {
                device_id: crossplat.device.uuid,
                type: "customer",
                business_id: sessionStorage.getItem('business_id'),
                list_by: "primary_identifier",
                group_for: "customer",
                parent_customer_identifier_id: getPrimaryIdentifierId
            }
            groupsList(reqParams)
                .then((response) => {
                    fetch.replaceHtml(function () {
                        processCustomerGroupList(response, function () {
                            removeLoader();
                            resolve();
                        });
                    }, "page/customer/customer_groups_list_wrapper", "#customer-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/customer/customer_groups_list_data", "#customer-groups-list-data-template", "#customer-groups-list-wrapper", null);
                    }, "page/customer/customer_groups_list_wrapper", "#customer-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
        }
    })
}

function processCustomerGroupList(data, callback) {
    digibiz.groups_list = removeDuplicates(digibiz.groups_list.concat(data), "id");
    var getData = {
        customer_groups_list_data: digibiz.groups_list.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_groups_list_data", "#customer-groups-list-data-template", "#customer-groups-list-wrapper", getData);
}

function processCustomerCustomGroupList(data, callback) {
    digibiz.custom_groups_list = removeDuplicates(digibiz.custom_groups_list.concat(data), "id");
    var getData = {
        customer_custom_groups_list_data: digibiz.custom_groups_list.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            appScroll.scrollBar('.customer-custom-groups-list-contentbox');
            callback();
        }
    }, "page/customer/customer_custom_groups_list_data", "#customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper", getData);
}

function listenForCustomerCustomGroupListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');

            var reqParams = {
                device_id: crossplat.device.uuid,
                type: "customer",
                business_id: sessionStorage.getItem('business_id'),
                list_by: "custom_groups",
                group_for: "customer",
                customer_group_type: "custom",
                offset: digibiz.custom_groups_list.length,
                count: 5
            }
            groupsList(reqParams)
                .then((response) => {
                    //console.log("employeeGroupList response", response);
                    scrollProcessCustomerCustomGroupList(response, function () {
                        listenForCustomerCustomGroupListScrollEvent($('.customer-custom-groups-list-contentbox'));
                        removeLoader();
                    });
                })
                .catch((err) => {

                })
        }
    });
}

function scrollProcessCustomerCustomGroupList(data, callback) {
    digibiz.custom_groups_list = removeDuplicates(digibiz.custom_groups_list.concat(data), "id");
    var getData = {
        customer_custom_groups_list_data: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_customer_custom_groups_list_data", "#scroll-customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper .os-content", getData);
}

function customCustomerGroupsListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        //get all custom groups
        var reqParams = {
            device_id: crossplat.device.uuid,
            type: "customer",
            business_id: sessionStorage.getItem('business_id'),
            list_by: "custom_groups",
            group_for: "customer",
            customer_group_type: "custom",
            offset: 0,
            count: 20,
        }
        var countreqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "basic_customer_groups",
            type: "customer",
        }
        getGroupsCount(countreqParam).then((groupsCount) => {
            $('.standard-customer-groups-count').text(groupsCount);
            var countreqParamss = {
                device_id: crossplat.device.uuid,
                type: "customer",
                business_id: sessionStorage.getItem('business_id'),
                list_by: "custom_groups",
                group_for: "customer",
                customer_group_type: "custom"
            }
            getGroupsCount(countreqParamss).then((groupsCount) => {
                $('.custom-customer-groups-count').text(groupsCount);
                groupsList(reqParams)
                    .then((response) => {
                        //console.log("employeeGroupList response", response);
                        fetch.replaceHtml(function () {
                            processCustomerCustomGroupList(response, function () {
                                listenForCustomerCustomGroupListScrollEvent($('.customer-custom-groups-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/customer/customer_custom_groups_list_wrapper", "#customer-custom-groups-list-wrapper-template", "#custom-customer-group-type-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    appScroll.scrollBar('.customer-custom-groups-list-contentbox');
                                    resolve();
                                }
                            }, "page/customer/customer_custom_groups_list_data", "#customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper", null);
                        }, "page/customer/customer_custom_groups_list_wrapper", "#customer-custom-groups-list-wrapper-template", "#custom-customer-group-type-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    });
}

function getCustomerGroupsDetailPage() {
    //console.log("getCustomerGroupsDetailPage");
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('group_id') === undefined || sessionStorage.getItem('group_id') === null || sessionStorage.getItem('group_id') == "") {
            var getData = {
                group_type: "custom"
            }
            fetch.replaceHtml(function () {
                removeLoader();
                console.log("Raja 1");
                resolve();
            }, "page/customer/customer_group_details_page", "#customer-group-details-template", "#main-content-wrapper", getData);
        } else {
            if (sessionStorage.getItem('group_type') == "standard" || sessionStorage.getItem('group_type') == "primary_associate_customers" || sessionStorage.getItem('group_type') == "primary_customers") {
                var requestparams = {
                    device_id: crossplat.device.uuid,
                    business_id: sessionStorage.getItem('business_id'),
                    list_by: "primary_customer"
                }
                customerIdentifierList(requestparams)
                    .then((identifierResponse) => {
                        //console.log("customerIdentifierList response", identifierResponse);
                        var reqparams = {
                            device_id: crossplat.device.uuid,
                            id: sessionStorage.getItem('group_id')
                        }
                        groupGet(reqparams)
                            .then((response) => {
                                //console.log("employeeGroupGet response", response);
                                if (response.hasOwnProperty('group_image') && response.group_image) {
                                    if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                        response.group_image['avtarUrl'] = avtarUrl;
                                        response['imageLetter'] = response.name.charAt(0);
                                    } else {
                                        response['imageLetter'] = response.name.charAt(0);
                                    }
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                                //console.log("response", response);
                                var groupData = {
                                    group_data: response,
                                    label_name: identifierResponse[0].identifier.trim()
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        console.log("Raja 2");
                                        resolve();
                                    }
                                }, "page/customer/customer_group_details_page", "#customer-group-details-template", "#main-content-wrapper", groupData);
                            })
                            .catch((err) => {
                                //console.log("error in employee group get");
                                removeLoader();
                                resolve();
                            })
                    })
                    .catch((err) => {
                        //console.log("error in employee group get");
                        removeLoader();
                        resolve();
                    })
            } else if (sessionStorage.getItem('group_type') == "custom") {
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id')
                    }
                    groupGet(reqparams)
                        .then((response) => {
                            //console.log("employeeGroupGet response", response);
                            if (response.hasOwnProperty('group_image') && response.group_image) {
                                if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                    response.group_image['avtarUrl'] = avtarUrl;
                                    response['imageLetter'] = response.name.charAt(0);
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                            } else {
                                response['imageLetter'] = response.name.charAt(0);
                            }
                            var requestParams = {
                                device_id: crossplat.device.uuid,
                                group_id: sessionStorage.getItem('group_id'),
                                count: 5,
                                offset: 0
                            }
                            getGroupMembers(requestParams)
                                .then((mebresponse) => {
                                    var membersResponse = mebresponse.membersList;
                                    digibiz.customer_group_members_list = [];
                                    digibiz.customer_group_members_list = membersResponse;
                                    // //console.log("GroupMemberList response", membersResponse);
                                    var groupData = {
                                        group_data: response,
                                        membersCount: mebresponse.membersCount,
                                        group_members_data: membersResponse.map(e => {
                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.customer_id}&device_id=${crossplat.device.uuid}`;
                                                e.identity_picture['avtarUrl'] = avtarUrl;
                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                // } else {
                                                //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                // }
                                            } else {
                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                            }
                                            return e;
                                        })
                                    }
                                    //console.log("groupData", groupData);
                                    fetch.replaceHtml(function (err) {
                                        if (!err) {
                                            $('#modal-employee-selection').remove();
                                            appScroll.scrollBar('#main-container');
                                            appScroll.scrollBar('#customer-group-members-list');
                                            listenForCustomerGroupContactsMembersList($('#customer-group-members-list'));

                                            removeLoader();
                                            console.log("Raja 3");
                                            resolve();
                                        }
                                    }, "page/customer/customer_group_details_page", "#customer-group-details-template", "#main-content-wrapper", groupData);
                                })
                                .catch((err) => {
                                    //console.log("error in employee group members data");
                                    var groupData = {
                                        group_data: response
                                    }
                                    //console.log("groupData", groupData);
                                    fetch.replaceHtml(function (err) {
                                        if (!err) {
                                            $('#modal-employee-selection').remove();
                                            removeLoader();
                                            console.log("Raja 4");
                                            resolve();
                                        }
                                    }, "page/customer/customer_group_details_page", "#customer-group-details-template", "#main-content-wrapper", groupData);
                                })
                        })
                        .catch((err) => {
                            //console.log("error in employee group get");
                            removeLoader();
                            resolve();
                        })
                } else if (sessionStorage.getItem('group_from') == "group_list") {
                    var reqparams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id')
                    }
                    groupGet(reqparams)
                        .then((response) => {
                            console.log("employeeGroupGet response", response);
                            if (response.hasOwnProperty('group_image') && response.group_image) {
                                if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                    response.group_image['avtarUrl'] = avtarUrl;
                                    // response['imageLetter'] = response.name.charAt(0);
                                } else {
                                    response['imageLetter'] = response.name.charAt(0);
                                }
                            } else {
                                response['imageLetter'] = response.name.charAt(0);
                            }
                            var groupData = {
                                group_data: response,
                                group_members_data: response.customer_data.map(e => {
                                    e['imageLetter'] = e.name.charAt(0);
                                    return e;
                                })
                            }
                            digibiz.customer_group_members_list = response.customer_data;
                            console.log("groupData", groupData);
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    // $('#custom-employee-group-department-list-modal').remove();
                                    removeLoader();
                                    appScroll.scrollBar('#main-container');
                                    appScroll.scrollBar('#customer-group-members-list');
                                    listenForCustomerGroupGroupMembersList($('#customer-group-members-list'));
                                    resolve();
                                }
                            }, "page/customer/customer_group_details_page", "#customer-group-details-template", "#main-content-wrapper", groupData);
                        })
                        .catch((err) => {
                            console.log("error in employee group get",err);
                            removeLoader();
                            resolve();
                        })
                }
            }
        }
    })
}

function validateCustomerGroup() {
    let validateGroupName = false;
    let validateGroupDescription = false;
    let validateGroupVisibility = false;
    let validateGroupMembers = false;
    //validate group name
    var groupNameValue = $('#customerGroupName').val();
    if (groupNameValue.length > 0) {
        if (groupNameValue.length < config.EmployeeGroupNameMinLength) {
            showError($('#customerGroupName'), `This field should contain atleast ${config.EmployeeGroupNameMinLength} characters.`);
            validateGroupName = true;
        }
        if (groupNameValue.length > config.EmployeeGroupNameMaxLength) {
            showError($('#customerGroupName'), `This field can't have more than  ${config.EmployeeGroupNameMaxLength} characters.`);
            validateGroupName = true;
        }
        if (groupNameValue.length >= config.EmployeeGroupNameMinLength && groupNameValue.length <= config.EmployeeGroupNameMaxLength) {
            validateGroupName = false;
        }
    } else {
        showError($('#customerGroupName'), `This field is required.`);
        validateGroupName = true;
    }

    //validate group description
    var groupDescriptionValue = $('#customer_group_desc').val();
    if (groupDescriptionValue.length > 0) {
        if (groupDescriptionValue.length < config.EmployeeGroupDescriptionMinLength) {
            showError($('#customer_group_desc'), `This field should contain atleast ${config.EmployeeGroupDescriptionMinLength} characters.`);
            validateGroupDescription = true;
        }
        if (groupDescriptionValue.length > config.EmployeeGroupDescriptionMaxLength) {
            showError($('#customer_group_desc'), `This field can't have more than  ${config.EmployeeGroupDescriptionMaxLength} characters.`);
            validateGroupDescription = true;
        }
        if (groupDescriptionValue.length >= config.EmployeeGroupDescriptionMinLength && groupDescriptionValue.length <= config.EmployeeGroupDescriptionMaxLength) {
            validateGroupDescription = false;
        }
    } else {
        // showError($('#customer_group_desc'), `This field is required.`);
        validateGroupDescription = false;
    }

    //validate visibility
    // if ($('#select-visibility-type').val() == "") {
    //     showError($('#select-visibility-type'), `This field is required.`);
    //     validateGroupVisibility = true;
    // } else {
    //     validateGroupVisibility = false;
    // }
    if ($('.selected-value-group-visbility').attr('data-value').length > 0) {
        validateGroupVisibility = false;
    } else {
        showError($('#select-visibility-type'), `This field is required.`);
        validateGroupVisibility = true;
    }

    // validate group members
    if (sessionStorage.getItem('group_type') == "custom") {
        if (sessionStorage.getItem('group_id')) {

        } else {
            if (sessionStorage.getItem('group_from')) {
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    // if (digibiz.employee_group_employee_members.filter(e => e.hasOwnProperty('selected') && e.selected).length > 0) {
                    //     validateGroupMembers = false;
                    // } else {
                    //     Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                    //     validateGroupMembers = true;
                    // }
                    if ($("input[name='selectedmembers[]']:checked").length > 0) {
                        if ($("input[name='selectedmembers[]']:checked").length > 1) {//min 2 members in the group
                            validateGroupMembers = false;
                        } else {
                            Materialize.toast(`Minimum 2 group members are required.`, 3000, 'round success-alert');
                            validateGroupMembers = true;
                        }
                    } else {
                        Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                        validateGroupMembers = true;
                    }
                } else if (sessionStorage.getItem('group_from') == "group_list") {
                    if ($("input[name='selectedmembers[]']:checked").length > 0) {
                        if ($("input[name='selectedmembers[]']:checked").length > 1) {//min 2 members in the group
                            validateGroupMembers = false;
                        } else {
                            Materialize.toast(`Minimum 2 group members are required.`, 3000, 'round success-alert');
                            validateGroupMembers = true;
                        }
                    } else {
                        Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                        validateGroupMembers = true;
                    }
                }
            } else {
                Materialize.toast(`Please add group members`, 3000, 'round success-alert');
                validateGroupMembers = true;
            }
        }
    } else {
        validateGroupMembers = false;
    }

    if (validateGroupName || validateGroupDescription || validateGroupVisibility || validateGroupMembers) {
        return false;
    } else {
        return true;
    }
}


/******************CUSTOMER MANAGEMENT(ends)************************/

/******************COLLABAORATOR MANAGEMENT(starts)************************/
function getBusinessNotificationsPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "my_business_notifications",
            sort_by: "contacts",
            count: 20,
            offset: 0
        }
        businessNotificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                // fetch.replaceHtml(function () {
                processBusinessNotificationsList(response, function () {
                    appScroll.scrollBar('.business-notifications-list-contentbox');
                    listenForBusinessNotificationsListScrollEvent($('.business-notifications-list-contentbox'));
                    removeLoader();
                    resolve();
                });
                // }, "page/business/business_notifications_wrapper", "#business-notifications-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                // fetch.replaceHtml(function () {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/business/business_notifications_data", "#business-notifications-data-list-template", "#business-notifications-list-wrapper", null);
                // }, "page/business/business_notifications_wrapper", "#business-notifications-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processBusinessNotificationsList(data, callback) {
    digibiz.business_notifications = removeDuplicates(digibiz.business_notifications.concat(data), "id");//changed from contact.user_id
    var notificationList = {
        business_notification_list_data: digibiz.business_notifications.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            //console.log("check", typeof (e.expiryDate))
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/business_notifications_data", "#business-notifications-data-list-template", "#business-notifications-list-wrapper", notificationList);
}

function listenForBusinessNotificationsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "my_business_notifications",
                sort_by: "contacts",
                count: 20,
                offset: digibiz.business_notifications.length
            }

            businessNotificationList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessBusinessNotificationsList(response, function () {
                        listenForBusinessNotificationsListScrollEvent($('.business-notifications-list-contentbox'));

                    });
                }).catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/business/scroll_business_notifications_data", "#scroll-business-notifications-data-list-template", "#business-notifications-list-wrapper .os-content", null);

                });

        }
    });
}

function scrollProcessBusinessNotificationsList(data, callback) {
    digibiz.business_notifications = removeDuplicates(digibiz.business_notifications.concat(data), "id");//changed from contact.user_id
    var notificationList = {
        business_notification_list_data: data.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            //console.log("check", typeof (e.expiryDate))
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/business/scroll_business_notifications_data", "#scroll-business-notifications-data-list-template", "#business-notifications-list-wrapper .os-content", notificationList);
}



/**
 * 
 * group business notification list
 */


function getGroupBusinessNotificationsPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "my_business_notifications",
            sort_by: "groups",
            count: 20,
            offset: 0
        }
        businessNotificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                // fetch.replaceHtml(function () {
                processGroupsBusinessNotificationsList(response, function () {
                    appScroll.scrollBar('.business-notifications-list-contentbox');
                    listenForGroupsBusinessNotificationsListScrollEvent($('.business-notifications-list-contentbox'));
                    removeLoader();
                    resolve();
                });
                // }, "page/business/business_notifications_wrapper", "#business-notifications-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                // fetch.replaceHtml(function () {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/business/business_notifications_data", "#business-notifications-data-list-template", "#business-notifications-list-wrapper", null);
                // }, "page/business/business_notifications_wrapper", "#business-notifications-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processGroupsBusinessNotificationsList(data, callback) {
    digibiz.group_business_notifications = removeDuplicates(digibiz.group_business_notifications.concat(data), "id");//changed from contact.user_id
    var notificationList = {
        business_notification_list_data: digibiz.group_business_notifications.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            //console.log("check", typeof (e.expiryDate))
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/group_business_notifications_data", "#group-business-notifications-data-list-template", "#group-business-notifications-list-wrapper", notificationList);
}

function listenForGroupsBusinessNotificationsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "my_business_notifications",
                sort_by: "groups",
                count: 20,
                offset: digibiz.group_business_notifications.length
            }

            businessNotificationList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessGroupsBusinessNotificationsList(response, function () {
                        listenForGroupsBusinessNotificationsListScrollEvent($('.business-notifications-list-contentbox'));

                    });
                }).catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/business/scroll_group_business_notifications_data", "#scroll-group-business-notifications-data-list-template", "#group-business-notifications-list-wrapper .os-content", null);

                });

        }
    });
}

function scrollProcessGroupsBusinessNotificationsList(data, callback) {
    digibiz.group_business_notifications = removeDuplicates(digibiz.group_business_notifications.concat(data), "id");//changed from contact.user_id
    var notificationList = {
        business_notification_list_data: data.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            //console.log("check", typeof (e.expiryDate))
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/business/scroll_group_business_notifications_data", "#scroll-group-business-notifications-data-list-template", "#group-business-notifications-list-wrapper .os-content", notificationList);
}

/**
 * 
 * end buinsess notifications
 */


function collaboratorHubPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            removeLoader();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/collaborator/collaborator_management_hub", "#collaborator-management-land-page", "#main-content-wrapper", null);
    })
}

function activeCollaboratorContactListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "my_collaborators",
            count: 15,
            offset: 0
        }
        collaboratorCount(reqParam).then((count) => {
            $('.collaborator-active-count').text(`${count}`);
            var pendingreqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "my_pending_collaborator_contact_list_notifications"
            }
            pendingCollaboratorCount(pendingreqParam).then((collbCount) => {
                $('.pending-collaborator-count').text(`${collbCount}`);
                collaboratorList(reqParam)
                    .then((response) => {
                        //console.log("collaboratorList response", response);
                        fetch.replaceHtml(function () {
                            processActiveCollaboratorContactList(response, function () {
                                appScroll.scrollBar('.collaborator-contact-list-contentbox');
                                listenForActiveCollaboratorContactListScrollEvent($('.collaborator-contact-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/collaborator/collaborator_contact_list_wrapper", "#collaborator-contact-list-wrapper-template", "#active-collaborator-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/collaborator/collaborator_contact_list_data", "#collaborator-contact-list-data-template", "#collaborator-contact-list-wrapper", null);
                        }, "page/collaborator/collaborator_contact_list_wrapper", "#collaborator-contact-list-wrapper-template", "#active-collaborator-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processActiveCollaboratorContactList(data, callback) {
    digibiz.collaborator_contact_list = removeDuplicates(digibiz.collaborator_contact_list.concat(data), "id");
    var getData = {
        collaborator_contact_list_data: digibiz.collaborator_contact_list.map(e => {
            //console.log("e", e);
            if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                //console.log("yess display picture");
                if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                    //console.log("yess asset_id");
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.business_display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
            appScroll.scrollBar('.collaborator-contact-list-contentbox');
        }
    }, "page/collaborator/collaborator_contact_list_data", "#collaborator-contact-list-data-template", "#collaborator-contact-list-wrapper", getData);
}

function listenForActiveCollaboratorContactListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader()
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "my_collaborators",
                count: 5,
                offset: digibiz.collaborator_contact_list.length
            }
            collaboratorList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessActiveCollaboratorContactList(response, function () {
                        listenForActiveCollaboratorContactListScrollEvent($('.collaborator-contact-list-contentbox'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/collaborator/scroll_collaborator_contact_list_data", "#scroll-collaborator-contact-list-data-template", "#collaborator-contact-list-wrapper .os-content", null);
                })

        }
    });
}

function scrollProcessActiveCollaboratorContactList(data, callback) {
    digibiz.collaborator_contact_list = removeDuplicates(digibiz.collaborator_contact_list.concat(data), "id");
    var getData = {
        collaborator_contact_list_data: data.map(e => {
            //console.log("e", e);
            if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                //console.log("yess display picture");
                if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                    //console.log("yess asset_id");
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.business_display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_collaborator_contact_list_data", "#scroll-collaborator-contact-list-data-template", "#collaborator-contact-list-wrapper .os-content", getData);
}

function pendingCollaboratorContactListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "my_pending_collaborator_contact_list_notifications",
            count: 15,
            offset: 0
        }
        var activereqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "my_collaborators"
        }
        collaboratorCount(activereqParam).then((count) => {
            $('.collaborator-active-count').text(`${count}`);
            pendingCollaboratorCount(reqParam).then((collbCount) => {
                $('.pending-collaborator-count').text(`${collbCount}`);
                businessNotificationList(reqParam)
                    .then((response) => {
                        //console.log("businessNotificationList response", response);
                        fetch.replaceHtml(function () {
                            processPendingCollaboratorContactList(response, function () {
                                removeLoader();
                                resolve();
                            });
                        }, "page/collaborator/pending_collaborator_contact_list_wrapper", "#pending-collaborator-contact-list-wrapper-template", "#pending-collaborator-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/collaborator/pending_collaborator_contact_list_data", "#pending-collaborator-contact-list-data-template", "#pending-collaborator-contact-list-wrapper", null);
                        }, "page/collaborator/pending_collaborator_contact_list_wrapper", "#pending-collaborator-contact-list-wrapper-template", "#pending-collaborator-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processPendingCollaboratorContactList(data, callback) {
    digibiz.pending_collaborator_contact_list = removeDuplicates(digibiz.pending_collaborator_contact_list.concat(data), "id");
    var getData = {
        pending_collaborator_contact_list_data: digibiz.pending_collaborator_contact_list.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.contact.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.contact.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            appScroll.scrollBar('.pending-collaborator-contact-list-contentbox');
            callback();           
        }
    }, "page/collaborator/pending_collaborator_contact_list_data", "#pending-collaborator-contact-list-data-template", "#pending-collaborator-contact-list-wrapper", getData);
}

function getCollaboratorContactListNotificationDetailsPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "collaborator_contact_list_notifications_details",
            collaborator_business_id: sessionStorage.getItem('collaborator_business_id'),
            business_id: sessionStorage.getItem('business_id'),
        }
        businessNotificationList(reqParam)
            .then((response) => {
                //console.log("businessNotificationList response", response);
                fetch.replaceHtml(function () {
                    processCollaboratorContactListNotificationDetails(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/collaborator/collaborator_contact_list_notifications_details_wrapper", "#collaborator-contact-list-notification-details-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/collaborator/collaborator_contact_list_notifications_details_data", "#collaborator-contact-list-notification-details-data-template", "#collaborator-contact-list-notification-details-list-wrapper", null);
                }, "page/collaborator/collaborator_contact_list_notifications_details_wrapper", "#collaborator-contact-list-notification-details-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processCollaboratorContactListNotificationDetails(data, callback) {
    digibiz.collaborator_contact_list_notification_details = removeDuplicates(digibiz.collaborator_contact_list_notification_details.concat(data.notifications_data), "id");
    var notificationList = {
        collaborator_contact_list_notification_details: digibiz.collaborator_contact_list_notification_details.map(e => {
            //console.log("e", e);
            if (typeof (e.createdDate) == "number") {
                e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            if (typeof (e.expiryDate) == "number") {
                e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("notificationList", notificationList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (data.last_notification.status.status == "active") {
                if (data.last_notification.contact.status.status == "rejected" || data.last_notification.contact.status.status == "expired") {
                    $('.fixed-action-btn').removeClass('hide');
                }
            }
            callback();
        }
    }, "page/collaborator/collaborator_contact_list_notifications_details_data", "#collaborator-contact-list-notification-details-data-template", "#collaborator-contact-list-notification-details-list-wrapper", notificationList);
}

// aollaborator alumini tab

function aluminiCollaboratorContactListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "alumini_collaborators",
            count: 15,
            offset: 0
        }
        // collaboratorCount(reqParam).then((count) => {
        //     $('.collaborator-active-count').text(`#${count}`);
        //     var pendingreqParam = {
        //         device_id: crossplat.device.uuid,
        //         business_id: sessionStorage.getItem('business_id'),
        //         list_by: "my_pending_collaborator_contact_list_notifications"
        //     }
        //     pendingCollaboratorCount(pendingreqParam).then((collbCount) => {
        //         $('.pending-collaborator-count').text(`#${collbCount}`);
                collaboratorList(reqParam)
                    .then((response) => {
                        //console.log("collaboratorList response", response);
                        fetch.replaceHtml(function () {
                            processAluminiCollaboratorContactList(response, function () {
                                appScroll.scrollBar('.collaborator-contact-list-contentbox');
                                listenForAluminiCollaboratorContactListScrollEvent($('.collaborator-contact-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/collaborator/alumini_collaborator_contact_list_wrapper", "#alumini-collaborator-contact-list-wrapper-template", "#alumini-collaborator-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/collaborator/alumini_collaborator_contact_list_data", "#alumini-collaborator-contact-list-data-template", "#alumini-collaborator-contact-list-wrapper", null);
                        }, "page/collaborator/alumini_collaborator_contact_list_wrapper", "#alumini-collaborator-contact-list-wrapper-template", "#alumini-collaborator-list-data-container", null);
                    })
        //     }).catch((err) => {
        //         console.log('err', err);
        //     })
        // }).catch((err) => {
        //     console.log('err', err);
        // })
    })
}

function processAluminiCollaboratorContactList(data, callback) {
    digibiz.alumini_collaborator_contact_list = removeDuplicates(digibiz.alumini_collaborator_contact_list.concat(data), "id");
    var getData = {
        collaborator_contact_list_data: digibiz.alumini_collaborator_contact_list.map(e => {
            //console.log("e", e);
            if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                //console.log("yess display picture");
                if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                    //console.log("yess asset_id");
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.business_display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
            appScroll.scrollBar('.collaborator-contact-list-contentbox');
        }
    }, "page/collaborator/alumini_collaborator_contact_list_data", "#alumini-collaborator-contact-list-data-template", "#alumini-collaborator-contact-list-wrapper", getData);
}

function listenForAluminiCollaboratorContactListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader()
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "alumini_collaborators",
                count: 5,
                offset: digibiz.alumini_collaborator_contact_list.length
            }
            collaboratorList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessAluminiCollaboratorContactList(response, function () {
                        listenForAluminiCollaboratorContactListScrollEvent($('.collaborator-contact-list-contentbox'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/collaborator/scroll_alumini_collaborator_contact_list_data", "#scroll-alumini-collaborator-contact-list-data-template", "#alumini-collaborator-contact-list-wrapper .os-content", null);
                })

        }
    });
}

function scrollProcessAluminiCollaboratorContactList(data, callback) {
    digibiz.alumini_collaborator_contact_list = removeDuplicates(digibiz.alumini_collaborator_contact_list.concat(data), "id");
    var getData = {
        collaborator_contact_list_data: data.map(e => {
            //console.log("e", e);
            if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                //console.log("yess display picture");
                if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                    //console.log("yess asset_id");
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.business_display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_alumini_collaborator_contact_list_data", "#scroll-alumini-collaborator-contact-list-data-template", "#alumini-collaborator-contact-list-wrapper .os-content", getData);
}



function getCollaboratorGroupsListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "collaborator",
            list_by: "business_collaborator_groups_page",
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        getCollaboratorGroupsCount(reqParam).then((groupsCount) => {
            $('.collaborator-groups-count').text(groupsCount);
            var reqParamCount = {
                device_id: crossplat.device.uuid,
                type: "collaborator",
                list_by: "business_other_collaborator_groups_page",
                business_id: sessionStorage.getItem('business_id')
            }
            getCollaboratorGroupsCount(reqParamCount).then((groupsCount) => {
                $('.other-collaborator-groups-count').text(groupsCount);
                collaboratorGroupsList(reqParam)
                    .then((response) => {
                        //console.log("collaboratorsGroupsList response", response);
                        fetch.replaceHtml(function () {
                            processCollaboratorGroupsList(response, function () {
                                appScroll.scrollBar('.collaborator-groups-list-contentbox');
                                listenForCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/collaborator/group_list_wrapper", "#collaborator-groups-list-wrapper-template", "#my-collaborator-group-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", null);
                        }, "page/collaborator/group_list_wrapper", "#collaborator-groups-list-wrapper-template", "#my-collaborator-group-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processCollaboratorGroupsList(data, callback) {
    digibiz.collaborator_groups_list = removeDuplicates(digibiz.collaborator_groups_list.concat(data), "id");
    var collaboratorGroupsList = {
        collaborator_groups_list: digibiz.collaborator_groups_list.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", collaboratorGroupsList);
}

function listenForCollaboratorGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "collaborator",
                list_by: "business_collaborator_groups_page",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.collaborator_groups_list.length
            }
            collaboratorGroupsList(reqParam)
                .then((response) => {
                    scrollProcessCollaboratorGroupsList(response, function () {
                        listenForCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-contentbox'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCollaboratorGroupsList(data, callback) {
    digibiz.collaborator_groups_list = removeDuplicates(digibiz.collaborator_groups_list.concat(data), "id");
    var collaboratorGroupsList = {
        collaborator_groups_list: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_group_list_data", "#scroll-collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper .os-content", collaboratorGroupsList);
}


function getOtherCollaboratorGroupsListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "collaborator",
            list_by: "business_other_collaborator_groups_page",
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        getCollaboratorGroupsCount(reqParam).then((groupsCount) => {
            $('.other-collaborator-groups-count').text(groupsCount);
            var reqParamCount = {
                device_id: crossplat.device.uuid,
                type: "collaborator",
                list_by: "business_collaborator_groups_page",
                business_id: sessionStorage.getItem('business_id')
            }
            getCollaboratorGroupsCount(reqParamCount).then((groupsCount) => {
                $('.collaborator-groups-count').text(groupsCount);
                collaboratorGroupsList(reqParam)
                    .then((response) => {
                        console.log("collaboratorsGroupsList response", response);
                        fetch.replaceHtml(function () {
                            processOtherCollaboratorGroupsList(response, function () {
                                appScroll.scrollBar('.collaborator-groups-list-main-container');
                                listenForOtherCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-main-container'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/collaborator/other_collaborator_group_list_wrapper", "#other-collaborator-groups-list-wrapper-template", "#other-collaborator-group-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", null);
                        }, "page/collaborator/group_list_wrapper", "#collaborator-groups-list-wrapper-template", "#my-collaborator-group-list-data-container", null);
                    })
            }).catch((err) => {
                console.log('err', err);
            })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processOtherCollaboratorGroupsList(data, callback) {
    digibiz.other_collaborator_groups_list = removeDuplicates(digibiz.other_collaborator_groups_list.concat(data), "id");
    var collaboratorGroupsList = {
        collaborator_groups_list: digibiz.other_collaborator_groups_list.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/collaborator/other_group_list_data", "#other-collaborator-groups-list-data-template", "#other-collaborator-groups-list-list-wrapper", collaboratorGroupsList);
}

function listenForOtherCollaboratorGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "collaborator",
                list_by: "business_other_collaborator_groups_page",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.other_collaborator_groups_list.length
            }
            collaboratorGroupsList(reqParam)
                .then((response) => {
                    scrollProcessOtherCollaboratorGroupsList(response, function () {
                        listenForOtherCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-main-container'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessOtherCollaboratorGroupsList(data, callback) {
    digibiz.other_collaborator_groups_list = removeDuplicates(digibiz.other_collaborator_groups_list.concat(data), "id");
    var collaboratorGroupsList = {
        collaborator_groups_list: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_other_group_list_data", "#scroll-other-collaborator-groups-list-data-template", "#other-collaborator-groups-list-list-wrapper", collaboratorGroupsList);
}

/**
 * 
 *  alumini groups
 */
function getAluminiCollaboratorGroupsListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "collaborator",
            list_by: "business_alumini_collaborator_groups_page",
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        // getCollaboratorGroupsCount(reqParam).then((groupsCount) => {
        //     $('.other-collaborator-groups-count').text(groupsCount);
        //     var reqParamCount = {
        //         device_id: crossplat.device.uuid,
        //         type: "collaborator",
        //         list_by: "business_collaborator_groups_page",
        //         business_id: sessionStorage.getItem('business_id')
        //     }
        //     getCollaboratorGroupsCount(reqParamCount).then((groupsCount) => {
        //         $('.collaborator-groups-count').text(groupsCount);
                collaboratorGroupsList(reqParam)
                    .then((response) => {
                        console.log("collaboratorsGroupsList response", response);
                        fetch.replaceHtml(function () {
                            processAluminiCollaboratorGroupsList(response, function () {
                                appScroll.scrollBar('.collaborator-groups-list-main-container');
                                listenForAluminiCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-main-container'));
                                removeLoader();
                                resolve();
                            });
                        }, "page/collaborator/alumini_collaborator_group_list_wrapper", "#alumini-collaborator-groups-list-wrapper-template", "#alumini-collaborator-group-list-data-container", null);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/collaborator/alumini_group_list_data", "#alumini-collaborator-groups-list-data-template", "#alumini-collaborator-groups-list-list-wrapper", null);
                        }, "page/collaborator/alumini_collaborator_group_list_wrapper", "#alumini-collaborator-groups-list-wrapper-template", "#alumini-collaborator-group-list-data-container", null);
                    })
        //     }).catch((err) => {
        //         console.log('err', err);
        //     })
        // }).catch((err) => {
        //     console.log('err', err);
        // })
    })
}

function processAluminiCollaboratorGroupsList(data, callback) {
    digibiz.alumini_collaborator_groups_list = removeDuplicates(digibiz.alumini_collaborator_groups_list.concat(data), "id");
    var collaboratorGroupsList = {
        collaborator_groups_list: digibiz.alumini_collaborator_groups_list.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/collaborator/alumini_group_list_data", "#alumini-collaborator-groups-list-data-template", "#alumini-collaborator-groups-list-list-wrapper", collaboratorGroupsList);
}

function listenForAluminiCollaboratorGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "collaborator",
                list_by: "business_alumini_collaborator_groups_page",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.alumini_collaborator_groups_list.length
            }
            collaboratorGroupsList(reqParam)
                .then((response) => {
                    scrollProcessAluminiCollaboratorGroupsList(response, function () {
                        listenForAluminiCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-main-container'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, "page/collaborator/scroll_alumini_group_list_data", "#scroll-alumini-collaborator-groups-list-data-template", "#alumini-collaborator-groups-list-list-wrapper", null);
                })

        }
    });
}

function scrollProcessAluminiCollaboratorGroupsList(data, callback) {
    digibiz.alumini_collaborator_groups_list = removeDuplicates(digibiz.alumini_collaborator_groups_list.concat(data), "id");
    var collaboratorGroupsList = {
        collaborator_groups_list: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            if (typeof (e.updatedDate) == "number") {
                e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            }
            return e;
        })
    };
    console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_alumini_group_list_data", "#scroll-alumini-collaborator-groups-list-data-template", "#alumini-collaborator-groups-list-list-wrapper", collaboratorGroupsList);
}

/**
 * 
 * ends alumini
 */

function getCollaboratorGroupCreatePage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function (err) {
            if (!err) {
                removeLoader();
                appScroll.scrollBar("#main-container");
                resolve();
            }
        }, "page/collaborator/group_create", "#collaborator-group-creation-template", "#main-content-wrapper", null);
    })
}

function getCollaboratorGroupDetailsPage() {
    return new Promise((resolve, reject) => {
        // var reqparams = {
        //     device_id: crossplat.device.uuid,

        // }
        // fetch.replaceHtml(function (err) {
        //     if (!err) {
        //         removeLoader();
        //         resolve();
        //     }
        // }, "page/collaborator/collaborator_group_details_page", "#collaborator-group-details-template", "#main-content-wrapper", null);
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        groupGet(reqparams)
            .then((response) => {
                //console.log("group response", response);
                //get group_type and set session
                if (response.hasOwnProperty('group_image') && response.group_image) {
                    if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                        response.group_image['avtarUrl'] = avtarUrl;
                        response['imageLetter'] = response.name.charAt(0);
                    } else {
                        response['imageLetter'] = response.name.charAt(0);
                    }
                } else {
                    response['imageLetter'] = response.name.charAt(0);
                }
                var requestParams = {
                    device_id: crossplat.device.uuid,
                    group_id: sessionStorage.getItem('group_id'),
                    count: 5,
                    offset: 0
                }
                groupMemberList(requestParams)
                    .then((membersResponse) => {
                        getGroupMembersCount(requestParams).then((countResult) => {
                            var modReqParams = {
                                device_id: crossplat.device.uuid,
                                id: sessionStorage.getItem('group_id'),
                                count: 5,
                                offset: 0
                            }
                            getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                                digibiz.group_moderator_list = [];
                                digibiz.group_moderator_list = moderatorResponse.moderator;

                                digibiz.collaborator_group_members_list = [];
                                digibiz.collaborator_group_members_list = membersResponse;
                                //console.log("member response", membersResponse);
                                //get the moderator data and group creator business data
                                var groupModeratorData = [], groupCreatorBusinessData = {}, my_group;
                                //get group creator business data
                                var getCreatorBusinessData = membersResponse.find((e => e.member.business_id == response.owner.business_id));
                                //console.log("getCreatorBusinessData", getCreatorBusinessData);
                                if (getCreatorBusinessData != undefined) {
                                    groupCreatorBusinessData = getCreatorBusinessData;
                                }

                                //check if it my group(our business group)
                                if (response.owner.business_id == sessionStorage.getItem('business_id')) {
                                    my_group = "true";
                                }
                                else {
                                    my_group = "false";
                                }
                                var groupData = {
                                    myGroup: my_group,
                                    group_data: response,
                                    membersCount: countResult,
                                    totalMembersCount:membersResponse[0].totalCount,
                                    group_creator_business_data: groupCreatorBusinessData,
                                    // group_moderator_data: groupModeratorData,
                                    group_members_data: membersResponse.map(e => {
                                        if (e.type == "business") {
                                            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                                                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                                                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.member.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                                                    e.display_picture['avtarUrl'] = avtarUrl;
                                                    e['imageLetter'] = e.business_name.charAt(0);
                                                } else {
                                                    e['imageLetter'] = e.business_name.charAt(0);
                                                }
                                            } else {
                                                e['imageLetter'] = e.business_name.charAt(0);
                                            }
                                        }
                                        return e;
                                    })
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        appScroll.scrollBar('#main-container');
                                        appScroll.scrollBar('#collaborator-group-members-list');
                                        listenForCollaboratorGroupMembersListScrollEvent($('#collaborator-group-members-list'));
                                        processGroupModeratorList(digibiz.group_moderator_list, function () {
                                            appScroll.scrollBar('#collaborator-group-moderator-list');
                                            listentForCommunicationGroupModeratorList($('#communication-group-moderator-members-list'));
                                        });
                                        resolve();
                                    }
                                }, "page/collaborator/collaborator_group_details_page", "#collaborator-group-details-template", "#main-content-wrapper", groupData);
                            }).catch((err) => {
                                console.log('err', err);
                            })
                        }).catch((err) => {
                            console.log('err', err);
                        })
                    })
                    .catch((err) => {
                        //console.log("error in group members data");
                        var groupData = {
                            group_data: response
                        }
                        //console.log("groupData", groupData);
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/collaborator/collaborator_group_details_page", "#collaborator-group-details-template", "#main-content-wrapper", groupData);
                    })
            })
            .catch((err) => {
                //console.log("error in group get");
                sessionStorage.removeItem('group_id');
                location.hash = `collaborator/groups/list`;
                resolve();
            })

    })
}

function validateCollaboratorGroup() {
    let validateGroupName = false;
    let validateGroupDescription = false;
    let validateGroupActiveStatus = false;
    let validateGroupEmployeeMembers = false;
    let validateGroupBusinessMembers = false;
    let validateGroupModerator = false;
    //validate group name
    if ($('#collaboratorGroupName').val().trim().length > 0) {
        if ($('#collaboratorGroupName').val().trim().length < config.EmployeeGroupNameMinLength) {
            showError($('#collaboratorGroupName'), `This field should contain atleast ${config.EmployeeGroupNameMinLength} characters.`);
            validateGroupName = true;
        }
        if ($('#collaboratorGroupName').val().trim().length > config.EmployeeGroupNameMaxLength) {
            showError($('#collaboratorGroupName'), `This field can't have more than  ${config.EmployeeGroupNameMaxLength} characters.`);
            validateGroupName = true;
        }
        if ($('#collaboratorGroupName').val().trim().length >= config.EmployeeGroupNameMinLength && $('#collaboratorGroupName').val().trim().length <= config.EmployeeGroupNameMaxLength) {
            validateGroupName = false;
        }
    } else {
        showError($('#collaboratorGroupName'), `This field is required.`);
        validateGroupName = true;
    }
    //validate group description
    if ($('#collaborator_group_desc').val().trim().length > 0) {
        if ($('#collaborator_group_desc').val().trim().length < config.EmployeeGroupDescriptionMinLength) {
            showError($('#collaborator_group_desc'), `This field should contain atleast ${config.EmployeeGroupDescriptionMinLength} characters.`);
            validateGroupDescription = true;
        }
        if ($('#collaborator_group_desc').val().trim().length > config.EmployeeGroupDescriptionMaxLength) {
            showError($('#collaborator_group_desc'), `This field can't have more than  ${config.EmployeeGroupDescriptionMaxLength} characters.`);
            validateGroupDescription = true;
        }
        if ($('#collaborator_group_desc').val().trim().length >= config.EmployeeGroupDescriptionMinLength && $('#collaborator_group_desc').val().trim().length <= config.EmployeeGroupDescriptionMaxLength) {
            validateGroupDescription = false;
        }
    } else {
        validateGroupDescription = false;
    }
    //validate group active status
    // if ($('#select-group-active-when').val() == "") {
    //     showError($('#select-group-active-when'), `This field is required.`);
    //     validateGroupActiveStatus = true;
    // } else {
    //     validateGroupActiveStatus = false;
    // }
    if ($('.selected-value-group-active-when').attr('data-value').length > 0) {
        validateGroupActiveStatus = false;
    } else {
        showError($('#select-group-active-when'), `This field is required.`);
        validateGroupActiveStatus = true;
    }
    //check if it is a new group creation/ old one
    if (sessionStorage.getItem('group_id') == '' || sessionStorage.getItem('group_id') == null || sessionStorage.getItem('group_id') == undefined) {
        //for my business employee members
        if ($(".collaborator-group-owner-business-employee-member:checked").length > 0) {
            validateGroupEmployeeMembers = false;
        } else {
            Materialize.toast(`Please add atleast 1 Employee to your business`, 3000, "round error-alert");
            validateGroupEmployeeMembers = true;
        }
        //for business members
        if ($(".collaborator-group-business-member:checked").length > 0) {
            validateGroupBusinessMembers = false;
        } else {
            Materialize.toast(`Please add atleast 1 Business`, 3000, "round error-alert");
            validateGroupBusinessMembers = true;
        }
        //for group moderator
        if ($(".collaborator-group-employee-moderator-member:checked").length > 0) {
            validateGroupModerator = false;
        } else {
            Materialize.toast(`Please add atleast 1 moderator`, 3000, "round error-alert");
            validateGroupModerator = true;
        }
    }
    if (validateGroupEmployeeMembers || validateGroupBusinessMembers || validateGroupDescription || validateGroupName || validateGroupActiveStatus || validateGroupModerator) {
        return false;
    } else {
        return true;
    }
}
/******************COLLABAORATOR MANAGEMENT(ends)************************/


/**************ROLE MANAGEMENT(starts)******************/
function getRoleManagementPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",
            business_id: sessionStorage.getItem('business_id')
        }
        employeeList(reqParam)
            .then((response) => {
                //console.log("employeeList response", response);
                fetch.replaceHtml(function () {
                    processRoleManagementEmployeeList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/role_management/employee_list_wrapper", "#role-management-employee-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/role_management/employee_list_data", "#role-management-employees-list-data-template", "#role-management-employee-list-wrapper", null);
                }, "page/role_management/employee_list_wrapper", "#role-management-employee-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}


function processRoleManagementEmployeeList(data, callback) {
    digibiz.role_management_employee_list = removeDuplicates(digibiz.role_management_employee_list.concat(data), "id");
    var employeeList = {
        role_management_employees_list_data: digibiz.role_management_employee_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("employeeList", employeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/role_management/employee_list_data", "#role-management-employees-list-data-template", "#role-management-employee-list-wrapper", employeeList);
}

function getRoleManagementEmployeeAppsAccessListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "member",
            member_id: sessionStorage.getItem('employee_id')
        }
        roleManagementList(reqParam)
            .then((response) => {
                //console.log("roleManagementList response", response);
                fetch.replaceHtml(function () {
                    processRoleManagementEmployeeAppAccessList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/role_management/employee_apps_access_list_wrapper", "#employee-apps-access-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/role_management/employee_apps_access_list_data", "#employees-apps-access-list-data-template", "#employee-apps-access-list-wrapper", null);
                }, "page/role_management/employee_apps_access_list_wrapper", "#employee-apps-access-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}

function processRoleManagementEmployeeAppAccessList(data, callback) {
    digibiz.role_management_employee_apps_access_list = removeDuplicates(digibiz.role_management_employee_apps_access_list.concat(data), "id");
    var appAccessList = {
        employees_apps_access_list_data: digibiz.role_management_employee_apps_access_list.map(e => {
            e['imageLetter'] = e.app_name.charAt(0);
            return e;
        })
    };
    //console.log("appAccessList", appAccessList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            removeLoader();
            callback();
        }
    }, "page/role_management/employee_apps_access_list_data", "#employees-apps-access-list-data-template", "#employee-apps-access-list-wrapper", appAccessList);
}

function bizchatCustomerIdentifierApiCall() {
    return new Promise((resolve, reject) => {
        //api call for customer identifiers        
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer"
        }
        customerIdentifierList(requestParams)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                if (response.length > 0) {
                    $.each(response, function (index, identifier_data) {
                        var template = `<div class="bizchat-customer-identifier-access-container">
                        <div class="bizchat-customer-identifier-access-wrapper">                    
                            <div id="bizchat_customer_identifier_access" type="text" contenteditable="true" class="validate" autocomplete="off" disabled>${identifier_data.identifier}</div>
                            <input type="checkbox" class="filled-in bizchat-customer-identifier-access" id="filled-in-box-customer-identifier-${identifier_data.identifier}" data-id="${identifier_data.id}" />
                            <label for="filled-in-box-customer-identifier-${identifier_data.identifier}"></label>                  
                        </div>                
                    </div>`;
                        $('.role-assignment-bizchat-customer-identifiers-type-container').append(template);
                    })
                    resolve();
                } else {
                    resolve();
                }
            })
            .catch((err) => {
                resolve();
                //console.log("error customerIdentifierList");
            })
        //api call for employee department
        var reqParams = {
            device_id: crossplat.device.uuid,
            list_by: "department",
            business_id: sessionStorage.getItem('business_id')
        }
        departmentList(reqParams)
            .then((departmentResponse) => {
                //console.log("departmentResponse", departmentResponse);
                if (departmentResponse.length > 0) {
                    $.each(departmentResponse, function (index, department) {
                        var template = `<div class="sub-departments-content-box sub-department-box" data-id="${department.id}">
                        <div class="sub-department-box-name-symbol-content-box">
                            <i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>                                
                            <div id="added_sub_department" type="text" data-length="60" contenteditable="false" class="validate" autocomplete="off" disabled>${department.name}</div>
                            <input type="checkbox" class="filled-in department-selected" id="filled-in-box-${department.id}" />
                            <label for="filled-in-box-${department.id}"></label>
                        </div>
                        <div class="sub_sub_department_conatiner_box hide" data-id="${department.id}"></div>
                    </div>`;
                        $('.role-assignment-bizchat-employee-department-type-container').append(template);
                    })
                }
            })
            .catch((err) => {
                //console.log("error departmentList");
            })
    })
}

function bizchatEmployeeDepartmentApiCall() {
    return new Promise((resolve, reject) => {
        //api call for employee department
        var reqParams = {
            device_id: crossplat.device.uuid,
            list_by: "department",
            business_id: sessionStorage.getItem('business_id')
        }
        departmentList(reqParams)
            .then((departmentResponse) => {
                //console.log("departmentResponse", departmentResponse);
                if (departmentResponse.length > 0) {
                    $.each(departmentResponse, function (index, department) {
                        var template = `<div class="sub-departments-content-box sub-department-box" data-id="${department.id}">
                        <div class="sub-department-box-name-symbol-content-box">
                            <i class="material-icons arrow-right" id="employee_department_assignment_arrow_button">keyboard_arrow_right</i>                                
                            <div id="added_sub_department" type="text" data-length="60" contenteditable="false" class="validate" autocomplete="off" disabled>${department.name}</div>
                            <input type="checkbox" class="filled-in department-selected" id="filled-in-box-${department.id}" />
                            <label for="filled-in-box-${department.id}"></label>
                        </div>
                        <div class="sub_sub_department_conatiner_box hide" data-id="${department.id}"></div>
                    </div>`;
                        $('.role-assignment-bizchat-employee-department-type-container').append(template);
                    })
                    resolve();
                } else {
                    resolve();
                }
            })
            .catch((err) => {
                resolve();
                //console.log("error departmentList");
            })
    })
}
/**************ROLE MANAGEMENT(engs)******************/

/***********DIGIBIZ LOGS PAGE(starts) **************/
function getDigibizLogsPage() {
    return new Promise((resolve, reject) => {
        var reqParam;
        if (sessionStorage.getItem('log_type') == "notification_role_page") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "notification_roles_page"
            }
        } else if (sessionStorage.getItem('log_type') == "business_notification_page") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "business_notification_page",
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "business_owner_business_list_page") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "business_owner_roles_page",
            }
        } else if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "business_app_hub_page",
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "jeevi_hub_page") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "jeevi_hub_page",
                account_id: sessionStorage.getItem('account_id')
            }
        } else if (sessionStorage.getItem('log_type') == "digibiz_hub_page") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "digibiz_account",
                user_id: sessionStorage.getItem('account_id')
            }
        } else if (sessionStorage.getItem('log_type') == "digibiz_roles_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "digibiz_roles",
                user_id: sessionStorage.getItem('account_id')
            }
        } else if (sessionStorage.getItem('log_type') == "digibiz_business_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "digibiz_business_logs",
                user_id: sessionStorage.getItem('account_id'),
                account_id: sessionStorage.getItem('account_id')
            }
        } else if (sessionStorage.getItem('log_type') == "digibiz_login_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "digibiz_login_logs",
                filter: "digibiz",
                offset: 1,
                count: 15
            }
        } else if (sessionStorage.getItem('log_type') == "app_permission_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "app_permissions_page",
                business_id: sessionStorage.getItem('business_id'),
                user_id: sessionStorage.getItem('account_id'),
                account_id: sessionStorage.getItem('account_id')
            }
        } else if (sessionStorage.getItem('log_type') == "customer_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "customer_logs",
                type: "customer",
                business_id: sessionStorage.getItem('business_id'),
                user_id: sessionStorage.getItem('account_id'),
                account_id: sessionStorage.getItem('account_id')
            }
        } else if (sessionStorage.getItem('log_type') == "teams_group_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "business_teams",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "communication_group_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "communication",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "business_notification_activity_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "business_notification",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
            if (sessionStorage.getItem('selected-business-notification-tab') == "business_notification") {
                reqParam.sort_by = "contacts";
            } else {
                reqParam.sort_by = "groups";
            }
        } else if (sessionStorage.getItem('log_type') == "collaborator_group_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "collaborator",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "member_collaborator_group_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "collaborator_member",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "contact_control_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "contact_control",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "customer_control_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "customer_control",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else if (sessionStorage.getItem('log_type') == "trusted_control_logs") {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "trusted_control",
                user_id: sessionStorage.getItem('account_id'),
                business_id: sessionStorage.getItem('business_id')
            }
        } else {
            reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "business_module",
                business_id: sessionStorage.getItem('business_id'),
                type: sessionStorage.getItem('log_type'),
                user_id: sessionStorage.getItem('account_id'),
                account_id: sessionStorage.getItem('account_id')
            }
        }
        reqParam.count = 20;
        reqParam.offset = 0;
        if (sessionStorage.getItem('log_type') != "digibiz_login_logs") {
            digibizLogsList(reqParam)
                .then((response) => {
                    //console.log("digibizLogsList response", response);
                    fetch.replaceHtml(function () {
                        processLogsList(response, function () {
                            appScroll.scrollBar('.digibiz-logs-list-contentbox');
                            listenForDigibizLogsListScrollEvent($('.digibiz-logs-list-contentbox'))
                            removeLoader();
                            if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
                                // $('.digibiz-logs-list-title-band').find('.searchbtn').addClass('hide');
                            }
                            resolve();
                        });
                    }, "page/common/digibiz_logs_wrapper", "#digibiz-logs-list-wrapper-template", "#main-content-wrapper", reqParam);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
                                    // $('.digibiz-logs-list-title-band').find('.searchbtn').addClass('hide');
                                }
                                resolve();
                            }
                        }, "page/common/digibiz_logs_data", "#digibiz-logs-list-data-template", "#digibiz-logs-list-wrapper", reqParam);
                    }, "page/common/digibiz_logs_wrapper", "#digibiz-logs-list-wrapper-template", "#main-content-wrapper", reqParam);
                })
        } else {
            digibizLoginLogsList(reqParam)
                .then((response) => {
                    //console.log("digibizLogsList response", response);
                    fetch.replaceHtml(function () {
                        processLogsList(response, function () {
                            appScroll.scrollBar('.digibiz-logs-list-contentbox');
                            removeLoader();
                            if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
                                // $('.digibiz-logs-list-title-band').find('.searchbtn').addClass('hide');
                            }
                            resolve();
                        });
                    }, "page/common/digibiz_logs_wrapper", "#digibiz-logs-list-wrapper-template", "#main-content-wrapper", reqParam);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
                                    // $('.digibiz-logs-list-title-band').find('.searchbtn').addClass('hide');
                                }
                                resolve();
                            }
                        }, "page/common/digibiz_logs_data", "#digibiz-logs-list-data-template", "#digibiz-logs-list-wrapper", reqParam);
                    }, "page/common/digibiz_logs_wrapper", "#digibiz-logs-list-wrapper-template", "#main-content-wrapper", reqParam);
                })
        }
    })
}

function processLogsList(data, callback) {
    console.log('data', data);
    digibiz.logs_list = removeDuplicates(digibiz.logs_list.concat(data), "id");
    var logsList = {
        log_list_data: digibiz.logs_list.map(e => {
            if (e.action.operation == "digibiz_account_complete_inactivate") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A') + ' is successfull.'
            } else if (e.action.operation == "digibiz_account_activate_schedule") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
            } else if (e.action.operation == "digibiz_account_inactivate_schedule") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
            } else if (e.action.operation == "digibiz_account_cancel_inactivate") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.data.date).format('MMM D YYYY hh:mm:ss A') + ' is canceled.'
            } else if (e.action.operation == "digibiz_account_cancel_activate") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.data.twelvehourdate).format('MMM D YYYY hh:mm:ss A') + ' is canceled.'
            }
            e['action']['date'] = moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
            return e;
        })
    };
    //console.log("logsList", logsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            removeLoader();
            callback();
        }
    }, "page/common/digibiz_logs_data", "#digibiz-logs-list-data-template", "#digibiz-logs-list-wrapper", logsList);
}

function processSearchCloseLogsList(data, callback) {
    digibiz.logs_list = removeDuplicates(digibiz.logs_list.concat(data), "id");
    var logsList = {
        // log_list_data: digibiz.logs_list.map(e => {
        //     e['action']['date'] = moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
        //     return e;
        // })
        log_list_data: digibiz.logs_list
    };
    console.log("logsList", logsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            removeLoader();
            callback();
        }
    }, "page/common/digibiz_logs_data", "#digibiz-logs-list-data-template", "#digibiz-logs-list-wrapper", logsList);
}

function listenForDigibizLogsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam;
            if (sessionStorage.getItem('log_type') == "notification_role_page") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "notification_roles_page"
                }
            } else if (sessionStorage.getItem('log_type') == "business_notification_page") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "business_notification_page",
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "business_owner_business_list_page") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "business_owner_roles_page",
                }
            } else if (sessionStorage.getItem('log_type') == "business_app_hub_page") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "business_app_hub_page",
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "jeevi_hub_page") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "jeevi_hub_page",
                    account_id: sessionStorage.getItem('account_id')
                }
            } else if (sessionStorage.getItem('log_type') == "digibiz_hub_page") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "digibiz_account",
                    user_id: sessionStorage.getItem('account_id')
                }
            } else if (sessionStorage.getItem('log_type') == "digibiz_roles_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "digibiz_roles",
                    user_id: sessionStorage.getItem('account_id')
                }
            } else if (sessionStorage.getItem('log_type') == "digibiz_business_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "digibiz_business_logs",
                    user_id: sessionStorage.getItem('account_id'),
                    account_id: sessionStorage.getItem('account_id')
                }
            } else if (sessionStorage.getItem('log_type') == "digibiz_login_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "digibiz_login_logs",
                    filter: "digibiz",
                    offset: 1,
                    count: 15
                }
            } else if (sessionStorage.getItem('log_type') == "app_permission_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "app_permissions_page",
                    business_id: sessionStorage.getItem('business_id'),
                    user_id: sessionStorage.getItem('account_id'),
                    account_id: sessionStorage.getItem('account_id')
                }
            } else if (sessionStorage.getItem('log_type') == "customer_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "customer_logs",
                    type: "customer",
                    business_id: sessionStorage.getItem('business_id'),
                    user_id: sessionStorage.getItem('account_id'),
                    account_id: sessionStorage.getItem('account_id')
                }
            } else if (sessionStorage.getItem('log_type') == "teams_group_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "business_teams",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "communication_group_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "communication",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "business_notification_activity_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "business_notification",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
                if (sessionStorage.getItem('selected-business-notification-tab') == "business_notification") {
                    reqParam.sort_by = "contacts";
                } else {
                    reqParam.sort_by = "groups";
                }
            } else if (sessionStorage.getItem('log_type') == "collaborator_group_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "collaborator",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "member_collaborator_group_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "collaborator_member",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "contact_control_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "contact_control",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "customer_control_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "customer_control",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else if (sessionStorage.getItem('log_type') == "trusted_control_logs") {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "trusted_control",
                    user_id: sessionStorage.getItem('account_id'),
                    business_id: sessionStorage.getItem('business_id')
                }
            } else {
                reqParam = {
                    device_id: crossplat.device.uuid,
                    list_by: "business_module",
                    business_id: sessionStorage.getItem('business_id'),
                    type: sessionStorage.getItem('log_type'),
                    user_id: sessionStorage.getItem('account_id'),
                    account_id: sessionStorage.getItem('account_id')
                }
            }
            reqParam.count = 10;
            reqParam.offset = digibiz.logs_list.length;
            var filter_value = $('.wrapper-dropdown').find(".selected-dropdown").attr('data-value');
            if (filter_value && filter_value != undefined) {
                reqParam.filter_value = filter_value;
                if (sessionStorage.getItem('log_type') != "digibiz_login_logs") {
                    digibizFilterLogsList(reqParam)
                        .then((response) => {
                            scrollProcessLogsList(response, function () {
                                listenForDigibizLogsListScrollEvent($('.digibiz-logs-list-contentbox'))
                                removeLoader();
                            });
                        })
                        .catch((err) => {
                            fetch.appendHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                }
                            }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", reqParam);

                        })
                } else {
                    digibizLoginLogsList(reqParam)
                        .then((response) => {
                            //console.log("digibizLogsList response", response);
                            fetch.appendHtml(function () {
                                scrollProcessLogsList(response, function () {
                                    listenForDigibizLogsListScrollEvent($('.digibiz-logs-list-contentbox'))
                                    removeLoader();
                                });
                            }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", reqParam);
                        })
                        .catch((err) => {
                            fetch.appendHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                }
                            }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", reqParam);

                        })
                }
            } else {
                if (sessionStorage.getItem('log_type') != "digibiz_login_logs") {
                    digibizLogsList(reqParam)
                        .then((response) => {
                            scrollProcessLogsList(response, function () {
                                listenForDigibizLogsListScrollEvent($('.digibiz-logs-list-contentbox'))
                                removeLoader();
                            });
                        })
                        .catch((err) => {
                            fetch.appendHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                }
                            }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", reqParam);

                        })
                } else {
                    digibizLoginLogsList(reqParam)
                        .then((response) => {
                            //console.log("digibizLogsList response", response);
                            fetch.appendHtml(function () {
                                scrollProcessLogsList(response, function () {
                                    removeLoader();
                                });
                            }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", reqParam);
                        })
                        .catch((err) => {
                            fetch.appendHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                }
                            }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", reqParam);

                        })
                }
            }
        }
    });
}

function scrollProcessLogsList(data, callback) {
    console.log('data', data);
    digibiz.logs_list = removeDuplicates(digibiz.logs_list.concat(data), "id");
    var logsList = {
        log_list_data: data.map(e => {
            if (e.action.operation == "digibiz_account_complete_inactivate") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A') + ' is successfull.'
            } else if (e.action.operation == "digibiz_account_activate_schedule") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
            } else if (e.action.operation == "digibiz_account_inactivate_schedule") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
            } else if (e.action.operation == "digibiz_account_cancel_inactivate") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.data.date).format('MMM D YYYY hh:mm:ss A') + ' is canceled.'
            } else if (e.action.operation == "digibiz_account_cancel_activate") {
                e['action']['activity'] = e.action.activity + moment.unix(e.action.data.twelvehourdate).format('MMM D YYYY hh:mm:ss A') + ' is canceled.'
            }
            e['action']['date'] = moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
            return e;
        })
    };
    //console.log("logsList", logsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            removeLoader();
            callback();
        }
    }, "page/common/scroll_digibiz_logs_data", "#scroll-digibiz-logs-list-data-template", ".digibiz-logs-list-contentbox .os-content", logsList);
}
/***********DIGIBIZ LOGS PAGE(ends) **************/


function processCustomerGroupContactsList(data, callback) {
    digibiz.customerGroupsContactsList = removeDuplicates(digibiz.customerGroupsContactsList.concat(data), 'id');
    //put it in modal
    var getData = {
        customer_group_contact_list_data: digibiz.customerGroupsContactsList,
        device_id: crossplat.device.uuid
    };
    fetch.replaceHtml(function () {
        //remove already present customers in the group
        var getMembers = [];
        if ($('.customer-group-member-wrapper').length > 0) {
            $.each($('.customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    // type: "new_member"
                });
            });
        }
        if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
            $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-customer-id'),
                    // type: "old_member"
                });
            });
        }
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                // if (element.type == "new_member") {
                // $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                // } else if (element.type == "old_member") {
                //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                // }
            })
        }
        callback();

    }, "page/customer/group_contact_list_data", "#customer-group-contact-list-data-template", '#customer-group-contacts-items-list-wrapper', getData);
}

function listenForCustomerGroupContactsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.customerGroupsContactsList.length
            }
            getCustomerGroupContactList(reqParam)
                .then((response) => {
                    scrollProcessCustomerGroupContactsList(response, function () {
                        listenForCustomerGroupContactsListScrollEvent($(".modal-popup-content"));
                        removeLoader();

                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function () {
                        removeLoader();
                    }, "page/customer/scroll_group_contact_list_data", "#scroll-customer-group-contact-list-data-template", '.customer-group-contact-list-contentbox', null);
                })

        }
    });
}

function scrollProcessCustomerGroupContactsList(data, callback) {
    digibiz.customerGroupsContactsList = removeDuplicates(digibiz.customerGroupsContactsList.concat(data), 'id');
    //put it in modal
    var getData = {
        customer_group_contact_list_data: data,
        device_id: crossplat.device.uuid
    };
    fetch.appendHtml(function () {
        //remove already present customers in the group
        var getMembers = [];
        if ($('.customer-group-member-wrapper').length > 0) {
            $.each($('.customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    // type: "new_member"
                });
            });
        }
        if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
            $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-customer-id'),
                    // type: "old_member"
                });
            });
        }
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                // if (element.type == "new_member") {
                // $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                // } else if (element.type == "old_member") {
                //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                // }
            })
        }
        callback();

    }, "page/customer/scroll_group_contact_list_data", "#scroll-customer-group-contact-list-data-template", '.customer-group-contact-list-contentbox', getData);
}


function processCustomerGroupCustomGroupList(data, callback) {
    digibiz.customerGroupCustomGroupsList = removeDuplicates(digibiz.customerGroupCustomGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        customer_group_custom_groups_list_data: digibiz.customerGroupCustomGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            //automatic checked while searching
            var getIndex = digibiz.customerGroupCustomGroupsList.findIndex((o) => o.id == e.id);
            if (getIndex > -1) {
                var getValue = digibiz.customerGroupCustomGroupsList[getIndex].selected;
                if (getValue == true) {
                    e['selected'] = true;
                }
            }
            return e;
        })
    };
    fetch.replaceHtml(function () {
        //remove already present customers in the group
        var getMembers = [];
        if ($('.customer-group-member-wrapper').length > 0) {
            $.each($('.customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
            $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                // if ($('.customer-group-custom-group-wrapper').length == 0) {
                //     //console.log("empty")
                //     $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
                // } else {
                //     //console.log("not empty")
                // }

                // if (element.type == "new_member") {
                //     $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                // } else if (element.type == "old_member") {
                //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                // }
                // $('#customer-group-custom-groups-list-wrapper').find(`.customer-group-custom-group-wrapper[data-id="${element.id}"]`).remove();
            })
            // if ($('.customer-group-custom-group-wrapper').length > 0) {
            //     //console.log("not empty")
            // } else {
            //     //console.log("empty")
            //     $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
            // }
        }
        callback();
    }, "page/customer/customer_group_custom_group_list_data", "#customer-group-custom-groups-list-template", '#customer-group-custom-groups-list-wrapper', getData);
}

function listenForCustomerGroupCustomGroupListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "customer",
                list_by: "draft_active_standard_customer_groups",
                count: 20,
                offset: digibiz.customerGroupCustomGroupsList.length
            }
            groupsList(reqParam)
                // groupsList(reqParam)
                .then((response) => {
                    scrollProcessCustomerGroupCustomGroupList(response, function () {
                        listenForCustomerGroupCustomGroupListScrollEvent($(".modal-popup-content"));
                        removeLoader();

                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function () {
                        removeLoader();
                    }, "page/customer/scroll_customer_group_custom_group_list_data", "#scroll-customer-group-custom-groups-list-template", '.customer-group-custom-groups-list-contentbox', null);
                })

        }
    });
}

function scrollProcessCustomerGroupCustomGroupList(data, callback) {
    digibiz.customerGroupCustomGroupsList = removeDuplicates(digibiz.customerGroupCustomGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        customer_group_custom_groups_list_data: digibiz.customerGroupCustomGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            //automatic checked while searching
            var getIndex = digibiz.customerGroupCustomGroupsList.findIndex((o) => o.id == e.id);
            if (getIndex > -1) {
                var getValue = digibiz.customerGroupCustomGroupsList[getIndex].selected;
                if (getValue == true) {
                    e['selected'] = true;
                }
            }
            return e;
        })
    };
    fetch.appendHtml(function () {
        //remove already present customers in the group
        var getMembers = [];
        if ($('.customer-group-member-wrapper').length > 0) {
            $.each($('.customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
            $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                // if ($('.customer-group-custom-group-wrapper').length == 0) {
                //     //console.log("empty")
                //     $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
                // } else {
                //     //console.log("not empty")
                // }

                // if (element.type == "new_member") {
                //     $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                // } else if (element.type == "old_member") {
                //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                // }
                // $('#customer-group-custom-groups-list-wrapper').find(`.customer-group-custom-group-wrapper[data-id="${element.id}"]`).remove();
            })
            if ($('.customer-group-custom-group-wrapper').length > 0) {
                //console.log("not empty")
            } else {
                //console.log("empty")
                $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
            }
        }
        callback();
    }, "page/customer/scroll-customer_group_custom_group_list_data", "#scroll-customer-group-custom-groups-list-template", '.customer-group-custom-groups-list-contentbox', getData);
}

/****COMMUNICATION GROUPS METHODS(starts)*************/
function getCommunicationGroupsPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            // type: "communication",
            list_by: "communication",
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        getCommunicationGroupsCount(reqParam).then((groupsCount) => {
            $('.communication-group-count').text(`${groupsCount}`);
        // var countreqParam = {
        //     device_id: crossplat.device.uuid,
        //     // type: "communication",
        //     list_by: "collaborator_communication",
        //     business_id: sessionStorage.getItem('business_id')
        // }
        // getGroupsCount(countreqParam).then((groupsCount) => {
        //     $('.communication-collaborator-groups-count').text(groupsCount);
        communicationGroupsList(reqParam).then((response) => {
            processCommunicationGroupsList(response, function () {
                appScroll.scrollBar('.communication-group-list-contentbox');
                listenForCommunicationGroupsListScrollEvent($('.communication-group-list-contentbox'));
                removeLoader();
                resolve();
            });
        })
            .catch((err) => {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", null);
            })
            }).catch((err) => {
                console.log('err', err);
            })
        // }).catch((err) => {
        //     console.log('err', err);
        // })
    })
}

function processCommunicationGroupsList(data, callback) {
    digibiz.communicationGroupsList = removeDuplicates(digibiz.communicationGroupsList.concat(data), "id");
    var communicationGroupsList = {
        communication_group_list_data: digibiz.communicationGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("communicationGroupsList", communicationGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", communicationGroupsList);
}

function listenForCommunicationGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                // type: "communication",
                list_by: "communication",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.communicationGroupsList.length
            }
            communicationGroupsList(reqParam)
                // groupsList(reqParam)
                .then((response) => {
                    scrollProcessCommunicationGroupsList(response, function () {
                        listenForCommunicationGroupsListScrollEvent($('.communication-group-list-contentbox'));
                        removeLoader();

                    });
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCommunicationGroupsList(data, callback) {
    digibiz.communicationGroupsList = removeDuplicates(digibiz.communicationGroupsList.concat(data), "id");
    var communicationGroupsList = {
        communication_group_list_data: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("communicationGroupsList", communicationGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/scroll_communication_group_list_data", "#scroll-communication-group-list-data-template", "#communication-group-list-list-wrapper .os-content", communicationGroupsList);
}


/**
 * 
 * collaborator communication grup
 */

function getCollaboratorCommunicationGroupsPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            // type: "communication",
            list_by: "collaborator_communication",
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        getCommunicationGroupsCount(reqParam).then((groupsCount) => {
        $('.collaborator-communication-group-count').text(`${groupsCount}`);
        var countreqParam = {
            device_id: crossplat.device.uuid,
            // type: "communication",
            list_by: "communication",
            business_id: sessionStorage.getItem('business_id'),
        }
        // getGroupsCount(countreqParam).then((groupsCountt) => {
        // $('.communication-business-groups-count').text(groupsCountt);
        communicationGroupsList(reqParam)
            .then((response) => {
                console.log("communicationGroupList response", response);
                processCollaboratorCommunicationGroupsList(response, function () {
                    appScroll.scrollBar('.communication-group-list-contentbox');
                    listenForCollaboratorCommunicationGroupsListScrollEvent($('.communication-group-list-contentbox'));
                    removeLoader();
                    resolve();
                });
            })
            .catch((err) => {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", null);
            })
        //     }).catch((err) => {
        //         console.log('err', err);
        //     })
        }).catch((err) => {
            console.log('err', err);
        })
    })
}

function processCollaboratorCommunicationGroupsList(data, callback) {
    digibiz.collaboratorCommunicationGroupsList = removeDuplicates(digibiz.collaboratorCommunicationGroupsList.concat(data), "id");
    var communicationGroupsList = {
        communication_group_list_data: digibiz.collaboratorCommunicationGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("communicationGroupsList", communicationGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#collaborator-communication-group-list-list-wrapper", communicationGroupsList);
}

function listenForCollaboratorCommunicationGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                // type: "communication",
                list_by: "communication",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.collaboratorCommunicationGroupsList.length
            }
            communicationGroupsList(reqParam)
                // groupsList(reqParam)
                .then((response) => {
                    scrollProcessCollaboratorCommunicationGroupsList(response, function () {
                        listenForCollaboratorCommunicationGroupsListScrollEvent($('.communication-group-list-contentbox'));
                        removeLoader();

                    });
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCollaboratorCommunicationGroupsList(data, callback) {
    digibiz.collaboratorCommunicationGroupsList = removeDuplicates(digibiz.collaboratorCommunicationGroupsList.concat(data), "id");
    var communicationGroupsList = {
        communication_group_list_data: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("communicationGroupsList", communicationGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/scroll_communication_group_list_data", "#scroll-communication-group-list-data-template", "#collaborator-communication-group-list-list-wrapper .os-content", communicationGroupsList);
}

function getCommunicationEmployeePage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "employee",
            business_id: sessionStorage.getItem('business_id'),
        }
        // communicationGroupList(reqParam)
        communicationGroupsList(reqParam)
            .then((response) => {
                //console.log("communicationGroupList response", response);
                fetch.replaceHtml(function () {
                    processCommunicationEmployeeGroupsList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/communication/employee_group_list_wrapper", "#communication-employee-groups-list-wrapper-template", "#communication-group-employee-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/communication/employee_group_list_data", "#communication-employee-group-list-data-template", "#communication-employee-group-list-wrapper", null);
                }, "page/communication/employee_group_list_wrapper", "#communication-employee-groups-list-wrapper-template", "#communication-group-employee-data-container", null);
            })
    })
}

function processCommunicationEmployeeGroupsList(data, callback) {
    digibiz.communicationEmployeeGroupsList = removeDuplicates(digibiz.communicationEmployeeGroupsList.concat(data), "id");
    var communicationGroupsList = {
        communication_employee_group_list_data: digibiz.communicationEmployeeGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("communicationGroupsList", communicationGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/employee_group_list_data", "#communication-employee-group-list-data-template", "#communication-employee-group-list-wrapper", communicationGroupsList);
}

function getCommunicationCustomerPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "customer",
            business_id: sessionStorage.getItem('business_id'),
        }
        // communicationGroupList(reqParam)
        communicationGroupsList(reqParam)
            .then((response) => {
                //console.log("communicationGroupList response", response);
                fetch.replaceHtml(function () {
                    processCommunicationCustomerGroupsList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/communication/customer_group_list_wrapper", "#communication-customer-groups-list-wrapper-template", "#communication-group-customer-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/communication/customer_group_list_data", "#communication-customer-group-list-data-template", "#communication-customer-group-list-wrapper", null);
                }, "page/communication/customer_group_list_wrapper", "#communication-customer-groups-list-wrapper-template", "#communication-group-customer-data-container", null);
            })
    })
}

function processCommunicationCustomerGroupsList(data, callback) {
    digibiz.communicationCustomerGroupsList = removeDuplicates(digibiz.communicationCustomerGroupsList.concat(data), "id");
    var communicationGroupsList = {
        communication_customer_group_list_data: digibiz.communicationCustomerGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                //     e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("communicationGroupsList", communicationGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/customer_group_list_data", "#communication-customer-group-list-data-template", "#communication-customer-group-list-wrapper", communicationGroupsList);
}


//used
function getCommunicationGroupDetailPage() {
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('group_id') === undefined || sessionStorage.getItem('group_id') === null || sessionStorage.getItem('group_id') == "") {
            var getData = {};
            if (sessionStorage.getItem('group_from') == "group_list") {
                getData = {
                    communication_group_type: "group_list",
                    is_owner: true
                }
            } else {
                getData = {
                    communication_group_type: "contact_list",
                    is_owner: true
                }
            }
          
            fetch.replaceHtml(function () {
                if (sessionStorage.getItem('group_from') == "group_list") {
                    $('.communication-group-creation-group-moderator-section').addClass('hide');
                    $('.search-member-button').addClass('hide');
                }
                if (sessionStorage.getItem('group_from') == "contact_list") {
                    $('.search-member-button').removeClass('hide');
                }
                removeLoader();
                appScroll.scrollBar('#main-container');
                resolve();
            }, "page/communication/communication_group_detail_page", "#communication-group-details-template", "#main-content-wrapper", getData);
        } else {
            var reqparams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id')
            }
            groupGet(reqparams)
                .then((response) => {
                    console.log("communicationGroupGet response", response);
                    //get group_type and set session
                    sessionStorage.setItem('group_type', response.group_from);
                    sessionStorage.setItem('group_from', response.group_type);
                    if (response.hasOwnProperty('group_image') && response.group_image) {
                        if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                            var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                            response.group_image['avtarUrl'] = avtarUrl;
                            response['imageLetter'] = response.name.charAt(0);
                        } else {
                            response['imageLetter'] = response.name.charAt(0);
                        }
                    } else {
                        response['imageLetter'] = response.name.charAt(0);
                    }
                    var requestParams = {
                        device_id: crossplat.device.uuid,
                        group_id: sessionStorage.getItem('group_id'),
                        list_by: "employee_members",
                        count: 5,
                        offset: 0
                    }
                    getGroupMembers(requestParams)
                        .then((mmresponse) => {
                            var membersResponse = mmresponse.membersList;
                            console.log("communicationGroupMemberList response", membersResponse);
                            var groupModeratorData = [];
                            var customerRequestParams = {
                                device_id: crossplat.device.uuid,
                                group_id: sessionStorage.getItem('group_id'),
                                list_by: "customer_members",
                                count: 5,
                                offset: 0
                            }
                            getGroupMembers(customerRequestParams)
                                .then((responsess) => {
                                    var customerMembersResponse = responsess.membersList;
                                    var groupModeratorData = [];
                                    var collaboratorRequestParams = {
                                        device_id: crossplat.device.uuid,
                                        group_id: sessionStorage.getItem('group_id'),
                                        list_by: "collaborator_members",
                                        count: 5,
                                        offset: 0
                                    }
                                    getGroupMembers(collaboratorRequestParams)
                                        .then((responsessss) => {
                                            var collaboratorMembersResponse = responsessss.membersList;
                                            // if (response.hasOwnProperty('moderator') && response.moderator) {
                                            //     digibiz.group_moderator_list = response.moderator;
                                            //     // groupModeratorData = 
                                            // }
                                            var modReqParams = {
                                                device_id: crossplat.device.uuid,
                                                id: sessionStorage.getItem('group_id'),
                                                count: 5,
                                                offset: 0
                                            }
                                            
                                            getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                                                digibiz.group_moderator_list = [];
                                                digibiz.group_moderator_list = moderatorResponse.moderator;
                                                var groupData = {
                                                    group_data: response,
                                                    // group_moderator_data: groupModeratorData,
                                                    employeeMembersCount: mmresponse.membersCount,
                                                    customerMembersCount: responsess.membersCount,
                                                    collaboratorMembersCount: responsessss.membersCount,
                                                    totalMembersCount:  mmresponse.membersCount + responsess.membersCount + responsessss.membersCount,
                                                    communication_group_type: response.group_type,
                                                    group_collaborator_members_data: collaboratorMembersResponse.map(e => {
                                                        if (e.member.type == "employee") {
                                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.identity_picture['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                            }
                                                        } else if (e.member.type == "customer") {
                                                            if (e.member.customer_type == "customer") {
                                                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                    var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // } else {
                                                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // }
                                                                } else {
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                }
                                                            } else if (e.member.customer_type == "associate_customer") {
                                                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                    var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // } else {
                                                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // }
                                                                } else {
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                }
                                                            }
                                                        } else if (e.member.type == "employee_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        } else if (e.member.type == "customer_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        } else if (e.member.type == "collaborator_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        }
                                                        return e;
                                                    }),
                                                    group_customer_members_data: customerMembersResponse.map(e => {
                                                        if (e.member.type == "employee") {
                                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.identity_picture['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                            }
                                                        } else if (e.member.type == "customer") {
                                                            if (e.member.customer_type == "customer") {
                                                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                    var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // } else {
                                                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // }
                                                                } else {
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                }
                                                            } else if (e.member.customer_type == "associate_customer") {
                                                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                    var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // } else {
                                                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // }
                                                                } else {
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                }
                                                            }
                                                        } else if (e.member.type == "employee_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        } else if (e.member.type == "customer_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        } else if (e.member.type == "collaborator_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        }
                                                        return e;
                                                    }),
                                                    group_members_data: membersResponse.map(e => {
                                                        if (e.member.type == "employee") {
                                                            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.identity_picture['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.first.charAt(0);
                                                            }
                                                        } else if (e.member.type == "customer") {
                                                            if (e.member.customer_type == "customer") {
                                                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                    var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // } else {
                                                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // }
                                                                } else {
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                }
                                                            } else if (e.member.customer_type == "associate_customer") {
                                                                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                                                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                                                    var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                                                    e.identity_picture['avtarUrl'] = avtarUrl;
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // } else {
                                                                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                                                                    // }
                                                                } else {
                                                                    e['imageLetter'] = e.member_name.first.charAt(0);
                                                                }
                                                            }
                                                        } else if (e.member.type == "employee_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        } else if (e.member.type == "customer_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        } else if (e.member.type == "collaborator_group") {
                                                            if (e.hasOwnProperty('group_image') && e.group_image) {
                                                                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                                                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                                                                // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                                                                e.group_image['avtarUrl'] = avtarUrl;
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                                // } else {
                                                                //     e['imageLetter'] = e.member_name.charAt(0);
                                                                // }
                                                            } else {
                                                                e['imageLetter'] = e.member_name.charAt(0);
                                                            }
                                                        }
                                                        return e;
                                                    })
                                                }

                                                digibiz.communitcation_group_employee_members_list = [];
                                                digibiz.communitcation_group_employee_members_list = groupData.group_members_data;
                                                digibiz.communitcation_group_customer_members_list = [];
                                                digibiz.communitcation_group_customer_members_list = groupData.group_customer_members_data;
                                                digibiz.communitcation_group_collaborator_members_list = [];
                                                digibiz.communitcation_group_collaborator_members_list = groupData.group_collaborator_members_data;
                                              if(response.business_id == sessionStorage.getItem('business_id')) {
                                                groupData.is_owner = true;
                                              }
                                                console.log('groupData', groupData);
                                                fetch.replaceHtml(function (err) {
                                                    if (!err) {

                                                        // processGroupModeratorList(digibiz.group_moderator_list, function () {
                                                        //     appScroll.scrollBar('#communication-group-moderator-members-list');
                                                        //     listentForCommunicationGroupModeratorList($('#communication-group-moderator-members-list'));
                                                        // });
                                                        processGroupModeratorList(digibiz.group_moderator_list, function () {
                                                            appScroll.scrollBar('#communication-group-moderator-members-list');
                                                            listenForCommunicationGroupModeratorListScrollEvent($('#communication-group-moderator-members-list'));
                                                        });
                                                        // var n = 5 //get the first 5 items

                                                        // var firstFiveModeratorList = digibiz.group_moderator_list.slice(0, n);
                                                        // digibiz.listed_group_moderator_list = firstFiveModeratorList;
                                                        // processGroupModeratorData(firstFiveModeratorList, function () {
                                                        //     appScroll.scrollBar('#communication-group-moderator-members-list');
                                                        //     listentForCommunicationGroupModeratorList($('#communication-group-moderator-members-list'));
                                                        // });
                                                        $('.communication-group-creation-group-moderator-section').removeClass('hide');
                                                        removeLoader();
                                                        console.log('scroll test2');
                                                        appScroll.scrollBar('#main-container');
                                                        appScroll.scrollBar('#communication-group-employee-members-list');
                                                        listentForCommunicationGroupEmployeMembersList($('#communication-group-employee-members-list'));
                                                        appScroll.scrollBar('#communication-group-customer-members-list');
                                                        listentForCommunicationGroupCustomerMembersList($('#communication-group-customer-members-list'));
                                                        appScroll.scrollBar('#communication-group-collaborator-members-list');
                                                        listentForCommunicationGroupCollaboratorMembersList($('#communication-group-collaborator-members-list'));
                                                        resolve();
                                                    }
                                                }, "page/communication/communication_group_detail_page", "#communication-group-details-template", "#main-content-wrapper", groupData);
                                            }).catch((err) => {
                                                console.log('err', err);
                                            })
                                        }).catch((err) => {
                                            console.log('err', err);
                                        })
                                }).catch((err) => {
                                    console.log('err', err);
                                })
                        })
                        .catch((err) => {
                            //console.log("error in employee group members data");
                            var groupData = {
                                group_data: response
                            }
                            //console.log("groupData", groupData);
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    console.log('scroll test3');
                                    resolve();
                                }
                            }, "page/communication/communication_group_detail_page", "#communication-group-details-template", "#main-content-wrapper", groupData);
                        })
                })
                .catch((err) => {
                    //console.log("error in employee group get");
                    removeLoader();
                    resolve();
                })

        }
    })
}

function getCommunicationEmployeeGroupDetailPage() {
    return new Promise((resolve, reject) => {
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        groupGet(reqparams)
            .then((response) => {
                //console.log("employeeGroupGet response", response);
                if (response.hasOwnProperty('group_image') && response.group_image) {
                    if (response.group_image.hasOwnProperty('asset_id') && response.group_image.asset_id) {
                        var avtarUrl = `${api.get_employee_group_thumbnail}?id=${response.id}&device_id=${crossplat.device.uuid}`;
                        response.group_image['avtarUrl'] = avtarUrl;
                        response['imageLetter'] = response.name.charAt(0);
                    } else {
                        response['imageLetter'] = response.name.charAt(0);
                    }
                } else {
                    response['imageLetter'] = response.name.charAt(0);
                }
                if (response.group_type == "standard") {
                    var groupData = {
                        group_data: response,
                        group_moderator_data: response.moderator
                    }
                    //console.log("groupData", groupData);
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/communication/employee_group_detail_page", "#communication-employee-group-detail-template", "#main-content-wrapper", groupData);
                } else if (response.group_type == "custom") {
                    if (response.custom_group_from == "employee_list") {
                        var requestParams = {
                            device_id: crossplat.device.uuid,
                            group_id: sessionStorage.getItem('group_id')
                        }
                        getGroupMembers(requestParams)
                            .then((membesponse) => {
                                var membersResponse = membesponse.membersList;
                                //console.log("employeeGroupMemberList response", membersResponse);
                                var groupData = {
                                    group_data: response,
                                    membersCount: membesponse.membersCount,
                                    group_moderator_data: response.moderator,
                                    group_members_data: membersResponse.map(e => {
                                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                            // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                            var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}`;
                                            e.identity_picture['avtarUrl'] = avtarUrl;
                                            e['imageLetter'] = e.member_name.first.charAt(0);
                                            // } else {
                                            //     e['imageLetter'] = e.member_name.first.charAt(0);
                                            // }
                                        } else {
                                            e['imageLetter'] = e.member_name.first.charAt(0);
                                        }
                                        return e;
                                    })
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/communication/employee_group_detail_page", "#communication-employee-group-detail-template", "#main-content-wrapper", groupData);
                            })
                            .catch((err) => {
                                //console.log("error in employee group members data");
                                var groupData = {
                                    group_data: response,
                                    group_moderator_data: response.moderator
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/communication/employee_group_detail_page", "#communication-employee-group-detail-template", "#main-content-wrapper", groupData);
                            })
                    } else if (response.custom_group_from == "department_list") {
                        var groupData = {
                            group_data: response,
                            group_moderator_data: response.moderator,
                            department_list_data: response.department_data.map(e => {
                                e['imageLetter'] = e.name.charAt(0);
                                return e;
                            })
                        }
                        //console.log("groupData", groupData);
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/communication/employee_group_detail_page", "#communication-employee-group-detail-template", "#main-content-wrapper", groupData);
                    }
                }
            })
            .catch((err) => {
                //console.log("error in employee group get");
                location.hash = `communication/groups`;
                resolve();
            })
    })
}

function getCommunicationCustomerGroupDetailPage() {
    return new Promise((resolve, reject) => {
        var reqparams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('group_id')
        }
        groupGet(reqparams)
            .then((response) => {
                //console.log("group response", response);
                if (response.hasOwnProperty('group_image') && response.group_image) {
                    if (response.group_image.hasOwnProperty('asset_id') && response.group_image.asset_id) {
                        var avtarUrl = `${api.get_employee_group_thumbnail}?id=${response.id}&device_id=${crossplat.device.uuid}`;
                        response.group_image['avtarUrl'] = avtarUrl;
                        response['imageLetter'] = response.name.charAt(0);
                    } else {
                        response['imageLetter'] = response.name.charAt(0);
                    }
                } else {
                    response['imageLetter'] = response.name.charAt(0);
                }
                if (response.group_type == "standard" || response.group_type == "primary_associate_customers" || response.group_type == "primary_customers") {
                    var groupData = {
                        group_data: response,
                        group_moderator_data: response.moderator,
                    }
                    //console.log("groupData", groupData);
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/communication/customer_group_detail_page", "#communication-customer-group-detail-template", "#main-content-wrapper", groupData);

                } else if (response.group_type == "custom") {
                    if (response.custom_group_from == "contact_list") {
                        var requestParams = {
                            device_id: crossplat.device.uuid,
                            group_id: sessionStorage.getItem('group_id')
                        }
                        getGroupMembers(requestParams)
                            .then((membesponse) => {
                                var membersResponse = membesponse.membersList;
                                //console.log("response", membersResponse);
                                var groupData = {
                                    group_data: response,
                                    membersCount: membesponse.membersCount,
                                    group_moderator_data: response.moderator,
                                    group_members_data: membersResponse.map(e => {
                                        if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                                            // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                                            var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                                            e.identity_picture['avtarUrl'] = avtarUrl;
                                            e['imageLetter'] = e.member_name.first.charAt(0);
                                            // } else {
                                            //     e['imageLetter'] = e.member_name.first.charAt(0);
                                            // }
                                        } else {
                                            e['imageLetter'] = e.member_name.first.charAt(0);
                                        }
                                        return e;
                                    })
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/communication/customer_group_detail_page", "#communication-customer-group-detail-template", "#main-content-wrapper", groupData);
                            })
                            .catch((err) => {
                                var groupData = {
                                    group_data: response
                                }
                                //console.log("groupData", groupData);
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/communication/customer_group_detail_page", "#communication-customer-group-detail-template", "#main-content-wrapper", groupData);
                            })

                    } else if (response.custom_group_from == "group_list") {
                        var groupData = {
                            group_data: response,
                            group_moderator_data: response.moderator,
                            group_members_data: response.customer_data.map(e => {
                                e['imageLetter'] = e.name.charAt(0);
                                return e;
                            })
                        }
                        //console.log("groupData", groupData);
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/communication/customer_group_detail_page", "#communication-customer-group-detail-template", "#main-content-wrapper", groupData);
                    }
                }
            })
            .catch((err) => {
                //console.log("error in group get");
                location.hash = `communication/groups`;
                resolve();
            })
    })
}

// function processCommunicationGroupCustomerContactsList(data, callback) {
//     digibiz.communicationGroupsCustomerContactsList = removeDuplicates(digibiz.communicationGroupsCustomerContactsList.concat(data), 'id');
//     //put it in modal
//     var getData = {
//         communication_group_identifier_based_customer_contact_list_data: digibiz.communicationGroupsCustomerContactsList
//     };
//     fetch.replaceHtml(function () {
//         //remove already present customers in the group
//         var getMembers = [];
//         if ($('.communication-group-customer-member-wrapper').length > 0) {
//             $.each($('.communication-group-customer-member-wrapper'), function (index, element) {
//                 getMembers.push({
//                     id: $(element).attr('data-id'),
//                     type: "new_member"
//                 });
//                 // $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${$(element).attr('data-id')}"]`).remove();
//             });
//         }
//         if ($('#communication-group-customer-members-list').find('.communication-group-member-wrapper').length > 0) {
//             $.each($('#communication-group-customer-members-list .communication-group-member-wrapper'), function (index, element) {
//                 getMembers.push({
//                     id: $(element).attr('data-customer-id'),
//                     type: "old_member"
//                 });
//             });
//         }
//         if (getMembers.length > 0) {
//             $.each(getMembers, function (index, element) {
//                 if (element.type == "new_member") {
//                     $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${element.id}"]`).remove();
//                 } else if (element.type == "old_member") {
//                     $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${element.id}"]`).remove();
//                     // $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
//                 }
//             })
//         }
//         callback();
//     }, "page/communication/customer_identifier_based_contact_list", "#communication-group-identifier-based-customer-contact-list-data-template", '#communication-group-contacts-items-list-wrapper', getData);
// }



function processCommunicationGroupActivateEmployeeGroupsList(data, callback) {
    digibiz.communicationActivateEmployeeGroupsList = removeDuplicates(digibiz.communicationActivateEmployeeGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: digibiz.communicationActivateEmployeeGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
        page_for: "activate_communication_group"
    };
    fetch.replaceHtml(function () {
        callback();
    }, "page/communication/employee_group_selection", "#employee-group-list-selection-template", '#communication-group-activate-employee-group-list-wrapper', getData);
}

function processCommunicationGroupActivateEmployeeGroupEmployeeList(data = null, groupData = null, callback) {
    //console.log("processCommunicationGroupActivateEmployeeGroupEmployeeList", groupData)
    if (data) {
        digibiz.communicationActivateEmployeeGroupEmployeeList = removeDuplicates(digibiz.communicationActivateEmployeeGroupEmployeeList.concat(data), 'id');
    }
    if (groupData && groupData.moderator && groupData.moderator.length > 0) {
        $.each(groupData.moderator, function (index, moderator) {
            if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                // //console.log("&", $(`.accordion-content[data-group-id="${moderator.group_id}"]`))
                // //console.log("&&&", $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`))
                // //console.log("&@@@@", $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper'))
                // $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                //this line wont be executed because still html content is not loaded here
                $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').addClass('selected-row');
                //check in the global array
                // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == moderator.group_id);
                // if (getIndex > -1) {
                //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == moderator.group_id);
                //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == moderator.id);
                //     if (getEmployeeIndex > -1) {
                //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
                //     }
                // }
                digibiz.employeeSelectedContactList.push({
                    id: moderator.id,
                    group_id: moderator.group_id,
                    selected: true
                })
            } else {
                //check in the global array
                if (groupData.group_type == "standard") {
                    //console.log("@@@")
                    var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.dj_unique_employee_id == moderator.id);
                    if (getIndex > -1) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
                    }
                } else {
                    var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.dj_unique_employee_id == moderator.id);
                    if (getIndex > -1) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
                    }
                }
            }
        })
    }
    //put it in modal
    if (groupData && groupData.group_type == "standard") {
        var getData = {
            EmployeeList: digibiz.communicationActivateEmployeeGroupEmployeeList.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            }),
            from: "direct"//standard
        };
    } else if (groupData && groupData.group_type == "custom" && groupData.custom_group_from == "employee_list") {
        var getData = {
            EmployeeList: digibiz.communicationActivateEmployeeGroupEmployeeList.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                return e;
            }),
            from: "employee_list"
        };
    } else if (groupData && groupData.group_type == "custom" && groupData.custom_group_from == "standard_group") {
        var getData = {
            EmployeeList: digibiz.communicationActivateEmployeeGroupEmployeeList.map(e => {
                if (e.hasOwnProperty('group_members') && e.group_members) {
                    $.each(e.group_members, function (index, member) {
                        // //console.log("member", member);
                        if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                            if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                member.identity_picture['avtarUrl'] = avtarUrl;
                                // member['imageLetter'] = member_name.charAt(0);
                            } else {
                                if (member.hasOwnProperty('display_name') && member.display_name) {
                                    member['imageLetter'] = member.display_name.charAt(0);
                                } else {
                                    member['imageLetter'] = member.name.first.charAt(0);
                                }
                            }
                        } else {
                            if (member.hasOwnProperty('display_name') && member.display_name) {
                                member['imageLetter'] = member.display_name.charAt(0);
                            } else {
                                member['imageLetter'] = member.name.first.charAt(0);
                            }
                        }
                    })
                }
                return e;
            }),
            from: "standard_group"
        };
    }
    console.log("getData", getData);
    fetch.replaceHtml(function () {
        $('.expand-search-wrap').removeClass('active').children('.expand-search-input').val('').removeClass('searchexpand');
        //check already present moderator in the modal
        if (digibiz.alreadySelected.length > 0) {
            $.each(digibiz.alreadySelected, function (index, moderator) {
                if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                    $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').addClass('selected-row');
                }
                //  else {
                //     $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                // }
            })
        }
        callback();
    }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper', getData);
}

function listenForGroupMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id')
            }
            if (sessionStorage.getItem('group_id')) {
                requestParams.id = sessionStorage.getItem('group_id');
            } else {
                requestParams.id = sessionStorage.getItem('activate_group_id');
            }
            groupGet(requestParams)
                .then((groupResponse) => {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: sessionStorage.getItem('group_id'),
                        count: 20,
                        offset: digibiz.communicationActivateEmployeeGroupEmployeeList.length
                    }
                    if (sessionStorage.getItem('group_id')) {
                        reqParam.group_id = sessionStorage.getItem('group_id');
                    } else {
                        reqParam.group_id = sessionStorage.getItem('activate_group_id');
                    }
                    getCompleteGroupMembers(reqParam)
                        .then((response) => {
                            removeLoader();
                            if (response && response.length > 0) {
                                scrollProcessCommunicationGroupActivateEmployeeGroupEmployeeList(response, groupResponse, function () {
                                    listenForGroupMembersList($(".modal-popup-content"));
                                    removeLoader();
                                });
                            } else {
                                var getData = {
                                    from: 'direct'
                                }
                                fetch.appendHtml(function () {
                                    removeLoader();
                                    console.log('err', err);
                                }, "page/communication/scroll_employee_selection_list", "#scroll-employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper .employee-selection-member-list', getData);
                            }
                        })
                        .catch((err) => {
                            var getData = {
                                from: 'direct'
                            }
                            fetch.appendHtml(function () {
                                removeLoader();
                                console.log('err', err);
                            }, "page/communication/scroll_employee_selection_list", "#scroll-employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper .employee-selection-member-list', null);
                        })
                }).catch((err) => {
                    console.log('err', err);
                    var getData = {
                        from: 'direct'
                    }
                    fetch.appendHtml(function () {
                        removeLoader();
                        console.log('err', err);
                    }, "page/communication/scroll_employee_selection_list", "#scroll-employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper .employee-selection-member-list', null);
                })

        }
    });
}

function scrollProcessCommunicationGroupActivateEmployeeGroupEmployeeList(data = null, groupData = null, callback) {
    console.log("groupData", groupData)
    if (data) {
        digibiz.communicationActivateEmployeeGroupEmployeeList = removeDuplicates(digibiz.communicationActivateEmployeeGroupEmployeeList.concat(data), 'id');
    }
    if (groupData && groupData.moderator && groupData.moderator.length > 0) {
        $.each(groupData.moderator, function (index, moderator) {
            if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                // //console.log("&", $(`.accordion-content[data-group-id="${moderator.group_id}"]`))
                // //console.log("&&&", $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`))
                // //console.log("&@@@@", $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper'))
                // $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                //this line wont be executed because still html content is not loaded here
                $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').addClass('selected-row');
                //check in the global array
                // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == moderator.group_id);
                // if (getIndex > -1) {
                //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == moderator.group_id);
                //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == moderator.id);
                //     if (getEmployeeIndex > -1) {
                //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
                //     }
                // }
                digibiz.employeeSelectedContactList.push({
                    id: moderator.id,
                    group_id: moderator.group_id,
                    selected: true
                })
            } else {
                //check in the global array
                if (groupData.group_type == "standard") {
                    //console.log("@@@")
                    var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.dj_unique_employee_id == moderator.id);
                    if (getIndex > -1) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
                    }
                } else {
                    var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.dj_unique_employee_id == moderator.id);
                    if (getIndex > -1) {
                        digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
                    }
                }
            }
        })
    }
    //put it in modal
    if (groupData && groupData.group_type == "standard") {
        var getData = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            }),
            from: "direct"//standard
        };
    } else if (groupData && groupData.group_type == "custom" && groupData.custom_group_from == "employee_list") {
        var getData = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                return e;
            }),
            from: "employee_list"
        };
    } else if (groupData && groupData.group_type == "custom" && groupData.custom_group_from == "standard_group") {
        var getData = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('group_members') && e.group_members) {
                    $.each(e.group_members, function (index, member) {
                        // //console.log("member", member);
                        if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                            if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                member.identity_picture['avtarUrl'] = avtarUrl;
                                // member['imageLetter'] = member.display_name.charAt(0);
                            } else {
                                // if (member.hasOwnProperty('display_name') && member.display_name) {
                                //     member['imageLetter'] = member.display_name.charAt(0);
                                // } else {
                                member['imageLetter'] = member_name.charAt(0);
                                // }
                            }
                        } else {
                            // if (member.hasOwnProperty('display_name') && member.display_name) {
                            //     member['imageLetter'] = member.display_name.charAt(0);
                            // } else {
                            member['imageLetter'] = member_name.charAt(0);
                            // }
                        }
                    })
                }
                return e;
            }),
            from: "standard_group"
        };
    } else {
        var getData = {
            from: 'direct'
        }
    }
    console.log("getData", getData);
    fetch.appendHtml(function () {
        $('.expand-search-wrap').removeClass('active').children('.expand-search-input').val('').removeClass('searchexpand');
        //check already present moderator in the modal
        if (digibiz.alreadySelected.length > 0) {
            $.each(digibiz.alreadySelected, function (index, moderator) {
                if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                    $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').addClass('selected-row');
                }
                //  else {
                //     $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                // }
            })
        }
        callback();
    }, "page/communication/scroll_employee_selection_list", "#scroll-employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper .employee-selection-member-list', getData);
}

function processCommunicationGroupCreateEmployeeGroupEmployeeList(data, callback) {
    //console.log("data", data);
    digibiz.communicationCreateEmployeeGroupEmployeeList = removeDuplicates(digibiz.communicationCreateEmployeeGroupEmployeeList.concat(data), 'id');
    //console.log("check", digibiz.communicationCreateEmployeeGroupEmployeeList)
    if (digibiz.alreadySelected.length > 0) {
        $.each(digibiz.alreadySelected, function (index, moderator) {
            if (moderator.type == "employee" && $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id') == moderator.group_id) {
                //console.log("moderTOR", moderator.id);
                // $(`#modal-communication-group-create-employee-group-employee-list-selection[data-group-id="${moderator.group_id}"]`).find(`.communication-group-create-employee-moderator-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                var getIndex = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex((e) => e.dj_unique_employee_id == moderator.id);
                //console.log("log", getIndex)
                if (getIndex > -1) {
                    digibiz.communicationCreateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
                    if (moderator.hasOwnProperty('moderator_type') && moderator.moderator_type == "fixed") {
                        digibiz.communicationCreateEmployeeGroupEmployeeList[getIndex]['disabled'] = true;
                        // $(`#modal-communication-group-create-employee-group-employee-list-selection[data-group-id="${moderator.group_id}"]`).find(`.communication-group-create-employee-moderator-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('disabled', true);
                    }
                }

            }
        })
    }
    //put it in modal
    var getData = {
        EmployeeList: digibiz.communicationCreateEmployeeGroupEmployeeList.map(e => {
            //console.log("e", e)
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "group",
        type: "commuication_create_group_list"
    };
    //console.log("getData11", getData)
    fetch.replaceHtml(function () {
        //check already present moderator in the modal
        //console.log("0987", digibiz.alreadySelected)

        callback();
    }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-create-employee-group-employee-list-wrapper', getData);
}

function processCommunicationGroupCreateCustomerGroupCustomerList(data, callback) {
    digibiz.communicationCreateEmployeeGroupEmployeeList = removeDuplicates(digibiz.communicationCreateEmployeeGroupEmployeeList.concat(data), 'id');
    if (digibiz.alreadySelected.length > 0) {
        $.each(digibiz.alreadySelected, function (index, moderator) {
            if ((moderator.type == "customer" || moderator.type == "associate_customer") && $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id') == moderator.group_id) {
                //console.log("moderTOR", moderator.id);
                var getIndex = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex((e) => e.id == moderator.id && e.type == moderator.type);
                //console.log("log", getIndex)
                if (getIndex > -1) {
                    digibiz.communicationCreateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
                }
            }
        })
    }
    //put it in modal
    var getData = {
        customerList: digibiz.communicationCreateEmployeeGroupEmployeeList.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        // from: "group",
        // type: "commuication_create_group_list"
    };
    fetch.replaceHtml(function () {
        // //check already present moderator in the modal
        // //console.log("check already present", digibiz.alreadySelected)
        // if (digibiz.alreadySelected.length > 0) {
        //     $.each(digibiz.alreadySelected, function (index, moderator) {
        //         if (moderator.type == "customer") {
        //             $(`#modal-communication-group-create-employee-group-employee-list-selection[data-group-id="${moderator.group_id}"]`).find(`.communication-group-activate-customer-select-btn[data-customer-id="${moderator.id}"]`).prop('checked', true);
        //         }
        //     })
        // }
        callback();
    }, "page/communication/customer_selection_list", "#customer-selection-list-template", '#communication-group-create-employee-group-employee-list-wrapper', getData);
}


function processCommunicationGroupActivateCustomerGroupsList(data, callback) {
    digibiz.communicationActivateCustomersGroupsList = removeDuplicates(digibiz.communicationActivateCustomersGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: digibiz.communicationActivateCustomersGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
        page_for: "activate_communication_group"
    };
    fetch.replaceHtml(function () {
        callback();
    }, "page/communication/customer_group_selection", "#customer-group-list-selection-template", '#communication-group-activate-customer-group-list-wrapper', getData);
}

function processCommunicationGroupActivateCustomerGroupCustomersList(data, callback) {
    digibiz.communicationActivateCustomerGroupCustomersList = removeDuplicates(digibiz.communicationActivateCustomerGroupCustomersList.concat(data), 'id');
    //put it in modal
    var getData = {
        customerList: digibiz.communicationActivateCustomerGroupCustomersList.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "group"
    };
    fetch.replaceHtml(function () {
        //check already present moderator in the modal
        if (digibiz.alreadySelected.length > 0) {
            $.each(digibiz.alreadySelected, function (index, moderator) {
                $(`.communication-group-activate-customer-select-btn[data-customer-id="${moderator.id}"]`).prop('checked', true);
            })
        }
        callback();
    }, "page/communication/customer_selection_list", "#customer-selection-list-template", '#communication-group-activate-customer-group-customers-list-wrapper', getData);
}


function processCommunicationGroupCreateEmployeeGroupsList(data, callback) {
    digibiz.communicationCreateEmployeeGroupsList = removeDuplicates(digibiz.communicationCreateEmployeeGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: digibiz.communicationCreateEmployeeGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
        page_for: "create_communication_group"
    };
    fetch.replaceHtml(function () {
        var getMembers = [];
        if ($('.communication-group-employee-group-member-wrapper').length > 0) {
            $.each($('.communication-group-employee-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#communication-group-employee-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-employee-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        //remove members from the modal
        //console.log("getMembers", getMembers)
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                if (element.type == "new_member") {
                    $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                } else if (element.type == "old_member") {
                    $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                }
            })
        }
        if ($('#modal-communication-group-employee-group-selection').find(`.group-selection-wrapper`).length > 0) {
            //console.log("empty modal")
        } else {
            $('.employee-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
        }
        callback();
    }, "page/communication/employee_group_selection", "#employee-group-list-selection-template", '#communication-group-create-employee-group-list-wrapper', getData);
}

function listenForCommunicationGroupCreateEmployeeGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "active_employee_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.communicationCreateEmployeeGroupsList.length
            }
            groupsList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessCommunicationGroupCreateEmployeeGroupsList(response, function () {
                        listenForCommunicationGroupCreateEmployeeGroupsListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    var getData = {
                        page_for: "create_communication_group"
                    };
                    fetch.appendHtml(function () {
                        removeLoader();
                        console.log('err', err);
                    }, "page/communication/scroll_employee_group_selection", "#scroll-employee-group-list-selection-template", '#communication-group-create-employee-group-list-wrapper .employee-group-list-selection-main-container', getData);
                })

        }
    });
}

function scrollProcessCommunicationGroupCreateEmployeeGroupsList(data, callback) {
    digibiz.communicationCreateEmployeeGroupsList = removeDuplicates(digibiz.communicationCreateEmployeeGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&business_id=${e.business_id}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
        page_for: "create_communication_group"
    };
    fetch.appendHtml(function () {
        var getMembers = [];
        if ($('.communication-group-employee-group-member-wrapper').length > 0) {
            $.each($('.communication-group-employee-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#communication-group-employee-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-employee-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        //remove members from the modal
        //console.log("getMembers", getMembers)
        if (getMembers.length > 0) {
            // $.each(getMembers, function (index, element) {
            //     if (element.type == "new_member") {
            //         $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
            //     } else if (element.type == "old_member") {
            //         $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
            //     }
            // })
        }
        if ($('#modal-communication-group-employee-group-selection').find(`.group-selection-wrapper`).length > 0) {
            //console.log("empty modal")
        } else {
            $('.employee-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
        }
        callback();
    }, "page/communication/scroll_employee_group_selection", "#scroll-employee-group-list-selection-template", '#communication-group-create-employee-group-list-wrapper .employee-group-list-selection-main-container', getData);
}


function processCommunicationGroupCreateCustomerGroupsList(data, callback) {
    digibiz.communicationCreateCustomersGroupsList = removeDuplicates(digibiz.communicationCreateCustomersGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: digibiz.communicationCreateCustomersGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
        page_for: "create_communication_group"
    };
    fetch.replaceHtml(function () {
        var getMembers = [];
        if ($('.communication-group-customer-group-member-wrapper').length > 0) {
            $.each($('.communication-group-customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#communication-group-customer-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-customer-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        //remove members feom the modal
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                if (element.type == "new_member") {
                    $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                } else if (element.type == "old_member") {
                    $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                }
            })
        }
        if ($('#modal-communication-group-customer-group-selection').find(`.group-selection-wrapper`).length > 0) {
            //console.log("empty modal")
        } else {
            $('.customer-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
        }
        callback();
    }, "page/communication/customer_group_selection", "#customer-group-list-selection-template", '#communication-group-create-customer-group-list-wrapper', getData);
}

function listenForCommunicationGroupCreateCustomerGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "customer",
                list_by: "draft_active_customer_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.communicationCreateCustomersGroupsList.length
            }
            groupsList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessCommunicationGroupCreateCustomerGroupsList(response, function () {
                        listenForCommunicationGroupCreateCustomerGroupsListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    var getData = {
                        page_for: "create_communication_group"
                    };
                    fetch.appendHtml(function () {
                        removeLoader();
                        console.log('err', err);
                    }, "page/communication/scroll_customer_group_selection", "#scroll-customer-group-list-selection-template", '#communication-group-create-customer-group-list-wrapper .customer-group-list-selection-main-container', getData);
                })

        }
    });
}

function scrollProcessCommunicationGroupCreateCustomerGroupsList(data, callback) {
    digibiz.communicationCreateCustomersGroupsList = removeDuplicates(digibiz.communicationCreateCustomersGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
        page_for: "create_communication_group"
    };
    fetch.appendHtml(function () {
        var getMembers = [];
        if ($('.communication-group-customer-group-member-wrapper').length > 0) {
            $.each($('.communication-group-customer-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#communication-group-customer-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-customer-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        //remove members feom the modal
        if (getMembers.length > 0) {
            // $.each(getMembers, function (index, element) {
            //     if (element.type == "new_member") {
            //         $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
            //     } else if (element.type == "old_member") {
            //         $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
            //     }
            // })
        }
        if ($('#modal-communication-group-customer-group-selection').find(`.group-selection-wrapper`).length > 0) {
            //console.log("empty modal")
        } else {
            $('.customer-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
        }
        callback();
    }, "page/communication/scroll_customer_group_selection", "#scroll-customer-group-list-selection-template", '#communication-group-create-customer-group-list-wrapper .customer-group-list-selection-main-container', getData);
}


function processCommunicationGroupCreateCollaboratorGroupsList(data, callback) {
    digibiz.communicationCreateCollaboratorGroupsList = removeDuplicates(digibiz.communicationCreateCollaboratorGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: digibiz.communicationCreateCollaboratorGroupsList.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
    };
    fetch.replaceHtml(function () {
        var getMembers = [];
        if ($('.communication-group-collaborator-group-member-wrapper').length > 0) {
            $.each($('.communication-group-collaborator-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#communication-group-collaborator-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-collaborator-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        //remove members from the modal
        //console.log("getMembers", getMembers)
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                if (element.type == "new_member") {
                    $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                } else if (element.type == "old_member") {
                    $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                }
            })
        }
        if ($('#modal-communication-group-collaborator-group-selection').find(`.group-selection-wrapper`).length > 0) {
            //console.log("empty modal")
        } else {
            $('.collaborator-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
        }
        callback();
    }, "page/communication/collaborator_group_selection", "#collaborator-group-list-selection-template", '#communication-group-create-collaborator-group-list-wrapper', getData);
}

function listenForCommunicationGroupCreateCollaboratorGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "all_my_active_collaborator_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.communicationCreateCollaboratorGroupsList.length
            }
            collaboratorGroupsList(reqParam)
                .then((response) => {
                    removeLoader();
                    processCommunicationGroupCreateCollaboratorGroupsList(response, function () {
                        listenForCommunicationGroupCreateCollaboratorGroupsListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function () {
                        removeLoader();
                        console.log('err', err);
                    }, "page/communication/scroll_collaborator_group_selection", "#scroll-collaborator-group-list-selection-template", '#communication-group-create-collaborator-group-list-wrapper .collaborator-group-list-selection-main-container', null);
                })

        }
    });
}

function scrollProcessCommunicationGroupCreateCollaboratorGroupsList(data, callback) {
    digibiz.communicationCreateCollaboratorGroupsList = removeDuplicates(digibiz.communicationCreateCollaboratorGroupsList.concat(data), 'id');
    //put it in modal
    var getData = {
        groupList: data.map(e => {

            if (e.hasOwnProperty('group_image') && e.group_image) {
                // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                e.group_image['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        }),
    };
    fetch.appendHtml(function () {
        var getMembers = [];
        if ($('.communication-group-collaborator-group-member-wrapper').length > 0) {
            $.each($('.communication-group-collaborator-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    type: "new_member"
                });
            });
        }
        if ($('#communication-group-collaborator-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-collaborator-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-group-id'),
                    type: "old_member"
                });
            });
        }
        //remove members from the modal
        //console.log("getMembers", getMembers)
        if (getMembers.length > 0) {
            // $.each(getMembers, function (index, element) {
            //     if (element.type == "new_member") {
            //         $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
            //     } else if (element.type == "old_member") {
            //         $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
            //     }
            // })
        }
        if ($('#modal-communication-group-collaborator-group-selection').find(`.group-selection-wrapper`).length > 0) {
            //console.log("empty modal")
        } else {
            $('.collaborator-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
        }
        callback();
    }, "page/communication/scroll_collaborator_group_selection", "#scroll-collaborator-group-list-selection-template", '#communication-group-create-collaborator-group-list-wrapper .collaborator-group-list-selection-main-container', getData);
}


function validateCommunicationGroupData() {
    let validateGroupName = false;
    let validateGroupDescription = false;
    let validateGroupVisibility = false;
    let validateGroupEmployeeMembers = false;
    let validateGroupCustomerMembers = false;
    let validateGroupModerator = false;
    //validate group name
    if ($('#communicationGroupName').val().trim().length > 0) {
        if ($('#communicationGroupName').val().trim().length < config.EmployeeGroupNameMinLength) {
            showError($('#communicationGroupName'), `This field should contain atleast ${config.EmployeeGroupNameMinLength} characters.`);
            validateGroupName = true;
        }
        if ($('#communicationGroupName').val().trim().length > config.EmployeeGroupNameMaxLength) {
            showError($('#communicationGroupName'), `This field can't have more than  ${config.EmployeeGroupNameMaxLength} characters.`);
            validateGroupName = true;
        }
        if ($('#communicationGroupName').val().trim().length >= config.EmployeeGroupNameMinLength && $('#communicationGroupName').val().trim().length <= config.EmployeeGroupNameMaxLength) {
            validateGroupName = false;
        }
    } else {
        showError($('#communicationGroupName'), `This field is required.`);
        validateGroupName = true;
    }
    //validate group description
    if ($('#communication_group_desc').val().trim().length > 0) {
        if ($('#communication_group_desc').val().trim().length < config.EmployeeGroupDescriptionMinLength) {
            showError($('#communication_group_desc'), `This field should contain atleast ${config.EmployeeGroupDescriptionMinLength} characters.`);
            validateGroupDescription = true;
        }
        if ($('#communication_group_desc').val().trim().length > config.EmployeeGroupDescriptionMaxLength) {
            showError($('#communication_group_desc'), `This field can't have more than  ${config.EmployeeGroupDescriptionMaxLength} characters.`);
            validateGroupDescription = true;
        }
        if ($('#communication_group_desc').val().trim().length >= config.EmployeeGroupDescriptionMinLength && $('#communication_group_desc').val().trim().length <= config.EmployeeGroupDescriptionMaxLength) {
            validateGroupDescription = false;
        }
    } else {
        validateGroupDescription = false;
    }
    //validate visibility    
    // if ($('#select-visibility-type').val() == "") {
    //     showError($('#select-visibility-type'), `This field is required.`);
    //     validateGroupVisibility = true;
    // } else {
    //     validateGroupVisibility = false;
    // }
    if ($('.selected-value-group-visbility').attr('data-value').length > 0) {
        validateGroupVisibility = false;
    } else {
        showError($('#select-visibility-type'), `This field is required.`);
        validateGroupVisibility = true;
    }

    //validate group members(employee+customer)
    if (sessionStorage.getItem('group_id') == '' || sessionStorage.getItem('group_id') == null || sessionStorage.getItem('group_id') == undefined) {
        if (sessionStorage.getItem('group_from') == "contact_list") {
            //for employee member
            if ($(".communication-group-employee-member-checkbox:checked").length > 0) {
                validateGroupEmployeeMembers = false;
            } else {
                Materialize.toast(`Please add atleast 1 Employee`, 3000, "round error-alert");
                validateGroupEmployeeMembers = true;
            }
            //for customer member
            if ($(".communication-group-customer-member-checkbox:checked").length > 0) {
                validateGroupCustomerMembers = false;
            } else {
                Materialize.toast(`Please add atleast 1 Customer`, 3000, "round error-alert");
                validateGroupCustomerMembers = true;
            }
            //validate group moderator
            if ($('.communication-group-moderator-members-list').find('.communication-group-moderator-member-not-saved:checked').length > 0) {
                validateGroupModerator = false;
            } else {
                Materialize.toast(`Please add group moderator.`, 3000, "round error-alert");
                validateGroupModerator = true;
            }
        } else {//group_list(can add collaborator also/ employee group also  - with 1 compulsary customer group)
            //for employee member
            var employeeMembers, collaboratorMembers;
            if ($(".communication-group-employee-group-member-checkbox:checked").length > 0) {
                employeeMembers = true;
            } else {
                employeeMembers = false;
            }
            //for collaborator group
            if ($(".communication-group-collaborator-group-member-checkbox:checked").length > 0) {
                collaboratorMembers = true;
            } else {
                collaboratorMembers = false;
            }
            if (employeeMembers || collaboratorMembers) {
                validateGroupEmployeeMembers = false;
            } else {
                Materialize.toast(`Please add atleast 1 employee/collaborator group`, 3000, "round error-alert");
                validateGroupEmployeeMembers = true;
            }
            //for customer member
            if ($(".communication-group-customer-group-member-checkbox:checked").length > 0) {
                validateGroupCustomerMembers = false;
            } else {
                Materialize.toast(`Please add atleast 1 Customer Group`, 3000, "round error-alert");
                validateGroupCustomerMembers = true;
            }
        }
    }
    if (validateGroupEmployeeMembers || validateGroupCustomerMembers || validateGroupDescription || validateGroupName || validateGroupVisibility || validateGroupModerator) {
        return false;
    } else {
        return true;
    }
}


function processCommunicationGroupActivate(data, groupData, callback) {
    console.log('data', data);
    digibiz.communicationGroupActivate = removeDuplicates(digibiz.communicationGroupActivate.concat(data), 'id');
    // if (digibiz.selectedMembers.length > 0) {
    //     $.each(digibiz.selectedMembers, function (index, member) {
    //         var indx = digibiz.communicationGroupActivate.findIndex(e => e.member.id == member.id);
    //         if (indx != -1) {
    //             if (member.more_info) {
    //                 digibiz.communicationGroupActivate[indx].more_info = member.more_info;
    //             }
    //             if (member.associate_customter_info) {
    //                 digibiz.communicationGroupActivate[indx].associate_customter_info = member.associate_customter_info;
    //             }
    //             if (member.role_business_name) {
    //                 digibiz.communicationGroupActivate[indx].role_business_name = member.role_business_name;
    //             }
    //             if (member.label) {
    //                 digibiz.communicationGroupActivate[indx].label = member.label;
    //             }
    //         }

    //     })
    // }

    // if (digibiz.alreadySelected.length > 0) {
    //     $.each(digibiz.alreadySelected, function (index, moderator) {
    //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
    //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
    //         } else {
    //             // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
    //             var getIndex = digibiz.communicationGroupActivate.findIndex((e) => e.member.id == moderator.id);
    //             if (getIndex > -1) {
    //                 digibiz.communicationGroupActivate[getIndex]['selected'] = true;
    //             }
    //         }
    //     })
    // }
    console.log('groupData', groupData);
    if (groupData.moderator && groupData.moderator.length > 0) {
        $.each(groupData.moderator, function (index, moderator) {
            if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
            } else {
                // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                var getIndex = digibiz.communicationGroupActivate.findIndex((e) => e.member.id == moderator.id);
                if (getIndex > -1) {
                    digibiz.communicationGroupActivate[getIndex]['selected'] = true;
                }
            }
        })
    }
    //put it in modal
    if (groupData.group_type == "contact_list") {
        var getData = {
            page_for: "contact_list_moderator",
            membersList: digibiz.communicationGroupActivate.map(e => {
                var indx = digibiz.selectedMembers.findIndex(el => el.id == e.member.id);
                if (indx != -1) {
                    if (digibiz.selectedMembers[indx].more_info) {
                        e.more_info = digibiz.selectedMembers[indx].more_info;
                    }
                    if (digibiz.selectedMembers[indx].main_identifier) {
                        e.main_identifier = digibiz.selectedMembers[indx].more_info;
                    }
                    if (digibiz.selectedMembers[indx].associate_customter_info) {
                        e.associate_customter_info = digibiz.selectedMembers[indx].associate_customter_info;
                    }
                    if (digibiz.selectedMembers[indx].role_business_name) {
                        // if(digibiz.selectedMembers[indx].role_business_id != sessionStorage.getItem('business_id')) {
                        e.role_business_name = digibiz.selectedMembers[indx].role_business_name;
                        // }
                    }
                    if (digibiz.selectedMembers[indx].label) {
                        e.label = digibiz.selectedMembers[indx].label;
                    }
                }
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        if (e.member.type == "employee") {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else if (e.member.type == "customer" && e.member.customer_type == "customer") {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else if (e.member.type == "customer" && e.member.customer_type == "associate_customer") {
                            var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                return e;
            }),
            page_for: "contact_list_moderator"
        };
    } else if (groupData.group_type == "group_list") {
        var getData = {
            membersList: digibiz.communicationGroupActivate.map(e => {
                if (e.hasOwnProperty('group_members') && e.group_members) {
                    $.each(e.group_members, function (index, member) {
                        // //console.log("member", member);
                        if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                            if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                member.identity_picture['avtarUrl'] = avtarUrl;
                                member['imageLetter'] = member.name.first.charAt(0);
                            } else {
                                member['imageLetter'] = member.name.first.charAt(0);
                            }
                        } else {
                            member['imageLetter'] = member.name.first.charAt(0);
                        }
                    })
                }
                return e;
            }),
            page_for: "standard_group"
        };
    }
    // var getData = digibiz.selectedMembers;
    console.log("getData", getData);
    fetch.replaceHtml(function () {
        //check already present moderator in the modal
        // if (digibiz.alreadySelected.length > 0) {
        //     $.each(digibiz.alreadySelected, function (index, moderator) {
        //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
        //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
        //         } else {
        //             // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
        //         }
        //     })
        // }
        if (groupData.moderator && groupData.moderator.length > 0) {
            $.each(groupData.moderator, function (index, moderator) {
                if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                    $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                } else {
                    // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                }
            })
        }
        callback();
    }, "page/communication/moderator_selection_list", "#moderator-selection-list-template", '#communication-group-members-wrapper', getData);
}


function listenForCommunicationGroupActivateScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id')
            }
            if (sessionStorage.getItem('group_id')) {
                requestParams.id = sessionStorage.getItem('group_id');
            } else {
                requestParams.id = sessionStorage.getItem('activate_group_id');
            }
            groupGet(requestParams)
                .then((groupResponse) => {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        group_id: sessionStorage.getItem('group_id'),
                        count: 5,
                        offset: digibiz.communicationGroupActivate.length
                    }
                    if (sessionStorage.getItem('group_id')) {
                        reqParam.group_id = sessionStorage.getItem('group_id');
                    } else {
                        reqParam.group_id = sessionStorage.getItem('activate_group_id');
                    }
                    getCompleteGroupMembers(reqParam)
                        .then((response) => {
                            removeLoader();
                            if (response && response.length > 0) {
                                scrollProcessCommunicationGroupActivate(response, groupResponse, function () {
                                    listenForCommunicationGroupActivateScrollEvent($(".modal-popup-content"));
                                    removeLoader();
                                });
                            } else {
                                var getData = {
                                    page_for: "contact_list_moderator",
                                }
                                fetch.appendHtml(function () {
                                    removeLoader();
                                    console.log('err', err);
                                }, "page/communication/scroll_moderator_selection_list", "#scroll-moderator-selection-list-template", '#communication-group-members-wrapper .employee-selection-member-list', getData);
                            }
                        })
                        .catch((err) => {
                            var getData = {
                                page_for: "contact_list_moderator",
                            }
                            fetch.appendHtml(function () {
                                removeLoader();
                                console.log('err', err);
                            }, "page/communication/scroll_moderator_selection_list", "#scroll-moderator-selection-list-template", '#communication-group-members-wrapper .employee-selection-member-list', getData);
                        })
                }).catch((err) => {
                    console.log('err', err);
                    var getData = {
                        page_for: "contact_list_moderator",
                    }
                    fetch.appendHtml(function () {
                        removeLoader();
                        console.log('err', err);
                    }, "page/communication/scroll_moderator_selection_list", "#scroll-moderator-selection-list-template", '#communication-group-members-wrapper .employee-selection-member-list', getData);
                })

        }
    });
}

function scrollProcessCommunicationGroupActivate(data, groupData, callback) {
    console.log('data', data);
    digibiz.communicationGroupActivate = removeDuplicates(digibiz.communicationGroupActivate.concat(data), 'id');

    if (groupData.moderator && groupData.moderator.length > 0) {
        $.each(groupData.moderator, function (index, moderator) {
            if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
            } else {
                // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                var getIndex = digibiz.communicationGroupActivate.findIndex((e) => e.member.id == moderator.id);
                if (getIndex > -1) {
                    digibiz.communicationGroupActivate[getIndex]['selected'] = true;
                }
            }
        })
    }
    //put it in modal
    if (groupData.group_type == "contact_list") {
        var getData = {
            page_for: "contact_list_moderator",
            membersList: data.map(e => {
                var indx = digibiz.selectedMembers.findIndex(el => el.id == e.member.id);
                if (indx != -1) {
                    if (digibiz.selectedMembers[indx].more_info) {
                        e.more_info = digibiz.selectedMembers[indx].more_info;
                    }
                    if (digibiz.selectedMembers[indx].main_identifier) {
                        e.main_identifier = digibiz.selectedMembers[indx].more_info;
                    }
                    if (digibiz.selectedMembers[indx].associate_customter_info) {
                        e.associate_customter_info = digibiz.selectedMembers[indx].associate_customter_info;
                    }
                    if (digibiz.selectedMembers[indx].role_business_name) {
                        // if(digibiz.selectedMembers[indx].role_business_id != sessionStorage.getItem('business_id')) {
                        e.role_business_name = digibiz.selectedMembers[indx].role_business_name;
                        // }
                    }
                    if (digibiz.selectedMembers[indx].label) {
                        e.label = digibiz.selectedMembers[indx].label;
                    }
                }
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        if (e.member.type == "employee") {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else if (e.member.type == "customer" && e.member.customer_type == "customer") {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else if (e.member.type == "customer" && e.member.customer_type == "associate_customer") {
                            var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                return e;
            }),
            page_for: "contact_list_moderator"
        };
    } else if (groupData.group_type == "group_list") {
        var getData = {
            membersList: data.map(e => {
                if (e.hasOwnProperty('group_members') && e.group_members) {
                    $.each(e.group_members, function (index, member) {
                        // //console.log("member", member);
                        if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                            if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                member.identity_picture['avtarUrl'] = avtarUrl;
                                member['imageLetter'] = member.name.first.charAt(0);
                            } else {
                                member['imageLetter'] = member.name.first.charAt(0);
                            }
                        } else {
                            member['imageLetter'] = member.name.first.charAt(0);
                        }
                    })
                }
                return e;
            }),
            page_for: "standard_group"
        };
    }
    // var getData = digibiz.selectedMembers;
    console.log("getData", getData);
    fetch.appendHtml(function () {
        //check already present moderator in the modal
        // if (digibiz.alreadySelected.length > 0) {
        //     $.each(digibiz.alreadySelected, function (index, moderator) {
        //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
        //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
        //         } else {
        //             // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
        //         }
        //     })
        // }
        if (groupData.moderator && groupData.moderator.length > 0) {
            $.each(groupData.moderator, function (index, moderator) {
                if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                    $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                } else {
                    // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                }
            })
        }
        callback();
    }, "page/communication/scroll_moderator_selection_list", "#scroll-moderator-selection-list-template", '#communication-group-members-wrapper .employee-selection-member-list', getData);
}

function processSearchCommunicationGroupActivate(data, groupData, callback) {
    console.log('data', data);
    // digibiz.communicationGroupActivate = removeDuplicates(digibiz.communicationGroupActivate.concat(data), 'id');

    // if (groupData.moderator && groupData.moderator.length > 0) {
    //     $.each(groupData.moderator, function (index, moderator) {
    //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
    //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
    //         } else {
    //             // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
    //             var getIndex = digibiz.communicationGroupActivate.findIndex((e) => e.member.id == moderator.id);
    //             if (getIndex > -1) {
    //                 digibiz.communicationGroupActivate[getIndex]['selected'] = true;
    //             }
    //         }
    //     })
    // }
    //put it in modal
    if (groupData.group_type == "contact_list") {
        var getData = {
            page_for: "contact_list_moderator",
            membersList: data.map(e => {
                var indx = digibiz.selectedMembers.findIndex(el => el.id == e.member.id);
                if (indx != -1) {
                    if (digibiz.selectedMembers[indx].more_info) {
                        e.more_info = digibiz.selectedMembers[indx].more_info;
                    }
                    if (digibiz.selectedMembers[indx].main_identifier) {
                        e.main_identifier = digibiz.selectedMembers[indx].more_info;
                    }
                    if (digibiz.selectedMembers[indx].associate_customter_info) {
                        e.associate_customter_info = digibiz.selectedMembers[indx].associate_customter_info;
                    }
                    if (digibiz.selectedMembers[indx].role_business_name) {
                        // if(digibiz.selectedMembers[indx].role_business_id != sessionStorage.getItem('business_id')) {
                        e.role_business_name = digibiz.selectedMembers[indx].role_business_name;
                        // }
                    }
                    if (digibiz.selectedMembers[indx].label) {
                        e.label = digibiz.selectedMembers[indx].label;
                    }
                }
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        if (e.member.type == "employee") {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else if (e.member.type == "customer" && e.member.customer_type == "customer") {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else if (e.member.type == "customer" && e.member.customer_type == "associate_customer") {
                            var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                return e;
            }),
            page_for: "contact_list_moderator"
        };
    } else if (groupData.group_type == "group_list") {
        var getData = {
            membersList: data.map(e => {
                if (e.hasOwnProperty('group_members') && e.group_members) {
                    $.each(e.group_members, function (index, member) {
                        // //console.log("member", member);
                        if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                            if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                member.identity_picture['avtarUrl'] = avtarUrl;
                                member['imageLetter'] = member.name.first.charAt(0);
                            } else {
                                member['imageLetter'] = member.name.first.charAt(0);
                            }
                        } else {
                            member['imageLetter'] = member.name.first.charAt(0);
                        }
                    })
                }
                return e;
            }),
            page_for: "standard_group"
        };
    }
    // var getData = digibiz.selectedMembers;
    console.log("getData", getData);
    fetch.appendHtml(function () {
        //check already present moderator in the modal
        // if (digibiz.alreadySelected.length > 0) {
        //     $.each(digibiz.alreadySelected, function (index, moderator) {
        //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
        //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
        //         } else {
        //             // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
        //         }
        //     })
        // }
        if (groupData.moderator && groupData.moderator.length > 0) {
            $.each(groupData.moderator, function (index, moderator) {
                if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                    $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                } else {
                    // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
                }
            })
        }
        callback();
    }, "page/communication/scroll_moderator_selection_list", "#scroll-moderator-selection-list-template", '#communication-group-members-wrapper .employee-selection-member-list', getData);
}
/****COMMUNICATION GROUPS METHODS(ends)*************/

//********************CUSTOMER BUTTON LANDING PAGE(starts)**************************//
function customerBusinessListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "customer"
        }
        businessList(reqParam)
            .then((response) => {
                //console.log("businessList response", response);
                fetch.replaceHtml(function () {
                    processCustomerBusinessList(response, function () {
                        appScroll.scrollBar('.employee-business-list-main-container');
                        listenForCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                        removeLoader();
                        resolve();
                    });
                }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            appScroll.scrollBar('.employee-business-list-main-container');
                            listenForCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", null);
                }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function customersBusinessListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        if (digibiz.checkAccountFlag == false) {
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "customer_module",
                count: 20,
                offset: 0
            }
            businessList(reqParam)
                .then((response) => {
                    // var reqParam = {
                    //     device_id: crossplat.device.uuid,
                    //     list_by: "associate_customer_module",
                    //     count: 10,
                    //     offset: 0
                    // }
                    // businessList(reqParam)
                    //     .then((assocaiteResponse) => {
                    //         digibiz.customer_business_list =assocaiteResponse;
                    //console.log("businessList response", response);
                    fetch.replaceHtml(function () {
                        processCustomerBusinessList(response, function () {
                            appScroll.scrollBar('.employee-business-list-main-container');
                            listenForCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                            removeLoader();
                            resolve();
                        });
                    }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                    // }).catch((err) => {
                    //     removeLoader();
                    //     console.log('err',err);
                    // })
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", null);
                    }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
        } else {
            fetch.replaceHtml(function () {
                processCustomerBusinessList(digibiz.customer_business_list, function () {
                    appScroll.scrollBar('.employee-business-list-main-container');
                    listenForCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                    removeLoader();
                    resolve();
                });
            }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);

        }

    });
}


function listenForCustomerBusinessListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var customer_business = digibiz.customer_business_list.filter(e => e.type == "customer");
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "customer_module",
                count: 5,
                offset: customer_business.length
            }
            businessList(reqParam)
                .then((response) => {
                    scrollProcessCustomerBusinessList(response, function () {
                        listenForCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                        removeLoader();
                    });
                })
                .catch((err) => {

                })

        }
    });
}

function scrollProcessCustomerBusinessList(data, callback) {
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    digibiz.customer_business_list = removeDuplicatesFromMultipleProperties(digibiz.customer_business_list.concat(data), 'customer_id', 'type');
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    // digibiz.customer_business_list = digibiz.customer_business_list.concat(data);
    var businessList = {
        customer_business_list_data: data.map(e => {
            joinRoom(e.id);
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //     if (digibiz.customer_business_list.length > 0) {
    //         console.log("business is there")
    //     } else {
    //         location.hash = `jeevi/app/hub`;
    // console.log('5555555');
    //     }
    fetch.appendHtml(function (err) {
        if (!err) {

            callback();
        }
    }, "page/business/scroll_customer_business_list_data", "#scroll-customer-business-data-list-template", "#customer-business-list-wrapper .employee-business-list-contentbox", businessList);
}

function customerBusinessListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "customer"
    }
    businessList(reqParam)
        .then((response) => {
            digibiz.customer_business_list = response;
            if (digibiz.customer_business_list.length > 0) {
                $('#customer-role-btn').removeClass('hide');
            }
        })
        .catch((err) => {
            //console.log("err in customerBusinessListHelperMethod", err);
        })
}

function customerModuleListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "customer_module",
        count: 20,
        offset: 0
    }
    businessList(reqParam)
        .then((response) => {
            digibiz.customer_business_list = response;
            if (digibiz.customer_business_list.length > 0) {
                $('#customer-role-btn').removeClass('hide');
            }
        })
        .catch((err) => {
            //console.log("err in customerBusinessListHelperMethod", err);
        })
}


function associateCustomerModuleListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "associate_customer_module",
        count: 20,
        offset: 0
    }
    businessList(reqParam)
        .then((response) => {
            digibiz.customer_business_list = response;
            if (digibiz.customer_business_list.length > 0) {
                $('#customer-role-btn').removeClass('hide');
            }
        })
        .catch((err) => {
            //console.log("err in customerBusinessListHelperMethod", err);
        })
}


function processCustomerBusinessList(data, callback) {
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    digibiz.customer_business_list = removeDuplicatesFromMultipleProperties(digibiz.customer_business_list.concat(data), 'customer_id', 'type');
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    // digibiz.customer_business_list = digibiz.customer_business_list.concat(data);
    customer_business_list = digibiz.customer_business_list.filter(e => e.type == "customer");
    var businessList = {
        customer_business_list_data: customer_business_list.map(e => {
            joinRoom(e.id);
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //     if (customer_business_list.length > 0) {
    //         console.log("business is there")
    //     } else {
    //         location.hash = `jeevi/app/hub`;
    // console.log('5555555');
    //     }
    fetch.replaceHtml(function (err) {
        if (!err) {

            callback();
        }
    }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", businessList);
}

//********************CUSTOMER BUTTON LANDING PAGE(ends)**************************//


function savebusinessDisplayPicture(base64Image, callback) {
    // console.log("savebusinessDisplayPicture", base64Image);
    generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
        // console.log("thubnailContent", thubnailContent);
        var requestParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            data: {
                display_picture: base64Image,
                display_picture_thumbnail: thubnailContent
            }
        };
        console.log("requestParams", requestParams);
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                // callback(null, response.Data.display_picture.thumbnail)
                callback(null, response.Data.display_picture)
            } else {
                callback("failed")
            }
        }, api.set_business_display_picture, "POST", "JSON", requestParams);
    })
}

function savebusinessCredentialPicture(base64Image, picture_type, callback) {
    console.log("savebusinessCredentialPicture", base64Image);
    generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
        console.log("thubnailContent", thubnailContent);
        var requestParams = {
            device_id: crossplat.device.uuid,
            account_id: sessionStorage.getItem('account_id'),
            type: picture_type,
            picture_original_details: base64Image,
            picture_thumbnail_details: thubnailContent
        };
        console.log("requestParams", requestParams);
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                callback(null, response.data)
            } else {
                callback(JSON.parse(response.responseText));
            }
        }, api.add_transaction_signature_picture, "POST", "JSON", requestParams);
    })
}

function savebusinessDisplayVideoThumbnail(thumbnail, callback) {
    // //console.log("saveEmployeeIdentityPicture", base64Image);
    //console.log("thubnailContent", thumbnail);
    requestParams = {
        device_id: crossplat.device.uuid,
        business_id: sessionStorage.getItem('business_id'),
        data: {
            display_video_thumbnail: thumbnail
        }
    };

    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data)
        } else {
            callback("failed")
        }
    }, api.set_business_display_video_thumbnail, "POST", "JSON", requestParams);
}

function savebusinessDisplayVideo(videoContent, thumbnail, callback) {
    // //console.log("saveEmployeeIdentityPicture", base64Image);
    //console.log("thubnailContent", thumbnail);
    requestParams = {
        device_id: crossplat.device.uuid,
        business_id: sessionStorage.getItem('business_id'),
        data: {
            display_video: videoContent,
            display_video_thumbnail: thumbnail
        }
    };

    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data.display_video)
        } else {
            callback("failed")
        }
    }, api.set_business_display_video, "POST", "JSON", requestParams);
}



function saveEmployeeIdentityPicture(base64Image, blob, callback) {
    //console.log("saveEmployeeIdentityPicture", base64Image);
    generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
        //console.log("thubnailContent", thubnailContent);
        var requestParams = {
            device_id: crossplat.device.uuid,
            employee_id: sessionStorage.getItem('employee_id'),
            data: {
                thumbnail_content: thubnailContent,
                size: blob.size
            }
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                callback(null, response.Data.identity_picture.thumbnail)
            } else {
                callback("failed")
            }
        }, api.store_employee_identity_picture, "POST", "JSON", requestParams);
    })
}

function saveEmployeeIdentityVideoThumbnail(thumbnail, callback) {
    var requestParams = {
        device_id: crossplat.device.uuid,
        employee_id: sessionStorage.getItem('employee_id'),
        data: {
            thumbnail_content: thumbnail,
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data)
        } else {
            callback("failed")
        }
    }, api.store_employee_identity_video_thumbnail, "POST", "JSON", requestParams);
}

function saveEmployeeIdentityVideo(videoContent, thumbnail, callback) {
    var requestParams = {
        device_id: crossplat.device.uuid,
        employee_id: sessionStorage.getItem('employee_id'),
        data: {
            video_content: videoContent,
            thumbnail_content: thumbnail
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data.identity_video)
        } else {
            callback("failed")
        }
    }, api.store_employee_identity_video, "POST", "JSON", requestParams);
}




// function saveEmployeeIdentityPicture(base64Image, blob, callback) {
//     // if (digibiz.isGroupPictureSelected) {
//     addLoader();
//     var EmployeeName = sessionStorage.getItem('employee_name');
//     var senderID = sessionStorage.getItem('account_id');
//     var user_type = "individual";
//     var individual_id = sessionStorage.getItem('account_id')
//     var userid = sessionStorage.getItem('account_id');
//     var blob = blob;
//     var employeeIdentityContent = $("#employee_identity_picture").attr("src");
//     var API_URL = api.file_write;
//     //console.log("employeeIdentityContent", employeeIdentityContent);
//     generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
//         //console.log("thubnailContent", thubnailContent);
//         //store the content
//         // //console.log(thubnailContent);
//         // var formData = new FormData();
//         // formData.append("file", blob);
//         // formData.append("userid", userid);
//         // formData.append("usertype", user_type);
//         // formData.append("options", JSON.stringify(
//         //     {
//         //         "encryption": "true",
//         //         "level": "1",
//         //         "filemanager": {
//         //             "device_id": crossplat.device.uuid,
//         //             "owner": {
//         //                 "type": user_type,
//         //                 "id": individual_id
//         //             },
//         //             "app": "Digibiz",
//         //             "purpose_name": "Display Pictures",
//         //             "type": "file",
//         //             "access_type": "system",
//         //             "file": {
//         //                 "permission": "read",
//         //                 "keywords": "Digibiz multimedia upload"
//         //             }
//         //         }
//         //     }));
//         // formData.append("totalSize", blob.size);
//         // formData.append("type", blob.type);
//         // formData.append("fileName", `${EmployeeName}-${sessionStorage.getItem('employee_id')}-${moment().format('D MMMM hh:mm:ss')}`);
//         // //console.log("formData", formData);
//         // var xhr = new XMLHttpRequest();
//         // xhr.addEventListener('load', function (event) {
//         //     if (event.target.status == 200) {
//         //         var response = JSON.parse(event.target.responseText);
//         //         callback(null, response);
//         //     } else if (event.target.status >= 400) {
//         //         //console.log(event.target.responseText);
//         //     }
//         // }, false);
//         // xhr.open("POST", API_URL, true);
//         // xhr.send(formData);
//     });
//     // } else {
//     //     callback();
//     // }
// }

// function saveCustomerIdentityPicture(base64Image, callback) {
//     requestParams = {
//         device_id: crossplat.device.uuid,
//         customer_id: sessionStorage.getItem('customer_id'),
//         data: {
//             identity_picture: base64Image
//         }
//     };
//     fetch.apiCall(function (response, status, xhr) {
//         if (status === "success") {
//             callback(null, response.Data.identity_picture.thumbnail)
//         } else {
//             callback("failed")
//         }
//     }, api.set_customer_identity_picture, "POST", "JSON", requestParams);
// }

function saveCustomerIdentityPicture(base64Image, blob, callback) {
    //console.log("saveCustomerIdentityPicture", base64Image);
    generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
        //console.log("thubnailContent", thubnailContent);
        var requestParams = {
            device_id: crossplat.device.uuid,
            customer_id: sessionStorage.getItem('customer_id'),
            data: {
                thumbnail_content: thubnailContent,
                size: blob.size
            }
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                callback(null, response.Data.identity_picture.thumbnail)
            } else {
                callback("failed")
            }
        }, api.store_customer_identity_picture, "POST", "JSON", requestParams);
    })
}

function saveCustomerIdentityVideoThumbnail(thumbnail, callback) {
    var requestParams = {
        device_id: crossplat.device.uuid,
        customer_id: sessionStorage.getItem('customer_id'),
        data: {
            thumbnail_content: thumbnail,
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data)
        } else {
            callback("failed")
        }
    }, api.store_customer_identity_video_thumbnail, "POST", "JSON", requestParams);
}

function saveCustomerIdentityVideo(videoContent, thumbnail, callback) {
    var requestParams = {
        device_id: crossplat.device.uuid,
        customer_id: sessionStorage.getItem('customer_id'),
        data: {
            video_content: videoContent,
            thumbnail_content: thumbnail
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data.identity_video)
        } else {
            callback("failed")
        }
    }, api.store_customer_identity_video, "POST", "JSON", requestParams);
}



// function saveCustomerIdentityPicture(base64Image, blob, callback) {
//     addLoader();
//     var customerName = sessionStorage.getItem('customer_name');
//     var senderID = sessionStorage.getItem('account_id');
//     var user_type = "individual";
//     var individual_id = sessionStorage.getItem('account_id')
//     var userid = sessionStorage.getItem('account_id');
//     var blob = blob;
//     var customerIdentityContent = $("#customer_identity_picture").attr("src");
//     var API_URL = api.file_write;
//     //console.log("customerIdentityContent", customerIdentityContent);
//     generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
//         //console.log("thubnailContent", thubnailContent);
//         //store the content
//         // //console.log(thubnailContent);
//         var formData = new FormData();
//         formData.append("file", blob);
//         formData.append("userid", userid);
//         formData.append("usertype", user_type);
//         formData.append("options", JSON.stringify({ "encryption": "true", "level": "1", "filemanager": { "device_id": crossplat.device.uuid, "owner": { "type": user_type, "id": individual_id }, "app": "Digibiz", "purpose_name": "Display Pictures", "type": "file", "access_type": "system", "file": { "permission": "read", "keywords": "Digibiz multimedia upload" } } }));
//         formData.append("totalSize", blob.size);
//         formData.append("type", blob.type);
//         formData.append("fileName", `${customerName}-${sessionStorage.getItem('customer_id')}-${moment().format('D MMMM hh:mm:ss')}`);
//         //console.log("formData", formData);
//         var xhr = new XMLHttpRequest();
//         xhr.addEventListener('load', function (event) {
//             if (event.target.status == 200) {
//                 var response = JSON.parse(event.target.responseText);
//                 callback(null, response);
//             } else if (event.target.status >= 400) {
//                 //console.log(event.target.responseText);
//             }
//         }, false);
//         xhr.open("POST", API_URL, true);
//         xhr.send(formData);
//     });
// }

// function saveAssociateCustomerIdentityPicture(base64Image, callback) {
//     requestParams = {
//         device_id: crossplat.device.uuid,
//         associate_customer_id: $('#edit-associate-customer-modal').attr('data-associate-customer-id'),
//         data: {
//             identity_picture: base64Image
//         }
//     };
//     fetch.apiCall(function (response, status, xhr) {
//         if (status === "success") {
//             callback(null, response.Data.identity_picture.thumbnail)
//         } else {
//             callback("failed")
//         }
//     }, api.set_associate_customer_identity_picture, "POST", "JSON", requestParams);
// }

function saveAssociateCustomerIdentityPicture(base64Image, blob, callback) {
    //console.log("saveAssociateCustomerIdentityPicture", base64Image);
    generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
        //console.log("thubnailContent", thubnailContent);
        var requestParams = {
            device_id: crossplat.device.uuid,
            associate_customer_id: $('#edit-associate-customer-modal').attr('data-associate-customer-id'),
            data: {
                thumbnail_content: thubnailContent,
                size: blob.size
            }
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                callback(null, response.Data.identity_picture.thumbnail)
            } else {
                callback("failed")
            }
        }, api.store_associate_customer_identity_picture, "POST", "JSON", requestParams);
    })
}

function saveAssociateCustomerIdentityVideoThumbnail(thumbnail, callback) {
    var requestParams = {
        device_id: crossplat.device.uuid,
        associate_customer_id: $('#edit-associate-customer-modal').attr('data-associate-customer-id'),
        data: {
            thumbnail_content: thumbnail,
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data)
        } else {
            callback("failed")
        }
    }, api.store_associate_customer_identity_video_thumbnail, "POST", "JSON", requestParams);
}

function saveAssociateCustomerIdentityVideo(videoContent, thumbnail, callback) {
    //console.log("saveAssociateCustomerIdentityVideo", thumbnail);
    var requestParams = {
        device_id: crossplat.device.uuid,
        associate_customer_id: $('#edit-associate-customer-modal').attr('data-associate-customer-id'),
        data: {
            video_content: videoContent,
            thumbnail_content: thumbnail
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            callback(null, response.Data.identity_video)
        } else {
            callback("failed")
        }
    }, api.store_associate_customer_identity_video, "POST", "JSON", requestParams);
}

// function saveAssociateCustomerIdentityPicture(base64Image, blob, callback) {
//     addLoader();
//     var associateCustomerName = $('#edit-associate-customer-modal').attr('data-associate-customer-name');
//     var associateCustomerId = $('#edit-associate-customer-modal').attr('data-associate-customer-id');
//     var senderID = sessionStorage.getItem('account_id');
//     var user_type = "individual";
//     var individual_id = sessionStorage.getItem('account_id')
//     var userid = sessionStorage.getItem('account_id');
//     var blob = blob;
//     var customerIdentityContent = $("#associate_customer_identity_picture").attr("src");
//     var API_URL = api.file_write;
//     //console.log("customerIdentityContent", customerIdentityContent);
//     generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
//         //console.log("thubnailContent", thubnailContent);
//         //store the content
//         // //console.log(thubnailContent);
//         var formData = new FormData();
//         formData.append("file", blob);
//         formData.append("userid", userid);
//         formData.append("usertype", user_type);
//         formData.append("options", JSON.stringify({ "encryption": "true", "level": "1", "filemanager": { "device_id": crossplat.device.uuid, "owner": { "type": user_type, "id": individual_id }, "app": "Digibiz", "purpose_name": "Display Pictures", "type": "file", "access_type": "system", "file": { "permission": "read", "keywords": "Digibiz multimedia upload" } } }));
//         formData.append("totalSize", blob.size);
//         formData.append("type", blob.type);
//         formData.append("fileName", `${associateCustomerName}-${associateCustomerId}-${moment().format('D MMMM hh:mm:ss')}`);
//         //console.log("formData", formData);
//         var xhr = new XMLHttpRequest();
//         xhr.addEventListener('load', function (event) {
//             if (event.target.status == 200) {
//                 var response = JSON.parse(event.target.responseText);
//                 callback(null, response);
//             } else if (event.target.status >= 400) {
//                 //console.log(event.target.responseText);
//             }
//         }, false);
//         xhr.open("POST", API_URL, true);
//         xhr.send(formData);
//     });
// }

function savebusinessMultimedia(base64Image, type, callback) {
    //console.log("savebusinessMultimedia", base64Image)
    if (base64Image.startsWith("data:")) {
        //console.log("starts with data")
        generateThubnail(base64Image, 'base64').then(async function (thubnailContent) {
            //console.log("thubnailContent", thubnailContent);
            var data_object = {};
            if (type == "identity-proof-load-btn") {
                data_object = {
                    id_proofs: thubnailContent
                }
            } else if (type == "pancard-load-btn") {
                data_object = {
                    pan_card_details: thubnailContent
                }
            } else if (type == "shop-established-license-load-btn") {
                data_object = {
                    shop_established_license: thubnailContent
                }
            } else if (type == "gst-license-load-btn") {
                data_object = {
                    shop_established_license: thubnailContent
                }
            } else if (type == "partnership-deed-load-btn") {
                data_object = {
                    partnership_deed: thubnailContent
                }
            } else if (type == "partnership-registration-certificate-load-btn") {
                data_object = {
                    partnership_registration_certificate: thubnailContent
                }
            } else if (type == "llp-registration-certificate-load-btn") {
                data_object = {
                    llp_registration_certificate: thubnailContent
                }
            } else if (type == "transaction-person-load-btn") {
                data_object = {
                    transaction_person: thubnailContent
                }
            } else if (type == "memorandum-of-association-load-btn") {
                data_object = {
                    memorandum_of_association: thubnailContent
                }
            } else if (type == "articles-of-association-load-btn") {
                data_object = {
                    article_of_association: thubnailContent
                }
            } else if (type == "trust-establishment-license-load-btn") {
                data_object = {
                    trust_foundation_established_licence: thubnailContent
                }
            } else if (type == "signature") {
                data_object = {
                    declaration_signature_pictures: thubnailContent
                }
            } else if (type == "transaction") {
                data_object = {
                    declaration_transaction_pictures: thubnailContent
                }
            } else if (type == "declaration_video_thumbnail") {
                data_object = {
                    declaration_video_thumbnail: thubnailContent
                }
            } else if (type == "declaration_video") {
                data_object = {
                    declaration_video: thubnailContent
                }
            }
            requestParams = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id')
            };
            requestParams.data = data_object;
            //console.log("savebusinessMultimedia requestParams", requestParams);
            fetch.apiCall(function (response, status, xhr) {
                if (status === "success") {
                    //console.log("savebusinessMultimedia response", response)
                    callback(null, response)
                } else {
                    callback("failed")
                }
            }, api.set_business_multimedia, "POST", "JSON", requestParams);
        })
    } else {
        //console.log("doesn't start with data")
        getBlobFromURL(base64Image).then((blob) => {
            //console.log("blob", blob);
            //create object urls
            // digibiz.objectURLS[asset_ids[0]] = URL.createObjectURL(blob);
            var objectData = [];
            objectData = URL.createObjectURL(blob);
            //console.log("objectData,", objectData)

            var reader = new FileReader;
            reader.onloadend = function () {
                //console.log("reader", reader)
                // generateThubnail(this.result, 'base64').then((thubnail) => {
                // }
                generateThubnail(this.result, 'base64').then(async function (thubnailContent) {
                    //console.log("thubnailContent", thubnailContent);
                    var data_object = {};
                    if (type == "identity-proof-load-btn") {
                        data_object = {
                            id_proofs: thubnailContent
                        }
                    } else if (type == "pancard-load-btn") {
                        data_object = {
                            pan_card_details: thubnailContent
                        }
                    } else if (type == "shop-established-license-load-btn") {
                        data_object = {
                            shop_established_license: thubnailContent
                        }
                    } else if (type == "gst-license-load-btn") {
                        data_object = {
                            shop_established_license: thubnailContent
                        }
                    } else if (type == "partnership-deed-load-btn") {
                        data_object = {
                            partnership_deed: thubnailContent
                        }
                    } else if (type == "partnership-registration-certificate-load-btn") {
                        data_object = {
                            partnership_registration_certificate: thubnailContent
                        }
                    } else if (type == "llp-registration-certificate-load-btn") {
                        data_object = {
                            llp_registration_certificate: thubnailContent
                        }
                    } else if (type == "transaction-person-load-btn") {
                        data_object = {
                            transaction_person: thubnailContent
                        }
                    } else if (type == "memorandum-of-association-load-btn") {
                        data_object = {
                            memorandum_of_association: thubnailContent
                        }
                    } else if (type == "articles-of-association-load-btn") {
                        data_object = {
                            article_of_association: thubnailContent
                        }
                    } else if (type == "trust-establishment-license-load-btn") {
                        data_object = {
                            trust_foundation_established_licence: thubnailContent
                        }
                    } else if (type == "signature") {
                        data_object = {
                            declaration_signature_pictures: thubnailContent
                        }
                    } else if (type == "transaction") {
                        data_object = {
                            declaration_transaction_pictures: thubnailContent
                        }
                    } else if (type == "declaration_video_thumbnail") {
                        data_object = {
                            declaration_video_thumbnail: thubnailContent
                        }
                    } else if (type == "declaration_video") {
                        data_object = {
                            declaration_video: thubnailContent
                        }
                    }
                    requestParams = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id')
                    };
                    requestParams.data = data_object;
                    //console.log("savebusinessMultimedia requestParams", requestParams);
                    fetch.apiCall(function (response, status, xhr) {
                        if (status === "success") {
                            //console.log("savebusinessMultimedia response", response)
                            callback(null, response)
                        } else {
                            callback("failed")
                        }
                    }, api.set_business_multimedia, "POST", "JSON", requestParams);
                })
            }
            reader.readAsDataURL(blob);
        })
    }
}

function saveVideoDeclartionVideo(videoContent, callback) {
    var requestParams = {
        device_id: crossplat.device.uuid,
        business_id: sessionStorage.getItem('business_id'),
        data: {
            declaration_video: videoContent
        }
    };
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            //console.log("savebusinessMultimedia response", response)
            callback(null, response)
        } else {
            callback("failed")
        }
    }, api.set_business_multimedia, "POST", "JSON", requestParams);
}



function validateEmployeeData(element) {
    //console.log("validate", $(element), $(element).text().trim().length)
    let validateData = false;
    if ($(element).text().trim().length > 0) {
        if ($(element).text().trim().length < config.EmployeeDataMinLength) {
            showError($(element), `This field should contain atleast ${config.EmployeeDataMinLength} characters.`);
            //console.log("1")
            validateData = true;
        }
        if ($(element).text().trim().length > config.EmployeeDataMaxLength) {
            showError($(element), `This field can't have more than  ${config.EmployeeDataMaxLength} characters.`);
            //console.log("2")
            validateData = true;
        }
        if ($(element).text().trim().length >= config.EmployeeDataMinLength && $(element).text().trim().length <= config.EmployeeDataMaxLength) {
            //console.log("3")
            validateData = false;
        }
    } else {
        showError($(element), `This field is required.`);
        //console.log("4")
        validateData = true;
    }
    //console.log("validateData", validateData);
    if (validateData) {
        return false;
    } else {
        return true;
    }
}


function customerAccessIdentifiersPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "customer",
            count: 15,
            offset: 0
        }
        customerIdentifierList(reqParam)
            .then((response) => {
                //console.log("customerIdentifierList response", response);
                fetch.replaceHtml(function () {
                    processCustomerAccessIdentifiersList(response, function () {
                        appScroll.scrollBar('.customer-access-identifier-list-wrapper');
                        listenForCustomerAccessIdentifiersListScrollEvent($('.customer-access-identifier-list-wrapper'));
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/customer_access_identifier_list_wrapper", "#customer-access-identifier-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/customer_access_identifier_list_data", "#customer-access-identifier-list-data-template", "#customer-access-identifier-list-wrapper", null);
                }, "page/customer/customer_access_identifier_list_wrapper", "#customer-access-identifier-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processCustomerAccessIdentifiersList(data, callback) {
    digibiz.customer_access_identifiers_list = removeDuplicates(digibiz.customer_access_identifiers_list.concat(data), "id");
    var getData = {
        customer_access_identifiers_list_data: digibiz.customer_access_identifiers_list,
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/customer/customer_access_identifier_list_data", "#customer-access-identifier-list-data-template", "#customer-access-identifier-list-wrapper", getData);
}

function listenForCustomerAccessIdentifiersListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "customer",
                count: 20,
                offset: digibiz.customer_access_identifiers_list.length
            }
            customerIdentifierList(reqParam)
                .then((response) => {
                    scrollProcessCustomerAccessIdentifiersList(response, function () {
                        listenForCustomerAccessIdentifiersListScrollEvent($('.customer-access-identifier-list-wrapper'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCustomerAccessIdentifiersList(data, callback) {
    digibiz.customer_access_identifiers_list = removeDuplicates(digibiz.customer_access_identifiers_list.concat(data), "id");
    var getData = {
        customer_access_identifiers_list_data: data,
    };
    //console.log("getData", getData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_customer_access_identifier_list_data", "#scroll-customer-access-identifier-list-data-template", "#customer-access-identifier-list-wrapper .os-content", getData);
}

function customerAccessIdentifiersItemsPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            type: "customer",
            list_by: "primary_customer_identifier",
            primary_customer_identifier_id: sessionStorage.getItem('identifier_id')
        }
        listContactsList(reqParams)
            .then((response) => {
                //console.log("listContactsList response", response);
                fetch.replaceHtml(function () {
                    processCustomerAccessIdentifierItemsList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/customer_access_identifier_items_wrapper", "#customer-access-identifier-items-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/customer_access_identifier_items_data", "#customer-access-identifier-items-list-data-template", "#customer-access-identifier-items-list-wrapper", null);
                }, "page/customer/customer_access_identifier_items_wrapper", "#customer-access-identifier-items-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processCustomerAccessIdentifierItemsList(data, callback) {
    digibiz.customer_access_identifier_items_list = removeDuplicates(digibiz.customer_access_identifier_items_list.concat(data), "id");
    var getData = {
        customer_access_identifier_items_list_data: digibiz.customer_access_identifier_items_list,
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_access_identifier_items_data", "#customer-access-identifier-items-list-data-template", "#customer-access-identifier-items-list-wrapper", getData);
}

function customerAccessIdentifiersItemAccessPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            resolve();
        }, "page/customer/customer_access_identifier_item_access_page", "#customer-access-identifier-item-access-page-template", "#main-content-wrapper", null);
    });
}


//****************ACCESS API CALLS*********************//
function contactAccessAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_contact_access, "POST", "JSON", requestParms);
    });
}

function contactAccessList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.list_contact_access, "POST", "JSON", requestParms);
    });
}

function identifierItemsEmployeesAccessList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.list_identifier_items_employees, "POST", "JSON", requestParms);
    });
}

function activeCustomGroupEmployeeList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.active_custom_group_employee, "POST", "JSON", requestParms);
    });
}

function showAccessEmployeeList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.show_access_list_employee, "POST", "JSON", requestParms);
    });
}

function showAccessCustomerList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.show_access_list_customer, "POST", "JSON", requestParms);
    });
}

function accessList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.access_list, "POST", "JSON", requestParms);
    });
}

function revokeAccess(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.revoke_access, "POST", "JSON", requestParms);
    });
}

function deleteRecords(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_records, "POST", "JSON", requestParms);
    });
}


function groupAccessAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_group_access, "POST", "JSON", requestParms);
    });
}

function groupAccessList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.group_access_list, "POST", "JSON", requestParms);
    });
}

function groupRevokeAccess(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.group_revoke_access, "POST", "JSON", requestParms);
    });
}

function groupDeleteRecords(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.group_delete_records, "POST", "JSON", requestParms);
    });
}

//Storage

function activateStorage(storageName, callback) {
    // var requestParams = {
    //     "device_id": crossplat.device.uuid,
    //     "drive": storageName,
    //     "business_id": sessionStorage.getItem('business_id'),
    // }
    var id, type;
    if ($('body').attr('app') == "digibiz_account_storage") {
        var requestParams = {
            "device_id": crossplat.device.uuid,
            "drive": storageName,
            "id": sessionStorage.getItem('account_id'),
            "type": "individual"
        }
        id = sessionStorage.getItem('account_id');
        type = "individual";
    } else {
        var requestParams = {
            "device_id": crossplat.device.uuid,
            "drive": storageName,
            "id": sessionStorage.getItem('business_id'),
            "type": "business"
        }
        id = sessionStorage.getItem('business_id');
        type = "business";
    }
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            Materialize.toast(storageName + " is set as default storage. And is active now.", 3000, 'success-alert');
            sessionStorage.setItem('storage_token', JSON.stringify({ selectedStorage: storageName, tokenStatus: "active" }));
            if ($('body').attr('app') == "digibiz_account_storage") {
                // addLoader();
                if (sessionStorage.getItem('digibiz_storage_selection') == "first") {
                    // sessionStorage.removeItem('digibiz_storage_selection');
                    // window.location.reload();
                    getDigibizAccountStoragePage();
                    callback(true);
                } else {
                    // window.location.reload();
                    getDigibizAccountStoragePage()
                    callback(true);
                }
            } else {//business add / business edit
                if ($('body').attr('app') == "business_add") {
                    businessStorageReloadAddPage(function (err, pageResponse) {
                        if (err) {
                            //console.log("err", err)
                        } else {
                            //console.log("pageResponse");
                        }
                    })
                } else if ($('body').attr('app') == "business_edit") {
                    businessStorageReloadEditPage(function (err, pageResponse) {
                        if (err) {
                            //console.log("err", err)
                        } else {
                            //console.log("pageResponse");
                        }
                    })
                } else {
                    //console.log("******")
                }
                callback(true);
            }
        } else {
            //console.log("failure");
            Materialize.toast("failure", 3000, 'success-alert');
            // profile.authStatus = 'started';
            var current_url = location.href.split('#').pop();
            var data_from;
            if (current_url && current_url.includes('business/add')) {
                data_from = "create";
            } else if (current_url && current_url.includes('business/edit')) {
                data_from = "edit";
            } else if (current_url && current_url.includes('business/storage')) {
                data_from = "business_storage";
            } else {
                data_from = "account_storage";
            }
            if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                // window.open(`${storage[`${storageName}_auth`]}?platform=${crossplat.device.platform}&device_id=${crossplat.device.uuid}`, '_system');                
                window.open(`${api[`${storageName}_auth`]}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&id=${id}&type=${type}&data_from=${data_from}`, "_self");
            } else {
                // if (storageName == 'GoogleDrive') {
                cordova.plugins.browsertab.openUrl(`${api[`${storageName}_auth`]}?platform=${crossplat.device.platform}&device_id=${crossplat.device.uuid}&id=${id}&type=${type}&data_from=${data_from}`, { scheme: "djbusiness://" });
                // } else {
                //     var browserid = cordova.InAppBrowser.open(`${api[`${storageName}_auth`]}?platform=${crossplat.device.platform}&device_id=${crossplat.device.uuid}&id=${id}&type=${type}&data_from=${data_from}`, '_blank', 'location=no');
                //     browserid.addEventListener('message', function (data) {
                //         //console.log("@@please check it@@", data);
                //     });
                // }
                // cordova.plugins.browsertab.openUrl(`${api[`${storageName}_auth`]}?device_id=${crossplat.device.uuid}&platform=${crossplat.device.platform}&id=${id}&type=${type}&data_from=${data_from}`, { scheme: "djbusiness://" });
            }
            // window.open(`https://storage.digitaljeevi.com/google/oauth2callback?platform=${crossplat.device.platform}&device_id=${crossplat.device.uuid}`, '_system');
            // cordova.plugins.browsertab.openUrl(config.api.core + "/api/" + storage.toLowerCase() + "?device_id=" + crossplat.device.uuid, {scheme: "djbusiness://"});
        }
    }, api.set_active_storage, "POST", "JSON", requestParams);

}



function businessDigibizAdminsTab() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "digibiz_admin"
        }
        businessOwnerList(reqParam)
            .then((response) => {
                //console.log("businessOwnerList response", response);
                var dataList = {
                    dataList: response.map(e => {
                        if (e.admin_type == "digibiz_admin") {
                            if (e.owner_data.employee_data.hasOwnProperty('identity_picture') && e.owner_data.employee_data.identity_picture) {
                                //console.log("1");
                                if (e.owner_data.employee_data.identity_picture.hasOwnProperty('thumbnail') && e.owner_data.employee_data.identity_picture.thumbnail) {
                                    //console.log("2")
                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.owner_data.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.owner_data.employee_data.identity_picture.thumbnail}`;
                                    //console.log("avtarUrl", avtarUrl);
                                    e.owner_data.employee_data.identity_picture['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
                                } else {
                                    e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
                                }
                            } else {
                                e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
                            }
                        } else if (e.admin_type == "creator") {
                            if (e.owner_data.creator_data.hasOwnProperty('profile_display') && e.owner_data.creator_data.profile_display) {
                                //console.log("1");
                                if (e.owner_data.creator_data.profile_display.hasOwnProperty('thumbnail') && e.owner_data.creator_data.profile_display.thumbnail) {
                                    //console.log("2")
                                    var avtarUrl = `${config.api.core}/api/individual/get_image?image_id=${e.owner_data.creator_data.profile_display.thumbnail}&device_id=${crossplat.device.uuid}`;
                                    //console.log("avtarUrl", avtarUrl);
                                    e.owner_data.creator_data.profile_display['avtarUrl'] = avtarUrl;
                                    e['imageLetter'] = e.owner_data.creator_data.name.first.charAt(0);
                                } else {
                                    e['imageLetter'] = e.owner_data.creator_data.name.first.charAt(0);
                                }
                            } else {
                                e['imageLetter'] = e.owner_data.creator_data.name.first.charAt(0);
                            }
                        }
                        return e;
                    })
                }
                //console.log("dataList", dataList);
                fetch.replaceHtml(function () {
                    removeLoader();
                    appScroll.scrollBar('#digibiz-admin-list-wrapper');
                    resolve();
                }, "page/business/digibiz_admins_list_data", "#digibiz-admin-list-template", "#digibiz-admin-list-data-container", dataList);
            })
            .catch((err) => {
                //console.log("error in businessOwnerList list");
                fetch.replaceHtml(function () {
                    if ($('.employee-wrapper').length == 0) {
                        $('#digibiz-admin-list-wrapper').append(`<div class="no_data">No data found</div>`);
                    }
                    removeLoader();
                    resolve();
                }, "page/business/digibiz_admins_list_data", "#digibiz-admin-list-template", "#digibiz-admin-list-data-container", null);
            })
    })
}

function businessModuleAdminsTab() {
    return new Promise((resolve, reject) => {
        addLoader();
        fetch.replaceHtml(function () {
            removeLoader();
            appScroll.scrollBar('#main-content-wrapper');
            resolve();
        }, "page/business/module_admin_management_data", "#module-admin-management-list-template", "#module-admin-list-data-container", null);
        // var reqParam = {
        //     device_id: crossplat.device.uuid,
        //     business_id: sessionStorage.getItem('business_id'),
        //     list_by: "module_admin"
        // }
        // businessOwnerList(reqParam)
        //     .then((response) => {
        //         //console.log("businessOwnerList response", response);
        //         var dataList = {
        //             dataList: response.map(e => {
        //                 if (e.module == "customer_management") {
        //                     e.module_name = 'Customer Management';
        //                 } else if (e.module == "employee_management") {
        //                     e.module_name = 'Employee Management';
        //                 } else if (e.module == "communication_management") {
        //                     e.module_name = 'Communication Management';
        //                 } else if (e.module == "collaborator_management") {
        //                     e.module_name = 'Collaborator Management';
        //                 }
        //                 if (e.owner_data.employee_data.hasOwnProperty('identity_picture') && e.owner_data.employee_data.identity_picture) {
        //                     if (e.owner_data.employee_data.identity_picture.hasOwnProperty('thumbnail') && e.owner_data.employee_data.identity_picture.thumbnail) {
        //                         var avtarUrl = `${api.get_employee_identity_picture}?id=${e.owner_data.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.owner_data.employee_data.identity_picture.thumbnail}`;
        //                         e.owner_data.employee_data.identity_picture['avtarUrl'] = avtarUrl;
        //                     } else {
        //                         e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
        //                     }
        //                 } else {
        //                     e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
        //                 }
        //                 return e;
        //             })
        //         }
        //         fetch.replaceHtml(function () {
        //             if ($('.employee-wrapper').length == 0) {
        //                 $('#module-admin-list-wrapper').append(`<div class="no_data">No data found</div>`);
        //             }
        //             removeLoader();
        //             resolve();
        //         }, "page/business/module_admins_list_data", "#module-admin-list-template", "#module-admin-list-data-container", dataList);
        //     })
        //     .catch((err) => {
        //         //console.log("error in businessOwnerList list");
        //         fetch.replaceHtml(function () {
        //             removeLoader();
        //             resolve();
        //         }, "page/business/module_admins_list_data", "#module-admin-list-template", "#module-admin-list-data-container", null);
        //     })
    })
}


function prospectAppHubPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            removeLoader();
            resolve();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
        }, "page/prospect/app_hub", "#prospect-app-hub-page-template", "#main-content-wrapper", null);
    })
}

function jeeviAppHubPage() {
    return new Promise((resolve, reject) => {
        //check if jeevi account is active
        var getAccountDetails = JSON.parse(sessionStorage.getItem('accountDetails'));
        //console.log("getAccountDetails", getAccountDetails);
        if (getAccountDetails.hasOwnProperty('roles') && getAccountDetails.roles && (getAccountDetails.roles.prospect == "active" || getAccountDetails.roles.prospect == "inactive_pending")) {
            var data = {
                jeevi_role_status: true
            };
            //console.log("data", data);
            fetch.replaceHtml(function () {
                removeLoader();
                resolve();
                var slider = new Swiper('.hubSwiper', {
                    slidesPerView: 1,
                    spaceBetween: 0,
                    grabCursor: true,
                    observer: true,
                    pagination: {
                        el: '.swiper-pagination',
                        clickable: true,
                    }
                });
                $(".swiper").removeClass("hubSwiper");
            }, "page/prospect/app_hub", "#prospect-app-hub-page-template", "#digibiz-home-page-middle-band-wrapper", data);
        } else {//other status
            var reqParam = {
                device_id: crossplat.device.uuid,
                get_by: "account_id",
                account_id: getAccountDetails.id
            }
            getJeeviAccount(reqParam)
                .then((response) => {
                    var data = {
                        jeevi_role_status: false
                    };
                    //console.log("data", data);
                    fetch.replaceHtml(function () {
                        //jeevi account is deleted
                        if (response) {
                            if (response.status.status == "pending" || response.status.status == "deleted") {
                                var alert_parms = {
                                    alert_id: "jeevi-account-not-present",
                                    alert_platform: crossplat.device.platform,
                                    alert_title: `Jeevi Account!`,
                                    alert_body: `Your jeevi account is deleted.`,
                                    alert_btn: [{
                                        name: "Create",
                                        attr: [{ name: "id", value: "digibiz_account_role_update_confirm_button" }]
                                    },
                                    {
                                        name: "Close",
                                        attr: [{ name: "id", value: "close-jeevi-account-create" }]
                                    }]
                                }
                                showAlert(alert_parms, function () {
                                    sessionStorage.setItem('role', 'prospect');
                                    $(document).on('click', '#close-jeevi-account-create', function (e) {
                                        $('#jeevi-account-not-present').remove();
                                    });
                                });
                            } else {//jeevi account is inactive
                                var alert_parms = {
                                    alert_id: "jeevi-account-inactive",
                                    alert_platform: crossplat.device.platform,
                                    alert_title: `Jeevi Account Alert!`,
                                    alert_body: `Your jeevi account is inactive.`,
                                    alert_btn: [{
                                        name: "Activate",
                                        attr: [{ name: "id", value: "activate-jeevi-account" }]
                                    },
                                    {
                                        name: "Close",
                                        attr: [{ name: "id", value: "close-jeevi-account-inactive" }]
                                    }]
                                }
                                showAlert(alert_parms, function () {
                                    sessionStorage.setItem('jeevi_id', response.id);
                                    sessionStorage.setItem('jeevi_status', response.status.status);
                                    sessionStorage.setItem('account_status', getAccountDetails.status.status);
                                    $('#jeevi-account-inactive').attr('jeevi_id', response.id);
                                    $(document).on('click', '#close-jeevi-account-inactive', function (e) {
                                        $('#jeevi-account-inactive').remove();
                                    });

                                    $(document).on('click', '#activate-jeevi-account', function (e) {
                                        addLoader();
                                        var getData = {
                                            jeevi_account_status: getAccountDetails.roles.prospect,
                                            account_settings: response.settings
                                        }
                                        //console.log("getData", getData);
                                        fetch.getHtml(function (fetcherror, html) {
                                            var modal_data = {
                                                modal_id: "jeevi-account-inactive-active-settings",
                                                modal_header: "Active/Inactive",
                                                modal_platform: crossplat.device.platform,
                                                modal_body: html,
                                                modal_action_buttons: [{
                                                    "name": "Activate",
                                                    "id": "add-jeevi-account-inactive-data",
                                                }]
                                            }
                                            showModal(modal_data, function () {
                                                $('#jeevi-account-inactive').remove();
                                                if (getData.jeevi_account_status == "inactive") {
                                                    $('.account-inactive-start-end-date-time').addClass('hide');
                                                    $('.account-inactive-main-container').addClass('hide');
                                                }
                                                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                                                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                                    if ($('.modal-popup-content').length > 0) {
                                                        //console.log("scroll initiated for modal pop-up class")
                                                        appScroll.scrollBar('.modal-popup-content');
                                                    }
                                                } else {
                                                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                                                }
                                                // if (getData.account_status == "inactive" || getData.account_status == "inactive_pending") {
                                                //     $('.account-inactive-start-end-date-time').removeClass('hide');
                                                // }

                                                if ($(`.custom-modal-popup[id="jeevi-account-inactive-active-settings"]`).length > 1) {
                                                    $(`.custom-modal-popup[id="jeevi-account-inactive-active-settings"]:last`).remove();
                                                }
                                                removeLoader();
                                            });
                                        }, 'page/common/active_inactive_jeevi_account', '#active_inactive_jeevi_account-template', getData);
                                    });
                                });
                            }
                        } else {
                            var alert_parms = {
                                alert_id: "jeevi-account-not-present",
                                alert_platform: crossplat.device.platform,
                                alert_title: `Jeevi Account!`,
                                alert_body: `Your jeevi account is deleted.`,
                                alert_btn: [{
                                    name: "Create",
                                    attr: [{ name: "id", value: "digibiz_account_role_update_confirm_button" }]
                                },
                                {
                                    name: "Close",
                                    attr: [{ name: "id", value: "close-jeevi-account-create" }]
                                }]
                            }
                            showAlert(alert_parms, function () {
                                sessionStorage.setItem('role', 'prospect');
                                $(document).on('click', '#close-jeevi-account-create', function (e) {
                                    $('#jeevi-account-not-present').remove();
                                });
                            });
                        }
                        removeLoader();
                        resolve();
                        var slider = new Swiper('.hubSwiper', {
                            slidesPerView: 1,
                            spaceBetween: 0,
                            grabCursor: true,
                            observer: true,
                            pagination: {
                                el: '.swiper-pagination',
                                clickable: true,
                            }
                        });
                        $(".swiper").removeClass("hubSwiper");
                    }, "page/prospect/app_hub", "#prospect-app-hub-page-template", "#digibiz-home-page-middle-band-wrapper", data);
                })
                .catch((err) => {
                    //console.log("jeevi account not present");
                })
        }
    })
}

function prospectAppHubSettingsPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            removeLoader();
            resolve();
        }, "page/prospect/settings", "#prospect-app-hub-settings-page-template", "#main-content-wrapper", null);
    })
}

function moduleAdminListPage() {
    return new Promise((resolve, reject) => {
        var getType = sessionStorage.getItem('module_type');
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "module_wise_module_admin",
            module: getType
        }
        businessOwnerList(reqParam)
            .then((response) => {
                //console.log("businessOwnerList response", response);
                var dataList = {
                    dataList: response.map(e => {
                        if (e.owner_data.employee_data.hasOwnProperty('identity_picture') && e.owner_data.employee_data.identity_picture) {
                            if (e.owner_data.employee_data.identity_picture.hasOwnProperty('thumbnail') && e.owner_data.employee_data.identity_picture.thumbnail) {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${e.owner_data.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.owner_data.employee_data.identity_picture.thumbnail}`;
                                e.owner_data.employee_data.identity_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
                            } else {
                                e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
                            }
                        } else {
                            e['imageLetter'] = e.owner_data.employee_data.name.first.charAt(0);
                        }
                        return e;
                    })
                }
                fetch.replaceHtml(function () {
                    // if ($('.employee-wrapper').length == 0) {
                    //     $('#module-admin-list-wrapper').append(`<div class="no_data">No data found</div>`);
                    // }
                    resolve();
                    removeLoader();
                }, "page/business/module_admins_list_data", "#module-admin-list-template", "#main-content-wrapper", dataList);
            })
            .catch((err) => {
                //console.log("error in businessOwnerList list");
                fetch.replaceHtml(function () {
                    resolve();
                    removeLoader();
                }, "page/business/module_admins_list_data", "#module-admin-list-template", "#main-content-wrapper", null);
            })
    })
}


function activeSuperAdminsTab() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "super_admin_active_tab"
        }
        employeeList(reqParam)
            .then((response) => {
                //console.log("employeeList response", response);
                fetch.replaceHtml(function () {
                    processActiveSuperAdminsList(response, function () {
                        removeLoader();
                        appScroll.scrollBar('.active-super-admin-list-contentbox');
                        resolve();
                    });
                }, "page/business/active_super_admin_list_wrapper", "#active-super-admins-list-wrapper-template", "#active-super-admin-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/active_super_admin_list_data", "#active-super-admin-data-list-template", "#active-super-admins-list-wrapper", null);
                }, "page/business/active_super_admin_list_wrapper", "#active-super-admins-list-wrapper-template", "#active-super-admin-list-data-container", null);
            })
    });
}

function processActiveSuperAdminsList(data, callback) {
    digibiz.active_super_admins_list = removeDuplicates(digibiz.active_super_admins_list.concat(data), "dj_unique_employee_id");
    var superAdminsList = {
        active_super_admins_list_data: digibiz.active_super_admins_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("superAdminsList", superAdminsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/active_super_admin_list_data", "#active-super-admin-data-list-template", "#active-super-admins-list-wrapper", superAdminsList);
}

function pendingSuperAdminsTab() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "pending_super_admins"
        }
        notificationList(reqParam)
            .then((response) => {
                //console.log("notificationList response", response);
                fetch.replaceHtml(function () {
                    processPendingSuperAdminsList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/business/pending_super_admin_list_wrapper", "#pending-super-admins-list-wrapper-template", "#pending-super-admin-list-data-container", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/business/pending_super_admin_list_data", "#pending-super-admin-data-list-template", "#pending-super-admins-list-wrapper", null);
                }, "page/business/pending_super_admin_list_wrapper", "#pending-super-admins-list-wrapper-template", "#pending-super-admin-list-data-container", null);
            })
    });
}


function processPendingSuperAdminsList(data, callback) {
    digibiz.pending_super_admins_list = removeDuplicates(digibiz.pending_super_admins_list.concat(data), "id");
    var superAdminsList = {
        pending_super_admins_list_data: digibiz.pending_super_admins_list
    };
    //console.log("superAdminsList", superAdminsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            removeLoader();
            callback();
        }
    }, "page/business/pending_super_admin_list_data", "#pending-super-admin-data-list-template", "#pending-super-admins-list-wrapper", superAdminsList);
}

function processDepartmentListSelection(data, callback) {
    digibiz.department_list_selection = removeDuplicates(digibiz.department_list_selection.concat(data), "id");
    var getData = {
        department_list_data: digibiz.department_list_selection.map(e => {
            e['imageLetter'] = e.name.charAt(0);
            return e;
        }),
    };
    //console.log("getData", getData);
    if (digibiz.alreadySelectedDepartment != undefined && digibiz.alreadySelectedDepartment.length > 0) {
        $.each(digibiz.alreadySelectedDepartment, function (index, department) {
            // $(`.selected-department[data-id="${department.id}"]`).prop('checked', true);
            // $(`.selected-department[data-id="${department.id}"]`).prop('disabled', true);
            //check in the global array
            var getIndex = digibiz.department_list_selection.findIndex((e) => e.id == department.id);
            if (getIndex > -1) {
                digibiz.department_list_selection[getIndex]['selected'] = true;
            }
        })
        callback();
    } else {
        callback();
    }
    fetch.replaceHtml(function (err) {
        if (!err) {
            //check already present moderator in the modal
            // if (digibiz.alreadySelectedDepartment != undefined && digibiz.alreadySelectedDepartment.length > 0) {
            //     $.each(digibiz.alreadySelectedDepartment, function (index, department) {
            //         // $(`.selected-department[data-id="${department.id}"]`).prop('checked', true);
            //         // $(`.selected-department[data-id="${department.id}"]`).prop('disabled', true);
            //         //check in the global array
            //         var getIndex = digibiz.department_list_selection.findIndex((e) => e.id == department.id);
            //         if (getIndex > -1) {
            //             digibiz.department_list_selection[getIndex]['selected'] = true;
            //         }
            //     })
            //     callback();
            // } else {
            //     callback();
            // }
            appScroll.scrollBar('.department-list-contentbox');
            console.log('entry 1');
        }
    }, "page/employee/department_list_data", "#department-list-data-template", "#department-list-selection-wrapper", getData);
}


function processCommunicationGroupContactListCustomerList(data, callback) {
    digibiz.communicationGroupsCustomerContactsList = removeDuplicates(digibiz.communicationGroupsCustomerContactsList.concat(data), 'id');
    //put it in modal
    var getData = {
        communication_group_identifier_based_customer_contact_list_data: digibiz.communicationGroupsCustomerContactsList
    };
    fetch.replaceHtml(function () {
        callback();
    }, "page/communication/communication_group_contact_list_customer_list", "#communication-group-identifier-based-customer-contact-list-data-template", '#communication-group-contacts-items-list-wrapper', getData);

}


function listenForCommunicationGroupContactListCustomerListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                "list_by": "customer",
                count: 20,
                offset: digibiz.communicationGroupsCustomerContactsList.length
            }
            customerIdentifierList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessCommunicationGroupContactListCustomerList(response, function () {
                        listenForCommunicationGroupContactListCustomerListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/communication/scroll_communication_group_contact_list_customer_list", "#scroll-communication-group-identifier-based-customer-contact-list-data-template", '#communication-group-contacts-items-list-wrapper .communication-group-identifier-based-customer-contact-list-contentbox', null);

                })

        }
    });
}


function scrollProcessCommunicationGroupContactListCustomerList(data, callback) {
    digibiz.communicationGroupsCustomerContactsList = removeDuplicates(digibiz.communicationGroupsCustomerContactsList.concat(data), 'id');
    //put it in modal
    var getData = {
        communication_group_identifier_based_customer_contact_list_data: data
    };
    fetch.appendHtml(function () {
        callback();
    }, "page/communication/scroll_communication_group_contact_list_customer_list", "#scroll-communication-group-identifier-based-customer-contact-list-data-template", '#communication-group-contacts-items-list-wrapper .communication-group-identifier-based-customer-contact-list-contentbox', getData);

}

function processCommunicationGroupContactListCustomerContactItemsList(data, accordionitem, callback) {
    var getData = {
        communication_group_contact_list_customer_list_level_two_data: data
    };
    fetch.replaceHtml(function () {
        callback();
    }, "page/communication/communication_group_contact_list_customer_list_level_two", "#communication-group-contact-list-customer-list-level-two-data-template", `#${accordionitem}[data-content-type="identifier"]`, getData);
}

function processCommunicationGroupContactListCustomerContactsList(data, accordionitem, callback) {
    // digibiz.communication_group_contact_list_customer_list_level_three_data = removeDuplicates(digibiz.communication_group_contact_list_customer_list_level_three_data.concat(data), 'id');
    var getData = {
        communication_group_contact_list_customer_list_level_three_data: data,
        device_id: crossplat.device.uuid
    };
    console.log('getData', getData);
    fetch.replaceHtml(function () {
        //remove already present customers in the group(by elements/html)
        var getMembers = [];
        //get new added customers..still not added in members collection
        if ($('.communication-group-customer-member-wrapper').length > 0) {
            $.each($('.communication-group-customer-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    // type: "new_member"
                });
            });
        }
        //get old members...added already in members collection
        if ($('#communication-group-customer-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-customer-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-customer-id'),
                    // type: "old_member"
                });
            });
        }
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                // if (element.type == "new_member") {
                // $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${element.id}"]`).remove();
                // } else if (element.type == "old_member") {
                // $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${element.id}"]`).remove();
                // $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                // }
            })
        }
        //check uncheck
        $.each(digibiz.communicationSelectedContactList, function (index, elem) {
            if (elem.contact_item_id == accordionitem) {
                $(`.accordion-contenttt[id="${elem.contact_item_id}"]`).find(`.communication-group-customer-contact-select-btn[data-id="${elem.id}"]`).attr("checked", "checked");
            }
        })
        callback();
    }, "page/communication/communication_group_contact_list_customer_list_level_three", "#communication-group-contact-list-customer-list-level-three-data-template", `#${accordionitem}[data-content-type="contact_item"]`, getData);
}

function listenForCommunicationGroupContactListCustomerContactsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('accordion_item'),
                count: 5,
                offset: digibiz.communication_group_contact_list_customer_list_level_three_data.length
            }
            getContactList(reqParams)
                .then((response) => {
                    removeLoader();
                    scrollProcessCommunicationGroupContactListCustomerContactsList(response, sessionStorage.getItem('accordion_item'), function () {
                        listenForCommunicationGroupContactListCustomerContactsListScrollEvent($(".accordion-contenttt"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/communication/communication_group_contact_list_customer_list_level_three", "#communication-group-contact-list-customer-list-level-three-data-template", `#${accordionitem}[data-content-type="contact_item"]`, null);

                })

        }
    });
}

function scrollProcessCommunicationGroupContactListCustomerContactsList(data, accordionitem, callback) {
    digibiz.communication_group_contact_list_customer_list_level_three_data = removeDuplicates(digibiz.communication_group_contact_list_customer_list_level_three_data.concat(data), 'id');
    var getData = {
        communication_group_contact_list_customer_list_level_three_data: data,
        device_id: crossplat.device.uuid
    };
    fetch.appendHtml(function () {
        //remove already present customers in the group(by elements/html)
        var getMembers = [];
        //get new added customers..still not added in members collection
        if ($('.communication-group-customer-member-wrapper').length > 0) {
            $.each($('.communication-group-customer-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-id'),
                    // type: "new_member"
                });
            });
        }
        //get old members...added already in members collection
        if ($('#communication-group-customer-members-list').find('.communication-group-member-wrapper').length > 0) {
            $.each($('#communication-group-customer-members-list .communication-group-member-wrapper'), function (index, element) {
                getMembers.push({
                    id: $(element).attr('data-customer-id'),
                    // type: "old_member"
                });
            });
        }
        if (getMembers.length > 0) {
            $.each(getMembers, function (index, element) {
                // if (element.type == "new_member") {
                // $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${element.id}"]`).remove();
                // } else if (element.type == "old_member") {
                // $(`.communication-groups-identifier-based-customer-contact-wrapper[data-id="${element.id}"]`).remove();
                // $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                // }
            })
        }
        //check uncheck
        $.each(digibiz.communicationSelectedContactList, function (index, elem) {
            if (elem.contact_item_id == accordionitem) {
                $(`.accordion-contenttt[id="${elem.contact_item_id}"]`).find(`.communication-group-customer-contact-select-btn[data-id="${elem.id}"]`).attr("checked", "checked");
            }
        })
        callback();
    }, "page/communication/communication_group_contact_list_customer_list_level_three", "#communication-group-contact-list-customer-list-level-three-data-template", `#${accordionitem}[data-content-type="contact_item"] .os-content`, getData);
}

function showCloudSelcetionList(callback) {
    fetch.replaceHtml(function (error) {
        if (!error) {
            // appScroll.scrollBar('.upload-grid-view-wrapper');
            callback();
        }
    }, 'filemanager/cloud_selection', '#cloud-assets-select-template', '#filemanger-assets-list-wrapper', null);
}


/**
 * Get Blob content From URL
 */
function getBlobFromURL(url) {
    return new Promise((resolve) => {
        var req = new XMLHttpRequest();
        req.open("GET", url, true);
        req.responseType = "blob";
        req.onreadystatechange = function (event) {
            if (req.readyState == 4 && req.status == 200) {
                resolve(req.response);
            }
        };
        req.send();
    });
}

/**
 * blob to base64
 */
function blob2Base64(blob) {
    //console.log("blobinside", blob)
    return new Promise((resolve, reject) => {
        var reader = new FileReader;
        //console.log("reader", reader);
        reader.onloadend = function () {
            //console.log("this.result", this.result);
            resolve(this.result);
        };
        reader.onerror = function (err) {
            reject(err);
        }
        reader.readAsDataURL(blob);
    });
}

function startFileSession(file, type) {
    return new Promise((resolve, reject) => {
        let requestParams = {
            device_id: crossplat.device.uuid,
            location: file.location,
            parent: file.parent,
            owner: {
                type: file.owner.type,
                id: file.owner.id
            },
            real_name: file.file_attributes.name.real
        }
        var API_URL = (type == 'download') ? api.chunk_download : api.chunk_view_by_file
        fetch.apiCall(function (response, status, xhr) {
            if (status === 'success') {
                response.Data['fileType'] = file.file_attributes.file_type;
                resolve(response.Data);
            } else {
                var errorRes = JSON.parse(response.responseText);
                if (type == 'download') {
                    Materialize.toast(errorRes.error, 3000, 'error-alert');
                    reject(errorRes.error);
                } else {
                    Materialize.toast(errorRes.error.msg, 3000, 'error-alert');
                    resolve();
                    // reject(errorRes.error.msg);
                }
            }
        }, API_URL, "POST", "JSON", requestParams);
    });
}

function getIndividualAssets(requestParams) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response);
            } else {
                reject(response);
            }
        }, api.core_get_assets, "POST", "JSON", requestParams);
    });
}

function getDigibizAssets(parent, location) {
    // if (sessionStorage.getItem('bizchat_role') == "employee") {
    //     var individual_id = sessionStorage.getItem('employee_id');
    //     var type = "employee";
    // } else if (sessionStorage.getItem('bizchat_role') == "individual") {
    var individual_id = sessionStorage.getItem('account_id');
    var type = "individual";
    // } else if (sessionStorage.getItem('bizchat_role') == "customer") {
    //     var individual_id = sessionStorage.getItem('digibiz_individual_id');
    //     var type = "cutomer";
    // }
    var requestParams = {
        device_id: crossplat.device.uuid,
        owner: {
            type: type,
            id: individual_id
        },
        location: location,
        parent: parent,
        first_request: 'true',
        offset: 0,
        count: 20
    };
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response);
            } else {
                reject(response);
            }
        }, api.digibiz_get_assets, "POST", "JSON", requestParams);
    });
}

function showIndividualFilemanagerAssetsFilesList(data = null, callback) {
    if (data != null) {
        digibiz.cloudAssets = removeDuplicates(digibiz.cloudAssets.concat(data), 'id');
        sorteddata = sortData(digibiz.cloudAssets, 'name', 'asc');
        var parms = {
            assets: sorteddata
        }
    } else {
        var parms = null;
    }
    identifier = '#filemanger-assets-list-wrapper';
    if ($('#filemanger-assets-list-wrapper .os-content').length > 0) {
        identifier = '#filemanger-assets-list-wrapper .os-content';
    } else {
        $('#filemanger-assets-list-wrapper').replaceWith('<div class="upload-grid-view-wrapper view-grid" id="filemanger-assets-list-wrapper"></div>');
    }
    fetch.replaceHtml(function (error) {
        if (!error) {
            callback();
        }
    }, 'filemanager/individual_cloud_files_list', '#individual-filemanager-assets-list-template', identifier, parms);
}

function getIndividualAssetDetails(asset_id) {
    return new Promise((resolve, reject) => {
        var user_id = window.sessionStorage.getItem('account_id');
        var user_type = "individual";
        var reqParams = {
            device_id: crossplat.device.uuid,
            owner: {
                type: user_type,
                id: user_id
            },
            asset_id: asset_id
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response.Data[0].data);
            } else {
                var errorRes = JSON.parse(response.responseText);
                reject(errorRes);
            }
        }, api.core_asset_details, "POST", "JSON", reqParams);
    });
}

function getDigibizAssetDetails(asset_id) {
    return new Promise((resolve, reject) => {
        var user_id = window.sessionStorage.getItem('account_id');
        var user_type = "individual";
        var reqParams = {
            device_id: crossplat.device.uuid,
            owner: {
                type: user_type,
                id: user_id
            },
            asset_id: asset_id
        };
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response.Data[0].data);
            } else {
                var errorRes = JSON.parse(response.responseText);
                reject(errorRes);
            }
        }, api.digibiz_asset_details, "POST", "JSON", reqParams);
    });
}

function individualStartFileSession(file, type) {
    return new Promise((resolve, reject) => {
        let requestParams = {
            device_id: crossplat.device.uuid,
            location: file.location,
            parent: file.parent,
            owner: {
                type: file.owner.type,
                id: file.owner.id
            },
            real_name: file.file_attributes.name.real
        }
        var API_URL = (type == 'download') ? api.core_chunk_download : api.core_chunk_view_by_file
        fetch.apiCall(function (response, status, xhr) {
            if (status === 'success') {
                response.Data['fileType'] = file.file_attributes.file_type;
                resolve(response.Data);
            } else {
                var errorRes = JSON.parse(response.responseText);
                if (type == 'download') {
                    Materialize.toast(errorRes.error, 3000, 'error-alert');
                    reject(errorRes.error);
                } else {
                    Materialize.toast(errorRes.error.msg, 3000, 'error-alert');
                    resolve();
                    // reject(errorRes.error.msg);
                }
            }
        }, API_URL, "POST", "JSON", requestParams);
    });
}

function getAssets() {
    // if (sessionStorage.getItem('bizchat_role') == "employee") {
    //     var API_URL = api.digibiz_get_assets;
    //     var individual_id = sessionStorage.getItem('employee_id');
    //     var type = "employee";
    // } else if (sessionStorage.getItem('bizchat_role') == "individual") {
    var API_URL = api.digibiz_get_assets;
    var individual_id = sessionStorage.getItem('account_id');
    var type = "individual";
    // } else if (sessionStorage.getItem('bizchat_role') == "customer") {
    //     var API_URL = api.digibiz_get_assets;
    //     var individual_id = sessionStorage.getItem('digibiz_individual_id');
    //     var type = "individual";
    // }
    return new Promise((resolve, reject) => {
        var requestParams = {
            // device_id: crossplat.device.uuid,
            // owner: {
            //     type: type,
            //     id: individual_id
            // },
            // location: 'personal_workspace',
            // parent: "",
            // // first_request: 'true',
            // offset: 0,
            // count: ''
            "device_id": crossplat.device.uuid,
            "owner": {
                "id": individual_id,
                "type": type
            },
            "location": "personal_workspace",
            "parent": "",
            "offset": 0,
            "count": 10
        };
        //console.log("requestParams", requestParams);
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response);
            } else {
                reject(response);
            }
        }, API_URL, "POST", "JSON", requestParams);
    });
}

function showDigibizFilemanagerAssetsFilesList(data = null, callback) {
    if (data != null) {
        digibiz.cloudAssets = removeDuplicates(digibiz.cloudAssets.concat(data), 'id');
        sorteddata = sortData(digibiz.cloudAssets, 'name', 'asc');
        var parms = {
            assets: sorteddata
        }
    } else {
        var parms = null;
    }
    identifier = '#filemanger-assets-list-wrapper';
    if ($('#filemanger-assets-list-wrapper .os-content').length > 0) {
        identifier = '#filemanger-assets-list-wrapper .os-content';
    } else {
        $('#filemanger-assets-list-wrapper').replaceWith('<div class="upload-grid-view-wrapper view-grid" id="filemanger-assets-list-wrapper"></div>');
    }
    fetch.replaceHtml(function (error) {
        if (!error) {
            callback();
        }
    }, 'filemanager/digibiz_cloud_files_list', '#digibiz-filemanager-assets-list-template', identifier, parms);
}


function employeeMembersList(callback) {
    var getEmployeeList = [];
    if ($('.communication-group-employee-members-list .communication-group-employee-member-checkbox').length > 0) {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "list_only_active",//list_unassigned_active
            business_id: sessionStorage.getItem('business_id')
        }
        employeeList(reqParam)
            .then((response) => {
                //console.log("employeeList response", response);
                //members list
                $.each($('.communication-group-employee-member-checkbox:checked'), function (index, employee) {
                    var getEmployee = response.find(e => e.dj_unique_employee_id == $(employee).attr('value'));
                    //console.log("getEmployee", getEmployee);
                    if (getEmployee != undefined) {
                        getEmployeeList.push({
                            // id: memberData.id,(this is group_member_id, still group is not formed, so not used)
                            // group_id: memberData.group_id,(this is group_id, still group is not formed, so not used)
                            id: `${getEmployee.dj_unique_employee_id}employee`,
                            member: {
                                id: getEmployee.dj_unique_employee_id,
                                account_id: getEmployee.account_id,
                                type: 'employee'
                            },
                            designation_name: getEmployee.designation_name,
                            // status: memberData.status,(this is group member status, still group is not formed, so not used)
                            member_name: getEmployee.name,
                            member_display_name: getEmployee.display_name,
                            identity_picture: getEmployee.identity_picture
                        })
                    }
                });
                //filter out already present employees in moderators list
                $.each($('.communication-group-moderator-member-not-saved'), function (index, employee) {
                    //console.log("check", $(employee).attr('value'));
                    getEmployeeList = getEmployeeList.filter(p => {
                        //console.log("p", p.member.id)
                        return p.member.id != $(employee).attr('value');
                    })
                });
                //console.log("finalgetEmployeeList", getEmployeeList);
                callback(null, getEmployeeList);
            })
            .catch((err) => {
                callback(err);
            })
    } else {
        //console.log("going as null employees")
        callback(null, getEmployeeList);
    }
}

function customerMembersList(callback) {
    var getCustomerList = [];
    if ($('.communication-group-customer-member-checkbox[data-type="customer"]:checked').length > 0) {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "business_active"
        }
        customerList(reqParam)
            .then((response) => {
                //members list
                $.each($('.communication-group-customer-member-checkbox[data-type="customer"]:checked'), function (index, customer) {
                    var getCustomer = response.find(e => e.id == $(customer).attr('value'));
                    if (getCustomer != undefined) {

                        getCustomerList.push({
                            // id: memberData.id,(this is group_member_id, still group is not formed, so not used)
                            // group_id: memberData.group_id,(this is group_id, still group is not formed, so not used)
                            id: `${getCustomer.id}customer`,
                            member: {
                                id: getCustomer.id,
                                account_id: getCustomer.account_id,
                                type: "customer",
                                customer_type: "customer",
                                identifier_id: getCustomer.identifier_id,
                                label: getCustomer.label

                            },
                            // status: memberData.status,(this is group member status, still group is not formed, so not used)
                            member_name: getCustomer.name,
                            member_display_name: getCustomer.display_name,
                            identity_picture: getCustomer.identity_picture,
                            role_business_name: getCustomer.role_business_name
                        })
                    }
                });
                //filter out already present employees in moderators list
                $.each($('.communication-group-moderator-member-not-saved'), function (index, customer) {
                    getCustomerList = getCustomerList.filter(p => {
                        return p.member.id != $(customer).attr('value');
                    })
                });
                callback(null, getCustomerList);
            })
            .catch((err) => {
                callback(err);
            })
    } else {
        //console.log("going as null customers")
        callback(null, getCustomerList);
    }
}

function associateCustomerMembersList(callback) {
    var getAssociateCustomerList = [];
    if ($('.communication-group-customer-member-checkbox[data-type="associate_customer"]:checked').length > 0) {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "business_active"
        }
        associateCustomerList(reqParam)
            .then((response) => {
                //members list
                $.each($('.communication-group-customer-member-checkbox[data-type="associate_customer"]:checked'), function (index, associate_customer) {
                    var getAssociateCustomer = response.find(e => e.id == $(associate_customer).attr('value'));
                    if (getAssociateCustomer != undefined) {
                        getAssociateCustomerList.push({
                            // id: memberData.id,(this is group_member_id, still group is not formed, so not used)
                            // group_id: memberData.group_id,(this is group_id, still group is not formed, so not used)
                            id: `${getAssociateCustomer.id}associatecustomer`,
                            member: {
                                id: getAssociateCustomer.id,
                                account_id: getAssociateCustomer.account_id,
                                type: "customer",
                                customer_type: "associate_customer",
                                identifier_id: getAssociateCustomer.identifier_id,
                                parent_customer_id: getAssociateCustomer.customer_id,
                                parent_customer_identifier_id: getAssociateCustomer.parent_customer_identifier_id
                            },
                            parent_customer_identifier_id: getAssociateCustomer.parent_customer_identifier_id,
                            // status: memberData.status,(this is group member status, still group is not formed, so not used)
                            member_name: getAssociateCustomer.name,
                            member_display_name: getAssociateCustomer.display_name,
                            identity_picture: getAssociateCustomer.identity_picture
                        })
                    }
                });
                //filter out already present employees in moderators list
                $.each($('.communication-group-moderator-member-not-saved'), function (index, customer) {
                    getAssociateCustomerList = getAssociateCustomerList.filter(p => {
                        return p.member.id != $(customer).attr('value');
                    })
                });
                callback(null, getAssociateCustomerList);
            })
            .catch((err) => {
                callback(err);
            })
    } else {
        callback(null, getAssociateCustomerList);
    }
}


function getEmployeeAccessListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "list_only_active"//list_unassigned_active
        }
        employeeList(reqParam)
            .then((response) => {
                //console.log("employeeList response", response);
                fetch.replaceHtml(function () {
                    processEmployeeAccessList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/employee/employee_access_list_wrapper", "#employee-access-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/employee/employee_access_list_data", "#employee-access-data-list-template", "#employee-access-list-wrapper", null);
                }, "page/employee/employee_access_list_wrapper", "#employee-access-list-wrapper-template", "#main-content-wrapper", null);
            })
    });
}

function processEmployeeAccessList(data, callback) {
    digibiz.employee_access_list = removeDuplicates(digibiz.employee_access_list.concat(data), "dj_unique_employee_id");
    var employeeList = {
        employee_access_list_data: digibiz.employee_access_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("employeeList", employeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/employee_access_list_data", "#employee-access-data-list-template", "#employee-access-list-wrapper", employeeList);
}


function processEmployeeShowAccessList(data, callback) {
    //console.log("data", data);
    digibiz.show_employee_access_list = removeDuplicates(digibiz.show_employee_access_list.concat(data), 'id');
    var showAccessList = {
        employee_show_access_list: digibiz.show_employee_access_list
    };
    console.log("showAccessList", showAccessList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/employee/show_employee_access_list_data", "#employee-show-access-data-list-template", "#employee-show-access-list-content-box", showAccessList);
}

function processCustomerShowAccessList(data, callback) {
    //console.log("data", data);
    digibiz.show_customer_access_list = removeDuplicates(digibiz.show_customer_access_list.concat(data), 'id');
    var showAccessList = {
        customer_show_access_list: digibiz.show_customer_access_list
    };
    //console.log("showAccessList", showAccessList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/show_customer_access_list_data", "#customer-show-access-data-list-template", "#customer-show-access-list-content-box", showAccessList);
}

function processAssociateCustomerShowAccessList(data, callback) {
    //console.log("data", data);
    digibiz.show_associate_customer_access_list = removeDuplicates(digibiz.show_associate_customer_access_list.concat(data), 'id');
    var showAccessList = {
        customer_show_access_list: digibiz.show_associate_customer_access_list
    };
    //console.log("showAccessList", showAccessList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/show_associate_customer_access_list_data", "#associate-customer-show-access-data-list-template", "#associate-customer-show-access-list-content-box", showAccessList);
}


function processCustomerEmployeeContactAccessSelection(data, callback) {
    //console.log("data", data);
    digibiz.customer_employee_contact_access_selection = removeDuplicates(digibiz.customer_employee_contact_access_selection.concat(data), 'id');
    var getData = {
        employee_Data: digibiz.customer_employee_contact_access_selection
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            //check the already given identifier item access
            if (digibiz.access_list.length > 0) {
                $.each(digibiz.access_list, function (index, value) {
                    // value.access_data.id
                    //console.log("present access", value.access_data.id);
                    // $(`.customer-contact-access-employee-wrapper[data-id="${value.access_data.id}"]`).find('.customer-contact-access-employee-selected').prop('checked', true);
                    $(`.customer-contact-access-employee-wrapper[data-id="${value.access_data.id}"]`).find('.customer-contact-access-employee-selected').prop('checked', true);
                    $(`.customer-contact-access-employee-wrapper[data-id="${value.access_data.id}"]`).addClass('selected-row');
                });
            }
            callback();
        }
    }, 'layouts/popup/customer_contact_access_employee_selection', '#customer-contact-access-employee-selection-template', '#customer-employee-contact-access-selection-content-box', getData);
}

function getCustomerContactAddAccessForCustomerContact(data, callback) {
    //console.log("data", data);
    digibiz.customer_contact_add_access_customer_contact_item_selection = removeDuplicates(digibiz.customer_contact_add_access_customer_contact_item_selection.concat(data), 'id');
    var getData = {
        identifier_items_list_data: digibiz.customer_contact_add_access_customer_contact_item_selection
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            //check the already given identifier item access
            if (digibiz.access_list.length > 0) {
                $.each(digibiz.access_list, function (index, value) {
                    // value.access_data.id
                    //console.log("present access", value.access_data.id);
                    $(`.customer-identifier-item-wrapper[data-id="${value.access_data.id}"]`).find('.customer-identifier-item-selected').prop('checked', true);
                });
            }
            callback();
        }
    }, 'layouts/popup/identifier_items_list', '#identifier-items-list-data-template', '#customer-contact-add-access-customer-contact-item-list-content-box', getData);
}

function businessStorageReloadAddPage(callback) {
    if (sessionStorage.getItem('business_id') && sessionStorage.getItem('business_id') != undefined && sessionStorage.getItem('business_id') != null) { //business_id is present
        var businessTypesReqParams = {
            device_id: crossplat.device.uuid,
        }
        businessTypeList(businessTypesReqParams)
            .then((result) => {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        if (response.hasOwnProperty('display_picture') && response.display_picture) {
                            if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                response.display_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (response.hasOwnProperty('declaration_transaction_pictures') && response.declaration_transaction_pictures) {
                            if (response.declaration_transaction_pictures.hasOwnProperty('thumbnail') && response.declaration_transaction_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_transaction_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=transaction`;
                                response.declaration_transaction_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_transaction_pictures.hasOwnProperty('image_id') && response.declaration_transaction_pictures.image_id) {
                                response.declaration_transaction_pictures['avtarUrl'] = response.declaration_transaction_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_signature_pictures') && response.declaration_signature_pictures) {
                            if (response.declaration_signature_pictures.hasOwnProperty('thumbnail') && response.declaration_signature_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_signature_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=signature`;
                                response.declaration_signature_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_signature_pictures.hasOwnProperty('image_id') && response.declaration_signature_pictures.image_id) {
                                response.declaration_signature_pictures['avtarUrl'] = response.declaration_signature_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_video') && response.declaration_video) {
                            if (response.declaration_video.hasOwnProperty('thumbnail') && response.declaration_video.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_video.thumbnail}`;
                                response.declaration_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        //put storage data in an array
                        if (response.hasOwnProperty('storage') && response.storage) {
                            //console.log("storage is present");
                            if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                                digibiz.storages.push({
                                    "name": "GoogleDrive",
                                    "account": response.storage.GoogleDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                                digibiz.storages.push({
                                    "name": "OneDrive",
                                    "account": response.storage.OneDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                                digibiz.storages.push({
                                    "name": "DropBox",
                                    "account": response.storage.DropBox.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                                digibiz.storages.push({
                                    "name": "DJ",
                                    "account": response.storage.DJ
                                })
                            }
                        }
                        var getBusiness = {
                            businessTypes: result,
                            getBusiness: response,
                            getBusinessTypeId: response.business_type_id,
                            storage_list: digibiz.storages,
                            active_storage: response.active_storage
                        }
                        if (digibiz.storages.length < 4) {
                            getBusiness.addStorage = true;
                        }
                        // //console.log("getBusiness", getBusiness);
                        fetch.replaceHtml(function () {
                            //dropdown show(common)
                            var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                            $('#business-type-choose-select-dropdown').val(getDropdownValue);
                            mobileFlaginit();
                            calenderInit('#business_date_of_commencement');
                            calenderInit('#business_date_of_incorporation');
                            //next the data-present-step to both back and forward button
                            $('.bussines-forward-btn').attr('data-present-step', '6');
                            $('.bussines-forward-btn').siblings('.bussines-back-btn').attr('data-present-step', '6');
                            //hide next button and show register button
                            $('.bussines-forward-btn').addClass('hide');
                            $('.bussines-back-btn').removeClass('hide');
                            $('.register-bussines-btn').removeClass('hide');
                            //activate the next stepper
                            $(`.business-create-stepper`).removeClass('is-active');
                            $(`.business-create-stepper[data-stepper="6"]`).addClass('is-active');
                            //show next content data 
                            $(`.business-creation-parts-container[data-step="1"]`).addClass('hide');
                            $(`.business-creation-parts-container[data-step="6"]`).removeClass('hide');
                            removeLoader();
                            callback();
                        }, "page/business/business_add", "#business-add-template", "#main-content-wrapper", getBusiness);
                    })
                    .catch((err) => {
                        removeLoader();
                        callback();
                        Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                resolve();
                Materialize.toast("Error in getting business types", 3000, 'rounded error-alert');
            })
    }
}

function businessStorageReloadEditPage(callback) {
    // $('.cloud-storage-account').remove();
    if (sessionStorage.getItem('business_id') && sessionStorage.getItem('business_id') != undefined && sessionStorage.getItem('business_id') != null) { //business_id is present
        var businessTypesReqParams = {
            device_id: crossplat.device.uuid,
        }
        businessTypeList(businessTypesReqParams)
            .then((result) => {
                var reqParam = {
                    device_id: crossplat.device.uuid,
                    id: sessionStorage.getItem('business_id')
                }
                businessGet(reqParam)
                    .then((response) => {
                        if (response.hasOwnProperty('display_picture') && response.display_picture) {
                            if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                                response.display_picture['avtarUrl'] = avtarUrl;
                            }
                        }
                        if (response.hasOwnProperty('declaration_transaction_pictures') && response.declaration_transaction_pictures) {
                            if (response.declaration_transaction_pictures.hasOwnProperty('thumbnail') && response.declaration_transaction_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_transaction_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=transaction`;
                                response.declaration_transaction_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_transaction_pictures.hasOwnProperty('image_id') && response.declaration_transaction_pictures.image_id) {
                                response.declaration_transaction_pictures['avtarUrl'] = response.declaration_transaction_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_signature_pictures') && response.declaration_signature_pictures) {
                            if (response.declaration_signature_pictures.hasOwnProperty('thumbnail') && response.declaration_signature_pictures.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_signature_pictures.thumbnail}`;
                                // var avtarUrl = `${api.get_business_thumbnail}?id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&type=signature`;
                                response.declaration_signature_pictures['avtarUrl'] = avtarUrl;
                            } else if (response.declaration_signature_pictures.hasOwnProperty('image_id') && response.declaration_signature_pictures.image_id) {
                                response.declaration_signature_pictures['avtarUrl'] = response.declaration_signature_pictures.image_url;
                            }
                        }
                        if (response.hasOwnProperty('declaration_video') && response.declaration_video) {
                            if (response.declaration_video.hasOwnProperty('thumbnail') && response.declaration_video.thumbnail) {
                                var avtarUrl = `${api.get_business_multimedia}?business_id=${sessionStorage.getItem('business_id')}&device_id=${crossplat.device.uuid}&image_id=${response.declaration_video.thumbnail}`;
                                response.declaration_video['avtarUrl'] = avtarUrl;
                            }
                        }
                        //put storage data in an array
                        if (response.hasOwnProperty('storage') && response.storage) {
                            // //console.log("storage is present", digibiz.storages = []);
                            digibiz.storages = [];
                            if (response.storage.hasOwnProperty('GoogleDrive') && response.storage.GoogleDrive) {
                                digibiz.storages.push({
                                    "name": "GoogleDrive",
                                    "account": response.storage.GoogleDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('OneDrive') && response.storage.OneDrive) {
                                digibiz.storages.push({
                                    "name": "OneDrive",
                                    "account": response.storage.OneDrive.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DropBox') && response.storage.DropBox) {
                                digibiz.storages.push({
                                    "name": "DropBox",
                                    "account": response.storage.DropBox.account
                                })
                            }
                            if (response.storage.hasOwnProperty('DJ') && response.storage.DJ) {
                                digibiz.storages.push({
                                    "name": "DJ",
                                    "account": response.storage.DJ
                                })
                            }
                        }
                        var getBusiness = {
                            businessTypes: result,
                            getBusiness: response,
                            getBusinessTypeId: response.business_type_id,
                            storage_list: digibiz.storages,
                            active_storage: response.active_storage
                        }
                        if (digibiz.storages.length < 4) {
                            getBusiness.addStorage = true;
                        }
                        // //console.log("getBusiness", getBusiness);
                        fetch.replaceHtml(function () {
                            //dropdown show(common)
                            var getDropdownValue = $('#business-type-choose-select-dropdown').find(`option[data-id="${response.business_type_id}"]`).val();
                            $('#business-type-choose-select-dropdown').val(getDropdownValue);
                            mobileFlaginit();
                            calenderInit('#business_date_of_commencement');
                            calenderInit('#business_date_of_incorporation');
                            //next the data-present-step to both back and forward button
                            $('.bussines-forward-btn').attr('data-present-step', '6');
                            $('.bussines-forward-btn').siblings('.bussines-back-btn').attr('data-present-step', '6');
                            //hide next button and show register button
                            $('.bussines-forward-btn').addClass('hide');
                            $('.bussines-back-btn').removeClass('hide');
                            $('.register-bussines-btn').removeClass('hide');
                            //activate the next stepper
                            $(`.business-create-stepper`).removeClass('is-active');
                            $(`.business-create-stepper[data-stepper="6"]`).addClass('is-active');
                            //show next content data 
                            $(`.business-creation-parts-container[data-step="1"]`).addClass('hide');
                            $(`.business-creation-parts-container[data-step="6"]`).removeClass('hide');
                            removeLoader();
                            callback();
                        }, "page/business/business_edit", "#business-edit-template", "#main-content-wrapper", getBusiness);
                    })
                    .catch((err) => {
                        removeLoader();
                        callback();
                        Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
                    })
            })
            .catch((err) => {
                removeLoader();
                resolve();
                Materialize.toast("Error in getting business types", 3000, 'rounded error-alert');
            })
    }
}


function businessDetails(business_id, callback) {
    var reqParam = {
        device_id: crossplat.device.uuid,
        id: business_id
    }
    businessGet(reqParam)
        .then((response) => {
            if (response.hasOwnProperty('display_picture') && response.display_picture) {
                if (response.display_picture.hasOwnProperty('thumbnail') && response.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${response.id}&device_id=${crossplat.device.uuid}&image_id=${response.display_picture.thumbnail}`;
                    response.display_picture['avtarUrl'] = avtarUrl;
                    response['imageLetter'] = response.name.charAt(0);
                    callback(null, response);
                } else {
                    response['imageLetter'] = response.name.charAt(0);
                    callback(null, response);
                }
            } else {
                response['imageLetter'] = response.name.charAt(0);
                callback(null, response);
            }
        })
        .catch((err) => {
            //console.log("err", err);
            callback(err);
        })
}


function callDigibizWriteStorage(fileobj, data, type = 'file_object') {
    return new Promise((resolve, reject) => {
        if (type == 'blob') {
            //prepare form data
            var formData = new FormData();
            formData.append("file", fileobj);
            formData.append("userid", data.user_id);
            formData.append("business_id", sessionStorage.getItem('business_id'));
            formData.append("options", JSON.stringify(data.options));
            formData.append("type", fileobj.type);
            formData.append("totalSize", fileobj.size);
            formData.append("fileName", data.fileName);

            //call api
            var xhr = new XMLHttpRequest();
            xhr.addEventListener('load', function (event) {
                if (event.target.status == 200) {
                    var response = JSON.parse(event.target.responseText);
                    resolve(response);
                } else if (event.target.status >= 400) {
                    reject(response);
                }
            }, false);
            xhr.open("POST", api.file_write, true);
            xhr.send(formData);
        } else {
            var readerArrayBuffer = new FileReader;
            readerArrayBuffer.onloadend = function (evt) {
                var blob = new Blob([evt.target.result], { type: fileobj.type });

                //prepare form data
                var formData = new FormData();
                formData.append("file", blob);
                formData.append("userid", data.user_id);
                formData.append("business_id", sessionStorage.getItem('business_id'));
                formData.append("options", JSON.stringify(data.options));
                formData.append("type", blob.type);
                formData.append("totalSize", blob.size);
                formData.append("fileName", data.fileName);

                //call api
                var xhr = new XMLHttpRequest();
                xhr.addEventListener('load', function (event) {
                    if (event.target.status == 200) {
                        var response = JSON.parse(event.target.responseText);
                        resolve(response);
                    } else if (event.target.status >= 400) {
                        reject(response);
                    }
                }, false);
                xhr.open("POST", api.file_write, true);
                xhr.send(formData);
            }
            readerArrayBuffer.readAsArrayBuffer(fileobj);
        }
    });
}

/* 
 * Module: Core
 * Author : Sapnesh Naik
 * Description : Encrypt a string.
 */
function encryptString(string, callback) {
    param = { key: "dummy", string: string };

    fetch.apiCall(function (response, status, xhr) {
        return callback(response.data);
    }, api.encrypt_string, "POST", "JSON", param);
}

/* 
 * Module: Core
 * Author : Sapnesh Naik
 * Description : Decrypt a string.
 */
function decryptSring(string, callback) {
    //console.log('decrypt string starts');
    param = { key: "dummy", string: string };
    fetch.apiCall(function (response, status, xhr) {
        //console.log('decrypt string response', response);
        return callback(response.data);
    }, api.decrypt_string, "POST", "JSON", param);
}

function AddMinutesToDate(date, minutes) {
    return new Date(date.getTime() + minutes * 60000);
}

function timeConvertor(time) {
    //console.log("time", time);
    var PM = time.match('PM') ? true : false
    //console.log("PM", PM);
    time = time.split(':')
    //console.log("time1", time);
    var min = time[1];
    //console.log("Min", min);
    //console.log("asd", time[0]);
    if (time[0] == 12) {
        return (time[0] + ':' + time[1])
    } else {
        //console.log("else");
        if (PM) {
            //console.log("11");
            var hour = 12 + parseInt(time[0], 10)
            //console.log("hour", hour);
        } else {
            //console.log("22");
            var hour = time[0]
            //console.log("hour", hour);
        }
        min = min.slice(0, -2)
        //console.log("time", hour + ':' + min);
        return (hour + ':' + min)
    }
}

function formatAMPM(date) {
    var dd = date.getDate();
    var mm = date.getMonth() + 1;
    var yyyy = date.getFullYear();
    if (dd < 10) {
        dd = '0' + dd;
    }
    if (mm < 10) {
        mm = '0' + mm;
    }
    var today = yyyy + '/' + mm + '/' + dd;
    var hours = date.getHours();
    var minutes = date.getMinutes();
    var ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; // the hour '0' should be '12'
    minutes = minutes < 10 ? '0' + minutes : minutes;
    var strTime = hours + ':' + minutes + ' ' + ampm;
    return today + ' ' + strTime;
}

//validation for start-time and end-time
function validateSettingData(type) {
    if (type == "schedule") {
        let startDate = false;
        let starttime = false;
        let endtime = false;
        let enddate = false;
        let validateMainFlag = false;
        //start date
        if ($('#start-date').val() == "") {
            showError($('#start-date'), `This field is required.`);
            startDate = true;
        } else {
            removeError($('#start-date'));
            startDate = false;
        }
        //end date
        if ($('#end-date').val() == "") {
            showError($('#end-date'), `This field is required.`);
            enddate = true;
        } else {
            removeError($('#end-date'));
            enddate = false;
        }
        //start time
        if ($('#start-time').val() == "") {
            showError($('#start-time'), `This field is required.`);
            starttime = true;
        } else {
            removeError($('#start-time'));
            starttime = false;
        }
        //end time
        if ($('#end-time').val() == "") {
            showError($('#end-time'), `This field is required.`);
            endtime = true;
        } else {
            removeError($('#end-time'));
            endtime = false;
        }

        var getStartDate = $('#start-date').val();
        var getStartDate1 = getStartDate.split('/')[0];
        //console.log("getStartDate1", getStartDate1);
        var getStartMonth2 = getStartDate.split('/')[1];
        //console.log("getStartMonth2", getStartMonth2);
        var getStartYear3 = getStartDate.split('/')[2];
        //console.log("getStartYear3", getStartYear3);

        var getEndDate = $('#end-date').val();
        var getEndDate1 = getEndDate.split('/')[0];
        //console.log("getEndDate1", getEndDate1);
        var getEndMonth2 = getEndDate.split('/')[1];
        //console.log("getEndMonth2", getEndMonth2);
        var getEndYear3 = getEndDate.split('/')[2];
        //console.log("getEndYear3", getEndYear3);

        let schedule_input_date = getStartYear3 + '/' + getStartMonth2 + '/' + getStartDate1;
        let expiry_input_date = getEndYear3 + '/' + getEndMonth2 + '/' + getEndDate1;
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1;
        var yyyy = today.getFullYear();
        if (dd < 10) {
            dd = '0' + dd;
        }
        if (mm < 10) {
            mm = '0' + mm;
        }
        today = yyyy + '/' + mm + '/' + dd;
        if ($('#start-time').val()) {
            var schedule_time = $('#start-time').val();
        }
        if ($('#end-time').val()) {
            var expiry_time = $('#end-time').val();
        }
        if (schedule_time) {
            var schedule_time_change = timeConvertor(schedule_time);
        }
        if (expiry_time) {
            var expiry_time_change = timeConvertor(expiry_time);
        }
        var sceduleTime = moment(schedule_input_date + ' ' + schedule_time_change, 'YYYY-MM-DDHH:mm:ss').unix();
        //console.log("sceduleTime", sceduleTime);
        var expiryTime = moment(expiry_input_date + ' ' + expiry_time_change, 'YYYY-MM-DDHH:mm:ss').unix();
        //console.log("expiryTime", expiryTime);
        // var scheduledate1 = moment.unix(sceduleTime).format("MM/DD/YYYY hh:mm:ss");
        // var currentdate1 = moment.unix(moment().add(5, 'minutes').unix()).format("MM/DD/YYYY hh:mm:ss");

        // var expirydate1 = moment.unix(expiryTime).format("MM/DD/YYYY hh:mm:ss");
        var now = new Date();
        var next = AddMinutesToDate(now, 2);//10
        var current_date_time = formatAMPM(next);

        if (schedule_time) {
            var time = schedule_time.split(':');
            var schedulePM = schedule_time.match('PM') ? true : false
            var scheduleTimeChange = time[1].slice(0, -2);
            if (schedulePM) {
                var a = schedule_input_date + ' ' + time[0] + ':' + scheduleTimeChange + ' PM';
            } else {
                var a = schedule_input_date + ' ' + time[0] + ':' + scheduleTimeChange + ' AM';
            }
        }
        if (expiry_time) {
            var expiryChange = expiry_time.split(':');
            var expiryPM = expiry_time.match('PM') ? true : false
            var expiryTimeChange = expiryChange[1].slice(0, -2);

            if (expiryPM) {
                var b = expiry_input_date + ' ' + expiryChange[0] + ':' + expiryTimeChange + ' PM';
            } else {
                var b = expiry_input_date + ' ' + expiryChange[0] + ':' + expiryTimeChange + ' AM';
            }
        }

        var aDate = new Date(a).getTime();
        var bDate = new Date(b).getTime();
        var cDate = new Date(current_date_time).getTime();
        //console.log("aDate", aDate);
        //console.log("bDate", bDate);
        //console.log("cDate", cDate);
        if (schedule_time && $('#start-date').val().length == 0) {
            showError($('#start-date'), 'This field is required');
            validateMainFlag = true;
            // Materialize.toast('Please select schedule date', 3000, 'rounded error-alert');
        } else if (expiry_time && $('#end-date').val().length == 0) {
            showError($('#end-date'), 'This field is required');
            validateMainFlag = true;
            // Materialize.toast('Please select expiry date', 3000, 'rounded error-alert');
        } else if ((expiry_input_date && expiry_input_date < today)) {
            showError($('#start-date'), 'Start date is greater than today');
            validateMainFlag = true;
            // Materialize.toast('schedule date is greater than today', 3000, 'rounded error-alert');

        } else if ((schedule_input_date && schedule_input_date < today)) {
            validateMainFlag = true;
            showError($('#end-date'), 'End date is greater than today');
            // Materialize.toast('Please select expiry date is greater than today', 3000, 'rounded error-alert');

        } else if (schedule_input_date && $('#start-time').val().length == 0) {
            validateMainFlag = true;
            showError($('#start-time'), 'This field is required');
            // Materialize.toast('Please select schedule time', 3000, 'rounded error-alert');

        } else if (aDate <= cDate) {
            validateMainFlag = true;
            // showError($('#start-date'), 'Start datetime should be greater than 10 min of current datetime');
            showError($('#start-time'), 'Start datetime should be greater than 2 min of current datetime');
            // Materialize.toast('Start datetime should be greater than 5 min of current datetime', 3000, 'rounded error-alert');

        } else if (expiry_input_date && $('#end-time').val().length == 0) {
            validateMainFlag = true;
            showError($('#end-time'), 'This field is required');
            // Materialize.toast('Please select expiry time', 3000, 'rounded error-alert');
        } else if (aDate >= bDate) {
            validateMainFlag = true;
            // showError($('#end-date'), 'End datetime is greater than Start datetime');
            showError($('#end-time'), 'End datetime should be greater than start datetime');
            // Materialize.toast('expiry datetime is greater than schedule datatime', 3000, 'rounded error-alert');
        } else if (bDate <= cDate) {
            validateMainFlag = true;
            // showError($('#end-date'), 'End datetime should be greater than 10 min of current datetime');
            showError($('#end-time'), 'End datetime should be greater than 2 min of current datetime');
            // Materialize.toast('Expiry datetime should be greater than 5 min of current datetime', 3000, 'rounded error-alert');
        }

        if (validateMainFlag || startDate || starttime || endtime || enddate) {
            return false;
        } else {
            return true;
        }
    } else {//not scheduled        
        let endtime = false;
        let enddate = false;
        let validateMainFlag = false;
        if ($('#end-date').val() == "") {
            showError($('#end-date'), `This field is required.`);
            enddate = true;
        }
        if ($('#end-time').val() == "") {
            showError($('#end-time'), `This field is required.`);
            endtime = true;
        }
        if ($('#end-date').val().length > 0 && $('#end-time').val().length > 0) {
            // var getEndDate = $('#end-date').val();
            // var getDate1 = getEndDate.split('/')[0];
            // //console.log("getDate1", getDate1);
            // var getMonth2 = getEndDate.split('/')[1];
            // //console.log("getMonth2", getMonth2);
            // var getYear3 = getEndDate.split('/')[2];
            // //console.log("getYear3", getYear3);
            // let expiry_input_date = getYear3 + '/' + getMonth2 + '/' + getDate1;
            // //console.log("expiry_input_date", expiry_input_date);

            var getEndDate = $('#end-date').val();
            var getEndDate1 = getEndDate.split('/')[0];
            //console.log("getEndDate1", getEndDate1);
            var getEndMonth2 = getEndDate.split('/')[1];
            //console.log("getEndMonth2", getEndMonth2);
            var getEndYear3 = getEndDate.split('/')[2];
            //console.log("getEndYear3", getEndYear3);

            let expiry_input_date = getEndYear3 + '/' + getEndMonth2 + '/' + getEndDate1;
            //console.log("expiry_input_date", expiry_input_date);


            var today = new Date();
            //console.log("today", today)
            var dd = today.getDate();
            //console.log("dd", dd);
            var mm = today.getMonth() + 1;
            //console.log("mm", mm);
            var yyyy = today.getFullYear();
            //console.log("yyyy", yyyy);
            if (dd < 10) {
                dd = '0' + dd;
            }
            if (mm < 10) {
                mm = '0' + mm;
            }
            today = yyyy + '/' + mm + '/' + dd;
            //console.log("todaytoday", today);
            if ($('#end-time').val()) {
                var expiry_time = $('#end-time').val();
                //console.log("expiry_time", expiry_time);
            }
            if (expiry_time) {
                var expiry_time_change = timeConvertor(expiry_time);
                //console.log("expiry_time_change", expiry_time_change);
            }
            // var expiryTime = moment(expiry_input_date + ' ' + expiry_time_change, 'DD-MM-YYYYHH:mm:ss').unix();
            // var expiryTime = moment(expiry_input_date + ' ' + expiry_time_change, 'DD-MM-YYYYHH:mm:ss').unix();
            // //console.log("expiryTime", expiryTime);
            var expiryTime = moment(expiry_input_date + ' ' + expiry_time_change, 'YYYY-MM-DDHH:mm:ss').unix();
            //console.log("expiryTime", expiryTime);

            // var currentdate1 = moment.unix(moment().add(5, 'minutes').unix()).format("MM/DD/YYYY hh:mm:ss");
            // //console.log("currentdate1", currentdate1);
            // var expirydate1 = moment.unix(expiryTime).format("MM/DD/YYYY hh:mm:ss");
            // //console.log("expirydate1", expirydate1);
            var now = new Date();
            //console.log("now", now);
            var next = AddMinutesToDate(now, 2);
            //console.log("next", next);
            var current_date_time = formatAMPM(next);
            //console.log("current_date_time", current_date_time);
            if (expiry_time) {
                var expiryChange = expiry_time.split(':');
                //console.log("expiryChange", expiryChange);
                var expiryPM = expiry_time.match('PM') ? true : false
                //console.log("expiryPM", expiryPM);
                var expiryTimeChange = expiryChange[1].slice(0, -2);
                //console.log("asd", expiryTimeChange)
                if (expiryPM) {
                    //console.log("1234");
                    var b = expiry_input_date + ' ' + expiryChange[0] + ':' + expiryTimeChange + ' PM';
                    //console.log("bbb", b)
                } else {
                    //console.log("45678");
                    var b = expiry_input_date + ' ' + expiryChange[0] + ':' + expiryTimeChange + ' AM';
                    //console.log("bbb", b)
                }
            }

            var bDate = new Date(b).getTime();;
            //console.log("bDate", bDate);
            var cDate = new Date(current_date_time).getTime();
            //console.log("cDate", cDate);
            if ((expiry_input_date < today)) {
                showError($('#end-date'), 'End date is less than today');
                validateMainFlag = true;
                // Materialize.toast('schedule date is greater than today', 3000, 'rounded error-alert');

            } else if (bDate <= cDate) {
                validateMainFlag = true;
                // showError($('#end-date'), 'End datetime should be greater than 10 min of current datetime');
                showError($('#end-time'), 'End datetime should be greater than 10 min of current datetime');
            }
        }

        if (validateMainFlag || enddate || endtime) {
            return false;
        } else {
            return true;
        }

    }
}

function digibizBusinessSettingsPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/business/digibiz_business_settings", "#digibiz-business-settings-template", "#main-content-wrapper", null);
    })
}

// function digibizAccountSettingsPage() {
//     return new Promise((resolve, reject) => {
//         fetch.replaceHtml(function () {
//             resolve();
//         }, "page/landPage/digibiz_account_settings", "#digibiz-account-settings-template", "#main-content-wrapper", null);
//     })
// }

function processGroupMemberSearch(data = null, callback) {
    console.log('data', data);
    if (data) {
        var getData = {
            data: data,
            device_id: crossplat.device.uuid
        }
    } else {
        var getData = {
            device_id: crossplat.device.uuid
        }
    }
    console.log("getData", getData)
    fetch.replaceHtml(function () {
        callback();
    }, "page/common/group_member_search_modal", "#group-member-search-template", "#group-member-search-wrapper", getData);
}

function processCreateGroupMemberSearch(data = null, callback) {
    console.log('data', data);
    if (data) {
        var getData = {
            data: data,
            device_id: crossplat.device.uuid
        }
    } else {
        var getData = {
            device_id: crossplat.device.uuid
        }
    }
    console.log("getData", getData)
    fetch.replaceHtml(function () {
        callback();
    }, "page/common/create_group_member_search_modal", "#create-group-member-search-template", "#group-member-search-wrapper", getData);
}

/**************SOCKET SEARCH LIST************** */
function processSearchedBusinessOwnerBusinessListPage(data, callback) {
    if (data.length > 0) {
        var businessList = {
            business_owner_business_list_data: data.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("businessList", businessList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/business_list_data", "#business-owner-business-data-list-template", "#business-owner-business-list-wrapper", businessList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/business_list_data", "#business-owner-business-data-list-template", "#business-owner-business-list-wrapper", null);
    }
}

function processSearchedEmployeeBusinessListPage(data, callback) {
    if (data.length > 0) {
        var businessList = {
            employee_business_list_data: data.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("businessList", businessList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/employee_business_list_data", "#employee-business-data-list-template", "#employee-business-list-wrapper", businessList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/employee_business_list_data", "#employee-business-data-list-template", "#employee-business-list-wrapper", null);
    }
}

function processSearchedCustomerBusinessListPage(data, callback) {
    if (data.length > 0) {
        var businessList = {
            customer_business_list_data: data.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("businessList", businessList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", businessList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", null);
    }
}

function processSearchedCollaboratorAddSearchListPage(data, callback) {
    if (data.length > 0) {
        var businessList = {
            business_list: data.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        if (e.hasOwnProperty('display_name') && e.display_name) {
                            e['imageLetter'] = e.display_name.charAt(0);
                        } else {
                            e['imageLetter'] = e.name.charAt(0);
                        }
                    } else {
                        if (e.hasOwnProperty('display_name') && e.display_name) {
                            e['imageLetter'] = e.display_name.charAt(0);
                        } else {
                            e['imageLetter'] = e.name.charAt(0);
                        }
                    }
                } else {
                    if (e.hasOwnProperty('display_name') && e.display_name) {
                        e['imageLetter'] = e.display_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                }
                return e;
            })
        };
        //console.log("businessList", businessList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/collaborator_add_search_list_data", "#collaborator-add-search-list-template", "#collaborator-add-search-list-wrapper", businessList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/collaborator_add_search_list_data", "#collaborator-add-search-list-template", "#collaborator-add-search-list-wrapper", null);
    }
}

function processSearchedDepartmentListPage(data, callback) {
    if (data.length > 0) {
        var getData = {
            department_list_data: data
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/department_list_data", "#department-data-list-template", "#department-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/department_list_data", "#department-data-list-template", "#department-list-wrapper", null);
    }
}

function processSearchedEmployeeCreationActivePage(data, callback) {
    if (data.length > 0) {
        var employeeList = {
            employee_creation_employee_list_data: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/active_employee_creation_list_data", "#active-employee-creation-data-list-template", "#active-employee-creation-list-wrapper", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/active_employee_creation_list_data", "#active-employee-creation-data-list-template", "#active-employee-creation-list-wrapper", null);
    }
}

function processSearchedEmployeeCreationPendingPage(data, callback) {
    if (data.length > 0) {
        var employeeList = {
            employee_creation_employee_list_data: data
            // .map((e, index) => {
            //     e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
            //     e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
            //     e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
            //     return e;
            // })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/pending_employee_creation_list_data", "#pending-employee-creation-data-list-template", "#pending-employee-creation-list-wrapper", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/pending_employee_creation_list_data", "#pending-employee-creation-data-list-template", "#pending-employee-creation-list-wrapper", null);
    }
}

function processSearchedEmployeeCreatDepartmentList(data, callback) {
    if (data.length > 0) {
        var getData = {
            department_list_data: data.map(e => {
                var getRecord = digibiz.department_list_selection.find((o) => o.id == e.id);
                if (getRecord != undefined) {
                    if (getRecord.hasOwnProperty('selected') && getRecord.selected == true) {
                        e['selected'] = true;
                    }
                }
                e['imageLetter'] = e.name.charAt(0);
                return e;
            }),
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                //check already present moderator in the modal
                // if (digibiz.alreadySelectedDepartment != undefined && digibiz.alreadySelectedDepartment.length > 0) {
                //     $.each(digibiz.alreadySelectedDepartment, function (index, department) {
                //         $(`.selected-department[data-id="${department.id}"]`).prop('checked', true);
                //         $(`.selected-department[data-id="${department.id}"]`).prop('disabled', true);
                //     })
                //     callback();
                // } else {
                callback();
                // }
                console.log('entry 2');
            }
        }, "page/employee/department_list_data", "#department-list-data-template", "#department-list-selection-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
                console.log('entry 3');
            }
        }, "page/employee/department_list_data", "#department-list-data-template", "#department-list-selection-wrapper", null);
    }
}

function processSearchedEmployeeContactListAllEmployeePage(data, callback) {
    if (data.length > 0) {
        var employeeList = {
            all_employees_list_data: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.name.first.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/all_employees_list_data", "#all-employees-list-data-template", "#all-employees-list-wrapper", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/all_employees_list_data", "#all-employees-list-data-template", "#all-employees-list-wrapper", null);
    }
}

function processSearchedEmployeeAccessListPage(data, callback) {
    if (data.length > 0) {
        var employeeList = {
            employee_access_list_data: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/employee_access_list_data", "#employee-access-data-list-template", "#employee-access-list-wrapper", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/employee_access_list_data", "#employee-access-data-list-template", "#employee-access-list-wrapper", null);
    }
}

function processSearchedEmployeeGroupEmployeeSelectionList(data, callback) {
    console.log("datadata", data)
    if (data.length > 0) {
        digibiz.searched_employee_list = removeDuplicates(digibiz.searched_employee_list.concat(data), "id");
        if (sessionStorage.getItem('group_id')) {
            $.each($(".custom-employee-group-member-wrapper"), function (index, element) {
                data = data.filter(function (e) {
                    return e.dj_unique_employee_id != $(element).attr('data-dj-unique-employee-id');
                });
            });
        } else {
            $.each($("input[name='selectedmembers[]']"), function (index, element) {
                data = data.filter(function (e) {
                    return e.dj_unique_employee_id != $(element).val();
                });
            });
        }
        var employeeList = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        // e['imageLetter'] = e.display_name.charAt(0);
                    } else {
                        if (e.hasOwnProperty('display_name') && e.display_name) {
                            e['imageLetter'] = e.display_name.charAt(0);
                        } else {
                            e['imageLetter'] = e.name.first.charAt(0);
                        }
                    }
                } else {
                    if (e.hasOwnProperty('display_name') && e.display_name) {
                        e['imageLetter'] = e.display_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                }
                return e;
            })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "layouts/template_elements/employee_list_selection", "#employee-selection-list-template", "#employee-selection-member-list-container", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "layouts/template_elements/employee_list_selection", "#employee-selection-list-template", "#employee-selection-member-list-container", null);
    }
}

function processSearchedEmployeeSelectionList(data, callback) {
    //console.log("datadata", data)
    if (data.length > 0) {
        $('.employee-select-btn-wrapper').removeClass('selected-row');
        var employeeList = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        // e['imageLetter'] = e.display_name.charAt(0);
                    } else {
                        if (e.hasOwnProperty('display_name') && e.display_name) {
                            e['imageLetter'] = e.display_name.charAt(0);
                        } else {
                            e['imageLetter'] = e.name.first.charAt(0);
                        }
                    }
                } else {
                    if (e.hasOwnProperty('display_name') && e.display_name) {
                        e['imageLetter'] = e.display_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                }
                return e;
            })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "layouts/template_elements/employee_list_selection", "#employee-selection-list-template", "#employee-selection-member-list-container", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "layouts/template_elements/employee_list_selection", "#employee-selection-list-template", "#employee-selection-member-list-container", null);
    }
}

function processSearchedEmployeeGroupStandardGroupSelectionList(data, callback) {
    //console.log("datadata", data)
    if (data.length > 0) {
        if (sessionStorage.getItem('group_id')) {
            $.each($(".custom-employee-group-member-wrapper"), function (index, element) {
                data = data.filter(function (e) {
                    return e.id != $(element).attr('data-member-group-id');
                });
            });
        } else {
            $.each($("input[name='selectedmembers[]']"), function (index, element) {
                data = data.filter(function (e) {
                    return e.id != $(element).val();
                });
            });
        }
        var groupList = {
            standardGroupList: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("groupList", groupList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "layouts/template_elements/standard_employee_group_selection", "#standard-employee-selection-list-template", "#standard-employee-selection-list-container", groupList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "layouts/template_elements/standard_employee_group_selection", "#standard-employee-selection-list-template", "#standard-employee-selection-list-container", null);
    }
}

function processSearchedEmployeeTypesListPage(data, callback) {
    if (data.length > 0) {
        var getEmployeeTypesData = {
            employee_types: data
        };
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/employee_types", "#employee-types-template", "#employee-types-list-wrapper", getEmployeeTypesData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/employee_types", "#employee-types-template", "#employee-types-list-wrapper", null);
    }
}

function processSearchedEmployeeCategoryListPage(data, callback) {
    if (data.length > 0) {
        var getEmployeeCategoryData = {
            employee_category: data
        }
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/employee_category", "#employee-category-template", "#employee-category-list-wrapper", getEmployeeCategoryData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/employee_category", "#employee-category-template", "#employee-category-list-wrapper", null);
    }
}

function processSearchedEmployeeDesignationListPage(data, callback) {
    if (data.length > 0) {
        var getEmployeeDesignationData = {
            employee_designation: data
        }
        //console.log("getEmployeeDesignationData", getEmployeeDesignationData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/employee_designation", "#employee-designation-template", "#employee-designation-list-wrapper", getEmployeeDesignationData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/employee_designation", "#employee-designation-template", "#employee-designation-list-wrapper", null);
    }
}

function processSearchedCustomerIdentifierTabPage(data, callback) {
    if (data.length > 0) {
        var customerIdentifiersList = {
            customer_identifiers_list_data: data
        };
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_identifiers_list_data", "#customer-identifiers-data-list-template", "#customer-identifiers-list-wrapper", customerIdentifiersList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_identifiers_list_data", "#customer-identifiers-data-list-template", "#customer-identifiers-list-wrapper", null);
    }
}

function processSearchedAssociateCustomerIdentifierTabPage(data, callback) {
    if (data.length > 0) {
        var customerIdentifiersList = {
            associate_customer_identifiers_list_data: data
        };
        //console.log("customerIdentifiersList", customerIdentifiersList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/associate_customers_list_data", "#associate-customer-identifiers-data-list-template", "#associate-customer-identifiers-list-wrapper", customerIdentifiersList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/associate_customers_list_data", "#associate-customer-identifiers-data-list-template", "#associate-customer-identifiers-list-wrapper", null);
    }
}

function processSearchedCustomerIdentifiersActiveCustomerCreationList(data, callback) {
    if (data.length > 0) {
        var customerIdentifiersList = {
            customer_identifiers_list_data: data,
            type: "active_customers"
        };
        //console.log("customerIdentifiersList", customerIdentifiersList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#active-customer-creation-identifiers-list-wrapper", customerIdentifiersList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#active-customer-creation-identifiers-list-wrapper", null);
    }
}

function processSearchedCustomerIdentifiersPendingCustomerCreationList(data, callback) {
    if (data.length > 0) {
        var customerIdentifiersList = {
            customer_identifiers_list_data: data,
            type: "pending_customers"
        };
        //console.log("customerIdentifiersList", customerIdentifiersList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#pending-customer-creation-identifiers-list-wrapper", customerIdentifiersList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_creation_identifiers_list_data", "#customer-creation-identifiers-data-list-template", "#pending-customer-creation-identifiers-list-wrapper", customerIdentifiersList);
    }
}

function processSearchedActiveCustomersListPage(data, callback) {
    if (data.length > 0) {
        var customerList = {
            active_customers_list_data: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            })
        };
        //console.log("customerList", customerList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/active_customers_list_data", "#active-customers-list-data-template", "#active-customers-list-wrapper", customerList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/active_customers_list_data", "#active-customers-list-data-template", "#active-customers-list-wrapper", null);
    }
}

function processSearchedPendingCustomersListPage(data, callback) {
    if (data.length > 0) {
        var customerList = {
            pending_customers_list_data: data
        };
        //console.log("customerList", customerList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/pending_customers_list_data", "#pending-customers-list-data-template", "#pending-customers-list-wrapper", customerList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/pending_customers_list_data", "#pending-customers-list-data-template", "#pending-customers-list-wrapper", null);
    }
}

function processSearchedCustomerContactsIdentifiersList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_contacts_identifiers_list_data: data,
            list_for: "customer_contacts_module"
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_contacts_identifiers_list_data", "#customer-contacts-identifiers-list-data-template", "#customer-contacts-identifiers-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_contacts_identifiers_list_data", "#customer-contacts-identifiers-list-data-template", "#customer-contacts-identifiers-list-wrapper", null);
    }
}

function processSearchedCustomerContactsItemsList(data, callback) {
    if (data.length > 0) {
        var getData = {
            contacts_items_list_data: data
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/contacts_items_list_data", "#contact-items-list-data-template", "#contacts-items-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/contacts_items_list_data", "#contact-items-list-data-template", "#contacts-items-list-wrapper", getData);
    }
}

function processSearchedCustomerContactList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_contact_list_data: data,
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_contact_list_data", "#customer-contact-list-data-template", "#customer-contact-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_contact_list_data", "#customer-contact-list-data-template", "#customer-contact-list-wrapper", null);
    }
}

function processSearchedStandardEmployeeGroupsList(data, callback) {
    if (data.length > 0) {
        var standardEmployeesGroupsList = {
            standard_employees_groups_list_data: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                        // getImageUrl(avtarUrl).then((res) => {
                        // }).catch((err) => {
                        //     e['imageLetter'] = e.name.charAt(0);
                        //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.charAt(0));
                        //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                        // })
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("standardEmployeesGroupsList", standardEmployeesGroupsList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/standard_employees_groups_list_data", "#standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper", standardEmployeesGroupsList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/standard_employees_groups_list_data", "#standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper", null);
    }
}

function processSearchedCustomEmployeeGroupsList(data, callback) {
    if (data.length > 0) {
        var customEmployeesGroupsList = {
            custom_employees_groups_list_data: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                        // getImageUrl(avtarUrl).then((res) => {
                        // }).catch((err) => {
                        //     e['imageLetter'] = e.name.charAt(0);
                        //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.charAt(0));
                        //     $(`.employee-group-wrapper[data-group-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                        // })
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("customEmployeesGroupsList", customEmployeesGroupsList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/custom_employees_groups_list_data", "#custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper", customEmployeesGroupsList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/custom_employees_groups_list_data", "#custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper", null);
    }
}

function processSearchedEmployeeAccessList(data, callback) {
    if (data.length > 0) {
        var employeeList = {
            employee_access_list_data: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                return e;
            })
        };
        //console.log("employeeList", employeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/employee_access_list_data", "#employee-access-data-list-template", "#employee-access-list-wrapper", employeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/employee/employee_access_list_data", "#employee-access-data-list-template", "#employee-access-list-wrapper", null);
    }
}

function processSearchedStandardCustomerGroupsIdentifiersList(data, callback) {
    if (data.length > 0) {
        var getData = {
            standard_customer_groups_identifiers_list_data: data,
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", null);
    }
}

function processSearchedCustomerCustomGroupList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_custom_groups_list_data: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();

            }
        }, "page/customer/customer_custom_groups_list_data", "#customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();

            }
        }, "page/customer/customer_custom_groups_list_data", "#customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper", null);
    }
}

function processSearchedCustomerGroupList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_groups_list_data: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_groups_list_data", "#customer-groups-list-data-template", "#customer-groups-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_groups_list_data", "#customer-groups-list-data-template", "#customer-groups-list-wrapper", null);
    }
}

function processSearchedCustomerAccessIdentifiersList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_access_identifiers_list_data: data,
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_access_identifier_list_data", "#customer-access-identifier-list-data-template", "#customer-access-identifier-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_access_identifier_list_data", "#customer-access-identifier-list-data-template", "#customer-access-identifier-list-wrapper", null);
    }
}

function processSearchedCustomerAccessIdentifierItemsList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_access_identifier_items_list_data: data
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_access_identifier_items_data", "#customer-access-identifier-items-list-data-template", "#customer-access-identifier-items-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/customer/customer_access_identifier_items_data", "#customer-access-identifier-items-list-data-template", "#customer-access-identifier-items-list-wrapper", null);
    }
}

function processSearchedCommunicationGroupsList(data, callback) {
    if (data.length > 0) {
        var communicationGroupsList = {
            communication_group_list_data: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("communicationGroupsList", communicationGroupsList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", communicationGroupsList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", null);
    }
}

function processSearchedActiveCollaboratorContactList(data, callback) {
    if (data.length > 0) {
        var getData = {
            collaborator_contact_list_data: data.map(e => {
                //console.log("e", e);
                if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                    //console.log("yess display picture");
                    if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                        //console.log("yess asset_id");
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                        // var avtarUrl = `${api.get_business_thumbnail}?id=${e.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                        e.business_display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.business_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.business_name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
                return e;
            })
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/collaborator_contact_list_data", "#collaborator-contact-list-data-template", "#collaborator-contact-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/collaborator_contact_list_data", "#collaborator-contact-list-data-template", "#collaborator-contact-list-wrapper", null);
    }
}

function processSearchedPendingCollaboratorContactList(data, callback) {
    if (data.length > 0) {
        var getData = {
            pending_collaborator_contact_list_data: digibiz.pending_collaborator_contact_list.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.contact.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        // var avtarUrl = `${api.get_business_thumbnail}?id=${e.contact.business_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.business_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.business_name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
                if (typeof (e.createdDate) == "number") {
                    e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
                }
                if (typeof (e.updatedDate) == "number") {
                    e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
                }
                if (typeof (e.expiryDate) == "number") {
                    e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
                }
                return e;
            })
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/pending_collaborator_contact_list_data", "#pending-collaborator-contact-list-data-template", "#pending-collaborator-contact-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/pending_collaborator_contact_list_data", "#pending-collaborator-contact-list-data-template", "#pending-collaborator-contact-list-wrapper", null);
    }
}

function processSearchedCollaboratorGroupsList(data, callback) {
    if (data.length > 0) {
        var collaboratorGroupsList = {
            collaborator_groups_list: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("collaboratorGroupsList", collaboratorGroupsList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", collaboratorGroupsList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", null);
    }
}

function processSearchedOtherCollaboratorGroupsList(data, callback) {
    if (data.length > 0) {
        var collaboratorGroupsList = {
            collaborator_groups_list: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                        var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                        e.group_image['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                return e;
            })
        };
        //console.log("collaboratorGroupsList", collaboratorGroupsList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#other-collaborator-groups-list-list-wrapper", collaboratorGroupsList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#other-collaborator-groups-list-list-wrapper", null);
    }
}

function processSearchedLogsList(data, callback) {
    console.log('qwe', data);
    if (data && data.length > 0) {
        var logsList = {
            log_list_data: data.map(e => {
                if (typeof (e.action.date) == "number") {
                    e['action']['date'] = moment.unix(e.action.date).format('MMM D YYYY hh:mm:ss A');
                }
                return e;
            })
        };

        //console.log("logsList", logsList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                removeLoader();
                callback();
            }
        }, "page/common/digibiz_logs_data", "#digibiz-logs-list-data-template", "#digibiz-logs-list-wrapper", logsList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                removeLoader();
                callback();
            }
        }, "page/common/digibiz_logs_data", "#digibiz-logs-list-data-template", "#digibiz-logs-list-wrapper", null);
    }
}

function processSearchedEmployeeStandardGroupNewModeratorAddSearchResult(data, callback) {
    if (data.length > 0) {
        var getData = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((o) => o.dj_unique_employee_id == e.dj_unique_employee_id);
                if (getRecord != undefined) {
                    if (getRecord.hasOwnProperty('selected') && getRecord.selected == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            }),
            from: "direct"//standard
        };
        fetch.replaceHtml(function () {
            //check already present moderator in the modal
            // if (digibiz.alreadySelected.length > 0) {
            //     $.each(digibiz.alreadySelected, function (index, moderator) {
            //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
            //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //         } else {
            //             $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //         }
            //     })
            // }
            callback();
        }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            //check already present moderator in the modal
            // if (digibiz.alreadySelected.length > 0) {
            //     $.each(digibiz.alreadySelected, function (index, moderator) {
            //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
            //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //         } else {
            //             $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //         }
            //     })
            // }
            callback();
        }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper', null);
    }
}

function processSearchedEmployeeStandardGroupMember(data, callback) {
    if (data) {
        if($('#group-member-search-main-container').hasClass('employee-member-serach')) {
            var responses = data.filter(e => e.type == "employee");
        } else if($('#group-member-search-main-container').hasClass('customer-member-serach')) {
            var responses = data.filter(e => e.type == "customer");
        } else {
            var responses = data;
        }
        var getData = {
            data: responses,
            device_id: crossplat.device.uuid
        }
        //console.log("getData", getData)
        fetch.replaceHtml(function () {
            callback();
        }, "page/common/group_member_search_modal", "#group-member-search-template", "#group-member-search-wrapper", getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/common/group_member_search_modal", "#group-member-search-template", "#group-member-search-wrapper", null);
    }
}

function processSearchedBusinessNotificationsList(data, callback) {
    if (data.length > 0) {
        var notificationList = {
            business_notification_list_data: data.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.business_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.business_name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
                //console.log("check", typeof (e.expiryDate))
                if (typeof (e.expiryDate) == "number") {
                    e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
                }
                return e;
            })
        };
        //console.log("notificationList", notificationList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/business_notifications_data", "#business-notifications-data-list-template", "#business-notifications-list-wrapper", notificationList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/business/business_notifications_data", "#business-notifications-data-list-template", "#business-notifications-list-wrapper", null);
    }
}

function processSearchedCustomerGroupContactsList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_group_contact_list_data: data
        };
        fetch.replaceHtml(function () {
            //remove already present customers in the group
            var getMembers = [];
            if ($('.customer-group-member-wrapper').length > 0) {
                $.each($('.customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        // type: "new_member"
                    });
                });
            }
            if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
                $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-customer-id'),
                        // type: "old_member"
                    });
                });
            }
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    // if (element.type == "new_member") {
                    $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                    // } else if (element.type == "old_member") {
                    //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                    // }
                })
            }
            callback();

        }, "page/customer/group_contact_list_data", "#customer-group-contact-list-data-template", '#customer-group-contacts-items-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            //remove already present customers in the group
            var getMembers = [];
            if ($('.customer-group-member-wrapper').length > 0) {
                $.each($('.customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        // type: "new_member"
                    });
                });
            }
            if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
                $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-customer-id'),
                        // type: "old_member"
                    });
                });
            }
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    // if (element.type == "new_member") {
                    $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                    // } else if (element.type == "old_member") {
                    //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                    // }
                })
            }
            callback();

        }, "page/customer/group_contact_list_data", "#customer-group-contact-list-data-template", '#customer-group-contacts-items-list-wrapper', null);
    }
}

function processSearchedCustomerGroupCustomGroupList(data, callback) {
    if (data.length > 0) {
        var getData = {
            customer_group_custom_groups_list_data: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.customerGroupCustomGroupsList.findIndex((o) => o.id == e.id);
                if (getIndex > -1) {
                    var getValue = digibiz.customerGroupCustomGroupsList[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            })
        };
        fetch.replaceHtml(function () {
            //remove already present customers in the group
            var getMembers = [];
            if ($('.customer-group-member-wrapper').length > 0) {
                $.each($('.customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        type: "new_member"
                    });
                });
            }
            if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
                $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-group-id'),
                        type: "old_member"
                    });
                });
            }
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    // if ($('.customer-group-custom-group-wrapper').length == 0) {
                    //     //console.log("empty")
                    //     $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
                    // } else {
                    //     //console.log("not empty")
                    // }

                    // if (element.type == "new_member") {
                    //     $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                    // } else if (element.type == "old_member") {
                    //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                    // }
                    $('#customer-group-custom-groups-list-wrapper').find(`.customer-group-custom-group-wrapper[data-id="${element.id}"]`).remove();
                })
                if ($('.customer-group-custom-group-wrapper').length > 0) {
                    //console.log("not empty")
                } else {
                    //console.log("empty")
                    $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
            }
            callback();
        }, "page/customer/customer_group_custom_group_list_data", "#customer-group-custom-groups-list-template", '#customer-group-custom-groups-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            //remove already present customers in the group
            var getMembers = [];
            if ($('.customer-group-member-wrapper').length > 0) {
                $.each($('.customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        type: "new_member"
                    });
                });
            }
            if ($('#customer-group-members-list').find('.custom-customer-group-member-wrapper').length > 0) {
                $.each($('#customer-group-members-list .custom-customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-group-id'),
                        type: "old_member"
                    });
                });
            }
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    // if ($('.customer-group-custom-group-wrapper').length == 0) {
                    //     //console.log("empty")
                    //     $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
                    // } else {
                    //     //console.log("not empty")
                    // }

                    // if (element.type == "new_member") {
                    //     $(`.customer-groups-contact-wrapper[data-id="${element.id}"]`).remove();
                    // } else if (element.type == "old_member") {
                    //     $('#communication-group-customer-members-list').find(`.communication-group-member-wrapper[data-customer-id="${element.id}"]`).remove();
                    // }
                    $('#customer-group-custom-groups-list-wrapper').find(`.customer-group-custom-group-wrapper[data-id="${element.id}"]`).remove();
                })
                if ($('.customer-group-custom-group-wrapper').length > 0) {
                    //console.log("not empty")
                } else {
                    //console.log("empty")
                    $('.customer-group-custom-groups-list-contentbox').append(`<div class="no_data">No data found</div>`);
                }
            }
            callback();
        }, "page/customer/customer_group_custom_group_list_data", "#customer-group-custom-groups-list-template", '#customer-group-custom-groups-list-wrapper', null);
    }
}

function processGroupBusinessMemberSearch(data=null, callback) {
    digibiz.collaborator_business_members_search = removeDuplicates(digibiz.collaborator_business_members_search.concat(data), "id");
   if(data) {
    var getData = {
        businessList: digibiz.collaborator_business_members_search.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    // //console.log("1234");
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.member.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            return e;
        })
    };
} else {
    var getData = {};
}
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/collaborator_business_members_search_list", "#collaborator-contact-selection-list-template", "#group-member-search-wrapper", getData);
}

function processSearchedGroupBusinessMemberSearch(data, callback) {
    if (data.length > 0) {
        var getData = {
            businessList: data.map(e => {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        // //console.log("1234");
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.member.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.business_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.business_name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
                return e;
            })
        };
        //console.log("getData", getData);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/collaborator_business_members_search_list", "#collaborator-contact-selection-list-template", "#group-member-search-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/collaborator/collaborator_business_members_search_list", "#collaborator-contact-selection-list-template", "#group-member-search-wrapper", null);
    }
}

function showEmployeesCollaboratorGroupBusinessMembers(data, callback) {
    digibiz.show_employees_collaborator_group = removeDuplicates(digibiz.show_employees_collaborator_group.concat(data), "id");
    var getBusinessId = $('#modal-collaborator-group-business-members').attr('data-business-id');
    if (getBusinessId == sessionStorage.getItem('business_id')) {
        var EmployeeList = {
            EmployeeList: digibiz.show_employees_collaborator_group.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                e.can_edit = "yes"
                return e;
            }),
            page_for: "listing_employees"
        }
    } else {
        var EmployeeList = {
            EmployeeList: digibiz.show_employees_collaborator_group.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
                return e;
            }),
            page_for: "listing_employees"
        }
    }
    //console.log("EmployeeList", EmployeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', '#collaborator-group-show-employees-business-member-list-wrapper', EmployeeList);
}

function processSearchedShowEmployeesCollaboratorGroupBusinessMembers(data, callback) {
    if (data.length > 0) {
        var getBusinessId = $('#modal-collaborator-group-business-members').attr('data-business-id');
        if (getBusinessId == sessionStorage.getItem('business_id')) {
            var EmployeeList = {
                EmployeeList: data.map(e => {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                    e.can_edit = "yes"
                    return e;
                }),
                page_for: "listing_employees"
            }
        } else {
            var EmployeeList = {
                EmployeeList: data.map(e => {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                    return e;
                }),
                page_for: "listing_employees"
            }
        }
        //console.log("EmployeeList", EmployeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', '#collaborator-group-show-employees-business-member-list-wrapper', EmployeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, 'page/collaborator/moderator_selection_list', '#moderator-selection-list-template', '#collaborator-group-show-employees-business-member-list-wrapper', null);
    }
}

function collaboratorGroupOwnerBusinessEmployeeSelection(data, callback) {
    digibiz.collaborator_group_owner_employee_members = removeDuplicates(digibiz.collaborator_group_owner_employee_members.concat(data), "id");
    var EmployeeList = {
        EmployeeList: digibiz.collaborator_group_owner_employee_members.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    //console.log("1234");
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    }
    //console.log("EmployeeList", EmployeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, 'page/common/employee_list_selection', '#employee-selection-list-template', '#collaborator-group-owner-business-employees-selection-list-wrapper', EmployeeList);
}

function processSearchedCollaboratorGroupOwnerBusinessEmployeeSelection(data, callback) {
    if (data.length > 0) {
        var EmployeeList = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        //console.log("1234");
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.collaborator_group_owner_employee_members.findIndex((o) => o.dj_unique_employee_id == e.dj_unique_employee_id);
                if (getIndex > -1) {
                    var getValue = digibiz.collaborator_group_owner_employee_members[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            })
        }
        //console.log("EmployeeList", EmployeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, 'page/common/employee_list_selection', '#employee-selection-list-template', '#collaborator-group-owner-business-employees-selection-list-wrapper', EmployeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, 'page/common/employee_list_selection', '#employee-selection-list-template', '#collaborator-group-owner-business-employees-selection-list-wrapper', null);
    }
}

function processSearchedCommunicationGroupCreateEmployeeGroupsList(data, callback) {
    if (data.length > 0) {
        var getData = {
            groupList: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.communicationCreateEmployeeGroupsList.findIndex((o) => o.id == e.id);
                if (getIndex > -1) {
                    var getValue = digibiz.communicationCreateEmployeeGroupsList[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            }),
            page_for: "create_communication_group"
        };
        fetch.replaceHtml(function () {
            var getMembers = [];
            if ($('.communication-group-employee-group-member-wrapper').length > 0) {
                $.each($('.communication-group-employee-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        type: "new_member"
                    });
                });
            }
            if ($('#communication-group-employee-members-list').find('.communication-group-member-wrapper').length > 0) {
                $.each($('#communication-group-employee-members-list .communication-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-group-id'),
                        type: "old_member"
                    });
                });
            }
            //remove members from the modal
            //console.log("getMembers", getMembers)
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    if (element.type == "new_member") {
                        $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                    } else if (element.type == "old_member") {
                        $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                    }
                })
            }
            if ($('#modal-communication-group-employee-group-selection').find(`.group-selection-wrapper`).length > 0) {
                //console.log("empty modal")
            } else {
                $('.employee-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
            }
            callback();
        }, "page/communication/employee_group_selection", "#employee-group-list-selection-template", '#communication-group-create-employee-group-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/employee_group_selection", "#employee-group-list-selection-template", '#communication-group-create-employee-group-list-wrapper', null);
    }
}

function processSearchedCommunicationGroupCreateCollaboratorGroupsList(data, callback) {
    if (data.length > 0) {
        var getData = {
            groupList: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.communicationCreateCollaboratorGroupsList.findIndex((o) => o.id == e.id);
                if (getIndex > -1) {
                    var getValue = digibiz.communicationCreateCollaboratorGroupsList[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            }),
        };
        fetch.replaceHtml(function () {
            var getMembers = [];
            if ($('.communication-group-collaborator-group-member-wrapper').length > 0) {
                $.each($('.communication-group-collaborator-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        type: "new_member"
                    });
                });
            }
            if ($('#communication-group-collaborator-members-list').find('.communication-group-member-wrapper').length > 0) {
                $.each($('#communication-group-collaborator-members-list .communication-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-group-id'),
                        type: "old_member"
                    });
                });
            }
            //remove members from the modal
            //console.log("getMembers", getMembers)
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    if (element.type == "new_member") {
                        $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                    } else if (element.type == "old_member") {
                        $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                    }
                })
            }
            if ($('#modal-communication-group-collaborator-group-selection').find(`.group-selection-wrapper`).length > 0) {
                //console.log("empty modal")
            } else {
                $('.collaborator-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
            }
            callback();
        }, "page/communication/collaborator_group_selection", "#collaborator-group-list-selection-template", '#communication-group-create-collaborator-group-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/collaborator_group_selection", "#collaborator-group-list-selection-template", '#communication-group-create-collaborator-group-list-wrapper', null);
    }
}

function processSearchedCommunicationGroupCreateCustomerGroupsList(data, callback) {
    if (data.length > 0) {
        var getData = {
            groupList: data.map(e => {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thubnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.communicationCreateCustomersGroupsList.findIndex((o) => o.id == e.id);
                if (getIndex > -1) {
                    var getValue = digibiz.communicationCreateCustomersGroupsList[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            }),
            page_for: "create_communication_group"
        };
        fetch.replaceHtml(function () {
            var getMembers = [];
            if ($('.communication-group-customer-group-member-wrapper').length > 0) {
                $.each($('.communication-group-customer-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-id'),
                        type: "new_member"
                    });
                });
            }
            if ($('#communication-group-customer-members-list').find('.communication-group-member-wrapper').length > 0) {
                $.each($('#communication-group-customer-members-list .communication-group-member-wrapper'), function (index, element) {
                    getMembers.push({
                        id: $(element).attr('data-group-id'),
                        type: "old_member"
                    });
                });
            }
            //remove members feom the modal
            if (getMembers.length > 0) {
                $.each(getMembers, function (index, element) {
                    if (element.type == "new_member") {
                        $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                    } else if (element.type == "old_member") {
                        $(`.group-selection-wrapper[data-group-id="${element.id}"]`).remove();
                    }
                })
            }
            if ($('#modal-communication-group-customer-group-selection').find(`.group-selection-wrapper`).length > 0) {
                //console.log("empty modal")
            } else {
                $('.customer-group-list-selection-main-container').append('<div class="no-data">No Data found</div>');
            }
            callback();
        }, "page/communication/customer_group_selection", "#customer-group-list-selection-template", '#communication-group-create-customer-group-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/customer_group_selection", "#customer-group-list-selection-template", '#communication-group-create-customer-group-list-wrapper', null);
    }
}

function processCommunicationGroupCreateEmployeeSelectionList(data, callback) {
    digibiz.communicationGroupEmployeeSelectionList = removeDuplicates(digibiz.communicationGroupEmployeeSelectionList.concat(data), "id");
    var EmployeeList = {
        EmployeeList: digibiz.communicationGroupEmployeeSelectionList.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "direct"
    }
    //console.log("EmployeeList", EmployeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (digibiz.alreadySelected.length > 0) {
                // $.each(digibiz.alreadySelected, function (index, element) {
                //     if (element.type == "new_member") {
                //         $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                //     } else if (element.type == "old_member") {
                //         // $('#communication-group-employee-members-list').find(`.communication-group-member-wrapper[data-employee-id="${element.id}"]`).remove();
                //         $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                //     }
                // })
                if ($('#modal-communication-group-employees-selection').find(`.contact-profile-container`).length > 0) {
                    //console.log("empty modal")
                } else {
                    $('.employee-selection-member-list').append('<div class="no-data">No Employees found</div>');
                }
            }
            callback();
        }
    }, 'page/communication/employee_selection_list', '#employee-selection-list-template', '#communication-group-employees-selection-list-wrapper', EmployeeList);
}

function processSearchedCommunicationGroupCreateEmployeeSelectionList(data, callback) {
    if (data.length > 0) {
        var EmployeeList = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.communicationGroupEmployeeSelectionList.findIndex((o) => o.id == e.id);
                if (getIndex > -1) {
                    var getValue = digibiz.communicationGroupEmployeeSelectionList[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            }),
            from: "direct"
        }
        //console.log("EmployeeList", EmployeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                if (digibiz.alreadySelected.length > 0) {
                    $.each(digibiz.alreadySelected, function (index, element) {
                        if (element.type == "new_member") {
                            $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                        } else if (element.type == "old_member") {
                            // $('#communication-group-employee-members-list').find(`.communication-group-member-wrapper[data-employee-id="${element.id}"]`).remove();
                            $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                        }
                    })
                    if ($('#modal-communication-group-employees-selection').find(`.contact-profile-container`).length > 0) {
                        //console.log("empty modal")
                    } else {
                        $('.employee-selection-member-list').append('<div class="no-data">No Employees found</div>');
                    }
                }
                callback();
            }
        }, 'page/communication/employee_selection_list', '#employee-selection-list-template', '#communication-group-employees-selection-list-wrapper', EmployeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, 'page/communication/employee_selection_list', '#employee-selection-list-template', '#communication-group-employees-selection-list-wrapper', null);
    }
}

function listenForCommunicationGroupCreateEmployeeSelectionListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_only_active",
                count: 20,
                offset: digibiz.communicationGroupEmployeeSelectionList.length
            }
            employeeList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessCommunicationGroupCreateEmployeeSelectionList(response, function () {
                        listenForCommunicationGroupCreateEmployeeSelectionListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, 'page/communication/scroll_employee_selection_list', '#scroll-employee-selection-list-template', '#communication-group-employees-selection-list-wrapper', null);

                })

        }
    });
}


function scrollProcessCommunicationGroupCreateEmployeeSelectionList(data, callback) {
    digibiz.communicationGroupEmployeeSelectionList = removeDuplicates(digibiz.communicationGroupEmployeeSelectionList.concat(data), "id");
    var EmployeeList = {
        EmployeeList: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "direct"
    }
    //console.log("EmployeeList", EmployeeList);
    fetch.appendHtml(function (err) {
        if (!err) {
            if (digibiz.alreadySelected.length > 0) {
                // $.each(digibiz.alreadySelected, function (index, element) {
                //     if (element.type == "new_member") {
                //         $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                //     } else if (element.type == "old_member") {
                //         // $('#communication-group-employee-members-list').find(`.communication-group-member-wrapper[data-employee-id="${element.id}"]`).remove();
                //         $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                //     }
                // })
                if ($('#modal-communication-group-employees-selection').find(`.contact-profile-container`).length > 0) {
                    //console.log("empty modal")
                } else {
                    $('.employee-selection-member-list').append('<div class="no-data">No Employees found</div>');
                }
            }
            callback();
        }
    }, 'page/communication/scroll_employee_selection_list', '#scroll-employee-selection-list-template', '#communication-group-employees-selection-list-wrapper', EmployeeList);
}

function processSearchedCommunicationGroupContactListCustomerList(data, callback) {
    if (data.length > 0) {
        var getData = {
            communication_group_identifier_based_customer_contact_list_data: data
        };
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/communication_group_contact_list_customer_list", "#communication-group-identifier-based-customer-contact-list-data-template", '#communication-group-contacts-items-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/communication_group_contact_list_customer_list", "#communication-group-identifier-based-customer-contact-list-data-template", '#communication-group-contacts-items-list-wrapper', null);
    }
}

function processSearchedCommunicationGroupActivateEmployeeGroupEmployeeList(data, groupData, callback) {
    //console.log("data", data)
    //console.log("groupData", groupData)
    if (data.length > 0) {
        // if (digibiz.alreadySelected.length > 0) {
        //     $.each(digibiz.alreadySelected, function (index, moderator) {
        //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
        //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
        //         } else {
        //             //check in the global array
        //             var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.dj_unique_employee_id == moderator.id);
        //             if (getIndex > -1) {
        //                 digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex]['selected'] = true;
        //             }
        //         }
        //     })
        // }
        //put it in modal
        if (groupData.group_type == "custom" && groupData.custom_group_from == "employee_list") {
            var getData = {
                EmployeeList: data.map(e => {
                    if (e.member_data.hasOwnProperty('identity_picture') && e.member_data.identity_picture) {
                        if (e.member_data.identity_picture.hasOwnProperty('thumbnail') && e.member_data.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member_data.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.member_data.identity_picture.thumbnail}`;
                            e.member_data.identity_picture['avtarUrl'] = avtarUrl;
                            e['member_data']['imageLetter'] = e.member_data.name.first.charAt(0);
                        } else {
                            e['member_data']['imageLetter'] = e.member_data.name.first.charAt(0);
                        }
                    } else {
                        e['member_data']['imageLetter'] = e.member_data.name.first.charAt(0);
                    }
                    //automatic checked while searching
                    var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((o) => o.member.dj_unique_employee_id == e.id);
                    if (getIndex > -1) {
                        var getValue = digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].selected;
                        if (getValue == true || getValue == "true") {
                            e['selected'] = true;
                        }
                    }
                    return e;
                }),
                from: "employee_list_search"
            };
        } else if (groupData.group_type == "custom" && groupData.custom_group_from == "standard_group") {
            var getData = {
                EmployeeList: data.map(e => {
                    //console.log("e", e);
                    if (e.hasOwnProperty('group_members') && e.group_members) {
                        $.each(e.group_members, function (index, member) {
                            // //console.log("member", member);
                            if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                                if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                    member.identity_picture['avtarUrl'] = avtarUrl;
                                    member['imageLetter'] = member.name.first.charAt(0);
                                } else {
                                    member['imageLetter'] = member.name.first.charAt(0);
                                }
                            } else {
                                member['imageLetter'] = member.name.first.charAt(0);
                            }
                        })
                    }
                    return e;
                }),
                from: "standard_group"
            };
        }
        //console.log("getData", getData);
        fetch.replaceHtml(function () {
            //check already present moderator in the modal
            // if (digibiz.alreadySelected.length > 0) {
            //     $.each(digibiz.alreadySelected, function (index, moderator) {
            //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
            //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //         } else {
            //             $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //         }
            //     })
            // }
            callback();
        }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper', null);
    }
}

function processSearchedCommunicationGroupActivate(data, groupType, callback) {
    //console.log("processSearchedCommunicationGroupActivate", data, groupType)
    if (data.length > 0) {
        if (groupType == "contact_list") {
            var getData = {
                membersList: data.map(e => {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                            if (e.member.type == "employee") {
                                var avtarUrl = `${api.get_employee_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.member_name.first.charAt(0);
                            } else if (e.member.type == "customer" && e.member.customer_type == "customer") {
                                var avtarUrl = `${api.get_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.member_name.first.charAt(0);
                            } else if (e.member.type == "customer" && e.member.customer_type == "associate_customer") {
                                var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${e.member.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                                e.identity_picture['avtarUrl'] = avtarUrl;
                                e['imageLetter'] = e.member_name.first.charAt(0);
                            }
                        } else {
                            e['imageLetter'] = e.member_name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                    //automatic checked while searching
                    var getIndex = digibiz.communicationGroupActivate.findIndex((o) => o.member.id == e.member.id);
                    if (getIndex > -1) {
                        var getValue = digibiz.communicationGroupActivate[getIndex].selected;
                        if (getValue == true || getValue == "true") {
                            e['selected'] = true;
                        }
                    }
                    return e;
                }),
                page_for: "contact_list_moderator"
            };
        } else if (groupType == "group_list") {
            var getData = {
                membersList: data.map(e => {
                    if (e.hasOwnProperty('group_members') && e.group_members) {
                        $.each(e.group_members, function (index, member) {
                            // //console.log("member", member);
                            if (member.hasOwnProperty('identity_picture') && member.identity_picture) {
                                if (member.identity_picture.hasOwnProperty('thumbnail') && member.identity_picture.thumbnail) {
                                    var avtarUrl = `${api.get_employee_identity_picture}?id=${member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${member.identity_picture.thumbnail}`;
                                    member.identity_picture['avtarUrl'] = avtarUrl;
                                    member['imageLetter'] = member.name.first.charAt(0);
                                } else {
                                    member['imageLetter'] = member.name.first.charAt(0);
                                }
                            } else {
                                member['imageLetter'] = member.name.first.charAt(0);
                            }
                        })
                    }
                    return e;
                }),
                page_for: "standard_group"
            };
        }
        //console.log("getData", getData);
        fetch.replaceHtml(function () {
            //check already present moderator in the modal
            // if (digibiz.alreadySelected.length > 0) {
            //     $.each(digibiz.alreadySelected, function (index, moderator) {
            //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
            //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
            //         } else {
            //             // $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
            //         }
            //     })
            // }
            callback();
        }, "page/communication/moderator_selection_list", "#moderator-selection-list-template", '#group-moderator-search-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            //check already present moderator in the modal
            // if (digibiz.alreadySelected.length > 0) {
            //     $.each(digibiz.alreadySelected, function (index, moderator) {
            //         if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
            //             $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
            //         } else {
            //             $(`.communication-group-moderator-select-btn[data-id="${moderator.id}"]`).prop('checked', true);
            //         }
            //     })
            // }
            callback();
        }, "page/communication/moderator_selection_list", "#moderator-selection-list-template", '#group-moderator-search-wrapper', null);
    }
}

function processSearchedCommunicationGroupCreateEmployeeGroupEmployeeList(data, callback) {
    //console.log("data", data)
    if (data.length > 0) {
        var getData = {
            EmployeeList: data.map(e => {
                //console.log("e", e)
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                //automatic checked while searching
                if (e.group_id == $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id')) {
                    var getIndex = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex((o) => o.dj_unique_employee_id == e.dj_unique_employee_id);
                    if (getIndex > -1) {
                        var getValue = digibiz.communicationCreateEmployeeGroupEmployeeList[getIndex].selected;
                        if (getValue == true || getValue == "true") {
                            e['selected'] = true;
                            var getDisabledValue = digibiz.communicationCreateEmployeeGroupEmployeeList[getIndex].disabled;
                            if (getDisabledValue == true || getDisabledValue == "true") {
                                e['disabled'] = true;
                            }
                        }
                    }
                }
                return e;
            }),
            from: "group",
            type: "commuication_create_group_list"
        };
        //console.log("getData11", getData)
        fetch.replaceHtml(function () {
            //check already present moderator in the modal
            //console.log("0987", digibiz.alreadySelected)
            // if (digibiz.alreadySelected.length > 0) {
            //     $.each(digibiz.alreadySelected, function (index, moderator) {
            //         if (moderator.type == "employee") {
            //             // $(`#modal-communication-group-create-employee-group-employee-list-selection[data-group-id="${moderator.group_id}"]`).find(`.communication-group-create-employee-moderator-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
            //             if (moderator.hasOwnProperty('moderator_type') && moderator.moderator_type == "fixed") {
            //                 $(`#modal-communication-group-create-employee-group-employee-list-selection[data-group-id="${moderator.group_id}"]`).find(`.communication-group-create-employee-moderator-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('disabled', true);
            //             }
            //         }
            //     })
            // }
            callback();
        }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-create-employee-group-employee-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/employee_selection_list", "#employee-selection-list-template", '#communication-group-create-employee-group-employee-list-wrapper', null);
    }
}

function processSearchedCommunicationGroupCreateCustomerGroupCustomerList(data, callback) {
    //console.log("data", data)
    if (data.length > 0) {
        //put it in modal
        var getData = {
            customerList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        if (e.type == "customer") {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.name.first.charAt(0);
                        } else if (e.type == "associate_customer") {
                            var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                //automatic checked while searching
                if (e.group_id == $('#modal-communication-group-create-employee-group-employee-list-selection').attr('data-group-id')) {
                    var getIndex = digibiz.communicationCreateEmployeeGroupEmployeeList.findIndex((o) => o.id == e.id);
                    if (getIndex > -1) {
                        var getValue = digibiz.communicationCreateEmployeeGroupEmployeeList[getIndex].selected;
                        if (getValue == true || getValue == "true") {
                            e['selected'] = true;
                        }
                    }
                }
                return e;
            }),
        };
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/customer_selection_list", "#customer-selection-list-template", '#communication-group-create-employee-group-employee-list-wrapper', getData);
    } else {
        fetch.replaceHtml(function () {
            callback();
        }, "page/communication/customer_selection_list", "#customer-selection-list-template", '#communication-group-create-employee-group-employee-list-wrapper', null);

    }
}


function acceptNotification() {
    var getNotificationsId = sessionStorage.getItem('notify_id');
    var getOwnerId = sessionStorage.getItem('notify_owner_id');
    var getBusinessId = sessionStorage.getItem('notify_business_id');
    var getType = sessionStorage.getItem('notify_type');
    //check whether the role is active in the accounts collection
    var requestParameter = {
        device_id: crossplat.device.uuid,
        // uuid: sessionStorage.getItem('uuid')
        user_id: sessionStorage.getItem("user_id"),
    }
    accountGet(requestParameter)
        .then((accountResponse) => {
            if (getType == "employee") {
                if (accountResponse.roles.employee == "active") {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        notification_id: getNotificationsId,
                        action: 'accepted'
                    }
                    notificationChangeStatus(reqParam)
                        .then((response) => {
                            //console.log("notificationChangeStatus response", response);
                            if (response.contact.status.status == "accepted") {
                                var requestParams = {
                                    device_id: crossplat.device.uuid,
                                    adder_user_id: getOwnerId,
                                    business_id: getBusinessId,
                                    notification_id: getNotificationsId
                                }
                                employeeAdd(requestParams)
                                    .then((response) => {
                                        // sessionStorage.removeItem('role');
                                        sessionStorage.removeItem('notify_business_id');
                                        sessionStorage.removeItem('notify_owner_id');
                                        sessionStorage.removeItem('notify_id');
                                        sessionStorage.removeItem('notify_type');
                                        sessionStorage.removeItem('notify_identifier_id');
                                        sessionStorage.removeItem('notify_customer_id');
                                        if (sessionStorage.getItem('role') == "administrator") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `business_owner/business/list`;
                                            location.hash = `business_owner/business/list`;
                                        } else if (sessionStorage.getItem('role') == "employee") {
                                            sessionStorage.removeItem('role');
                                            digibiz.checkAccountFlag = false;
                                            // location.hash = `employee/business/list`;
                                            location.hash = `employee/business/list`;
                                        } else if (sessionStorage.getItem('role') == "customer") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `customer/business/list`;
                                            location.hash = `customer/business/list`;
                                        } else if (sessionStorage.getItem('role') == "prospect") {
                                            sessionStorage.removeItem('role');
                                            location.hash = `digibiz/account/storage`;
                                        }
                                        // location.hash = `digibiz/notifications`;
                                        // Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        // sessionStorage.removeItem('role');
                                        sessionStorage.removeItem('notify_business_id');
                                        sessionStorage.removeItem('notify_owner_id');
                                        sessionStorage.removeItem('notify_id');
                                        sessionStorage.removeItem('notify_type');
                                        sessionStorage.removeItem('notify_identifier_id');
                                        sessionStorage.removeItem('notify_customer_id');
                                        if (sessionStorage.getItem('role') == "administrator") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `business_owner/business/list`;
                                            location.hash = `business_owner/business/list`;
                                        } else if (sessionStorage.getItem('role') == "employee") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `employee/business/list`;
                                            location.hash = `employee/business/list`;
                                        } else if (sessionStorage.getItem('role') == "customer") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `customer/business/list`;
                                            location.hash = `customer/business/list`;
                                        } else if (sessionStorage.getItem('role') == "prospect") {
                                            sessionStorage.removeItem('role');
                                            location.hash = `digibiz/account/storage`;
                                        }
                                        // location.hash = `digibiz/notifications`;
                                        // Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                        removeLoader();
                                    })
                            } else {
                                removeLoader();
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                        })
                } else {
                    removeLoader();
                    //console.log("activate employee role");
                    // Materialize.toast(`Activate Employee Role`, 3000, 'round success-alert');
                    var alert_parms = {
                        alert_id: "activate-role-hub-page",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Please activate your employee role to accept this request.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        sessionStorage.setItem('role', 'employee');
                        sessionStorage.setItem('notify_business_id', getBusinessId);
                        sessionStorage.setItem('notify_owner_id', getOwnerId);
                        sessionStorage.setItem('notify_id', getNotificationsId);
                        sessionStorage.setItem('notify_type', getType);
                        removeLoader();
                    });
                }
            } else if (getType == "customer" || getType == "associate_customer") {
                if (accountResponse.roles.customer == "active") {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        notification_id: getNotificationsId,
                        action: 'accepted'
                    }
                    notificationChangeStatus(reqParam)
                        .then((response) => {
                            if (response.contact.status.status == "accepted") {
                                if (getType == "customer") {
                                    var getIdentifierId = sessionStorage.getItem('notify_identifier_id');
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        identifier_id: getIdentifierId,
                                        adder_user_id: getOwnerId,
                                        business_id: getBusinessId,
                                        notification_id: getNotificationsId
                                    }
                                    customerAdd(requestParams)
                                        .then((response) => {
                                            // sessionStorage.removeItem('role');
                                            sessionStorage.removeItem('notify_business_id');
                                            sessionStorage.removeItem('notify_owner_id');
                                            sessionStorage.removeItem('notify_id');
                                            sessionStorage.removeItem('notify_type');
                                            sessionStorage.removeItem('notify_identifier_id');
                                            sessionStorage.removeItem('notify_customer_id');
                                            if (sessionStorage.getItem('role') == "administrator") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `business_owner/business/list`;
                                                location.hash = `business_owner/business/list`;
                                            } else if (sessionStorage.getItem('role') == "employee") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `employee/business/list`;
                                                location.hash = `employee/business/list`;
                                            } else if (sessionStorage.getItem('role') == "customer") {
                                                sessionStorage.removeItem('role');
                                                digibiz.checkAccountFlag = false;
                                                // location.hash = `customer/business/list`;
                                                location.hash = `customer/business/list`;
                                            } else if (sessionStorage.getItem('role') == "prospect") {
                                                sessionStorage.removeItem('role');
                                                location.hash = `digibiz/account/storage`;
                                            }
                                            // location.hash = `digibiz/notifications`;
                                            // Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                        .catch((err) => {
                                            // sessionStorage.removeItem('role');
                                            sessionStorage.removeItem('notify_business_id');
                                            sessionStorage.removeItem('notify_owner_id');
                                            sessionStorage.removeItem('notify_id');
                                            sessionStorage.removeItem('notify_type');
                                            sessionStorage.removeItem('notify_identifier_id');
                                            sessionStorage.removeItem('notify_customer_id');
                                            if (sessionStorage.getItem('role') == "administrator") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `business_owner/business/list`;
                                                location.hash = `business_owner/business/list`;
                                            } else if (sessionStorage.getItem('role') == "employee") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `employee/business/list`;
                                                location.hash = `employee/business/list`;
                                            } else if (sessionStorage.getItem('role') == "customer") {
                                                sessionStorage.removeItem('role');
                                                digibiz.checkAccountFlag = false;
                                                // location.hash = `customer/business/list`;
                                                location.hash = `customer/business/list`;
                                            } else if (sessionStorage.getItem('role') == "prospect") {
                                                sessionStorage.removeItem('role');
                                                location.hash = `digibiz/account/storage`;
                                            }
                                            // location.hash = `digibiz/notifications`;
                                            // Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                } else if (getType == "associate_customer") {
                                    var getCustomerId = sessionStorage.getItem('notify_customer_id');
                                    var requestParams = {
                                        device_id: crossplat.device.uuid,
                                        adder_user_id: getOwnerId,
                                        customer_id: getCustomerId,
                                        business_id: getBusinessId,
                                        notification_id: getNotificationsId
                                    }
                                    associateCustomerAdd(requestParams)
                                        .then((response) => {
                                            // sessionStorage.removeItem('role');
                                            sessionStorage.removeItem('notify_business_id');
                                            sessionStorage.removeItem('notify_owner_id');
                                            sessionStorage.removeItem('notify_id');
                                            sessionStorage.removeItem('notify_type');
                                            sessionStorage.removeItem('notify_identifier_id');
                                            sessionStorage.removeItem('notify_customer_id');
                                            if (sessionStorage.getItem('role') == "administrator") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `business_owner/business/list`;
                                                location.hash = `business_owner/business/list`;
                                            } else if (sessionStorage.getItem('role') == "employee") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `employee/business/list`;
                                                location.hash = `employee/business/list`;
                                            } else if (sessionStorage.getItem('role') == "customer") {
                                                sessionStorage.removeItem('role');
                                                digibiz.checkAccountFlag = false;
                                                // location.hash = `customer/business/list`;
                                                location.hash = `customer/business/list`;
                                            } else if (sessionStorage.getItem('role') == "prospect") {
                                                sessionStorage.removeItem('role');
                                                location.hash = `digibiz/account/storage`;
                                            }
                                            // location.hash = `digibiz/notifications`;
                                            // Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                        .catch((err) => {
                                            // sessionStorage.removeItem('role');
                                            sessionStorage.removeItem('notify_business_id');
                                            sessionStorage.removeItem('notify_owner_id');
                                            sessionStorage.removeItem('notify_id');
                                            sessionStorage.removeItem('notify_type');
                                            sessionStorage.removeItem('notify_identifier_id');
                                            sessionStorage.removeItem('notify_customer_id');
                                            if (sessionStorage.getItem('role') == "administrator") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `business_owner/business/list`;
                                                location.hash = `business_owner/business/list`;
                                            } else if (sessionStorage.getItem('role') == "employee") {
                                                sessionStorage.removeItem('role');
                                                // location.hash = `employee/business/list`;
                                                location.hash = `employee/business/list`;
                                            } else if (sessionStorage.getItem('role') == "customer") {
                                                sessionStorage.removeItem('role');
                                                digibiz.checkAccountFlag = false;
                                                // location.hash = `customer/business/list`;
                                                location.hash = `customer/business/list`;
                                            } else if (sessionStorage.getItem('role') == "prospect") {
                                                sessionStorage.removeItem('role');
                                                location.hash = `digibiz/account/storage`;
                                            }
                                            // location.hash = `digibiz/notifications`;
                                            // Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                            removeLoader();
                                        })
                                }
                            } else {
                                removeLoader();
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                        })
                } else {
                    removeLoader();
                    //console.log("activate customer role");
                    // Materialize.toast(`Activate Customer Role`, 3000, 'round success-alert');
                    var alert_parms = {
                        alert_id: "activate-role-hub-page",
                        alert_platform: crossplat.device.platform,
                        alert_title: `Alert`,
                        alert_body: `Please activate your customer role to accept this request.`,
                        alert_btn: [{
                            name: "Ok",
                            attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                        },
                        {
                            name: "Cancel",
                            attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                        }]
                    }
                    showAlert(alert_parms, function () {
                        if (getType == "customer") {
                            var getIdentifierId = sessionStorage.getItem('notify_identifier_id');
                            sessionStorage.setItem('notify_identifier_id', getIdentifierId);
                        } else if (getType == "associate_customer") {
                            var getCustomerId = sessionStorage.getItem('notify_customer_id');
                            sessionStorage.setItem('notify_customer_id', getCustomerId);
                        }
                        sessionStorage.setItem('role', 'customer');
                        sessionStorage.setItem('notify_business_id', getBusinessId);
                        sessionStorage.setItem('notify_owner_id', getOwnerId);
                        sessionStorage.setItem('notify_id', getNotificationsId);
                        sessionStorage.setItem('notify_type', getType);
                        removeLoader();
                    });
                }
            } else if (getType == "super_admin") {
                if (accountResponse.roles.employee == "active" && accountResponse.roles.administrator == "active") {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        notification_id: getNotificationsId,
                        action: 'accepted'
                    }
                    notificationChangeStatus(reqParam)
                        .then((response) => {
                            //console.log("notificationChangeStatus response", response);
                            if (response.contact.status.status == "accepted") {
                                var requestParams = {
                                    device_id: crossplat.device.uuid,
                                    notification_id: getNotificationsId,
                                    business_id: getBusinessId,
                                }
                                businessSuperAdminAdd(requestParams)
                                    .then((response) => {
                                        // sessionStorage.removeItem('role');
                                        sessionStorage.removeItem('notify_business_id');
                                        sessionStorage.removeItem('notify_owner_id');
                                        sessionStorage.removeItem('notify_id');
                                        sessionStorage.removeItem('notify_type');
                                        sessionStorage.removeItem('notify_identifier_id');
                                        sessionStorage.removeItem('notify_customer_id');
                                        if (sessionStorage.getItem('role') == "administrator") {
                                            sessionStorage.removeItem('role');
                                            digibiz.checkAccountFlag = false;
                                            // location.hash = `business_owner/business/list`;
                                            location.hash = `business_owner/business/list`;
                                        } else if (sessionStorage.getItem('role') == "employee") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `employee/business/list`;
                                            location.hash = `employee/business/list`;
                                        } else if (sessionStorage.getItem('role') == "customer") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `customer/business/list`;
                                            location.hash = `customer/business/list`;
                                        } else if (sessionStorage.getItem('role') == "prospect") {
                                            sessionStorage.removeItem('role');
                                            location.hash = `digibiz/account/storage`;
                                        }
                                        // location.hash = `digibiz/notifications`;
                                        // Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                        removeLoader();
                                    })
                                    .catch((err) => {
                                        // sessionStorage.removeItem('role');
                                        sessionStorage.removeItem('notify_business_id');
                                        sessionStorage.removeItem('notify_owner_id');
                                        sessionStorage.removeItem('notify_id');
                                        sessionStorage.removeItem('notify_type');
                                        sessionStorage.removeItem('notify_identifier_id');
                                        sessionStorage.removeItem('notify_customer_id');
                                        if (sessionStorage.getItem('role') == "administrator") {
                                            sessionStorage.removeItem('role');
                                            digibiz.checkAccountFlag = false;
                                            // location.hash = `business_owner/business/list`;
                                            location.hash = `business_owner/business/list`;
                                        } else if (sessionStorage.getItem('role') == "employee") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `employee/business/list`;
                                            location.hash = `employee/business/list`;
                                        } else if (sessionStorage.getItem('role') == "customer") {
                                            sessionStorage.removeItem('role');
                                            // location.hash = `customer/business/list`;
                                            location.hash = `customer/business/list`;
                                        } else if (sessionStorage.getItem('role') == "prospect") {
                                            sessionStorage.removeItem('role');
                                            location.hash = `digibiz/account/storage`;
                                        }
                                        // location.hash = `digibiz/notifications`;
                                        // Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                        removeLoader();
                                    })
                            } else {
                                removeLoader();
                            }
                        })
                        .catch((err) => {
                            removeLoader();
                        })
                } else {
                    if (accountResponse.roles.employee == "active") {
                        if (accountResponse.roles.administrator == "active") {
                            var reqParam = {
                                device_id: crossplat.device.uuid,
                                notification_id: getNotificationsId,
                                action: 'accepted'
                            }
                            notificationChangeStatus(reqParam)
                                .then((response) => {
                                    //console.log("notificationChangeStatus response", response);
                                    if (response.contact.status.status == "accepted") {
                                        var requestParams = {
                                            device_id: crossplat.device.uuid,
                                            notification_id: getNotificationsId,
                                            business_id: getBusinessId,
                                        }
                                        businessSuperAdminAdd(requestParams)
                                            .then((response) => {
                                                // sessionStorage.removeItem('role');
                                                sessionStorage.removeItem('notify_business_id');
                                                sessionStorage.removeItem('notify_owner_id');
                                                sessionStorage.removeItem('notify_id');
                                                sessionStorage.removeItem('notify_type');
                                                sessionStorage.removeItem('notify_identifier_id');
                                                sessionStorage.removeItem('notify_customer_id');
                                                if (sessionStorage.getItem('role') == "administrator") {
                                                    sessionStorage.removeItem('role');
                                                    digibiz.checkAccountFlag = false;
                                                    // location.hash = `business_owner/business/list`;
                                                    location.hash = `business_owner/business/list`;
                                                } else if (sessionStorage.getItem('role') == "employee") {
                                                    sessionStorage.removeItem('role');
                                                    // location.hash = `employee/business/list`;
                                                    location.hash = `employee/business/list`;
                                                } else if (sessionStorage.getItem('role') == "customer") {
                                                    sessionStorage.removeItem('role');
                                                    // location.hash = `customer/business/list`;
                                                    location.hash = `customer/business/list`;
                                                } else if (sessionStorage.getItem('role') == "prospect") {
                                                    sessionStorage.removeItem('role');
                                                    location.hash = `digibiz/account/storage`;
                                                }
                                                // location.hash = `digibiz/notifications`;
                                                // Materialize.toast(`Successfully accepted`, 3000, 'round success-alert');
                                                removeLoader();
                                            })
                                            .catch((err) => {
                                                // sessionStorage.removeItem('role');
                                                sessionStorage.removeItem('notify_business_id');
                                                sessionStorage.removeItem('notify_owner_id');
                                                sessionStorage.removeItem('notify_id');
                                                sessionStorage.removeItem('notify_type');
                                                sessionStorage.removeItem('notify_identifier_id');
                                                sessionStorage.removeItem('notify_customer_id');
                                                if (sessionStorage.getItem('role') == "administrator") {
                                                    sessionStorage.removeItem('role');
                                                    digibiz.checkAccountFlag = false;
                                                    // location.hash = `business_owner/business/list`;
                                                    location.hash = `business_owner/business/list`;
                                                } else if (sessionStorage.getItem('role') == "employee") {
                                                    sessionStorage.removeItem('role');
                                                    // location.hash = `employee/business/list`;
                                                    location.hash = `employee/business/list`;
                                                } else if (sessionStorage.getItem('role') == "customer") {
                                                    sessionStorage.removeItem('role');
                                                    // location.hash = `customer/business/list`;
                                                    location.hash = `customer/business/list`;
                                                } else if (sessionStorage.getItem('role') == "prospect") {
                                                    sessionStorage.removeItem('role');
                                                    location.hash = `digibiz/account/storage`;
                                                }
                                                // location.hash = `digibiz/notifications`;
                                                // Materialize.toast(`Error in accepting`, 3000, 'round success-alert');
                                                removeLoader();
                                            })
                                    } else {
                                        removeLoader();
                                    }
                                })
                                .catch((err) => {
                                    removeLoader();
                                })
                        } else {
                            removeLoader();
                            //console.log("activate administrator role");
                            // Materialize.toast(`Activate Administrator Role`, 3000, 'round success-alert');
                            var alert_parms = {
                                alert_id: "activate-role-hub-page",
                                alert_platform: crossplat.device.platform,
                                alert_title: `Alert`,
                                alert_body: `Please activate your administrator role to accept this request.`,
                                alert_btn: [{
                                    name: "Ok",
                                    attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                                },
                                {
                                    name: "Cancel",
                                    attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                                }]
                            }
                            showAlert(alert_parms, function () {
                                sessionStorage.setItem('role', 'administrator');
                                sessionStorage.setItem('notify_business_id', getBusinessId);
                                sessionStorage.setItem('notify_id', getNotificationsId);
                                sessionStorage.setItem('notify_type', getType);
                                removeLoader();
                            });
                        }
                    } else {
                        removeLoader();
                        //console.log("activate employee role");
                        // Materialize.toast(`Activate Employee Role`, 3000, 'round success-alert');
                        var alert_parms = {
                            alert_id: "activate-role-hub-page",
                            alert_platform: crossplat.device.platform,
                            alert_title: `Alert`,
                            alert_body: `Please activate your employee role to accept this request.`,
                            alert_btn: [{
                                name: "Ok",
                                attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                            },
                            {
                                name: "Cancel",
                                attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                            }]
                        }
                        showAlert(alert_parms, function () {
                            sessionStorage.setItem('role', 'employee');
                            sessionStorage.setItem('notify_business_id', getBusinessId);
                            sessionStorage.setItem('notify_owner_id', getOwnerId);
                            sessionStorage.setItem('notify_id', getNotificationsId);
                            sessionStorage.setItem('notify_type', getType);
                            removeLoader();
                        });
                    }
                }
            }
        })
        .catch((err) => {
            removeLoader();
            //console.log("no account")
            if (getType == "employee") {
                //console.log("activate employee role");
                // Materialize.toast(`Activate Employee Role`, 3000, 'round success-alert');
                var alert_parms = {
                    alert_id: "activate-role-hub-page",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Please activate your employee role to accept this request.`,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                    },
                    {
                        name: "Cancel",
                        attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    sessionStorage.setItem('role', 'employee');
                    sessionStorage.setItem('notify_business_id', getBusinessId);
                    sessionStorage.setItem('notify_owner_id', getOwnerId);
                    sessionStorage.setItem('notify_id', getNotificationsId);
                    sessionStorage.setItem('notify_type', getType);
                    removeLoader();
                });
            } else if (getType == "customer" || getType == "associate_customer") {
                //console.log("activate customer role");
                // Materialize.toast(`Activate Customer Role`, 3000, 'round success-alert');
                var alert_parms = {
                    alert_id: "activate-role-hub-page",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Please activate your customer role to accept this request.`,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                    },
                    {
                        name: "Cancel",
                        attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    if (getType == "customer") {
                        var getIdentifierId = sessionStorage.getItem('notify_identifier_id');
                        sessionStorage.setItem('notify_identifier_id', getIdentifierId);
                    } else if (getType == "associate_customer") {
                        var getCustomerId = sessionStorage.getItem('notify_customer_id');
                        sessionStorage.setItem('notify_customer_id', getCustomerId);
                    }
                    sessionStorage.setItem('role', 'customer');
                    sessionStorage.setItem('notify_business_id', getBusinessId);
                    sessionStorage.setItem('notify_owner_id', getOwnerId);
                    sessionStorage.setItem('notify_id', getNotificationsId);
                    sessionStorage.setItem('notify_type', getType);
                    removeLoader();
                });
            } else if (getType == "super_admin") {
                //console.log("activate administrator role");
                // Materialize.toast(`Activate Administrator Role`, 3000, 'round success-alert');
                var alert_parms = {
                    alert_id: "activate-role-hub-page",
                    alert_platform: crossplat.device.platform,
                    alert_title: `Alert`,
                    alert_body: `Please activate your administrator role to accept this request.`,
                    alert_btn: [{
                        name: "Ok",
                        attr: [{ name: "id", value: "activate-role-hub-page-alert-ok" }]
                    },
                    {
                        name: "Cancel",
                        attr: [{ name: "id", value: "activate-role-hub-page-alert-cancel" }]
                    }]
                }
                showAlert(alert_parms, function () {
                    sessionStorage.setItem('role', 'administrator');
                    sessionStorage.setItem('notify_business_id', getBusinessId);
                    sessionStorage.setItem('notify_id', getNotificationsId);
                    sessionStorage.setItem('notify_type', getType);
                    removeLoader();
                });
            }
        })
}


function businessDisplayControlPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('business_id')
        }
        businessGet(reqParam)
            .then((response) => {
                //console.log("businessGet response", response);
                getDisplayControl(reqParam)
                    .then((result) => {
                        //console.log("getDisplayControl result", result);
                        var getBusiness = {
                            getBusinessDisplayData: result
                        }
                        //console.log("getBusiness", getBusiness);
                        fetch.replaceHtml(function () {
                            var businessType = response.business_type;
                            //console.log("businessType", businessType);
                            if (businessType == "sole_proprietorship") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.shop-established-licence').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "partnership") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.partnership-deed').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.partnership-registration-certificate').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "limited_liability_partnership") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.limited-liability-partnership').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "private_limited_company") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.memorandum-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.articles-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "public_limited_company") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.memorandum-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.articles-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "government_department") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.memorandum-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.articles-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "trusts_foundations") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.trust-establishment-license').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "co_operative_society_associations") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else {
                                //console.log("none is found");
                            }
                            removeLoader();
                            appScroll.scrollBar('#main-content-wrapper');
                            resolve();
                        }, "page/business/business_profile_display_control", "#business-profile-display-control-template", "#main-content-wrapper", getBusiness);
                    })
                    .catch((err) => {
                        fetch.replaceHtml(function () {
                            var businessType = response.business_type;
                            //console.log("businessType", businessType);
                            if (businessType == "sole_proprietorship") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.shop-established-licence').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "partnership") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.partnership-deed').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.partnership-registration-certificate').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "limited_liability_partnership") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.limited-liability-partnership').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "private_limited_company") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.memorandum-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.articles-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "public_limited_company") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.memorandum-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.articles-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "government_department") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.memorandum-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.articles-of-association').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "trusts_foundations") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.trust-establishment-license').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else if (businessType == "co_operative_society_associations") {
                                $('.id-proof').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.pan-card').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.gst').parents('.business-profile-display-control-content').removeClass('hide');
                                $('.board-resolution-authorize').parents('.business-profile-display-control-content').removeClass('hide');
                                removeLoader();
                            } else {
                                //console.log("none is found");
                            }
                            removeLoader();
                            appScroll.scrollBar('.business-profile-display-control-main-wrapper');
                            resolve();
                        }, "page/business/business_profile_display_control", "#business-profile-display-control-template", "#main-content-wrapper", null);
                    })
            })
            .catch((err) => {
                removeLoader();
                resolve();
                Materialize.toast("Error in getting business", 3000, 'rounded error-alert');
            })
    })
}

/**
* Download To Device
*/

function downloadToDevice22(asset_id, callback) {
    getAssetDetails(asset_id).then((assetDetails) => {
        if (assetDetails) {
            chunkDownload(assetDetails).then((sessionResponse) => {
                let fileName = assetDetails.file_attributes.name.relative;
                if (crossplat.device.platform == 'Android' || crossplat.device.platform == 'iOS') {
                    Materialize.toast('Downloading...', 1000, 'round success-alert');
                    window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory, function (fileSystem) {
                        fileSystem.getDirectory('Digital Jeevi', { create: true }, function (dirEntry) {
                            var folder = config['downloadFolderNames'].find(e => e.name == fileType);
                            var folder_name = "Others";
                            if (folder) {
                                folder_name = folder.folder_name;
                            }
                            dirEntry.getDirectory(folder_name, { create: true }, function (dirEntryType) {
                                dirEntryType.getFile(fileName.trim(), { create: true }, function (targetFile) {
                                    var onSuccess = function () {
                                        Materialize.Toast.removeAll();
                                        Materialize.toast('File Downloaded', 3000, 'success-alert');
                                    };
                                    var onError = function (err) {
                                        Materialize.toast("Error while downloading file", 3000, 'error-alert');
                                    };
                                    var onProgress = function (progress) {
                                        $('#download-progress').html((100 * progress.bytesReceived / progress.totalBytesToReceive) + '%');
                                    };
                                    var downloader = new BackgroundTransfer.BackgroundDownloader();
                                    // Create a new download operation.
                                    var download = downloader.createDownload(api.chunk_download + '/' + sessionResponse.Data.sessionid, targetFile);
                                    // Start the download and persist the promise to be able to cancel the download.
                                    app.downloadPromise = download.startAsync().then(onSuccess, onError, onProgress);
                                });
                            }, function (err) {
                                Materialize.toast("Error while downloading file", 3000, 'error-alert');
                            });
                        }, function (err) {
                            Materialize.toast("Error while downloading file", 3000, 'error-alert');
                        });
                    });

                } else {
                    Materialize.toast('Downloading...', 3000);
                    var element = document.createElement('a');
                    element.setAttribute('href', api.chunk_download + '/' + sessionResponse.Data.sessionid);
                    element.style.display = 'none';
                    document.body.appendChild(element);
                    if (element.hasAttribute("href")) {
                        element.click();
                    }
                }
                callback();
            }).catch((err) => {
                Materialize.toast('Sorry,some error occured', 4000, 'round error-alert');
            })
        }
    }).catch((err) => {
        if (err.Data[0].data == "No such file found") {
            removeLoader();
            Materialize.toast('Original file is deleted please contact sender', 2000, 'round error - alert');

        }
        // Materialize.toast('Sorry,some error occured', 4000, 'round error-alert');
    })
}

function downloadToDevice(image_id, file_name, callback) {
    //console.log("downloadToDevice", image_id, file_name);
    var requestParameter = {
        'device_id': crossplat.device.uuid,
        'business_id': sessionStorage.getItem('business_id'),
        'image_id': image_id
    }
    getBusinessMultimediaDownload(requestParameter)
        .then((responseDetails) => {
            if (responseDetails) {
                //console.log("responseDetails", responseDetails);
                downloadFromBase64(file_name, responseDetails.file_type, responseDetails.file_extension, responseDetails.content)
                callback();
            }
        })
        .catch((err) => {
            if (err.msg == "unable to get file content") {
                removeLoader();
                Materialize.toast('Unable to get the content', 2000, 'round error-alert');
            }
        })
}

/**
 * Chunk Download
*/

function chunkDownload(data = null) {
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('bizchat_role') == "employee") {
            var user_id = window.sessionStorage.getItem('employee_id');
            var user_type = "employee";
        } else if (sessionStorage.getItem('bizchat_role') == "individual") {
            var user_id = window.sessionStorage.getItem('digibiz_individual_id');
            var user_type = "individual";
        } else if (sessionStorage.getItem('bizchat_role') == "customer") {
            if (sessionStorage.getItem('customer_type') == "customer") {
                var user_id = window.sessionStorage.getItem('customer_id');
                var user_type = "customer";
            } else if (sessionStorage.getItem('customer_type') == "associate_customer") {
                var user_id = window.sessionStorage.getItem('customer_id');
                var user_type = "associate_customer";
            };
        }
        let reqParams = {
            device_id: crossplat.device.uuid,
            location: data.location,
            parent: data.parent,
            owner: {
                type: user_type,
                id: user_id
            },
            real_name: data.file_attributes.name.real
        }
        fetch.apiCall(function (response, status, xhr) {
            if (status === "success") {
                resolve(response);
            } else {
                reject();
            }
        }, api.chunk_download, "POST", "JSON", reqParams);
    });
}


function downloadFromBase64(fileName, fileType, fileExtension, contentBase64) {
    let folder = config['downloadFolderNames'].find(e => e.name == fileType);
    let folder_name = "Others";
    if (folder) {
        folder_name = folder.folder_name;
    }
    if (crossplat.device.platform == 'Android') {
        Materialize.toast('Downloading...', 1000, 'round success-alert');
        window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory, function (fileSystem) {
            //console.log(1);
            fileSystem.getDirectory('Download', {}, function (downloadEntry) {
                downloadEntry.getDirectory('Digitaljeevi', { create: true }, function (dirEntry) {
                    //console.log(2);
                    dirEntry.getDirectory(folder_name, { create: true }, function (dirEntryType) {
                        //console.log(3);
                        dirEntryType.getFile(fileName.trim(), { create: true }, function (targetFile) {
                            //console.log(4);
                            let blobContent = b64toBlobFunction(contentBase64, `${fileType}/${fileExtension}`);

                            targetFile.createWriter(function (fileWriter) {

                                fileWriter.onwriteend = function () {
                                    //console.log(5, 'success');
                                    Materialize.Toast.removeAll();
                                    Materialize.toast('File Downloaded', 3000, 'success-alert');

                                };

                                fileWriter.onerror = function (e) {
                                    //console.log("Failed file write: " + e.toString());
                                    //console.log(5, 'error');
                                    //console.log('err', err);
                                    Materialize.toast("Error while downloading file", 3000, 'error-alert');
                                };

                                fileWriter.write(blobContent);
                            });

                        }, function (err) {
                            //console.log("download error", err);
                        });
                    }, function (err) {
                        //console.log("download error 0", err);
                        Materialize.toast("Error while downloading file", 3000, 'error-alert');
                    });
                }, function (err) {
                    //console.log("download error 1", err);
                    Materialize.toast("Error while downloading file", 3000, 'error-alert');
                });
            }, function (err) {
                //console.log("download error 2", err);
                Materialize.toast("Error while downloading file", 3000, 'error-alert');
            });
        }, function (err) {
            //console.log("download error 3", err);
            Materialize.toast("Error while downloading file", 3000, 'error-alert');
        });
    } else if (crossplat.device.platform == 'iOS') {
        Materialize.toast('Downloading...', 1000, 'round success-alert');
        if (fileType == 'image' || fileType == 'video') {
            window.resolveLocalFileSystemURL(cordova.file.dataDirectory, function (fileSystem) {
                //console.log(1);
                fileSystem.getDirectory('temp', { create: true }, function (tempEntry) {
                    tempEntry.getFile(fileName.trim(), { create: true }, function (targetFile) {
                        //console.log(4);
                        let blobContent = b64toBlobFunction(contentBase64, `${fileType}/${fileExtension}`);

                        targetFile.createWriter(function (fileWriter) {

                            fileWriter.onwriteend = function () {
                                if (fileType == 'image') {
                                    cordova.plugins.photoLibrary.saveImage(targetFile.toURL(), 'Digitaljeevi', function (libraryItem) {
                                        //console.log('images saved in library', libraryItem);
                                        Materialize.Toast.removeAll();
                                        Materialize.toast('File Downloaded', 3000, 'success-alert');
                                        tempEntry.removeRecursively(function () {
                                        }, function (err) {
                                            //console.log('Unable to remove the temp file');
                                        });
                                    }, function (err) {
                                        //console.log('err saving photos in photo library', err);
                                    });
                                }

                                if (fileType == 'video') {
                                    cordova.plugins.photoLibrary.saveVideo(targetFile.toURL(), 'Digitaljeevi', function () {
                                        //console.log('video saved in library');
                                        Materialize.Toast.removeAll();
                                        Materialize.toast('File Downloaded', 3000, 'success-alert');
                                        tempEntry.removeRecursively(function () {
                                        }, function (err) {
                                            //console.log('Unable to remove the temp file');
                                        });
                                    }, function (err) {
                                        //console.log('err saving photos in photo library', err);
                                    });

                                }
                            };

                            fileWriter.onerror = function (e) {
                                //console.log("Failed file write: " + e.toString());
                                //console.log(5, 'error');
                                //console.log('err', err);
                                Materialize.toast("Error while downloading file", 3000, 'error-alert');
                            };

                            fileWriter.write(blobContent);
                        });
                    }, function (err) {
                        //console.log("download error", err);
                    });
                }, function (err) {
                    //console.log("download error 2", err);
                    Materialize.toast("Error while downloading file", 3000, 'error-alert');
                });
            }, function (err) {
                //console.log("download error 3", err);
                Materialize.toast("Error while downloading file", 3000, 'error-alert');
            });
        } else if (fileType == 'application') {
            cordova.InAppBrowser.open(api.chunk_download + '/' + sessionResponse.Data.sessionid, '_system');
        } else {
            Materialize.toast("File cannot be downloaded in this device. Please download it from web.", 4000, 'round error-alert');
        }
    } else {
        Materialize.toast('Downloading...', 3000);
        const linkSource = `data:${fileType}/${fileExtension};base64,${contentBase64}`;
        const downloadLink = document.createElement('a');
        document.body.appendChild(downloadLink);

        downloadLink.href = linkSource;
        downloadLink.target = '_self';
        downloadLink.download = fileName;
        downloadLink.click();
    }
}

// const b64toBlobFunction = (base64, type = 'application/octet-stream') =>
//     fetch(`data:${type};base64,${base64}`).then(res => res.blob())


const b64toBlobFunction = (b64Data, contentType = '', sliceSize = 512) => {
    //console.log("b64toBlobFunction", b64Data);
    const byteCharacters = atob(b64Data);
    const byteArrays = [];

    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
        const slice = byteCharacters.slice(offset, offset + sliceSize);

        const byteNumbers = new Array(slice.length);
        for (let i = 0; i < slice.length; i++) {
            byteNumbers[i] = slice.charCodeAt(i);
        }

        const byteArray = new Uint8Array(byteNumbers);
        byteArrays.push(byteArray);
    }

    const blob = new Blob(byteArrays, { type: contentType });
    return blob;
}


function getBusinessAppPermissionsPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "active_inactive_apps_by_business",
            business_id: sessionStorage.getItem('business_id')
        }
        listAppPermissions(reqParam)
            .then((response) => {
                //console.log("listAppPermissions response", response);
                if (response.length > 0) {
                    var product360Status, bizassetsStatus, bizpalStatus, bizpdfkitStatus, bizchatStatus, bizcardsStatus, bizmeetStatus, bizcallStatus, bizvoiceitStatus, bizcelfeStatus, wittilyStatus, channelStatus, multiStatus;
                    $.each(response, function (index, element) {
                        if (element.app == "product360") {
                            product360Status = element.status.status;
                        } else if (element.app == "bizassets") {
                            bizassetsStatus = element.status.status;
                        } else if (element.app == "bizpal") {
                            bizpalStatus = element.status.status;
                        } else if (element.app == "bizpdfkit") {
                            bizpdfkitStatus = element.status.status;
                        } else if (element.app == "bizchat") {
                            bizchatStatus = element.status.status;
                        } else if (element.app == "bizcards") {
                            bizcardsStatus = element.status.status;
                        } else if (element.app == "bizmeet") {
                            bizmeetStatus = element.status.status;
                        } else if (element.app == "bizcall") {
                            bizcallStatus = element.status.status;
                        } else if (element.app == "bizvoiceit") {
                            bizvoiceitStatus = element.status.status;
                        } else if (element.app == "bizcelfe") {
                            bizcelfeStatus = element.status.status;
                        } else if (element.app == "wittily") {
                            wittilyStatus = element.status.status;
                        } else if (element.app == "channel") {
                            channelStatus = element.status.status;
                        } else if (element.app == "multi") {
                            multiStatus = element.status.status;
                        }
                    })
                    var data = {
                        product360_status: product360Status,
                        bizassets_status: bizassetsStatus,
                        bizpal_status: bizpalStatus,
                        bizpdfkit_status: bizpdfkitStatus,
                        bizchat_status: bizchatStatus,
                        bizcards_status: bizcardsStatus,
                        bizmeet_status: bizmeetStatus,
                        bizcall_status: bizcallStatus,
                        bizvoiceit_status: bizvoiceitStatus,
                        bizcelfe_status: bizcelfeStatus,
                        wittily_status: wittilyStatus,
                        channel_status: channelStatus,
                        multi_status: multiStatus
                    }
                    fetch.replaceHtml(function () {
                        removeLoader();
                        appScroll.scrollBar('.apps-choose-business-management-page-wrapper');
                        resolve();
                    }, "page/business/app_permission_settings", "#app-permission-settings-page-template", "#main-content-wrapper", data);
                } else {
                    fetch.replaceHtml(function () {
                        removeLoader();
                        resolve();
                    }, "page/business/app_permission_settings", "#app-permission-settings-page-template", "#main-content-wrapper", null);
                }
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    removeLoader();
                    resolve();
                }, "page/business/app_permission_settings", "#app-permission-settings-page-template", "#main-content-wrapper", null);
            })
    })
}

function addAppPermissions(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.add_app_permissions, "POST", "JSON", requestParms);
    });
}

function getAppPermission(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.get_app_permissions, "POST", "JSON", requestParms);
    });
}


function listAppPermissions(requestParms) {
    //console.log("inside listAppPermissions", requestParms)
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.list_app_permissions, "POST", "JSON", requestParms);
    });
}

function changeStatusAppPermissions(requestParms) {
    //console.log("inside changeStatusAppPermissions", requestParms)
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.change_status_app_permissions, "POST", "JSON", requestParms);
    });
}


function getRolesForContactNumberCustomer(reqParams, callback) {
    addLoader();
    digibiz.getRolesListData = [];
    var reqParam = {
        device_id: crossplat.device.uuid,
        business_id: sessionStorage.getItem('business_id'),
        type: "mobile_number",
        value: reqParams.value,
        count: 20,
        offset: 0
    }
    getCustomerRolesList(reqParam)
        .then((response) => {
            //console.log("response", response);
            var modal_data = {
                modal_id: "get-roles-list-modal",
                modal_header: "Roles List",
                modal_platform: crossplat.device.platform,
                modal_body: `<div id="get-roles-list-main-container">                                
                                <div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="get-roles-list-search-btn">
                                        <span class="searchbtn waves-effect"><i class="material-icons">search</i></span>
                                        <input id="get-roles-list-search" type="search" class="expand-search-input searchexpand" placeholder="Business Name"/>
                                        <span class="searchclosebtn"><i class="material-icons get-roles-list-close-btn hide">close</i></span>
                                    </div>
                                </div>
                                <div id="get-roles-list-wrapper"></div>
                            </div>`,
            }
            showModal(modal_data, function () {
                $('#get-roles-list-modal').attr('data-for', 'customer');
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    // if ($('.modal-popup-content').length > 0) {
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                processGetRoleslist(response, function () {
                    appScroll.scrollBar('.search-user-list-data');
                    listenForGetRoleslistScrollEvent($('.search-user-list-data'));
                    setTimeout(function () {
                        removeLoader();
                        callback();
                        let elementData = document.querySelector("#get-roles-list-search");
                        // //console.log("elementData", elementData);
                        if (elementData) {
                            //if element is there
                            elementData.addEventListener("input", function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                elementData.setAttribute("socketid", timestamp);
                            });
                            elementData.addEventListener("keyup", function (e) {
                                e.stopImmediatePropagation();
                                // digibiz.searchedRolesList = [];
                                // on keyup get attribute 
                                socketid = elementData.getAttribute("socketid");
                                // //console.log("socketid", socketid);
                                keyword = elementData.value;
                                // //console.log("keyword", keyword);
                                if (socketid && keyword) {
                                    // //console.log("if search part")
                                    //if socketid attribute and keyword is there
                                    // document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    // currentroute = $("body").attr('app');
                                    var data = {
                                        room: crossplat.device.uuid,
                                        app: 'digibiz',
                                        keyword,
                                        socketid,
                                        index: 'rolesSearchForCustomer',
                                        business_id: sessionStorage.getItem('business_id'),
                                        // owner_id: sessionStorage.getItem('session_owner_id'),
                                        // owner_type: sessionStorage.getItem('session_owner_type'),
                                        type: "mobile_number",
                                        value: $('#add-customer-mobile-number').intlTelInput("getNumber").replace(/\s/g, '')
                                    }
                                    // //console.log("Search", data);
                                    sockets.searchSocket.emit('search', data);
                                    addLoader();
                                    setTimeout(() => {
                                        // removeLoader();
                                    }, 300);
                                } else {
                                    // //console.log("else search part")
                                    processGetRoleslist(digibiz.getRolesListData, function () {
                                    });
                                    removeLoader();
                                }
                            });
                        }
                    }, 1000);
                });
            });
        })
        .catch((err) => {
            //console.log("err", err);
            if (err.msg == "No digibiz account" || err.msg == "This number has not activated role jeevi and not present in any business") {
                var modal_data = {
                    modal_id: "get-roles-list-modal",
                    modal_header: "Roles List",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="get-roles-list-main-container">                                    
                                    <div id="get-roles-list-wrapper"></div>
                                </div>`,
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        // if ($('.modal-popup-content').length > 0) {
                        //     appScroll.scrollBar('.modal-popup-content');
                        // }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processGetRoleslist([], function () {
                        if (err.msg == "No digibiz account") {
                            $('.no_data').text('This number is not registered on digibiz platform.')
                        } else if (err.msg == "This number has not activated role jeevi and not present in any business") {
                            $('.no_data').text('This number has not activated role jeevi and not present in any business.')
                        }
                        removeLoader();
                        callback();
                    });
                });
            }
        })
}

function getRolesForContactNumberAssociateCustomer(reqParams, callback) {
    addLoader();
    digibiz.getRolesListData = [];
    var reqParam = {
        device_id: crossplat.device.uuid,
        business_id: sessionStorage.getItem('business_id'),
        type: "mobile_number",
        value: reqParams.value
    }
    getAssociateCustomerRolesList(reqParam)
        .then((response) => {
            //console.log("response", response);
            var modal_data = {
                modal_id: "get-roles-list-modal",
                modal_header: "Roles List",
                modal_platform: crossplat.device.platform,
                modal_body: `<div id="get-roles-list-main-container">                                
                                <div class="search">
                                    <div class="expand-search-wrap search-wrapper" id="get-roles-list-search-btn">
                                        <span class="searchbtn waves-effect"><i class="material-icons">search</i></span>
                                        <input id="get-roles-list-search" type="search" class="expand-search-input searchexpand" placeholder="Business Name"/>
                                        <span class="searchclosebtn"><i class="material-icons get-roles-list-close-btn hide">close</i></span>
                                    </div>
                                </div>
                                <div id="get-roles-list-wrapper"></div>
                            </div>`,
            }
            showModal(modal_data, function () {
                $('#get-roles-list-modal').attr('data-for', 'associate_customer');
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                    // if ($('.modal-popup-content').length > 0) {
                    //     appScroll.scrollBar('.modal-popup-content');
                    // }
                } else {
                    $('.custom-modal-popup').show().addClass('modal-slide-top');
                }
                processGetRoleslist(response, function () {
                    setTimeout(function () {
                        removeLoader();
                        callback();
                        let elementData = document.querySelector("#get-roles-list-search");
                        // //console.log("elementData", elementData);
                        if (elementData) {
                            //if element is there
                            elementData.addEventListener("input", function () {
                                //on input set attribute socketid 
                                timestamp = (new Date()).getTime();
                                elementData.setAttribute("socketid", timestamp);
                            });
                            elementData.addEventListener("keyup", function (e) {
                                e.stopImmediatePropagation();
                                // digibiz.searchedRolesList = [];
                                // on keyup get attribute 
                                socketid = elementData.getAttribute("socketid");
                                // //console.log("socketid", socketid);
                                keyword = elementData.value;
                                // //console.log("keyword", keyword);
                                if (socketid && keyword) {
                                    // //console.log("if search part")
                                    //if socketid attribute and keyword is there
                                    // document.getElementsByClassName('searchclosebtn')[0].style.display = 'flex';
                                    // currentroute = $("body").attr('app');
                                    var data = {
                                        room: crossplat.device.uuid,
                                        app: 'digibiz',
                                        keyword,
                                        socketid,
                                        index: 'rolesSearchForAssociateCustomer',
                                        // owner_id: sessionStorage.getItem('session_owner_id'),
                                        // owner_type: sessionStorage.getItem('session_owner_type'),
                                        type: "mobile_number",
                                        value: $('.contact_mobile').intlTelInput("getNumber").replace(/\s/g, '')
                                    }
                                    // //console.log("Search", data);
                                    sockets.searchSocket.emit('search', data);
                                    addLoader();
                                    setTimeout(() => {
                                        // removeLoader();
                                    }, 300);
                                } else {
                                    // //console.log("else search part")
                                    processGetRoleslist(digibiz.getRolesListData, function () {
                                    });
                                    removeLoader();
                                }
                            });
                        }
                    }, 1000);
                });
            });
        })
        .catch((err) => {
            //console.log("err", err);
            if (err.msg == "No digibiz account" || err.msg == "This number has not activated role jeevi and not present in any business") {
                var modal_data = {
                    modal_id: "get-roles-list-modal",
                    modal_header: "Roles List",
                    modal_platform: crossplat.device.platform,
                    modal_body: `<div id="get-roles-list-main-container">                                    
                                    <div id="get-roles-list-wrapper"></div>
                                </div>`,
                }
                showModal(modal_data, function () {
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        $('.custom-modal-popup').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                        // if ($('.modal-popup-content').length > 0) {
                        //     appScroll.scrollBar('.modal-popup-content');
                        // }
                    } else {
                        $('.custom-modal-popup').show().addClass('modal-slide-top');
                    }
                    processGetRoleslist([], function () {
                        if (err.msg == "No digibiz account") {
                            $('.no_data').text('This number is not registered on digibiz platform.')
                        } else if (err.msg == "This number has not activated role jeevi and not present in any business") {
                            $('.no_data').text('This number has not activated role jeevi and not present in any business.')
                        }
                        removeLoader();
                        callback();
                    });
                });
            }
        })
}

function getCustomerRolesList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_customer_roles_list, "POST", "JSON", requestParms);
    });
}

function getAssociateCustomerRolesList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_associate_customer_roles_list, "POST", "JSON", requestParms);
    });
}

function processGetRoleslist(data, callback) {
    if (data.length > 0) {
        digibiz.getRolesListData = removeDuplicatesFromMultipleProperties(digibiz.getRolesListData.concat(data), 'id', 'role_type');
        var getData = {
            userList: digibiz.getRolesListData.map(e => {
                if (e.role_type == "employee") {
                    if (e.hasOwnProperty('profile_display_id') && e.profile_display_id) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.user_id}&device_id=${crossplat.device.uuid}&image_id=${e.profile_display_id}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    if (e.hasOwnProperty('profile_display_id') && e.profile_display_id != null) {
                        var avtarUrl = `${config.api.core}/api/individual/get_image?image_id=${e.profile_display_id}&device_id=${crossplat.device.uuid}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                }
                return e;
            }),
        };
        fetch.replaceHtml(function (err) {
            if (!err) {
                // console.log('scroll 111')

                callback();
            }
        }, "page/common/get_roles_list", "#get-roles-list-template", "#get-roles-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/get_roles_list", "#get-roles-list-template", "#get-roles-list-wrapper", null);
    }

}

function processSearchedGetRoleslist(data, callback) {
    if (data.length > 0) {
        var getData = {
            userList: data.map(e => {
                if (e.role_type == "employee") {
                    if (e.hasOwnProperty('profile_display_id') && e.profile_display_id) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.user_id}&device_id=${crossplat.device.uuid}&image_id=${e.profile_display_id}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    if (e.hasOwnProperty('profile_display_id') && e.profile_display_id != null) {
                        var avtarUrl = `${config.api.core}/api/individual/get_image?image_id=${e.profile_display_id}&device_id=${crossplat.device.uuid}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                }
                return e;
            }),
        };
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/get_roles_list", "#get-roles-list-template", "#get-roles-list-wrapper", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/get_roles_list", "#get-roles-list-template", "#get-roles-list-wrapper", null);
    }
}



function digibizHomePage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            removeLoader();
            resolve();
        }, "page/landPage/home_page", "#digibiz-home-page-template", "#main-content-wrapper", null);
    })
}


function createAccountHelperMethod(callback) {
    sessionStorage.setItem('role', 'prospect');
    var reqParam = {
        device_id: crossplat.device.uuid,
        role: sessionStorage.getItem('role')
    }
    addDigibizAccount(reqParam)
        .then((response) => {
            //olddddd code
            //console.log("addDigibizAccount response", response);
            // $('#digibiz-term-and-conditions-modal').remove();
            // sessionStorage.setItem('account_id', response.id);
            // // location.hash = `land/page`;
            // location.hash = `digibiz/account/storage`;

            //Newwwww code
            //console.log("addDigibizAccount response", response);
            sessionStorage.setItem('account_id', response.id);
            if (sessionStorage.getItem('notify_id')) {
                acceptNotification();
            } else {
                if (sessionStorage.getItem('role') == "administrator") {
                    sessionStorage.removeItem('role');
                    // location.hash = `business_owner/business/list`;
                    location.hash = `business_owner/business/list`;
                } else if (sessionStorage.getItem('role') == "employee") {
                    sessionStorage.removeItem('role');
                    // location.hash = `employee/business/list`;
                    location.hash = `employee/business/list`;
                } else if (sessionStorage.getItem('role') == "customer") {
                    sessionStorage.removeItem('role');
                    // location.hash = `customer/business/list`;
                    location.hash = `customer/business/list`;
                } else if (sessionStorage.getItem('role') == "prospect") {
                    sessionStorage.removeItem('role');
                    var requestParameter = {
                        device_id: crossplat.device.uuid,
                        account_id: response.id
                    }
                    addJeeviAccount(requestParameter)
                        .then((result) => {
                            sessionStorage.setItem('digibiz_storage_selection', 'first');
                            location.hash = `digibiz/account/storage`;
                        })
                        .catch((err) => {
                            //console.log("error in adding jeevi account")
                        })
                }
            }
        })
        .catch((err) => {
            //console.log("err");
            removeLoader();
            Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
        });
}

// function digibizProfilePage() {
//     return new Promise((resolve, reject) => {
//         var profile = JSON.parse(sessionStorage.getItem('profile_details'));
//         if (profile.pictures.profile_display.hasOwnProperty('image_id') && profile.pictures.profile_display.image_id) {
//             var image = `${config.api.core}/api/individual/get_image?image_id=${profile.pictures.profile_display.image_id}&device_id=${crossplat.device.uuid}`;
//         } else {
//             var image = ``;
//         }
//         var sidebarData = {
//             account_id: profile.individual.id,
//             name: profile.individual.name,
//             mobileNumber: profile.login.mobile_number,
//             user_name: profile.login.user_name,
//             avatarUrl: profile.pictures.profile_display.image_id,
//             imageUrl: image,
//             imageLetter: profile.individual.name.first.charAt(0).toUpperCase(),
//         }
//         fetch.replaceHtml(function () {
//             removeLoader();
//             resolve();
//         }, "page/profile/profile_page", "#profile-page-template", "#app-root", sidebarData);
//     })
// }

function digibizProfilePage() {
    console.log("insidde digibizProfilePage")
    return new Promise((resolve, reject) => {
        var getPlatform;
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            getPlatform = false;
        } else {
            getPlatform = true;
        }
        var profile = JSON.parse(sessionStorage.getItem('profile_details'));
        if (profile.pictures.profile_display.hasOwnProperty('image_id') && profile.pictures.profile_display.image_id) {
            var image = `${config.api.core}/api/individual/get_image?image_id=${profile.pictures.profile_display.image_id}&device_id=${crossplat.device.uuid}`;
        } else {
            var image = `${config.api.core}/api/individual/get_image?image_id=${profile.pictures.profile_display.image_id}&device_id=${crossplat.device.uuid}`;
        }
        var sidebarData = {
            account_id: profile.individual.id,
            name: profile.individual.name,
            mobileNumber: profile.login.mobile_number,
            user_name: profile.login.user_name,
            avatarUrl: profile.pictures.profile_display.image_id,
            imageUrl: image,
            imageLetter: profile.individual.name.first.charAt(0).toUpperCase(),
            platform: getPlatform
        }
        fetch.replaceHtml(function () {
            console.log("done", sidebarData)
            removeLoader();
            resolve();
        }, "page/profile/profile_page", "#profile-page-template", "#digibiz-home-page-middle-band-wrapper", sidebarData);
    })
}

function digibizAccountsSettingsPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            removeLoader();
            resolve();
        }, "page/profile/digibiz_accounts", "#digibiz-accounts-settings-page-template", "#main-content-wrapper", null);
    })
}

function digibizCredentialsSettingsPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            list_by: "account",
            account_id: sessionStorage.getItem('account_id')
        }
        listTransactionSignaturePicture(reqParam)
            .then((response) => {
                fetch.replaceHtml(function () {
                    processTransactionSignaturePictures(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/profile/my_credentials", "#my-credentials-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/profile/my_credentials", "#my-credentials-template", "#main-content-wrapper", null);
            })
    })
}

function processTransactionSignaturePictures(response, callback) {
    // var getTransactionalPictures = [];
    // var getSignaturePictures = [];
    addLoader();
    var getData = [];
    getData = removeDuplicates(getData.concat(response), "id");
    $.each(getData, function (index, eachPicture) {
        if (eachPicture.hasOwnProperty('picture_details') && eachPicture.picture_details) {
            if (eachPicture.picture_details.hasOwnProperty('thumbnail') && eachPicture.picture_details.thumbnail) {
                var avtarUrl = `${api.get_transaction_signature_picture}?id=${eachPicture.id}&device_id=${crossplat.device.uuid}&image_id=${eachPicture.picture_details.thumbnail}`;
                console.log("avtarUrl", avtarUrl);
                //add picture in the container
                // var getPictureContainer = `<div class="transaction_signature_picture_contentbox">
                //                             <div class="multimedia-container">        
                //                                 <div class="multimedia_wrapper">
                //                                     <div class="identity-picture-wrapper view">   
                //                                         <img class="attached-img transaction_signature_container view-transaction-signature-picture" id="${eachPicture.id}" thumbnail_id="${eachPicture.picture_details.thumbnail}" data-status="${eachPicture.status.status}" type="${eachPicture.type}" src="${avtarUrl}" />                             
                //                                     </div>
                //                                 </div>    
                //                             </div>
                //                         </div>`;
                // console.log("getPictureContainer", getPictureContainer);
                if (eachPicture.status.status == "inactive") {
                    var getPictureContainer = `<div class="transaction_signature_picture_contentbox">
                                            <div class="multimedia-container">        
                                                <div class="multimedia_wrapper">
                                                    <div class="identity-picture-wrapper view">   
                                                        <img class="attached-img inactivated transaction_signature_container view-transaction-signature-picture" id="${eachPicture.id}" thumbnail_id="${eachPicture.picture_details.thumbnail}" data-status="${eachPicture.status.status}" type="${eachPicture.type}" src="${avtarUrl}"/>     
                                                        <span class="picture-used material-icons">lock</span>                        
                                                    </div>
                                                </div>    
                                            </div>
                                        </div>`;
                    // $(getPictureContainer).find('img').addClass('inactivated');
                    // $(getPictureContainer).find('.identity-picture-wrapper').append(`<span class="picture-used material-icons">lock</span>`);
                } else if (eachPicture.picture_used == "yes") {
                    var getPictureContainer = `<div class="transaction_signature_picture_contentbox">
                                            <div class="multimedia-container">        
                                                <div class="multimedia_wrapper">
                                                    <div class="identity-picture-wrapper view">   
                                                        <img class="attached-img transaction_signature_container view-transaction-signature-picture" id="${eachPicture.id}" thumbnail_id="${eachPicture.picture_details.thumbnail}" data-status="${eachPicture.status.status}" type="${eachPicture.type}" src="${avtarUrl}"/>     
                                                        <span class="picture-used material-icons">lock</span>                        
                                                    </div>
                                                </div>    
                                            </div>
                                        </div>`;
                    // $(getPictureContainer).find('.identity-picture-wrapper').append(`<span class="picture-used material-icons">lock</span>`);
                } else if (eachPicture.picture_used == "no") {
                    var getPictureContainer = `<div class="transaction_signature_picture_contentbox">
                                                <div class="multimedia-container">        
                                                    <div class="multimedia_wrapper">
                                                        <div class="identity-picture-wrapper view">   
                                                            <img class="attached-img transaction_signature_container view-transaction-signature-picture" id="${eachPicture.id}" thumbnail_id="${eachPicture.picture_details.thumbnail}" data-status="${eachPicture.status.status}" type="${eachPicture.type}" src="${avtarUrl}"/>     
                                                        </div>
                                                    </div>    
                                                </div>
                                            </div>`;
                }
                if (eachPicture.type == "transaction_picture") {
                    $('#transaction_pictures_main_container').append(getPictureContainer);
                } else if (eachPicture.type == "signature_picture") {
                    $('#signature_pictures_main_container').append(getPictureContainer);
                }
            }
        }
        if ((index + 1) == getData.length) {
            removeLoader();
            callback();
        }
    })
};

function showHideRoleButtons() {
    if (digibiz.employee_business_list.length > 0) {
        $('#employee-role-btn').removeClass('hide');
    }
    if (digibiz.customer_business_list.length > 0) {
        $('#customer-role-btn').removeClass('hide');
    }
    if (digibiz.business_owner_business_list.length > 0) {
        $('#business-role-btn').removeClass('hide');
    }
}

function validateMinOneRoleActiveJeeviDelete(roles) {
    //console.log("enetered validateMinOneRoleActiveJeeviDelete", roles)
    var employeeRole = false;
    var customerRole = false;
    var bizadminRole = false;
    if (roles.employee == "active" || roles.employee == "inactive_pending" || roles.employee == "inactive") {
        employeeRole = true;
    }
    if (roles.customer == "active" || roles.customer == "inactive_pending" || roles.customer == "inactive") {
        customerRole = true;
    }
    if (roles.administrator == "active" || roles.administrator == "inactive_pending" || roles.administrator == "inactive") {
        bizadminRole = true;
    }
    //console.log("check roles", employeeRole, customerRole, bizadminRole)
    if (employeeRole || customerRole || bizadminRole) {
        //console.log("a")
        return true;
    } else {
        //console.log("b")
        return false;
    }
}

function logoutDigibiz() {
    var requestParams = {
        device_id: crossplat.device.uuid,
        app: 'business'
    }
    fetch.apiCall(function (response, status, xhr) {
        if (status === "success") {
            sockets.coreSocket.emit('joinroom', crossplat.device.uuid);
            sockets.coreSocket.emit('leaveroom', sessionStorage.getItem('socketID'));
            // __firebase.unsubscribeTopic(sessionStorage.getItem('socketID'));
            sessionStorage.clear();
            // clearGlobals();
            setTimeout(function () {
                deviceHelper.navigateToAccounts('core');
            }, 1000);
        } else {
            var jsonResponse = JSON.parse(response.responseText);
        }
    }, api.logout, "POST", "JSON", requestParams);
}

function processChooseCustomerIdentifierList(data, callback) {
    digibiz.chooseCustomerIdentifiers = removeDuplicates(digibiz.chooseCustomerIdentifiers.concat(data), "id");
    //console.log("data", data);
    var dataList = {
        data: digibiz.chooseCustomerIdentifiers
    };
    //console.log("dataList", dataList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/choose_customer_identifier_list", "#choose-customer-identifier-list-template", "#choose-customer-identifier-list", dataList);
}

function processSearchedChooseCustomerIdentifierList(data, callback) {
    //console.log("data", data);
    var dataList = {
        data: data
    };
    //console.log("dataList", dataList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/choose_customer_identifier_list", "#choose-customer-identifier-list-template", "#choose-customer-identifier-list", dataList);
}

function setServerSession(session, data, callback) {
    console.log("set server")
    param = {
        device_id: crossplat.device.uuid,
        data: data
    };
    fetch.apiCall(function (roles, status, xhr) {
        callback(roles);
    }, api.set_session, "POST", "JSON", param);
}

function notificationCountListHelperMethod() {
    var reqParam = {
        device_id: crossplat.device.uuid,
        list_by: "for_me_count",
    }
    notificationList(reqParam)
        .then((response) => {
            if (response.length > 0) {
                $('.digibiz_notification_count').attr('data-count', response.length);
                $('.digibiz_notification_count').text(response.length);
            }
        })
        .catch((err) => {
            //console.log("err in businessAdminBusinessListHelperMethod", err);
        })
}

function getBusinessNotificationCountHelperMethod() {
    var requestParams = {
        device_id: crossplat.device.uuid,
        business_id: sessionStorage.getItem('business_id'),
        list_by: "my_business_notification_count"
    }
    businessNotificationList(requestParams)
        .then((notifiResult) => {
            if (notifiResult.length > 0) {
                $('.business_notification_count').removeClass('hide');
                $('.business_notification_count').text(notifiResult.length);
            }
        })
        .catch((err) => {
            //console.log("err in getBusinessNotificationCountHelperMethod", err);
        })
}

function validateTransactionPictureData() {
    let validateNumberOfPictures = false;
    if ($(`.transaction_signature_container[type="transaction_picture"][data-status="active"]`).length < config.transactionPictureMaxLength) {
        validateNumberOfPictures = false;
    } else {
        validateNumberOfPictures = true;
    }
    if (validateNumberOfPictures) {
        return false;
    } else {
        return true;
    }
}

function validateSignaturePictureData() {
    let validateNumberOfPictures = false;
    if ($(`.transaction_signature_container[type="signature_picture"][data-status="active"]`).length < config.signaturePictureMaxLength) {
        validateNumberOfPictures = false;
    } else {
        validateNumberOfPictures = true;
    }
    if (validateNumberOfPictures) {
        return false;
    } else {
        return true;
    }
}

/*
* Purpose: To convert bytes
*/
function bytesToSize(bytes) {
    var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
    if (bytes == 0)
        return '0 Byte';
    var i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
    return (bytes / Math.pow(1024, i)).toFixed(2) + ' ' + sizes[i];
}

/**
   * show Video html in container while in Edit celfe
   * Parms: file obj  
   */
function showVideoPreviewHtml(type, data) {
    //console.log("showVideoPreviewHtml", type, data)
    let content;
    if (type == 'image') {
        content = '<img src= "' + data + '">';
    } else if (type == 'video_thumbnail') {
        content = '<video width="610px" height="450px" controlsList="nodownload" src="' + data + '" disablePictureInPicture muted> </video>';
    } else if (type == 'audio_thumbnail') {
        content = '<audio controlsList="nodownload" src="' + data + '" disablePictureInPicture muted></audio>';
    } else if (type == 'video') {
        //console.log("inside video")
        content = '<video width="610px" height="450px" controls controlsList="nodownload" src="' + data + '" ></video>';
    }
    return content;
}

function employeeProfileEditPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            id: sessionStorage.getItem('employee_id'),
            get_by: "id"
        }
        employeeGet(reqParams)
            .then((response) => {
                if (response.hasOwnProperty('identity_picture') && response.identity_picture) {
                    if (response.identity_picture.hasOwnProperty('thumbnail') && response.identity_picture.thumbnail) {
                        //console.log("gotttttt")
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_picture.thumbnail}`;
                        response.identity_picture['avtarUrl'] = avtarUrl;
                    }
                }
                if (response.hasOwnProperty('identity_video') && response.identity_video) {
                    if (response.identity_video.hasOwnProperty('thumbnail') && response.identity_video.thumbnail) {
                        //console.log("gotttttt")
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${sessionStorage.getItem('employee_id')}&device_id=${crossplat.device.uuid}&image_id=${response.identity_video.thumbnail}`;
                        response.identity_video['avtarUrl'] = avtarUrl;
                    }
                }
                var EmployeeData = {
                    EmployeeData: response
                }
                fetch.replaceHtml(function () {
                    //hide main header
                    $('.header-band').addClass('hide');
                    mobileFlaginit();
                    calenderInitDOB('#employee_date_of_birth');
                    calenderInitDOB('#employee_wedding_anniversary');
                    removeLoader();
                    console.log('new scroll init');
                    appScroll.scrollBar('#main-container');
                    resolve();
                }, "page/employee/employee_profile_edit", "#employee-profile-edit-template", "#main-content-wrapper", EmployeeData);
            })
            .catch((err) => {
                console.log("err", err);
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    })
}

function customerProfileEditPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            get_by: "id",
            id: sessionStorage.getItem('customer_id')
        }
        //get customer details
        customerGet(reqParams)
            .then((result) => {
                if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                    if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                        result.identity_picture['avtarUrl'] = avtarUrl;
                    }
                }
                if (result.hasOwnProperty('identity_video') && result.identity_video) {
                    if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                        var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                        result.identity_video['avtarUrl'] = avtarUrl;
                    }
                }
                var customerData = {
                    customerData: result
                }
                fetch.replaceHtml(function () {
                    //hide main header
                    $('.header-band').addClass('hide');
                    mobileFlaginit();
                    calenderInitDOB('#customer_date_of_birth');
                    calenderInitDOB('#customer_wedding_anniversary');
                    removeLoader();
                    resolve();
                }, "page/customer/customer_profile_edit", "#customer-profile-edit-template", "#main-content-wrapper", customerData);
            })
            .catch((err) => {
                console.log("err", err);
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    })
}

function associateCustomerProfileEditPage() {
    return new Promise((resolve, reject) => {
        var reqParams = {
            device_id: crossplat.device.uuid,
            get_by: "id",
            id: sessionStorage.getItem('customer_id')
        }
        //get customer details
        associateCustomerGet(reqParams)
            .then((result) => {
                if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                    if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                        result.identity_picture['avtarUrl'] = avtarUrl;
                    }
                }
                if (result.hasOwnProperty('identity_video') && result.identity_video) {
                    if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                        var avtarUrl = `${api.get_associate_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                        result.identity_video['avtarUrl'] = avtarUrl;
                    }
                }
                var associateCustomerData = {
                    associateCustomerData: result
                }
                fetch.replaceHtml(function () {
                    //hide main header
                    $('.header-band').addClass('hide');
                    mobileFlaginit();
                    calenderInitDOB('#associate_customer_date_of_birth');
                    calenderInitDOB('#associate_customer_wedding_anniversary');
                    removeLoader();
                    resolve();
                }, "page/customer/associate_customer_profile_edit", "#associate-customer-profile-edit-template", "#main-content-wrapper", associateCustomerData);
            })
            .catch((err) => {
                console.log("err", err);
                removeLoader();
                Materialize.toast(err.msg, 3000, 'round error-alert');
            })
    })
}

function cameraCaptureClick(uploadType) {
    var upload_type = uploadType;
    var profileDetails = JSON.parse(sessionStorage.getItem('profile_details'));
    var name = profileDetails.individual.name.first + ' ' + profileDetails.individual.name.last;
    // $("#upload-preview-wrapper").addClass('slide-bottom');
    if (upload_type && upload_type == 'videocamera') {
        //console.log("inside video declartion");
        // addLoader();
        digibiz.declarationVideo = {};
        if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
            var blob = new Blob(videoCapturedChunks, { 'type': 'video/webm' });
            console.log("blob", blob);
            // var url = URL.createObjectURL(blob);
            // console.log("url", url);
            var reader = new FileReader;
            reader.onloadend = function (readerEvent) {
                callApi(readerEvent, blob);
                $('#camera-video-modal').remove();
            };
            reader.readAsDataURL(blob);
        } else {
            //console.log("inside mobilt");
            // window.resolveLocalFileSystemURL(window.videoMediaFile, function (entry) {
            //     entry.file(function (file) {
            //         var readerdataurl = new FileReader;
            //         readerdataurl.onloadend = function (readerEvent) {
            //             var readerArrayBuffer = new FileReader;
            //             readerArrayBuffer.onloadend = function (evt) {
            //                 var blob = new Blob([evt.target.result], { type: file.type });
            //                 callApi(readerEvent, blob);
            //                 $('#camera-video-modal').remove();
            //             }
            //             readerArrayBuffer.readAsArrayBuffer(file);
            //         };
            //         readerdataurl.readAsDataURL(file);
            //     });
            // }, function (err) {
            //     //console.log('error getting the camera media file', err);
            // });
            //console.log("111", window.videoMediaFile)
            window.resolveLocalFileSystemURL(window.videoMediaFile, function (entry) {
                //console.log("222", entry)
                entry.file(function (file) {
                    //console.log("333", file)
                    var readerdataurl = new FileReader;
                    //console.log("444", readerdataurl)
                    readerdataurl.onloadend = function (readerEvent) {
                        //console.log("555", readerEvent)
                        var readerArrayBuffer = new FileReader;
                        //console.log("666", readerArrayBuffer)
                        readerArrayBuffer.onloadend = function (evt) {
                            //console.log("777", evt)
                            var blob = new Blob([evt.target.result], { type: file.type });
                            //console.log("888", blob)
                            callApi(readerEvent, blob);
                        }
                        readerArrayBuffer.readAsArrayBuffer(file);
                    };
                    readerdataurl.readAsDataURL(file);
                });
            }, function (err) {
                //console.log('error getting the camera media file', err);
            });
        }
    } else if (upload_type && upload_type == 'camera') {
        if ($('body').attr('app') == "digibiz_credentials") {
            var getUploadFor = $('#camera-modal').attr('camera-for');
            $('#camera-modal').remove();
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "business-credential-picture-modal",
                modal_header: "Crop Image",
                modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                modal_action_buttons: [{
                    id: "business-credential-picture-crop-button",
                    name: `crop`,
                    attr: [{
                        name: "data-id",
                        value: ''
                    }]
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if ($('.modal-popup-content').length > 0) {
                    if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                        // //console.log("scroll initiated for modal pop-up class")
                        // appScroll.scrollBar('.modal-popup-content');
                    }
                }
                $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                $('#business-credential-picture-modal').attr('picture-type', getUploadFor);
            });
            setTimeout(function () {
                var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    window.captureCanvas.toBlob(function (blob) {
                        var reader = new FileReader;
                        reader.onloadend = function (readerEvent) {
                            var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                            var types = blob.type.split('/');
                            var extension = types[1];
                            if (supported_types.includes(extension.toLowerCase())) {
                                $('.image_container').remove();

                                var image = document.getElementById('image_cropper');
                                console.log("image", image);
                                image.src = readerEvent.target.result;
                                image.onload = function (element) {
                                    $('.group_image_delete').hide();
                                };
                                $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                digibiz.cropper = new Cropper(image, {
                                    viewMode: 2,
                                    aspectRatio: 1 / 1,
                                    minContainerWidth: 72,
                                    minContainerHeight: 72,
                                    minCropBoxWidth: 72,
                                    minCropBoxHeight: 72,
                                    maxWidth: 100,
                                    maxHeight: 400,
                                    zoomable: true,
                                    rotatable: true,
                                    responsive: true,
                                    movable: true,
                                    ready: function () {
                                        //cropper.zoom(-0.6);
                                    }
                                });
                                removeLoader();
                            }
                        };
                        reader.readAsDataURL(blob);
                    });
                } else {
                    window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                        entry.file(function (file) {
                            var readerdataurl = new FileReader;
                            readerdataurl.onloadend = function (readerEvent) {
                                var readerArrayBuffer = new FileReader;
                                readerArrayBuffer.onloadend = function (evt) {
                                    var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                    // callapi(readerEvent, blob);
                                    var types = blob.type.split('/');
                                    var extension = types[1];
                                    if (supported_types.includes(extension.toLowerCase())) {
                                        $('.image_container').remove();
                                        var url = URL.createObjectURL(blob);

                                        var image = document.getElementById('image_cropper');
                                        image.src = readerEvent.target.result;
                                        image.onload = function (element) {
                                            $('.group_image_delete').hide();
                                        };
                                        $('#business-credential-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        digibiz.cropper = new Cropper(image, {
                                            viewMode: 2,
                                            aspectRatio: 1 / 1,
                                            minContainerWidth: 72,
                                            minContainerHeight: 72,
                                            minCropBoxWidth: 72,
                                            minCropBoxHeight: 72,
                                            maxWidth: 100,
                                            maxHeight: 400,
                                            zoomable: true,
                                            rotatable: true,
                                            responsive: true,
                                            movable: true,
                                            ready: function () {
                                                //cropper.zoom(-0.6);
                                            }
                                        });
                                        removeLoader();
                                    }
                                }
                                readerArrayBuffer.readAsArrayBuffer(file);
                            };
                            readerdataurl.readAsDataURL(file);
                        });
                    }, function (err) {
                        //console.log('error getting the camera media file', err);
                    });
                }
            }, 500);
        } else if ($('body').attr('app') == "customer_groups_details" || $('body').attr('app') == "employee_group_create" || $('body').attr('app') == "communication_group_details" || $('body').attr('app') == "collaborator_group_details") {
            //console.log("groups")
            $('.upload-preview-wrapper').addClass('hide');
            $('#camera-modal').remove();
            //CROPPER MODAL
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "group-image-modal",
                modal_header: "",
                modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                modal_action_buttons: [{
                    id: "group-image-crop-button",
                    name: `crop`,
                    attr: [{
                        name: "data-id",
                        value: ''
                    }]
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if ($('.modal-popup-content').length > 0) {
                    if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                        // //console.log("scroll initiated for modal pop-up class")
                        // appScroll.scrollBar('.modal-popup-content');
                    }
                }
                $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                $('#group-image-modal').attr('picture-type', 'group_image');
            });
            setTimeout(function () {
                var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    //console.log("browser")
                    window.captureCanvas.toBlob(function (blob) {
                        var reader = new FileReader;
                        reader.onloadend = function (readerEvent) {
                            var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                            var types = blob.type.split('/');
                            var extension = types[1];
                            if (supported_types.includes(extension.toLowerCase())) {
                                //console.log("passed")
                                $('.image_container').remove();

                                var image = document.getElementById('image_cropper');
                                image.src = readerEvent.target.result;
                                image.onload = function (element) {
                                    $('.group-image-delete').hide();
                                };
                                //console.log("kj")
                                $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                digibiz.cropper = new Cropper(image, {
                                    viewMode: 2,
                                    aspectRatio: 1 / 1,
                                    minContainerWidth: 72,
                                    minContainerHeight: 72,
                                    minCropBoxWidth: 72,
                                    minCropBoxHeight: 72,
                                    maxWidth: 100,
                                    maxHeight: 400,
                                    zoomable: true,
                                    rotatable: true,
                                    responsive: true,
                                    movable: true,
                                    ready: function () {
                                        //cropper.zoom(-0.6);
                                    }
                                });
                                removeLoader();
                            }
                        };
                        reader.readAsDataURL(blob);
                    });
                } else {
                    window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                        entry.file(function (file) {
                            var readerdataurl = new FileReader;
                            readerdataurl.onloadend = function (readerEvent) {
                                var readerArrayBuffer = new FileReader;
                                readerArrayBuffer.onloadend = function (evt) {
                                    var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                    // callapi(readerEvent, blob);
                                    var types = blob.type.split('/');
                                    var extension = types[1];
                                    if (supported_types.includes(extension.toLowerCase())) {
                                        $('.image_container').remove();
                                        var url = URL.createObjectURL(blob);

                                        var image = document.getElementById('image_cropper');
                                        image.src = readerEvent.target.result;
                                        image.onload = function (element) {
                                            $('.group-image-delete').hide();
                                        };
                                        $('#group-image-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        digibiz.cropper = new Cropper(image, {
                                            viewMode: 2,
                                            aspectRatio: 1 / 1,
                                            minContainerWidth: 72,
                                            minContainerHeight: 72,
                                            minCropBoxWidth: 72,
                                            minCropBoxHeight: 72,
                                            maxWidth: 100,
                                            maxHeight: 400,
                                            zoomable: true,
                                            rotatable: true,
                                            responsive: true,
                                            movable: true,
                                            ready: function () {
                                                //cropper.zoom(-0.6);
                                            }
                                        });
                                        removeLoader();
                                    }
                                }
                                readerArrayBuffer.readAsArrayBuffer(file);
                            };
                            readerdataurl.readAsDataURL(file);
                        });
                    }, function (err) {
                        //console.log('error getting the camera media file', err);
                    });
                }
            }, 500)
        } else if (sessionStorage.getItem('customer_id')) {
            if ($('#edit-associate-customer-modal').length > 0) {
                //console.log("associate customer")
                $('#edit-associate-customer-modal').find('.upload-preview-wrapper').addClass('hide');
                $('#camera-modal').remove();
                //CROPPER MODAL
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "associate-customer-identity-picture-modal",
                    modal_header: "",
                    modal_body: `<div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "associate-customer-identity-crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            //console.log("scroll initiated for modal pop-up class")
                            appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    //console.log("added")
                    $('#associate-customer-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#associate-customer-identity-picture-modal').attr('picture-type', 'associate_customer_identity_picture');
                });
                setTimeout(function () {
                    var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        //console.log("browser")
                        window.captureCanvas.toBlob(function (blob) {
                            var reader = new FileReader;
                            reader.onloadend = function (readerEvent) {
                                var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                var types = blob.type.split('/');
                                var extension = types[1];
                                if (supported_types.includes(extension.toLowerCase())) {
                                    //console.log("passed")
                                    $('.image_container').remove();

                                    var image = document.getElementById('image_cropper');
                                    image.src = readerEvent.target.result;
                                    image.onload = function (element) {
                                        $('.group_image_delete').hide();
                                    };
                                    //console.log("kj")
                                    $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    digibiz.cropper = new Cropper(image, {
                                        viewMode: 2,
                                        aspectRatio: 1 / 1,
                                        minContainerWidth: 72,
                                        minContainerHeight: 72,
                                        minCropBoxWidth: 72,
                                        minCropBoxHeight: 72,
                                        maxWidth: 100,
                                        maxHeight: 400,
                                        zoomable: true,
                                        rotatable: true,
                                        responsive: true,
                                        movable: true,
                                        ready: function () {
                                            //cropper.zoom(-0.6);
                                        }
                                    });
                                    removeLoader();
                                }
                            };
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#associate-customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 2,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                    //cropper.zoom(-0.6);
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }
                }, 500)
            } else {
                //console.log("customer")
                $('.upload-preview-wrapper').addClass('hide');
                $('#camera-modal').remove();
                //CROPPER MODAL
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "customer-identity-picture-modal",
                    modal_header: "",
                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "customer-identity-crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            // //console.log("scroll initiated for modal pop-up class")
                            // appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    //console.log("added")
                    $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#customer-identity-picture-modal').attr('picture-type', 'customer_identity_picture');
                });
                setTimeout(function () {
                    var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                    if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                        //console.log("browser")
                        window.captureCanvas.toBlob(function (blob) {
                            var reader = new FileReader;
                            reader.onloadend = function (readerEvent) {
                                var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                                var types = blob.type.split('/');
                                var extension = types[1];
                                if (supported_types.includes(extension.toLowerCase())) {
                                    //console.log("passed")
                                    $('.image_container').remove();

                                    var image = document.getElementById('image_cropper');
                                    image.src = readerEvent.target.result;
                                    image.onload = function (element) {
                                        $('.group_image_delete').hide();
                                    };
                                    //console.log("kj")
                                    $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                    digibiz.cropper = new Cropper(image, {
                                        viewMode: 2,
                                        aspectRatio: 1 / 1,
                                        minContainerWidth: 72,
                                        minContainerHeight: 72,
                                        minCropBoxWidth: 72,
                                        minCropBoxHeight: 72,
                                        maxWidth: 100,
                                        maxHeight: 400,
                                        zoomable: true,
                                        rotatable: true,
                                        responsive: true,
                                        movable: true,
                                        ready: function () {
                                            //cropper.zoom(-0.6);
                                        }
                                    });
                                    removeLoader();
                                }
                            };
                            reader.readAsDataURL(blob);
                        });
                    } else {
                        window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                            entry.file(function (file) {
                                var readerdataurl = new FileReader;
                                readerdataurl.onloadend = function (readerEvent) {
                                    var readerArrayBuffer = new FileReader;
                                    readerArrayBuffer.onloadend = function (evt) {
                                        var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                        // callapi(readerEvent, blob);
                                        var types = blob.type.split('/');
                                        var extension = types[1];
                                        if (supported_types.includes(extension.toLowerCase())) {
                                            $('.image_container').remove();
                                            var url = URL.createObjectURL(blob);

                                            var image = document.getElementById('image_cropper');
                                            image.src = readerEvent.target.result;
                                            image.onload = function (element) {
                                                $('.group_image_delete').hide();
                                            };
                                            $('#customer-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                            digibiz.cropper = new Cropper(image, {
                                                viewMode: 0,
                                                aspectRatio: 1 / 1,
                                                minContainerWidth: 72,
                                                minContainerHeight: 72,
                                                minCropBoxWidth: 72,
                                                minCropBoxHeight: 72,
                                                maxWidth: 100,
                                                maxHeight: 400,
                                                zoomable: true,
                                                rotatable: true,
                                                responsive: true,
                                                movable: true,
                                                ready: function () {
                                                }
                                            });
                                            removeLoader();
                                        }
                                    }
                                    readerArrayBuffer.readAsArrayBuffer(file);
                                };
                                readerdataurl.readAsDataURL(file);
                            });
                        }, function (err) {
                            //console.log('error getting the camera media file', err);
                        });
                    }
                }, 500)
            }
        } else if (sessionStorage.getItem('employee_id')) {
            //console.log("employee")
            $('.upload-preview-wrapper').addClass('hide');
            $('#camera-modal').remove();
            //CROPPER MODAL
            var modal_data = {
                modal_platform: crossplat.device.platform,
                modal_id: "employee-identity-picture-modal",
                modal_header: "",
                modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                modal_action_buttons: [{
                    id: "employee-identity-crop-button",
                    name: `crop`,
                    attr: [{
                        name: "data-id",
                        value: ''
                    }]
                }]
            }
            showModal(modal_data, function () {
                removeLoader();
                if ($('.modal-popup-content').length > 0) {
                    if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                        //console.log("scroll initiated for modal pop-up class")
                        appScroll.scrollBar('.modal-popup-content');
                    }
                }
                //console.log("added")
                $('#employee-identity-picture-modal').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                $('#employee-identity-picture-modal').attr('picture-type', 'employee_identity_picture');
            });
            setTimeout(function () {
                var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    //console.log("browser")
                    window.captureCanvas.toBlob(function (blob) {
                        var reader = new FileReader;
                        reader.onloadend = function (readerEvent) {
                            var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                            var types = blob.type.split('/');
                            var extension = types[1];
                            if (supported_types.includes(extension.toLowerCase())) {
                                //console.log("passed")
                                $('.image_container').remove();

                                var image = document.getElementById('image_cropper');
                                image.src = readerEvent.target.result;
                                image.onload = function (element) {
                                    $('.group_image_delete').hide();
                                };
                                //console.log("kj")
                                $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                digibiz.cropper = new Cropper(image, {
                                    viewMode: 2,
                                    aspectRatio: 1 / 1,
                                    minContainerWidth: 72,
                                    minContainerHeight: 72,
                                    minCropBoxWidth: 72,
                                    minCropBoxHeight: 72,
                                    maxWidth: 100,
                                    maxHeight: 400,
                                    zoomable: true,
                                    rotatable: true,
                                    responsive: true,
                                    movable: true,
                                    ready: function () {
                                        //cropper.zoom(-0.6);
                                    }
                                });
                                removeLoader();
                            }
                        };
                        reader.readAsDataURL(blob);
                    });
                } else {
                    //console.log("123 check");
                    window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                        entry.file(function (file) {
                            var readerdataurl = new FileReader;
                            readerdataurl.onloadend = function (readerEvent) {
                                var readerArrayBuffer = new FileReader;
                                readerArrayBuffer.onloadend = function (evt) {
                                    var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                    // callapi(readerEvent, blob);
                                    var types = blob.type.split('/');
                                    var extension = types[1];
                                    if (supported_types.includes(extension.toLowerCase())) {
                                        $('.image_container').remove();
                                        var url = URL.createObjectURL(blob);

                                        var image = document.getElementById('image_cropper');
                                        image.src = readerEvent.target.result;
                                        image.onload = function (element) {
                                            $('.group_image_delete').hide();
                                        };
                                        $('#employee-identity-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        digibiz.cropper = new Cropper(image, {
                                            viewMode: 2,
                                            aspectRatio: 1 / 1,
                                            minContainerWidth: 72,
                                            minContainerHeight: 72,
                                            minCropBoxWidth: 72,
                                            minCropBoxHeight: 72,
                                            maxWidth: 100,
                                            maxHeight: 400,
                                            zoomable: true,
                                            rotatable: true,
                                            responsive: true,
                                            movable: true,
                                            ready: function () {
                                                //cropper.zoom(-0.6);
                                            }
                                        });
                                        removeLoader();
                                    }
                                }
                                readerArrayBuffer.readAsArrayBuffer(file);
                            };
                            readerdataurl.readAsDataURL(file);
                        });
                    }, function (err) {
                        //console.log('error getting the camera media file', err);
                    });
                }
            }, 500)
        } else if (sessionStorage.getItem('business_id')) {
            var getDeclarationFor = sessionStorage.getItem('camera_for');
            $('#camera-modal').remove();
            $(`.upload-preview-wrapper[data-for="${getDeclarationFor}"]`).addClass('hide');
            if (getDeclarationFor == "business_display_picture") {
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "business-display-picture-modal",
                    modal_header: "",
                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "business-display-crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: ''
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            // //console.log("scroll initiated for modal pop-up class")
                            // appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#business-display-picture-modal').attr('picture-type', 'business_display_picture');
                });
            } else {//for transaction/signature declaration
                //CROPPER MODAL
                var modal_data = {
                    modal_platform: crossplat.device.platform,
                    modal_id: "transaction-signature-picture-modal",
                    modal_header: "",
                    modal_body: ` <div class="image-crop-container"><img id="image_cropper" style="display: block;max-width: 100%;"/></div>`,
                    modal_action_buttons: [{
                        id: "crop-button",
                        name: `crop`,
                        attr: [{
                            name: "data-id",
                            value: getDeclarationFor
                        }]
                    }]
                }
                showModal(modal_data, function () {
                    removeLoader();
                    if ($('.modal-popup-content').length > 0) {
                        if (crossplat.device.platform == "browser" || crossplat.device.platform == "desktop") {
                            // //console.log("scroll initiated for modal pop-up class")
                            // appScroll.scrollBar('.modal-popup-content');
                        }
                    }
                    $('.custom-modal-popup').find('.custom-modal-wrapper').addClass('cropper-wrapper');
                    $('#transaction-signature-picture-modal').attr('data-id', getDeclarationFor);
                });
            }
            setTimeout(function () {
                var supported_types = ['png', 'jpeg', 'jpg', 'PNG', 'JPEG', 'JPG'];
                if (crossplat.device.platform == 'browser' || crossplat.device.platform == 'desktop') {
                    window.captureCanvas.toBlob(function (blob) {
                        var reader = new FileReader;
                        reader.onloadend = function (readerEvent) {
                            var blob = dataURLToBlob(reader.result, { type: "image/jpg" });
                            var types = blob.type.split('/');
                            var extension = types[1];
                            if (supported_types.includes(extension.toLowerCase())) {
                                $('.image_container').remove();

                                var image = document.getElementById('image_cropper');
                                image.src = readerEvent.target.result;
                                image.onload = function (element) {
                                    $('.group_image_delete').hide();
                                };
                                $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                digibiz.cropper = new Cropper(image, {
                                    viewMode: 2,
                                    aspectRatio: 1 / 1,
                                    minContainerWidth: 72,
                                    minContainerHeight: 72,
                                    minCropBoxWidth: 72,
                                    minCropBoxHeight: 72,
                                    maxWidth: 100,
                                    maxHeight: 400,
                                    zoomable: true,
                                    rotatable: true,
                                    responsive: true,
                                    movable: true,
                                    ready: function () {
                                        //cropper.zoom(-0.6);
                                    }
                                });
                                removeLoader();
                            }
                        };
                        reader.readAsDataURL(blob);
                    });
                } else {
                    window.resolveLocalFileSystemURL(window.cameraMediaFile, function (entry) {
                        entry.file(function (file) {
                            var readerdataurl = new FileReader;
                            readerdataurl.onloadend = function (readerEvent) {
                                var readerArrayBuffer = new FileReader;
                                readerArrayBuffer.onloadend = function (evt) {
                                    var blob = new Blob([evt.target.result], { type: 'image/jpeg' });
                                    // callapi(readerEvent, blob);
                                    var types = blob.type.split('/');
                                    var extension = types[1];
                                    if (supported_types.includes(extension.toLowerCase())) {
                                        $('.image_container').remove();
                                        var url = URL.createObjectURL(blob);

                                        var image = document.getElementById('image_cropper');
                                        image.src = readerEvent.target.result;
                                        image.onload = function (element) {
                                            $('.group_image_delete').hide();
                                        };
                                        $('#transaction-signature-picture-modal, #business-display-picture-modal').css({ "display": "flex", "background": "rgba(0,0,0,0.6)" }).addClass('modal-slide-top');
                                        digibiz.cropper = new Cropper(image, {
                                            viewMode: 2,
                                            aspectRatio: 1 / 1,
                                            minContainerWidth: 72,
                                            minContainerHeight: 72,
                                            minCropBoxWidth: 72,
                                            minCropBoxHeight: 72,
                                            maxWidth: 100,
                                            maxHeight: 400,
                                            zoomable: true,
                                            rotatable: true,
                                            responsive: true,
                                            movable: true,
                                            ready: function () {
                                                //cropper.zoom(-0.6);
                                            }
                                        });
                                        removeLoader();
                                    }
                                }
                                readerArrayBuffer.readAsArrayBuffer(file);
                            };
                            readerdataurl.readAsDataURL(file);
                        });
                    }, function (err) {
                        //console.log('error getting the camera media file', err);
                    });
                }
            }, 500);
        }
    }
}

function digibizActivitySettingsPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            removeLoader();
            resolve();
        }, "page/profile/digibiz_activity_hub", "#digibiz-activity-hub-page-template", "#main-content-wrapper", null);
    })
}


function groupDeviceChange(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.device_change_group, "POST", "JSON", requestParms);
    });
}

function teamManagementHubPage() {
    return new Promise((resolve, reject) => {
        fetch.replaceHtml(function () {
            $('.view-digibiz-back-button').removeClass('hide');
            removeLoader();
            var slider = new Swiper('.hubSwiper', {
                slidesPerView: 1,
                spaceBetween: 0,
                grabCursor: true,
                observer: true,
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                }
            });
            $(".swiper").removeClass("hubSwiper");
            resolve();
        }, "page/business/team_management_hub", "#team-management-land-page", "#main-content-wrapper", null);
    })
}

function teamGroupsListPage() {
    return new Promise((resolve, reject) => {
        addLoader();
        var reqParam = {
            device_id: crossplat.device.uuid,
            type: "teams",
            list_by: "all_teams_groups",
            business_id: sessionStorage.getItem('business_id'),
            count: 15,
            offset: 0
        }
        getGroupsCount(reqParam).then((groupsCount) => {
            groupsList(reqParam)
                .then((response) => {
                    //console.log("employeeGroupList response", response);
                    fetch.replaceHtml(function () {
                        // $('.teams-groups-count').text(groupsCount);
                        $('.header_primary').text(`Team Groups(#${groupsCount})`);
                        digibiz.team_groups_list_page = [];
                        processTeamGroupsList(response, function () {
                            appScroll.scrollBar('.team-groups-list-wrapper');
                            listenForTeamGroupsListScrollEvent($('.team-groups-list-wrapper'));
                            removeLoader();
                            resolve();
                        });
                    }, "page/teams/team_groups_list_wrapper", "#team-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/teams/team_groups_list_data", "#team-groups-list-data-template", "#team-groups-list-wrapper", null);
                    }, "page/teams/team_groups_list_wrapper", "#team-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
        }).catch((err) => {
            console.log('err', err);
        })
    })

}

function processTeamGroupsList(data, callback) {
    digibiz.team_groups_list_page = removeDuplicates(digibiz.team_groups_list_page.concat(data), "id");
    var teamGroupsList = {
        team_groups_list_data: digibiz.team_groups_list_page.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("customEmployeesGroupsList", customEmployeesGroupsList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/teams/team_groups_list_data", "#team-groups-list-data-template", "#team-groups-list-wrapper", teamGroupsList);
}

function listenForTeamGroupsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader()
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "teams",
                list_by: "all_teams_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.team_groups_list_page.length
            }
            groupsList(reqParam)
                .then((response) => {
                    //console.log("employeeGroupList response", response);
                    removeLoader();
                    scrollProcessTeamGroupsList(response, function () {
                        listenForTeamGroupsListScrollEvent($('.team-groups-list-wrapper'));
                    }).catch((err) => {
                        removeLoader();
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/teams/team_groups_list_data", "#team-groups-list-data-template", "#team-groups-list-wrapper", null);
                    })
                })
        }
    })
}

function scrollProcessTeamGroupsList(data, callback) {
    digibiz.team_groups_list_page = removeDuplicates(digibiz.team_groups_list_page.concat(data), "id");
    var teamGroupsList = {
        team_groups_list_data: data.map(e => {
            if (e.hasOwnProperty('group_image') && e.group_image) {
                if (e.group_image.hasOwnProperty('thumbnail') && e.group_image.thumbnail) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.id}&image_id=${e.group_image.thumbnail}`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("customEmployeesGroupsList", customEmployeesGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/teams/scroll_team_groups_list_data", "#scroll-team-groups-list-data-template", "#team-groups-list-wrapper", teamGroupsList);
}

function teamGroupCreationPage() {
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('group_id')) {
            $('#add_employee_group_moderator').removeClass('hide');
            var reqparams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id')
            }
            // console.log('reqparams',reqparams);
            groupGet(reqparams)
                .then((response) => {
                    var moderatorData = [];
                    var modReqParams = {
                        device_id: crossplat.device.uuid,
                        id: sessionStorage.getItem('group_id'),
                        count: 5,
                        offset: 0
                    }
                    getGroupModeratorList(modReqParams).then((moderatorResponse) => {
                        digibiz.group_moderator_list = [];
                        digibiz.group_moderator_list = moderatorResponse.moderator;
                        //console.log("employeeGroupGet response", response);
                        if (response.hasOwnProperty('group_image') && response.group_image) {
                            if (response.group_image.hasOwnProperty('thumbnail') && response.group_image.thumbnail) {
                                var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${response.id}&image_id=${response.group_image.thumbnail}`;
                                response.group_image['avtarUrl'] = avtarUrl;
                                response['imageLetter'] = response.name.charAt(0);
                            } else {
                                response['imageLetter'] = response.name.charAt(0);
                            }
                        } else {
                            response['imageLetter'] = response.name.charAt(0);
                        }
                        // if (response.hasOwnProperty('moderator') && response.moderator) {
                        //     moderatorData = response.moderator.map(e => {
                        //         if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        //             if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                        //                 var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                        //                 e.data.identity_picture['avtarUrl'] = avtarUrl;
                        //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                        //             } else {
                        //                 e.data['imageLetter'] = e.data.name.first.charAt(0);
                        //             }
                        //         } else {
                        //             e.data['imageLetter'] = e.data.name.first.charAt(0);
                        //         }
                        //         return e;
                        //     })
                        // }
                        var groupData = {
                            group_data: response,
                            // group_moderator_data: moderatorData
                        }
                        console.log("groupData", groupData);
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                console.log('test sctoll 1');
                                appScroll.scrollBar('#main-container');
                                processGroupModeratorList(digibiz.group_moderator_list, function () {
                                    appScroll.scrollBar('#employee-group-moderator-members-list');
                                    listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                                });
                                resolve();
                            }
                        }, "page/common/teams_group_creation", "#teams-group-creation-template", "#main-content-wrapper", groupData);
                    }).catch((err) => {
                        console.log('err', err);
                    })
                })
                .catch((err) => {
                    //console.log("error in employee group get");
                    removeLoader();
                    resolve();
                })

        } else {
            fetch.replaceHtml(function (err) {
                if (!err) {
                    $('#add_employee_group_moderator').addClass('hide');
                    removeLoader();
                    console.log('test sctoll 2');
                    resolve();
                }
            }, "page/common/teams_group_creation", "#teams-group-creation-template", "#main-content-wrapper", null);
        }
    })
}


function processTeamGroupCreateEmployeeSelectionList(data, groupResponse, callback) {
    digibiz.teamGroupEmployeeSelectionList = removeDuplicates(digibiz.teamGroupEmployeeSelectionList.concat(data), "id");
    var EmployeeList = {
        EmployeeList: digibiz.teamGroupEmployeeSelectionList.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            var getIndex = digibiz.alreadySelected.findIndex((o) => o.id == e.dj_unique_employee_id);
            if (getIndex > -1) {
                // var getValue = digibiz.teamGroupEmployeeSelectionList[getIndex].selected;
                // if (getValue == true) {
                //     e['selected'] = true;
                // }
                e['selected'] = true;
            }
            return e;
        }),
        from: "direct"
    }
    console.log("EmployeeList", EmployeeList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            if (digibiz.alreadySelected.length > 0) {
                $.each(digibiz.alreadySelected, function (index, element) {
                    if (element.type == "new_member") {
                        $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                    } else if (element.type == "old_member") {
                        // $('#communication-group-employee-members-list').find(`.communication-group-member-wrapper[data-employee-id="${element.id}"]`).remove();
                        $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                    }
                })
                if ($('#modal-communication-group-activate-employee-group-employee-list-selection').find(`.contact-profile-container`).length > 0) {
                    //console.log("empty modal")
                } else {
                    $('.employee-selection-member-list').append('<div class="no-data">No Employees found</div>');
                }
            }
            callback();
        }
    }, 'page/communication/employee_selection_list', '#employee-selection-list-template', '#communication-group-activate-employee-group-employee-list-wrapper', EmployeeList);
}

function processSearchedTeamGroupCreateEmployeeSelectionList(data, callback) {
    if (data.length > 0) {
        var EmployeeList = {
            EmployeeList: data.map(e => {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.first.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.first.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
                //automatic checked while searching
                var getIndex = digibiz.teamGroupEmployeeSelectionList.findIndex((o) => o.id == e.id);
                if (getIndex > -1) {
                    var getValue = digibiz.teamGroupEmployeeSelectionList[getIndex].selected;
                    if (getValue == true) {
                        e['selected'] = true;
                    }
                }
                return e;
            }),
            from: "direct"
        }
        //console.log("EmployeeList", EmployeeList);
        fetch.replaceHtml(function (err) {
            if (!err) {
                if (digibiz.alreadySelected.length > 0) {
                    $.each(digibiz.alreadySelected, function (index, element) {
                        if (element.type == "new_member") {
                            $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                        } else if (element.type == "old_member") {
                            // $('#communication-group-employee-members-list').find(`.communication-group-member-wrapper[data-employee-id="${element.id}"]`).remove();
                            $(`.contact-profile-container[data-dj-unique-employee-id="${element.id}"]`).parent('.employee-selection-list-container').remove();
                        }
                    })
                    if ($('#modal-communication-group-employees-selection').find(`.contact-profile-container`).length > 0) {
                        //console.log("empty modal")
                    } else {
                        $('.employee-selection-member-list').append('<div class="no-data">No Employees found</div>');
                    }
                }
                callback();
            }
        }, 'page/communication/employee_selection_list', '#employee-selection-list-template', '#communication-group-activate-employee-group-employee-list-wrapper', EmployeeList);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, 'page/communication/employee_selection_list', '#employee-selection-list-template', '#communication-group-activate-employee-group-employee-list-wrapper', null);
    }
}


function teamsGroupInactive(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.inactive_group, "POST", "JSON", requestParms);
    });
}

function getImageUrl(params) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status === 'success') {
                resolve();
            } else {
                reject(response.responseText);
            }
        }, params, "GET", "JSON");
    })
}

function listenForActiveEmployeeListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_all_active",
                count: 5,
                offset: digibiz.active_employee_creation_employee_list.length
            }

            employeeList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessActiveEmployeeCreationEmployeeList(response, function () {
                        listenForActiveEmployeeListScrollEvent($(".employee-creation-list-contentbox"));

                    });
                }).catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_active_employee_creation_list_data", "#scroll-active-employee-creation-data-list-template", "#active-employee-creation-list-wrapper .os-content", null);

                });

        }
    });
}

async function scrollProcessActiveEmployeeCreationEmployeeList(data, callback) {
    digibiz.active_employee_creation_employee_list = removeDuplicates(digibiz.active_employee_creation_employee_list.concat(data), "dj_unique_employee_id");
    var employeeList = {
        employee_creation_employee_list_data: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     if (err == "File not found-deleted or moved from cloud storage") {
                    //         e['imageLetter'] = e.name.first.charAt(0);
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                    //         e['imageLetter'] = e.name.first.charAt(0);
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    //     } else if (err == "Cloud storage not authenticated") {
                    //         e['imageLetter'] = e.name.first.charAt(0);
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    //         $(`.employee-wrapper[data-employee-id="${e.dj_unique_employee_id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('img').attr('src', "");
                    //     }
                    // })

                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    console.log("employeeList", employeeList);
    // setTimeout(function () {
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
            $(document).find('.expand-search-wrap').removeClass('active').children('.expand-search-input').val('').removeClass('searchexpand');
            removeLoader();
            document.getElementsByClassName('searchclosebtn')[0].style.display = 'none';

        }
    }, "page/common/scroll_active_employee_creation_list_data", "#scroll-active-employee-creation-data-list-template", "#active-employee-creation-list-wrapper .os-content", employeeList);
    // }, 1000)
}

function listenForPendingeEmployeeListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "pending_employees",
                count: 5,
                offset: digibiz.pending_employee_creation_employee_list.length
            }

            notificationList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessPendingEmployeeCreationEmployeeList(response, function () {
                        listenForPendingeEmployeeListScrollEvent($(".employee-creation-list-contentbox"));

                    });
                }).catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_pending_employee_creation_list_data", "#scroll-pending-employee-creation-data-list-template", "#pending-employee-creation-list-wrapper .os-content", null);

                });

        }
    });
}

function scrollProcessPendingEmployeeCreationEmployeeList(data, callback) {
    // //console.log("data", data);
    digibiz.pending_employee_creation_employee_list = removeDuplicates(digibiz.pending_employee_creation_employee_list.concat(data), "id");
    // //console.log("check 1", digibiz.pending_employee_creation_employee_list)
    var employeeList = {
        employee_creation_employee_list_data: data
        // .map((e, index) => {
        //     e['createdDate'] = moment.unix(e.createdDate).format('MMM D YYYY hh:mm:ss A');
        //     e['updatedDate'] = moment.unix(e.updatedDate).format('MMM D YYYY hh:mm:ss A');
        //     e['expiryDate'] = moment.unix(e.expiryDate).format('MMM D YYYY hh:mm:ss A');
        //     return e;
        // })
    };
    //console.log("employeeList", employeeList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_pending_employee_creation_list_data", "#scroll-pending-employee-creation-data-list-template", "#pending-employee-creation-list-wrapper .os-content", employeeList);
}

function listenForAluminiEmployeeListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "alumini",
                count: 5,
                offset: digibiz.alumini_employee_list.length
            }
            employeeList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessAluminiEmployeeList(response, function () {
                        listenForAluminiEmployeeListScrollEvent($(".employee-creation-list-contentbox"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_alumini_employee_creation_list_data", "#scroll-alumini-employee-creation-data-list-template", "#alumini-employee-creation-list-wrapper .os-content", null);
                })

        }
    });
}

function scrollProcessAluminiEmployeeList(data, callback) {
    digibiz.alumini_employee_list = removeDuplicates(digibiz.alumini_employee_list.concat(data), "dj_unique_employee_id");
    var employeeList = {
        employee_creation_employee_list_data: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("employeeList", employeeList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_alumini_employee_creation_list_data", "#scroll-alumini-employee-creation-data-list-template", "#alumini-employee-creation-list-wrapper .os-content", employeeList);
}


function collaboratorCustomerAdd(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.add_collaborator_customer, "POST", "JSON", requestParms);
    });
}


function collaboratorCustomerDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_collaborator_customer, "POST", "JSON", requestParms);
    });
}

function collaboratorIdentifierCustomerDelete(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.delete_collaborator_identifier_customer, "POST", "JSON", requestParms);
    });
}


function processCollaboratorCustomerBusinessList(data, callback) {
    console.log('000', data);
    // digibiz.customer_collaborator_business_list = removeDuplicatesFromMultipleProperties(digibiz.customer_collaborator_business_list.concat(data), 'customer_id', 'type');
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    digibiz.customer_collaborator_business_list = digibiz.customer_collaborator_business_list.concat(data);
    var businessList = {
        customer_business_list_data: digibiz.customer_collaborator_business_list.map(e => {
            joinRoom(e.id);
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    if (digibiz.customer_collaborator_business_list.length > 0) {
        console.log("business is there")
    } else {
        location.hash = `jeevi/app/hub`;
        console.log('5555555');
    }
    fetch.replaceHtml(function (err) {
        if (!err) {

            callback();
        }
    }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", businessList);
}


function collaboratorCustomerListPage() {
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            list_by: "my_collaborator_customers"
        }
        collaboratorCustomerCount().then((count) => {            
        collaboratorCustomerList(reqParam)
            .then((response) => {
                console.log("collaboratorsCustomerList response", response);
                fetch.replaceHtml(function () {
                    processCollaboratorCustomerList(response, function () {
                        $('.collaborator-groups-list-title-band').find('span').text(`Collaborator Customers(#${count})`)
                        removeLoader();
                        resolve();
                    });
                }, "page/collaborator/customer_list_wrapper", "#collaborator-customers-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/collaborator/customer_list_data", "#collaborator-customers-list-data-template", "#collaborator-customer-list-wrapper", null);
                }, "page/collaborator/customer_list_wrapper", "#collaborator-customers-list-wrapper-template", "#main-content-wrapper", null);
            })
        }).catch((err) => {
            console.log('err',err);
        })
    })
}

function processCollaboratorCustomerList(data, callback) {
    digibiz.collaborator_customer_list = removeDuplicates(digibiz.collaborator_customer_list.concat(data), "identifier_id");
    var getData = {
        collaborator_customer_list_data: digibiz.collaborator_customer_list.map(e => {
            //console.log("e", e);
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("getData", getData);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/customer_list_data", "#collaborator-customers-list-data-template", "#collaborator-customers-list-wrapper", getData);
}


function processCollaboratorEmployeeSectionList(data = null, customerData = null, callback) {
    console.log("processCommunicationGroupActivateEmployeeGroupEmployeeList", data);
    console.log('customerData', customerData);
    if (data) {
        digibiz.collaborator_employee_list = removeDuplicates(digibiz.collaborator_employee_list.concat(data), 'id');
    }
    if (customerData && customerData.length > 0) {
        $.each(customerData, function (index, customer) {
            if (customer.hasOwnProperty('role') && customer.role.id) {
                // //console.log("&", $(`.accordion-content[data-group-id="${moderator.group_id}"]`))
                // //console.log("&&&", $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`))
                // //console.log("&@@@@", $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper'))
                // $(`.accordion-content[data-group-id="${moderator.group_id}"]`).find(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                //this line wont be executed because still html content is not loaded here
                $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${customer.role.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').addClass('selected-row');
                //check in the global array
                // var getIndex = digibiz.communicationActivateEmployeeGroupEmployeeList.findIndex((e) => e.member.id == moderator.group_id);
                // if (getIndex > -1) {
                //     var getRecord = digibiz.communicationActivateEmployeeGroupEmployeeList.find((e) => e.member.id == moderator.group_id);
                //     var getEmployeeIndex = getRecord.group_members.findIndex((e) => e.dj_unique_employee_id == moderator.id);
                //     if (getEmployeeIndex > -1) {
                //         digibiz.communicationActivateEmployeeGroupEmployeeList[getIndex].group_members[getEmployeeIndex]['selected'] = true;
                //     }
                // }
                digibiz.employeeSelectedContactList.push({
                    id: customer.role.id,
                    business_id: customer.role.business_id,
                    selected: true
                })
            }
        })
    }
    //put it in modal

    var getData = {
        EmployeeList: digibiz.collaborator_employee_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "employee_list"
    };

    console.log("getData", getData);
    fetch.replaceHtml(function () {
        $('.expand-search-wrap').removeClass('active').children('.expand-search-input').val('').removeClass('searchexpand');
        //check already present moderator in the modal
        if (digibiz.alreadySelected.length > 0) {
            $.each(digibiz.alreadySelected, function (index, customer) {
                // if (moderator.hasOwnProperty('group_id') && moderator.group_id) {
                $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${customer.role.id}"]`).parents('.communication-group-employee-select-btn-checkbox-click-wrapper').addClass('selected-row');
                // }
                //  else {
                //     $(`.communication-group-employee-select-btn[data-dj-unique-employee-id="${moderator.id}"]`).prop('checked', true);
                // }
            })
        }
        callback();
    }, "page/collaborator/collaborator_employee_selection_list", "#collaborator-employee-selection-list-template", '#communication-group-activate-employee-group-employee-list-wrapper', getData);
}

//get all the customers of this identifier who are active/accepted
function activeCollaboratorCustomerListPage() {
    addLoader();
    return new Promise((resolve, reject) => {
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            // identifier_id: sessionStorage.getItem('identifier_id'),
            list_by: "received_collaborator_business_list"
        }
        collaboratorCustomerList(reqParam)
            .then((response) => {
                console.log("customerList response", response);
                fetch.replaceHtml(function () {
                    processCollaboratorBusinessCustomerList(response, function () {
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/collaborator_business_customers_wrapper", "#collaborator-business-customers-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                fetch.replaceHtml(function () {
                    fetch.replaceHtml(function (err) {
                        if (!err) {
                            removeLoader();
                            resolve();
                        }
                    }, "page/customer/collaborator_business_customers_data", "#collaborator-business-customers-list-data-template", "#collaborator-business-customers-list-wrapper", null);
                }, "page/customer/collaborator_business_customers_wrapper", "#collaborator-business-customers-list-wrapper-template", "#main-content-wrapper", null);
            })

    });
}

function processCollaboratorBusinessCustomerList(data, callback) {
    digibiz.collaborator_business_customer_list = removeDuplicates(digibiz.collaborator_business_customer_list.concat(data), "identifier_id");
    var customerList = {
        collaborator_business_customers_list_data: digibiz.collaborator_business_customer_list.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.first.charAt(0);
                    //     $(`.active-customer-wrapper[data-customer-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    // })
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    //console.log("customerList", customerList);
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/collaborator_business_customers_data", "#collaborator-business-customers-list-data-template", "#collaborator-business-customers-list-wrapper", customerList);
}

function collaboratorCustomerBusinessUpdate(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.update_collaborator_business_customer, "POST", "JSON", requestParms);
    });
}


function collaboratorCustomerCreatePage() {
    addLoader();
    return new Promise((resolve, reject) => {
        if (sessionStorage.getItem('digibiz_role') == "customer" && sessionStorage.getItem('edit_from') == "profile_page") {
            var reqParams = {
                device_id: crossplat.device.uuid,
                get_by: "id",
                id: sessionStorage.getItem('customer_id')
            }
            //get customer details
            customerGet(reqParams)
                .then((result) => {
                    if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                        if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                            result.identity_picture['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     if (err == "File not found-deleted or moved from cloud storage") {
                            //         delete result.identity_picture['avtarUrl'];
                            //         $('.customer-identity-picture-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-picture-delete').remove();
                            //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                            //         //append photo_camera first and then delete
                            //         $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                            //         $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                            //         $('#customer_identity_picture').remove();
                            //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                            //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                            //         delete result.identity_picture['avtarUrl'];
                            //         $('.customer-identity-picture-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-picture-delete').remove();
                            //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                            //         $('#customer_identity_picture').remove();
                            //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                            //     } else if (err == "Cloud storage not authenticated") {
                            //         delete result.identity_picture['avtarUrl'];
                            //         $('.customer-identity-picture-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-picture-delete').remove();
                            //         $('.customer-add-identity-picture-container').find('.mask').removeClass('hide');

                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer_identity_pic_preview').remove();
                            //         // $('#customer_identity_picture').siblings('.mask').find('.customer-identity-picture-multimedia-load-btn').remove();
                            //         $('#customer_identity_picture').remove();
                            //         $('.identity-picture-wrapper').find('.mask').append(`<a class="info customer-identity-picture-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-picture-load-btn">add</i></a>`);
                            //     }
                            // })
                        }
                    }
                    if (result.hasOwnProperty('identity_video') && result.identity_video) {
                        if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                            result.identity_video['avtarUrl'] = avtarUrl;
                            // getImageUrl(avtarUrl).then((res) => {
                            // }).catch((err) => {
                            //     if (err == "File not found-deleted or moved from cloud storage") {
                            //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                            //         delete result.identity_video['avtarUrl'];
                            //         $('.customer-identity-video-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-video-delete').remove();
                            //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                            //         //append photo_camera first and then delete
                            //         $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                            //         $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                            //         $('#customer_identity_video').remove();
                            //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);

                            //     } else if (err == "Cloud storage token revoked/expired ! Please try again later") {
                            //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                            //         delete result.identity_video['avtarUrl'];
                            //         $('.customer-identity-video-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-video-delete').remove();
                            //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                            //         $('#customer_identity_video').remove();
                            //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);
                            //         $('.identity-picture-wrapper').find('.mask').append(`<span class="error-alert-message"><span class="error-alert-icon">Alert</span></span>`);
                            //     } else if (err == "Cloud storage not authenticated") {
                            //         // response['imageLetter'] = response.name.first.charAt(0);                                   
                            //         delete result.identity_video['avtarUrl'];
                            //         $('.customer-identity-video-multimedia-load-btn').remove();
                            //         //remove delete
                            //         $('#customer-identity-video-delete').remove();
                            //         $('.customer-add-identity-video-container').find('.mask').removeClass('hide');
                            //         //append photo_camera first and then delete
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer_identity_video_preview').remove();
                            //         // $('#customer_identity_video').siblings('.mask').find('.customer-identity-video-multimedia-load-btn').remove();
                            //         $('#customer_identity_video').remove();
                            //         $('.identity-video-wrapper').find('.mask').append(`<a class="info customer-identity-video-multimedia-load-btn cursor_pointer"><i class="material-icons" id="customer-identity-video-load-btn">add</i></a>`);

                            //     }
                            // })
                        }
                    }
                    var customerData = {
                        customerData: result
                    }
                    fetch.replaceHtml(function () {
                        mobileFlaginit();
                        //change heading content
                        $('.customer-create-heading-name').text('Customer Details');
                        //hide main header
                        $('.header-band').addClass('hide');
                        //hide fields which are not to be shown
                        $('.customer-add-label-container').remove();
                        $('.customer-add-display-name-container').remove();
                        $('.customer-add-email-container').remove();
                        $('.customer-add-identifier-container').remove();
                        $('.employee-add-date-of-joining-container').remove();
                        $('.customer-back-btn').remove();
                        $('.customer-forward-btn').remove();
                        $('.register-customer-btn').remove();
                        $('.notify-customer-btn').remove();
                        $('.wizard-progress-container').remove();
                        $(`.customer-creation-parts-container[data-step="1"]`).remove();
                        $(`.customer-creation-parts-container[data-step="3"]`).remove();
                        $(`.customer-creation-parts-container[data-step="4"]`).remove();
                        //show the 2nd page content
                        $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                        //show save button
                        $('.save-customer-btn').removeClass('hide');
                        calenderInit('#customer_date_of_birth');
                        calenderInit('#customer_wedding_anniversary');
                        removeLoader();
                        resolve();
                    }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                })
                .catch((err) => {
                    console.log("err", err);
                    removeLoader();
                    Materialize.toast(err.msg, 3000, 'round error-alert');
                })
        } else {
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "customer"
            }
            //get the primary customer identifiers list(for the sake of dropdown)
            customerIdentifierList(reqParam)
                .then((response) => {
                    //check for customer_id presence
                    if (sessionStorage.getItem('business_id')) {
                        var reqParams = {
                            device_id: crossplat.device.uuid,
                            get_by: "id",
                            collaborator_business_customers_id: sessionStorage.getItem('collaborator_business_customers_id'),
                            id: sessionStorage.getItem('business_id')
                        }
                        //get customer details
                        collaboratorBusinessCustomerIdentifierGet(reqParams)
                            .then((result) => {
                                //         //console.log("result", result);
                                //         if (result.hasOwnProperty('identity_picture') && result.identity_picture) {
                                //             if (result.identity_picture.hasOwnProperty('thumbnail') && result.identity_picture.thumbnail) {
                                //                 var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_picture.thumbnail}`;
                                //                 result.identity_picture['avtarUrl'] = avtarUrl;


                                //             }
                                //         }
                                //         if (result.hasOwnProperty('identity_video') && result.identity_video) {
                                //             if (result.identity_video.hasOwnProperty('thumbnail') && result.identity_video.thumbnail) {
                                //                 var avtarUrl = `${api.get_customer_identity_picture}?id=${sessionStorage.getItem('customer_id')}&device_id=${crossplat.device.uuid}&image_id=${result.identity_video.thumbnail}`;
                                //                 result.identity_video['avtarUrl'] = avtarUrl;

                                //             }
                                //         }


                                //console.log("activeAssociateCustomerResponse", activeAssociateCustomerResponse);
                                //success, second api call to notification collection to get all pending associate customers for this particular primary customer



                                //console.log("roleManagementList response", roleresponse);
                                var customerData = {
                                    customerData: result,
                                    customerIdentifierList: response
                                }
                                console.log("customerData", customerData);
                                fetch.replaceHtml(function () {
                                    mobileFlaginit();
                                    calenderInit('#customer_date_of_birth');
                                    calenderInit('#customer_wedding_anniversary');
                                    //update customer identifier
                                    // if (result.hasOwnProperty('identifier_id') && result.identifier_id) {
                                    //     $('#customer-identifier-choose-select-dropdown').val(result.identifier_id);
                                    // }

                                    //update the next and back button with step 2
                                    $('.customer-back-btn').attr('data-present-step', '2');
                                    $('.customer-forward-btn').attr('data-present-step', '2');
                                    //update the stepper
                                    $('.customer-create-stepper').removeClass('is-active');
                                    $(`.customer-create-stepper[data-stepper="2"]`).addClass('is-active');
                                    //show the next content
                                    $(`.customer-creation-parts-container[data-step="1"]`).addClass('hide');
                                    $(`.customer-creation-parts-container[data-step="2"]`).removeClass('hide');
                                    //hide the notify button and show the next button
                                    $('.notify-customer-btn').addClass('hide');
                                    $('.customer-forward-btn').removeClass('hide');
                                    if (sessionStorage.getItem('digibiz_role') == "customer") {
                                        $('div[contenteditable="true"][type="text"]').attr("contenteditable", false);
                                        $('div[type="text"]').prop('disabled', true);
                                        $('input[type="text"]').prop('disabled', true);
                                        $('.mask').addClass('hide');
                                        $('input[type="tel"]').prop('disabled', true);
                                        $('.reassign-customer-btn').prop('disabled', true);
                                        $('#customer_associate_customer_assignment_btn').prop('disabled', true);
                                        $('#show_action_customer_associate-customer_assignment').prop('disabled', true);
                                    }
                                    removeLoader();
                                    resolve();
                                }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);



                            })
                            .catch((err) => {
                                console.log("error in employeeGet")
                            })
                    } else {//not customer_id
                        var customerData = {
                            customerIdentifierList: response,
                        }
                        fetch.replaceHtml(function () {
                            mobileFlaginit();
                            calenderInit('#customer_date_of_birth');
                            calenderInit('#customer_wedding_anniversary');
                            removeLoader();
                            resolve();
                        }, "page/customer/customer_create", "#customer-create-template", "#main-content-wrapper", customerData);
                    }
                })
                .catch((err) => {
                    removeLoader();
                    //console.log("error in getting customer identifiers list");
                })
        }
    });
}


function collaboratorBusinessCustomerIdentifierGet(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.Data);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.get_collaborator_business_customer, "POST", "JSON", requestParms);
    });
}

function collaboratorCustomerReassign(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.msg);
            } else {
                var err = JSON.parse(response.responseText);
                reject(err);
            }
        }, api.collaborator_reassign_customer, "POST", "JSON", requestParms);
    });
}


function listenForCustomerIdentifiersActiveCustomerCreationListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            // digibiz.customer_identifiers_active_customers_list = [];
            var getDataType = {
                type: "active_customers"
            }
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "customer",
                offset: digibiz.customer_identifiers_active_customers_list.length,
                count: 5
            }
            customerIdentifierList(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierList response", response);
                    // fetch.replaceHtml(function () {
                    scrollProcessCustomerIdentifiersActiveCustomerCreationList(response, function () {
                        // appScroll.scrollBar$(".active-customer-identifiers-list-contentbox");
                        listenForCustomerIdentifiersActiveCustomerCreationListScrollEvent($(".active-customer-identifiers-list-contentbox"));
                        removeLoader();
                    });
                    // }, "page/customer/customer_creation_identifiers_list_wrapper", "#customer-creation-identifiers-list-wrapper-template", "#active-customer-list-data-container", getDataType);
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCustomerIdentifiersActiveCustomerCreationList(data, callback) {
    digibiz.customer_identifiers_active_customers_list = removeDuplicates(digibiz.customer_identifiers_active_customers_list.concat(data), "id");
    var customerIdentifiersList = {
        customer_identifiers_list_data: data,
        type: "active_customers"
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_customer_creation_identifiers_list_data", "#scroll-customer-creation-identifiers-data-list-template", "#active-customer-creation-identifiers-list-wrapper .os-content", customerIdentifiersList);
}


function listenForCustomerIdentifiersScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "customer",
                offset: digibiz.customer_identifiers.length,
                count: 5
            }
            customerIdentifierList(reqParam)
                .then((response) => {
                    console.log("customerIdentifierList response", response);
                    // fetch.replaceHtml(function () {
                    scrollProcessCustomerIdentifiersList(response, function () {
                        // appScroll.scrollBar('.customer-identifiers-list-contentbox');
                        listenForCustomerIdentifiersScrollEvent($(".customer-identifiers-list-contentbox"));
                        removeLoader();
                    });
                    // }, "page/customer/customer_identifiers_list_wrapper", "#customer-identifiers-list-wrapper-template", "#customer-identifiers-list-data-container", null);
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCustomerIdentifiersList(data, callback) {
    digibiz.customer_identifiers = removeDuplicates(digibiz.customer_identifiers.concat(data), "id");
    var customerIdentifiersList = {
        customer_identifiers_list_data: data
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_customer_identifiers_list_data", "#scroll-customer-identifiers-data-list-template", "#customer-identifiers-list-wrapper .os-content", customerIdentifiersList);
}


function listenForCustomerIdentifiersPendingCustomerScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var getDataType = {
                type: "pending_customers"
            }
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "customer",
                offset: digibiz.customer_identifiers_pending_customers_list.length,
                count: 5
            }
            customerIdentifierList(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierList response", response);
                    // fetch.replaceHtml(function () {
                    scrollProcessCustomerIdentifiersPendingCustomerCreationList(response, function () {
                        // appScroll.scrollBar('.pending-customer-identifiers-list-contentbox');
                        listenForCustomerIdentifiersPendingCustomerScrollEvent($(".pending-customer-identifiers-list-contentbox"));
                        removeLoader();
                    });
                    // }, "page/customer/customer_creation_identifiers_list_wrapper", "#customer-creation-identifiers-list-wrapper-template", "#pending-customer-list-data-container", getDataType);
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessCustomerIdentifiersPendingCustomerCreationList(data, callback) {
    digibiz.customer_identifiers_pending_customers_list = removeDuplicates(digibiz.customer_identifiers_pending_customers_list.concat(data), "id");
    var customerIdentifiersList = {
        customer_identifiers_list_data: data,
        type: "pending_customers"
    };
    console.log("customerIdentifiersList11", customerIdentifiersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_customer_creation_identifiers_list_data", "#scroll-customer-creation-identifiers-data-list-template", "#pending-customer-creation-identifiers-list-wrapper .os-content", customerIdentifiersList);
}


function listenForAluminiCustomerListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                identifier_id: sessionStorage.getItem('identifier_id'),
                list_by: "alumini",
                offset: digibiz.alumini_customer_list.length,
                count: 5
            }
            customerList(reqParam)
                .then((response) => {
                    //console.log("customerList response", response);
                    // fetch.replaceHtml(function () {
                    scrollProcessAluminiCustomerList(response, function () {
                        listenForAluminiCustomerListScrollEvent($('.alumini-customers-list-contentbox'));
                        removeLoader();
                    });
                    // }, "page/customer/alumini_customers_list_wrapper", "#alumini-customers-list-wrapper-template", "#alumini-customer-list-data-container", null);
                })
                .catch((err) => {
                    removeLoader();
                })

        }
    });
}

function scrollProcessAluminiCustomerList(data, callback) {
    digibiz.alumini_customer_list = removeDuplicates(digibiz.alumini_customer_list.concat(data), "id");
    var customerList = {
        alumini_customers_list_data: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("customerList", customerList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_alumini_customers_list_data", "#scroll-alumini-customers-list-data-template", "#alumini-customers-list-wrapper .os-content", customerList);
}

function listenForAssociateCustomerIdentifiersListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "associate_customer",
                count: 15,
                offset: digibiz.associate_customer_identifiers.length
            }
            customerIdentifierList(reqParam)
                .then((response) => {
                    //console.log("customerIdentifierList response", response);
                    // fetch.replaceHtml(function () {
                    scrollProcessAssociateCustomerIdentifiersList(response, function () {
                        // appScroll.scrollBar('.associate-customer-identifiers-list-contentbox');
                        listenForAssociateCustomerIdentifiersListScrollEvent($('.associate-customer-identifiers-list-contentbox'));
                        removeLoader();
                    });
                    // }, "page/customer/associate_customers_list_wrapper", "#associate-customer-identifiers-list-wrapper-template", "#associate-customer-identifiers-list-data-container", null);
                })
                .catch((err) => {
                    removeLoader();
                })
        }
    });

}

function scrollProcessAssociateCustomerIdentifiersList(data, callback) {
    digibiz.associate_customer_identifiers = removeDuplicates(digibiz.associate_customer_identifiers.concat(data), "id");
    var customerIdentifiersList = {
        associate_customer_identifiers_list_data: data
    };
    //console.log("customerIdentifiersList", customerIdentifiersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();

        }
    }, "page/customer/scroll_associate_customers_list_data", "#scroll-associate-customer-identifiers-data-list-template", "#associate-customer-identifiers-list-wrapper .os-content", customerIdentifiersList);
}

function listenForActiveCustomerListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');

            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                identifier_id: sessionStorage.getItem('identifier_id'),
                list_by: "business_identifier_active_accepted",
                count: 5,
                offset: digibiz.customer_creation_active_list.length
            }
            addLoader();
            customerList(reqParam)
                .then((response) => {
                    scrollProcessActiveCustomerList(response, function () {
                        // appScroll.scrollBar('.active-customers-list-contentbox');
                        listenForActiveCustomerListScrollEvent($(".active-customers-list-contentbox"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/customer/scroll_active_customers_list_data", "#scroll-active-customers-list-data-template", "#active-customers-list-wrapper .os-content", null);
                })

        }
    });
}


function scrollProcessActiveCustomerList(data, callback) {
    digibiz.customer_creation_active_list = removeDuplicates(digibiz.customer_creation_active_list.concat(data), "id");
    var customerList = {
        active_customers_list_data: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                    // getImageUrl(avtarUrl).then((res) => {
                    // }).catch((err) => {
                    //     e['imageLetter'] = e.name.first.charAt(0);
                    //     $(`.active-customer-wrapper[data-customer-id="${e.id}"]`).find('.profile-pic-info-wrapper').find('.profile-pic-container').find('.persona').text(e.name.first.charAt(0))
                    // })
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        })
    };
    //console.log("customerList", customerList);
    fetch.appendHtml(function (err) {
        if (!err) {
            removeLoader();
            callback();
        }
    }, "page/customer/scroll_active_customers_list_data", "#scroll-active-customers-list-data-template", "#active-customers-list-wrapper .os-content", customerList);
}

function updateSettingPageInfo(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(
            function (response, status, xhr) {
                if (status == "success") {
                    resolve(response.Data);
                } else {
                    reject('error in getting settings');
                    // reject(err);
                }
            },
            api.update_setting_info,
            "POST",
            "JSON",
            requestParms
        );
    });
}


function associateCustomersBusinessListPage() {
    // addLoader();
    return new Promise((resolve, reject) => {
        var associate_customer_business_list = digibiz.customer_business_list.filter(e => e.type == "associate_customer");
        if (associate_customer_business_list && associate_customer_business_list.length == 0) {
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "associate_customer_module",
                count: 8,
                offset: 0
            }
            businessList(reqParam)
                .then((response) => {
                    //console.log("businessList response", response);
                    // fetch.replaceHtml(function () {
                    processAssociateCustomerBusinessList(response, function () {
                        digibiz.checkAccountFlag = true;
                        appScroll.scrollBar('.employee-business-list-main-container');
                        listenForAssociateCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                        removeLoader();
                        resolve();
                    });
                    // }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
                .catch((err) => {
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#customer-business-list-wrapper", null);
                    }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);
                })
        } else {
            // fetch.replaceHtml(function () {
            processAssociateCustomerBusinessList(digibiz.customer_business_list, function () {
                appScroll.scrollBar('.employee-business-list-main-container');
                listenForAssociateCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                removeLoader();
                resolve();
            });
            // }, "page/business/customer_business_list_wrapper", "#customer-business-list-wrapper-template", "#digibiz-home-page-middle-band-wrapper", null);

        }

    });
}

function processAssociateCustomerBusinessList(data, callback) {
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    digibiz.customer_business_list = removeDuplicatesFromMultipleProperties(digibiz.customer_business_list.concat(data), 'customer_id', 'type');
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    // digibiz.customer_business_list = digibiz.customer_business_list.concat(data);
    associate_customer_business_list = digibiz.customer_business_list.filter(e => e.type == "associate_customer");
    var businessList = {
        customer_business_list_data: associate_customer_business_list.map(e => {
            joinRoom(e.id);
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    // if (digibiz.customer_business_list.length > 0) {
    //     console.log("business is there")
    // } else {
    //     location.hash = `jeevi/app/hub`;
    console.log('5555555');
    // }
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/business/customer_business_list_data", "#customer-business-data-list-template", "#associate-customer-business-list-wrapper", businessList);
}


function listenForAssociateCustomerBusinessListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var associate_customer_business = digibiz.customer_business_list.filter(e => e.type == "associate_customer");
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "associate_customer_module",
                count: 5,
                offset: associate_customer_business.length
            }
            businessList(reqParam)
                .then((response) => {
                    scrollAssociateProcessCustomerBusinessList(response, function () {
                        listenForAssociateCustomerBusinessListScrollEvent($('.employee-business-list-main-container'));
                        removeLoader();
                    });
                })
                .catch((err) => {

                })

        }
    });
}

function scrollAssociateProcessCustomerBusinessList(data, callback) {
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    digibiz.customer_business_list = removeDuplicatesFromMultipleProperties(digibiz.customer_business_list.concat(data), 'customer_id', 'type');
    // digibiz.customer_business_list = removeDuplicates(digibiz.customer_business_list.concat(data), "id");
    // digibiz.customer_business_list = digibiz.customer_business_list.concat(data);
    var businessList = {
        customer_business_list_data: data.map(e => {
            joinRoom(e.id);
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                    // var avtarUrl = `${api.get_business_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.charAt(0);
                } else {
                    e['imageLetter'] = e.name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    };
    if (digibiz.customer_business_list.length > 0) {
        console.log("business is there")
    } else {
        location.hash = `jeevi/app/hub`;
        console.log('5555555');
    }
    fetch.appendHtml(function (err) {
        if (!err) {

            callback();
        }
    }, "page/business/scroll_customer_business_list_data", "#scroll-customer-business-data-list-template", "#associate-customer-business-list-wrapper .employee-business-list-contentbox", businessList);
}


function processCustomerStatusList(data, callback) {
    // digibiz.employee_status_list = removeDuplicates(digibiz.employee_status_list.concat(data), "id");
    var getEmployeeStatusData = {
        customer_status: data
    };
    //console.log("getEmployeeTypesData", getEmployeeTypesData)
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/customer_status", "#customer-status-template", ".employee-filter-wrapper", getEmployeeStatusData);
}



function statusWiseCustomerListPage() {
    return new Promise((resolve, reject) => {
        // var reqParams = {
        //     device_id: crossplat.device.uuid,
        //     // type: digibiz.employeeFilterData.type,
        //     // category: digibiz.employeeFilterData.category,
        //     // designation: digibiz.employeeFilterData.designation,
        //     // departments: digibiz.employeeFilterData.department,
        //     status: digibiz.customerFilterData.status,
        // }
        var reqParam = {
            device_id: crossplat.device.uuid,
            business_id: sessionStorage.getItem('business_id'),
            identifier_id: sessionStorage.getItem('identifier_id'),
            list_by: "business_identifier_active_accepted",
            status: digibiz.customerFilterData.status,
            count: 20,
            offset: 0
        }
        customerFilter(reqParam)
            .then((response) => {
                $('#customer-filter-option-modal').remove();
                fetch.replaceHtml(function () {
                    processActiveCustomerList(response, function () {
                        appScroll.scrollBar('.active-customers-list-contentbox');
                        listenForActiveCustomerListScrollEvent($(".active-customers-list-contentbox"));
                        removeLoader();
                        resolve();
                    });
                }, "page/customer/active_customers_list_wrapper", "#active-customers-list-wrapper-template", "#main-content-wrapper", null);
            })
            .catch((err) => {
                $('#employee-filter-option-modal').remove();
                removeLoader();
                // Materialize.toast(`Error! Please try again later`, 3000, "round error-alert");
                //console.log("Error in employee filter api");
                // fetch.replaceHtml(function () {
                fetch.replaceHtml(function (err) {
                    if (!err) {
                        removeLoader();
                        resolve();
                    }
                }, "page/employee/department_wise_employees_list_data", "#department-wise-employees-list-data-template", "#department-wise-employees-list-wrapper", null);
                // }, "page/employee/department_wise_employees_list_wrapper", "#department-wise-employees-list-wrapper-template", "#main-content-wrapper", null);
            })
    })
}


function customerFilter(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.filter_customers, "POST", "JSON", requestParms);
    });
}


function processGroupStatusList(data, callback) {
    var getGroupStatusData = {
        group_status: data
    };
    //console.log("getEmployeeTypesData", getEmployeeTypesData)
    fetch.replaceHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/group_status", "#group-status-template", ".employee-filter-wrapper", getGroupStatusData);
}

function statusWiseGroupListPage() {
    return new Promise((resolve, reject) => {
        if ($('body').attr('app') == "employee_group_creation_list") {
            if (sessionStorage.getItem('selected-employee-group-list-type-tab')) {
                $('.tab-content').removeClass('active');
                $(`.tab-content[id="${sessionStorage.getItem('selected-employee-group-list-type-tab')}"`).addClass('active');
                $('.tab').removeClass('active');
                $(`.tab[data-id="${sessionStorage.getItem('selected-employee-group-list-type-tab')}"]`).addClass('active');
                if (sessionStorage.getItem('selected-employee-group-list-type-tab') == 'standard') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        type: "employee",
                        list_by: "all_standard_employee_groups",
                        business_id: sessionStorage.getItem('business_id'),
                        status: digibiz.groupFilterData.status,
                        offset: 0,
                        count: 15
                    }
                    groupsFilterList(reqParam)
                        .then((response) => {
                            $('#group-filter-option-modal').remove();
                            fetch.replaceHtml(function () {
                                digibiz.standard_employees_groups_list_page = [];
                                processStandardEmployeeGroupsList(response, function () {
                                    appScroll.scrollBar('.standard-employees-groups-list-contentbox');
                                    listenForStandardEmployeeGroupsListScrollEvent($('.standard-employees-groups-list-contentbox'));
                                    removeLoader();
                                    resolve();
                                });
                            }, "page/employee/standard_employees_groups_list_wrapper", "#standard-employees-groups-list-wrapper-template", "#standard-employees-groups-list-data-container", null);
                        })
                        .catch((err) => {
                            $('#group-filter-option-modal').remove();
                            fetch.replaceHtml(function () {
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/employee/standard_employees_groups_list_data", "#standard-employees-groups-list-data-template", "#standard-employees-groups-list-wrapper", null);
                            }, "page/employee/standard_employees_groups_list_wrapper", "#standard-employees-groups-list-wrapper-template", "#standard-employees-groups-list-data-container", null);
                        })
                } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == 'custom') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        type: "employee",
                        list_by: "all_custom_employee_groups",
                        business_id: sessionStorage.getItem('business_id'),
                        status: digibiz.groupFilterData.status,
                        offset: 0,
                        count: 15
                    }
                    groupsFilterList(reqParam)
                        .then((response) => {
                            $('#group-filter-option-modal').remove();
                            fetch.replaceHtml(function () {
                                digibiz.custom_employees_groups_list_page = [];
                                processCustomEmployeeGroupsList(response, function () {
                                    appScroll.scrollBar(".custom-employees-groups-list-contentbox");
                                    listenForCustomEmployeeGroupsListScrollEvent($(".custom-employees-groups-list-contentbox"));
                                    removeLoader();
                                    resolve();
                                });
                            }, "page/employee/custom_employees_groups_list_wrapper", "#custom-employees-groups-list-wrapper-template", "#custom-employees-groups-list-data-container", null);
                        })
                        .catch((err) => {
                            $('#group-filter-option-modal').remove();
                            fetch.replaceHtml(function () {
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                        appScroll.scrollBar(".custom-employees-groups-list-contentbox");
                                    }
                                }, "page/employee/custom_employees_groups_list_data", "#custom-employees-groups-list-data-template", "#custom-employees-groups-list-wrapper", null);
                            }, "page/employee/custom_employees_groups_list_wrapper", "#custom-employees-groups-list-wrapper-template", "#custom-employees-groups-list-data-container", null);
                        })
                }
            }
        } else if ($('body').attr('app') == "customer_groups_identifiers_list") {
            if (sessionStorage.getItem('selected-customer-group-type-tab')) {
                $('.tab-content').removeClass('active');
                $(`.tab-content[id="${sessionStorage.getItem('selected-customer-group-type-tab')}"`).addClass('active');
                $('.tab').removeClass('active');
                $(`.tab[data-id="${sessionStorage.getItem('selected-customer-group-type-tab')}"]`).addClass('active');
                if (sessionStorage.getItem('selected-customer-group-type-tab') == 'standard') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        business_id: sessionStorage.getItem('business_id'),
                        list_by: "customer",
                        status: digibiz.groupFilterData.status,
                        limit: 15,
                        offset: 0
                    }
                    customerIdentifierList(reqParam)
                        .then((response) => {
                            var FinalData = [];
                            //console.log("customerIdentifierList response", response);
                            $.each(response, function (index, data) {
                                FinalData.push(data);
                            })
                            var requesParam = {
                                device_id: crossplat.device.uuid,
                                type: "customer",
                                business_id: sessionStorage.getItem('business_id'),
                                status: digibiz.groupFilterData.status,
                                list_by: "basic_customer_groups",
                            }
                            groupsFilterList(requesParam)
                                .then((result) => {
                                    //console.log("success", result);
                                    $.each(result, function (index, data) {
                                        FinalData.push(data);
                                    })
                                    fetch.replaceHtml(function () {
                                        processStandardCustomerGroupsIdentifiersList(FinalData, function () {
                                            // listenForStandardCustomerGroupsIdentifiersListScrollEvent($('.standard-customer-groups-identifiers-list-data-contentbox'));
                                            removeLoader();
                                            resolve();
                                        });
                                    }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
                                })
                                .catch((err) => {
                                    fetch.replaceHtml(function () {
                                        fetch.replaceHtml(function (err) {
                                            if (!err) {
                                                removeLoader();
                                                resolve();
                                            }
                                        }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", null);
                                    }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
                                })
                        })
                        .catch((err) => {
                            fetch.replaceHtml(function () {
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/customer/standard_customer_groups_identifiers_list_data", "#standard-customer-groups-identifiers-list-data-template", "#standard-customer-groups-identifiers-list-wrapper", null);
                            }, "page/customer/standard_customer_groups_identifiers_list_wrapper", "#standard-customer-groups-identifiers-list-wrapper-template", "#standard-customer-group-type-data-container", null);
                        })
                } else if (sessionStorage.getItem('selected-employee-group-list-type-tab') == 'custom') {
                    var reqParams = {
                        device_id: crossplat.device.uuid,
                        type: "customer",
                        business_id: sessionStorage.getItem('business_id'),
                        list_by: "custom_groups",
                        group_for: "customer",
                        status: digibiz.groupFilterData.status,
                        customer_group_type: "custom",
                        offset: 0,
                        count: 20
                    }
                    groupsFilterList(reqParams)
                        .then((response) => {
                            //console.log("employeeGroupList response", response);
                            fetch.replaceHtml(function () {
                                processCustomerCustomGroupList(response, function () {
                                    listenForCustomerCustomGroupListScrollEvent($('.customer-custom-groups-list-contentbox'));
                                    removeLoader();
                                    resolve();
                                });
                            }, "page/customer/customer_custom_groups_list_wrapper", "#customer-custom-groups-list-wrapper-template", "#custom-customer-group-type-data-container", null);
                        })
                        .catch((err) => {
                            fetch.replaceHtml(function () {
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        appScroll.scrollBar('.customer-custom-groups-list-contentbox');
                                        resolve();
                                    }
                                }, "page/customer/customer_custom_groups_list_data", "#customer-custom-groups-list-data-template", "#customer-custom-groups-list-wrapper", null);
                            }, "page/customer/customer_custom_groups_list_wrapper", "#customer-custom-groups-list-wrapper-template", "#custom-customer-group-type-data-container", null);
                        })
                }
            }
        } else if ($('body').attr('app') == "team_group_creation_list") {
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "teams",
                list_by: "all_teams_groups",
                business_id: sessionStorage.getItem('business_id'),
                status: digibiz.groupFilterData.status,
                count: 15,
                offset: 0
            }
            groupsFilterList(reqParam)
                .then((response) => {
                    $('#group-filter-option-modal').remove();
                    fetch.replaceHtml(function () {
                        digibiz.team_groups_list_page = [];
                        processTeamGroupsList(response, function () {
                            appScroll.scrollBar('.team-groups-list-wrapper');
                            listenForTeamGroupsListScrollEvent($('.team-groups-list-wrapper'));
                            removeLoader();
                            resolve();
                        });
                    }, "page/teams/team_groups_list_wrapper", "#team-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
                .catch((err) => {
                    $('#group-filter-option-modal').remove();
                    fetch.replaceHtml(function () {
                        fetch.replaceHtml(function (err) {
                            if (!err) {
                                removeLoader();
                                resolve();
                            }
                        }, "page/teams/team_groups_list_data", "#team-groups-list-data-template", "#team-groups-list-wrapper", null);
                    }, "page/teams/team_groups_list_wrapper", "#team-groups-list-wrapper-template", "#main-content-wrapper", null);
                })
        } else if ($('body').attr('app') == "collaborator_groups_list") {
            if (sessionStorage.getItem('selected-collaborator-tab')) {
                $('.tab-content').removeClass('active');
                $(`.tab-content[id="${sessionStorage.getItem('selected-collaborator-tab')}"`).addClass('active');
                $('.tab').removeClass('active');
                $(`.tab[data-id="${sessionStorage.getItem('selected-collaborator-tab')}"]`).addClass('active');
                if (sessionStorage.getItem('selected-collaborator-tab') == 'my_group_collaborator') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        type: "collaborator",
                        list_by: "business_collaborator_groups_page",
                        business_id: sessionStorage.getItem('business_id'),
                        status: digibiz.groupFilterData.status,
                        count: 15,
                        offset: 0
                    }
                    collaboratorGroupsFilterList(reqParam)
                        .then((response) => {
                            $('#group-filter-option-modal').remove();
                            digibiz.collaborator_groups_list = [];
                            fetch.replaceHtml(function () {
                                processCollaboratorGroupsList(response, function () {
                                    appScroll.scrollBar('.collaborator-groups-list-contentbox');
                                    listenForCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-contentbox'));
                                    removeLoader();
                                    resolve();
                                });
                            }, "page/collaborator/group_list_wrapper", "#collaborator-groups-list-wrapper-template", "#my-collaborator-group-list-data-container", null);
                        })
                        .catch((err) => {
                            $('#group-filter-option-modal').remove();
                            fetch.replaceHtml(function () {
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", null);
                            }, "page/collaborator/group_list_wrapper", "#collaborator-groups-list-wrapper-template", "#my-collaborator-group-list-data-container", null);
                        })
                } else if (sessionStorage.getItem('selected-collaborator-tab') == 'other_group_collaborator') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        type: "collaborator",
                        list_by: "business_other_collaborator_groups_page",
                        business_id: sessionStorage.getItem('business_id'),
                        status: digibiz.groupFilterData.status,
                        count: 15,
                        offset: 0
                    }
                    collaboratorGroupsFilterList(reqParam)
                        .then((response) => {
                            $('#group-filter-option-modal').remove();
                            digibiz.other_collaborator_groups_list = [];
                            fetch.replaceHtml(function () {
                                processOtherCollaboratorGroupsList(response, function () {
                                    appScroll.scrollBar('.collaborator-groups-list-main-container');
                                    listenForOtherCollaboratorGroupsListScrollEvent($('.collaborator-groups-list-main-container'));
                                    removeLoader();
                                    resolve();
                                });
                            }, "page/collaborator/other_collaborator_group_list_wrapper", "#other-collaborator-groups-list-wrapper-template", "#other-collaborator-group-list-data-container", null);
                        })
                        .catch((err) => {
                            $('#group-filter-option-modal').remove();
                            fetch.replaceHtml(function () {
                                fetch.replaceHtml(function (err) {
                                    if (!err) {
                                        removeLoader();
                                        resolve();
                                    }
                                }, "page/collaborator/group_list_data", "#collaborator-groups-list-data-template", "#collaborator-groups-list-list-wrapper", null);
                            }, "page/collaborator/group_list_wrapper", "#collaborator-groups-list-wrapper-template", "#my-collaborator-group-list-data-container", null);
                        })
                }
            }
        } else if ($('body').attr('app') == "communication_groups") {
            if (sessionStorage.getItem('selected-communication-tab')) {
                $('.tab-content').removeClass('active');
                $(`.tab-content[id="${sessionStorage.getItem('selected-communication-tab')}"`).addClass('active');
                $('.tab').removeClass('active');
                $(`.tab[data-id="${sessionStorage.getItem('selected-communication-tab')}"]`).addClass('active');
                if (sessionStorage.getItem('selected-communication-tab') == 'communication-group-list') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        list_by: "communication",
                        business_id: sessionStorage.getItem('business_id'),
                        status: digibiz.groupFilterData.status,
                        count: 15,
                        offset: 0
                    }
                    // getGroupsCount(reqParam).then((groupsCount) => {
                    // $('.communication-business-groups-count').text(groupsCount);
                    communicationGroupsFilterList(reqParam)
                        // groupsList(reqParam)
                        .then((response) => {
                            $('#group-filter-option-modal').remove();
                            digibiz.communicationGroupsList = [];
                            // fetch.replaceHtml(function () {
                            processCommunicationGroupsList(response, function () {
                                appScroll.scrollBar('.communication-group-list-contentbox');
                                listenForCommunicationGroupsListScrollEvent($('.communication-group-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                            // }, "page/communication/communication_group_list_wrapper", "#communication-groups-list-wrapper-template", "#main-content-wrapper", null);
                        })
                        .catch((err) => {
                            $('#group-filter-option-modal').remove();
                            // fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", null);
                            // }, "page/communication/communication_group_list_wrapper", "#communication-groups-list-wrapper-template", "#main-content-wrapper", null);
                        })
                    // }).catch((err)=>{
                    //     console.log('err',err);
                    // })
                } else if (sessionStorage.getItem('selected-communication-tab') == 'collaborator-communication-group-list') {
                    var reqParam = {
                        device_id: crossplat.device.uuid,
                        list_by: "collaborator_communication",
                        business_id: sessionStorage.getItem('business_id'),
                        status: digibiz.groupFilterData.status,
                        count: 15,
                        offset: 0
                    }
                    // getGroupsCount(reqParam).then((groupsCount) => {
                    //     $('.communication-business-groups-count').text(groupsCount);
                    communicationGroupsFilterList(reqParam)
                        // groupsList(reqParam)
                        .then((response) => {
                            digibiz.collaboratorCommunicationGroupsList = [];
                            $('#group-filter-option-modal').remove();
                            // fetch.replaceHtml(function () {
                            processCollaboratorCommunicationGroupsList(response, function () {
                                appScroll.scrollBar('.communication-group-list-contentbox');
                                listenForCollaboratorCommunicationGroupsListScrollEvent($('.communication-group-list-contentbox'));
                                removeLoader();
                                resolve();
                            });
                            // }, "page/communication/communication_group_list_wrapper", "#communication-groups-list-wrapper-template", "#main-content-wrapper", null);
                        })
                        .catch((err) => {
                            $('#group-filter-option-modal').remove();
                            // fetch.replaceHtml(function () {
                            fetch.replaceHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                    resolve();
                                }
                            }, "page/communication/communication_group_list_data", "#communication-group-list-data-template", "#communication-group-list-list-wrapper", null);
                            // }, "page/communication/communication_group_list_wrapper", "#communication-groups-list-wrapper-template", "#main-content-wrapper", null);
                        })
                }
            }
        }


    })
}


function groupsFilterList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.filter_list_group, "POST", "JSON", requestParms);
    });
}

function collaboratorGroupsFilterList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.filter_list_groups_collaborator, "POST", "JSON", requestParms);
    });
}

function communicationGroupsFilterList(requestParms) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.filter_list_group_communication, "POST", "JSON", requestParms);
    });
}


function listentForCommunicationGroupEmployeMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                list_by: "employee_members",
                count: 5,
                offset: digibiz.communitcation_group_employee_members_list.length
            }
            getGroupMembers(requestParams)
                .then((membesponse) => {
                    var membersResponse = membesponse.membersList;
                    removeLoader();
                    if (membersResponse && membersResponse.length > 0) {
                        scrollProcessCommunicationGroupEmployeeMembersList(membersResponse, function () {
                            listentForCommunicationGroupEmployeMembersList($('#communication-group-employee-members-list'));

                        });
                    } else {
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/communication/group_members_list", "#communication-group-member-list-template", "#communication-group-employee-members-list .os-content", null);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/communication/group_members_list", "#communication-group-member-list-template", "#communication-group-employee-members-list .os-content", null);
                })

        }
    });
}

function scrollProcessCommunicationGroupEmployeeMembersList(data, callback) {
    digibiz.communitcation_group_employee_members_list = removeDuplicates(digibiz.communitcation_group_employee_members_list.concat(data), "id");
    // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
    var groupMembersList = {
        group_type: sessionStorage.getItem('group_from'),
        group_members_data: data.map(e => {
            if (e.member.type == "employee") {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.first.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
            } else if (e.member.type == "customer") {
                if (e.member.customer_type == "customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else if (e.member.customer_type == "associate_customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                }
            } else if (e.member.type == "employee_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "customer_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "collaborator_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            }
            return e;
        })
    }
    console.log("communicationGroupsEmployeeMembersList", groupMembersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/group_members_list", "#communication-group-member-list-template", "#communication-group-employee-members-list .os-content", groupMembersList);
}


function listentForCommunicationGroupCustomerMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                list_by: "customer_members",
                count: 5,
                offset: digibiz.communitcation_group_customer_members_list.length
            }
            console.log('requestParams', requestParams);
            getGroupMembers(requestParams)
                .then((membesponse) => {
                    var membersResponse = membesponse.membersList;
                    removeLoader();
                    if (membersResponse && membersResponse.length > 0) {
                        scrollProcessCommunicationGroupCustomerMembersList(membersResponse, function () {
                            listentForCommunicationGroupCustomerMembersList($('#communication-group-customer-members-list'));

                        });
                    } else {
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/communication/scroll_customer_group_members_list", "#communication-customer-group-member-list-template", "#communication-group-customer-members-list .os-content", null);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/communication/scroll_customer_group_members_list", "#communication-customer-group-member-list-template", "#communication-group-customer-members-list .os-content", null);
                })

        }
    });
}

function scrollProcessCommunicationGroupCustomerMembersList(data, callback) {
    digibiz.communitcation_group_customer_members_list = removeDuplicates(digibiz.communitcation_group_customer_members_list.concat(data), "id");
    // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
    var groupMembersList = {
        group_type: sessionStorage.getItem('group_from'),
        group_members_data: data.map(e => {
            if (e.member.type == "employee") {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.first.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
            } else if (e.member.type == "customer") {
                if (e.member.customer_type == "customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else if (e.member.customer_type == "associate_customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                }
            } else if (e.member.type == "employee_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "customer_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "collaborator_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            }
            return e;
        })
    }
    console.log("communicationGroupsEmployeeMembersList", groupMembersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/scroll_customer_group_members_list", "#communication-customer-group-member-list-template", "#communication-group-customer-members-list .os-content", groupMembersList);
}

function listentForCommunicationGroupCollaboratorMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                list_by: "collaborator_members",
                count: 5,
                offset: digibiz.communitcation_group_collaborator_members_list.length
            }
            console.log('requestParams', requestParams);
            getGroupMembers(requestParams)
                .then((membesponse) => {
                    var membersResponse = membesponse.membersList;
                    removeLoader();
                    if (membersResponse && membersResponse.length > 0) {
                        scrollProcessCommunicationGroupCollaboratorMembersList(membersResponse, function () {
                            listentForCommunicationGroupCollaboratorMembersList($('#communication-group-collaborator-members-list'));

                        });
                    } else {
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/communication/scroll_collaborator_group_members_list", "#communication-collaborator-group-member-list-template", "#communication-group-collaborator-members-list .os-content", null);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/communication/scroll_collaborator_group_members_list", "#communication-collaborator-group-member-list-template", "#communication-group-collaborator-members-list .os-content", null);
                })

        }
    });
}

function scrollProcessCommunicationGroupCollaboratorMembersList(data, callback) {
    digibiz.communitcation_group_collaborator_members_list = removeDuplicates(digibiz.communitcation_group_collaborator_members_list.concat(data), "id");
    // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
    var groupMembersList = {
        group_type: sessionStorage.getItem('group_from'),
        group_members_data: data.map(e => {
            if (e.member.type == "employee") {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.first.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
            } else if (e.member.type == "customer") {
                if (e.member.customer_type == "customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else if (e.member.customer_type == "associate_customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                }
            } else if (e.member.type == "employee_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "customer_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "collaborator_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            }
            return e;
        })
    }
    console.log("communicationGroupsEmployeeMembersList", groupMembersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/scroll_collaborator_group_members_list", "#communication-collaborator-group-member-list-template", "#communication-group-collaborator-members-list .os-content", groupMembersList);
}

function listenForAllEmployeeActiveListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_all_active",
                count: 20,
                offset: digibiz.all_employee_active_list.length
            }
            employeeList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessAllEmployeeActiveList(response, function () {
                        listenForAllEmployeeActiveListScrollEvent($('.contact-recommend-to-members-selection-list'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, "page/common/scroll_all_active_employee_data", "#scroll-all-active-employee-template", '.contact-recommend-to-members-selection-list .os-content', null);

                })

        }
    });
}

function scrollProcessAllEmployeeActiveList(data, callback) {
    digibiz.all_employee_active_list = removeDuplicates(digibiz.all_employee_active_list.concat(data), "id");
    // let identifier = '#employee-types-list-wrapper .os-content .employee-types-content-box';
    var getEmployeeData = {
        contactList: data,
        device_id: crossplat.device.uuid
    };
    console.log("getEmployeeTypesData", getEmployeeData)
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_all_active_employee_data", "#scroll-all-active-employee-template", '.contact-recommend-to-members-selection-list .os-content', getEmployeeData);
}


function listenForGetRoleslistScrollEvent(el) {
    console.log('11111111');
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            console.log('2222222');
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                type: "mobile_number",
                value: $('#add-customer-mobile-number').intlTelInput("getNumber").replace(/\s/g, ''),
                count: 20,
                offset: digibiz.getRolesListData.length - 1
            }
            getCustomerRolesList(reqParam)
                .then((response) => {
                    removeLoader();
                    if (response && response.length == 1) {
                        if (response[0].role_type == "jeevi") {
                            removeLoader();
                        } else {
                            scrollProcessGetRoleslist(response, function () {
                                listenForGetRoleslistScrollEvent($('.search-user-list-data'));
                                removeLoader();
                            });
                        }
                    } else {
                        scrollProcessGetRoleslist(response, function () {
                            listenForGetRoleslistScrollEvent($('.search-user-list-data'));
                            removeLoader();
                        });
                    }
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, "page/common/get_roles_list", "#get-roles-list-template", "#get-roles-list-wrapper .os-content", null);

                })

        }
    });
}

function scrollProcessGetRoleslist(data, callback) {
    if (data.length > 0) {
        digibiz.getRolesListData = removeDuplicatesFromMultipleProperties(digibiz.getRolesListData.concat(data), 'id', 'role_type');
        var getData = {
            userList: data.map(e => {
                if (e.role_type == "employee") {
                    if (e.hasOwnProperty('profile_display_id') && e.profile_display_id) {
                        var avtarUrl = `${api.get_employee_identity_picture}?id=${e.user_id}&device_id=${crossplat.device.uuid}&image_id=${e.profile_display_id}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                } else {
                    if (e.hasOwnProperty('profile_display_id') && e.profile_display_id != null) {
                        var avtarUrl = `${config.api.core}/api/individual/get_image?image_id=${e.profile_display_id}&device_id=${crossplat.device.uuid}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.name.charAt(0);
                    } else {
                        e['imageLetter'] = e.name.charAt(0);
                    }
                }
                return e;
            }),
        };
        fetch.appendHtml(function (err) {
            if (!err) {
                // console.log('scroll 111')

                callback();
            }
        }, "page/common/scroll_get_roles_list", "#scroll-get-roles-list-template", "#get-roles-list-wrapper .os-content", getData);
    } else {
        fetch.appendHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/common/scroll_get_roles_list", "#scroll-get-roles-list-template", "#get-roles-list-wrapper .os-content", null);
    }

}

function processGroupModeratorData(data, callback) {
    console.log('data', data);
    if (data && data.length > 0) {
        // digibiz.group_moderator_list = removeDuplicates(digibiz.group_moderator_list.concat(data), "id");
        var getData = {
            group_moderator_data: data.map(e => {
                //console.log("e", e);
                if (e.type == "employee") {
                    if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;

                            e['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                } else if (e.type == "customer") {
                    if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                            e['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                } else if (e.type == "associate_customer") {
                    if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.data.name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.data.name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                }
                return e;
            })
        };
        fetch.replaceHtml(function (err) {
            if (!err) {
                // console.log('scroll 111')

                callback();
            }
        }, "page/communication/group_moderator_list_data", "#communication-group-moderator-list-template", "#communication-group-moderator-members-list", getData);
    } else {
        fetch.replaceHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/communication/group_moderator_list_data", "#communication-group-moderator-list-template", "#communication-group-moderator-members-list", null);
    }

}

function listentForCommunicationGroupModeratorList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var finalArray = digibiz.group_moderator_list;
            console.log('finalArray', finalArray);
            var offset = digibiz.listed_group_moderator_list.length;
            // var offset = digibiz.listed_group_moderator_list.length
            var count = digibiz.listed_group_moderator_list.length + 5;

            console.log('offset', offset, count)
            var moderatorList = finalArray.slice(offset, count);
            console.log('moderatorList', moderatorList);
            digibiz.listed_group_moderator_list = digibiz.listed_group_moderator_list.concat(moderatorList);


            if (moderatorList && moderatorList.length > 0) {
                scrollProcessCommunicationGroupModeratorList(moderatorList, function () {
                    removeLoader();
                    listentForCommunicationGroupModeratorList($('#communication-group-moderator-members-list'));

                });
            } else {
                fetch.appendHtml(function (err) {
                    if (!err) {
                        removeLoader();
                    }
                }, "page/communication/scroll_customer_group_members_list", "#communication-customer-group-member-list-template", "#communication-group-customer-members-list .os-content", null);
            }

            // })
            // .catch((err) => {
            //     console.log("error in employee group members data", err);
            //     removeLoader();
            //     fetch.appendHtml(function (err) {
            //         if (!err) {
            //         }
            //     }, "page/communication/scroll_customer_group_members_list", "#communication-customer-group-member-list-template", "#communication-group-customer-members-list .os-content", null);
            // })

        }
    });
}

function scrollProcessCommunicationGroupModeratorList(data, callback) {
    if (data && data.length > 0) {
        // digibiz.group_moderator_list = removeDuplicates(digibiz.group_moderator_list.concat(data), "id");
        var getData = {
            group_moderator_data: data.map(e => {
                //console.log("e", e);
                if (e.type == "employee") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                } else if (e.type == "customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                            e.identity_picture['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                } else if (e.type == "associate_customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.data.name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.data.name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                }
                return e;
            })
        };
        fetch.appendHtml(function (err) {
            if (!err) {
                // console.log('scroll 111')

                callback();
            }
        }, "page/communication/group_moderator_list_data", "#communication-group-moderator-list-template", "#communication-group-moderator-members-list .os-content", getData);
    } else {
        fetch.appendHtml(function (err) {
            if (!err) {
                callback();
            }
        }, "page/communication/group_moderator_list_data", "#communication-group-moderator-list-template", "#communication-group-moderator-members-list .os-content", null);
    }

}


function listenForEmployeeGroupMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                offset: digibiz.group_employee_members_list.length,
                count: 5
            }
            getGroupMembers(requestParams)
                .then((membesponse) => {
                    var membersResponse = membesponse.membersList;
                    removeLoader();
                    if (membersResponse && membersResponse.length > 0) {
                        scrollProcessGroupEmployeeMembersList(membersResponse, function () {
                            listenForEmployeeGroupMembersList($("#employee-group-members-list"));
                        });
                    } else {
                        var groupMembersList = {
                            group_type: sessionStorage.getItem('group_type'),
                            custom_group_from: sessionStorage.getItem('group_from')
                        }
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/communication/employee_group_members", "#employee-group-members-list-template", "#employee-group-members-list .os-content", groupMembersList);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    var groupMembersList = {
                        group_type: sessionStorage.getItem('group_type'),
                        custom_group_from: sessionStorage.getItem('group_from')
                    }
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/communication/employee_group_members", "#employee-group-members-list-template", "#employee-group-members-list .os-content", groupMembersList);
                })

        }
    });
}

function scrollProcessGroupEmployeeMembersList(data, callback) {
    digibiz.group_employee_members_list = removeDuplicates(digibiz.group_employee_members_list.concat(data), "id");
    // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
    var groupMembersList = {
        group_type: sessionStorage.getItem('group_type'),
        custom_group_from: sessionStorage.getItem('group_from'),
        group_members_data: data.map(e => {
            if (e.member.type == "employee" || e.member.dj_unique_employee_id) {
                if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                    // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                    //  var avtarUrl = `${api.get_employee_identity_picture}?id=${e.user_id}&device_id=${crossplat.device.uuid}&image_id=${e.profile_display_id}`;
                    var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.first.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.first.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.first.charAt(0);
                }
            } else if (e.member.type == "customer") {
                if (e.member.customer_type == "customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                } else if (e.member.customer_type == "associate_customer") {
                    if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}`;
                        e.identity_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.member_name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.member_name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.member_name.first.charAt(0);
                    }
                }
            } else if (e.member.type == "employee_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "customer_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "collaborator_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            } else if (e.member.type == "standard_group") {
                if (e.hasOwnProperty('group_image') && e.group_image) {
                    // if (e.group_image.hasOwnProperty('asset_id') && e.group_image.asset_id) {
                    var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
                    // var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                    e.group_image['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.member_name.charAt(0);
                    // } else {
                    //     e['imageLetter'] = e.member_name.charAt(0);
                    // }
                } else {
                    e['imageLetter'] = e.member_name.charAt(0);
                }
            }
            return e;
        })
    }
    console.log("communicationGroupsEmployeeMembersList", groupMembersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/communication/employee_group_members", "#employee-group-members-list-template", "#employee-group-members-list .os-content", groupMembersList);
}


function processSearchGroupModeratorData(data = null, callback) {
    console.log('data', data);
    if (data) {
        var getData = {
            group_moderator_data: data.map(e => {
                //console.log("e", e);
                if (e.type == "employee") {
                    if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;

                            e['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                } else if (e.type == "customer") {
                    if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                            var avtarUrl = `${api.get_customer_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                            e['avtarUrl'] = avtarUrl;
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        } else {
                            e['imageLetter'] = e.data.name.first.charAt(0);
                        }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                } else if (e.type == "associate_customer") {
                    if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                        // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                        var avtarUrl = `${api.get_associate_customer_thumbnail}?id=${e.id}&device_id=${crossplat.device.uuid}`;
                        e['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.data.name.first.charAt(0);
                        // } else {
                        //     e['imageLetter'] = e.data.name.first.charAt(0);
                        // }
                    } else {
                        e['imageLetter'] = e.data.name.first.charAt(0);
                    }
                }
                return e;
            })
        };
    } else {
        var getData = {
            device_id: crossplat.device.uuid
        }
    }
    console.log("getData", getData)
    fetch.replaceHtml(function () {
        callback();
    }, "page/communication/group_moderator_list_data", "#communication-group-moderator-list-template", "#group-moderator-search-wrapper", getData);
}

function listenForEmployeeSelectionListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                business_id: sessionStorage.getItem('business_id'),
                list_by: "list_only_active",
                count: 20,
                offset: digibiz.employee_group_employee_members.length
            }
            employeeList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessEmployeeSelectionList(response, function () {
                        listenForEmployeeSelectionListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, 'page/common/scroll_employee_list_selection', '#scroll-employee-selection-list-template', '#employee-selection-member-list-container', null);

                })

        }
    });
}


function scrollProcessEmployeeSelectionList(data, callback) {
    console.log('oiii', data);
    digibiz.employee_group_employee_members = removeDuplicates(digibiz.employee_group_employee_members.concat(data), "id");
    var EmployeeList = {
        EmployeeList: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "direct"
    }
    //console.log("EmployeeList", EmployeeList);
    fetch.appendHtml(function (err) {
        if (!err) {

            callback();
        }
    }, 'page/common/scroll_employee_list_selection', '#scroll-employee-selection-list-template', '#employee-selection-member-list-container', EmployeeList);
}

function listenForCustomerGroupContactsMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                count: 5,
                offset: digibiz.customer_group_members_list.length
            }
            console.log('requestParamsee', requestParams);
            getGroupMembers(requestParams)
                .then((membesponse) => {
                    var membersResponse = membesponse.membersList;
                    removeLoader();
                    if (membersResponse && membersResponse.length > 0) {
                        scrollProcessCustomerGroupMembersList(membersResponse, function () {
                            listenForCustomerGroupContactsMembersList($('#customer-group-members-list'));

                        });
                    } else {
                        var groupMembersList = {
                            customer_group_type: sessionStorage.getItem('group_type'),
                            custom_group_from: sessionStorage.getItem('group_from')
                        }
                        console.log('swdefr', groupMembersList);
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list .os-content", groupMembersList);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    var groupMembersList = {
                        customer_group_type: sessionStorage.getItem('group_type'),
                        custom_group_from: sessionStorage.getItem('group_from')
                    }
                    console.log('qqqqqqq', groupMembersList);
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list .os-content", groupMembersList);
                })

        }
    });
}

function scrollProcessCustomerGroupMembersList(data, callback) {
    digibiz.customer_group_members_list = removeDuplicates(digibiz.customer_group_members_list.concat(data), "id");
    // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
    var groupMembersList = {
        customer_group_type: sessionStorage.getItem('group_type'),
        custom_group_from: sessionStorage.getItem('group_from'),
        group_members_data: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_customer_thumbnail}?id=${e.customer_id}&device_id=${crossplat.device.uuid}`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.member_name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.member_name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.member_name.first.charAt(0);
            }
            return e;
        })
    }
    console.log("communicationGroupsEmployeeMembersList", groupMembersList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list .os-content", groupMembersList);
}

function listenForCustomerGroupGroupMembersList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                count: 5,
                offset: digibiz.customer_group_members_list.length
            }
            console.log('requestParamsee', requestParams);
            getGroupMembers(requestParams)
                .then((membesponse) => {
                    var membersResponse = membesponse.membersList;
                    console.log('membersResponse', membersResponse);
                    removeLoader();
                    if (membersResponse && membersResponse.length > 0) {
                        scrollProcessCustomerGroupMembersList(membersResponse, function () {
                            listenForCustomerGroupGroupMembersList($('#customer-group-members-list'));

                        });
                    } else {
                        var groupMembersList = {
                            customer_group_type: sessionStorage.getItem('group_type'),
                            custom_group_from: sessionStorage.getItem('group_from'),
                        }
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list .os-content", groupMembersList);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    var groupMembersList = {
                        customer_group_type: sessionStorage.getItem('group_type'),
                        custom_group_from: sessionStorage.getItem('group_from'),
                    }
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list .os-content", groupMembersList);
                })

        }
    });
}

function listenForEmployeeList(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                list_by: "list_only_active",
                business_id: sessionStorage.getItem('receiver_business_id'),
                count: 20,
                offset: digibiz.employee_list.length
            }
            if (sessionStorage.getItem('receiver_business_id')) {
                reqParam.business_id = sessionStorage.getItem('receiver_business_id');
            } else {
                reqParam.business_id = sessionStorage.getItem('business_id');
            }
            employeeList(reqParam)
                .then((response) => {
                    removeLoader();
                    scrollProcessEmployeeSelectionListData(response, function () {
                        listenForEmployeeList($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    if($('#modal-collaborator-group-owner-business-employee-selection').length > 0 ){
                        var identifier = '.employee-selection-member-list #employee-selection-member-list-container';
                    } else {
                        var identifier = '.employee-selection-member-list';
                    }
                    fetch.appendHtml(function () {
                        removeLoader();
                        console.log('err', err);
                    }, 'page/common/scroll_employee_list_selection', '#scroll-employee-selection-list-template', identifier, null);
                })

        }
    });
}

function scrollProcessEmployeeSelectionListData(data, callback) {
    digibiz.employee_list = removeDuplicates(digibiz.employee_list.concat(data), "id");
    var EmployeeList = {
        EmployeeList: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                if (e.identity_picture.hasOwnProperty('thumbnail') && e.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&image_id=${e.identity_picture.thumbnail}`;
                    e.identity_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.name.first.charAt(0);
                } else {
                    e['imageLetter'] = e.name.first.charAt(0);
                }
            } else {
                e['imageLetter'] = e.name.first.charAt(0);
            }
            return e;
        }),
        from: "direct"
    }
    //console.log("EmployeeList", EmployeeList);
    if($('#modal-collaborator-group-owner-business-employee-selection').length > 0 ){
        var identifier = '.employee-selection-member-list #employee-selection-member-list-container';
    } else {
        var identifier = '.employee-selection-member-list';
    }
    fetch.appendHtml(function (err) {
        if (!err) {

            callback();
        }
    }, 'page/common/scroll_employee_list_selection', '#scroll-employee-selection-list-template', identifier, EmployeeList);
}

function listenForCollaboratorGroupContactListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "collaborator",
                list_by: "business_collaborator_groups_page",
                business_id: sessionStorage.getItem('business_id'),
                count: 5,
                offset: digibiz.collaborator_contact_list.length
            }
            collaboratorList(reqParam)
                .then((response) => {
                    scrollProcessCollaboratorGroupContactList(response, function () {
                        listenForCollaboratorGroupContactListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, 'page/collaborator/scroll_contact_list_selection', '#scroll-collaborator-contact-selection-list-template', '.collaborator-contact-selection-list', null);
                })

        }
    });
}

function scrollProcessCollaboratorGroupContactList(data, callback) {
    digibiz.collaborator_contact_list = removeDuplicates(digibiz.collaborator_contact_list.concat(data), "id");
    var collaboratorGroupContactList = {
        collaboratorContactList: data.map(e => {
            // collaboratorContactList: unique_collaborator_contact_list.map(e => {
            if (e.hasOwnProperty('business_display_picture') && e.business_display_picture) {
                if (e.business_display_picture.hasOwnProperty('thumbnail') && e.business_display_picture.thumbnail) {
                    // //console.log("1234");
                    var avtarUrl = `${api.get_business_multimedia}?business_id=${e.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.business_display_picture.thumbnail}`;
                    e.business_display_picture['avtarUrl'] = avtarUrl;
                    e['imageLetter'] = e.business_name.charAt(0);
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            } else {
                e['imageLetter'] = e.business_name.charAt(0);
            }
            return e;
        })
    };
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, 'page/collaborator/scroll_contact_list_selection', '#scroll-collaborator-contact-selection-list-template', '.collaborator-contact-selection-list', collaboratorContactList);
}


function listenForCollaboratorGroupMembersListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var requestParams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                count: 5,
                offset: digibiz.collaborator_group_members_list.length
            }
            groupMemberList(requestParams)
                .then((membersResponse) => {
                    scrollProcessCollaboratorGroupMembersList(membersResponse, function () {
                        listenForCollaboratorGroupMembersListScrollEvent($('#collaborator-group-members-list'));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/collaborator/scroll_collaborator_group_members_list_data", "#scroll-collaborator-group-members-list-template", "#collaborator-group-members-list .os-content", null);
                })

        }
    });
}

function scrollProcessCollaboratorGroupMembersList(data, callback) {
    digibiz.collaborator_group_members_list = removeDuplicates(digibiz.collaborator_group_members_list.concat(data), "id");
    var collaboratorGroupMembersList = {
        group_members_data: data.map(e => {
            if (e.type == "business") {
                if (e.hasOwnProperty('display_picture') && e.display_picture) {
                    if (e.display_picture.hasOwnProperty('thumbnail') && e.display_picture.thumbnail) {
                        var avtarUrl = `${api.get_business_multimedia}?business_id=${e.member.business_id}&device_id=${crossplat.device.uuid}&image_id=${e.display_picture.thumbnail}`;
                        e.display_picture['avtarUrl'] = avtarUrl;
                        e['imageLetter'] = e.business_name.charAt(0);
                    } else {
                        e['imageLetter'] = e.business_name.charAt(0);
                    }
                } else {
                    e['imageLetter'] = e.business_name.charAt(0);
                }
            }
            return e;
        })
    };
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_collaborator_group_members_list_data", "#scroll-collaborator-group-members-list-template", "#collaborator-group-members-list .os-content", collaboratorGroupMembersList);
}


function listenForCollaboratorGroupModeratorsListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var reqparams = {
                device_id: crossplat.device.uuid,
                group_id: sessionStorage.getItem('group_id'),
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.colloborator_group_moderator_list.length
            }
            getCollaboratorBusinessEmployeeMembers(reqparams)
                .then((response) => {
                    scrollProcessCollaboratorBusinessEmployeeMembersList(response, function () {
                        listenForCollaboratorGroupModeratorsListScrollEvent($(".modal-popup-content"));
                        removeLoader();
                    });
                })
                .catch((err) => {
                    removeLoader();
                    var EmployeeList = {
                        page_for: "moderator"
                    }
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, "page/collaborator/scroll_collaborator_group_members_list_data", "#scroll-collaborator-group-members-list-template", ".employee-selection-member-list", EmployeeList);
                })

        }
    });
}

function scrollProcessCollaboratorBusinessEmployeeMembersList(data, callback) {
    digibiz.colloborator_group_moderator_list = removeDuplicates(digibiz.colloborator_group_moderator_list.concat(data), "id");
    var EmployeeList = {
        EmployeeList: data.map(e => {
            if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
                // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.member.employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.identity_picture['avtarUrl'] = avtarUrl;
                e['imageLetter'] = e.member_name.first.charAt(0);
                // } else {
                //     e['imageLetter'] = e.member_name.first.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.member_name.first.charAt(0);
            }
            return e;
        }),
        page_for: "moderator"
    }
    //console.log("collaboratorGroupsList", collaboratorGroupsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/collaborator/scroll_moderator_selection_list", "#scroll-moderator-selection-list-template", ".employee-selection-member-list", EmployeeList);
}

function listenForCollaboratorGroupModeratorListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                offset: digibiz.group_moderator_list.length,
                count: 5
            }
            getGroupModeratorList(requestParams)
                .then((moderatorResponse) => {
                    removeLoader();
                    if (moderatorResponse.moderator && moderatorResponse.moderator.length > 0) {
                        scrollProcessGroupModeratorList(moderatorResponse.moderator, function () {
                            listenForCollaboratorGroupModeratorListScrollEvent($('#collaborator-group-moderator-list'));
                        });
                    } else {
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "collaborator-group-moderator-list .os-content", null);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "#collaborator-group-moderator-list .os-content", null);
                })

        }
    });
}

function listenForGroupModeratorListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                offset: digibiz.group_moderator_list.length,
                count: 5
            }
            getGroupModeratorList(requestParams)
                .then((moderatorResponse) => {
                    removeLoader();
                    if (moderatorResponse.moderator && moderatorResponse.moderator.length > 0) {
                        scrollProcessGroupModeratorList(moderatorResponse.moderator, function () {
                            listenForGroupModeratorListScrollEvent($('#employee-group-moderator-members-list'));
                        });
                    } else {
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                removeLoader();
                            }
                        }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "#employee-group-moderator-members-list .os-content", null);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                        }
                    }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "#employee-group-moderator-members-list .os-content", null);
                })

        }
    });
}

function listenForCommunicationGroupModeratorListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var requestParams = {
                device_id: crossplat.device.uuid,
                id: sessionStorage.getItem('group_id'),
                offset: digibiz.group_moderator_list.length,
                count: 5
            }
            getGroupModeratorList(requestParams)
                .then((moderatorResponse) => {
                    removeLoader();
                    if (moderatorResponse.moderator && moderatorResponse.moderator.length > 0) {
                        scrollProcessGroupModeratorList(moderatorResponse.moderator, function () {
                            listenForCommunicationGroupModeratorListScrollEvent($('#communication-group-moderator-members-list'));
                        });
                    } else {
                        fetch.appendHtml(function (err) {
                            if (!err) {
                                callback();
                            }
                        }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "#communication-group-moderator-members-list .os-content", groupModeratorsList);
                    }

                })
                .catch((err) => {
                    console.log("error in employee group members data", err);
                    removeLoader();
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            callback();
                        }
                    }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "#communication-group-moderator-members-list .os-content", groupModeratorsList);
                })

        }
    });
}

function processGroupModeratorList(data, callback) {
    // digibiz.group_moderator_list = removeDuplicates(digibiz.group_moderator_list.concat(data), "group_data.id");
    // digibiz.group_moderator_list = digibiz.group_moderator_list.concat(data);
   if(data && data.length > 0) {
    var groupModeratorsList = {
        group_type: sessionStorage.getItem('group_type'),
        custom_group_from: sessionStorage.getItem('group_from'),
        group_moderator_data: digibiz.group_moderator_list.map(e => {
            if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                    e.data.identity_picture['avtarUrl'] = avtarUrl;
                    e.data['imageLetter'] = e.data.name.first.charAt(0);
                } else {
                    e.data['imageLetter'] = e.data.name.first.charAt(0);
                }
            } else {
                e.data['imageLetter'] = e.data.name.first.charAt(0);
            }
            return e;
        })

    }
} else {
    var groupModeratorsList = {
        group_type: sessionStorage.getItem('group_type'),
        custom_group_from: sessionStorage.getItem('group_from')
    }
}
    console.log("groupModeratorsList", groupModeratorsList);
    if ($('#communication-group-moderator-members-list').length > 0) {
        var identifier = "#communication-group-moderator-members-list";
    } else if ($('#collaborator-group-moderator-list').length > 0) {
        var identifier = "#collaborator-group-moderator-list";
    } else {
        var identifier = "#employee-group-moderator-members-list";
    }
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/group_moderator_list_data", "#group-moderator-list-template", identifier, groupModeratorsList);
}

function scrollProcessGroupModeratorList(data, callback) {
    console.log('datadata', data);
    digibiz.group_moderator_list = digibiz.group_moderator_list.concat(data);
    var groupModeratorsList = {
        group_type: sessionStorage.getItem('group_type'),
        custom_group_from: sessionStorage.getItem('group_from'),
        group_moderator_data: data.map(e => {
            if (e.data.hasOwnProperty('identity_picture') && e.data.identity_picture) {
                if (e.data.identity_picture.hasOwnProperty('thumbnail') && e.data.identity_picture.thumbnail) {
                    var avtarUrl = `${api.get_employee_identity_picture}?id=${e.id}&device_id=${crossplat.device.uuid}&image_id=${e.data.identity_picture.thumbnail}`;
                    e.data.identity_picture['avtarUrl'] = avtarUrl;
                    e.data['imageLetter'] = e.data.name.first.charAt(0);
                } else {
                    e.data['imageLetter'] = e.data.name.first.charAt(0);
                }
            } else {
                e.data['imageLetter'] = e.data.name.first.charAt(0);
            }
            return e;
        })

    }
    if ($('#communication-group-moderator-members-list').length > 0) {
        var identifier = "#communication-group-moderator-members-list .os-content";
    } else if ($('#collaborator-group-moderator-list').length > 0) {
        var identifier = "#collaborator-group-moderator-list";
    } else {
        var identifier = "#employee-group-moderator-members-list";
    }
    console.log("groupModeratorsList", groupModeratorsList);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/group_moderator_list_data", "#group-moderator-list-template", "#employee-group-moderator-members-list .os-content", groupModeratorsList);
}

function listenForSearchedEmployeeGroupEmployeeSelectionListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            var element = $('#employee-list-selection-search-btn').find('.expand-search-input');
            if (element) {
                var socketid = element.attr("socketid");
                var keyword = element.val();
            }
            currentroute = $("body").attr('app');
            data = {
                room: crossplat.device.uuid,
                socketid,
                app: 'digibiz',
                keyword
            };
            switch (currentroute) {
                case 'employee_group_create':
                    if (sessionStorage.getItem('selected-employee-group-list-type-tab') == "custom") {
                        if ($('#modal-employee-selection').length > 0) {
                            if (sessionStorage.getItem('group_from') == "employee_list") {
                                data['index'] = 'getEmployeeContactListAllEmployees';
                                data['business_id'] = sessionStorage.getItem('business_id');
                                data['count'] = 10;
                                data['offset'] = digibiz.searched_employee_list.length;
                            }
                        }
                    }
                    break;
                default:
                    break;
            }


        }
    });
}

function getGroupsCount(reqParam) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.group_count, "POST", "JSON", reqParam);
    });
}


function getCollaboratorGroupsCount(reqParam) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.collaborator_group_count, "POST", "JSON", reqParam);
    });
}


function getCommunicationGroupsCount(reqParam) {
    return new Promise((resolve, reject) => {
        fetch.apiCall(function (response, status, xhr) {
            if (status == "success") {
                resolve(response.data);
            } else {
                reject(JSON.parse(response.responseText));
            }
        }, api.communication_group_count, "POST", "JSON", reqParam);
    });
}



// function listenForEmployeeGroupGroupMembersList(el) {
//     $(el).off('el_scroll');
//     el.on("el_scroll", function (event) {
//         if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
//             $(this).off('el_scroll');
//             addLoader();
//             var requestParams = {
//                 device_id: crossplat.device.uuid,
//                 group_id: sessionStorage.getItem('group_id'),
//                 count: 5,
//                 offset: digibiz.employee_group_members_list.length
//             }
//             console.log('requestParamsee', requestParams);
//             getGroupMembers(requestParams)
//                 .then((membersResponse) => {
//                     removeLoader();
//                     if (membersResponse && membersResponse.length > 0) {
//                         scrollProcessEmployeeGroupsGroupMembersList(membersResponse, function () {
//                             listenForEmployeeGroupGroupMembersList($('#employee-group-members-list'));
//                         });
//                     } else {
//                         fetch.appendHtml(function (err) {
//                             if (!err) {
//                                 removeLoader();
//                             }
//                         }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list", null);
//                     }

//                 })
//                 .catch((err) => {
//                     console.log("error in employee group members data", err);
//                     removeLoader();
//                     fetch.appendHtml(function (err) {
//                         if (!err) {
//                         }
//                     }, "page/customer/scroll_customer_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list", null);
//                 })

//         }
//     });
// }

// function scrollProcessEmployeeGroupsGroupMembersList(data, callback) {
//     digibiz.employee_groups_group_members_list = removeDuplicates(digibiz.employee_groups_group_members_list.concat(data), "id");
//     // sorteddata = sortData(digibiz.employee_business_list, 'name', 'asc');
//     var groupMembersList = {
//         customer_group_type: sessionStorage.getItem('group_type'),
//         custom_group_from: sessionStorage.getItem('group_from'),
//         group_members_data: data.map(e => {
//             if (e.hasOwnProperty('identity_picture') && e.identity_picture) {
//                 // if (e.identity_picture.hasOwnProperty('asset_id') && e.identity_picture.asset_id) {
//                     var avtarUrl = `${api.get_group_image}?device_id=${crossplat.device.uuid}&id=${e.member.id}&image_id=${e.group_image.thumbnail}`;
//                 e.identity_picture['avtarUrl'] = avtarUrl;
//                 e['imageLetter'] = e.member_name.first.charAt(0);
//                 // } else {
//                 //     e['imageLetter'] = e.member_name.first.charAt(0);
//                 // }
//             } else {
//                 e['imageLetter'] = e.member_name.first.charAt(0);
//             }
//             return e;
//         })
//     }
//     console.log("groupMembersList", groupMembersList);
//     fetch.appendHtml(function (err) {
//         if (!err) {
//             callback();
//         }
//     }, "page/employee/scroll_employee_group_members_list_data", "#scroll-customer-group-members-list-template", "#customer-group-members-list", groupMembersList);
// }


function listenForEmployeeStandardGroupListScrollEvent(el) {
    $(el).off('el_scroll');
    el.on("el_scroll", function (event) {
        if (event.detail.scrollTop >= ((event.detail.scrollHeight - event.detail.offsetHeight) - 10)) {
            $(this).off('el_scroll');
            addLoader();
            var reqParam = {
                device_id: crossplat.device.uuid,
                type: "employee",
                list_by: "draft_active_standard_employee_groups",
                business_id: sessionStorage.getItem('business_id'),
                count: 20,
                offset: digibiz.employee_group_standard_group_members.length
            }
            groupsList(reqParam)
                .then((response) => {
                    processScrollEmployeeStandardGroupList(response, function () {
                        var dataa = removeDuplicates(digibiz.employee_group_standard_group_members.concat(response), "id");
                        if (digibiz.employee_group_standard_group_members.length == dataa.length) {
                            fetch.appendHtml(function (err) {
                                if (!err) {
                                    removeLoader();
                                }
                            }, 'page/common/scroll_standard_employee_group_selection', '#scroll-standard-employee-selection-list-template', '#standard-employee-selection-list-container', null);
                        } else {
                            listenForEmployeeStandardGroupListScrollEvent($(".modal-popup-content"));
                        }
                        removeLoader();
                    });
                })
                .catch((err) => {
                    fetch.appendHtml(function (err) {
                        if (!err) {
                            removeLoader();
                        }
                    }, 'page/common/scroll_standard_employee_group_selection', '#scroll-standard-employee-selection-list-template', '#standard-employee-selection-list-container', null);

                })
        }
    });
}

function processScrollEmployeeStandardGroupList(data, callback) {
    digibiz.employee_group_standard_group_members = removeDuplicates(digibiz.employee_group_standard_group_members.concat(data), "id");
    var standardGroupList = {
        standardGroupList: data.map(e => {
            if (e.hasOwnProperty('display_picture') && e.display_picture) {
                // if (e.display_picture.hasOwnProperty('asset_id') && e.display_picture.asset_id) {
                var avtarUrl = `${api.get_employee_thumbnail}?id=${e.dj_unique_employee_id}&device_id=${crossplat.device.uuid}&type=display_picture`;
                e.display_picture['avtarUrl'] = avtarUrl;
                //     e['imageLetter'] = e.name.charAt(0);
                // } else {
                //     e['imageLetter'] = e.name.charAt(0);
                // }
            } else {
                e['imageLetter'] = e.name.charAt(0);
            }
            return e;
        })
    }
    //console.log("getData", getData);
    fetch.appendHtml(function (err) {
        if (!err) {
            callback();
        }
    }, "page/common/scroll_standard_employee_group_selection", "#scroll-standard-employee-selection-list-template", "#standard-employee-selection-list-container", standardGroupList);
}

